{"content":"---\ntitle: \"ICorProfilerCallback4::MovedReferences2 Method | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\napi_name: \n  - \"ICorProfilerCallback4.MovedReferences2\"\napi_location: \n  - \"mscorwks.dll\"\napi_type: \n  - \"COM\"\nf1_keywords: \n  - \"ICorProfilerCallback4::MovedReferences2\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"MovedReferences2 method, ICorProfilerCallback4 interface [.NET Framework profiling]\"\n  - \"ICorProfilerCallback4::MovedReferences2 method [.NET Framework profiling]\"\nms.assetid: d17a065b-5bc6-4817-b3e1-1e413fcb33a8\ntopic_type: \n  - \"apiref\"\ncaps.latest.revision: 13\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"\n---\n# ICorProfilerCallback4::MovedReferences2 Method\nCalled to report the new layout of objects in the heap as a result of a compacting garbage collection. This method is called if the profiler has implemented the [ICorProfilerCallback4](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-interface.md) interface. This callback replaces the [ICorProfilerCallback::MovedReferences](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-movedreferences-method.md) method, because it can report larger ranges of objects whose lengths exceed what can be expressed in a ULONG.  \n  \n## Syntax  \n  \n```  \nHRESULT MovedReferences2(  \n    [in]  ULONG  cMovedObjectIDRanges,  \n    [in, size_is(cMovedObjectIDRanges)] ObjectID oldObjectIDRangeStart[] ,  \n    [in, size_is(cMovedObjectIDRanges)] ObjectID newObjectIDRangeStart[] ,  \n    [in, size_is(cMovedObjectIDRanges)] SIZE_T    cObjectIDRangeLength[] );  \n```  \n  \n#### Parameters  \n `cMovedObjectIDRanges`  \n [in] The number of blocks of contiguous objects that moved as the result of the compacting garbage collection. That is, the value of `cMovedObjectIDRanges` is the total size of the `oldObjectIDRangeStart`, `newObjectIDRangeStart`, and `cObjectIDRangeLength` arrays.  \n  \n The next three arguments of `MovedReferences2` are parallel arrays. In other words, `oldObjectIDRangeStart[i]`, `newObjectIDRangeStart[i]`, and `cObjectIDRangeLength[i]` all concern a single block of contiguous objects.  \n  \n `oldObjectIDRangeStart`  \n [in] An array of `ObjectID` values, each of which is the old (pre-garbage collection) starting address of a block of contiguous, live objects in memory.  \n  \n `newObjectIDRangeStart`  \n [in] An array of `ObjectID` values, each of which is the new (post-garbage collection) starting address of a block of contiguous, live objects in memory.  \n  \n `cObjectIDRangeLength`  \n [in] An array of integers, each of which is the size of a block of contiguous objects in memory.  \n  \n A size is specified for each block that is referenced in the `oldObjectIDRangeStart` and `newObjectIDRangeStart` arrays.  \n  \n## Remarks  \n A compacting garbage collector reclaims the memory occupied by dead objects and compacts that freed space. As a result, live objects might be moved within the heap, and `ObjectID` values distributed by previous notifications might change.  \n  \n Assume that an existing `ObjectID` value (`oldObjectID`) lies within the following range:  \n  \n `oldObjectIDRangeStart[i]` <= `oldObjectID` < `oldObjectIDRangeStart[i]` + `cObjectIDRangeLength[i]`  \n  \n In this case, the offset from the start of the range to the start of the object is as follows:  \n  \n `oldObjectID` - `oldObjectRangeStart[i]`  \n  \n For any value of `i` that is in the following range:  \n  \n 0 <= `i` < `cMovedObjectIDRanges`  \n  \n you can calculate the new `ObjectID` as follows:  \n  \n `newObjectID` = `newObjectIDRangeStart[i]` + (`oldObjectID` â€“ `oldObjectIDRangeStart[i]`)  \n  \n None of the `ObjectID` values passed by `MovedReferences2` are valid during the callback itself, because the garbage collector might be in the middle of moving objects from old locations to new locations. Therefore, profilers should not attempt to inspect objects during a `MovedReferences2` call. A [ICorProfilerCallback2::GarbageCollectionFinished](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-garbagecollectionfinished-method.md) callback indicates that all objects have been moved to their new locations and inspection can be performed.  \n  \n If the profiler implements both the [ICorProfilerCallback](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md) and the [ICorProfilerCallback4](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-interface.md) interfaces, the `MovedReferences2` method is called before the [ICorProfilerCallback::MovedReferences](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-movedreferences-method.md) method, but only if the `MovedReferences2` method returns successfully. Profilers can return an HRESULT that indicates failure from the `MovedReferences2` method, to avoid calling the second method.  \n  \n## Requirements  \n **Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md).  \n  \n **Header:** CorProf.idl, CorProf.h  \n  \n **Library:** CorGuids.lib  \n  \n **.NET Framework Versions:** [!INCLUDE[net_current_v45plus](../../../../includes/net-current-v45plus-md.md)]  \n  \n## See Also  \n [ICorProfilerCallback Interface](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md)   \n [MovedReferences Method](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-movedreferences-method.md)   \n [ICorProfilerCallback4 Interface](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-interface.md)   \n [Profiling Interfaces](../../../../docs/framework/unmanaged-api/profiling/profiling-interfaces.md)   \n [Profiling](../../../../docs/framework/unmanaged-api/profiling/index.md)","nodes":[{"pos":[4,782],"nodes":[{"content":"ICorProfilerCallback4::MovedReferences2 Method | Microsoft Docs","nodes":[{"pos":[0,63],"content":"ICorProfilerCallback4::MovedReferences2 Method | Microsoft Docs","nodes":[{"content":"ICorProfilerCallback4::MovedReferences2 Method | Microsoft Docs","pos":[0,63]}]}],"pos":[6,72],"yaml":true}],"content":"title: \"ICorProfilerCallback4::MovedReferences2 Method | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\napi_name: \n  - \"ICorProfilerCallback4.MovedReferences2\"\napi_location: \n  - \"mscorwks.dll\"\napi_type: \n  - \"COM\"\nf1_keywords: \n  - \"ICorProfilerCallback4::MovedReferences2\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"MovedReferences2 method, ICorProfilerCallback4 interface [.NET Framework profiling]\"\n  - \"ICorProfilerCallback4::MovedReferences2 method [.NET Framework profiling]\"\nms.assetid: d17a065b-5bc6-4817-b3e1-1e413fcb33a8\ntopic_type: \n  - \"apiref\"\ncaps.latest.revision: 13\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"","yamlblock":true},{"pos":[789,835],"content":"ICorProfilerCallback4::MovedReferences2 Method","linkify":"ICorProfilerCallback4::MovedReferences2 Method","nodes":[{"content":"ICorProfilerCallback4::MovedReferences2 Method","pos":[0,46]}]},{"content":"Called to report the new layout of objects in the heap as a result of a compacting garbage collection.","pos":[836,938]},{"content":"This method is called if the profiler has implemented the <bpt id=\"p1\">[</bpt>ICorProfilerCallback4<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-interface.md)</ept> interface.","pos":[939,1118],"source":" This method is called if the profiler has implemented the [ICorProfilerCallback4](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-interface.md) interface."},{"content":"This callback replaces the <bpt id=\"p1\">[</bpt>ICorProfilerCallback::MovedReferences<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-movedreferences-method.md)</ept> method, because it can report larger ranges of objects whose lengths exceed what can be expressed in a ULONG.","pos":[1119,1394],"source":" This callback replaces the [ICorProfilerCallback::MovedReferences](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-movedreferences-method.md) method, because it can report larger ranges of objects whose lengths exceed what can be expressed in a ULONG."},{"pos":[1403,1409],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[1736,1746],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"[in] The number of blocks of contiguous objects that moved as the result of the compacting garbage collection.","pos":[1776,1886]},{"content":"That is, the value of <ph id=\"ph1\">`cMovedObjectIDRanges`</ph> is the total size of the <ph id=\"ph2\">`oldObjectIDRangeStart`</ph>, <ph id=\"ph3\">`newObjectIDRangeStart`</ph>, and <ph id=\"ph4\">`cObjectIDRangeLength`</ph> arrays.","pos":[1887,2041],"source":" That is, the value of `cMovedObjectIDRanges` is the total size of the `oldObjectIDRangeStart`, `newObjectIDRangeStart`, and `cObjectIDRangeLength` arrays."},{"content":"The next three arguments of <ph id=\"ph1\">`MovedReferences2`</ph> are parallel arrays.","pos":[2048,2115],"source":"The next three arguments of `MovedReferences2` are parallel arrays."},{"content":"In other words, <ph id=\"ph1\">`oldObjectIDRangeStart[i]`</ph>, <ph id=\"ph2\">`newObjectIDRangeStart[i]`</ph>, and <ph id=\"ph3\">`cObjectIDRangeLength[i]`</ph> all concern a single block of contiguous objects.","pos":[2116,2267],"source":" In other words, `oldObjectIDRangeStart[i]`, `newObjectIDRangeStart[i]`, and `cObjectIDRangeLength[i]` all concern a single block of contiguous objects."},{"content":"[in] An array of <ph id=\"ph1\">`ObjectID`</ph> values, each of which is the old (pre-garbage collection) starting address of a block of contiguous, live objects in memory.","pos":[2301,2453],"source":"[in] An array of `ObjectID` values, each of which is the old (pre-garbage collection) starting address of a block of contiguous, live objects in memory."},{"content":"[in] An array of <ph id=\"ph1\">`ObjectID`</ph> values, each of which is the new (post-garbage collection) starting address of a block of contiguous, live objects in memory.","pos":[2487,2640],"source":"[in] An array of `ObjectID` values, each of which is the new (post-garbage collection) starting address of a block of contiguous, live objects in memory."},{"content":"[in] An array of integers, each of which is the size of a block of contiguous objects in memory.","pos":[2673,2769]},{"pos":[2776,2896],"content":"A size is specified for each block that is referenced in the <ph id=\"ph1\">`oldObjectIDRangeStart`</ph> and <ph id=\"ph2\">`newObjectIDRangeStart`</ph> arrays.","source":"A size is specified for each block that is referenced in the `oldObjectIDRangeStart` and `newObjectIDRangeStart` arrays."},{"pos":[2905,2912],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"A compacting garbage collector reclaims the memory occupied by dead objects and compacts that freed space.","pos":[2916,3022]},{"content":"As a result, live objects might be moved within the heap, and <ph id=\"ph1\">`ObjectID`</ph> values distributed by previous notifications might change.","pos":[3023,3154],"source":" As a result, live objects might be moved within the heap, and `ObjectID` values distributed by previous notifications might change."},{"pos":[3161,3250],"content":"Assume that an existing <ph id=\"ph1\">`ObjectID`</ph> value (<ph id=\"ph2\">`oldObjectID`</ph>) lies within the following range:","source":"Assume that an existing `ObjectID` value (`oldObjectID`) lies within the following range:"},{"content":"In this case, the offset from the start of the range to the start of the object is as follows:","pos":[3364,3458]},{"pos":[3512,3564],"content":"For any value of <ph id=\"ph1\">`i`</ph> that is in the following range:","source":"For any value of `i` that is in the following range:"},{"pos":[3571,3604],"content":"0 &lt;= <ph id=\"ph1\">`i`</ph><ph id=\"ph2\"> &lt; </ph><ph id=\"ph3\">`cMovedObjectIDRanges`</ph>","source":"0 <= `i` < `cMovedObjectIDRanges`"},{"pos":[3611,3659],"content":"you can calculate the new <ph id=\"ph1\">`ObjectID`</ph> as follows:","source":"you can calculate the new `ObjectID` as follows:"},{"pos":[3666,3755],"content":"<ph id=\"ph1\">`newObjectID`</ph><ph id=\"ph2\"> = </ph><ph id=\"ph3\">`newObjectIDRangeStart[i]`</ph> + (<ph id=\"ph4\">`oldObjectID`</ph> â€“ <ph id=\"ph5\">`oldObjectIDRangeStart[i]`</ph>)","source":"`newObjectID` = `newObjectIDRangeStart[i]` + (`oldObjectID` â€“ `oldObjectIDRangeStart[i]`)"},{"content":"None of the <ph id=\"ph1\">`ObjectID`</ph> values passed by <ph id=\"ph2\">`MovedReferences2`</ph> are valid during the callback itself, because the garbage collector might be in the middle of moving objects from old locations to new locations.","pos":[3762,3966],"source":"None of the `ObjectID` values passed by `MovedReferences2` are valid during the callback itself, because the garbage collector might be in the middle of moving objects from old locations to new locations."},{"content":"Therefore, profilers should not attempt to inspect objects during a <ph id=\"ph1\">`MovedReferences2`</ph> call.","pos":[3967,4059],"source":" Therefore, profilers should not attempt to inspect objects during a `MovedReferences2` call."},{"content":"A <bpt id=\"p1\">[</bpt>ICorProfilerCallback2::GarbageCollectionFinished<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-garbagecollectionfinished-method.md)</ept> callback indicates that all objects have been moved to their new locations and inspection can be performed.","pos":[4060,4330],"source":" A [ICorProfilerCallback2::GarbageCollectionFinished](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-garbagecollectionfinished-method.md) callback indicates that all objects have been moved to their new locations and inspection can be performed."},{"content":"If the profiler implements both the <bpt id=\"p1\">[</bpt>ICorProfilerCallback<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md)</ept> and the <bpt id=\"p2\">[</bpt>ICorProfilerCallback4<ept id=\"p2\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-interface.md)</ept> interfaces, the <ph id=\"ph1\">`MovedReferences2`</ph> method is called before the <bpt id=\"p3\">[</bpt>ICorProfilerCallback::MovedReferences<ept id=\"p3\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-movedreferences-method.md)</ept> method, but only if the <ph id=\"ph2\">`MovedReferences2`</ph> method returns successfully.","pos":[4337,4874],"source":"If the profiler implements both the [ICorProfilerCallback](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md) and the [ICorProfilerCallback4](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-interface.md) interfaces, the `MovedReferences2` method is called before the [ICorProfilerCallback::MovedReferences](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-movedreferences-method.md) method, but only if the `MovedReferences2` method returns successfully."},{"content":"Profilers can return an HRESULT that indicates failure from the <ph id=\"ph1\">`MovedReferences2`</ph> method, to avoid calling the second method.","pos":[4875,5001],"source":" Profilers can return an HRESULT that indicates failure from the `MovedReferences2` method, to avoid calling the second method."},{"pos":[5010,5022],"content":"Requirements","linkify":"Requirements","nodes":[{"content":"Requirements","pos":[0,12]}]},{"pos":[5026,5130],"content":"<bpt id=\"p1\">**</bpt>Platforms:<ept id=\"p1\">**</ept> See <bpt id=\"p2\">[</bpt>System Requirements<ept id=\"p2\">](../../../../docs/framework/get-started/system-requirements.md)</ept>.","source":"**Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md)."},{"pos":[5137,5171],"content":"<bpt id=\"p1\">**</bpt>Header:<ept id=\"p1\">**</ept> CorProf.idl, CorProf.h","source":"**Header:** CorProf.idl, CorProf.h"},{"pos":[5178,5203],"content":"<bpt id=\"p1\">**</bpt>Library:<ept id=\"p1\">**</ept> CorGuids.lib","source":"**Library:** CorGuids.lib"},{"pos":[5210,5318],"content":"<bpt id=\"p1\">**</bpt>.NET Framework Versions:<ept id=\"p1\">**</ept> <ph id=\"ph1\">[!INCLUDE[net_current_v45plus](../../../../includes/net-current-v45plus-md.md)]</ph>","source":"**.NET Framework Versions:** [!INCLUDE[net_current_v45plus](../../../../includes/net-current-v45plus-md.md)]"},{"pos":[5327,5335],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>ICorProfilerCallback Interface<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md)</ept><ph id=\"ph1\"> </ph>","pos":[5339,5458],"source":"[ICorProfilerCallback Interface](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md) "},{"content":"<bpt id=\"p1\">[</bpt>MovedReferences Method<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-movedreferences-method.md)</ept><ph id=\"ph1\"> </ph>","pos":[5462,5586],"source":"[MovedReferences Method](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-movedreferences-method.md) "},{"content":"<bpt id=\"p1\">[</bpt>ICorProfilerCallback4 Interface<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-interface.md)</ept><ph id=\"ph1\"> </ph>","pos":[5590,5711],"source":"[ICorProfilerCallback4 Interface](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-interface.md) "},{"content":"<bpt id=\"p1\">[</bpt>Profiling Interfaces<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/profiling-interfaces.md)</ept><ph id=\"ph1\"> </ph>","pos":[5715,5814],"source":"[Profiling Interfaces](../../../../docs/framework/unmanaged-api/profiling/profiling-interfaces.md) "},{"content":"<bpt id=\"p1\">[</bpt>Profiling<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/index.md)</ept>","pos":[5818,5890],"source":"[Profiling](../../../../docs/framework/unmanaged-api/profiling/index.md)"}]}