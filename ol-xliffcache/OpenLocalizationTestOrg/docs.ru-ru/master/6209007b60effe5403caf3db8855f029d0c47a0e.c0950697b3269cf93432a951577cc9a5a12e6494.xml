{"content":"---\ntitle: \"Using Impersonation with Transport Security\"\nms.date: \"03/30/2017\"\nms.assetid: 426df8cb-6337-4262-b2c0-b96c2edf21a9\n---\n# Using Impersonation with Transport Security\n*Impersonation* is the ability of a server application to take on the identity of the client. It is common for services to use impersonation when validating access to resources. The server application runs using a service account, but when the server accepts a client connection, it impersonates the client so that access checks are performed using the client's credentials. Transport security is a mechanism both for passing credentials and securing communication using those credentials. This topic describes using transport security in Windows Communication Foundation (WCF) with the impersonation feature. For more information about impersonation using message security, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).  \n  \n## Five Impersonation Levels  \n Transport security makes use of five levels of impersonation, as described in the following table.  \n  \n|Impersonation level|Description|  \n|-------------------------|-----------------|  \n|None|The server application does not attempt to impersonate the client.|  \n|Anonymous|The server application can perform access checks against the client's credentials, but does not receive any information about the client's identity. This impersonation level is meaningful only for on-machine communication, such as named pipes. Using `Anonymous` with a remote connection promotes the impersonation level to Identify.|  \n|Identify|The server application knows the client's identity and can perform access validation against the client's credentials, but cannot impersonate the client. Identify is the default impersonation level used with SSPI credentials in WCF unless the token provider provides a different impersonation level.|  \n|Impersonate|The server application can access resources on the server machine as the client in addition to performing access checks. The server application cannot access resources on remote machines using the client's identity because the impersonated token does not have network credentials|  \n|Delegate|In addition to having the same capabilities as `Impersonate`, the Delegate impersonation level also enables the server application to access resources on remote machines using the client's identity and to pass the identity to other applications.<br /><br /> **Important** The server domain account must be marked as trusted for delegation on the domain controller to use these additional features. This level of impersonation cannot be used with client domain accounts marked as sensitive.|  \n  \n The levels most commonly used with transport security are `Identify` and `Impersonate`. The levels `None` and `Anonymous` are not recommended for typical use, and many transports do not support using those levels with authentication. The `Delegate` level is a powerful feature that should be used with care. Only trusted server applications should be given the permission to delegate credentials.  \n  \n Using impersonation at the `Impersonate` or `Delegate` levels requires the server application to have the `SeImpersonatePrivilege` privilege. An application has this privilege by default if it is running on an account in the Administrators group or on an account with a Service SID (Network Service, Local Service, or Local System). Impersonation does not require mutual authentication of the client and server. Some authentication schemes that support impersonation, such as NTLM, cannot be used with mutual authentication.  \n  \n## Transport-Specific Issues with Impersonation  \n The choice of a transport in WCF affects the possible choices for impersonation. This section describes issues affecting the standard HTTP and named pipe transports in WCF. Custom transports have their own restrictions on support for impersonation.  \n  \n### Named Pipe Transport  \n The following items are used with the named pipe transport:  \n  \n-   The named pipe transport is intended for use only on the local machine. The named pipe transport in WCF explicitly disallows cross-machine connections.  \n  \n-   Named pipes cannot be used with the `Impersonate` or `Delegate` impersonation level. The named pipe cannot enforce the on-machine guarantee at these impersonation levels.  \n  \n For more information about named pipes, see [Choosing a Transport](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md).  \n  \n### HTTP Transport  \n The bindings that use the HTTP transport (<xref:System.ServiceModel.WSHttpBinding> and <xref:System.ServiceModel.BasicHttpBinding>) support several authentication schemes, as explained in [Understanding HTTP Authentication](../../../../docs/framework/wcf/feature-details/understanding-http-authentication.md). The impersonation level supported depends on the authentication scheme. The following items are used with the HTTP transport:  \n  \n-   The `Anonymous` authentication scheme ignores impersonation.  \n  \n-   The `Basic` authentication scheme supports only the `Delegate` level. All lower impersonation levels are upgraded.  \n  \n-   The `Digest` authentication scheme supports only the `Impersonate` and `Delegate` levels.  \n  \n-   The `NTLM` authentication scheme, selectable either directly or through negotiation, supports only the `Delegate` level on the local machine.  \n  \n-   The Kerberos authentication scheme, which can only be selected through negotiation, can be used with any supported impersonation level.  \n  \n For more information about the HTTP transport, see [Choosing a Transport](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md).  \n  \n## See also\n\n- [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)\n- [Authorization](../../../../docs/framework/wcf/feature-details/authorization-in-wcf.md)\n- [How to: Impersonate a Client on a Service](../../../../docs/framework/wcf/how-to-impersonate-a-client-on-a-service.md)\n- [Understanding HTTP Authentication](../../../../docs/framework/wcf/feature-details/understanding-http-authentication.md)\n","nodes":[{"pos":[4,127],"embed":true,"restype":"x-metadata","content":"title: \"Using Impersonation with Transport Security\"\nms.date: \"03/30/2017\"\nms.assetid: 426df8cb-6337-4262-b2c0-b96c2edf21a9","nodes":[{"content":"Using Impersonation with Transport Security","nodes":[{"pos":[0,43],"content":"Using Impersonation with Transport Security","nodes":[{"content":"Using Impersonation with Transport Security","pos":[0,43]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[134,177],"content":"Using Impersonation with Transport Security","linkify":"Using Impersonation with Transport Security","nodes":[{"content":"Using Impersonation with Transport Security","pos":[0,43]}]},{"content":"<bpt id=\"p1\">*</bpt>Impersonation<ept id=\"p1\">*</ept> is the ability of a server application to take on the identity of the client.","pos":[178,271],"source":"*Impersonation* is the ability of a server application to take on the identity of the client."},{"content":"It is common for services to use impersonation when validating access to resources.","pos":[272,355]},{"content":"The server application runs using a service account, but when the server accepts a client connection, it impersonates the client so that access checks are performed using the client's credentials.","pos":[356,552]},{"content":"Transport security is a mechanism both for passing credentials and securing communication using those credentials.","pos":[553,667]},{"content":"This topic describes using transport security in Windows Communication Foundation (WCF) with the impersonation feature.","pos":[668,787]},{"content":"For more information about impersonation using message security, see <bpt id=\"p1\">[</bpt>Delegation and Impersonation<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)</ept>.","pos":[788,977],"source":" For more information about impersonation using message security, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)."},{"pos":[986,1011],"content":"Five Impersonation Levels","linkify":"Five Impersonation Levels","nodes":[{"content":"Five Impersonation Levels","pos":[0,25]}]},{"content":"Transport security makes use of five levels of impersonation, as described in the following table.","pos":[1015,1113]},{"content":"Impersonation level","pos":[1120,1139]},{"content":"Description","pos":[1140,1151]},{"content":"None","pos":[1204,1208]},{"content":"The server application does not attempt to impersonate the client.","pos":[1209,1275]},{"content":"Anonymous","pos":[1280,1289]},{"content":"The server application can perform access checks against the client's credentials, but does not receive any information about the client's identity.","pos":[1290,1438]},{"content":"This impersonation level is meaningful only for on-machine communication, such as named pipes.","pos":[1439,1533]},{"content":"Using <ph id=\"ph1\">`Anonymous`</ph> with a remote connection promotes the impersonation level to Identify.","pos":[1534,1622],"source":" Using `Anonymous` with a remote connection promotes the impersonation level to Identify."},{"content":"Identify","pos":[1627,1635]},{"content":"The server application knows the client's identity and can perform access validation against the client's credentials, but cannot impersonate the client.","pos":[1636,1789]},{"content":"Identify is the default impersonation level used with SSPI credentials in WCF unless the token provider provides a different impersonation level.","pos":[1790,1935]},{"content":"Impersonate","pos":[1940,1951]},{"content":"The server application can access resources on the server machine as the client in addition to performing access checks.","pos":[1952,2072]},{"content":"The server application cannot access resources on remote machines using the client's identity because the impersonated token does not have network credentials","pos":[2073,2231]},{"content":"Delegate","pos":[2236,2244]},{"content":"In addition to having the same capabilities as <ph id=\"ph1\">`Impersonate`</ph>, the Delegate impersonation level also enables the server application to access resources on remote machines using the client's identity and to pass the identity to other applications.","pos":[2245,2490],"source":"In addition to having the same capabilities as `Impersonate`, the Delegate impersonation level also enables the server application to access resources on remote machines using the client's identity and to pass the identity to other applications."},{"content":"<bpt id=\"p1\">**</bpt>Important<ept id=\"p1\">**</ept> The server domain account must be marked as trusted for delegation on the domain controller to use these additional features.","pos":[2503,2642],"source":"**Important** The server domain account must be marked as trusted for delegation on the domain controller to use these additional features."},{"content":"This level of impersonation cannot be used with client domain accounts marked as sensitive.","pos":[2643,2734]},{"content":"The levels most commonly used with transport security are <ph id=\"ph1\">`Identify`</ph> and <ph id=\"ph2\">`Impersonate`</ph>.","pos":[2742,2829],"source":"The levels most commonly used with transport security are `Identify` and `Impersonate`."},{"content":"The levels <ph id=\"ph1\">`None`</ph> and <ph id=\"ph2\">`Anonymous`</ph> are not recommended for typical use, and many transports do not support using those levels with authentication.","pos":[2830,2975],"source":" The levels `None` and `Anonymous` are not recommended for typical use, and many transports do not support using those levels with authentication."},{"content":"The <ph id=\"ph1\">`Delegate`</ph> level is a powerful feature that should be used with care.","pos":[2976,3049],"source":" The `Delegate` level is a powerful feature that should be used with care."},{"content":"Only trusted server applications should be given the permission to delegate credentials.","pos":[3050,3138]},{"content":"Using impersonation at the <ph id=\"ph1\">`Impersonate`</ph> or <ph id=\"ph2\">`Delegate`</ph> levels requires the server application to have the <ph id=\"ph3\">`SeImpersonatePrivilege`</ph> privilege.","pos":[3145,3286],"source":"Using impersonation at the `Impersonate` or `Delegate` levels requires the server application to have the `SeImpersonatePrivilege` privilege."},{"content":"An application has this privilege by default if it is running on an account in the Administrators group or on an account with a Service SID (Network Service, Local Service, or Local System).","pos":[3287,3477]},{"content":"Impersonation does not require mutual authentication of the client and server.","pos":[3478,3556]},{"content":"Some authentication schemes that support impersonation, such as NTLM, cannot be used with mutual authentication.","pos":[3557,3669]},{"pos":[3678,3722],"content":"Transport-Specific Issues with Impersonation","linkify":"Transport-Specific Issues with Impersonation","nodes":[{"content":"Transport-Specific Issues with Impersonation","pos":[0,44]}]},{"content":"The choice of a transport in WCF affects the possible choices for impersonation.","pos":[3726,3806]},{"content":"This section describes issues affecting the standard HTTP and named pipe transports in WCF.","pos":[3807,3898]},{"content":"Custom transports have their own restrictions on support for impersonation.","pos":[3899,3974]},{"pos":[3984,4004],"content":"Named Pipe Transport","linkify":"Named Pipe Transport","nodes":[{"content":"Named Pipe Transport","pos":[0,20]}]},{"content":"The following items are used with the named pipe transport:","pos":[4008,4067]},{"content":"The named pipe transport is intended for use only on the local machine.","pos":[4077,4148]},{"content":"The named pipe transport in WCF explicitly disallows cross-machine connections.","pos":[4149,4228]},{"content":"Named pipes cannot be used with the <ph id=\"ph1\">`Impersonate`</ph> or <ph id=\"ph2\">`Delegate`</ph> impersonation level.","pos":[4238,4322],"source":"Named pipes cannot be used with the `Impersonate` or `Delegate` impersonation level."},{"content":"The named pipe cannot enforce the on-machine guarantee at these impersonation levels.","pos":[4323,4408]},{"pos":[4415,4554],"content":"For more information about named pipes, see <bpt id=\"p1\">[</bpt>Choosing a Transport<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md)</ept>.","source":"For more information about named pipes, see [Choosing a Transport](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md)."},{"pos":[4564,4578],"content":"HTTP Transport","linkify":"HTTP Transport","nodes":[{"content":"HTTP Transport","pos":[0,14]}]},{"content":"The bindings that use the HTTP transport (<ph id=\"ph1\">&lt;xref:System.ServiceModel.WSHttpBinding&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.BasicHttpBinding&gt;</ph>) support several authentication schemes, as explained in <bpt id=\"p1\">[</bpt>Understanding HTTP Authentication<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/understanding-http-authentication.md)</ept>.","pos":[4582,4891],"source":"The bindings that use the HTTP transport (<xref:System.ServiceModel.WSHttpBinding> and <xref:System.ServiceModel.BasicHttpBinding>) support several authentication schemes, as explained in [Understanding HTTP Authentication](../../../../docs/framework/wcf/feature-details/understanding-http-authentication.md)."},{"content":"The impersonation level supported depends on the authentication scheme.","pos":[4892,4963]},{"content":"The following items are used with the HTTP transport:","pos":[4964,5017]},{"pos":[5027,5087],"content":"The <ph id=\"ph1\">`Anonymous`</ph> authentication scheme ignores impersonation.","source":"The `Anonymous` authentication scheme ignores impersonation."},{"content":"The <ph id=\"ph1\">`Basic`</ph> authentication scheme supports only the <ph id=\"ph2\">`Delegate`</ph> level.","pos":[5097,5166],"source":"The `Basic` authentication scheme supports only the `Delegate` level."},{"content":"All lower impersonation levels are upgraded.","pos":[5167,5211]},{"pos":[5221,5310],"content":"The <ph id=\"ph1\">`Digest`</ph> authentication scheme supports only the <ph id=\"ph2\">`Impersonate`</ph> and <ph id=\"ph3\">`Delegate`</ph> levels.","source":"The `Digest` authentication scheme supports only the `Impersonate` and `Delegate` levels."},{"pos":[5320,5461],"content":"The <ph id=\"ph1\">`NTLM`</ph> authentication scheme, selectable either directly or through negotiation, supports only the <ph id=\"ph2\">`Delegate`</ph> level on the local machine.","source":"The `NTLM` authentication scheme, selectable either directly or through negotiation, supports only the `Delegate` level on the local machine."},{"content":"The Kerberos authentication scheme, which can only be selected through negotiation, can be used with any supported impersonation level.","pos":[5471,5606]},{"pos":[5613,5759],"content":"For more information about the HTTP transport, see <bpt id=\"p1\">[</bpt>Choosing a Transport<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md)</ept>.","source":"For more information about the HTTP transport, see [Choosing a Transport](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md)."},{"pos":[5768,5776],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[5780,5899],"content":"<bpt id=\"p1\">[</bpt>Delegation and Impersonation<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)</ept>","source":"[Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)"},{"pos":[5902,5989],"content":"<bpt id=\"p1\">[</bpt>Authorization<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/authorization-in-wcf.md)</ept>","source":"[Authorization](../../../../docs/framework/wcf/feature-details/authorization-in-wcf.md)"},{"pos":[5992,6111],"content":"<bpt id=\"p1\">[</bpt>How to: Impersonate a Client on a Service<ept id=\"p1\">](../../../../docs/framework/wcf/how-to-impersonate-a-client-on-a-service.md)</ept>","source":"[How to: Impersonate a Client on a Service](../../../../docs/framework/wcf/how-to-impersonate-a-client-on-a-service.md)"},{"pos":[6114,6234],"content":"<bpt id=\"p1\">[</bpt>Understanding HTTP Authentication<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/understanding-http-authentication.md)</ept>","source":"[Understanding HTTP Authentication](../../../../docs/framework/wcf/feature-details/understanding-http-authentication.md)"}]}