{"content":"---\ntitle: \"Suppress Transaction Scope | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 49fb6dd4-30d4-4067-925c-c5de44c8c740\ncaps.latest.revision: 8\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Suppress Transaction Scope\nThe sample demonstrates how to author a custom `SuppressTransactionScope` activity to suppress the ambient run-time transaction, if present.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Scenario\\Transactions\\SuppressTransactionScope`  \n  \n## Sample Details  \n The custom activity is useful to prevent a transaction from being flowed out to another service if transaction flow is undesirable for the particular scenario. The workflow runtime has built-in support for suppressing the ambient transaction in the <xref:System.Activities.NativeActivity> class, but to use this support it is necessary to author a custom <xref:System.Activities.NativeActivity> such as the one in this sample.  \n  \n The scenario consists of three parts. First, a <xref:System.Activities.Statements.TransactionScope> creates a run-time transaction that becomes ambient. This is verified by a custom activity that prints the local and distributed identifiers of the transaction. The transaction is then flowed to a remote service before beginning the second part. During the second part, the workflow enters a `SuppressTransactionScope` and again repeats the process of printing the transaction identifiers and flowing the transaction. However, the custom activity does not find an ambient transaction and the message flowed to the service does not contain the transaction. As a result, the service creates a transaction, which means the distributed ID printed on the client and service do not match. The final part occurs after the `SuppressTransactionScope` exits and the run-time transaction again becomes ambient as verified by another message to the service with a distributed identifier that matches the identifier of the first message.  \n  \n The activity itself derives from <xref:System.Activities.NativeActivity> because it must schedule a child activity and add an execution property. The `SuppressTransactionScope` has a <xref:System.Activities.Variable> of type <xref:System.Activities.RuntimeTransactionHandle>, which must be used rather than an instance field of type <xref:System.Activities.RuntimeTransactionHandle> because the handle must be initialized. The `Variable<RuntimeTransactionHandle>` is added to the activity’s metadata as an implementation variable because it is only used internally.  \n  \n When the activity is executed it first checks to see whether a body was specified and if so, sets the `SuppressTransaction` property on the <xref:System.Activities.RuntimeTransactionHandle>. Once the property is set, it is added to the execution properties and becomes ambient. This means that any activity that is a child of the `SuppressTransactionScope` is able to see the property and therefore enforces the suppression of the run-time transaction and causes a nested <xref:System.Activities.Statements.TransactionScope> to throw an exception. Once the handle is added to the execution properties the body is scheduled to run.  \n  \n#### To use this sample  \n  \n1.  Open the SuppressTransactionScope.sln solution in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].  \n  \n2.  To build the solution, press CTRL+SHIFT+B or select **Build Solution** from the **Build** menu.  \n  \n3.  Once the build has succeeded, right-click the solution and select **Set Startup Projects**. From the dialog, select **Multiple Startup Projects** and ensure the action for both projects is **Start**.  \n  \n4.  Press F5 or select **Start Debugging** from the **Debug** menu. Alternatively, you can press CTRL+F5 or select **Start Without Debugging** from the **Debug** menu to run without debugging.  \n  \n    > [!NOTE]\n    >  The server must be running prior to starting the client. The output from the console window that hosts the service indicates when it has started.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Scenario\\Transactions\\SuppressTransactionScope`  \n  \n## See Also","nodes":[{"pos":[12,55],"content":"Suppress Transaction Scope | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Suppress Transaction Scope | Microsoft Docs","pos":[0,43]}]},{"pos":[320,346],"content":"Suppress Transaction Scope","linkify":"Suppress Transaction Scope","nodes":[{"content":"Suppress Transaction Scope","pos":[0,26]}]},{"pos":[347,487],"content":"The sample demonstrates how to author a custom <ph id=\"ph1\">`SuppressTransactionScope`</ph> activity to suppress the ambient run-time transaction, if present.","source":"The sample demonstrates how to author a custom `SuppressTransactionScope` activity to suppress the ambient run-time transaction, if present."},{"pos":[495,627],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[681,1007],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[1008,1058]},{"pos":[1160,1174],"content":"Sample Details","linkify":"Sample Details","nodes":[{"content":"Sample Details","pos":[0,14]}]},{"content":"The custom activity is useful to prevent a transaction from being flowed out to another service if transaction flow is undesirable for the particular scenario.","pos":[1178,1337]},{"content":"The workflow runtime has built-in support for suppressing the ambient transaction in the <ph id=\"ph1\">&lt;xref:System.Activities.NativeActivity&gt;</ph> class, but to use this support it is necessary to author a custom <ph id=\"ph2\">&lt;xref:System.Activities.NativeActivity&gt;</ph> such as the one in this sample.","pos":[1338,1604],"source":" The workflow runtime has built-in support for suppressing the ambient transaction in the <xref:System.Activities.NativeActivity> class, but to use this support it is necessary to author a custom <xref:System.Activities.NativeActivity> such as the one in this sample."},{"content":"The scenario consists of three parts.","pos":[1611,1648]},{"content":"First, a <ph id=\"ph1\">&lt;xref:System.Activities.Statements.TransactionScope&gt;</ph> creates a run-time transaction that becomes ambient.","pos":[1649,1763],"source":" First, a <xref:System.Activities.Statements.TransactionScope> creates a run-time transaction that becomes ambient."},{"content":"This is verified by a custom activity that prints the local and distributed identifiers of the transaction.","pos":[1764,1871]},{"content":"The transaction is then flowed to a remote service before beginning the second part.","pos":[1872,1956]},{"content":"During the second part, the workflow enters a <ph id=\"ph1\">`SuppressTransactionScope`</ph> and again repeats the process of printing the transaction identifiers and flowing the transaction.","pos":[1957,2128],"source":" During the second part, the workflow enters a `SuppressTransactionScope` and again repeats the process of printing the transaction identifiers and flowing the transaction."},{"content":"However, the custom activity does not find an ambient transaction and the message flowed to the service does not contain the transaction.","pos":[2129,2266]},{"content":"As a result, the service creates a transaction, which means the distributed ID printed on the client and service do not match.","pos":[2267,2393]},{"content":"The final part occurs after the <ph id=\"ph1\">`SuppressTransactionScope`</ph> exits and the run-time transaction again becomes ambient as verified by another message to the service with a distributed identifier that matches the identifier of the first message.","pos":[2394,2635],"source":" The final part occurs after the `SuppressTransactionScope` exits and the run-time transaction again becomes ambient as verified by another message to the service with a distributed identifier that matches the identifier of the first message."},{"content":"The activity itself derives from <ph id=\"ph1\">&lt;xref:System.Activities.NativeActivity&gt;</ph> because it must schedule a child activity and add an execution property.","pos":[2642,2787],"source":"The activity itself derives from <xref:System.Activities.NativeActivity> because it must schedule a child activity and add an execution property."},{"content":"The <ph id=\"ph1\">`SuppressTransactionScope`</ph> has a <ph id=\"ph2\">&lt;xref:System.Activities.Variable&gt;</ph> of type <ph id=\"ph3\">&lt;xref:System.Activities.RuntimeTransactionHandle&gt;</ph>, which must be used rather than an instance field of type <ph id=\"ph4\">&lt;xref:System.Activities.RuntimeTransactionHandle&gt;</ph> because the handle must be initialized.","pos":[2788,3064],"source":" The `SuppressTransactionScope` has a <xref:System.Activities.Variable> of type <xref:System.Activities.RuntimeTransactionHandle>, which must be used rather than an instance field of type <xref:System.Activities.RuntimeTransactionHandle> because the handle must be initialized."},{"content":"The <ph id=\"ph1\">`Variable&lt;RuntimeTransactionHandle&gt;`</ph> is added to the activity’s metadata as an implementation variable because it is only used internally.","pos":[3065,3207],"source":" The `Variable<RuntimeTransactionHandle>` is added to the activity’s metadata as an implementation variable because it is only used internally."},{"content":"When the activity is executed it first checks to see whether a body was specified and if so, sets the <ph id=\"ph1\">`SuppressTransaction`</ph> property on the <ph id=\"ph2\">&lt;xref:System.Activities.RuntimeTransactionHandle&gt;</ph>.","pos":[3214,3404],"source":"When the activity is executed it first checks to see whether a body was specified and if so, sets the `SuppressTransaction` property on the <xref:System.Activities.RuntimeTransactionHandle>."},{"content":"Once the property is set, it is added to the execution properties and becomes ambient.","pos":[3405,3491]},{"content":"This means that any activity that is a child of the <ph id=\"ph1\">`SuppressTransactionScope`</ph> is able to see the property and therefore enforces the suppression of the run-time transaction and causes a nested <ph id=\"ph2\">&lt;xref:System.Activities.Statements.TransactionScope&gt;</ph> to throw an exception.","pos":[3492,3761],"source":" This means that any activity that is a child of the `SuppressTransactionScope` is able to see the property and therefore enforces the suppression of the run-time transaction and causes a nested <xref:System.Activities.Statements.TransactionScope> to throw an exception."},{"content":"Once the handle is added to the execution properties the body is scheduled to run.","pos":[3762,3844]},{"pos":[3855,3873],"content":"To use this sample","linkify":"To use this sample","nodes":[{"content":"To use this sample","pos":[0,18]}]},{"pos":[3883,3987],"content":"Open the SuppressTransactionScope.sln solution in <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph>.","source":"Open the SuppressTransactionScope.sln solution in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]."},{"pos":[3997,4092],"content":"To build the solution, press CTRL+SHIFT+B or select <bpt id=\"p1\">**</bpt>Build Solution<ept id=\"p1\">**</ept> from the <bpt id=\"p2\">**</bpt>Build<ept id=\"p2\">**</ept> menu.","source":"To build the solution, press CTRL+SHIFT+B or select **Build Solution** from the **Build** menu."},{"content":"Once the build has succeeded, right-click the solution and select <bpt id=\"p1\">**</bpt>Set Startup Projects<ept id=\"p1\">**</ept>.","pos":[4102,4193],"source":"Once the build has succeeded, right-click the solution and select **Set Startup Projects**."},{"content":"From the dialog, select <bpt id=\"p1\">**</bpt>Multiple Startup Projects<ept id=\"p1\">**</ept> and ensure the action for both projects is <bpt id=\"p2\">**</bpt>Start<ept id=\"p2\">**</ept>.","pos":[4194,4301],"source":" From the dialog, select **Multiple Startup Projects** and ensure the action for both projects is **Start**."},{"content":"Press F5 or select <bpt id=\"p1\">**</bpt>Start Debugging<ept id=\"p1\">**</ept> from the <bpt id=\"p2\">**</bpt>Debug<ept id=\"p2\">**</ept> menu.","pos":[4311,4374],"source":"Press F5 or select **Start Debugging** from the **Debug** menu."},{"content":"Alternatively, you can press CTRL+F5 or select <bpt id=\"p1\">**</bpt>Start Without Debugging<ept id=\"p1\">**</ept> from the <bpt id=\"p2\">**</bpt>Debug<ept id=\"p2\">**</ept> menu to run without debugging.","pos":[4375,4499],"source":" Alternatively, you can press CTRL+F5 or select **Start Without Debugging** from the **Debug** menu to run without debugging."},{"pos":[4511,4671],"content":"[!NOTE]\nThe server must be running prior to starting the client. The output from the console window that hosts the service indicates when it has started.","leadings":["","    >  "],"nodes":[{"content":"The server must be running prior to starting the client. The output from the console window that hosts the service indicates when it has started.","pos":[8,153],"nodes":[{"content":"The server must be running prior to starting the client.","pos":[0,56]},{"content":"The output from the console window that hosts the service indicates when it has started.","pos":[57,145]}]}]},{"pos":[4679,4811],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[4865,5191],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[5192,5242]},{"pos":[5344,5352],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]}]}