{"content":"---\ntitle: \"Retrieving the Paragraphs and Their Styles (Visual Basic) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"2015-07-20\"\nms.prod: .net\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-visual-basic\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\nms.assetid: d9ed2238-d38e-4ad4-b88b-db7859df9bde\ncaps.latest.revision: 3\nauthor: dotnet-bot\nms.author: dotnetcontent\n\n---\n# Retrieving the Paragraphs and Their Styles (Visual Basic)\nIn this example, we write a query that retrieves the paragraph nodes from a WordprocessingML document. It also identifies the style of each paragraph.  \n  \n This query builds on the query in the previous example, [Finding the Default Paragraph Style (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/finding-the-default-paragraph-style.md), which retrieves the default style from the list of styles. This information is required so that the query can identify the style of paragraphs that do not have a style explicitly set. Paragraph styles are set through the `w:pPr` element; if a paragraph does not contain this element, it is formatted with the default style.  \n  \n This topic explains the significance of some pieces of the query, then shows the query as part of a complete, working example.  \n  \n## Example  \n The source of the query to retrieve all the paragraphs in a document and their styles is as follows:  \n  \n```vb  \nxDoc.Root.<w:body>...<w:p>  \n```  \n  \n This expression is similar to the source of the query in the previous example, [Finding the Default Paragraph Style (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/finding-the-default-paragraph-style.md). The main difference is that it uses the <xref:System.Xml.Linq.XContainer.Descendants%2A> axis instead of the <xref:System.Xml.Linq.XContainer.Elements%2A> axis. The query uses the <xref:System.Xml.Linq.XContainer.Descendants%2A> axis because in documents that have sections, the paragraphs will not be the direct children of the body element; rather, the paragraphs will be two levels down in the hierarchy. By using the <xref:System.Xml.Linq.XContainer.Descendants%2A> axis, the code will work of whether or not the document uses sections.  \n  \n## Example  \n The query uses a `Let` clause to determine the element that contains the style node. If there is no element, then `styleNode` is set to `Nothing`:  \n  \n```vb  \nLet styleNode As XElement = para.<w:pPr>.<w:pStyle>.FirstOrDefault()  \n```  \n  \n The `Let` clause first uses the <xref:System.Xml.Linq.XContainer.Elements%2A> axis to find all elements named `pPr`, then uses the <xref:System.Xml.Linq.Extensions.Elements%2A> extension method to find all child elements named `pStyle`, and finally uses the <xref:System.Linq.Enumerable.FirstOrDefault%2A> standard query operator to convert the collection to a singleton. If the collection is empty, `styleNode` is set to `Nothing`. This is a useful idiom to look for the `pStyle` descendant node. Note that if the `pPr` child node does not exist, the code does nor fail by throwing an exception; instead, `styleNode` is set to `Nothing`, which is the desired behavior of this `Let` clause.  \n  \n The query projects a collection of an anonymous type with two members, `StyleName` and `ParagraphNode`.  \n  \n## Example  \n This example processes a WordprocessingML document, retrieving the paragraph nodes from a WordprocessingML document. It also identifies the style of each paragraph. This example builds on the previous examples in this tutorial. The new query is called out in comments in the code below.  \n  \n You can find instructions for creating the source document for this example in [Creating the Source Office Open XML Document (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/creating-the-source-office-open-xml-document.md).  \n  \n This example uses classes found in the WindowsBase assembly. It uses types in the <xref:System.IO.Packaging?displayProperty=fullName> namespace.  \n  \n```vb  \nImports <xmlns:w=\"http://schemas.openxmlformats.org/wordprocessingml/2006/main\">  \n  \nModule Module1  \n    Private Function GetStyleOfParagraph(ByVal styleNode As XElement, ByVal defaultStyle As String) As String  \n        If (styleNode Is Nothing) Then  \n            Return defaultStyle  \n        Else  \n            Return styleNode.@w:val  \n        End If  \n    End Function  \n  \n    Sub Main()  \n        Dim fileName = \"SampleDoc.docx\"  \n  \n        Dim documentRelationshipType = \"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument\"  \n        Dim stylesRelationshipType = \"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles\"  \n        Dim wordmlNamespace = \"http://schemas.openxmlformats.org/wordprocessingml/2006/main\"  \n  \n        Dim xDoc As XDocument = Nothing  \n        Dim styleDoc As XDocument = Nothing  \n        Using wdPackage As Package = Package.Open(fileName, FileMode.Open, FileAccess.Read)  \n            Dim docPackageRelationship As PackageRelationship = wdPackage.GetRelationshipsByType(documentRelationshipType).FirstOrDefault()  \n            If (docPackageRelationship IsNot Nothing) Then  \n                Dim documentUri As Uri = PackUriHelper.ResolvePartUri(New Uri(\"/\", UriKind.Relative), docPackageRelationship.TargetUri)  \n                Dim documentPart As PackagePart = wdPackage.GetPart(documentUri)  \n  \n                '  Load the document XML in the part into an XDocument instance.  \n                xDoc = XDocument.Load(XmlReader.Create(documentPart.GetStream()))  \n  \n                '  Find the styles part. There will only be one.  \n                Dim styleRelation As PackageRelationship = documentPart.GetRelationshipsByType(stylesRelationshipType).FirstOrDefault()  \n                If (styleRelation IsNot Nothing) Then  \n                    Dim styleUri As Uri = PackUriHelper.ResolvePartUri(documentUri, styleRelation.TargetUri)  \n                    Dim stylePart As PackagePart = wdPackage.GetPart(styleUri)  \n  \n                    '  Load the style XML in the part into an XDocument instance.  \n                    styleDoc = XDocument.Load(XmlReader.Create(stylePart.GetStream()))  \n                End If  \n            End If  \n        End Using  \n  \n        Dim defaultStyle As String = _  \n            ( _  \n                From style In styleDoc.Root.<w:style> _  \n                Where style.@w:type = \"paragraph\" And _  \n                      style.@w:default = \"1\" _  \n                Select style _  \n            ).First().@w:styleId  \n  \n        ' Following is the new query that finds all paragraphs in the  \n        ' document and their styles.  \n        Dim paragraphs = _  \n            From para In xDoc.Root.<w:body>...<w:p> _  \n        Let styleNode As XElement = para.<w:pPr>.<w:pStyle>.FirstOrDefault() _  \n        Select New With { _  \n            .ParagraphNode = para, _  \n            .StyleName = GetStyleOfParagraph(styleNode, defaultStyle) _  \n        }  \n  \n        For Each p In paragraphs  \n            Console.WriteLine(\"StyleName:{0}\", p.StyleName)  \n        Next  \n  \n    End Sub  \nEnd Module  \n```  \n  \n This example produces the following output when applied to the document described in [Creating the Source Office Open XML Document (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/creating-the-source-office-open-xml-document.md).  \n  \n```  \nStyleName:Heading1  \nStyleName:Normal  \nStyleName:Normal  \nStyleName:Normal  \nStyleName:Code  \nStyleName:Code  \nStyleName:Code  \nStyleName:Code  \nStyleName:Code  \nStyleName:Code  \nStyleName:Code  \nStyleName:Normal  \nStyleName:Normal  \nStyleName:Normal  \nStyleName:Code  \n```  \n  \n## Next Steps  \n In the next topic, [Retrieving the Text of the Paragraphs (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/retrieving-the-text-of-the-paragraphs.md), you'll create a query to retrieve the text of paragraphs.  \n  \n## See Also  \n [Tutorial: Manipulating Content in a WordprocessingML Document (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/tutorial-manipulating-content-in-a-wordprocessingml-document.md)","nodes":[{"pos":[12,86],"content":"Retrieving the Paragraphs and Their Styles (Visual Basic) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Retrieving the Paragraphs and Their Styles (Visual Basic) | Microsoft Docs","pos":[0,74]}]},{"pos":[393,450],"content":"Retrieving the Paragraphs and Their Styles (Visual Basic)","linkify":"Retrieving the Paragraphs and Their Styles (Visual Basic)","nodes":[{"content":"Retrieving the Paragraphs and Their Styles (Visual Basic)","pos":[0,57]}]},{"content":"In this example, we write a query that retrieves the paragraph nodes from a WordprocessingML document.","pos":[451,553]},{"content":"It also identifies the style of each paragraph.","pos":[554,601]},{"content":"This query builds on the query in the previous example, <bpt id=\"p1\">[</bpt>Finding the Default Paragraph Style (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/linq/finding-the-default-paragraph-style.md)</ept>, which retrieves the default style from the list of styles.","pos":[608,873],"source":"This query builds on the query in the previous example, [Finding the Default Paragraph Style (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/finding-the-default-paragraph-style.md), which retrieves the default style from the list of styles."},{"content":"This information is required so that the query can identify the style of paragraphs that do not have a style explicitly set.","pos":[874,998]},{"content":"Paragraph styles are set through the <ph id=\"ph1\">`w:pPr`</ph> element; if a paragraph does not contain this element, it is formatted with the default style.","pos":[999,1138],"source":" Paragraph styles are set through the `w:pPr` element; if a paragraph does not contain this element, it is formatted with the default style."},{"content":"This topic explains the significance of some pieces of the query, then shows the query as part of a complete, working example.","pos":[1145,1271]},{"pos":[1280,1287],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The source of the query to retrieve all the paragraphs in a document and their styles is as follows:","pos":[1291,1391]},{"content":"This expression is similar to the source of the query in the previous example, <bpt id=\"p1\">[</bpt>Finding the Default Paragraph Style (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/linq/finding-the-default-paragraph-style.md)</ept>.","pos":[1444,1673],"source":"This expression is similar to the source of the query in the previous example, [Finding the Default Paragraph Style (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/finding-the-default-paragraph-style.md)."},{"content":"The main difference is that it uses the <ph id=\"ph1\">&lt;xref:System.Xml.Linq.XContainer.Descendants%2A&gt;</ph> axis instead of the <ph id=\"ph2\">&lt;xref:System.Xml.Linq.XContainer.Elements%2A&gt;</ph> axis.","pos":[1674,1834],"source":" The main difference is that it uses the <xref:System.Xml.Linq.XContainer.Descendants%2A> axis instead of the <xref:System.Xml.Linq.XContainer.Elements%2A> axis."},{"content":"The query uses the <ph id=\"ph1\">&lt;xref:System.Xml.Linq.XContainer.Descendants%2A&gt;</ph> axis because in documents that have sections, the paragraphs will not be the direct children of the body element; rather, the paragraphs will be two levels down in the hierarchy.","pos":[1835,2081],"source":" The query uses the <xref:System.Xml.Linq.XContainer.Descendants%2A> axis because in documents that have sections, the paragraphs will not be the direct children of the body element; rather, the paragraphs will be two levels down in the hierarchy."},{"content":"By using the <ph id=\"ph1\">&lt;xref:System.Xml.Linq.XContainer.Descendants%2A&gt;</ph> axis, the code will work of whether or not the document uses sections.","pos":[2082,2214],"source":" By using the <xref:System.Xml.Linq.XContainer.Descendants%2A> axis, the code will work of whether or not the document uses sections."},{"pos":[2223,2230],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The query uses a <ph id=\"ph1\">`Let`</ph> clause to determine the element that contains the style node.","pos":[2234,2318],"source":"The query uses a `Let` clause to determine the element that contains the style node."},{"content":"If there is no element, then <ph id=\"ph1\">`styleNode`</ph> is set to <ph id=\"ph2\">`Nothing`</ph>:","pos":[2319,2380],"source":" If there is no element, then `styleNode` is set to `Nothing`:"},{"content":"The <ph id=\"ph1\">`Let`</ph> clause first uses the <ph id=\"ph2\">&lt;xref:System.Xml.Linq.XContainer.Elements%2A&gt;</ph> axis to find all elements named <ph id=\"ph3\">`pPr`</ph>, then uses the <ph id=\"ph4\">&lt;xref:System.Xml.Linq.Extensions.Elements%2A&gt;</ph> extension method to find all child elements named <ph id=\"ph5\">`pStyle`</ph>, and finally uses the <ph id=\"ph6\">&lt;xref:System.Linq.Enumerable.FirstOrDefault%2A&gt;</ph> standard query operator to convert the collection to a singleton.","pos":[2475,2846],"source":"The `Let` clause first uses the <xref:System.Xml.Linq.XContainer.Elements%2A> axis to find all elements named `pPr`, then uses the <xref:System.Xml.Linq.Extensions.Elements%2A> extension method to find all child elements named `pStyle`, and finally uses the <xref:System.Linq.Enumerable.FirstOrDefault%2A> standard query operator to convert the collection to a singleton."},{"content":"If the collection is empty, <ph id=\"ph1\">`styleNode`</ph> is set to <ph id=\"ph2\">`Nothing`</ph>.","pos":[2847,2907],"source":" If the collection is empty, `styleNode` is set to `Nothing`."},{"content":"This is a useful idiom to look for the <ph id=\"ph1\">`pStyle`</ph> descendant node.","pos":[2908,2972],"source":" This is a useful idiom to look for the `pStyle` descendant node."},{"content":"Note that if the <ph id=\"ph1\">`pPr`</ph> child node does not exist, the code does nor fail by throwing an exception; instead, <ph id=\"ph2\">`styleNode`</ph> is set to <ph id=\"ph3\">`Nothing`</ph>, which is the desired behavior of this <ph id=\"ph4\">`Let`</ph> clause.","pos":[2973,3165],"source":" Note that if the `pPr` child node does not exist, the code does nor fail by throwing an exception; instead, `styleNode` is set to `Nothing`, which is the desired behavior of this `Let` clause."},{"pos":[3172,3275],"content":"The query projects a collection of an anonymous type with two members, <ph id=\"ph1\">`StyleName`</ph> and <ph id=\"ph2\">`ParagraphNode`</ph>.","source":"The query projects a collection of an anonymous type with two members, `StyleName` and `ParagraphNode`."},{"pos":[3284,3291],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"This example processes a WordprocessingML document, retrieving the paragraph nodes from a WordprocessingML document.","pos":[3295,3411]},{"content":"It also identifies the style of each paragraph.","pos":[3412,3459]},{"content":"This example builds on the previous examples in this tutorial.","pos":[3460,3522]},{"content":"The new query is called out in comments in the code below.","pos":[3523,3581]},{"pos":[3588,3835],"content":"You can find instructions for creating the source document for this example in <bpt id=\"p1\">[</bpt>Creating the Source Office Open XML Document (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/linq/creating-the-source-office-open-xml-document.md)</ept>.","source":"You can find instructions for creating the source document for this example in [Creating the Source Office Open XML Document (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/creating-the-source-office-open-xml-document.md)."},{"content":"This example uses classes found in the WindowsBase assembly.","pos":[3842,3902]},{"content":"It uses types in the <ph id=\"ph1\">&lt;xref:System.IO.Packaging?displayProperty=fullName&gt;</ph> namespace.","pos":[3903,3986],"source":" It uses types in the <xref:System.IO.Packaging?displayProperty=fullName> namespace."},{"pos":[7143,7396],"content":"This example produces the following output when applied to the document described in <bpt id=\"p1\">[</bpt>Creating the Source Office Open XML Document (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/linq/creating-the-source-office-open-xml-document.md)</ept>.","source":"This example produces the following output when applied to the document described in [Creating the Source Office Open XML Document (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/creating-the-source-office-open-xml-document.md)."},{"pos":[7691,7701],"content":"Next Steps","linkify":"Next Steps","nodes":[{"content":"Next Steps","pos":[0,10]}]},{"pos":[7705,7936],"content":"In the next topic, <bpt id=\"p1\">[</bpt>Retrieving the Text of the Paragraphs (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/linq/retrieving-the-text-of-the-paragraphs.md)</ept>, you'll create a query to retrieve the text of paragraphs.","source":"In the next topic, [Retrieving the Text of the Paragraphs (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/retrieving-the-text-of-the-paragraphs.md), you'll create a query to retrieve the text of paragraphs."},{"pos":[7945,7953],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[7957,8157],"content":"<bpt id=\"p1\">[</bpt>Tutorial: Manipulating Content in a WordprocessingML Document (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/linq/tutorial-manipulating-content-in-a-wordprocessingml-document.md)</ept>","source":"[Tutorial: Manipulating Content in a WordprocessingML Document (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/tutorial-manipulating-content-in-a-wordprocessingml-document.md)"}]}