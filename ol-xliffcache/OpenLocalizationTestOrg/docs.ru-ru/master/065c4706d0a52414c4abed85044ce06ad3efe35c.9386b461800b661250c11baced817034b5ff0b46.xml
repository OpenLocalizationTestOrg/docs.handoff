{"content":"---\ntitle: \"TCP Activation\"\nms.date: \"03/30/2017\"\nms.assetid: bf8c215c-0228-4f4f-85c2-e33794ec09a7\n---\n\n# TCP Activation\n\nThis sample demonstrates hosting a service that uses Windows Process Activation Services (WAS) to activate a service that communicates over the net.tcp protocol. This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md).\n\n> [!NOTE]\n> The setup procedure and build instructions for this sample are located at the end of this topic.\n\n> [!IMPORTANT]\n> The samples may already be installed on your computer. Check for the following (default) directory before continuing.\n>\n> `<InstallDrive>:\\WF_WCF_Samples`\n>\n> If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.\n>\n> `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Services\\Hosting\\WASHost\\TCPActivation`\n\nThe sample consists of a client console program (.exe) and a service library (.dll) hosted in a worker process activated by WAS. Client activity is visible in the console window.\n\nThe service implements a contract that defines a request-reply communication pattern. The contract is defined by the `ICalculator` interface, which exposes math operations (Add, Subtract, Multiply, and Divide), as shown in the following sample code:\n\n```csharp\n[ServiceContract(Namespace=\"http://Microsoft.ServiceModel.Samples\")]\npublic interface ICalculator\n{\n    [OperationContract]\n    double Add(double n1, double n2);\n    [OperationContract]\n    double Subtract(double n1, double n2);\n    [OperationContract]\n    double Multiply(double n1, double n2);\n    [OperationContract]\n    double Divide(double n1, double n2);\n}\n```\n\nThe service implementation calculates and returns the appropriate result:\n\n```csharp\n// Service class that implements the service contract.\npublic class CalculatorService : ICalculator\n{\n    public double Add(double n1, double n2)\n    {\n        return n1 + n2;\n    }\n    public double Subtract(double n1, double n2)\n    {\n        return n1 - n2;\n    }\n    public double Multiply(double n1, double n2)\n    {\n        return n1 * n2;\n    }\n    public double Divide(double n1, double n2)\n    {\n        return n1 / n2;\n    }\n}\n```\n\nThe sample uses a variant of the net.tcp binding with TCP port sharing enabled and security turned off. If you want to use a secured TCP binding, change the server's security mode to the desired setting and re-run Svcutil.exe on the client to generate an update client configuration file.\n\nThe following sample shows the configuration for the service:\n\n```xml\n<system.serviceModel>\n\n    <services>\n      <service name=\"Microsoft.ServiceModel.Samples.CalculatorService\"\n               behaviorConfiguration=\"CalculatorServiceBehavior\">\n        <!-- This endpoint is exposed at the base address provided by host: net.tcp://localhost/servicemodelsamples/service.svc  -->\n        <endpoint binding=\"netTcpBinding\" bindingConfiguration=\"PortSharingBinding\"\n          contract=\"Microsoft.ServiceModel.Samples.ICalculator\" />\n        <!-- the mex endpoint is exposed at net.tcp://localhost/servicemodelsamples/service.svc/mex -->\n        <endpoint address=\"mex\"\n                  binding=\"mexTcpBinding\"\n                  contract=\"IMetadataExchange\" />\n      </service>\n    </services>\n    <bindings>\n      <netTcpBinding>\n        <binding name=\"PortSharingBinding\" portSharingEnabled=\"true\">\n          <security mode=\"None\" />\n        </binding>\n      </netTcpBinding>\n    </bindings>\n\n    <!--For debugging purposes set the includeExceptionDetailInFaults attribute to true-->\n    <behaviors>\n      <serviceBehaviors>\n        <behavior name=\"CalculatorServiceBehavior\">\n          <serviceMetadata />\n          <serviceDebug includeExceptionDetailInFaults=\"False\" />\n        </behavior>\n      </serviceBehaviors>\n    </behaviors>\n\n  </system.serviceModel>\n```\n\nThe client's endpoint is configured as shown in the following sample code:\n\n```xml\n<system.serviceModel>\n    <bindings>\n        <netTcpBinding>\n          <binding name=\"NetTcpBinding_ICalculator\">\n            <security mode=\"None\"/>\n          </binding>\n        </netTcpBinding>\n    </bindings>\n    <client>\n        <endpoint address=\"net.tcp://localhost/servicemodelsamples/service.svc\"\n            binding=\"netTcpBinding\" bindingConfiguration=\"NetTcpBinding_ICalculator\"\n            contract=\"Microsoft.ServiceModel.Samples.ICalculator\" name=\"NetTcpBinding_ICalculator\" />\n    </client>\n</system.serviceModel>\n```\n\nWhen you run the sample, the operation requests and responses are displayed in the client console window. Press ENTER in the client window to shut down the client.\n\n```console\nAdd(100,15.99) = 115.99\nSubtract(145,76.54) = 68.46\nMultiply(9,81.25) = 731.25\nDivide(22,7) = 3.14285714285714\n\nPress <ENTER> to terminate client.\n```\n\n### To set up, build, and run the sample\n\n1. Ensure that [!INCLUDE[iisver](../../../../includes/iisver-md.md)] is installed. [!INCLUDE[iisver](../../../../includes/iisver-md.md)] is required for WAS activation.\n\n2. Be sure you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).\n\n    In addition, you must install the WCF non-HTTP activation components:\n\n    1. From the **Start** menu, choose **Control Panel**.\n\n    2. Select **Programs and Features**.\n\n    3. Click **Turn Windows Components on or Off**.\n\n    4. Expand the **Microsoft .NET Framework 3.0** node and check the **Windows Communication Foundation Non-HTTP Activation** feature.\n\n3. Configure WAS to support TCP activation.\n\n    As a convenience, the following two steps are implemented in a batch file called AddNetTcpSiteBinding.cmd located in the sample directory.\n\n    1. To support net.tcp activation, the default Web site must first be bound to a net.tcp port. This can be done using Appcmd.exe, which is installed with the Internet Information Services 7.0 (IIS) management toolset. From an administrator-level command prompt, run the following command:\n\n        ```console\n        %windir%\\system32\\inetsrv\\appcmd.exe set site \"Default Web Site\" -+bindings.[protocol='net.tcp',bindingInformation='808:*']\n        ```\n\n        > [!TIP]\n        > This command is a single line of text. This command adds a net.tcp site binding to the default Web site listening on TCP port 808 with any hostname.\n\n    2. Although all applications within a site share a common net.tcp binding, each application can enable net.tcp support individually. To enable net.tcp for the /servicemodelsamples application, run the following command from an administrator-level command prompt:\n\n        ```console\n        %windir%\\system32\\inetsrv\\appcmd.exe set app\n        \"Default Web Site/servicemodelsamples\" /enabledProtocols:http,net.tcp\n        ```\n\n        > [!NOTE]\n        > This command is a single line of text. This command enables the /servicemodelsamples application to be accessed using both `http://localhost/servicemodelsamples` and `net.tcp://localhost/servicemodelsamples`.\n\n4. To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).\n\n5. To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).\n\n    Remove the net.tcp site binding you added for this sample.\n\n    As a convenience, the following two steps are implemented in a batch file called RemoveNetTcpSiteBinding.cmd located in the sample directory.\n\n    1. Remove net.tcp from the list of enabled protocols by running the following command from an administrator-level command prompt:\n\n        ```console\n        %windir%\\system32\\inetsrv\\appcmd.exe set app\n        \"Default Web Site/servicemodelsamples\" /enabledProtocols:http\n        ```\n\n        > [!NOTE]\n        > This command must be entered as a single line of text.\n\n    2. Remove the net.tcp site binding by running the following command from an administrator-level command prompt:\n\n        ```console\n        %windir%\\system32\\inetsrv\\appcmd.exe set site \"Default Web Site\"\n        --bindings.[protocol='net.tcp',bindingInformation='808:*']\n        ```\n\n        > [!NOTE]\n        > This command must be typed in as a single line of text.\n\n## See also\n\n- [AppFabric Hosting and Persistence Samples](https://go.microsoft.com/fwlink/?LinkId=193961)\n","nodes":[{"pos":[4,98],"embed":true,"restype":"x-metadata","content":"title: \"TCP Activation\"\nms.date: \"03/30/2017\"\nms.assetid: bf8c215c-0228-4f4f-85c2-e33794ec09a7","nodes":[{"content":"TCP Activation","nodes":[{"pos":[0,14],"content":"TCP Activation","nodes":[{"content":"TCP Activation","pos":[0,14]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[106,120],"content":"TCP Activation","linkify":"TCP Activation","nodes":[{"content":"TCP Activation","pos":[0,14]}]},{"content":"This sample demonstrates hosting a service that uses Windows Process Activation Services (WAS) to activate a service that communicates over the net.tcp protocol.","pos":[122,283]},{"content":"This sample is based on the <bpt id=\"p1\">[</bpt>Getting Started<ept id=\"p1\">](../../../../docs/framework/wcf/samples/getting-started-sample.md)</ept>.","pos":[284,396],"source":" This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md)."},{"pos":[400,506],"content":"[!NOTE]\nThe setup procedure and build instructions for this sample are located at the end of this topic.","leadings":["","> "],"nodes":[{"content":"The setup procedure and build instructions for this sample are located at the end of this topic.","pos":[8,104]}]},{"pos":[510,642],"content":"[!IMPORTANT]\nThe samples may already be installed on your computer. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your computer. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your computer.","pos":[0,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[684,994],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[995,1045]},{"content":"The sample consists of a client console program (.exe) and a service library (.dll) hosted in a worker process activated by WAS.","pos":[1133,1261]},{"content":"Client activity is visible in the console window.","pos":[1262,1311]},{"content":"The service implements a contract that defines a request-reply communication pattern.","pos":[1313,1398]},{"content":"The contract is defined by the <ph id=\"ph1\">`ICalculator`</ph> interface, which exposes math operations (Add, Subtract, Multiply, and Divide), as shown in the following sample code:","pos":[1399,1562],"source":" The contract is defined by the `ICalculator` interface, which exposes math operations (Add, Subtract, Multiply, and Divide), as shown in the following sample code:"},{"content":"The service implementation calculates and returns the appropriate result:","pos":[1942,2015]},{"content":"The sample uses a variant of the net.tcp binding with TCP port sharing enabled and security turned off.","pos":[2469,2572]},{"content":"If you want to use a secured TCP binding, change the server's security mode to the desired setting and re-run Svcutil.exe on the client to generate an update client configuration file.","pos":[2573,2757]},{"content":"The following sample shows the configuration for the service:","pos":[2759,2820]},{"content":"The client's endpoint is configured as shown in the following sample code:","pos":[4124,4198]},{"content":"When you run the sample, the operation requests and responses are displayed in the client console window.","pos":[4741,4846]},{"content":"Press ENTER in the client window to shut down the client.","pos":[4847,4904]},{"pos":[5073,5109],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"content":"Ensure that <ph id=\"ph1\">[!INCLUDE[iisver](../../../../includes/iisver-md.md)]</ph> is installed.","pos":[5114,5193],"source":"Ensure that [!INCLUDE[iisver](../../../../includes/iisver-md.md)] is installed."},{"content":"<ph id=\"ph1\">[!INCLUDE[iisver](../../../../includes/iisver-md.md)]</ph> is required for WAS activation.","pos":[5194,5279],"source":"[!INCLUDE[iisver](../../../../includes/iisver-md.md)] is required for WAS activation."},{"pos":[5284,5479],"content":"Be sure you have performed the <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Be sure you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"content":"In addition, you must install the WCF non-HTTP activation components:","pos":[5485,5554]},{"pos":[5563,5613],"content":"From the <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept> menu, choose <bpt id=\"p2\">**</bpt>Control Panel<ept id=\"p2\">**</ept>.","source":"From the **Start** menu, choose **Control Panel**."},{"pos":[5622,5655],"content":"Select <bpt id=\"p1\">**</bpt>Programs and Features<ept id=\"p1\">**</ept>.","source":"Select **Programs and Features**."},{"pos":[5664,5708],"content":"Click <bpt id=\"p1\">**</bpt>Turn Windows Components on or Off<ept id=\"p1\">**</ept>.","source":"Click **Turn Windows Components on or Off**."},{"pos":[5717,5845],"content":"Expand the <bpt id=\"p1\">**</bpt>Microsoft .NET Framework 3.0<ept id=\"p1\">**</ept> node and check the <bpt id=\"p2\">**</bpt>Windows Communication Foundation Non-HTTP Activation<ept id=\"p2\">**</ept> feature.","source":"Expand the **Microsoft .NET Framework 3.0** node and check the **Windows Communication Foundation Non-HTTP Activation** feature."},{"content":"Configure WAS to support TCP activation.","pos":[5850,5890]},{"content":"As a convenience, the following two steps are implemented in a batch file called AddNetTcpSiteBinding.cmd located in the sample directory.","pos":[5896,6034]},{"content":"To support net.tcp activation, the default Web site must first be bound to a net.tcp port.","pos":[6043,6133]},{"content":"This can be done using Appcmd.exe, which is installed with the Internet Information Services 7.0 (IIS) management toolset.","pos":[6134,6256]},{"content":"From an administrator-level command prompt, run the following command:","pos":[6257,6327]},{"pos":[6503,6668],"content":"[!TIP]\nThis command is a single line of text. This command adds a net.tcp site binding to the default Web site listening on TCP port 808 with any hostname.","leadings":["","        > "],"nodes":[{"content":"This command is a single line of text. This command adds a net.tcp site binding to the default Web site listening on TCP port 808 with any hostname.","pos":[7,155],"nodes":[{"content":"This command is a single line of text.","pos":[0,38]},{"content":"This command adds a net.tcp site binding to the default Web site listening on TCP port 808 with any hostname.","pos":[39,148]}]}]},{"content":"Although all applications within a site share a common net.tcp binding, each application can enable net.tcp support individually.","pos":[6677,6806]},{"content":"To enable net.tcp for the /servicemodelsamples application, run the following command from an administrator-level command prompt:","pos":[6807,6936]},{"pos":[7111,7337],"content":"[!NOTE]\nThis command is a single line of text. This command enables the /servicemodelsamples application to be accessed using both `http://localhost/servicemodelsamples` and `net.tcp://localhost/servicemodelsamples`.","leadings":["","        > "],"nodes":[{"content":"This command is a single line of text. This command enables the /servicemodelsamples application to be accessed using both `http://localhost/servicemodelsamples` and `net.tcp://localhost/servicemodelsamples`.","pos":[8,216],"nodes":[{"content":"This command is a single line of text.","pos":[0,38]},{"content":"This command enables the /servicemodelsamples application to be accessed using both <ph id=\"ph1\">`http://localhost/servicemodelsamples`</ph> and <ph id=\"ph2\">`net.tcp://localhost/servicemodelsamples`</ph>.","pos":[39,208],"source":" This command enables the /servicemodelsamples application to be accessed using both `http://localhost/servicemodelsamples` and `net.tcp://localhost/servicemodelsamples`."}]}]},{"pos":[7342,7551],"content":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"pos":[7556,7765],"content":"To run the sample in a single- or cross-computer configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"content":"Remove the net.tcp site binding you added for this sample.","pos":[7771,7829]},{"content":"As a convenience, the following two steps are implemented in a batch file called RemoveNetTcpSiteBinding.cmd located in the sample directory.","pos":[7835,7976]},{"content":"Remove net.tcp from the list of enabled protocols by running the following command from an administrator-level command prompt:","pos":[7985,8111]},{"pos":[8278,8350],"content":"[!NOTE]\nThis command must be entered as a single line of text.","leadings":["","        > "],"nodes":[{"content":"This command must be entered as a single line of text.","pos":[8,62]}]},{"content":"Remove the net.tcp site binding by running the following command from an administrator-level command prompt:","pos":[8359,8467]},{"pos":[8651,8724],"content":"[!NOTE]\nThis command must be typed in as a single line of text.","leadings":["","        > "],"nodes":[{"content":"This command must be typed in as a single line of text.","pos":[8,63]}]},{"pos":[8729,8737],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[8741,8832],"content":"<bpt id=\"p1\">[</bpt>AppFabric Hosting and Persistence Samples<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=193961)</ept>","source":"[AppFabric Hosting and Persistence Samples](https://go.microsoft.com/fwlink/?LinkId=193961)"}]}