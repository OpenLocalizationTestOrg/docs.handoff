{"content":"---\ntitle: \"How to: Set a Max Clock Skew | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"MaxClockSkew property\"\n  - \"WCF, custom bindings\"\nms.assetid: 491d1705-eb29-43c2-a44c-c0cf996f74eb\ncaps.latest.revision: 13\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# How to: Set a Max Clock Skew\nTime-critical functions can be derailed if the clock settings on two computers are different. To mitigate this possibility, you can set the `MaxClockSkew` property to a <xref:System.TimeSpan>. This property is available on two classes:  \n  \n <xref:System.ServiceModel.Channels.LocalClientSecuritySettings>  \n  \n <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings>  \n  \n> [!IMPORTANT]\n>  Important   For a secure conversation, changes to the `MaxClockSkew` property  must be made when the service or client is bootstrapped. To do this, you must set the property on the <xref:System.ServiceModel.Channels.SecurityBindingElement>returned by the <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters.BootstrapSecurityBindingElement%2A>.  \n  \n To change the property on one of the system-provided bindings, you must find the security binding element in the collection of bindings and set the `MaxClockSkew` property to a new value. Two classes derive from the <xref:System.ServiceModel.Channels.SecurityBindingElement>: <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> and <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement>. When retrieving the security binding from the collection, you must cast to one of these types in order to correctly set the `MaxClockSkew` property. The following example uses a <xref:System.ServiceModel.WSHttpBinding>, which uses the <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement>. For a list that specifies which type of security binding to use in each system-provided binding, see [System-Provided Bindings](../../../../docs/framework/wcf/system-provided-bindings.md).  \n  \n### To create a custom binding with a new clock skew value in code  \n  \n1.  > [!WARNING]\n    >  Note   Add references to the following namespaces in your code: <xref:System.ServiceModel.Channels>, <xref:System.ServiceModel.Description>, <xref:System.Security.Permissions>, and <xref:System.ServiceModel.Security.Tokens>.  \n  \n     Create an instance of a <xref:System.ServiceModel.WSHttpBinding> class and set its security mode to <xref:System.ServiceModel.SecurityMode>.  \n  \n2.  Create a new instance of the <xref:System.ServiceModel.Channels.BindingElementCollection> class by calling the <xref:System.ServiceModel.WSHttpBinding.CreateBindingElements%2A> method.  \n  \n3.  Use the <xref:System.ServiceModel.Channels.BindingElementCollection.Find%2A> method of the <xref:System.ServiceModel.Channels.BindingElementCollection> class to find the security binding element.  \n  \n4.  When using the <xref:System.ServiceModel.Channels.BindingElementCollection.Find%2A> method, cast to the actual type. The example below casts to the <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> type.  \n  \n5.  Set the <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxClockSkew%2A> property on the security binding element.  \n  \n6.  Create a <xref:System.ServiceModel.ServiceHost> with an appropriate service type and base address.  \n  \n7.  Use the <xref:System.ServiceModel.ServiceHost.AddServiceEndpoint%2A> method to add an endpoint and include the <xref:System.ServiceModel.Channels.CustomBinding>.  \n  \n     [!code-csharp[c_MaxClockSkew#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_maxclockskew/cs/source.cs#1)]\n     [!code-vb[c_MaxClockSkew#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_maxclockskew/vb/source.vb#1)]  \n  \n### To set the MaxClockSkew in configuration  \n  \n1.  Create a [\\<customBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/custombinding.md) in the [\\<bindings>](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md) element section.  \n  \n2.  Create a [\\<binding>](../../../../docs/framework/misc/binding.md) element and set the `name` attribute to an appropriate value. The following example sets it to `MaxClockSkewBinding`.  \n  \n3.  Add an encoding element. The example below adds a [\\<textMessageEncoding>](../../../../docs/framework/configure-apps/file-schema/wcf/textmessageencoding.md).  \n  \n4.  Add a [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-of-custombinding.md) element and set the `authenticationMode` attribute to an appropriate setting. The following example set the attribute to `Kerberos` to specify that the service use Windows authentication.  \n  \n5.  Add a [\\<localServiceSettings>](../../../../docs/framework/configure-apps/file-schema/wcf/localservicesettings-element.md) and set the `maxClockSkew` attribute to a value in the form of `\"##:##:##\"`. The following example sets it to 7 minutes. Optionally, add a [\\<localServiceSettings>](../../../../docs/framework/configure-apps/file-schema/wcf/localservicesettings-element.md) and set the `maxClockSkew` attribute to an appropriate setting.  \n  \n6.  Add a transport element. The following example uses an [\\<httpTransport>](../../../../docs/framework/configure-apps/file-schema/wcf/httptransport.md).  \n  \n7.  For a secure conversation, the security settings must occur at the bootstrap in the [\\<secureConversationBootstrap>](../../../../docs/framework/configure-apps/file-schema/wcf/secureconversationbootstrap.md) element.  \n  \n    ```  \n  \n    <bindings>  \n      <customBinding>  \n        <binding name=\"MaxClockSkewBinding\">  \n            <textMessageEncoding />  \n            <security authenticationMode=\"Kerberos\">  \n               <localClientSettings maxClockSkew=\"00:07:00\" />  \n               <localServiceSettings maxClockSkew=\"00:07:00\" />  \n               <secureConversationBootstrap>  \n                  <localClientSettings maxClockSkew=\"00:30:00\" />  \n                  <localServiceSettings maxClockSkew=\"00:30:00\" />  \n               </secureConversationBootstrap>  \n            </security>  \n            <httpTransport />  \n        </binding>  \n      </customBinding>  \n    </bindings>  \n  \n    ```  \n  \n## See Also  \n <xref:System.ServiceModel.Channels.LocalClientSecuritySettings>   \n <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings>   \n <xref:System.ServiceModel.Channels.CustomBinding>   \n [How to: Create a Custom Binding Using the SecurityBindingElement](../../../../docs/framework/wcf/feature-details/how-to-create-a-custom-binding-using-the-securitybindingelement.md)","nodes":[{"pos":[4,426],"embed":true,"restype":"x-metadata","content":"title: \"How to: Set a Max Clock Skew | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"MaxClockSkew property\"\n  - \"WCF, custom bindings\"\nms.assetid: 491d1705-eb29-43c2-a44c-c0cf996f74eb\ncaps.latest.revision: 13\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"","nodes":[{"content":"How to: Set a Max Clock Skew | Microsoft Docs","nodes":[{"pos":[0,45],"content":"How to: Set a Max Clock Skew | Microsoft Docs","nodes":[{"content":"How to: Set a Max Clock Skew | Microsoft Docs","pos":[0,45]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[433,461],"content":"How to: Set a Max Clock Skew","linkify":"How to: Set a Max Clock Skew","nodes":[{"content":"How to: Set a Max Clock Skew","pos":[0,28]}]},{"content":"Time-critical functions can be derailed if the clock settings on two computers are different.","pos":[462,555]},{"content":"To mitigate this possibility, you can set the <ph id=\"ph1\">`MaxClockSkew`</ph> property to a <ph id=\"ph2\">&lt;xref:System.TimeSpan&gt;</ph>.","pos":[556,654],"source":" To mitigate this possibility, you can set the `MaxClockSkew` property to a <xref:System.TimeSpan>."},{"content":"This property is available on two classes:","pos":[655,697]},{"pos":[846,1237],"content":"[!IMPORTANT]\n Important   For a secure conversation, changes to the `MaxClockSkew` property  must be made when the service or client is bootstrapped. To do this, you must set the property on the <xref:System.ServiceModel.Channels.SecurityBindingElement>returned by the <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters.BootstrapSecurityBindingElement%2A>.","leadings":["","> "],"nodes":[{"content":"Important   For a secure conversation, changes to the `MaxClockSkew` property  must be made when the service or client is bootstrapped. To do this, you must set the property on the <xref:System.ServiceModel.Channels.SecurityBindingElement>returned by the <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters.BootstrapSecurityBindingElement%2A>.","pos":[14,389],"nodes":[{"content":"Important   For a secure conversation, changes to the <ph id=\"ph1\">`MaxClockSkew`</ph> property  must be made when the service or client is bootstrapped.","pos":[0,135],"source":"Important   For a secure conversation, changes to the `MaxClockSkew` property  must be made when the service or client is bootstrapped."},{"content":"To do this, you must set the property on the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.SecurityBindingElement&gt;</ph>returned by the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters.BootstrapSecurityBindingElement%2A&gt;</ph>.","pos":[136,375],"source":" To do this, you must set the property on the <xref:System.ServiceModel.Channels.SecurityBindingElement>returned by the <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters.BootstrapSecurityBindingElement%2A>."}]}]},{"content":"To change the property on one of the system-provided bindings, you must find the security binding element in the collection of bindings and set the <ph id=\"ph1\">`MaxClockSkew`</ph> property to a new value.","pos":[1244,1431],"source":"To change the property on one of the system-provided bindings, you must find the security binding element in the collection of bindings and set the `MaxClockSkew` property to a new value."},{"content":"Two classes derive from the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.SecurityBindingElement&gt;</ph>: <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement&gt;</ph>.","pos":[1432,1661],"source":" Two classes derive from the <xref:System.ServiceModel.Channels.SecurityBindingElement>: <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> and <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement>."},{"content":"When retrieving the security binding from the collection, you must cast to one of these types in order to correctly set the <ph id=\"ph1\">`MaxClockSkew`</ph> property.","pos":[1662,1810],"source":" When retrieving the security binding from the collection, you must cast to one of these types in order to correctly set the `MaxClockSkew` property."},{"content":"The following example uses a <ph id=\"ph1\">&lt;xref:System.ServiceModel.WSHttpBinding&gt;</ph>, which uses the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement&gt;</ph>.","pos":[1811,1965],"source":" The following example uses a <xref:System.ServiceModel.WSHttpBinding>, which uses the <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement>."},{"content":"For a list that specifies which type of security binding to use in each system-provided binding, see <bpt id=\"p1\">[</bpt>System-Provided Bindings<ept id=\"p1\">](../../../../docs/framework/wcf/system-provided-bindings.md)</ept>.","pos":[1966,2154],"source":" For a list that specifies which type of security binding to use in each system-provided binding, see [System-Provided Bindings](../../../../docs/framework/wcf/system-provided-bindings.md)."},{"pos":[2164,2226],"content":"To create a custom binding with a new clock skew value in code","linkify":"To create a custom binding with a new clock skew value in code","nodes":[{"content":"To create a custom binding with a new clock skew value in code","pos":[0,62]}]},{"pos":[2238,2480],"content":"[!WARNING]\nNote   Add references to the following namespaces in your code: <xref:System.ServiceModel.Channels>, <xref:System.ServiceModel.Description>, <xref:System.Security.Permissions>, and <xref:System.ServiceModel.Security.Tokens>.","leadings":["","    >  "],"nodes":[{"content":"Note   Add references to the following namespaces in your code: <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description&gt;</ph>, <ph id=\"ph3\">&lt;xref:System.Security.Permissions&gt;</ph>, and <ph id=\"ph4\">&lt;xref:System.ServiceModel.Security.Tokens&gt;</ph>.","pos":[11,235],"source":"Note   Add references to the following namespaces in your code: <xref:System.ServiceModel.Channels>, <xref:System.ServiceModel.Description>, <xref:System.Security.Permissions>, and <xref:System.ServiceModel.Security.Tokens>."}]},{"pos":[2491,2631],"content":"Create an instance of a <ph id=\"ph1\">&lt;xref:System.ServiceModel.WSHttpBinding&gt;</ph> class and set its security mode to <ph id=\"ph2\">&lt;xref:System.ServiceModel.SecurityMode&gt;</ph>.","source":"Create an instance of a <xref:System.ServiceModel.WSHttpBinding> class and set its security mode to <xref:System.ServiceModel.SecurityMode>."},{"pos":[2641,2825],"content":"Create a new instance of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.BindingElementCollection&gt;</ph> class by calling the <ph id=\"ph2\">&lt;xref:System.ServiceModel.WSHttpBinding.CreateBindingElements%2A&gt;</ph> method.","source":"Create a new instance of the <xref:System.ServiceModel.Channels.BindingElementCollection> class by calling the <xref:System.ServiceModel.WSHttpBinding.CreateBindingElements%2A> method."},{"pos":[2835,3030],"content":"Use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.BindingElementCollection.Find%2A&gt;</ph> method of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.BindingElementCollection&gt;</ph> class to find the security binding element.","source":"Use the <xref:System.ServiceModel.Channels.BindingElementCollection.Find%2A> method of the <xref:System.ServiceModel.Channels.BindingElementCollection> class to find the security binding element."},{"content":"When using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.BindingElementCollection.Find%2A&gt;</ph> method, cast to the actual type.","pos":[3040,3156],"source":"When using the <xref:System.ServiceModel.Channels.BindingElementCollection.Find%2A> method, cast to the actual type."},{"content":"The example below casts to the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement&gt;</ph> type.","pos":[3157,3261],"source":" The example below casts to the <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> type."},{"pos":[3271,3401],"content":"Set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxClockSkew%2A&gt;</ph> property on the security binding element.","source":"Set the <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxClockSkew%2A> property on the security binding element."},{"pos":[3411,3509],"content":"Create a <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> with an appropriate service type and base address.","source":"Create a <xref:System.ServiceModel.ServiceHost> with an appropriate service type and base address."},{"pos":[3519,3680],"content":"Use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost.AddServiceEndpoint%2A&gt;</ph> method to add an endpoint and include the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.CustomBinding&gt;</ph>.","source":"Use the <xref:System.ServiceModel.ServiceHost.AddServiceEndpoint%2A> method to add an endpoint and include the <xref:System.ServiceModel.Channels.CustomBinding>."},{"pos":[3691,3928],"content":"[!code-csharp[c_MaxClockSkew#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_maxclockskew/cs/source.cs#1)]\n [!code-vb[c_MaxClockSkew#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_maxclockskew/vb/source.vb#1)]","leadings":["","    "],"nodes":[]},{"pos":[3938,3978],"content":"To set the MaxClockSkew in configuration","linkify":"To set the MaxClockSkew in configuration","nodes":[{"content":"To set the MaxClockSkew in configuration","pos":[0,40]}]},{"pos":[3988,4200],"content":"Create a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>customBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/custombinding.md)</ept> in the <bpt id=\"p2\">[</bpt><ph id=\"ph2\">\\&lt;</ph>bindings&gt;<ept id=\"p2\">](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md)</ept> element section.","source":"Create a [\\<customBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/custombinding.md) in the [\\<bindings>](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md) element section."},{"content":"Create a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>binding&gt;<ept id=\"p1\">](../../../../docs/framework/misc/binding.md)</ept> element and set the <ph id=\"ph2\">`name`</ph> attribute to an appropriate value.","pos":[4210,4337],"source":"Create a [\\<binding>](../../../../docs/framework/misc/binding.md) element and set the `name` attribute to an appropriate value."},{"content":"The following example sets it to <ph id=\"ph1\">`MaxClockSkewBinding`</ph>.","pos":[4338,4393],"source":" The following example sets it to `MaxClockSkewBinding`."},{"content":"Add an encoding element.","pos":[4403,4427]},{"content":"The example below adds a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>textMessageEncoding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/textmessageencoding.md)</ept>.","pos":[4428,4560],"source":" The example below adds a [\\<textMessageEncoding>](../../../../docs/framework/configure-apps/file-schema/wcf/textmessageencoding.md)."},{"content":"Add a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>security&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/security-of-custombinding.md)</ept> element and set the <ph id=\"ph2\">`authenticationMode`</ph> attribute to an appropriate setting.","pos":[4570,4755],"source":"Add a [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-of-custombinding.md) element and set the `authenticationMode` attribute to an appropriate setting."},{"content":"The following example set the attribute to <ph id=\"ph1\">`Kerberos`</ph> to specify that the service use Windows authentication.","pos":[4756,4865],"source":" The following example set the attribute to `Kerberos` to specify that the service use Windows authentication."},{"content":"Add a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>localServiceSettings&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/localservicesettings-element.md)</ept> and set the <ph id=\"ph2\">`maxClockSkew`</ph> attribute to a value in the form of <ph id=\"ph3\">`\"##:##:##\"`</ph>.","pos":[4875,5074],"source":"Add a [\\<localServiceSettings>](../../../../docs/framework/configure-apps/file-schema/wcf/localservicesettings-element.md) and set the `maxClockSkew` attribute to a value in the form of `\"##:##:##\"`."},{"content":"The following example sets it to 7 minutes.","pos":[5075,5118]},{"content":"Optionally, add a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>localServiceSettings&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/localservicesettings-element.md)</ept> and set the <ph id=\"ph2\">`maxClockSkew`</ph> attribute to an appropriate setting.","pos":[5119,5317],"source":" Optionally, add a [\\<localServiceSettings>](../../../../docs/framework/configure-apps/file-schema/wcf/localservicesettings-element.md) and set the `maxClockSkew` attribute to an appropriate setting."},{"content":"Add a transport element.","pos":[5327,5351]},{"content":"The following example uses an <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>httpTransport&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/httptransport.md)</ept>.","pos":[5352,5477],"source":" The following example uses an [\\<httpTransport>](../../../../docs/framework/configure-apps/file-schema/wcf/httptransport.md)."},{"pos":[5487,5702],"content":"For a secure conversation, the security settings must occur at the bootstrap in the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>secureConversationBootstrap&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/secureconversationbootstrap.md)</ept> element.","source":"For a secure conversation, the security settings must occur at the bootstrap in the [\\<secureConversationBootstrap>](../../../../docs/framework/configure-apps/file-schema/wcf/secureconversationbootstrap.md) element."},{"pos":[6406,6414],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>How to: Create a Custom Binding Using the SecurityBindingElement<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-custom-binding-using-the-securitybindingelement.md)</ept>","pos":[6609,6790],"source":"[How to: Create a Custom Binding Using the SecurityBindingElement](../../../../docs/framework/wcf/feature-details/how-to-create-a-custom-binding-using-the-securitybindingelement.md)"}]}