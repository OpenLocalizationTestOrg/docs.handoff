{"content":"---\ntitle: \"How To: Error Handling\"\nms.date: \"03/30/2017\"\nms.assetid: de566e39-9358-44ff-8244-780f6b799966\n---\n# How To: Error Handling\nThis topic outlines the basic steps required to create a routing configuration that uses error handling. In this example, messages are routed to a destination endpoint. If a message cannot be delivered due to a network or communications-related failure (<xref:System.ServiceModel.CommunicationException>), the message is resent to an alternate endpoint.  \n  \n> [!NOTE]\n>  To simulate a network failure, the destination endpoint used in this example contains an incorrect address. Messages routed to this endpoint fail as no service is listening on the specified address.  \n  \n> [!NOTE]\n>  While the example contained in this topic does not explicitly discuss time-out settings, you must take these into consideration when using error handling. When errors are encountered, there will be an additional delay encountered before the client receives a response. This is because the error is received at the Routing Service, which then attempts to send the message to a backup endpoint. If the time-out values associated with the primary and backup destination endpoints are large, the client could experience a long delay as the message fails over multiple endpoints in the backup list before being successfully sent.  \n>   \n>  Since the Routing Service could encounter a maximum delay equal to the sum of the time-out value for all endpoints associated with a filter, we recommend that you increase the expected time-out at the client accordingly.  \n  \n### Implement Error Handling  \n  \n1.  Create the basic Routing Service configuration by specifying the service endpoint exposed by the service. The following example defines a single service endpoint, which is used to receive messages. It also defines the client endpoints that are used to send messages; deadDestination and realDestination. The deadDestination endpoint contains an address that does not reference a running service and is used to simulate a network failure when sending messages to this endpoint.  \n  \n    ```xml  \n    <services>  \n      <service behaviorConfiguration=\"routingConfiguration\"  \n               name=\"System.ServiceModel.Routing.RoutingService\">  \n        <host>  \n          <baseAddresses>  \n            <add baseAddress=\"http://localhost/routingservice/\" />  \n          </baseAddresses>  \n        </host>  \n        <!-- Create the Routing Service endpoint -->  \n        <endpoint address=\"router\"  \n                  binding=\"basicHttpBinding\"  \n                  name=\"RoutingServiceEndpoint\"  \n                  contract=\"System.ServiceModel.Routing.IRequestReplyRouter\" />  \n      </service>  \n    </services>  \n  \n    <!-- Create the destination endpoints that we want to send to -->  \n    <client>  \n      <!-- Create a dummy endpoint that we know will be down -->  \n      <endpoint name=\"deadDestination\"   \n                address=\"net.tcp://localhost:9090/servicemodelsamples/fakeDestination\"  \n                binding=\"netTcpBinding\"  \n                contract=\"*\" />  \n  \n      <!-- Now create the real service endpoint -->  \n      <endpoint name=\"realDestination\"   \n                address=\"net.tcp://localhost:8080/servicemodelsamples/service\"  \n                binding=\"netTcpBinding\"   \n                contract=\"*\" />  \n    </client>  \n    ```  \n  \n2.  Define the filters used to route messages to the destination endpoints.  For this example, a MatchAll filter is used to match all messages received by the Routing Service.  \n  \n    ```xml  \n    <filters>  \n      <!-- Create a MatchAll filter which will catch all messages -->  \n      <filter name=\"MatchAllFilter1\" filterType=\"MatchAll\" />  \n    </filters>  \n    ```  \n  \n3.  Define the backup endpoint list, which contains the endpoints that a message is sent to in the event of a network or communications failure when sending to the primary destination endpoint. The following example defines a backup list that contains one endpoint; however, multiple endpoints can be specified in a backup list.  \n  \n     If the backup list contains multiple endpoints, when a network or communications failure occurs the Routing Service attempts to send the message to the first endpoint in the list. If a network or communications failure occurs when sending to this endpoint, the Routing Service attempts to send the message to the next endpoint contained in the list. The service continues sending the message to each endpoint in the backup endpoint list until the message is successfully sent, all backup endpoints return a network or communications-related error, or the message is sent and the endpoint returns a non-network, non-communications-related error.  \n  \n    ```xml  \n    <backupLists>          \n      <backupList name=\"backupEndpointList\">  \n          <add endpointName=\"realDestination\" />  \n      </backupList>  \n    </backupLists>  \n    ```  \n  \n4.  Define the filter table, which associates the filter with the deadDestination endpoint and the backup endpoint list.  The Routing Service first attempts to send the message to the destination endpoint associated with the filter. Since the deadDestination contains an address that does not refer to a running service, this results in a network error. The Routing Service then attempts to send the message to the endpoint specified in the backupEndpointlist.  \n  \n    ```xml  \n    <filterTables>  \n            <!-- Set up the Routing Service's Message Filter Table -->  \n            <filterTable name=\"filterTable1\">  \n                <!-- Add an entity that maps the MatchAllMessageFilter to the dead destination -->  \n                <!-- If that endpoint is down, tell the Routing Service to try the endpoints -->  \n                <!-- Listed in the backupEndpointList -->  \n                <add filterName=\"MatchAllFilter1\" endpointName=\"deadDestination\" backupList=\"backupEndpointList\"/>  \n            </filterTable>  \n          </filterTables>  \n    ```  \n  \n5.  To evaluate incoming messages against the filter contained in the filter table, you must associate the filter table with the service endpoints by using the routing behavior.  The following example demonstrates associating \"filterTable1\" with the service endpoints.  \n  \n    ```xml  \n    <behaviors>  \n      <serviceBehaviors>  \n        <!-- Set up the Routing Behavior -->  \n        <behavior name=\"routingConfiguration\">  \n          <routing filterTableName=\"filterTable1\" />  \n        </behavior>  \n      </serviceBehaviors>  \n    </behaviors>  \n    ```  \n  \n## Example  \n Following is a complete listing of the configuration file.  \n  \n```xml  \n<?xml version=\"1.0\" encoding=\"utf-8\" ?>  \n<!-- Copyright (c) Microsoft Corporation.  All Rights Reserved. -->  \n<configuration>  \n  <system.serviceModel>  \n    <services>  \n      <service behaviorConfiguration=\"routingConfiguration\"  \n               name=\"System.ServiceModel.Routing.RoutingService\">  \n        <host>  \n          <baseAddresses>  \n            <add baseAddress=\"http://localhost/routingservice/\" />  \n          </baseAddresses>  \n        </host>  \n        <!-- Create the Routing Service endpoint -->  \n        <endpoint address=\"router\"  \n                  binding=\"basicHttpBinding\"  \n                  name=\"RoutingServiceEndpoint\"  \n                  contract=\"System.ServiceModel.Routing.IRequestReplyRouter\" />  \n      </service>  \n    </services>  \n    <behaviors>  \n      <serviceBehaviors>  \n        <!-- Set up the Routing Behavior -->  \n        <behavior name=\"routingConfiguration\">  \n          <routing filterTableName=\"filterTable1\" />  \n        </behavior>  \n      </serviceBehaviors>  \n    </behaviors>  \n    <!-- Create the destination endpoints that we want to send to -->  \n    <client>  \n      <!-- Create a dummy endpoint that we know will be down -->  \n      <endpoint name=\"deadDestination\"   \n                address=\"net.tcp://localhost:9090/servicemodelsamples/fakeDestination\"  \n                binding=\"netTcpBinding\"  \n                contract=\"*\" />  \n  \n      <!-- Now create the real service endpoint -->  \n      <endpoint name=\"realDestination\"   \n                address=\"net.tcp://localhost:8080/servicemodelsamples/service\"  \n                binding=\"netTcpBinding\"   \n                contract=\"*\" />  \n    </client>  \n    <routing>  \n      <filters>  \n        <!-- Create a MatchAll filter which will catch all messages -->  \n        <filter name=\"MatchAllFilter1\" filterType=\"MatchAll\" />  \n      </filters>  \n      <filterTables>  \n        <!-- Set up the Routing Service's Message Filter Table -->  \n        <filterTable name=\"filterTable1\">  \n            <!-- Add an entrty that maps the MatchAllMessageFilter to the dead destination -->  \n            <!-- If that endpoint is down, tell the Routing Service to try the endpoints -->  \n            <!-- Listed in the backupEndpointList -->  \n            <add filterName=\"MatchAllFilter1\" endpointName=\"deadDestination\" backupList=\"backupEndpointList\"/>  \n        </filterTable>  \n      </filterTables>  \n      <!-- Create the backup endpoint list -->  \n      <backupLists>          \n        <backupList name=\"backupEndpointList\">  \n            <add endpointName=\"realDestination\" />  \n        </backupList>  \n      </backupLists>  \n      </routing>  \n  </system.serviceModel>  \n</configuration>  \n```\n","nodes":[{"pos":[4,106],"embed":true,"restype":"x-metadata","content":"title: \"How To: Error Handling\"\nms.date: \"03/30/2017\"\nms.assetid: de566e39-9358-44ff-8244-780f6b799966","nodes":[{"content":"How To: Error Handling","nodes":[{"pos":[0,22],"content":"How To: Error Handling","nodes":[{"content":"How To: Error Handling","pos":[0,22]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[113,135],"content":"How To: Error Handling","linkify":"How To: Error Handling","nodes":[{"content":"How To: Error Handling","pos":[0,22]}]},{"content":"This topic outlines the basic steps required to create a routing configuration that uses error handling.","pos":[136,240]},{"content":"In this example, messages are routed to a destination endpoint.","pos":[241,304]},{"content":"If a message cannot be delivered due to a network or communications-related failure (<ph id=\"ph1\">&lt;xref:System.ServiceModel.CommunicationException&gt;</ph>), the message is resent to an alternate endpoint.","pos":[305,489],"source":" If a message cannot be delivered due to a network or communications-related failure (<xref:System.ServiceModel.CommunicationException>), the message is resent to an alternate endpoint."},{"pos":[497,706],"content":"[!NOTE]\n To simulate a network failure, the destination endpoint used in this example contains an incorrect address. Messages routed to this endpoint fail as no service is listening on the specified address.","leadings":["","> "],"nodes":[{"content":"To simulate a network failure, the destination endpoint used in this example contains an incorrect address. Messages routed to this endpoint fail as no service is listening on the specified address.","pos":[9,207],"nodes":[{"content":"To simulate a network failure, the destination endpoint used in this example contains an incorrect address.","pos":[0,107]},{"content":"Messages routed to this endpoint fail as no service is listening on the specified address.","pos":[108,198]}]}]},{"pos":[714,1349],"content":"[!NOTE]\n While the example contained in this topic does not explicitly discuss time-out settings, you must take these into consideration when using error handling. When errors are encountered, there will be an additional delay encountered before the client receives a response. This is because the error is received at the Routing Service, which then attempts to send the message to a backup endpoint. If the time-out values associated with the primary and backup destination endpoints are large, the client could experience a long delay as the message fails over multiple endpoints in the backup list before being successfully sent.","leadings":["","> "],"nodes":[{"content":"While the example contained in this topic does not explicitly discuss time-out settings, you must take these into consideration when using error handling. When errors are encountered, there will be an additional delay encountered before the client receives a response. This is because the error is received at the Routing Service, which then attempts to send the message to a backup endpoint. If the time-out values associated with the primary and backup destination endpoints are large, the client could experience a long delay as the message fails over multiple endpoints in the backup list before being successfully sent.","pos":[9,633],"nodes":[{"content":"While the example contained in this topic does not explicitly discuss time-out settings, you must take these into consideration when using error handling.","pos":[0,154]},{"content":"When errors are encountered, there will be an additional delay encountered before the client receives a response.","pos":[155,268]},{"content":"This is because the error is received at the Routing Service, which then attempts to send the message to a backup endpoint.","pos":[269,392]},{"content":"If the time-out values associated with the primary and backup destination endpoints are large, the client could experience a long delay as the message fails over multiple endpoints in the backup list before being successfully sent.","pos":[393,624]}]}]},{"content":"Since the Routing Service could encounter a maximum delay equal to the sum of the time-out value for all endpoints associated with a filter, we recommend that you increase the expected time-out at the client accordingly.","pos":[1360,1580]},{"pos":[1590,1614],"content":"Implement Error Handling","linkify":"Implement Error Handling","nodes":[{"content":"Implement Error Handling","pos":[0,24]}]},{"content":"Create the basic Routing Service configuration by specifying the service endpoint exposed by the service.","pos":[1624,1729]},{"content":"The following example defines a single service endpoint, which is used to receive messages.","pos":[1730,1821]},{"content":"It also defines the client endpoints that are used to send messages; deadDestination and realDestination.","pos":[1822,1927]},{"content":"The deadDestination endpoint contains an address that does not reference a running service and is used to simulate a network failure when sending messages to this endpoint.","pos":[1928,2100]},{"content":"Define the filters used to route messages to the destination endpoints.","pos":[3389,3460]},{"content":"For this example, a MatchAll filter is used to match all messages received by the Routing Service.","pos":[3462,3560]},{"content":"Define the backup endpoint list, which contains the endpoints that a message is sent to in the event of a network or communications failure when sending to the primary destination endpoint.","pos":[3765,3954]},{"content":"The following example defines a backup list that contains one endpoint; however, multiple endpoints can be specified in a backup list.","pos":[3955,4089]},{"content":"If the backup list contains multiple endpoints, when a network or communications failure occurs the Routing Service attempts to send the message to the first endpoint in the list.","pos":[4100,4279]},{"content":"If a network or communications failure occurs when sending to this endpoint, the Routing Service attempts to send the message to the next endpoint contained in the list.","pos":[4280,4449]},{"content":"The service continues sending the message to each endpoint in the backup endpoint list until the message is successfully sent, all backup endpoints return a network or communications-related error, or the message is sent and the endpoint returns a non-network, non-communications-related error.","pos":[4450,4744]},{"content":"Define the filter table, which associates the filter with the deadDestination endpoint and the backup endpoint list.","pos":[4949,5065]},{"content":"The Routing Service first attempts to send the message to the destination endpoint associated with the filter.","pos":[5067,5177]},{"content":"Since the deadDestination contains an address that does not refer to a running service, this results in a network error.","pos":[5178,5298]},{"content":"The Routing Service then attempts to send the message to the endpoint specified in the backupEndpointlist.","pos":[5299,5405]},{"content":"To evaluate incoming messages against the filter contained in the filter table, you must associate the filter table with the service endpoints by using the routing behavior.","pos":[6017,6190]},{"content":"The following example demonstrates associating \"filterTable1\" with the service endpoints.","pos":[6192,6281]},{"pos":[6581,6588],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"Following is a complete listing of the configuration file.","pos":[6592,6650]}]}