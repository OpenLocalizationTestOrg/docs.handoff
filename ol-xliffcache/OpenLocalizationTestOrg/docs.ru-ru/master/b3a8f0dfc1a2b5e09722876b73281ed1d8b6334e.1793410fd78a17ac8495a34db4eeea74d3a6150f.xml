{"content":"---\ntitle: \"Secure coding guidelines for .NET\"\nms.date: \"06/28/2018\"\nhelpviewer_keywords: \n  - \"managed wrapper to native code implementation\"\n  - \"secure coding\"\n  - \"reusable components\"\n  - \"library code that exposes protected resources\"\n  - \"code, security\"\n  - \"code security\"\n  - \"secure coding, options\"\n  - \"components [.NET], security\"\n  - \"code security, options\"\n  - \"security-neutral code\"\n  - \"security [.NET], coding guidelines\"\nms.assetid: 4f882d94-262b-4494-b0a6-ba9ba1f5f177\nauthor: \"mairaw\"\nms.author: \"mairaw\"\n---\n# Secure coding guidelines\n\nEvidence-based security and code access security provide very powerful, explicit mechanisms to implement security. Most application code can simply use the infrastructure implemented by .NET. In some cases, additional application-specific security is required, built either by extending the security system or by using new ad hoc methods.\n\nUsing .NET enforced permissions and other enforcement in your code, you should erect barriers to prevent malicious code from accessing information that you don't want it to have or performing other undesirable actions. Additionally, you must strike a balance between security and usability in all the expected scenarios using trusted code.\n\nThis overview describes the different ways code can be designed to work with the security system.\n\n## Securing resource access\n\nWhen designing and writing your code, you need to protect and limit the access that code has to resources, especially when using or invoking code of unknown origin. So, keep in mind the following techniques to ensure your code is secure:\n\n- Do not use Code Access Security (CAS).\n\n- Do not use partial trusted code.\n\n- Do not use the [AllowPartiallyTrustedCaller](xref:System.Security.AllowPartiallyTrustedCallersAttribute) attribute (APTCA).\n\n- Do not use .NET Remoting.\n\n- Do not use Distributed Component Object Model (DCOM).\n\n- Do not use binary formatters.\n\nCode Access Security and Security-Transparent Code are not supported as a security boundary with partially trusted code. We advise against loading and executing code of unknown origins without putting alternative security measures in place. The alternative security measures are:\n\n- Virtualization\n\n- AppContainers\n\n- Operating system (OS) users and permissions\n\n- Hyper-V containers\n\n## Security-neutral code\n\nSecurity-neutral code does nothing explicit with the security system. It runs with whatever permissions it receives. Although applications that fail to catch security exceptions associated with protected operations (such as using files, networking, and so on) can result in an unhandled exception, security-neutral code still takes advantage of the security technologies in .NET.\n\nA security-neutral library has special characteristics that you should understand. Suppose your library provides API elements that use files or call unmanaged code. If your code doesn't have the corresponding permission, it won't run as described. However, even if the code has the permission, any application code that calls it must have the same permission in order to work. If the calling code doesn't have the right permission, a <xref:System.Security.SecurityException> appears as a result of the code access security stack walk.\n\n## Application code that isn't a reusable component\n\nIf your code is part of an application that won't be called by other code, security is simple and special coding might not be required. However, remember that malicious code can call your code. While code access security might stop malicious code from accessing resources, such code could still read values of your fields or properties that might contain sensitive information.\n\nAdditionally, if your code accepts user input from the Internet or other unreliable sources, you must be careful about malicious input.\n\n## Managed wrapper to native code implementation\n\nTypically in this scenario, some useful functionality is implemented in native code that you want to make available to managed code. Managed wrappers are easy to write using either platform invoke or COM interop. However, if you do this, callers of your wrappers must have unmanaged code rights in order to succeed. Under default policy, this means that code downloaded from an intranet or the Internet won't work with the wrappers.\n\nInstead of giving unmanaged code rights to all applications that use these wrappers, it's better to give these rights only to the wrapper code. If the underlying functionality exposes no resources and the implementation is likewise safe, the wrapper only needs to assert its rights, which enables any code to call through it. When resources are involved, security coding should be the same as the library code case described in the next section. Because the wrapper is potentially exposing callers to these resources, careful verification of the safety of the native code is necessary and is the wrapper's responsibility.\n\n## Library code that exposes protected resources\n\nThe following approach is the most powerful and hence potentially dangerous (if done incorrectly) for security coding: your library serves as an interface for other code to access certain resources that aren't otherwise available, just as the .NET classes enforce permissions for the resources they use. Wherever you expose a resource, your code must first demand the permission appropriate to the resource (that is, it must perform a security check) and then typically assert its rights to perform the actual operation.\n\n## Related topics\n\n|Title|Description|\n|-----------|-----------------|\n|[Securing State Data](securing-state-data.md)|Describes how to protect private members.|\n|[Security and User Input](security-and-user-input.md)|Describes security concerns for applications that accept user input.|\n|[Security and Race Conditions](security-and-race-conditions.md)|Describes how to avoid race conditions in your code.|\n|[Security and On-the-Fly Code Generation](security-and-on-the-fly-code-generation.md)|Describes security concerns for applications that generate dynamic code.|\n|[Role-Based Security](role-based-security.md)|Describes .NET role-based security in detail and provides instructions for using it in your code.|\n","nodes":[{"pos":[4,528],"embed":true,"restype":"x-metadata","content":"title: \"Secure coding guidelines for .NET\"\nms.date: \"06/28/2018\"\nhelpviewer_keywords: \n  - \"managed wrapper to native code implementation\"\n  - \"secure coding\"\n  - \"reusable components\"\n  - \"library code that exposes protected resources\"\n  - \"code, security\"\n  - \"code security\"\n  - \"secure coding, options\"\n  - \"components [.NET], security\"\n  - \"code security, options\"\n  - \"security-neutral code\"\n  - \"security [.NET], coding guidelines\"\nms.assetid: 4f882d94-262b-4494-b0a6-ba9ba1f5f177\nauthor: \"mairaw\"\nms.author: \"mairaw\"","nodes":[{"content":"Secure coding guidelines for .NET","nodes":[{"pos":[0,33],"content":"Secure coding guidelines for .NET","nodes":[{"content":"Secure coding guidelines for .NET","pos":[0,33]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[535,559],"content":"Secure coding guidelines","linkify":"Secure coding guidelines","nodes":[{"content":"Secure coding guidelines","pos":[0,24]}]},{"content":"Evidence-based security and code access security provide very powerful, explicit mechanisms to implement security.","pos":[561,675]},{"content":"Most application code can simply use the infrastructure implemented by .NET.","pos":[676,752]},{"content":"In some cases, additional application-specific security is required, built either by extending the security system or by using new ad hoc methods.","pos":[753,899]},{"content":"Using .NET enforced permissions and other enforcement in your code, you should erect barriers to prevent malicious code from accessing information that you don't want it to have or performing other undesirable actions.","pos":[901,1119]},{"content":"Additionally, you must strike a balance between security and usability in all the expected scenarios using trusted code.","pos":[1120,1240]},{"content":"This overview describes the different ways code can be designed to work with the security system.","pos":[1242,1339]},{"pos":[1344,1368],"content":"Securing resource access","linkify":"Securing resource access","nodes":[{"content":"Securing resource access","pos":[0,24]}]},{"content":"When designing and writing your code, you need to protect and limit the access that code has to resources, especially when using or invoking code of unknown origin.","pos":[1370,1534]},{"content":"So, keep in mind the following techniques to ensure your code is secure:","pos":[1535,1607]},{"content":"Do not use Code Access Security (CAS).","pos":[1611,1649]},{"content":"Do not use partial trusted code.","pos":[1653,1685]},{"pos":[1689,1812],"content":"Do not use the <bpt id=\"p1\">[</bpt>AllowPartiallyTrustedCaller<ept id=\"p1\">](xref:System.Security.AllowPartiallyTrustedCallersAttribute)</ept> attribute (APTCA).","source":"Do not use the [AllowPartiallyTrustedCaller](xref:System.Security.AllowPartiallyTrustedCallersAttribute) attribute (APTCA)."},{"content":"Do not use .NET Remoting.","pos":[1816,1841]},{"content":"Do not use Distributed Component Object Model (DCOM).","pos":[1845,1898]},{"content":"Do not use binary formatters.","pos":[1902,1931]},{"content":"Code Access Security and Security-Transparent Code are not supported as a security boundary with partially trusted code.","pos":[1933,2053]},{"content":"We advise against loading and executing code of unknown origins without putting alternative security measures in place.","pos":[2054,2173]},{"content":"The alternative security measures are:","pos":[2174,2212]},{"content":"Virtualization","pos":[2216,2230]},{"content":"AppContainers","pos":[2234,2247]},{"content":"Operating system (OS) users and permissions","pos":[2251,2294]},{"content":"Hyper-V containers","pos":[2298,2316]},{"pos":[2321,2342],"content":"Security-neutral code","linkify":"Security-neutral code","nodes":[{"content":"Security-neutral code","pos":[0,21]}]},{"content":"Security-neutral code does nothing explicit with the security system.","pos":[2344,2413]},{"content":"It runs with whatever permissions it receives.","pos":[2414,2460]},{"content":"Although applications that fail to catch security exceptions associated with protected operations (such as using files, networking, and so on) can result in an unhandled exception, security-neutral code still takes advantage of the security technologies in .NET.","pos":[2461,2723]},{"content":"A security-neutral library has special characteristics that you should understand.","pos":[2725,2807]},{"content":"Suppose your library provides API elements that use files or call unmanaged code.","pos":[2808,2889]},{"content":"If your code doesn't have the corresponding permission, it won't run as described.","pos":[2890,2972]},{"content":"However, even if the code has the permission, any application code that calls it must have the same permission in order to work.","pos":[2973,3101]},{"content":"If the calling code doesn't have the right permission, a <ph id=\"ph1\">&lt;xref:System.Security.SecurityException&gt;</ph> appears as a result of the code access security stack walk.","pos":[3102,3259],"source":" If the calling code doesn't have the right permission, a <xref:System.Security.SecurityException> appears as a result of the code access security stack walk."},{"pos":[3264,3312],"content":"Application code that isn't a reusable component","linkify":"Application code that isn't a reusable component","nodes":[{"content":"Application code that isn't a reusable component","pos":[0,48]}]},{"content":"If your code is part of an application that won't be called by other code, security is simple and special coding might not be required.","pos":[3314,3449]},{"content":"However, remember that malicious code can call your code.","pos":[3450,3507]},{"content":"While code access security might stop malicious code from accessing resources, such code could still read values of your fields or properties that might contain sensitive information.","pos":[3508,3691]},{"content":"Additionally, if your code accepts user input from the Internet or other unreliable sources, you must be careful about malicious input.","pos":[3693,3828]},{"pos":[3833,3878],"content":"Managed wrapper to native code implementation","linkify":"Managed wrapper to native code implementation","nodes":[{"content":"Managed wrapper to native code implementation","pos":[0,45]}]},{"content":"Typically in this scenario, some useful functionality is implemented in native code that you want to make available to managed code.","pos":[3880,4012]},{"content":"Managed wrappers are easy to write using either platform invoke or COM interop.","pos":[4013,4092]},{"content":"However, if you do this, callers of your wrappers must have unmanaged code rights in order to succeed.","pos":[4093,4195]},{"content":"Under default policy, this means that code downloaded from an intranet or the Internet won't work with the wrappers.","pos":[4196,4312]},{"content":"Instead of giving unmanaged code rights to all applications that use these wrappers, it's better to give these rights only to the wrapper code.","pos":[4314,4457]},{"content":"If the underlying functionality exposes no resources and the implementation is likewise safe, the wrapper only needs to assert its rights, which enables any code to call through it.","pos":[4458,4639]},{"content":"When resources are involved, security coding should be the same as the library code case described in the next section.","pos":[4640,4759]},{"content":"Because the wrapper is potentially exposing callers to these resources, careful verification of the safety of the native code is necessary and is the wrapper's responsibility.","pos":[4760,4935]},{"pos":[4940,4985],"content":"Library code that exposes protected resources","linkify":"Library code that exposes protected resources","nodes":[{"content":"Library code that exposes protected resources","pos":[0,45]}]},{"content":"The following approach is the most powerful and hence potentially dangerous (if done incorrectly) for security coding: your library serves as an interface for other code to access certain resources that aren't otherwise available, just as the .NET classes enforce permissions for the resources they use.","pos":[4987,5290]},{"content":"Wherever you expose a resource, your code must first demand the permission appropriate to the resource (that is, it must perform a security check) and then typically assert its rights to perform the actual operation.","pos":[5291,5507]},{"pos":[5512,5526],"content":"Related topics","linkify":"Related topics","nodes":[{"content":"Related topics","pos":[0,14]}]},{"content":"Title","pos":[5529,5534]},{"content":"Description","pos":[5535,5546]},{"pos":[5581,5626],"content":"<bpt id=\"p1\">[</bpt>Securing State Data<ept id=\"p1\">](securing-state-data.md)</ept>","source":"[Securing State Data](securing-state-data.md)"},{"content":"Describes how to protect private members.","pos":[5627,5668]},{"pos":[5671,5724],"content":"<bpt id=\"p1\">[</bpt>Security and User Input<ept id=\"p1\">](security-and-user-input.md)</ept>","source":"[Security and User Input](security-and-user-input.md)"},{"content":"Describes security concerns for applications that accept user input.","pos":[5725,5793]},{"pos":[5796,5859],"content":"<bpt id=\"p1\">[</bpt>Security and Race Conditions<ept id=\"p1\">](security-and-race-conditions.md)</ept>","source":"[Security and Race Conditions](security-and-race-conditions.md)"},{"content":"Describes how to avoid race conditions in your code.","pos":[5860,5912]},{"pos":[5915,6000],"content":"<bpt id=\"p1\">[</bpt>Security and On-the-Fly Code Generation<ept id=\"p1\">](security-and-on-the-fly-code-generation.md)</ept>","source":"[Security and On-the-Fly Code Generation](security-and-on-the-fly-code-generation.md)"},{"content":"Describes security concerns for applications that generate dynamic code.","pos":[6001,6073]},{"pos":[6076,6121],"content":"<bpt id=\"p1\">[</bpt>Role-Based Security<ept id=\"p1\">](role-based-security.md)</ept>","source":"[Role-Based Security](role-based-security.md)"},{"content":"Describes .NET role-based security in detail and provides instructions for using it in your code.","pos":[6122,6219]}]}