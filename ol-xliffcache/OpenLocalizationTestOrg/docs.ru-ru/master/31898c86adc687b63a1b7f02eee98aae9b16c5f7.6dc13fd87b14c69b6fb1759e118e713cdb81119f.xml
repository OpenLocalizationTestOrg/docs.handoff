{"content":"---\ntitle: \"Mitigation: CspParameters.ParentWindowHandle Expects an HWND | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"04/07/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"retargeting changes\"\n  - \".NET Framework 4.7 retargeting changes\"\n  - \"CspParameters.ParentWindowHandle\"\n  - \"CspParameters.ParentWindowHandle retargeting change\"\nms.assetid: 33264333-71d6-4d43-8827-9c98878cfea7\ncaps.latest.revision: 5\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# Mitigation: CspParameters.ParentWindowHandle Expects an HWND\n\nThe <xref:System.Security.Cryptography.CspParameters.ParentWindowHandle%2A> property, introduced in the .NET Framework 2.0, allows an application to register a parent window handle value such that any UI required to access the key (such as a PIN prompt or a consent dialog) opens as a modal child to the specified window. Starting with applications that target the .NET Framework 4.7, a window handle (HWND) can be assigned to this property.\n\nIn versions of the .NET Framework through the .NET Framework 4.6.2, the value assigned to the <xref:System.Security.Cryptography.CspParameters.ParentWindowHandle%2A> property was expected to be an <xref:System.IntPtr> that represents the location in memory where the HWND value resided. On Windows 7 and earlier versions of the Windows operating system, setting the property to `form.Handle` had no effect, but on Windows 8 and later versions, it results in a <xref:System.Security.Cryptography> with the message, \"The parameter is incorrect.\"\n\nStarting with apps that target the .NET Framework 4.7, a Windows Forms application can set the <xref:System.Security.Cryptography.CspParameters.ParentWindowHandle%2A> property with code like the following:\n\n```csharp\ncspParameters.ParentWindowHandle = form.Handle;\n``` \n\n## Impact\n\nApplications targeting the .NET Framework 4.7 or later that wish to register a parent window relationship are encouraged to use the simplified form:\n\n```csharp\ncspParameters.ParentWindowHandle = form.Handle;\n``` \n\n## Mitigation\n\nDevelopers who had identified that the correct value was the address of the memory location that held the `form.Handle` value can opt out of this change in behavior by setting the <xref:System.Security.AppContext> switch `Switch.System.Security.Cryptography.DoNotAddrOfCspParentWindowHandle` to `true`:\n\n- By programmatically setting compatibility switches on the <xref:System.Security.AppContext> instance.\n\n- By adding the following line to the `<runtime>` section of the app.config file:\n   \n   ```xml\n   <runtime>\n     <AppContextSwitchOverrides value=\"Switch.System.Security.Cryptography.DoNotAddrOfCspParentWindowHandle=true\"/>\n   </runtime>\n   ```\n\nConversely, users who wish to opt in to the new behavior for applications that run under the .NET Framework 4.7 but target an earlier version of the .NET Framework versions can set the <xref:System.Security.AppContext> switch to `false`.\n \n## See also\n\n[Retargeting Changes in the .NET Framework 4.7](../../../docs/framework/migration-guide/retargeting-changes-in-the-net-framework-4-7.md)\n","nodes":[{"pos":[12,89],"content":"Mitigation: CspParameters.ParentWindowHandle Expects an HWND | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Mitigation: CspParameters.ParentWindowHandle Expects an HWND | Microsoft Docs","pos":[0,77]}]},{"pos":[549,609],"content":"Mitigation: CspParameters.ParentWindowHandle Expects an HWND","linkify":"Mitigation: CspParameters.ParentWindowHandle Expects an HWND","nodes":[{"content":"Mitigation: CspParameters.ParentWindowHandle Expects an HWND","pos":[0,60]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.CspParameters.ParentWindowHandle%2A&gt;</ph> property, introduced in the .NET Framework 2.0, allows an application to register a parent window handle value such that any UI required to access the key (such as a PIN prompt or a consent dialog) opens as a modal child to the specified window.","pos":[611,932],"source":"The <xref:System.Security.Cryptography.CspParameters.ParentWindowHandle%2A> property, introduced in the .NET Framework 2.0, allows an application to register a parent window handle value such that any UI required to access the key (such as a PIN prompt or a consent dialog) opens as a modal child to the specified window."},{"content":"Starting with applications that target the .NET Framework 4.7, a window handle (HWND) can be assigned to this property.","pos":[933,1052]},{"content":"In versions of the .NET Framework through the .NET Framework 4.6.2, the value assigned to the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.CspParameters.ParentWindowHandle%2A&gt;</ph> property was expected to be an <ph id=\"ph2\">&lt;xref:System.IntPtr&gt;</ph> that represents the location in memory where the HWND value resided.","pos":[1054,1340],"source":"In versions of the .NET Framework through the .NET Framework 4.6.2, the value assigned to the <xref:System.Security.Cryptography.CspParameters.ParentWindowHandle%2A> property was expected to be an <xref:System.IntPtr> that represents the location in memory where the HWND value resided."},{"content":"On Windows 7 and earlier versions of the Windows operating system, setting the property to <ph id=\"ph1\">`form.Handle`</ph> had no effect, but on Windows 8 and later versions, it results in a <ph id=\"ph2\">&lt;xref:System.Security.Cryptography&gt;</ph> with the message, \"The parameter is incorrect.\"","pos":[1341,1597],"source":" On Windows 7 and earlier versions of the Windows operating system, setting the property to `form.Handle` had no effect, but on Windows 8 and later versions, it results in a <xref:System.Security.Cryptography> with the message, \"The parameter is incorrect.\""},{"content":"Starting with apps that target the .NET Framework 4.7, a Windows Forms application can set the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.CspParameters.ParentWindowHandle%2A&gt;</ph> property with code like the following:","pos":[1599,1804],"source":"Starting with apps that target the .NET Framework 4.7, a Windows Forms application can set the <xref:System.Security.Cryptography.CspParameters.ParentWindowHandle%2A> property with code like the following:"},{"pos":[1873,1879],"content":"Impact","linkify":"Impact","nodes":[{"content":"Impact","pos":[0,6]}]},{"content":"Applications targeting the .NET Framework 4.7 or later that wish to register a parent window relationship are encouraged to use the simplified form:","pos":[1881,2029]},{"pos":[2098,2108],"content":"Mitigation","linkify":"Mitigation","nodes":[{"content":"Mitigation","pos":[0,10]}]},{"pos":[2110,2412],"content":"Developers who had identified that the correct value was the address of the memory location that held the <ph id=\"ph1\">`form.Handle`</ph> value can opt out of this change in behavior by setting the <ph id=\"ph2\">&lt;xref:System.Security.AppContext&gt;</ph> switch <ph id=\"ph3\">`Switch.System.Security.Cryptography.DoNotAddrOfCspParentWindowHandle`</ph> to <ph id=\"ph4\">`true`</ph>:","source":"Developers who had identified that the correct value was the address of the memory location that held the `form.Handle` value can opt out of this change in behavior by setting the <xref:System.Security.AppContext> switch `Switch.System.Security.Cryptography.DoNotAddrOfCspParentWindowHandle` to `true`:"},{"content":"By programmatically setting compatibility switches on the <ph id=\"ph1\">&lt;xref:System.Security.AppContext&gt;</ph> instance.","pos":[2416,2517],"source":"By programmatically setting compatibility switches on the <xref:System.Security.AppContext> instance."},{"pos":[2521,2600],"content":"By adding the following line to the <ph id=\"ph1\">`&lt;runtime&gt;`</ph> section of the app.config file:","source":"By adding the following line to the `<runtime>` section of the app.config file:"},{"pos":[2766,3003],"content":"Conversely, users who wish to opt in to the new behavior for applications that run under the .NET Framework 4.7 but target an earlier version of the .NET Framework versions can set the <ph id=\"ph1\">&lt;xref:System.Security.AppContext&gt;</ph> switch to <ph id=\"ph2\">`false`</ph>.","source":"Conversely, users who wish to opt in to the new behavior for applications that run under the .NET Framework 4.7 but target an earlier version of the .NET Framework versions can set the <xref:System.Security.AppContext> switch to `false`."},{"pos":[3009,3017],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[3019,3155],"content":"<bpt id=\"p1\">[</bpt>Retargeting Changes in the .NET Framework 4.7<ept id=\"p1\">](../../../docs/framework/migration-guide/retargeting-changes-in-the-net-framework-4-7.md)</ept>","source":"[Retargeting Changes in the .NET Framework 4.7](../../../docs/framework/migration-guide/retargeting-changes-in-the-net-framework-4-7.md)"}]}