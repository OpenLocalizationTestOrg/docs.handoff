{"content":"---\ntitle: \"How to: Create a Secure Session\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"security [WCF], creating a session\"\nms.assetid: b6f42b5a-bbf7-45cf-b917-7ec9fa7ae110\n---\n# How to: Create a Secure Session\nWith the exception of the [\\<basicHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/basichttpbinding.md) binding, the system-provided bindings in Windows Communication Foundation (WCF) automatically use secure sessions when message security is enabled.  \n  \n By default, secure sessions do not survive a Web server that is recycled. When a secure session is established, the client and the service cache the key that is associated with the secure session. As the messages are exchanged, only an identifier to the cached key is exchanged. If the Web server is recycled, the cache is also recycled, such that the Web server cannot retrieve the cached key for the identifier. If this happens, an exception is thrown back to the client. Secure sessions that use a stateful security context token (SCT) can survive a Web server being recycled. For more information about using a stateful SCT in a secure session, see [How to: Create a Security Context Token for a Secure Session](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md).  \n  \n### To specify that a service uses secure sessions by using one of the system-provided bindings  \n  \n-   Configure a service to use a system-provided binding that supports message security.  \n  \n     With the exception of the [\\<basicHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/basichttpbinding.md) binding, when the system-provided bindings are configured to use message security, WCF automatically uses secure sessions. The following table lists the system-provided bindings that support message security and whether message security is the default security mechanism.  \n  \n    |System-provided binding|Configuration element|Message security on by default|  \n    |------------------------------|---------------------------|------------------------------------|  \n    |<xref:System.ServiceModel.BasicHttpBinding>|[\\<basicHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/basichttpbinding.md)|No|  \n    |<xref:System.ServiceModel.WSHttpBinding>|[\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md)|Yes|  \n    |<xref:System.ServiceModel.WSDualHttpBinding>|[\\<wsDualHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsdualhttpbinding.md)|Yes|  \n    |<xref:System.ServiceModel.WSFederationHttpBinding>|[\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)|Yes|  \n    |<xref:System.ServiceModel.NetTcpBinding>|[\\<netTcpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/nettcpbinding.md)|No|  \n    |<xref:System.ServiceModel.NetMsmqBinding>|[\\<netMsmqBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/netmsmqbinding.md)|No|  \n  \n     The following code example uses configuration to specify a binding named `wsHttpBinding_Calculator` that uses the [\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md), message security, and secure sessions.  \n  \n    ```xml  \n    <bindings>  \n      <WSHttpBinding>  \n       <binding name = \"wsHttpBinding_Calculator\">  \n         <security mode=\"Message\">  \n           <message clientCredentialType=\"Windows\"/>  \n         </security>  \n        </binding>  \n      </WSHttpBinding>  \n    </bindings>  \n    ```  \n  \n     The following code example specifies that the [\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md), message security, and secure sessions are used to secure the `secureCalculator` service.  \n  \n     [!code-csharp[c_CreateSecureSession#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_createsecuresession/cs/secureservice.cs#1)]\n     [!code-vb[c_CreateSecureSession#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_createsecuresession/vb/secureservice.vb#1)]  \n  \n    > [!NOTE]\n    >  Secure sessions can be turned off for the [\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) by setting the `establishSecurityContext` attribute to `false`. For the other system-provided bindings, secure sessions can only be turned off by creating a custom binding.  \n  \n### To specify that a service uses secure sessions by using a custom binding  \n  \n-   Create a custom binding that specifies that SOAP messages are protected by a secure session.  \n  \n     For more information about creating a custom binding, see [How to: Customize a System-Provided Binding](../../../../docs/framework/wcf/extending/how-to-customize-a-system-provided-binding.md).  \n  \n     The following code example uses configuration to specify a custom binding that messages using a secure session.  \n  \n    ```xml  \n    <bindings>  \n      <!-- configure a custom binding -->  \n      <customBinding>  \n        <binding name=\"customBinding_Calculator\">  \n          <security authenticationMode=\"SecureConversation\" />  \n          <secureConversationBootstrap authenticationMode=\"SspiNegotiated\" />  \n          <textMessageEncoding messageVersion=\"Soap12WSAddressing10\" writeEncoding=\"utf-8\"/>  \n          <httpTransport/>  \n        </binding>  \n      </customBinding>  \n    </bindings>  \n    ```  \n  \n     The following code example creates a custom binding that uses the <xref:System.ServiceModel.Configuration.AuthenticationMode.MutualCertificate> authentication mode to bootstrap a secure session.  \n  \n     [!code-csharp[c_CreateSecureSession#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_createsecuresession/cs/secureservice.cs#2)]\n     [!code-vb[c_CreateSecureSession#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_createsecuresession/vb/secureservice.vb#2)]  \n  \n## See also\n\n- [WCF Bindings Overview](../../../../docs/framework/wcf/bindings-overview.md)\n","nodes":[{"pos":[4,212],"embed":true,"restype":"x-metadata","content":"title: \"How to: Create a Secure Session\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"security [WCF], creating a session\"\nms.assetid: b6f42b5a-bbf7-45cf-b917-7ec9fa7ae110","nodes":[{"content":"How to: Create a Secure Session","nodes":[{"pos":[0,31],"content":"How to: Create a Secure Session","nodes":[{"content":"How to: Create a Secure Session","pos":[0,31]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[219,250],"content":"How to: Create a Secure Session","linkify":"How to: Create a Secure Session","nodes":[{"content":"How to: Create a Secure Session","pos":[0,31]}]},{"pos":[251,525],"content":"With the exception of the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>basicHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/basichttpbinding.md)</ept> binding, the system-provided bindings in Windows Communication Foundation (WCF) automatically use secure sessions when message security is enabled.","source":"With the exception of the [\\<basicHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/basichttpbinding.md) binding, the system-provided bindings in Windows Communication Foundation (WCF) automatically use secure sessions when message security is enabled."},{"content":"By default, secure sessions do not survive a Web server that is recycled.","pos":[532,605]},{"content":"When a secure session is established, the client and the service cache the key that is associated with the secure session.","pos":[606,728]},{"content":"As the messages are exchanged, only an identifier to the cached key is exchanged.","pos":[729,810]},{"content":"If the Web server is recycled, the cache is also recycled, such that the Web server cannot retrieve the cached key for the identifier.","pos":[811,945]},{"content":"If this happens, an exception is thrown back to the client.","pos":[946,1005]},{"content":"Secure sessions that use a stateful security context token (SCT) can survive a Web server being recycled.","pos":[1006,1111]},{"content":"For more information about using a stateful SCT in a secure session, see <bpt id=\"p1\">[</bpt>How to: Create a Security Context Token for a Secure Session<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md)</ept>.","pos":[1112,1359],"source":" For more information about using a stateful SCT in a secure session, see [How to: Create a Security Context Token for a Secure Session](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md)."},{"pos":[1369,1460],"content":"To specify that a service uses secure sessions by using one of the system-provided bindings","linkify":"To specify that a service uses secure sessions by using one of the system-provided bindings","nodes":[{"content":"To specify that a service uses secure sessions by using one of the system-provided bindings","pos":[0,91]}]},{"content":"Configure a service to use a system-provided binding that supports message security.","pos":[1470,1554]},{"content":"With the exception of the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>basicHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/basichttpbinding.md)</ept> binding, when the system-provided bindings are configured to use message security, WCF automatically uses secure sessions.","pos":[1565,1814],"source":"With the exception of the [\\<basicHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/basichttpbinding.md) binding, when the system-provided bindings are configured to use message security, WCF automatically uses secure sessions."},{"content":"The following table lists the system-provided bindings that support message security and whether message security is the default security mechanism.","pos":[1815,1963]},{"content":"System-provided binding","pos":[1974,1997]},{"content":"Configuration element","pos":[1998,2019]},{"content":"Message security on by default","pos":[2020,2050]},{"pos":[2207,2307],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>basicHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/basichttpbinding.md)</ept>","source":"[\\<basicHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/basichttpbinding.md)"},{"content":"No","pos":[2308,2310]},{"pos":[2360,2454],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>wsHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md)</ept>","source":"[\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md)"},{"content":"Yes","pos":[2455,2458]},{"pos":[2512,2614],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>wsDualHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wsdualhttpbinding.md)</ept>","source":"[\\<wsDualHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsdualhttpbinding.md)"},{"content":"Yes","pos":[2615,2618]},{"pos":[2678,2792],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>wsFederationHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)</ept>","source":"[\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)"},{"content":"Yes","pos":[2793,2796]},{"pos":[2846,2940],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>netTcpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/nettcpbinding.md)</ept>","source":"[\\<netTcpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/nettcpbinding.md)"},{"content":"No","pos":[2941,2943]},{"pos":[2994,3090],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>netMsmqBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/netmsmqbinding.md)</ept>","source":"[\\<netMsmqBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/netmsmqbinding.md)"},{"content":"No","pos":[3091,3093]},{"pos":[3105,3353],"content":"The following code example uses configuration to specify a binding named <ph id=\"ph1\">`wsHttpBinding_Calculator`</ph> that uses the <bpt id=\"p1\">[</bpt><ph id=\"ph2\">\\&lt;</ph>wsHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md)</ept>, message security, and secure sessions.","source":"The following code example uses configuration to specify a binding named `wsHttpBinding_Calculator` that uses the [\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md), message security, and secure sessions."},{"pos":[3663,3893],"content":"The following code example specifies that the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>wsHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md)</ept>, message security, and secure sessions are used to secure the <ph id=\"ph2\">`secureCalculator`</ph> service.","source":"The following code example specifies that the [\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md), message security, and secure sessions are used to secure the `secureCalculator` service."},{"pos":[3904,4183],"content":"[!code-csharp[c_CreateSecureSession#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_createsecuresession/cs/secureservice.cs#1)]\n [!code-vb[c_CreateSecureSession#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_createsecuresession/vb/secureservice.vb#1)]","leadings":["","    "],"nodes":[]},{"pos":[4195,4519],"content":"[!NOTE]\nSecure sessions can be turned off for the [\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) by setting the `establishSecurityContext` attribute to `false`. For the other system-provided bindings, secure sessions can only be turned off by creating a custom binding.","leadings":["","    >  "],"nodes":[{"content":"Secure sessions can be turned off for the [\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) by setting the `establishSecurityContext` attribute to `false`. For the other system-provided bindings, secure sessions can only be turned off by creating a custom binding.","pos":[8,317],"nodes":[{"content":"Secure sessions can be turned off for the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>wsHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md)</ept> by setting the <ph id=\"ph2\">`establishSecurityContext`</ph> attribute to <ph id=\"ph3\">`false`</ph>.","pos":[0,200],"source":"Secure sessions can be turned off for the [\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) by setting the `establishSecurityContext` attribute to `false`."},{"content":"For the other system-provided bindings, secure sessions can only be turned off by creating a custom binding.","pos":[201,309]}]}]},{"pos":[4529,4601],"content":"To specify that a service uses secure sessions by using a custom binding","linkify":"To specify that a service uses secure sessions by using a custom binding","nodes":[{"content":"To specify that a service uses secure sessions by using a custom binding","pos":[0,72]}]},{"content":"Create a custom binding that specifies that SOAP messages are protected by a secure session.","pos":[4611,4703]},{"pos":[4714,4906],"content":"For more information about creating a custom binding, see <bpt id=\"p1\">[</bpt>How to: Customize a System-Provided Binding<ept id=\"p1\">](../../../../docs/framework/wcf/extending/how-to-customize-a-system-provided-binding.md)</ept>.","source":"For more information about creating a custom binding, see [How to: Customize a System-Provided Binding](../../../../docs/framework/wcf/extending/how-to-customize-a-system-provided-binding.md)."},{"content":"The following code example uses configuration to specify a custom binding that messages using a secure session.","pos":[4917,5028]},{"pos":[5535,5729],"content":"The following code example creates a custom binding that uses the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Configuration.AuthenticationMode.MutualCertificate&gt;</ph> authentication mode to bootstrap a secure session.","source":"The following code example creates a custom binding that uses the <xref:System.ServiceModel.Configuration.AuthenticationMode.MutualCertificate> authentication mode to bootstrap a secure session."},{"pos":[5740,6019],"content":"[!code-csharp[c_CreateSecureSession#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_createsecuresession/cs/secureservice.cs#2)]\n [!code-vb[c_CreateSecureSession#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_createsecuresession/vb/secureservice.vb#2)]","leadings":["","    "],"nodes":[]},{"pos":[6028,6036],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6040,6116],"content":"<bpt id=\"p1\">[</bpt>WCF Bindings Overview<ept id=\"p1\">](../../../../docs/framework/wcf/bindings-overview.md)</ept>","source":"[WCF Bindings Overview](../../../../docs/framework/wcf/bindings-overview.md)"}]}