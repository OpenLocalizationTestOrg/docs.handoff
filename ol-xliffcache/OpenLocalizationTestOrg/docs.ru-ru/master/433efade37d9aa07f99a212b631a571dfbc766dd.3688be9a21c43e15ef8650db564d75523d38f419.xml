{"content":"---\ntitle: \"Using Sessions\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"sessions [WCF]\"\nms.assetid: 864ba12f-3331-4359-a359-6d6d387f1035\n---\n# Using Sessions\nIn Windows Communication Foundation (WCF) applications, a *session* correlates a group of messages into a conversation. WCF sessions are different than the session object available in [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] applications, support different behaviors, and are controlled in different ways. This topic describes the features that sessions enable in WCF applications and how to use them.  \n  \n## Sessions in Windows Communication Foundation Applications  \n When a service contract specifies that it requires a session, that contract is specifying that all calls (that is, the underlying message exchanges that support the calls) must be part of the same conversation. If a contract specifies that it allows sessions but does not require one, clients can connect and either establish a session or not establish a session. If the session ends and a message is sent through the same channel an exception is thrown.  \n  \n WCF sessions have the following main conceptual features:  \n  \n-   They are explicitly initiated and terminated by the calling application (the WCF client).  \n  \n-   Messages delivered during a session are processed in the order in which they are received.  \n  \n-   Sessions correlate a group of messages into a conversation. Different types of correlation are possible. For instance, one session-based channel may correlate messages based on a shared network connection while another session-based channel may correlate messages based on a shared tag in the message body. The features that can be derived from the session depend on the nature of the correlation.  \n  \n-   There is no general data store associated with a WCF session.  \n  \n If you are familiar with the <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> class in [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] applications and the functionality it provides, you might notice the following differences between that kind of session and WCF sessions:  \n  \n-   [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] sessions are always server-initiated.  \n  \n-   [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] sessions are implicitly unordered.  \n  \n-   [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] sessions provide a general data storage mechanism across requests.  \n  \n This topic describes:  \n  \n-   The default execution behavior when using session-based bindings in the service model layer.  \n  \n-   The types of features that the WCF session-based, system-provided bindings provide.  \n  \n-   How to create a contract that declares a session requirement.  \n  \n-   How to understand and control the creation and termination of the session and the relationship of the session to the service instance.  \n  \n## Default Execution Behavior Using Sessions  \n A binding that attempts to initiate a session is called a *session-based* binding. Service contracts specify that they require, permit, or refuse session-based bindings by setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on the service contract interface (or class) to one of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration values. By default, the value of this property is <xref:System.ServiceModel.SessionMode.Allowed>, which means that if a client uses a session-based binding with a WCF service implementation, the service establishes and uses the session provided.  \n  \n When a WCF service accepts a client session, the following features are enabled by default:  \n  \n1.  All calls between a WCF client object are handled by the same service instance.  \n  \n2.  Different session-based bindings provide additional features.  \n  \n## System-Provided Session Types  \n A session-based binding supports the default association of a service instance with a particular session. However, different session-based bindings support different features in addition to enabling the session-based instancing control previously described.  \n  \n WCF provides the following types of session-based application behavior:  \n  \n-   The <xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType> supports security-based sessions, in which both ends of communication have agreed upon a specific secure conversation. For more information, see [Securing Services](../../../docs/framework/wcf/securing-services.md). For example, the <xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType> binding, which contains support for both security sessions and reliable sessions, by default uses only a secure session that encrypts and digitally signs messages.  \n  \n-   The <xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType> binding supports TCP/IP-based sessions to ensure that all messages are correlated by the connection at the socket level.  \n  \n-   The <xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType> element, which implements the WS-ReliableMessaging specification, provides support for reliable sessions in which messages can be configured to be delivered in order and exactly once, ensuring messages are received even when messages travel across multiple nodes during the conversation. For more information, see [Reliable Sessions](../../../docs/framework/wcf/feature-details/reliable-sessions.md).  \n  \n-   The <xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType> binding provides MSMQ datagram sessions. For more information, see [Queues in WCF](../../../docs/framework/wcf/feature-details/queues-in-wcf.md).  \n  \n Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not specify the type of session the contract requires, only that it requires one.  \n  \n## Creating a Contract That Requires a Session  \n Creating a contract that requires a session states that the group of operations that the service contract declares must all be executed within the same session and that messages must be delivered in order. To assert the level of session support that a service contract requires, set the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on your service contract interface or class to the value of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration to specify whether the contract:  \n  \n-   Requires a session.  \n  \n-   Allows a client to establish a session.  \n  \n-   Prohibits a session.  \n  \n Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not, however, specify the type of session-based behavior the contract requires. It instructs WCF to confirm at runtime that the configured binding (which creates the communication channel) for the service does, does not, or can establish a session when implementing a service. Again, the binding can satisfy that requirement with any type of session-based behavior it chooses—security, transport, reliable, or some combination. The exact behavior depends on the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> value selected. If the configured binding of the service does not conform to the value of <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A>, an exception is thrown. Bindings and the channels they create that support sessions are said to be session-based.  \n  \n The following service contract specifies that all operations in the `ICalculatorSession` must be exchanged within a session. None of the operations returns a value to the caller except the `Equals` method. However, the `Equals` method takes no parameters and, therefore, can only return a non-zero value inside a session in which data has already been passed to the other operations. This contract requires a session to function properly. Without a session associated with a specific client, the service instance has no way of knowing what previous data this client has sent.  \n  \n [!code-csharp[S_Service_Session#1](../../../samples/snippets/csharp/VS_Snippets_CFX/s_service_session/cs/service.cs#1)]\n [!code-vb[S_Service_Session#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_service_session/vb/service.vb#1)]  \n  \n If a service allows a session, then a session is established and used if the client initiates one; otherwise, no session is established.  \n  \n## Sessions and Service Instances  \n If you use the default instancing behavior in WCF, all calls between a WCF client object are handled by the same service instance. Therefore, at the application level, you can think of a session as enabling application behavior similar to local call behavior. For example, when you create a local object:  \n  \n-   A constructor is called.  \n  \n-   All subsequent calls made to the WCF client object reference are processed by the same object instance.  \n  \n-   A destructor is called when the object reference is destroyed.  \n  \n Sessions enable a similar behavior between clients and services as long as the default service instance behavior is used. If a service contract requires or supports sessions, one or more contract operations can be marked as initiating or terminating a session by setting the <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A> and <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A> properties.  \n  \n *Initiating operations* are those that must be called as the first operation of a new session. Non-initiating operations can be called only after at least one initiating operation has been called. You can therefore create a kind of session constructor for your service by declaring initiating operations designed to take input from clients appropriate to the beginning of the service instance. (The state is associated with the session, however, and not the service object.)  \n  \n *Terminating operations*, conversely, are those that must be called as the last message in an existing session. In the default case, WCF recycles the service object and its context after the session with which the service was associated is closed. You can, therefore, create a kind of destructor by declaring terminating operations designed to perform a function appropriate to the end of the service instance.  \n  \n> [!NOTE]\n>  Although the default behavior bears a resemblance to local constructors and destructors, it is only a resemblance. Any WCF service operation can be an initiating or terminating operation, or both at the same time. In addition, in the default case, initiating operations can be called any number of times in any order; no additional sessions are created once the session is established and associated with an instance unless you explicitly control the lifetime of the service instance (by manipulating the <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType> object). Finally, the state is associated with the session and not the service object.  \n  \n For example, the `ICalculatorSession` contract used in the preceding example requires that the WCF client object first call the `Clear` operation prior to any other operation and that the session with this WCF client object should terminate when it calls the `Equals` operation. The following code example shows a contract that enforces these requirements. `Clear` must be called first to initiate a session, and that session ends when `Equals` is called.  \n  \n [!code-csharp[SCA.IsInitiatingIsTerminating#1](../../../samples/snippets/csharp/VS_Snippets_CFX/sca.isinitiatingisterminating/cs/service.cs#1)]\n [!code-vb[SCA.IsInitiatingIsTerminating#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/sca.isinitiatingisterminating/vb/service.vb#1)]  \n  \n Services do not start sessions with clients. In WCF client applications, a direct relationship exists between the lifetime of the session-based channel and the lifetime of the session itself. As such, clients create new sessions by creating new session-based channels and tear down existing sessions by closing session-based channels gracefully. A client starts a session with a service endpoint by calling one of the following:  \n  \n-   <xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.  \n  \n-   <xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType> on the WCF client object generated by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).  \n  \n-   An initiating operation on either type of WCF client object (by default, all operations are initiating). When the first operation is called, the WCF client object automatically opens the channel and initiates a session.  \n  \n Typically a client ends a session with a service endpoint by calling one of the following:  \n  \n-   <xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.  \n  \n-   <xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType> on the WCF client object generated by Svcutil.exe.  \n  \n-   A terminating operation on either type of WCF client object (by default, no operations are terminating; the contract must explicitly specify a terminating operation). When the first operation is called, the WCF client object automatically opens the channel and initiates a session.  \n  \n For examples, see [How to: Create a Service That Requires Sessions](../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md) as well as the [Default Service Behavior](../../../docs/framework/wcf/samples/default-service-behavior.md) and [Instancing](../../../docs/framework/wcf/samples/instancing.md) samples.  \n  \n For more information about clients and sessions, see [Accessing Services Using a WCF Client](../../../docs/framework/wcf/feature-details/accessing-services-using-a-client.md).  \n  \n## Sessions Interact with InstanceContext Settings  \n There is an interaction between the <xref:System.ServiceModel.SessionMode> enumeration in a contract and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property, which controls the association between channels and specific service objects. For more information, see [Sessions, Instancing, and Concurrency](../../../docs/framework/wcf/feature-details/sessions-instancing-and-concurrency.md).  \n  \n### Sharing InstanceContext Objects  \n You can also control which session-based channel or call is associated with which <xref:System.ServiceModel.InstanceContext> object by performing that association yourself. \n  \n## Sessions and Streaming  \n When you have a large amount of data to transfer, the streaming transfer mode in WCF is a feasible alternative to the default behavior of buffering and processing messages in memory in their entirety. You may get unexpected behavior when streaming calls with a session-based binding. All streaming calls are made through a single channel (the datagram channel) that does not support sessions even if the binding being used is configured to use sessions. If multiple clients make streaming calls to the same service object over a session-based binding, and the service object's concurrency mode is set to single and its instance context mode is set to `PerSession`, all calls must go through the datagram channel and so only one call is processed at a time. One or more clients may then time out. You can work around this issue by either setting the service object's `InstanceContextMode` to `PerCall` or Concurrency to multiple.  \n  \n> [!NOTE]\n>  MaxConcurrentSessions have no effect in this case because there is only one \"session\" available.  \n  \n## See also\n\n- <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A>\n- <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A>\n","nodes":[{"pos":[4,175],"embed":true,"restype":"x-metadata","content":"title: \"Using Sessions\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"sessions [WCF]\"\nms.assetid: 864ba12f-3331-4359-a359-6d6d387f1035","nodes":[{"content":"Using Sessions","nodes":[{"pos":[0,14],"content":"Using Sessions","nodes":[{"content":"Using Sessions","pos":[0,14]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[182,196],"content":"Using Sessions","linkify":"Using Sessions","nodes":[{"content":"Using Sessions","pos":[0,14]}]},{"content":"In Windows Communication Foundation (WCF) applications, a <bpt id=\"p1\">*</bpt>session<ept id=\"p1\">*</ept> correlates a group of messages into a conversation.","pos":[197,316],"source":"In Windows Communication Foundation (WCF) applications, a *session* correlates a group of messages into a conversation."},{"content":"WCF sessions are different than the session object available in <ph id=\"ph1\">[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)]</ph> applications, support different behaviors, and are controlled in different ways.","pos":[317,516],"source":" WCF sessions are different than the session object available in [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] applications, support different behaviors, and are controlled in different ways."},{"content":"This topic describes the features that sessions enable in WCF applications and how to use them.","pos":[517,612]},{"pos":[621,678],"content":"Sessions in Windows Communication Foundation Applications","linkify":"Sessions in Windows Communication Foundation Applications","nodes":[{"content":"Sessions in Windows Communication Foundation Applications","pos":[0,57]}]},{"content":"When a service contract specifies that it requires a session, that contract is specifying that all calls (that is, the underlying message exchanges that support the calls) must be part of the same conversation.","pos":[682,892]},{"content":"If a contract specifies that it allows sessions but does not require one, clients can connect and either establish a session or not establish a session.","pos":[893,1045]},{"content":"If the session ends and a message is sent through the same channel an exception is thrown.","pos":[1046,1136]},{"content":"WCF sessions have the following main conceptual features:","pos":[1143,1200]},{"content":"They are explicitly initiated and terminated by the calling application (the WCF client).","pos":[1210,1299]},{"content":"Messages delivered during a session are processed in the order in which they are received.","pos":[1309,1399]},{"content":"Sessions correlate a group of messages into a conversation.","pos":[1409,1468]},{"content":"Different types of correlation are possible.","pos":[1469,1513]},{"content":"For instance, one session-based channel may correlate messages based on a shared network connection while another session-based channel may correlate messages based on a shared tag in the message body.","pos":[1514,1715]},{"content":"The features that can be derived from the session depend on the nature of the correlation.","pos":[1716,1806]},{"content":"There is no general data store associated with a WCF session.","pos":[1816,1877]},{"pos":[1884,2191],"content":"If you are familiar with the <ph id=\"ph1\">&lt;xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType&gt;</ph> class in <ph id=\"ph2\">[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)]</ph> applications and the functionality it provides, you might notice the following differences between that kind of session and WCF sessions:","source":"If you are familiar with the <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> class in [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] applications and the functionality it provides, you might notice the following differences between that kind of session and WCF sessions:"},{"pos":[2201,2293],"content":"<ph id=\"ph1\">[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)]</ph> sessions are always server-initiated.","source":"[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] sessions are always server-initiated."},{"pos":[2303,2392],"content":"<ph id=\"ph1\">[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)]</ph> sessions are implicitly unordered.","source":"[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] sessions are implicitly unordered."},{"pos":[2402,2523],"content":"<ph id=\"ph1\">[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)]</ph> sessions provide a general data storage mechanism across requests.","source":"[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] sessions provide a general data storage mechanism across requests."},{"content":"This topic describes:","pos":[2530,2551]},{"content":"The default execution behavior when using session-based bindings in the service model layer.","pos":[2561,2653]},{"content":"The types of features that the WCF session-based, system-provided bindings provide.","pos":[2663,2746]},{"content":"How to create a contract that declares a session requirement.","pos":[2756,2817]},{"content":"How to understand and control the creation and termination of the session and the relationship of the session to the service instance.","pos":[2827,2961]},{"pos":[2970,3011],"content":"Default Execution Behavior Using Sessions","linkify":"Default Execution Behavior Using Sessions","nodes":[{"content":"Default Execution Behavior Using Sessions","pos":[0,41]}]},{"content":"A binding that attempts to initiate a session is called a <bpt id=\"p1\">*</bpt>session-based<ept id=\"p1\">*</ept> binding.","pos":[3015,3097],"source":"A binding that attempts to initiate a session is called a *session-based* binding."},{"content":"Service contracts specify that they require, permit, or refuse session-based bindings by setting the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType&gt;</ph> property on the service contract interface (or class) to one of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.SessionMode?displayProperty=nameWithType&gt;</ph> enumeration values.","pos":[3098,3450],"source":" Service contracts specify that they require, permit, or refuse session-based bindings by setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on the service contract interface (or class) to one of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration values."},{"content":"By default, the value of this property is <ph id=\"ph1\">&lt;xref:System.ServiceModel.SessionMode.Allowed&gt;</ph>, which means that if a client uses a session-based binding with a WCF service implementation, the service establishes and uses the session provided.","pos":[3451,3688],"source":" By default, the value of this property is <xref:System.ServiceModel.SessionMode.Allowed>, which means that if a client uses a session-based binding with a WCF service implementation, the service establishes and uses the session provided."},{"content":"When a WCF service accepts a client session, the following features are enabled by default:","pos":[3695,3786]},{"content":"All calls between a WCF client object are handled by the same service instance.","pos":[3796,3875]},{"content":"Different session-based bindings provide additional features.","pos":[3885,3946]},{"pos":[3955,3984],"content":"System-Provided Session Types","linkify":"System-Provided Session Types","nodes":[{"content":"System-Provided Session Types","pos":[0,29]}]},{"content":"A session-based binding supports the default association of a service instance with a particular session.","pos":[3988,4093]},{"content":"However, different session-based bindings support different features in addition to enabling the session-based instancing control previously described.","pos":[4094,4245]},{"content":"WCF provides the following types of session-based application behavior:","pos":[4252,4323]},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType&gt;</ph> supports security-based sessions, in which both ends of communication have agreed upon a specific secure conversation.","pos":[4333,4543],"source":"The <xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType> supports security-based sessions, in which both ends of communication have agreed upon a specific secure conversation."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Securing Services<ept id=\"p1\">](../../../docs/framework/wcf/securing-services.md)</ept>.","pos":[4544,4640],"source":" For more information, see [Securing Services](../../../docs/framework/wcf/securing-services.md)."},{"content":"For example, the <ph id=\"ph1\">&lt;xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType&gt;</ph> binding, which contains support for both security sessions and reliable sessions, by default uses only a secure session that encrypts and digitally signs messages.","pos":[4641,4891],"source":" For example, the <xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType> binding, which contains support for both security sessions and reliable sessions, by default uses only a secure session that encrypts and digitally signs messages."},{"pos":[4901,5095],"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType&gt;</ph> binding supports TCP/IP-based sessions to ensure that all messages are correlated by the connection at the socket level.","source":"The <xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType> binding supports TCP/IP-based sessions to ensure that all messages are correlated by the connection at the socket level."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType&gt;</ph> element, which implements the WS-ReliableMessaging specification, provides support for reliable sessions in which messages can be configured to be delivered in order and exactly once, ensuring messages are received even when messages travel across multiple nodes during the conversation.","pos":[5105,5491],"source":"The <xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType> element, which implements the WS-ReliableMessaging specification, provides support for reliable sessions in which messages can be configured to be delivered in order and exactly once, ensuring messages are received even when messages travel across multiple nodes during the conversation."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Reliable Sessions<ept id=\"p1\">](../../../docs/framework/wcf/feature-details/reliable-sessions.md)</ept>.","pos":[5492,5604],"source":" For more information, see [Reliable Sessions](../../../docs/framework/wcf/feature-details/reliable-sessions.md)."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType&gt;</ph> binding provides MSMQ datagram sessions.","pos":[5614,5729],"source":"The <xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType> binding provides MSMQ datagram sessions."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Queues in WCF<ept id=\"p1\">](../../../docs/framework/wcf/feature-details/queues-in-wcf.md)</ept>.","pos":[5730,5834],"source":" For more information, see [Queues in WCF](../../../docs/framework/wcf/feature-details/queues-in-wcf.md)."},{"pos":[5841,6015],"content":"Setting the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A&gt;</ph> property does not specify the type of session the contract requires, only that it requires one.","source":"Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not specify the type of session the contract requires, only that it requires one."},{"pos":[6024,6067],"content":"Creating a Contract That Requires a Session","linkify":"Creating a Contract That Requires a Session","nodes":[{"content":"Creating a Contract That Requires a Session","pos":[0,43]}]},{"content":"Creating a contract that requires a session states that the group of operations that the service contract declares must all be executed within the same session and that messages must be delivered in order.","pos":[6071,6276]},{"content":"To assert the level of session support that a service contract requires, set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType&gt;</ph> property on your service contract interface or class to the value of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.SessionMode?displayProperty=nameWithType&gt;</ph> enumeration to specify whether the contract:","pos":[6277,6639],"source":" To assert the level of session support that a service contract requires, set the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on your service contract interface or class to the value of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration to specify whether the contract:"},{"content":"Requires a session.","pos":[6649,6668]},{"content":"Allows a client to establish a session.","pos":[6678,6717]},{"content":"Prohibits a session.","pos":[6727,6747]},{"content":"Setting the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A&gt;</ph> property does not, however, specify the type of session-based behavior the contract requires.","pos":[6754,6926],"source":"Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not, however, specify the type of session-based behavior the contract requires."},{"content":"It instructs WCF to confirm at runtime that the configured binding (which creates the communication channel) for the service does, does not, or can establish a session when implementing a service.","pos":[6927,7123]},{"content":"Again, the binding can satisfy that requirement with any type of session-based behavior it chooses—security, transport, reliable, or some combination.","pos":[7124,7274]},{"content":"The exact behavior depends on the <ph id=\"ph1\">&lt;xref:System.ServiceModel.SessionMode?displayProperty=nameWithType&gt;</ph> value selected.","pos":[7275,7392],"source":" The exact behavior depends on the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> value selected."},{"content":"If the configured binding of the service does not conform to the value of <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A&gt;</ph>, an exception is thrown.","pos":[7393,7558],"source":" If the configured binding of the service does not conform to the value of <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A>, an exception is thrown."},{"content":"Bindings and the channels they create that support sessions are said to be session-based.","pos":[7559,7648]},{"content":"The following service contract specifies that all operations in the <ph id=\"ph1\">`ICalculatorSession`</ph> must be exchanged within a session.","pos":[7655,7779],"source":"The following service contract specifies that all operations in the `ICalculatorSession` must be exchanged within a session."},{"content":"None of the operations returns a value to the caller except the <ph id=\"ph1\">`Equals`</ph> method.","pos":[7780,7860],"source":" None of the operations returns a value to the caller except the `Equals` method."},{"content":"However, the <ph id=\"ph1\">`Equals`</ph> method takes no parameters and, therefore, can only return a non-zero value inside a session in which data has already been passed to the other operations.","pos":[7861,8038],"source":" However, the `Equals` method takes no parameters and, therefore, can only return a non-zero value inside a session in which data has already been passed to the other operations."},{"content":"This contract requires a session to function properly.","pos":[8039,8093]},{"content":"Without a session associated with a specific client, the service instance has no way of knowing what previous data this client has sent.","pos":[8094,8230]},{"pos":[8237,8478],"content":"[!code-csharp[S_Service_Session#1](../../../samples/snippets/csharp/VS_Snippets_CFX/s_service_session/cs/service.cs#1)]\n[!code-vb[S_Service_Session#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_service_session/vb/service.vb#1)]","leadings":[""," "],"nodes":[]},{"content":"If a service allows a session, then a session is established and used if the client initiates one; otherwise, no session is established.","pos":[8485,8621]},{"pos":[8630,8660],"content":"Sessions and Service Instances","linkify":"Sessions and Service Instances","nodes":[{"content":"Sessions and Service Instances","pos":[0,30]}]},{"content":"If you use the default instancing behavior in WCF, all calls between a WCF client object are handled by the same service instance.","pos":[8664,8794]},{"content":"Therefore, at the application level, you can think of a session as enabling application behavior similar to local call behavior.","pos":[8795,8923]},{"content":"For example, when you create a local object:","pos":[8924,8968]},{"content":"A constructor is called.","pos":[8978,9002]},{"content":"All subsequent calls made to the WCF client object reference are processed by the same object instance.","pos":[9012,9115]},{"content":"A destructor is called when the object reference is destroyed.","pos":[9125,9187]},{"content":"Sessions enable a similar behavior between clients and services as long as the default service instance behavior is used.","pos":[9194,9315]},{"content":"If a service contract requires or supports sessions, one or more contract operations can be marked as initiating or terminating a session by setting the <ph id=\"ph1\">&lt;xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A&gt;</ph> properties.","pos":[9316,9625],"source":" If a service contract requires or supports sessions, one or more contract operations can be marked as initiating or terminating a session by setting the <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A> and <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A> properties."},{"content":"<bpt id=\"p1\">*</bpt>Initiating operations<ept id=\"p1\">*</ept> are those that must be called as the first operation of a new session.","pos":[9632,9726],"source":"*Initiating operations* are those that must be called as the first operation of a new session."},{"content":"Non-initiating operations can be called only after at least one initiating operation has been called.","pos":[9727,9828]},{"content":"You can therefore create a kind of session constructor for your service by declaring initiating operations designed to take input from clients appropriate to the beginning of the service instance.","pos":[9829,10025]},{"content":"(The state is associated with the session, however, and not the service object.)","pos":[10026,10106]},{"content":"<bpt id=\"p1\">*</bpt>Terminating operations<ept id=\"p1\">*</ept>, conversely, are those that must be called as the last message in an existing session.","pos":[10113,10224],"source":"*Terminating operations*, conversely, are those that must be called as the last message in an existing session."},{"content":"In the default case, WCF recycles the service object and its context after the session with which the service was associated is closed.","pos":[10225,10360]},{"content":"You can, therefore, create a kind of destructor by declaring terminating operations designed to perform a function appropriate to the end of the service instance.","pos":[10361,10523]},{"pos":[10531,11205],"content":"[!NOTE]\n Although the default behavior bears a resemblance to local constructors and destructors, it is only a resemblance. Any WCF service operation can be an initiating or terminating operation, or both at the same time. In addition, in the default case, initiating operations can be called any number of times in any order; no additional sessions are created once the session is established and associated with an instance unless you explicitly control the lifetime of the service instance (by manipulating the <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType> object). Finally, the state is associated with the session and not the service object.","leadings":["","> "],"nodes":[{"content":"Although the default behavior bears a resemblance to local constructors and destructors, it is only a resemblance. Any WCF service operation can be an initiating or terminating operation, or both at the same time. In addition, in the default case, initiating operations can be called any number of times in any order; no additional sessions are created once the session is established and associated with an instance unless you explicitly control the lifetime of the service instance (by manipulating the <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType> object). Finally, the state is associated with the session and not the service object.","pos":[9,672],"nodes":[{"content":"Although the default behavior bears a resemblance to local constructors and destructors, it is only a resemblance.","pos":[0,114]},{"content":"Any WCF service operation can be an initiating or terminating operation, or both at the same time.","pos":[115,213]},{"content":"In addition, in the default case, initiating operations can be called any number of times in any order; no additional sessions are created once the session is established and associated with an instance unless you explicitly control the lifetime of the service instance (by manipulating the <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType&gt;</ph> object).","pos":[214,585],"source":" In addition, in the default case, initiating operations can be called any number of times in any order; no additional sessions are created once the session is established and associated with an instance unless you explicitly control the lifetime of the service instance (by manipulating the <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType> object)."},{"content":"Finally, the state is associated with the session and not the service object.","pos":[586,663]}]}]},{"content":"For example, the <ph id=\"ph1\">`ICalculatorSession`</ph> contract used in the preceding example requires that the WCF client object first call the <ph id=\"ph2\">`Clear`</ph> operation prior to any other operation and that the session with this WCF client object should terminate when it calls the <ph id=\"ph3\">`Equals`</ph> operation.","pos":[11212,11490],"source":"For example, the `ICalculatorSession` contract used in the preceding example requires that the WCF client object first call the `Clear` operation prior to any other operation and that the session with this WCF client object should terminate when it calls the `Equals` operation."},{"content":"The following code example shows a contract that enforces these requirements.","pos":[11491,11568]},{"content":"<ph id=\"ph1\">`Clear`</ph> must be called first to initiate a session, and that session ends when <ph id=\"ph2\">`Equals`</ph> is called.","pos":[11569,11667],"source":"`Clear` must be called first to initiate a session, and that session ends when `Equals` is called."},{"content":"Services do not start sessions with clients.","pos":[11970,12014]},{"content":"In WCF client applications, a direct relationship exists between the lifetime of the session-based channel and the lifetime of the session itself.","pos":[12015,12161]},{"content":"As such, clients create new sessions by creating new session-based channels and tear down existing sessions by closing session-based channels gracefully.","pos":[12162,12315]},{"content":"A client starts a session with a service endpoint by calling one of the following:","pos":[12316,12398]},{"pos":[12408,12622],"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType&gt;</ph> on the channel returned by a call to <ph id=\"ph2\">&lt;xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType&gt;</ph>.","source":"<xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>."},{"pos":[12632,12883],"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType&gt;</ph> on the WCF client object generated by the <bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept>.","source":"<xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType> on the WCF client object generated by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)."},{"content":"An initiating operation on either type of WCF client object (by default, all operations are initiating).","pos":[12893,12997]},{"content":"When the first operation is called, the WCF client object automatically opens the channel and initiates a session.","pos":[12998,13112]},{"content":"Typically a client ends a session with a service endpoint by calling one of the following:","pos":[13119,13209]},{"pos":[13219,13434],"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType&gt;</ph> on the channel returned by a call to <ph id=\"ph2\">&lt;xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType&gt;</ph>.","source":"<xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>."},{"pos":[13444,13574],"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType&gt;</ph> on the WCF client object generated by Svcutil.exe.","source":"<xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType> on the WCF client object generated by Svcutil.exe."},{"content":"A terminating operation on either type of WCF client object (by default, no operations are terminating; the contract must explicitly specify a terminating operation).","pos":[13584,13750]},{"content":"When the first operation is called, the WCF client object automatically opens the channel and initiates a session.","pos":[13751,13865]},{"pos":[13872,14218],"content":"For examples, see <bpt id=\"p1\">[</bpt>How to: Create a Service That Requires Sessions<ept id=\"p1\">](../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md)</ept> as well as the <bpt id=\"p2\">[</bpt>Default Service Behavior<ept id=\"p2\">](../../../docs/framework/wcf/samples/default-service-behavior.md)</ept> and <bpt id=\"p3\">[</bpt>Instancing<ept id=\"p3\">](../../../docs/framework/wcf/samples/instancing.md)</ept> samples.","source":"For examples, see [How to: Create a Service That Requires Sessions](../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md) as well as the [Default Service Behavior](../../../docs/framework/wcf/samples/default-service-behavior.md) and [Instancing](../../../docs/framework/wcf/samples/instancing.md) samples."},{"pos":[14225,14400],"content":"For more information about clients and sessions, see <bpt id=\"p1\">[</bpt>Accessing Services Using a WCF Client<ept id=\"p1\">](../../../docs/framework/wcf/feature-details/accessing-services-using-a-client.md)</ept>.","source":"For more information about clients and sessions, see [Accessing Services Using a WCF Client](../../../docs/framework/wcf/feature-details/accessing-services-using-a-client.md)."},{"pos":[14409,14456],"content":"Sessions Interact with InstanceContext Settings","linkify":"Sessions Interact with InstanceContext Settings","nodes":[{"content":"Sessions Interact with InstanceContext Settings","pos":[0,47]}]},{"content":"There is an interaction between the <ph id=\"ph1\">&lt;xref:System.ServiceModel.SessionMode&gt;</ph> enumeration in a contract and the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType&gt;</ph> property, which controls the association between channels and specific service objects.","pos":[14460,14760],"source":"There is an interaction between the <xref:System.ServiceModel.SessionMode> enumeration in a contract and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property, which controls the association between channels and specific service objects."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Sessions, Instancing, and Concurrency<ept id=\"p1\">](../../../docs/framework/wcf/feature-details/sessions-instancing-and-concurrency.md)</ept>.","pos":[14761,14911],"source":" For more information, see [Sessions, Instancing, and Concurrency](../../../docs/framework/wcf/feature-details/sessions-instancing-and-concurrency.md)."},{"pos":[14921,14952],"content":"Sharing InstanceContext Objects","linkify":"Sharing InstanceContext Objects","nodes":[{"content":"Sharing InstanceContext Objects","pos":[0,31]}]},{"pos":[14956,15128],"content":"You can also control which session-based channel or call is associated with which <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> object by performing that association yourself.","source":"You can also control which session-based channel or call is associated with which <xref:System.ServiceModel.InstanceContext> object by performing that association yourself."},{"pos":[15136,15158],"content":"Sessions and Streaming","linkify":"Sessions and Streaming","nodes":[{"content":"Sessions and Streaming","pos":[0,22]}]},{"content":"When you have a large amount of data to transfer, the streaming transfer mode in WCF is a feasible alternative to the default behavior of buffering and processing messages in memory in their entirety.","pos":[15162,15362]},{"content":"You may get unexpected behavior when streaming calls with a session-based binding.","pos":[15363,15445]},{"content":"All streaming calls are made through a single channel (the datagram channel) that does not support sessions even if the binding being used is configured to use sessions.","pos":[15446,15615]},{"content":"If multiple clients make streaming calls to the same service object over a session-based binding, and the service object's concurrency mode is set to single and its instance context mode is set to <ph id=\"ph1\">`PerSession`</ph>, all calls must go through the datagram channel and so only one call is processed at a time.","pos":[15616,15918],"source":" If multiple clients make streaming calls to the same service object over a session-based binding, and the service object's concurrency mode is set to single and its instance context mode is set to `PerSession`, all calls must go through the datagram channel and so only one call is processed at a time."},{"content":"One or more clients may then time out. You can work around this issue by either setting the service object's <ph id=\"ph1\">`InstanceContextMode`</ph> to <ph id=\"ph2\">`PerCall`</ph> or Concurrency to multiple.","pos":[15919,16090],"source":" One or more clients may then time out. You can work around this issue by either setting the service object's `InstanceContextMode` to `PerCall` or Concurrency to multiple."},{"pos":[16098,16205],"content":"[!NOTE]\n MaxConcurrentSessions have no effect in this case because there is only one \"session\" available.","leadings":["","> "],"nodes":[{"content":"MaxConcurrentSessions have no effect in this case because there is only one \"session\" available.","pos":[9,105]}]},{"pos":[16214,16222],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]}]}