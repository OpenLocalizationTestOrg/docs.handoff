{"content":"---\ntitle: \"How to: Create a Federated Client\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"WCF, federation\"\n  - \"federation\"\nms.assetid: 56ece47e-98bf-4346-b92b-fda1fc3b4d9c\n---\n# How to: Create a Federated Client\nIn Windows Communication Foundation (WCF), creating a client for a *federated service* consists of three main steps:  \n  \n1.  Configure a [\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) or similar custom binding. For more information about creating an appropriate binding, see [How to: Create a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md). Alternatively, run the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) against the metadata endpoint of the federated service to generate a configuration file for communicating with the federated service and one or more security token services.  \n  \n2.  Set the properties of the <xref:System.ServiceModel.Security.IssuedTokenClientCredential> that controls various aspects of a client's interaction with a security token service.  \n  \n3.  Set the properties of the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential>, which allows certificates needed to communicate securely with given endpoints, such as security token services.  \n  \n> [!NOTE]\n>  A <xref:System.Security.Cryptography.CryptographicException> might be thrown when a client uses impersonated credentials, the <xref:System.ServiceModel.WSFederationHttpBinding> binding or a custom-issued token, and asymmetric keys. Asymmetric keys are used with the <xref:System.ServiceModel.WSFederationHttpBinding> binding and custom-issued tokens when the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedKeyType%2A> and <xref:System.ServiceModel.Security.Tokens.IssuedSecurityTokenParameters.KeyType%2A> properties, respectively, are set to <xref:System.IdentityModel.Tokens.SecurityKeyType.AsymmetricKey>. The <xref:System.Security.Cryptography.CryptographicException> is thrown when the client attempts to send a message and a user profile doesn’t exist for the identity that the client is impersonating. To mitigate this issue, log on to the client computer or call `LoadUserProfile` before sending the message.  \n  \n This topic provides detailed information about these procedures. For more information about creating an appropriate binding, see [How to: Create a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md). For more information about how a federated service works, see [Federation](../../../../docs/framework/wcf/feature-details/federation.md).  \n  \n### To generate and examine the configuration for a federated service  \n  \n1.  Run the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) with the address of the metadata URL of the service as a command-line parameter.  \n  \n2.  Open the generated configuration file in an appropriate editor.  \n  \n3.  Examine the attributes and content of any generated [\\<issuer>](../../../../docs/framework/configure-apps/file-schema/wcf/issuer.md) and [\\<issuerMetadata>](../../../../docs/framework/configure-apps/file-schema/wcf/issuermetadata.md) elements. These are located within the [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-of-wsfederationhttpbinding.md) elements for the [\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) or custom bindings elements. Ensure that the addresses contain the expected domain names or other address information. It is important to check this information because the client authenticates to these addresses and may disclose information such as user name/password pairs. If the address is not the expected address, this could result in information disclosure to an unintended recipient.  \n  \n4.  Examine any additional [\\<issuedTokenParameters>](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtokenparameters.md) elements inside the commented out <`alternativeIssuedTokenParameters`> element. When using the Svcutil.exe tool to generate configuration for a federated service, if the federated service or any intermediate security token services do not specify an issuer address, but rather specify a metadata address for a security token service that exposes multiple endpoints, the resulting configuration file refers to the first endpoint. Additional endpoints are in the configuration file as commented-out <`alternativeIssuedTokenParameters`> elements.  \n  \n     Determine whether one of these <`issuedTokenParameters`> is preferable to the one already present in the configuration. For example, the client may prefer to authenticate to a security token service using a Windows [!INCLUDE[infocard](../../../../includes/infocard-md.md)] token rather than a user name/password pair.  \n  \n    > [!NOTE]\n    >  Where multiple security token services must be traversed before communicating with the service, it is possible for an intermediate security token service to direct the client to an incorrect security token service. Therefore, ensure that the endpoint for the security token service in the [\\<issuedTokenParameters>](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtokenparameters.md) is the expected security token service and not an unknown security token service.  \n  \n### To configure an IssuedTokenClientCredential in code  \n  \n1.  Access the <xref:System.ServiceModel.Security.IssuedTokenClientCredential> through the <xref:System.ServiceModel.Description.ClientCredentials.IssuedToken%2A> property of the <xref:System.ServiceModel.Description.ClientCredentials> class (returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class, or through the <xref:System.ServiceModel.ChannelFactory> class), as shown in the following example code.  \n  \n     [!code-csharp[c_CreateSTS#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#9)]\n     [!code-vb[c_CreateSTS#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#9)]  \n  \n2.  If token caching is not required, set the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.CacheIssuedTokens%2A> property to `false`. The <xref:System.ServiceModel.Security.IssuedTokenClientCredential.CacheIssuedTokens%2A> property controls whether such tokens from a security token service are cached. If this property is set to `false`, the client requests a new token from the security token service whenever it must re-authenticate itself to the federated service, regardless of whether a previous token is still valid. If this property is set to `true`, the client reuses an existing token whenever it must re-authenticate itself to the federated service (as long as the token has not expired). The default is `true`.  \n  \n3.  If a time limit is required on cached tokens, set the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.MaxIssuedTokenCachingTime%2A> property to a <xref:System.TimeSpan> value. The property specifies how long a token can be cached. After the specified time span has elapsed, the token is removed from the client cache. By default, tokens are cached indefinitely. The following example sets the time span to 10 minutes.  \n  \n     [!code-csharp[c_CreateSTS#15](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#15)]\n     [!code-vb[c_CreateSTS#15](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#15)]  \n  \n4.  Optional. Set the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.IssuedTokenRenewalThresholdPercentage%2A> to a percentage. The default is 60 (percent). The property specifies a percentage of the token's validity period. For example, if the issued token is valid for 10 hours and <xref:System.ServiceModel.Security.IssuedTokenClientCredential.IssuedTokenRenewalThresholdPercentage%2A> is set to 80, then the token is renewed after eight hours. The following example sets the value to 80 percent.  \n  \n     [!code-csharp[c_CreateSTS#16](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#16)]\n     [!code-vb[c_CreateSTS#16](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#16)]  \n  \n     The renewal interval determined by the token validity period and the `IssuedTokenRenewalThresholdPercentage` value is overridden by the `MaxIssuedTokenCachingTime` value in cases where the caching time is shorter than the renewal threshold time. For example, if the product of `IssuedTokenRenewalThresholdPercentage` and the token's duration is eight hours, and the `MaxIssuedTokenCachingTime` value is 10 minutes, the client contacts the security token service for an updated token every 10 minutes.  \n  \n5.  If a key entropy mode other than <xref:System.ServiceModel.Security.SecurityKeyEntropyMode.CombinedEntropy> is needed on a binding that does not use message security or transport security with message credentials (for example. the binding does not have a <xref:System.ServiceModel.Channels.SecurityBindingElement>), set the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.DefaultKeyEntropyMode%2A> property to an appropriate value. The *entropy* mode determines whether symmetric keys can be controlled using the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.DefaultKeyEntropyMode%2A> property. This default is <xref:System.ServiceModel.Security.SecurityKeyEntropyMode.CombinedEntropy>, where both the client and the token issuer provide data that is combined to produce the actual key. Other values are <xref:System.ServiceModel.Security.SecurityKeyEntropyMode.ClientEntropy> and <xref:System.ServiceModel.Security.SecurityKeyEntropyMode.ServerEntropy>, which means the entire key is specified by the client or the server, respectively. The following example sets the property to use only the server data for the key.  \n  \n     [!code-csharp[c_CreateSTS#17](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#17)]\n     [!code-vb[c_CreateSTS#17](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#17)]  \n  \n    > [!NOTE]\n    >  If a <xref:System.ServiceModel.Channels.SecurityBindingElement> is present in a security token service or service binding, the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.DefaultKeyEntropyMode%2A> set on <xref:System.ServiceModel.Security.IssuedTokenClientCredential> is overridden by the <xref:System.ServiceModel.Channels.SecurityBindingElement.KeyEntropyMode%2A> property of the `SecurityBindingElement`.  \n  \n6.  Configure any issuer-specific endpoint behaviors by adding them to the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.IssuerChannelBehaviors%2A> property.  \n  \n     [!code-csharp[c_CreateSTS#14](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#14)]\n     [!code-vb[c_CreateSTS#14](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#14)]  \n  \n### To configure the IssuedTokenClientCredential in configuration  \n  \n1.  Create an [\\<issuedToken>](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtoken.md) element as a child of the [\\<issuedToken>](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtoken.md) element in an endpoint behavior.  \n  \n2.  If token caching is not required, set the `cacheIssuedTokens` attribute (of the <`issuedToken`> element) to `false`.  \n  \n3.  If a time limit is required on cached tokens, set the `maxIssuedTokenCachingTime` attribute on the <`issuedToken`> element to an appropriate value. For example:  \n    `<issuedToken maxIssuedTokenCachingTime='00:10:00' />`  \n  \n4.  If a value other than the default is preferred, set the `issuedTokenRenewalThresholdPercentage` attribute on the <`issuedToken`> element to an appropriate value, for example:  \n  \n    ```xml  \n    <issuedToken issuedTokenRenewalThresholdPercentage = \"80\" />  \n    ```  \n  \n5.  If a key entropy mode other than `CombinedEntropy` is on a binding that does not use message security or transport security with message credentials (for example, the binding does not have a `SecurityBindingElement`), set the `defaultKeyEntropyMode` attribute on the `<issuedToken>` element to a either `ServerEntropy` or `ClientEntropy` as required.  \n  \n    ```xml  \n    <issuedToken defaultKeyEntropyMode = \"ServerEntropy\" />  \n    ```  \n  \n6.  Optional. Configure any issuer-specific custom endpoint behavior by creating an <`issuerChannelBehaviors`> element as a child of the <`issuedToken`> element. For each behavior, create an <`add`> element as a child of the <`issuerChannelBehaviors`> element. Specify the issuer address of the behavior by setting the `issuerAddress` attribute on the <`add`> element. Specify the behavior itself by setting the `behaviorConfiguration` attribute on the <`add`> element.  \n  \n    ```xml  \n    <issuerChannelBehaviors>  \n    <add issuerAddress=\"http://fabrikam.org/sts\" behaviorConfiguration=\"FabrikamSTS\" />  \n    </issuerChannelBehaviors>  \n    ```  \n  \n### To configure an X509CertificateRecipientClientCredential in code  \n  \n1.  Access the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential> through the <xref:System.ServiceModel.Description.ClientCredentials.ServiceCertificate%2A> property of the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class or the <xref:System.ServiceModel.ChannelFactory> property.  \n  \n     [!code-csharp[c_CreateSTS#18](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#18)]\n     [!code-vb[c_CreateSTS#18](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#18)]  \n  \n2.  If an <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> instance is available for the certificate for a given endpoint, use the <xref:System.Collections.Generic.ICollection%601.Add%2A> method of the collection returned by the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> property.  \n  \n     [!code-csharp[c_CreateSTS#19](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#19)]\n     [!code-vb[c_CreateSTS#19](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#19)]  \n  \n3.  If an <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> instance is not available, use the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.SetScopedCertificate%2A> method of the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential> class as shown in the following example.  \n  \n     [!code-csharp[c_CreateSTS#20](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#20)]\n     [!code-vb[c_CreateSTS#20](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#20)]  \n  \n### To configure an X509CertificateRecipientClientCredential in configuration  \n  \n1.  Create a [\\<scopedCertificates>](../../../../docs/framework/configure-apps/file-schema/wcf/scopedcertificates-element.md) element as a child of the [\\<serviceCertificate>](../../../../docs/framework/configure-apps/file-schema/wcf/servicecertificate-of-clientcredentials-element.md) element that is itself a child of the [\\<clientCredentials>](../../../../docs/framework/configure-apps/file-schema/wcf/clientcredentials.md) element in an endpoint behavior.  \n  \n2.  Create an `<add>` element as a child of the `<scopedCertificates>` element. Specify values for the `storeLocation`, `storeName`, `x509FindType`, and `findValue` attributes to refer to the appropriate certificate. Set the `targetUri` attribute to a value that provides the address of the endpoint that the certificate is to be used for, as shown in the following example.  \n  \n    ```xml  \n    <scopedCertificates>  \n     <add targetUri=\"http://fabrikam.com/sts\"   \n          storeLocation=\"CurrentUser\"  \n          storeName=\"TrustedPeople\"  \n          x509FindType=\"FindBySubjectName\"  \n          findValue=\"FabrikamSTS\" />  \n    </scopedCertificates>  \n    ```  \n  \n## Example  \n The following code sample configures an instance of the <xref:System.ServiceModel.Security.IssuedTokenClientCredential> class in code.  \n  \n [!code-csharp[c_FederatedClient#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_federatedclient/cs/source.cs#2)]\n [!code-vb[c_FederatedClient#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_federatedclient/vb/source.vb#2)]  \n  \n## .NET Framework Security  \n To prevent possible information disclosure, clients that are running the Svcutil.exe tool to process metadata from federated endpoints should ensure that the resulting security token service addresses are what they expect. This is especially important when a security token service exposes multiple endpoints, because the Svcutil.exe tool generates the resulting configuration file to use the first such endpoint, which may not be the one the client should be using.  \n  \n## LocalIssuer Required  \n If clients are expected to always use a local issuer, note the following: the default output of Svcutil.exe results in the local issuer not being used if the second-to-last security token service in the chain specifies an issuer address or issuer metadata address.  \n  \n For more information about setting the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerAddress%2A>, <xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerBinding%2A>, and <xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerChannelBehaviors%2A> properties of the <xref:System.ServiceModel.Security.IssuedTokenClientCredential> class, see [How to: Configure a Local Issuer](../../../../docs/framework/wcf/feature-details/how-to-configure-a-local-issuer.md).  \n  \n## Scoped Certificates  \n If service certificates must be specified for communicating with any of the security token services, typically because certificate negotiation is not being used, they can be specified using the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> property of the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential> class. The <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.SetDefaultCertificate%2A> method takes a <xref:System.Uri> and an <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> as parameters. The specified certificate is used when communicating with endpoints at the specified URI. Alternatively, you can use the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.SetScopedCertificate%2A> method to add a certificate to the collection returned by the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> property.  \n  \n> [!NOTE]\n>  The client idea of certificates that are scoped to a given URI applies only to applications that are making outbound calls to services that expose endpoints at those URIs. It does not apply to certificates that are used to sign issued tokens, such as those configured on the server in the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> of the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> class. For more information, see [How to: Configure Credentials on a Federation Service](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md).  \n  \n## See also\n\n- [Federation Sample](../../../../docs/framework/wcf/samples/federation-sample.md)\n- [How to: Disable Secure Sessions on a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-disable-secure-sessions-on-a-wsfederationhttpbinding.md)\n- [How to: Create a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)\n- [How to: Configure Credentials on a Federation Service](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md)\n- [How to: Configure a Local Issuer](../../../../docs/framework/wcf/feature-details/how-to-configure-a-local-issuer.md)\n- [Security Considerations with Metadata](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md)\n- [How to: Secure Metadata Endpoints](../../../../docs/framework/wcf/feature-details/how-to-secure-metadata-endpoints.md)\n","nodes":[{"pos":[4,212],"embed":true,"restype":"x-metadata","content":"title: \"How to: Create a Federated Client\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"WCF, federation\"\n  - \"federation\"\nms.assetid: 56ece47e-98bf-4346-b92b-fda1fc3b4d9c","nodes":[{"content":"How to: Create a Federated Client","nodes":[{"pos":[0,33],"content":"How to: Create a Federated Client","nodes":[{"content":"How to: Create a Federated Client","pos":[0,33]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[219,252],"content":"How to: Create a Federated Client","linkify":"How to: Create a Federated Client","nodes":[{"content":"How to: Create a Federated Client","pos":[0,33]}]},{"pos":[253,369],"content":"In Windows Communication Foundation (WCF), creating a client for a <bpt id=\"p1\">*</bpt>federated service<ept id=\"p1\">*</ept> consists of three main steps:","source":"In Windows Communication Foundation (WCF), creating a client for a *federated service* consists of three main steps:"},{"content":"Configure a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>wsFederationHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)</ept> or similar custom binding.","pos":[379,532],"source":"Configure a [\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) or similar custom binding."},{"content":"For more information about creating an appropriate binding, see <bpt id=\"p1\">[</bpt>How to: Create a WSFederationHttpBinding<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)</ept>.","pos":[533,731],"source":" For more information about creating an appropriate binding, see [How to: Create a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)."},{"content":"Alternatively, run the <bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept> against the metadata endpoint of the federated service to generate a configuration file for communicating with the federated service and one or more security token services.","pos":[732,1061],"source":" Alternatively, run the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) against the metadata endpoint of the federated service to generate a configuration file for communicating with the federated service and one or more security token services."},{"pos":[1071,1247],"content":"Set the properties of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential&gt;</ph> that controls various aspects of a client's interaction with a security token service.","source":"Set the properties of the <xref:System.ServiceModel.Security.IssuedTokenClientCredential> that controls various aspects of a client's interaction with a security token service."},{"pos":[1257,1472],"content":"Set the properties of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential&gt;</ph>, which allows certificates needed to communicate securely with given endpoints, such as security token services.","source":"Set the properties of the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential>, which allows certificates needed to communicate securely with given endpoints, such as security token services."},{"pos":[1480,2425],"content":"[!NOTE]\n A <xref:System.Security.Cryptography.CryptographicException> might be thrown when a client uses impersonated credentials, the <xref:System.ServiceModel.WSFederationHttpBinding> binding or a custom-issued token, and asymmetric keys. Asymmetric keys are used with the <xref:System.ServiceModel.WSFederationHttpBinding> binding and custom-issued tokens when the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedKeyType%2A> and <xref:System.ServiceModel.Security.Tokens.IssuedSecurityTokenParameters.KeyType%2A> properties, respectively, are set to <xref:System.IdentityModel.Tokens.SecurityKeyType.AsymmetricKey>. The <xref:System.Security.Cryptography.CryptographicException> is thrown when the client attempts to send a message and a user profile doesn’t exist for the identity that the client is impersonating. To mitigate this issue, log on to the client computer or call `LoadUserProfile` before sending the message.","leadings":["","> "],"nodes":[{"content":"A <xref:System.Security.Cryptography.CryptographicException> might be thrown when a client uses impersonated credentials, the <xref:System.ServiceModel.WSFederationHttpBinding> binding or a custom-issued token, and asymmetric keys. Asymmetric keys are used with the <xref:System.ServiceModel.WSFederationHttpBinding> binding and custom-issued tokens when the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedKeyType%2A> and <xref:System.ServiceModel.Security.Tokens.IssuedSecurityTokenParameters.KeyType%2A> properties, respectively, are set to <xref:System.IdentityModel.Tokens.SecurityKeyType.AsymmetricKey>. The <xref:System.Security.Cryptography.CryptographicException> is thrown when the client attempts to send a message and a user profile doesn’t exist for the identity that the client is impersonating. To mitigate this issue, log on to the client computer or call `LoadUserProfile` before sending the message.","pos":[9,943],"nodes":[{"content":"A <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.CryptographicException&gt;</ph> might be thrown when a client uses impersonated credentials, the <ph id=\"ph2\">&lt;xref:System.ServiceModel.WSFederationHttpBinding&gt;</ph> binding or a custom-issued token, and asymmetric keys.","pos":[0,231],"source":"A <xref:System.Security.Cryptography.CryptographicException> might be thrown when a client uses impersonated credentials, the <xref:System.ServiceModel.WSFederationHttpBinding> binding or a custom-issued token, and asymmetric keys."},{"content":"Asymmetric keys are used with the <ph id=\"ph1\">&lt;xref:System.ServiceModel.WSFederationHttpBinding&gt;</ph> binding and custom-issued tokens when the <ph id=\"ph2\">&lt;xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedKeyType%2A&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.ServiceModel.Security.Tokens.IssuedSecurityTokenParameters.KeyType%2A&gt;</ph> properties, respectively, are set to <ph id=\"ph4\">&lt;xref:System.IdentityModel.Tokens.SecurityKeyType.AsymmetricKey&gt;</ph>.","pos":[232,626],"source":" Asymmetric keys are used with the <xref:System.ServiceModel.WSFederationHttpBinding> binding and custom-issued tokens when the <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.IssuedKeyType%2A> and <xref:System.ServiceModel.Security.Tokens.IssuedSecurityTokenParameters.KeyType%2A> properties, respectively, are set to <xref:System.IdentityModel.Tokens.SecurityKeyType.AsymmetricKey>."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.CryptographicException&gt;</ph> is thrown when the client attempts to send a message and a user profile doesn’t exist for the identity that the client is impersonating.","pos":[627,826],"source":" The <xref:System.Security.Cryptography.CryptographicException> is thrown when the client attempts to send a message and a user profile doesn’t exist for the identity that the client is impersonating."},{"content":"To mitigate this issue, log on to the client computer or call <ph id=\"ph1\">`LoadUserProfile`</ph> before sending the message.","pos":[827,934],"source":" To mitigate this issue, log on to the client computer or call `LoadUserProfile` before sending the message."}]}]},{"content":"This topic provides detailed information about these procedures.","pos":[2432,2496]},{"content":"For more information about creating an appropriate binding, see <bpt id=\"p1\">[</bpt>How to: Create a WSFederationHttpBinding<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)</ept>.","pos":[2497,2695],"source":" For more information about creating an appropriate binding, see [How to: Create a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)."},{"content":"For more information about how a federated service works, see <bpt id=\"p1\">[</bpt>Federation<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/federation.md)</ept>.","pos":[2696,2833],"source":" For more information about how a federated service works, see [Federation](../../../../docs/framework/wcf/feature-details/federation.md)."},{"pos":[2843,2908],"content":"To generate and examine the configuration for a federated service","linkify":"To generate and examine the configuration for a federated service","nodes":[{"content":"To generate and examine the configuration for a federated service","pos":[0,65]}]},{"pos":[2918,3139],"content":"Run the <bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept> with the address of the metadata URL of the service as a command-line parameter.","source":"Run the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) with the address of the metadata URL of the service as a command-line parameter."},{"content":"Open the generated configuration file in an appropriate editor.","pos":[3149,3212]},{"content":"Examine the attributes and content of any generated <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>issuer&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/issuer.md)</ept> and <bpt id=\"p2\">[</bpt><ph id=\"ph2\">\\&lt;</ph>issuerMetadata&gt;<ept id=\"p2\">](../../../../docs/framework/configure-apps/file-schema/wcf/issuermetadata.md)</ept> elements.","pos":[3222,3465],"source":"Examine the attributes and content of any generated [\\<issuer>](../../../../docs/framework/configure-apps/file-schema/wcf/issuer.md) and [\\<issuerMetadata>](../../../../docs/framework/configure-apps/file-schema/wcf/issuermetadata.md) elements."},{"content":"These are located within the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>security&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/security-of-wsfederationhttpbinding.md)</ept> elements for the <bpt id=\"p2\">[</bpt><ph id=\"ph2\">\\&lt;</ph>wsFederationHttpBinding&gt;<ept id=\"p2\">](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)</ept> or custom bindings elements.","pos":[3466,3767],"source":" These are located within the [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-of-wsfederationhttpbinding.md) elements for the [\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) or custom bindings elements."},{"content":"Ensure that the addresses contain the expected domain names or other address information.","pos":[3768,3857]},{"content":"It is important to check this information because the client authenticates to these addresses and may disclose information such as user name/password pairs.","pos":[3858,4014]},{"content":"If the address is not the expected address, this could result in information disclosure to an unintended recipient.","pos":[4015,4130]},{"content":"Examine any additional <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>issuedTokenParameters&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtokenparameters.md)</ept> elements inside the commented out &lt;<ph id=\"ph2\">`alternativeIssuedTokenParameters`</ph>&gt; element.","pos":[4140,4353],"source":"Examine any additional [\\<issuedTokenParameters>](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtokenparameters.md) elements inside the commented out <`alternativeIssuedTokenParameters`> element."},{"content":"When using the Svcutil.exe tool to generate configuration for a federated service, if the federated service or any intermediate security token services do not specify an issuer address, but rather specify a metadata address for a security token service that exposes multiple endpoints, the resulting configuration file refers to the first endpoint.","pos":[4354,4702]},{"content":"Additional endpoints are in the configuration file as commented-out &lt;<ph id=\"ph1\">`alternativeIssuedTokenParameters`</ph>&gt; elements.","pos":[4703,4817],"source":" Additional endpoints are in the configuration file as commented-out <`alternativeIssuedTokenParameters`> elements."},{"content":"Determine whether one of these &lt;<ph id=\"ph1\">`issuedTokenParameters`</ph>&gt; is preferable to the one already present in the configuration.","pos":[4828,4947],"source":"Determine whether one of these <`issuedTokenParameters`> is preferable to the one already present in the configuration."},{"content":"For example, the client may prefer to authenticate to a security token service using a Windows <ph id=\"ph1\">[!INCLUDE[infocard](../../../../includes/infocard-md.md)]</ph> token rather than a user name/password pair.","pos":[4948,5145],"source":" For example, the client may prefer to authenticate to a security token service using a Windows [!INCLUDE[infocard](../../../../includes/infocard-md.md)] token rather than a user name/password pair."},{"pos":[5157,5653],"content":"[!NOTE]\nWhere multiple security token services must be traversed before communicating with the service, it is possible for an intermediate security token service to direct the client to an incorrect security token service. Therefore, ensure that the endpoint for the security token service in the [\\<issuedTokenParameters>](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtokenparameters.md) is the expected security token service and not an unknown security token service.","leadings":["","    >  "],"nodes":[{"content":"Where multiple security token services must be traversed before communicating with the service, it is possible for an intermediate security token service to direct the client to an incorrect security token service. Therefore, ensure that the endpoint for the security token service in the [\\<issuedTokenParameters>](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtokenparameters.md) is the expected security token service and not an unknown security token service.","pos":[8,489],"nodes":[{"content":"Where multiple security token services must be traversed before communicating with the service, it is possible for an intermediate security token service to direct the client to an incorrect security token service.","pos":[0,214]},{"content":"Therefore, ensure that the endpoint for the security token service in the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>issuedTokenParameters&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtokenparameters.md)</ept> is the expected security token service and not an unknown security token service.","pos":[215,481],"source":" Therefore, ensure that the endpoint for the security token service in the [\\<issuedTokenParameters>](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtokenparameters.md) is the expected security token service and not an unknown security token service."}]}]},{"pos":[5663,5714],"content":"To configure an IssuedTokenClientCredential in code","linkify":"To configure an IssuedTokenClientCredential in code","nodes":[{"content":"To configure an IssuedTokenClientCredential in code","pos":[0,51]}]},{"pos":[5724,6211],"content":"Access the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential&gt;</ph> through the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.ClientCredentials.IssuedToken%2A&gt;</ph> property of the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Description.ClientCredentials&gt;</ph> class (returned by the <ph id=\"ph4\">&lt;xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A&gt;</ph> property of the <ph id=\"ph5\">&lt;xref:System.ServiceModel.ClientBase%601&gt;</ph> class, or through the <ph id=\"ph6\">&lt;xref:System.ServiceModel.ChannelFactory&gt;</ph> class), as shown in the following example code.","source":"Access the <xref:System.ServiceModel.Security.IssuedTokenClientCredential> through the <xref:System.ServiceModel.Description.ClientCredentials.IssuedToken%2A> property of the <xref:System.ServiceModel.Description.ClientCredentials> class (returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class, or through the <xref:System.ServiceModel.ChannelFactory> class), as shown in the following example code."},{"pos":[6222,6447],"content":"[!code-csharp[c_CreateSTS#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#9)]\n [!code-vb[c_CreateSTS#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#9)]","leadings":["","    "],"nodes":[]},{"content":"If token caching is not required, set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential.CacheIssuedTokens%2A&gt;</ph> property to <ph id=\"ph2\">`false`</ph>.","pos":[6457,6604],"source":"If token caching is not required, set the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.CacheIssuedTokens%2A> property to `false`."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential.CacheIssuedTokens%2A&gt;</ph> property controls whether such tokens from a security token service are cached.","pos":[6605,6773],"source":" The <xref:System.ServiceModel.Security.IssuedTokenClientCredential.CacheIssuedTokens%2A> property controls whether such tokens from a security token service are cached."},{"content":"If this property is set to <ph id=\"ph1\">`false`</ph>, the client requests a new token from the security token service whenever it must re-authenticate itself to the federated service, regardless of whether a previous token is still valid.","pos":[6774,6994],"source":" If this property is set to `false`, the client requests a new token from the security token service whenever it must re-authenticate itself to the federated service, regardless of whether a previous token is still valid."},{"content":"If this property is set to <ph id=\"ph1\">`true`</ph>, the client reuses an existing token whenever it must re-authenticate itself to the federated service (as long as the token has not expired).","pos":[6995,7170],"source":" If this property is set to `true`, the client reuses an existing token whenever it must re-authenticate itself to the federated service (as long as the token has not expired)."},{"content":"The default is <ph id=\"ph1\">`true`</ph>.","pos":[7171,7193],"source":" The default is `true`."},{"content":"If a time limit is required on cached tokens, set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential.MaxIssuedTokenCachingTime%2A&gt;</ph> property to a <ph id=\"ph2\">&lt;xref:System.TimeSpan&gt;</ph> value.","pos":[7203,7393],"source":"If a time limit is required on cached tokens, set the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.MaxIssuedTokenCachingTime%2A> property to a <xref:System.TimeSpan> value."},{"content":"The property specifies how long a token can be cached.","pos":[7394,7448]},{"content":"After the specified time span has elapsed, the token is removed from the client cache.","pos":[7449,7535]},{"content":"By default, tokens are cached indefinitely.","pos":[7536,7579]},{"content":"The following example sets the time span to 10 minutes.","pos":[7580,7635]},{"pos":[7646,7875],"content":"[!code-csharp[c_CreateSTS#15](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#15)]\n [!code-vb[c_CreateSTS#15](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#15)]","leadings":["","    "],"nodes":[]},{"content":"Optional.","pos":[7885,7894]},{"content":"Set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential.IssuedTokenRenewalThresholdPercentage%2A&gt;</ph> to a percentage.","pos":[7895,8024],"source":" Set the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.IssuedTokenRenewalThresholdPercentage%2A> to a percentage."},{"content":"The default is 60 (percent).","pos":[8025,8053]},{"content":"The property specifies a percentage of the token's validity period.","pos":[8054,8121]},{"content":"For example, if the issued token is valid for 10 hours and <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential.IssuedTokenRenewalThresholdPercentage%2A&gt;</ph> is set to 80, then the token is renewed after eight hours.","pos":[8122,8344],"source":" For example, if the issued token is valid for 10 hours and <xref:System.ServiceModel.Security.IssuedTokenClientCredential.IssuedTokenRenewalThresholdPercentage%2A> is set to 80, then the token is renewed after eight hours."},{"content":"The following example sets the value to 80 percent.","pos":[8345,8396]},{"pos":[8407,8636],"content":"[!code-csharp[c_CreateSTS#16](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#16)]\n [!code-vb[c_CreateSTS#16](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#16)]","leadings":["","    "],"nodes":[]},{"content":"The renewal interval determined by the token validity period and the <ph id=\"ph1\">`IssuedTokenRenewalThresholdPercentage`</ph> value is overridden by the <ph id=\"ph2\">`MaxIssuedTokenCachingTime`</ph> value in cases where the caching time is shorter than the renewal threshold time.","pos":[8647,8892],"source":"The renewal interval determined by the token validity period and the `IssuedTokenRenewalThresholdPercentage` value is overridden by the `MaxIssuedTokenCachingTime` value in cases where the caching time is shorter than the renewal threshold time."},{"content":"For example, if the product of <ph id=\"ph1\">`IssuedTokenRenewalThresholdPercentage`</ph> and the token's duration is eight hours, and the <ph id=\"ph2\">`MaxIssuedTokenCachingTime`</ph> value is 10 minutes, the client contacts the security token service for an updated token every 10 minutes.","pos":[8893,9147],"source":" For example, if the product of `IssuedTokenRenewalThresholdPercentage` and the token's duration is eight hours, and the `MaxIssuedTokenCachingTime` value is 10 minutes, the client contacts the security token service for an updated token every 10 minutes."},{"content":"If a key entropy mode other than <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.SecurityKeyEntropyMode.CombinedEntropy&gt;</ph> is needed on a binding that does not use message security or transport security with message credentials (for example.","pos":[9157,9383],"source":"If a key entropy mode other than <xref:System.ServiceModel.Security.SecurityKeyEntropyMode.CombinedEntropy> is needed on a binding that does not use message security or transport security with message credentials (for example."},{"content":"the binding does not have a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.SecurityBindingElement&gt;</ph>), set the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential.DefaultKeyEntropyMode%2A&gt;</ph> property to an appropriate value.","pos":[9384,9603],"source":" the binding does not have a <xref:System.ServiceModel.Channels.SecurityBindingElement>), set the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.DefaultKeyEntropyMode%2A> property to an appropriate value."},{"content":"The <bpt id=\"p1\">*</bpt>entropy<ept id=\"p1\">*</ept> mode determines whether symmetric keys can be controlled using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential.DefaultKeyEntropyMode%2A&gt;</ph> property.","pos":[9604,9783],"source":" The *entropy* mode determines whether symmetric keys can be controlled using the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.DefaultKeyEntropyMode%2A> property."},{"content":"This default is <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.SecurityKeyEntropyMode.CombinedEntropy&gt;</ph>, where both the client and the token issuer provide data that is combined to produce the actual key.","pos":[9784,9975],"source":" This default is <xref:System.ServiceModel.Security.SecurityKeyEntropyMode.CombinedEntropy>, where both the client and the token issuer provide data that is combined to produce the actual key."},{"content":"Other values are <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.SecurityKeyEntropyMode.ClientEntropy&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.SecurityKeyEntropyMode.ServerEntropy&gt;</ph>, which means the entire key is specified by the client or the server, respectively.","pos":[9976,10226],"source":" Other values are <xref:System.ServiceModel.Security.SecurityKeyEntropyMode.ClientEntropy> and <xref:System.ServiceModel.Security.SecurityKeyEntropyMode.ServerEntropy>, which means the entire key is specified by the client or the server, respectively."},{"content":"The following example sets the property to use only the server data for the key.","pos":[10227,10307]},{"pos":[10318,10547],"content":"[!code-csharp[c_CreateSTS#17](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#17)]\n [!code-vb[c_CreateSTS#17](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#17)]","leadings":["","    "],"nodes":[]},{"pos":[10559,11000],"content":"[!NOTE]\nIf a <xref:System.ServiceModel.Channels.SecurityBindingElement> is present in a security token service or service binding, the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.DefaultKeyEntropyMode%2A> set on <xref:System.ServiceModel.Security.IssuedTokenClientCredential> is overridden by the <xref:System.ServiceModel.Channels.SecurityBindingElement.KeyEntropyMode%2A> property of the `SecurityBindingElement`.","leadings":["","    >  "],"nodes":[{"content":"If a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.SecurityBindingElement&gt;</ph> is present in a security token service or service binding, the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential.DefaultKeyEntropyMode%2A&gt;</ph> set on <ph id=\"ph3\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential&gt;</ph> is overridden by the <ph id=\"ph4\">&lt;xref:System.ServiceModel.Channels.SecurityBindingElement.KeyEntropyMode%2A&gt;</ph> property of the <ph id=\"ph5\">`SecurityBindingElement`</ph>.","pos":[8,434],"source":"If a <xref:System.ServiceModel.Channels.SecurityBindingElement> is present in a security token service or service binding, the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.DefaultKeyEntropyMode%2A> set on <xref:System.ServiceModel.Security.IssuedTokenClientCredential> is overridden by the <xref:System.ServiceModel.Channels.SecurityBindingElement.KeyEntropyMode%2A> property of the `SecurityBindingElement`."}]},{"pos":[11010,11207],"content":"Configure any issuer-specific endpoint behaviors by adding them to the collection returned by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential.IssuerChannelBehaviors%2A&gt;</ph> property.","source":"Configure any issuer-specific endpoint behaviors by adding them to the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.IssuerChannelBehaviors%2A> property."},{"pos":[11218,11447],"content":"[!code-csharp[c_CreateSTS#14](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#14)]\n [!code-vb[c_CreateSTS#14](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#14)]","leadings":["","    "],"nodes":[]},{"pos":[11457,11518],"content":"To configure the IssuedTokenClientCredential in configuration","linkify":"To configure the IssuedTokenClientCredential in configuration","nodes":[{"content":"To configure the IssuedTokenClientCredential in configuration","pos":[0,61]}]},{"pos":[11528,11778],"content":"Create an <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>issuedToken&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtoken.md)</ept> element as a child of the <bpt id=\"p2\">[</bpt><ph id=\"ph2\">\\&lt;</ph>issuedToken&gt;<ept id=\"p2\">](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtoken.md)</ept> element in an endpoint behavior.","source":"Create an [\\<issuedToken>](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtoken.md) element as a child of the [\\<issuedToken>](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtoken.md) element in an endpoint behavior."},{"pos":[11788,11904],"content":"If token caching is not required, set the <ph id=\"ph1\">`cacheIssuedTokens`</ph> attribute (of the &lt;<ph id=\"ph2\">`issuedToken`</ph>&gt; element) to <ph id=\"ph3\">`false`</ph>.","source":"If token caching is not required, set the `cacheIssuedTokens` attribute (of the <`issuedToken`> element) to `false`."},{"pos":[11914,12135],"content":"If a time limit is required on cached tokens, set the `maxIssuedTokenCachingTime` attribute on the <`issuedToken`> element to an appropriate value. For example:  \n`<issuedToken maxIssuedTokenCachingTime='00:10:00' />`","leadings":["","    "],"nodes":[{"content":"If a time limit is required on cached tokens, set the `maxIssuedTokenCachingTime` attribute on the <`issuedToken`> element to an appropriate value. For example:","pos":[0,160],"nodes":[{"content":"If a time limit is required on cached tokens, set the <ph id=\"ph1\">`maxIssuedTokenCachingTime`</ph> attribute on the &lt;<ph id=\"ph2\">`issuedToken`</ph>&gt; element to an appropriate value.","pos":[0,147],"source":"If a time limit is required on cached tokens, set the `maxIssuedTokenCachingTime` attribute on the <`issuedToken`> element to an appropriate value."},{"content":"For example:","pos":[148,160]}]}]},{"pos":[12145,12319],"content":"If a value other than the default is preferred, set the <ph id=\"ph1\">`issuedTokenRenewalThresholdPercentage`</ph> attribute on the &lt;<ph id=\"ph2\">`issuedToken`</ph>&gt; element to an appropriate value, for example:","source":"If a value other than the default is preferred, set the `issuedTokenRenewalThresholdPercentage` attribute on the <`issuedToken`> element to an appropriate value, for example:"},{"pos":[12422,12772],"content":"If a key entropy mode other than <ph id=\"ph1\">`CombinedEntropy`</ph> is on a binding that does not use message security or transport security with message credentials (for example, the binding does not have a <ph id=\"ph2\">`SecurityBindingElement`</ph>), set the <ph id=\"ph3\">`defaultKeyEntropyMode`</ph> attribute on the <ph id=\"ph4\">`&lt;issuedToken&gt;`</ph> element to a either <ph id=\"ph5\">`ServerEntropy`</ph> or <ph id=\"ph6\">`ClientEntropy`</ph> as required.","source":"If a key entropy mode other than `CombinedEntropy` is on a binding that does not use message security or transport security with message credentials (for example, the binding does not have a `SecurityBindingElement`), set the `defaultKeyEntropyMode` attribute on the `<issuedToken>` element to a either `ServerEntropy` or `ClientEntropy` as required."},{"content":"Optional.","pos":[12870,12879]},{"content":"Configure any issuer-specific custom endpoint behavior by creating an &lt;<ph id=\"ph1\">`issuerChannelBehaviors`</ph>&gt; element as a child of the &lt;<ph id=\"ph2\">`issuedToken`</ph>&gt; element.","pos":[12880,13027],"source":" Configure any issuer-specific custom endpoint behavior by creating an <`issuerChannelBehaviors`> element as a child of the <`issuedToken`> element."},{"content":"For each behavior, create an &lt;<ph id=\"ph1\">`add`</ph>&gt; element as a child of the &lt;<ph id=\"ph2\">`issuerChannelBehaviors`</ph>&gt; element.","pos":[13028,13126],"source":" For each behavior, create an <`add`> element as a child of the <`issuerChannelBehaviors`> element."},{"content":"Specify the issuer address of the behavior by setting the <ph id=\"ph1\">`issuerAddress`</ph> attribute on the &lt;<ph id=\"ph2\">`add`</ph>&gt; element.","pos":[13127,13234],"source":" Specify the issuer address of the behavior by setting the `issuerAddress` attribute on the <`add`> element."},{"content":"Specify the behavior itself by setting the <ph id=\"ph1\">`behaviorConfiguration`</ph> attribute on the &lt;<ph id=\"ph2\">`add`</ph>&gt; element.","pos":[13235,13335],"source":" Specify the behavior itself by setting the `behaviorConfiguration` attribute on the <`add`> element."},{"pos":[13524,13588],"content":"To configure an X509CertificateRecipientClientCredential in code","linkify":"To configure an X509CertificateRecipientClientCredential in code","nodes":[{"content":"To configure an X509CertificateRecipientClientCredential in code","pos":[0,64]}]},{"pos":[13598,13978],"content":"Access the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential&gt;</ph> through the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.ClientCredentials.ServiceCertificate%2A&gt;</ph> property of the <ph id=\"ph3\">&lt;xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A&gt;</ph> property of the <ph id=\"ph4\">&lt;xref:System.ServiceModel.ClientBase%601&gt;</ph> class or the <ph id=\"ph5\">&lt;xref:System.ServiceModel.ChannelFactory&gt;</ph> property.","source":"Access the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential> through the <xref:System.ServiceModel.Description.ClientCredentials.ServiceCertificate%2A> property of the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class or the <xref:System.ServiceModel.ChannelFactory> property."},{"pos":[13989,14218],"content":"[!code-csharp[c_CreateSTS#18](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#18)]\n [!code-vb[c_CreateSTS#18](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#18)]","leadings":["","    "],"nodes":[]},{"pos":[14228,14582],"content":"If an <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.X509Certificates.X509Certificate2&gt;</ph> instance is available for the certificate for a given endpoint, use the <ph id=\"ph2\">&lt;xref:System.Collections.Generic.ICollection%601.Add%2A&gt;</ph> method of the collection returned by the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A&gt;</ph> property.","source":"If an <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> instance is available for the certificate for a given endpoint, use the <xref:System.Collections.Generic.ICollection%601.Add%2A> method of the collection returned by the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> property."},{"pos":[14593,14822],"content":"[!code-csharp[c_CreateSTS#19](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#19)]\n [!code-vb[c_CreateSTS#19](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#19)]","leadings":["","    "],"nodes":[]},{"pos":[14832,15175],"content":"If an <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.X509Certificates.X509Certificate2&gt;</ph> instance is not available, use the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.SetScopedCertificate%2A&gt;</ph> method of the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential&gt;</ph> class as shown in the following example.","source":"If an <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> instance is not available, use the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.SetScopedCertificate%2A> method of the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential> class as shown in the following example."},{"pos":[15186,15415],"content":"[!code-csharp[c_CreateSTS#20](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#20)]\n [!code-vb[c_CreateSTS#20](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#20)]","leadings":["","    "],"nodes":[]},{"pos":[15425,15498],"content":"To configure an X509CertificateRecipientClientCredential in configuration","linkify":"To configure an X509CertificateRecipientClientCredential in configuration","nodes":[{"content":"To configure an X509CertificateRecipientClientCredential in configuration","pos":[0,73]}]},{"pos":[15508,15963],"content":"Create a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>scopedCertificates&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/scopedcertificates-element.md)</ept> element as a child of the <bpt id=\"p2\">[</bpt><ph id=\"ph2\">\\&lt;</ph>serviceCertificate&gt;<ept id=\"p2\">](../../../../docs/framework/configure-apps/file-schema/wcf/servicecertificate-of-clientcredentials-element.md)</ept> element that is itself a child of the <bpt id=\"p3\">[</bpt><ph id=\"ph3\">\\&lt;</ph>clientCredentials&gt;<ept id=\"p3\">](../../../../docs/framework/configure-apps/file-schema/wcf/clientcredentials.md)</ept> element in an endpoint behavior.","source":"Create a [\\<scopedCertificates>](../../../../docs/framework/configure-apps/file-schema/wcf/scopedcertificates-element.md) element as a child of the [\\<serviceCertificate>](../../../../docs/framework/configure-apps/file-schema/wcf/servicecertificate-of-clientcredentials-element.md) element that is itself a child of the [\\<clientCredentials>](../../../../docs/framework/configure-apps/file-schema/wcf/clientcredentials.md) element in an endpoint behavior."},{"content":"Create an <ph id=\"ph1\">`&lt;add&gt;`</ph> element as a child of the <ph id=\"ph2\">`&lt;scopedCertificates&gt;`</ph> element.","pos":[15973,16048],"source":"Create an `<add>` element as a child of the `<scopedCertificates>` element."},{"content":"Specify values for the <ph id=\"ph1\">`storeLocation`</ph>, <ph id=\"ph2\">`storeName`</ph>, <ph id=\"ph3\">`x509FindType`</ph>, and <ph id=\"ph4\">`findValue`</ph> attributes to refer to the appropriate certificate.","pos":[16049,16185],"source":" Specify values for the `storeLocation`, `storeName`, `x509FindType`, and `findValue` attributes to refer to the appropriate certificate."},{"content":"Set the <ph id=\"ph1\">`targetUri`</ph> attribute to a value that provides the address of the endpoint that the certificate is to be used for, as shown in the following example.","pos":[16186,16343],"source":" Set the `targetUri` attribute to a value that provides the address of the endpoint that the certificate is to be used for, as shown in the following example."},{"pos":[16644,16651],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"pos":[16655,16789],"content":"The following code sample configures an instance of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential&gt;</ph> class in code.","source":"The following code sample configures an instance of the <xref:System.ServiceModel.Security.IssuedTokenClientCredential> class in code."},{"pos":[17050,17073],"content":".NET Framework Security","linkify":".NET Framework Security","nodes":[{"content":".NET Framework Security","pos":[0,23]}]},{"content":"To prevent possible information disclosure, clients that are running the Svcutil.exe tool to process metadata from federated endpoints should ensure that the resulting security token service addresses are what they expect.","pos":[17077,17299]},{"content":"This is especially important when a security token service exposes multiple endpoints, because the Svcutil.exe tool generates the resulting configuration file to use the first such endpoint, which may not be the one the client should be using.","pos":[17300,17543]},{"pos":[17552,17572],"content":"LocalIssuer Required","linkify":"LocalIssuer Required","nodes":[{"content":"LocalIssuer Required","pos":[0,20]}]},{"content":"If clients are expected to always use a local issuer, note the following: the default output of Svcutil.exe results in the local issuer not being used if the second-to-last security token service in the chain specifies an issuer address or issuer metadata address.","pos":[17576,17840]},{"pos":[17847,18370],"content":"For more information about setting the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerAddress%2A&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerBinding%2A&gt;</ph>, and <ph id=\"ph3\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerChannelBehaviors%2A&gt;</ph> properties of the <ph id=\"ph4\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential&gt;</ph> class, see <bpt id=\"p1\">[</bpt>How to: Configure a Local Issuer<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-configure-a-local-issuer.md)</ept>.","source":"For more information about setting the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerAddress%2A>, <xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerBinding%2A>, and <xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerChannelBehaviors%2A> properties of the <xref:System.ServiceModel.Security.IssuedTokenClientCredential> class, see [How to: Configure a Local Issuer](../../../../docs/framework/wcf/feature-details/how-to-configure-a-local-issuer.md)."},{"pos":[18379,18398],"content":"Scoped Certificates","linkify":"Scoped Certificates","nodes":[{"content":"Scoped Certificates","pos":[0,19]}]},{"content":"If service certificates must be specified for communicating with any of the security token services, typically because certificate negotiation is not being used, they can be specified using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A&gt;</ph> property of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential&gt;</ph> class.","pos":[18402,18794],"source":"If service certificates must be specified for communicating with any of the security token services, typically because certificate negotiation is not being used, they can be specified using the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> property of the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential> class."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.SetDefaultCertificate%2A&gt;</ph> method takes a <ph id=\"ph2\">&lt;xref:System.Uri&gt;</ph> and an <ph id=\"ph3\">&lt;xref:System.Security.Cryptography.X509Certificates.X509Certificate2&gt;</ph> as parameters.","pos":[18795,19025],"source":" The <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.SetDefaultCertificate%2A> method takes a <xref:System.Uri> and an <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> as parameters."},{"content":"The specified certificate is used when communicating with endpoints at the specified URI.","pos":[19026,19115]},{"content":"Alternatively, you can use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.SetScopedCertificate%2A&gt;</ph> method to add a certificate to the collection returned by the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A&gt;</ph> property.","pos":[19116,19418],"source":" Alternatively, you can use the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.SetScopedCertificate%2A> method to add a certificate to the collection returned by the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> property."},{"pos":[19426,20104],"content":"[!NOTE]\n The client idea of certificates that are scoped to a given URI applies only to applications that are making outbound calls to services that expose endpoints at those URIs. It does not apply to certificates that are used to sign issued tokens, such as those configured on the server in the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> of the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> class. For more information, see [How to: Configure Credentials on a Federation Service](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md).","leadings":["","> "],"nodes":[{"content":"The client idea of certificates that are scoped to a given URI applies only to applications that are making outbound calls to services that expose endpoints at those URIs. It does not apply to certificates that are used to sign issued tokens, such as those configured on the server in the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> of the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> class. For more information, see [How to: Configure Credentials on a Federation Service](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md).","pos":[9,676],"nodes":[{"content":"The client idea of certificates that are scoped to a given URI applies only to applications that are making outbound calls to services that expose endpoints at those URIs.","pos":[0,171]},{"content":"It does not apply to certificates that are used to sign issued tokens, such as those configured on the server in the collection returned by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A&gt;</ph> of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential&gt;</ph> class.","pos":[172,480],"source":" It does not apply to certificates that are used to sign issued tokens, such as those configured on the server in the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> of the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> class."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>How to: Configure Credentials on a Federation Service<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md)</ept>.","pos":[481,667],"source":" For more information, see [How to: Configure Credentials on a Federation Service](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md)."}]}]},{"pos":[20113,20121],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[20125,20205],"content":"<bpt id=\"p1\">[</bpt>Federation Sample<ept id=\"p1\">](../../../../docs/framework/wcf/samples/federation-sample.md)</ept>","source":"[Federation Sample](../../../../docs/framework/wcf/samples/federation-sample.md)"},{"pos":[20208,20381],"content":"<bpt id=\"p1\">[</bpt>How to: Disable Secure Sessions on a WSFederationHttpBinding<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-disable-secure-sessions-on-a-wsfederationhttpbinding.md)</ept>","source":"[How to: Disable Secure Sessions on a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-disable-secure-sessions-on-a-wsfederationhttpbinding.md)"},{"pos":[20384,20517],"content":"<bpt id=\"p1\">[</bpt>How to: Create a WSFederationHttpBinding<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)</ept>","source":"[How to: Create a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)"},{"pos":[20520,20679],"content":"<bpt id=\"p1\">[</bpt>How to: Configure Credentials on a Federation Service<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md)</ept>","source":"[How to: Configure Credentials on a Federation Service](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md)"},{"pos":[20682,20799],"content":"<bpt id=\"p1\">[</bpt>How to: Configure a Local Issuer<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-configure-a-local-issuer.md)</ept>","source":"[How to: Configure a Local Issuer](../../../../docs/framework/wcf/feature-details/how-to-configure-a-local-issuer.md)"},{"pos":[20802,20930],"content":"<bpt id=\"p1\">[</bpt>Security Considerations with Metadata<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md)</ept>","source":"[Security Considerations with Metadata](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md)"},{"pos":[20933,21052],"content":"<bpt id=\"p1\">[</bpt>How to: Secure Metadata Endpoints<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-secure-metadata-endpoints.md)</ept>","source":"[How to: Secure Metadata Endpoints](../../../../docs/framework/wcf/feature-details/how-to-secure-metadata-endpoints.md)"}]}