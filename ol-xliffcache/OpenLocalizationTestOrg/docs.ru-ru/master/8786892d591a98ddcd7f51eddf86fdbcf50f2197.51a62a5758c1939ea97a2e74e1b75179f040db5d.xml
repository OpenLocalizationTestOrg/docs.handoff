{"content":"---\ntitle: ConnectServerWmi function (Unmanaged API Reference)\ndescription: The ConnectServerWmi function uses DCOM to create a connection to a WMI namespace.\nms.date: \"11/06/2017\"\napi_name: \n  - \"ConnectServerWmi\"\napi_location: \n  - \"WMINet_Utils.dll\"\napi_type: \n  - \"DLLExport\"\nf1_keywords: \n  - \"ConnectServerWmi\"\nhelpviewer_keywords: \n  - \"ConnectServerWmi function [.NET WMI and performance counters]\"\ntopic_type: \n  - \"Reference\"\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\n---\n# ConnectServerWmi function\nCreates a connection through DCOM to a WMI namespace on a specified computer.\n\n[!INCLUDE[internalonly-unmanaged](../../../../includes/internalonly-unmanaged.md)]\n\n## Syntax\n\n```\nHRESULT ConnectServerWmi (\n   [in] BSTR               strNetworkResource,\n   [in] BSTR               strUser,\n   [in] BSTR               strPassword,\n   [in] BSTR               strLocale,\n   [in] long               lSecurityFlags,\n   [in] BSTR               strAuthority,\n   [in] IWbemContext*      pCtx,\n   [out] IWbemServices**   ppNamespace,\n   [in] DWORD              impLevel, \n   [in] DWORD              authLevel\n);\n```\n## Parameters\n\n`strNetworkResource`\\\n[in] Pointer to a valid `BSTR` that contains the object path of the correct WMI namespace. See the [Remarks](#remarks) section for more information.\n\n`strUser`\\\n[in] A pointer to a valid `BSTR` that contains the user name. A `null` value indicates the current security context. If the user is from a different domain than the current one, `strUser` can also contain the domain and user name separated by a backslash. `strUser` can also be in user principal name (UPN) format, such as `userName@domainName`. See the [Remarks](#remarks) section for more information.\n\n`strPassword`\\\n[in] A pointer to a valid `BSTR` that contains the password. A `null` indicates the current security context. An empty string (\"\") indicates a valid zero-length password.\n\n`strLocale`\\\n[in] A pointer to a valid `BSTR` that indicates the correct locale for information retrieval. For Microsoft locale identifiers, the format of the string is \"MS\\_*xxx*\", where *xxx* is a string in hexadecimal form that indicates the locale identifier (LCID). If an invalid locale is specified, the method returns `WBEM_E_INVALID_PARAMETER` except on Windows 7, where the default locale of the server is used instead. If `null1, the current locale is used. \n \n`lSecurityFlags`\\\n[in] Flags to pass to the `ConnectServerWmi` method. A value of zero (0) for this parameter results in the call to `ConnectServerWmi` returning only after a connection to the server is established. This could result in an application not responding indefinitely if the server is broken. The other valid values are:\n\n| Constant  | Value  | Description  |\n|---------|---------|---------|\n| `CONNECT_REPOSITORY_ONLY` | 0x40 | Reserved for internal use. Do not use. |\n| `WBEM_FLAG_CONNECT_USE_MAX_WAIT` | 0x80 | `ConnectServerWmi` returns in two minutes or less. |\n\n`strAuthority`\\\n[in] The domain name of the user. It can have the following values:\n\n| Value | Description |\n|---------|---------|\n| blank | NTLM authentication is used, and the NTLM domain of the current user is used. If `strUser` specifies the domain (the recommended location), it must not be specified here. The function returns `WBEM_E_INVALID_PARAMETER` if you specify the domain in both parameters. |\n| Kerberos:*principal name* | Kerberos authentication is used, and this parameter contains a Kerberos principal name. |\n| NTLMDOMAIN:*domain name* | NT LAN Manager authentication is used, and this parameter contains an NTLM domain name. |\n\n`pCtx`\\\n[in] Typically, this parameter is `null`. Otherwise, it is a pointer to an [IWbemContext](/windows/desktop/api/wbemcli/nn-wbemcli-iwbemcontext) object required by one or more dynamic class providers. \n\n`ppNamespace`\\\n[out] When the function returns, receives a pointer to an [IWbemServices](/windows/desktop/api/wbemcli/nn-wbemcli-iwbemservices) object bound to the specified namespace. It is set to point to `null` when there is an error.\n\n`impLevel`\\\n[in] The impersonation level.\n\n`authLevel`\\\n[in] The authorization level.\n\n## Return value\n\nThe following values returned by this function are defined in the *WbemCli.h* header file, or you can define them as constants in your code:\n\n|Constant  |Value  |Description  |\n|---------|---------|---------|\n| `WBEM_E_FAILED` | 0x80041001 | There has been a general failure. |\n| `WBEM_E_INVALID_PARAMETER` | 0x80041008 | A parameter is not valid. |\n| `WBEM_E_OUT_OF_MEMORY` | 0x80041006 | Not enough memory is available to complete the operation. |\n| `WBEM_S_NO_ERROR` | 0 | The function call was successful.  |\n\n## Remarks\n\nThis function wraps a call to the [IWbemLocator::ConnectServer](/windows/desktop/api/wbemcli/nf-wbemcli-iwbemlocator-connectserver) method.\n\nFor local access to the default namespace, `strNetworkResource` can be a simple object path: \"root\\default\" or \"\\\\.\\root\\default\". For access to the default namespace on a remote computer using COM or Microsoft-compatible networking, include the computer name: \"\\\\myserver\\root\\default\". The computer name also can be a DNS name or IP address. The `ConnectServerWmi` function can also connect with computers running IPv6 using an IPv6 address.\n\n`strUser` cannot be an empty string. If the domain is specified in `strAuthority`, it must not also be included in `strUser`, or the function returns `WBEM_E_INVALID_PARAMETER`.\n\n## Requirements\n\n **Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md).\n\n **Header:** WMINet_Utils.idl\n\n **.NET Framework Versions:** [!INCLUDE[net_current_v472plus](../../../../includes/net-current-v472plus.md)]\n\n## See also\n\n- [WMI and Performance Counters (Unmanaged API Reference)](index.md)","nodes":[{"pos":[4,475],"embed":true,"restype":"x-metadata","content":"title: ConnectServerWmi function (Unmanaged API Reference)\ndescription: The ConnectServerWmi function uses DCOM to create a connection to a WMI namespace.\nms.date: \"11/06/2017\"\napi_name: \n  - \"ConnectServerWmi\"\napi_location: \n  - \"WMINet_Utils.dll\"\napi_type: \n  - \"DLLExport\"\nf1_keywords: \n  - \"ConnectServerWmi\"\nhelpviewer_keywords: \n  - \"ConnectServerWmi function [.NET WMI and performance counters]\"\ntopic_type: \n  - \"Reference\"\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"","nodes":[{"content":"ConnectServerWmi function (Unmanaged API Reference)","nodes":[{"pos":[0,51],"content":"ConnectServerWmi function (Unmanaged API Reference)","nodes":[{"content":"ConnectServerWmi function (Unmanaged API Reference)","pos":[0,51]}]}],"path":["title"],"nosxs":false},{"content":"The ConnectServerWmi function uses DCOM to create a connection to a WMI namespace.","nodes":[{"pos":[0,82],"content":"The ConnectServerWmi function uses DCOM to create a connection to a WMI namespace.","nodes":[{"content":"The ConnectServerWmi function uses DCOM to create a connection to a WMI namespace.","pos":[0,82]}]}],"path":["description"],"nosxs":false}],"yml":true},{"pos":[482,507],"content":"ConnectServerWmi function","linkify":"ConnectServerWmi function","nodes":[{"content":"ConnectServerWmi function","pos":[0,25]}]},{"content":"Creates a connection through DCOM to a WMI namespace on a specified computer.","pos":[508,585]},{"pos":[674,680],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[1116,1126],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"[in] Pointer to a valid <ph id=\"ph1\">`BSTR`</ph> that contains the object path of the correct WMI namespace.","pos":[1150,1240],"source":"[in] Pointer to a valid `BSTR` that contains the object path of the correct WMI namespace."},{"content":"See the <bpt id=\"p1\">[</bpt>Remarks<ept id=\"p1\">](#remarks)</ept> section for more information.","pos":[1241,1298],"source":" See the [Remarks](#remarks) section for more information."},{"content":"[in] A pointer to a valid <ph id=\"ph1\">`BSTR`</ph> that contains the user name.","pos":[1311,1372],"source":"[in] A pointer to a valid `BSTR` that contains the user name."},{"content":"A <ph id=\"ph1\">`null`</ph> value indicates the current security context.","pos":[1373,1427],"source":" A `null` value indicates the current security context."},{"content":"If the user is from a different domain than the current one, <ph id=\"ph1\">`strUser`</ph> can also contain the domain and user name separated by a backslash.","pos":[1428,1566],"source":" If the user is from a different domain than the current one, `strUser` can also contain the domain and user name separated by a backslash."},{"content":"<ph id=\"ph1\">`strUser`</ph> can also be in user principal name (UPN) format, such as <ph id=\"ph2\">`userName@domainName`</ph>.","pos":[1567,1656],"source":"`strUser` can also be in user principal name (UPN) format, such as `userName@domainName`."},{"content":"See the <bpt id=\"p1\">[</bpt>Remarks<ept id=\"p1\">](#remarks)</ept> section for more information.","pos":[1657,1714],"source":" See the [Remarks](#remarks) section for more information."},{"content":"[in] A pointer to a valid <ph id=\"ph1\">`BSTR`</ph> that contains the password.","pos":[1731,1791],"source":"[in] A pointer to a valid `BSTR` that contains the password."},{"content":"A <ph id=\"ph1\">`null`</ph> indicates the current security context.","pos":[1792,1840],"source":" A `null` indicates the current security context."},{"content":"An empty string (\"\") indicates a valid zero-length password.","pos":[1841,1901]},{"content":"[in] A pointer to a valid <ph id=\"ph1\">`BSTR`</ph> that indicates the correct locale for information retrieval.","pos":[1916,2009],"source":"[in] A pointer to a valid `BSTR` that indicates the correct locale for information retrieval."},{"content":"For Microsoft locale identifiers, the format of the string is \"MS<ph id=\"ph1\">\\_</ph><bpt id=\"p1\">*</bpt>xxx<ept id=\"p1\">*</ept>\", where <bpt id=\"p2\">*</bpt>xxx<ept id=\"p2\">*</ept> is a string in hexadecimal form that indicates the locale identifier (LCID).","pos":[2010,2173],"source":" For Microsoft locale identifiers, the format of the string is \"MS\\_*xxx*\", where *xxx* is a string in hexadecimal form that indicates the locale identifier (LCID)."},{"content":"If an invalid locale is specified, the method returns <ph id=\"ph1\">`WBEM_E_INVALID_PARAMETER`</ph> except on Windows 7, where the default locale of the server is used instead.","pos":[2174,2331],"source":" If an invalid locale is specified, the method returns `WBEM_E_INVALID_PARAMETER` except on Windows 7, where the default locale of the server is used instead."},{"content":"If `null1, the current locale is used.","pos":[2332,2370]},{"content":"[in] Flags to pass to the <ph id=\"ph1\">`ConnectServerWmi`</ph> method.","pos":[2392,2444],"source":"[in] Flags to pass to the `ConnectServerWmi` method."},{"content":"A value of zero (0) for this parameter results in the call to <ph id=\"ph1\">`ConnectServerWmi`</ph> returning only after a connection to the server is established.","pos":[2445,2589],"source":" A value of zero (0) for this parameter results in the call to `ConnectServerWmi` returning only after a connection to the server is established."},{"content":"This could result in an application not responding indefinitely if the server is broken.","pos":[2590,2678]},{"content":"The other valid values are:","pos":[2679,2706]},{"content":"Constant","pos":[2710,2718]},{"content":"Value","pos":[2722,2727]},{"content":"Description","pos":[2731,2742]},{"content":"0x40","pos":[2808,2812]},{"content":"Reserved for internal use.","pos":[2815,2841]},{"content":"Do not use.","pos":[2842,2853]},{"content":"0x80","pos":[2893,2897]},{"pos":[2900,2950],"content":"<ph id=\"ph1\">`ConnectServerWmi`</ph> returns in two minutes or less.","source":"`ConnectServerWmi` returns in two minutes or less."},{"content":"[in] The domain name of the user.","pos":[2970,3003]},{"content":"It can have the following values:","pos":[3004,3037]},{"content":"Value","pos":[3041,3046]},{"content":"Description","pos":[3049,3060]},{"content":"blank","pos":[3087,3092]},{"content":"NTLM authentication is used, and the NTLM domain of the current user is used.","pos":[3095,3172]},{"content":"If <ph id=\"ph1\">`strUser`</ph> specifies the domain (the recommended location), it must not be specified here.","pos":[3173,3265],"source":" If `strUser` specifies the domain (the recommended location), it must not be specified here."},{"content":"The function returns <ph id=\"ph1\">`WBEM_E_INVALID_PARAMETER`</ph> if you specify the domain in both parameters.","pos":[3266,3359],"source":" The function returns `WBEM_E_INVALID_PARAMETER` if you specify the domain in both parameters."},{"pos":[3364,3389],"content":"Kerberos:<bpt id=\"p1\">*</bpt>principal name<ept id=\"p1\">*</ept>","source":"Kerberos:*principal name*"},{"content":"Kerberos authentication is used, and this parameter contains a Kerberos principal name.","pos":[3392,3479]},{"pos":[3484,3508],"content":"NTLMDOMAIN:<bpt id=\"p1\">*</bpt>domain name<ept id=\"p1\">*</ept>","source":"NTLMDOMAIN:*domain name*"},{"content":"NT LAN Manager authentication is used, and this parameter contains an NTLM domain name.","pos":[3511,3598]},{"content":"[in] Typically, this parameter is <ph id=\"ph1\">`null`</ph>.","pos":[3610,3651],"source":"[in] Typically, this parameter is `null`."},{"content":"Otherwise, it is a pointer to an <bpt id=\"p1\">[</bpt>IWbemContext<ept id=\"p1\">](/windows/desktop/api/wbemcli/nn-wbemcli-iwbemcontext)</ept> object required by one or more dynamic class providers.","pos":[3652,3809],"source":" Otherwise, it is a pointer to an [IWbemContext](/windows/desktop/api/wbemcli/nn-wbemcli-iwbemcontext) object required by one or more dynamic class providers."},{"content":"[out] When the function returns, receives a pointer to an <bpt id=\"p1\">[</bpt>IWbemServices<ept id=\"p1\">](/windows/desktop/api/wbemcli/nn-wbemcli-iwbemservices)</ept> object bound to the specified namespace.","pos":[3827,3996],"source":"[out] When the function returns, receives a pointer to an [IWbemServices](/windows/desktop/api/wbemcli/nn-wbemcli-iwbemservices) object bound to the specified namespace."},{"content":"It is set to point to <ph id=\"ph1\">`null`</ph> when there is an error.","pos":[3997,4049],"source":" It is set to point to `null` when there is an error."},{"content":"[in] The impersonation level.","pos":[4063,4092]},{"content":"[in] The authorization level.","pos":[4107,4136]},{"pos":[4141,4153],"content":"Return value","linkify":"Return value","nodes":[{"content":"Return value","pos":[0,12]}]},{"pos":[4155,4295],"content":"The following values returned by this function are defined in the <bpt id=\"p1\">*</bpt>WbemCli.h<ept id=\"p1\">*</ept> header file, or you can define them as constants in your code:","source":"The following values returned by this function are defined in the *WbemCli.h* header file, or you can define them as constants in your code:"},{"content":"Constant","pos":[4298,4306]},{"content":"Value","pos":[4309,4314]},{"content":"Description","pos":[4317,4328]},{"content":"0x80041001","pos":[4384,4394]},{"content":"There has been a general failure.","pos":[4397,4430]},{"content":"0x80041008","pos":[4464,4474]},{"content":"A parameter is not valid.","pos":[4477,4502]},{"content":"0x80041006","pos":[4532,4542]},{"content":"Not enough memory is available to complete the operation.","pos":[4545,4602]},{"content":"0","pos":[4627,4628]},{"content":"The function call was successful.","pos":[4631,4664]},{"pos":[4672,4679],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"pos":[4681,4820],"content":"This function wraps a call to the <bpt id=\"p1\">[</bpt>IWbemLocator::ConnectServer<ept id=\"p1\">](/windows/desktop/api/wbemcli/nf-wbemcli-iwbemlocator-connectserver)</ept> method.","source":"This function wraps a call to the [IWbemLocator::ConnectServer](/windows/desktop/api/wbemcli/nf-wbemcli-iwbemlocator-connectserver) method."},{"content":"For local access to the default namespace, <ph id=\"ph1\">`strNetworkResource`</ph> can be a simple object path: \"root\\default\" or \"<ph id=\"ph2\">\\\\</ph>.\\root\\default\".","pos":[4822,4952],"source":"For local access to the default namespace, `strNetworkResource` can be a simple object path: \"root\\default\" or \"\\\\.\\root\\default\"."},{"content":"For access to the default namespace on a remote computer using COM or Microsoft-compatible networking, include the computer name: \"<ph id=\"ph1\">\\\\</ph>myserver\\root\\default\".","pos":[4953,5109],"source":" For access to the default namespace on a remote computer using COM or Microsoft-compatible networking, include the computer name: \"\\\\myserver\\root\\default\"."},{"content":"The computer name also can be a DNS name or IP address.","pos":[5110,5165]},{"content":"The <ph id=\"ph1\">`ConnectServerWmi`</ph> function can also connect with computers running IPv6 using an IPv6 address.","pos":[5166,5265],"source":" The `ConnectServerWmi` function can also connect with computers running IPv6 using an IPv6 address."},{"content":"<ph id=\"ph1\">`strUser`</ph> cannot be an empty string.","pos":[5267,5303],"source":"`strUser` cannot be an empty string."},{"content":"If the domain is specified in <ph id=\"ph1\">`strAuthority`</ph>, it must not also be included in <ph id=\"ph2\">`strUser`</ph>, or the function returns <ph id=\"ph3\">`WBEM_E_INVALID_PARAMETER`</ph>.","pos":[5304,5444],"source":" If the domain is specified in `strAuthority`, it must not also be included in `strUser`, or the function returns `WBEM_E_INVALID_PARAMETER`."},{"pos":[5449,5461],"content":"Requirements","linkify":"Requirements","nodes":[{"content":"Requirements","pos":[0,12]}]},{"pos":[5464,5568],"content":"<bpt id=\"p1\">**</bpt>Platforms:<ept id=\"p1\">**</ept> See <bpt id=\"p2\">[</bpt>System Requirements<ept id=\"p2\">](../../../../docs/framework/get-started/system-requirements.md)</ept>.","source":"**Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md)."},{"pos":[5571,5599],"content":"<bpt id=\"p1\">**</bpt>Header:<ept id=\"p1\">**</ept> WMINet_Utils.idl","source":"**Header:** WMINet_Utils.idl"},{"pos":[5602,5709],"content":"<bpt id=\"p1\">**</bpt>.NET Framework Versions:<ept id=\"p1\">**</ept> <ph id=\"ph1\">[!INCLUDE[net_current_v472plus](../../../../includes/net-current-v472plus.md)]</ph>","source":"**.NET Framework Versions:** [!INCLUDE[net_current_v472plus](../../../../includes/net-current-v472plus.md)]"},{"pos":[5714,5722],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[5726,5792],"content":"<bpt id=\"p1\">[</bpt>WMI and Performance Counters (Unmanaged API Reference)<ept id=\"p1\">](index.md)</ept>","source":"[WMI and Performance Counters (Unmanaged API Reference)](index.md)"}]}