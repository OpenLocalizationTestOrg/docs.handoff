{"content":"---\ntitle: \"WPF and Win32 Interoperation\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"hosting WPF content in Win32 window [WPF]\"\n  - \"HWND interop [WPF]\"\n  - \"Win32 code [WPF], WPF interoperation\"\n  - \"interoperability [WPF], Win32\"\nms.assetid: 0ffbde0d-701d-45a3-a6fa-dd71f4d9772e\n---\n# WPF and Win32 Interoperation\nThis topic provides an overview of how to interoperate [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code. [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] provides a rich environment for creating applications. However, when you have a substantial investment in [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] code, it might be more effective to reuse some of that code.  \n\n<a name=\"basics\"></a>   \n## WPF and Win32 Interoperation Basics  \n There are two basic techniques for interoperation between [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code.  \n  \n-   Host [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window. With this technique, you can use the advanced graphics capabilities of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] within the framework of a standard [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window and application.  \n  \n-   Host a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content. With this technique, you can use an existing custom [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] control in the context of other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and pass data across the boundaries.  \n  \n Each of these techniques is conceptually introduced in this topic. For a more code-oriented illustration of hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)], see [Walkthrough: Hosting WPF Content in Win32](walkthrough-hosting-wpf-content-in-win32.md). For a more code-oriented illustration of hosting [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], see [Walkthrough: Hosting a Win32 Control in WPF](walkthrough-hosting-a-win32-control-in-wpf.md).  \n  \n<a name=\"projects\"></a>   \n## WPF Interoperation Projects  \n [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] are managed code, but most existing [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] programs are written in unmanaged [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)].  You cannot call [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] from a true unmanaged program. However, by using the `/clr` option with the [!INCLUDE[TLA#tla_visualcpp](../../../../includes/tlasharptla-visualcpp-md.md)] compiler, you can create a mixed managed-unmanaged program where you can seamlessly mix managed and unmanaged [!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] calls.  \n  \n One project-level complication is that you cannot compile [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] files into a [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] project.  There are several project division techniques to compensate for this.  \n  \n-   Create a C# DLL that contains all your [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pages as a compiled assembly, and then have your [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] executable include that [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] as a reference.  \n  \n-   Create a C# executable for the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and have it reference a [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] that contains the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] content.  \n  \n-   Use <xref:System.Windows.Markup.XamlReader.Load%2A> to load any [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] at run time, instead of compiling your [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].  \n  \n-   Do not use [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] at all, and write all your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in code, building up the element tree from <xref:System.Windows.Application>.  \n  \n Use whatever approach works best for you.  \n  \n> [!NOTE]\n>  If you have not used [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] before, you might notice some \"new\" keywords such as `gcnew` and `nullptr` in the interoperation code examples. These keywords supersede the older double-underscore syntax (`__gc`) and provide a more natural syntax for managed code in [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)].  To learn more about the [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] managed features, see [Component Extensions for Runtime Platforms](/cpp/windows/component-extensions-for-runtime-platforms) and [Hello, C++/CLI](https://go.microsoft.com/fwlink/?LinkId=98739).  \n  \n<a name=\"hwnds\"></a>   \n## How WPF Uses Hwnds  \n To make the most of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] \"HWND interop\", you need to understand how [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] uses HWNDs. For any HWND, you cannot mix [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] rendering with [!INCLUDE[TLA2#tla_dx](../../../../includes/tla2sharptla-dx-md.md)] rendering or [!INCLUDE[TLA2#tla_gdi](../../../../includes/tla2sharptla-gdi-md.md)] / [!INCLUDE[TLA2#tla_gdiplus](../../../../includes/tla2sharptla-gdiplus-md.md)] rendering. This has a number of implications. Primarily, in order to mix these rendering models at all, you must create an interoperation solution, and use designated segments of interoperation for each rendering model that you choose to use. Also, the rendering behavior creates an \"airspace\" restriction for what your interoperation solution can accomplish. The \"airspace\" concept is explained in greater detail in the topic [Technology Regions Overview](technology-regions-overview.md).  \n  \n All [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] elements on the screen are ultimately backed by a HWND. When you create a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window>, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] creates a top-level HWND, and uses an <xref:System.Windows.Interop.HwndSource> to put the <xref:System.Windows.Window> and its [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content inside the HWND.  The rest of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in the application shares that singular HWND. An exception is menus, combo box drop downs, and other pop-ups. These elements create their own top-level window, which is why a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] menu can potentially go past the edge of the window HWND that contains it. When you use <xref:System.Windows.Interop.HwndHost> to put an HWND inside [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] informs [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] how to position the new child HWND relative to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window> HWND.  \n  \n A related concept to HWND is transparency within and between each HWND. This is also discussed in the topic [Technology Regions Overview](technology-regions-overview.md).  \n  \n<a name=\"hosting_a_wpf_page\"></a>   \n## Hosting WPF Content in a Microsoft Win32 Window  \n The key to hosting a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] on a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window is the <xref:System.Windows.Interop.HwndSource> class. This class wraps the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window, so that the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content can be incorporated into your [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] as a child window. The following approach combines the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in a single application.  \n  \n1.  Implement your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content (the content root element) as a managed class. Typically, the class inherits from one of the classes that can contain multiple child elements and/or used as a root element, such as <xref:System.Windows.Controls.DockPanel> or <xref:System.Windows.Controls.Page>. In subsequent steps, this class is referred to as the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class, and instances of the class are referred to as [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content objects.  \n  \n2.  Implement a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application with [!INCLUDE[TLA2#tla_cppcli](../../../../includes/tla2sharptla-cppcli-md.md)]. If you are starting with an existing unmanaged [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] application, you can usually enable it to call managed code by changing your project settings to include the `/clr` compiler flag (the full scope of what might be necessary to support `/clr` compilation is not described in this topic).  \n  \n3.  Set the threading model to Single Threaded Apartment (STA). [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] uses this threading model.  \n  \n4.  Handle the WM_CREATE notification in your window procedure.  \n  \n5.  Within the handler (or a function that the handler calls), do the following:  \n  \n    1.  Create a new <xref:System.Windows.Interop.HwndSource> object with the parent window HWND as its `parent` parameter.  \n  \n    2.  Create an instance of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class.  \n  \n    3.  Assign a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object to the <xref:System.Windows.Interop.HwndSource> object <xref:System.Windows.Interop.HwndSource.RootVisual%2A> property.  \n  \n    4.  The <xref:System.Windows.Interop.HwndSource> object <xref:System.Windows.Interop.HwndSource.Handle%2A> property contains the window handle (HWND). To get an HWND that you can use in the unmanaged part of your application, cast `Handle.ToPointer()` to an HWND.  \n  \n6.  Implement a managed class that contains a static field that holds a reference to your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object. This class allows you to get a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code, but more importantly it prevents your <xref:System.Windows.Interop.HwndSource> from being inadvertently garbage collected.  \n  \n7.  Receive notifications from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object by attaching a handler to one or more of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object events.  \n  \n8.  Communicate with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object by using the reference that you stored in the static field to set properties, call methods, etc.  \n  \n> [!NOTE]\n>  You can do some or all of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class definition for Step One in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] using the default partial class of the content class, if you produce a separate assembly and then reference it. Although you typically include an <xref:System.Windows.Application> object as part of compiling the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] into an assembly, you do not end up using that <xref:System.Windows.Application> as part of the interoperation, you just use one or more of the root classes for [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files referred to by the application and reference their partial classes. The remainder of the procedure is essentially similar to that outlined above.  \n>   \n>  Each of these steps is illustrated through code in the topic [Walkthrough: Hosting WPF Content in Win32](walkthrough-hosting-wpf-content-in-win32.md).  \n  \n<a name=\"hosting_an_hwnd\"></a>   \n## Hosting a Microsoft Win32 Window in WPF  \n The key to hosting a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window within other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is the <xref:System.Windows.Interop.HwndHost> class. This class wraps the window in a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element which can be added to a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element tree. <xref:System.Windows.Interop.HwndHost> also supports [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] that allow you to do such tasks as process messages for the hosted window. The basic procedure is:  \n  \n1.  Create an element tree for a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application (can be through code or markup). Find an appropriate and permissible point in the element tree where the <xref:System.Windows.Interop.HwndHost> implementation can be added as a child element. In the remainder of these steps, this element is referred to as the reserving element.  \n  \n2.  Derive from <xref:System.Windows.Interop.HwndHost> to create an object that holds your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] content.  \n  \n3.  In that host class, override the <xref:System.Windows.Interop.HwndHost> method <xref:System.Windows.Interop.HwndHost.BuildWindowCore%2A>. Return the HWND of the hosted window. You might want to wrap the actual control(s) as a child window of the returned window; wrapping the controls in a host window provides a simple way for your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to receive notifications from the controls. This technique helps correct for some [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] issues regarding message handling at the hosted control boundary.  \n  \n4.  Override the <xref:System.Windows.Interop.HwndHost> methods <xref:System.Windows.Interop.HwndHost.DestroyWindowCore%2A> and <xref:System.Windows.Interop.HwndHost.WndProc%2A>. The intention here is to process cleanup and remove references to the hosted content, particularly if you created references to unmanaged objects.  \n  \n5.  In your code-behind file, create an instance of the control hosting class and make it a child of the reserving element. Typically you would use an event handler such as <xref:System.Windows.FrameworkElement.Loaded>, or use the partial class constructor. But you could also add the interoperation content through a runtime behavior.  \n  \n6.  Process selected window messages, such as control notifications. There are two approaches. Both provide identical access to the message stream, so your choice is largely a matter of programming convenience.  \n  \n    -   Implement message processing for all messages (not just shutdown messages) in your override of the <xref:System.Windows.Interop.HwndHost> method <xref:System.Windows.Interop.HwndHost.WndProc%2A>.  \n  \n    -   Have the hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element process the messages by handling the <xref:System.Windows.Interop.HwndHost.MessageHook> event. This event is raised for every message that is sent to the main window procedure of the hosted window.  \n  \n    -   You cannot process messages from windows that are out of process using <xref:System.Windows.Interop.HwndHost.WndProc%2A>.  \n  \n7.  Communicate with the hosted window by using platform invoke to call the unmanaged `SendMessage` function.  \n  \n Following these steps creates an application that works with mouse input. You can add tabbing support for your hosted window by implementing the <xref:System.Windows.Interop.IKeyboardInputSink> interface.  \n  \n Each of these steps is illustrated through code in the topic [Walkthrough: Hosting a Win32 Control in WPF](walkthrough-hosting-a-win32-control-in-wpf.md).  \n  \n### Hwnds Inside WPF  \n You can think of <xref:System.Windows.Interop.HwndHost> as a special control. (Technically, <xref:System.Windows.Interop.HwndHost> is a <xref:System.Windows.FrameworkElement> derived class, not a <xref:System.Windows.Controls.Control> derived class, but it can be considered a control for purposes of interoperation.) <xref:System.Windows.Interop.HwndHost> abstracts the underlying [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] nature of the hosted content such that the remainder of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] considers the hosted content to be another control-like object, which should render and process input. <xref:System.Windows.Interop.HwndHost> generally behaves like any other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.FrameworkElement>, although there are some important differences around output (drawing and graphics) and input (mouse and keyboard) based on limitations of what the underlying HWNDs can support.  \n  \n#### Notable Differences in Output Behavior  \n  \n-   <xref:System.Windows.FrameworkElement>, which is the <xref:System.Windows.Interop.HwndHost> base class, has quite a few properties that imply changes to the UI. These include properties such as <xref:System.Windows.FrameworkElement.FlowDirection%2A?displayProperty=nameWithType>, which changes the layout of elements within that element as a parent. However, most of these properties are not mapped to possible [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] equivalents, even if such equivalents might exist. Too many of these properties and their meanings are too rendering-technology specific for mappings to be practical. Therefore, setting properties such as <xref:System.Windows.FrameworkElement.FlowDirection%2A> on <xref:System.Windows.Interop.HwndHost> has no effect.  \n  \n-   <xref:System.Windows.Interop.HwndHost> cannot be rotated, scaled, skewed, or otherwise affected by a Transform.  \n  \n-   <xref:System.Windows.Interop.HwndHost> does not support the <xref:System.Windows.UIElement.Opacity%2A> property (alpha blending). If content inside the <xref:System.Windows.Interop.HwndHost> performs <xref:System.Drawing> operations that include alpha information, that is itself not a violation, but the <xref:System.Windows.Interop.HwndHost> as a whole only supports Opacity = 1.0 (100%).  \n  \n-   <xref:System.Windows.Interop.HwndHost> will appear on top of other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] elements in the same top-level window. However, a <xref:System.Windows.Controls.ToolTip> or <xref:System.Windows.Controls.ContextMenu> generated menu is a separate top-level window, and so will behave correctly with <xref:System.Windows.Interop.HwndHost>.  \n  \n-   <xref:System.Windows.Interop.HwndHost> does not respect the clipping region of its parent <xref:System.Windows.UIElement>. This is potentially an issue if you attempt to put an <xref:System.Windows.Interop.HwndHost> class inside a scrolling region or <xref:System.Windows.Controls.Canvas>.  \n  \n#### Notable Differences in Input Behavior  \n  \n-   In general, while input devices are scoped within the <xref:System.Windows.Interop.HwndHost> hosted [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] region, input events go directly to [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)].  \n  \n-   While the mouse is over the <xref:System.Windows.Interop.HwndHost>, your application does not receive [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] mouse events, and the value of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property <xref:System.Windows.UIElement.IsMouseOver%2A> will be `false`.  \n  \n-   While the <xref:System.Windows.Interop.HwndHost> has keyboard focus, your application will not receive [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] keyboard events and the value of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property <xref:System.Windows.UIElement.IsKeyboardFocusWithin%2A> will be `false`.  \n  \n-   When focus is within the <xref:System.Windows.Interop.HwndHost> and changes to another control inside the <xref:System.Windows.Interop.HwndHost>, your application will not receive the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] events <xref:System.Windows.UIElement.GotFocus> or <xref:System.Windows.UIElement.LostFocus>.  \n  \n-   Related stylus properties and events are analogous, and do not report information while the stylus is over <xref:System.Windows.Interop.HwndHost>.  \n  \n<a name=\"tabbing_mnemonics_accelerators\"></a>   \n## Tabbing, Mnemonics, and Accelerators  \n The <xref:System.Windows.Interop.IKeyboardInputSink> and <xref:System.Windows.Interop.IKeyboardInputSite> interfaces allow you to create a seamless keyboard experience for mixed [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] applications:  \n  \n-   Tabbing between [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] components  \n  \n-   Mnemonics and accelerators that work both when focus is within a Win32 component and when it is within a WPF component.  \n  \n The <xref:System.Windows.Interop.HwndHost> and <xref:System.Windows.Interop.HwndSource> classes both provide implementations of <xref:System.Windows.Interop.IKeyboardInputSink>, but they may not handle all the input messages that you want for more advanced scenarios. Override the appropriate methods to get the keyboard behavior you want.  \n  \n The interfaces only provide support for what happens on the transition between the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] regions. Within the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] region, tabbing behavior is entirely controlled by the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] implemented logic for tabbing, if any.  \n  \n## See also\n\n- <xref:System.Windows.Interop.HwndHost>\n- <xref:System.Windows.Interop.HwndSource>\n- <xref:System.Windows.Interop>\n- [Walkthrough: Hosting a Win32 Control in WPF](walkthrough-hosting-a-win32-control-in-wpf.md)\n- [Walkthrough: Hosting WPF Content in Win32](walkthrough-hosting-wpf-content-in-win32.md)\n","nodes":[{"pos":[4,286],"embed":true,"restype":"x-metadata","content":"title: \"WPF and Win32 Interoperation\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"hosting WPF content in Win32 window [WPF]\"\n  - \"HWND interop [WPF]\"\n  - \"Win32 code [WPF], WPF interoperation\"\n  - \"interoperability [WPF], Win32\"\nms.assetid: 0ffbde0d-701d-45a3-a6fa-dd71f4d9772e","nodes":[{"content":"WPF and Win32 Interoperation","nodes":[{"pos":[0,28],"content":"WPF and Win32 Interoperation","nodes":[{"content":"WPF and Win32 Interoperation","pos":[0,28]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[293,321],"content":"WPF and Win32 Interoperation","linkify":"WPF and Win32 Interoperation","nodes":[{"content":"WPF and Win32 Interoperation","pos":[0,28]}]},{"content":"This topic provides an overview of how to interoperate <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> code.","pos":[322,542],"source":"This topic provides an overview of how to interoperate [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code."},{"content":"<ph id=\"ph1\">[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]</ph> provides a rich environment for creating applications.","pos":[543,677],"source":"[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] provides a rich environment for creating applications."},{"content":"However, when you have a substantial investment in <ph id=\"ph1\">[!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)]</ph> code, it might be more effective to reuse some of that code.","pos":[678,861],"source":" However, when you have a substantial investment in [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] code, it might be more effective to reuse some of that code."},{"pos":[893,928],"content":"WPF and Win32 Interoperation Basics","linkify":"WPF and Win32 Interoperation Basics","nodes":[{"content":"WPF and Win32 Interoperation Basics","pos":[0,35]}]},{"pos":[932,1155],"content":"There are two basic techniques for interoperation between <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> code.","source":"There are two basic techniques for interoperation between [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code."},{"content":"Host <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content in a <ph id=\"ph2\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> window.","pos":[1165,1346],"source":"Host [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window."},{"content":"With this technique, you can use the advanced graphics capabilities of <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> within the framework of a standard <ph id=\"ph2\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> window and application.","pos":[1347,1632],"source":" With this technique, you can use the advanced graphics capabilities of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] within the framework of a standard [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window and application."},{"content":"Host a <ph id=\"ph1\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> window in <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content.","pos":[1642,1823],"source":"Host a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content."},{"content":"With this technique, you can use an existing custom <ph id=\"ph1\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> control in the context of other <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content, and pass data across the boundaries.","pos":[1824,2109],"source":" With this technique, you can use an existing custom [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] control in the context of other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and pass data across the boundaries."},{"content":"Each of these techniques is conceptually introduced in this topic.","pos":[2116,2182]},{"content":"For a more code-oriented illustration of hosting <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> in <ph id=\"ph2\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph>, see <bpt id=\"p1\">[</bpt>Walkthrough: Hosting WPF Content in Win32<ept id=\"p1\">](walkthrough-hosting-wpf-content-in-win32.md)</ept>.","pos":[2183,2485],"source":" For a more code-oriented illustration of hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)], see [Walkthrough: Hosting WPF Content in Win32](walkthrough-hosting-wpf-content-in-win32.md)."},{"content":"For a more code-oriented illustration of hosting <ph id=\"ph1\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> in <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph>, see <bpt id=\"p1\">[</bpt>Walkthrough: Hosting a Win32 Control in WPF<ept id=\"p1\">](walkthrough-hosting-a-win32-control-in-wpf.md)</ept>.","pos":[2486,2792],"source":" For a more code-oriented illustration of hosting [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], see [Walkthrough: Hosting a Win32 Control in WPF](walkthrough-hosting-a-win32-control-in-wpf.md)."},{"pos":[2828,2855],"content":"WPF Interoperation Projects","linkify":"WPF Interoperation Projects","nodes":[{"content":"WPF Interoperation Projects","pos":[0,27]}]},{"content":"<ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> <ph id=\"ph2\">[!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)]</ph> are managed code, but most existing <ph id=\"ph3\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> programs are written in unmanaged <ph id=\"ph4\">[!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)]</ph>.","pos":[2859,3243],"source":"[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] are managed code, but most existing [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] programs are written in unmanaged [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)]."},{"content":"You cannot call <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> <ph id=\"ph2\">[!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)]</ph> from a true unmanaged program.","pos":[3245,3461],"source":"  You cannot call [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] from a true unmanaged program."},{"content":"However, by using the <ph id=\"ph1\">`/clr`</ph> option with the <ph id=\"ph2\">[!INCLUDE[TLA#tla_visualcpp](../../../../includes/tlasharptla-visualcpp-md.md)]</ph> compiler, you can create a mixed managed-unmanaged program where you can seamlessly mix managed and unmanaged <ph id=\"ph3\">[!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)]</ph> calls.","pos":[3462,3773],"source":" However, by using the `/clr` option with the [!INCLUDE[TLA#tla_visualcpp](../../../../includes/tlasharptla-visualcpp-md.md)] compiler, you can create a mixed managed-unmanaged program where you can seamlessly mix managed and unmanaged [!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] calls."},{"content":"One project-level complication is that you cannot compile <ph id=\"ph1\">[!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)]</ph> files into a <ph id=\"ph2\">[!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)]</ph> project.","pos":[3780,3999],"source":"One project-level complication is that you cannot compile [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] files into a [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] project."},{"content":"There are several project division techniques to compensate for this.","pos":[4001,4070]},{"pos":[4080,4419],"content":"Create a C# DLL that contains all your <ph id=\"ph1\">[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]</ph> pages as a compiled assembly, and then have your <ph id=\"ph2\">[!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)]</ph> executable include that <ph id=\"ph3\">[!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)]</ph> as a reference.","source":"Create a C# DLL that contains all your [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] pages as a compiled assembly, and then have your [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] executable include that [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] as a reference."},{"pos":[4429,4815],"content":"Create a C# executable for the <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content, and have it reference a <ph id=\"ph2\">[!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)]</ph> <ph id=\"ph3\">[!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)]</ph> that contains the <ph id=\"ph4\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> content.","source":"Create a C# executable for the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and have it reference a [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] that contains the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] content."},{"pos":[4825,5072],"content":"Use <ph id=\"ph1\">&lt;xref:System.Windows.Markup.XamlReader.Load%2A&gt;</ph> to load any <ph id=\"ph2\">[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]</ph> at run time, instead of compiling your <ph id=\"ph3\">[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]</ph>.","source":"Use <xref:System.Windows.Markup.XamlReader.Load%2A> to load any [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] at run time, instead of compiling your [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]."},{"pos":[5082,5351],"content":"Do not use <ph id=\"ph1\">[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]</ph> at all, and write all your <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> in code, building up the element tree from <ph id=\"ph3\">&lt;xref:System.Windows.Application&gt;</ph>.","source":"Do not use [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] at all, and write all your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in code, building up the element tree from <xref:System.Windows.Application>."},{"content":"Use whatever approach works best for you.","pos":[5358,5399]},{"pos":[5407,6110],"content":"[!NOTE]\n If you have not used [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] before, you might notice some \"new\" keywords such as `gcnew` and `nullptr` in the interoperation code examples. These keywords supersede the older double-underscore syntax (`__gc`) and provide a more natural syntax for managed code in [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)].  To learn more about the [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] managed features, see [Component Extensions for Runtime Platforms](/cpp/windows/component-extensions-for-runtime-platforms) and [Hello, C++/CLI](https://go.microsoft.com/fwlink/?LinkId=98739).","leadings":["","> "],"nodes":[{"content":"If you have not used [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] before, you might notice some \"new\" keywords such as `gcnew` and `nullptr` in the interoperation code examples. These keywords supersede the older double-underscore syntax (`__gc`) and provide a more natural syntax for managed code in [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)].  To learn more about the [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] managed features, see [Component Extensions for Runtime Platforms](/cpp/windows/component-extensions-for-runtime-platforms) and [Hello, C++/CLI](https://go.microsoft.com/fwlink/?LinkId=98739).","pos":[9,701],"nodes":[{"content":"If you have not used <ph id=\"ph1\">[!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)]</ph> before, you might notice some \"new\" keywords such as <ph id=\"ph2\">`gcnew`</ph> and <ph id=\"ph3\">`nullptr`</ph> in the interoperation code examples.","pos":[0,206],"source":"If you have not used [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] before, you might notice some \"new\" keywords such as `gcnew` and `nullptr` in the interoperation code examples."},{"content":"These keywords supersede the older double-underscore syntax (<ph id=\"ph1\">`__gc`</ph>) and provide a more natural syntax for managed code in <ph id=\"ph2\">[!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)]</ph>.","pos":[207,400],"source":" These keywords supersede the older double-underscore syntax (`__gc`) and provide a more natural syntax for managed code in [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)]."},{"content":"To learn more about the <ph id=\"ph1\">[!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)]</ph> managed features, see <bpt id=\"p1\">[</bpt>Component Extensions for Runtime Platforms<ept id=\"p1\">](/cpp/windows/component-extensions-for-runtime-platforms)</ept> and <bpt id=\"p2\">[</bpt>Hello, C++/CLI<ept id=\"p2\">](https://go.microsoft.com/fwlink/?LinkId=98739)</ept>.","pos":[402,692],"source":"  To learn more about the [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] managed features, see [Component Extensions for Runtime Platforms](/cpp/windows/component-extensions-for-runtime-platforms) and [Hello, C++/CLI](https://go.microsoft.com/fwlink/?LinkId=98739)."}]}]},{"pos":[6143,6161],"content":"How WPF Uses Hwnds","linkify":"How WPF Uses Hwnds","nodes":[{"content":"How WPF Uses Hwnds","pos":[0,18]}]},{"content":"To make the most of <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> \"HWND interop\", you need to understand how <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> uses HWNDs.","pos":[6165,6403],"source":"To make the most of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] \"HWND interop\", you need to understand how [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] uses HWNDs."},{"content":"For any HWND, you cannot mix <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> rendering with <ph id=\"ph2\">[!INCLUDE[TLA2#tla_dx](../../../../includes/tla2sharptla-dx-md.md)]</ph> rendering or <ph id=\"ph3\">[!INCLUDE[TLA2#tla_gdi](../../../../includes/tla2sharptla-gdi-md.md)]</ph><ph id=\"ph4\"> / </ph><ph id=\"ph5\">[!INCLUDE[TLA2#tla_gdiplus](../../../../includes/tla2sharptla-gdiplus-md.md)]</ph> rendering.","pos":[6404,6771],"source":" For any HWND, you cannot mix [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] rendering with [!INCLUDE[TLA2#tla_dx](../../../../includes/tla2sharptla-dx-md.md)] rendering or [!INCLUDE[TLA2#tla_gdi](../../../../includes/tla2sharptla-gdi-md.md)] / [!INCLUDE[TLA2#tla_gdiplus](../../../../includes/tla2sharptla-gdiplus-md.md)] rendering."},{"content":"This has a number of implications.","pos":[6772,6806]},{"content":"Primarily, in order to mix these rendering models at all, you must create an interoperation solution, and use designated segments of interoperation for each rendering model that you choose to use.","pos":[6807,7003]},{"content":"Also, the rendering behavior creates an \"airspace\" restriction for what your interoperation solution can accomplish.","pos":[7004,7120]},{"content":"The \"airspace\" concept is explained in greater detail in the topic <bpt id=\"p1\">[</bpt>Technology Regions Overview<ept id=\"p1\">](technology-regions-overview.md)</ept>.","pos":[7121,7250],"source":" The \"airspace\" concept is explained in greater detail in the topic [Technology Regions Overview](technology-regions-overview.md)."},{"content":"All <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> elements on the screen are ultimately backed by a HWND.","pos":[7257,7398],"source":"All [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] elements on the screen are ultimately backed by a HWND."},{"content":"When you create a <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> <ph id=\"ph2\">&lt;xref:System.Windows.Window&gt;</ph>, <ph id=\"ph3\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> creates a top-level HWND, and uses an <ph id=\"ph4\">&lt;xref:System.Windows.Interop.HwndSource&gt;</ph> to put the <ph id=\"ph5\">&lt;xref:System.Windows.Window&gt;</ph> and its <ph id=\"ph6\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content inside the HWND.","pos":[7399,7844],"source":" When you create a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window>, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] creates a top-level HWND, and uses an <xref:System.Windows.Interop.HwndSource> to put the <xref:System.Windows.Window> and its [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content inside the HWND."},{"content":"The rest of your <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content in the application shares that singular HWND.","pos":[7846,7998],"source":"  The rest of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in the application shares that singular HWND."},{"content":"An exception is menus, combo box drop downs, and other pop-ups.","pos":[7999,8062]},{"content":"These elements create their own top-level window, which is why a <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> menu can potentially go past the edge of the window HWND that contains it.","pos":[8063,8284],"source":" These elements create their own top-level window, which is why a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] menu can potentially go past the edge of the window HWND that contains it."},{"content":"When you use <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> to put an HWND inside <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph>, <ph id=\"ph3\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> informs <ph id=\"ph4\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> how to position the new child HWND relative to the <ph id=\"ph5\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> <ph id=\"ph6\">&lt;xref:System.Windows.Window&gt;</ph> HWND.","pos":[8285,8773],"source":" When you use <xref:System.Windows.Interop.HwndHost> to put an HWND inside [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] informs [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] how to position the new child HWND relative to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window> HWND."},{"content":"A related concept to HWND is transparency within and between each HWND.","pos":[8780,8851]},{"content":"This is also discussed in the topic <bpt id=\"p1\">[</bpt>Technology Regions Overview<ept id=\"p1\">](technology-regions-overview.md)</ept>.","pos":[8852,8950],"source":" This is also discussed in the topic [Technology Regions Overview](technology-regions-overview.md)."},{"pos":[8996,9043],"content":"Hosting WPF Content in a Microsoft Win32 Window","linkify":"Hosting WPF Content in a Microsoft Win32 Window","nodes":[{"content":"Hosting WPF Content in a Microsoft Win32 Window","pos":[0,47]}]},{"content":"The key to hosting a <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> on a <ph id=\"ph2\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> window is the <ph id=\"ph3\">&lt;xref:System.Windows.Interop.HwndSource&gt;</ph> class.","pos":[9047,9290],"source":"The key to hosting a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] on a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window is the <xref:System.Windows.Interop.HwndSource> class."},{"content":"This class wraps the <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content in a <ph id=\"ph2\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> window, so that the <ph id=\"ph3\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content can be incorporated into your <ph id=\"ph4\">[!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)]</ph> as a child window.","pos":[9291,9705],"source":" This class wraps the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window, so that the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content can be incorporated into your [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] as a child window."},{"content":"The following approach combines the <ph id=\"ph1\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> in a single application.","pos":[9706,9926],"source":" The following approach combines the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in a single application."},{"content":"Implement your <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content (the content root element) as a managed class.","pos":[9936,10087],"source":"Implement your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content (the content root element) as a managed class."},{"content":"Typically, the class inherits from one of the classes that can contain multiple child elements and/or used as a root element, such as <ph id=\"ph1\">&lt;xref:System.Windows.Controls.DockPanel&gt;</ph> or <ph id=\"ph2\">&lt;xref:System.Windows.Controls.Page&gt;</ph>.","pos":[10088,10302],"source":" Typically, the class inherits from one of the classes that can contain multiple child elements and/or used as a root element, such as <xref:System.Windows.Controls.DockPanel> or <xref:System.Windows.Controls.Page>."},{"content":"In subsequent steps, this class is referred to as the <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content class, and instances of the class are referred to as <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content objects.","pos":[10303,10598],"source":" In subsequent steps, this class is referred to as the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class, and instances of the class are referred to as [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content objects."},{"content":"Implement a <ph id=\"ph1\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> application with <ph id=\"ph2\">[!INCLUDE[TLA2#tla_cppcli](../../../../includes/tla2sharptla-cppcli-md.md)]</ph>.","pos":[10608,10787],"source":"Implement a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application with [!INCLUDE[TLA2#tla_cppcli](../../../../includes/tla2sharptla-cppcli-md.md)]."},{"content":"If you are starting with an existing unmanaged <ph id=\"ph1\">[!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)]</ph> application, you can usually enable it to call managed code by changing your project settings to include the <ph id=\"ph2\">`/clr`</ph> compiler flag (the full scope of what might be necessary to support <ph id=\"ph3\">`/clr`</ph> compilation is not described in this topic).","pos":[10788,11140],"source":" If you are starting with an existing unmanaged [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)] application, you can usually enable it to call managed code by changing your project settings to include the `/clr` compiler flag (the full scope of what might be necessary to support `/clr` compilation is not described in this topic)."},{"content":"Set the threading model to Single Threaded Apartment (STA).","pos":[11150,11209]},{"content":"<ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> uses this threading model.","pos":[11210,11318],"source":"[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] uses this threading model."},{"content":"Handle the WM_CREATE notification in your window procedure.","pos":[11328,11387]},{"content":"Within the handler (or a function that the handler calls), do the following:","pos":[11397,11473]},{"pos":[11487,11602],"content":"Create a new <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndSource&gt;</ph> object with the parent window HWND as its <ph id=\"ph2\">`parent`</ph> parameter.","source":"Create a new <xref:System.Windows.Interop.HwndSource> object with the parent window HWND as its `parent` parameter."},{"pos":[11616,11739],"content":"Create an instance of your <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content class.","source":"Create an instance of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class."},{"pos":[11753,11995],"content":"Assign a reference to the <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content object to the <ph id=\"ph2\">&lt;xref:System.Windows.Interop.HwndSource&gt;</ph> object <ph id=\"ph3\">&lt;xref:System.Windows.Interop.HwndSource.RootVisual%2A&gt;</ph> property.","source":"Assign a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object to the <xref:System.Windows.Interop.HwndSource> object <xref:System.Windows.Interop.HwndSource.RootVisual%2A> property."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndSource&gt;</ph> object <ph id=\"ph2\">&lt;xref:System.Windows.Interop.HwndSource.Handle%2A&gt;</ph> property contains the window handle (HWND).","pos":[12009,12155],"source":"The <xref:System.Windows.Interop.HwndSource> object <xref:System.Windows.Interop.HwndSource.Handle%2A> property contains the window handle (HWND)."},{"content":"To get an HWND that you can use in the unmanaged part of your application, cast <ph id=\"ph1\">`Handle.ToPointer()`</ph> to an HWND.","pos":[12156,12268],"source":" To get an HWND that you can use in the unmanaged part of your application, cast `Handle.ToPointer()` to an HWND."},{"content":"Implement a managed class that contains a static field that holds a reference to your <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content object.","pos":[12278,12461],"source":"Implement a managed class that contains a static field that holds a reference to your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object."},{"content":"This class allows you to get a reference to the <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content object from your <ph id=\"ph2\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> code, but more importantly it prevents your <ph id=\"ph3\">&lt;xref:System.Windows.Interop.HwndSource&gt;</ph> from being inadvertently garbage collected.","pos":[12462,12819],"source":" This class allows you to get a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code, but more importantly it prevents your <xref:System.Windows.Interop.HwndSource> from being inadvertently garbage collected."},{"pos":[12829,13106],"content":"Receive notifications from the <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content object by attaching a handler to one or more of the <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content object events.","source":"Receive notifications from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object by attaching a handler to one or more of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object events."},{"pos":[13116,13330],"content":"Communicate with the <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content object by using the reference that you stored in the static field to set properties, call methods, etc.","source":"Communicate with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object by using the reference that you stored in the static field to set properties, call methods, etc."},{"pos":[13338,14242],"content":"[!NOTE]\n You can do some or all of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class definition for Step One in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] using the default partial class of the content class, if you produce a separate assembly and then reference it. Although you typically include an <xref:System.Windows.Application> object as part of compiling the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] into an assembly, you do not end up using that <xref:System.Windows.Application> as part of the interoperation, you just use one or more of the root classes for [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files referred to by the application and reference their partial classes. The remainder of the procedure is essentially similar to that outlined above.","leadings":["","> "],"nodes":[{"content":"You can do some or all of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class definition for Step One in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] using the default partial class of the content class, if you produce a separate assembly and then reference it. Although you typically include an <xref:System.Windows.Application> object as part of compiling the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] into an assembly, you do not end up using that <xref:System.Windows.Application> as part of the interoperation, you just use one or more of the root classes for [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files referred to by the application and reference their partial classes. The remainder of the procedure is essentially similar to that outlined above.","pos":[9,902],"nodes":[{"content":"You can do some or all of the <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content class definition for Step One in <ph id=\"ph2\">[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]</ph> using the default partial class of the content class, if you produce a separate assembly and then reference it.","pos":[0,336],"source":"You can do some or all of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class definition for Step One in [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] using the default partial class of the content class, if you produce a separate assembly and then reference it."},{"content":"Although you typically include an <ph id=\"ph1\">&lt;xref:System.Windows.Application&gt;</ph> object as part of compiling the <ph id=\"ph2\">[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]</ph> into an assembly, you do not end up using that <ph id=\"ph3\">&lt;xref:System.Windows.Application&gt;</ph> as part of the interoperation, you just use one or more of the root classes for <ph id=\"ph4\">[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]</ph> files referred to by the application and reference their partial classes.","pos":[337,815],"source":" Although you typically include an <xref:System.Windows.Application> object as part of compiling the [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] into an assembly, you do not end up using that <xref:System.Windows.Application> as part of the interoperation, you just use one or more of the root classes for [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] files referred to by the application and reference their partial classes."},{"content":"The remainder of the procedure is essentially similar to that outlined above.","pos":[816,893]}]}]},{"pos":[14253,14403],"content":"Each of these steps is illustrated through code in the topic <bpt id=\"p1\">[</bpt>Walkthrough: Hosting WPF Content in Win32<ept id=\"p1\">](walkthrough-hosting-wpf-content-in-win32.md)</ept>.","source":"Each of these steps is illustrated through code in the topic [Walkthrough: Hosting WPF Content in Win32](walkthrough-hosting-wpf-content-in-win32.md)."},{"pos":[14446,14485],"content":"Hosting a Microsoft Win32 Window in WPF","linkify":"Hosting a Microsoft Win32 Window in WPF","nodes":[{"content":"Hosting a Microsoft Win32 Window in WPF","pos":[0,39]}]},{"content":"The key to hosting a <ph id=\"ph1\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> window within other <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content is the <ph id=\"ph3\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> class.","pos":[14489,14746],"source":"The key to hosting a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window within other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is the <xref:System.Windows.Interop.HwndHost> class."},{"content":"This class wraps the window in a <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> element which can be added to a <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> element tree.","pos":[14747,14989],"source":" This class wraps the window in a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element which can be added to a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element tree."},{"content":"<ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> also supports <ph id=\"ph2\">[!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)]</ph> that allow you to do such tasks as process messages for the hosted window.","pos":[14990,15205],"source":"<xref:System.Windows.Interop.HwndHost> also supports [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] that allow you to do such tasks as process messages for the hosted window."},{"content":"The basic procedure is:","pos":[15206,15229]},{"content":"Create an element tree for a <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> application (can be through code or markup).","pos":[15239,15394],"source":"Create an element tree for a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application (can be through code or markup)."},{"content":"Find an appropriate and permissible point in the element tree where the <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> implementation can be added as a child element.","pos":[15395,15553],"source":" Find an appropriate and permissible point in the element tree where the <xref:System.Windows.Interop.HwndHost> implementation can be added as a child element."},{"content":"In the remainder of these steps, this element is referred to as the reserving element.","pos":[15554,15640]},{"pos":[15650,15819],"content":"Derive from <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> to create an object that holds your <ph id=\"ph2\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> content.","source":"Derive from <xref:System.Windows.Interop.HwndHost> to create an object that holds your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] content."},{"content":"In that host class, override the <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> method <ph id=\"ph2\">&lt;xref:System.Windows.Interop.HwndHost.BuildWindowCore%2A&gt;</ph>.","pos":[15829,15966],"source":"In that host class, override the <xref:System.Windows.Interop.HwndHost> method <xref:System.Windows.Interop.HwndHost.BuildWindowCore%2A>."},{"content":"Return the HWND of the hosted window.","pos":[15967,16004]},{"content":"You might want to wrap the actual control(s) as a child window of the returned window; wrapping the controls in a host window provides a simple way for your <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> content to receive notifications from the controls.","pos":[16005,16295],"source":" You might want to wrap the actual control(s) as a child window of the returned window; wrapping the controls in a host window provides a simple way for your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to receive notifications from the controls."},{"content":"This technique helps correct for some <ph id=\"ph1\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> issues regarding message handling at the hosted control boundary.","pos":[16296,16473],"source":" This technique helps correct for some [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] issues regarding message handling at the hosted control boundary."},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> methods <ph id=\"ph2\">&lt;xref:System.Windows.Interop.HwndHost.DestroyWindowCore%2A&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.Windows.Interop.HwndHost.WndProc%2A&gt;</ph>.","pos":[16483,16657],"source":"Override the <xref:System.Windows.Interop.HwndHost> methods <xref:System.Windows.Interop.HwndHost.DestroyWindowCore%2A> and <xref:System.Windows.Interop.HwndHost.WndProc%2A>."},{"content":"The intention here is to process cleanup and remove references to the hosted content, particularly if you created references to unmanaged objects.","pos":[16658,16804]},{"content":"In your code-behind file, create an instance of the control hosting class and make it a child of the reserving element.","pos":[16814,16933]},{"content":"Typically you would use an event handler such as <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement.Loaded&gt;</ph>, or use the partial class constructor.","pos":[16934,17067],"source":" Typically you would use an event handler such as <xref:System.Windows.FrameworkElement.Loaded>, or use the partial class constructor."},{"content":"But you could also add the interoperation content through a runtime behavior.","pos":[17068,17145]},{"content":"Process selected window messages, such as control notifications.","pos":[17155,17219]},{"content":"There are two approaches.","pos":[17220,17245]},{"content":"Both provide identical access to the message stream, so your choice is largely a matter of programming convenience.","pos":[17246,17361]},{"pos":[17375,17570],"content":"Implement message processing for all messages (not just shutdown messages) in your override of the <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> method <ph id=\"ph2\">&lt;xref:System.Windows.Interop.HwndHost.WndProc%2A&gt;</ph>.","source":"Implement message processing for all messages (not just shutdown messages) in your override of the <xref:System.Windows.Interop.HwndHost> method <xref:System.Windows.Interop.HwndHost.WndProc%2A>."},{"content":"Have the hosting <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> element process the messages by handling the <ph id=\"ph2\">&lt;xref:System.Windows.Interop.HwndHost.MessageHook&gt;</ph> event.","pos":[17584,17785],"source":"Have the hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] element process the messages by handling the <xref:System.Windows.Interop.HwndHost.MessageHook> event."},{"content":"This event is raised for every message that is sent to the main window procedure of the hosted window.","pos":[17786,17888]},{"pos":[17902,18023],"content":"You cannot process messages from windows that are out of process using <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost.WndProc%2A&gt;</ph>.","source":"You cannot process messages from windows that are out of process using <xref:System.Windows.Interop.HwndHost.WndProc%2A>."},{"pos":[18033,18138],"content":"Communicate with the hosted window by using platform invoke to call the unmanaged <ph id=\"ph1\">`SendMessage`</ph> function.","source":"Communicate with the hosted window by using platform invoke to call the unmanaged `SendMessage` function."},{"content":"Following these steps creates an application that works with mouse input.","pos":[18145,18218]},{"content":"You can add tabbing support for your hosted window by implementing the <ph id=\"ph1\">&lt;xref:System.Windows.Interop.IKeyboardInputSink&gt;</ph> interface.","pos":[18219,18349],"source":" You can add tabbing support for your hosted window by implementing the <xref:System.Windows.Interop.IKeyboardInputSink> interface."},{"pos":[18356,18510],"content":"Each of these steps is illustrated through code in the topic <bpt id=\"p1\">[</bpt>Walkthrough: Hosting a Win32 Control in WPF<ept id=\"p1\">](walkthrough-hosting-a-win32-control-in-wpf.md)</ept>.","source":"Each of these steps is illustrated through code in the topic [Walkthrough: Hosting a Win32 Control in WPF](walkthrough-hosting-a-win32-control-in-wpf.md)."},{"pos":[18520,18536],"content":"Hwnds Inside WPF","linkify":"Hwnds Inside WPF","nodes":[{"content":"Hwnds Inside WPF","pos":[0,16]}]},{"content":"You can think of <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> as a special control.","pos":[18540,18617],"source":"You can think of <xref:System.Windows.Interop.HwndHost> as a special control."},{"content":"(Technically, <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> is a <ph id=\"ph2\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> derived class, not a <ph id=\"ph3\">&lt;xref:System.Windows.Controls.Control&gt;</ph> derived class, but it can be considered a control for purposes of interoperation.) <ph id=\"ph4\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> abstracts the underlying <ph id=\"ph5\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> nature of the hosted content such that the remainder of <ph id=\"ph6\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> considers the hosted content to be another control-like object, which should render and process input.","pos":[18618,19236],"source":" (Technically, <xref:System.Windows.Interop.HwndHost> is a <xref:System.Windows.FrameworkElement> derived class, not a <xref:System.Windows.Controls.Control> derived class, but it can be considered a control for purposes of interoperation.) <xref:System.Windows.Interop.HwndHost> abstracts the underlying [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] nature of the hosted content such that the remainder of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] considers the hosted content to be another control-like object, which should render and process input."},{"content":"<ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> generally behaves like any other <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> <ph id=\"ph3\">&lt;xref:System.Windows.FrameworkElement&gt;</ph>, although there are some important differences around output (drawing and graphics) and input (mouse and keyboard) based on limitations of what the underlying HWNDs can support.","pos":[19237,19607],"source":"<xref:System.Windows.Interop.HwndHost> generally behaves like any other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.FrameworkElement>, although there are some important differences around output (drawing and graphics) and input (mouse and keyboard) based on limitations of what the underlying HWNDs can support."},{"pos":[19618,19656],"content":"Notable Differences in Output Behavior","linkify":"Notable Differences in Output Behavior","nodes":[{"content":"Notable Differences in Output Behavior","pos":[0,38]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement&gt;</ph>, which is the <ph id=\"ph2\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> base class, has quite a few properties that imply changes to the UI.","pos":[19666,19826],"source":"<xref:System.Windows.FrameworkElement>, which is the <xref:System.Windows.Interop.HwndHost> base class, has quite a few properties that imply changes to the UI."},{"content":"These include properties such as <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement.FlowDirection%2A?displayProperty=nameWithType&gt;</ph>, which changes the layout of elements within that element as a parent.","pos":[19827,20015],"source":" These include properties such as <xref:System.Windows.FrameworkElement.FlowDirection%2A?displayProperty=nameWithType>, which changes the layout of elements within that element as a parent."},{"content":"However, most of these properties are not mapped to possible <ph id=\"ph1\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> equivalents, even if such equivalents might exist.","pos":[20016,20201],"source":" However, most of these properties are not mapped to possible [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] equivalents, even if such equivalents might exist."},{"content":"Too many of these properties and their meanings are too rendering-technology specific for mappings to be practical.","pos":[20202,20317]},{"content":"Therefore, setting properties such as <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement.FlowDirection%2A&gt;</ph> on <ph id=\"ph2\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> has no effect.","pos":[20318,20468],"source":" Therefore, setting properties such as <xref:System.Windows.FrameworkElement.FlowDirection%2A> on <xref:System.Windows.Interop.HwndHost> has no effect."},{"pos":[20478,20589],"content":"<ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> cannot be rotated, scaled, skewed, or otherwise affected by a Transform.","source":"<xref:System.Windows.Interop.HwndHost> cannot be rotated, scaled, skewed, or otherwise affected by a Transform."},{"content":"<ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> does not support the <ph id=\"ph2\">&lt;xref:System.Windows.UIElement.Opacity%2A&gt;</ph> property (alpha blending).","pos":[20599,20728],"source":"<xref:System.Windows.Interop.HwndHost> does not support the <xref:System.Windows.UIElement.Opacity%2A> property (alpha blending)."},{"content":"If content inside the <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> performs <ph id=\"ph2\">&lt;xref:System.Drawing&gt;</ph> operations that include alpha information, that is itself not a violation, but the <ph id=\"ph3\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> as a whole only supports Opacity = 1.0 (100%).","pos":[20729,20989],"source":" If content inside the <xref:System.Windows.Interop.HwndHost> performs <xref:System.Drawing> operations that include alpha information, that is itself not a violation, but the <xref:System.Windows.Interop.HwndHost> as a whole only supports Opacity = 1.0 (100%)."},{"content":"<ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> will appear on top of other <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> elements in the same top-level window.","pos":[20999,21186],"source":"<xref:System.Windows.Interop.HwndHost> will appear on top of other [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] elements in the same top-level window."},{"content":"However, a <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ToolTip&gt;</ph> or <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ContextMenu&gt;</ph> generated menu is a separate top-level window, and so will behave correctly with <ph id=\"ph3\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph>.","pos":[21187,21403],"source":" However, a <xref:System.Windows.Controls.ToolTip> or <xref:System.Windows.Controls.ContextMenu> generated menu is a separate top-level window, and so will behave correctly with <xref:System.Windows.Interop.HwndHost>."},{"content":"<ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> does not respect the clipping region of its parent <ph id=\"ph2\">&lt;xref:System.Windows.UIElement&gt;</ph>.","pos":[21413,21535],"source":"<xref:System.Windows.Interop.HwndHost> does not respect the clipping region of its parent <xref:System.Windows.UIElement>."},{"content":"This is potentially an issue if you attempt to put an <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> class inside a scrolling region or <ph id=\"ph2\">&lt;xref:System.Windows.Controls.Canvas&gt;</ph>.","pos":[21536,21702],"source":" This is potentially an issue if you attempt to put an <xref:System.Windows.Interop.HwndHost> class inside a scrolling region or <xref:System.Windows.Controls.Canvas>."},{"pos":[21713,21750],"content":"Notable Differences in Input Behavior","linkify":"Notable Differences in Input Behavior","nodes":[{"content":"Notable Differences in Input Behavior","pos":[0,37]}]},{"pos":[21760,22044],"content":"In general, while input devices are scoped within the <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> hosted <ph id=\"ph2\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> region, input events go directly to <ph id=\"ph3\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph>.","source":"In general, while input devices are scoped within the <xref:System.Windows.Interop.HwndHost> hosted [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] region, input events go directly to [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]."},{"pos":[22054,22427],"content":"While the mouse is over the <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph>, your application does not receive <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> mouse events, and the value of the <ph id=\"ph3\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> property <ph id=\"ph4\">&lt;xref:System.Windows.UIElement.IsMouseOver%2A&gt;</ph> will be <ph id=\"ph5\">`false`</ph>.","source":"While the mouse is over the <xref:System.Windows.Interop.HwndHost>, your application does not receive [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] mouse events, and the value of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property <xref:System.Windows.UIElement.IsMouseOver%2A> will be `false`."},{"pos":[22437,22823],"content":"While the <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> has keyboard focus, your application will not receive <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> keyboard events and the value of the <ph id=\"ph3\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> property <ph id=\"ph4\">&lt;xref:System.Windows.UIElement.IsKeyboardFocusWithin%2A&gt;</ph> will be <ph id=\"ph5\">`false`</ph>.","source":"While the <xref:System.Windows.Interop.HwndHost> has keyboard focus, your application will not receive [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] keyboard events and the value of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] property <xref:System.Windows.UIElement.IsKeyboardFocusWithin%2A> will be `false`."},{"pos":[22833,23192],"content":"When focus is within the <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> and changes to another control inside the <ph id=\"ph2\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph>, your application will not receive the <ph id=\"ph3\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> events <ph id=\"ph4\">&lt;xref:System.Windows.UIElement.GotFocus&gt;</ph> or <ph id=\"ph5\">&lt;xref:System.Windows.UIElement.LostFocus&gt;</ph>.","source":"When focus is within the <xref:System.Windows.Interop.HwndHost> and changes to another control inside the <xref:System.Windows.Interop.HwndHost>, your application will not receive the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] events <xref:System.Windows.UIElement.GotFocus> or <xref:System.Windows.UIElement.LostFocus>."},{"pos":[23202,23348],"content":"Related stylus properties and events are analogous, and do not report information while the stylus is over <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph>.","source":"Related stylus properties and events are analogous, and do not report information while the stylus is over <xref:System.Windows.Interop.HwndHost>."},{"pos":[23406,23442],"content":"Tabbing, Mnemonics, and Accelerators","linkify":"Tabbing, Mnemonics, and Accelerators","nodes":[{"content":"Tabbing, Mnemonics, and Accelerators","pos":[0,36]}]},{"pos":[23446,23797],"content":"The <ph id=\"ph1\">&lt;xref:System.Windows.Interop.IKeyboardInputSink&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Windows.Interop.IKeyboardInputSite&gt;</ph> interfaces allow you to create a seamless keyboard experience for mixed <ph id=\"ph3\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> and <ph id=\"ph4\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> applications:","source":"The <xref:System.Windows.Interop.IKeyboardInputSink> and <xref:System.Windows.Interop.IKeyboardInputSite> interfaces allow you to create a seamless keyboard experience for mixed [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] applications:"},{"pos":[23807,23993],"content":"Tabbing between <ph id=\"ph1\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> components","source":"Tabbing between [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] components"},{"content":"Mnemonics and accelerators that work both when focus is within a Win32 component and when it is within a WPF component.","pos":[24003,24122]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Windows.Interop.HwndHost&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Windows.Interop.HwndSource&gt;</ph> classes both provide implementations of <ph id=\"ph3\">&lt;xref:System.Windows.Interop.IKeyboardInputSink&gt;</ph>, but they may not handle all the input messages that you want for more advanced scenarios.","pos":[24129,24396],"source":"The <xref:System.Windows.Interop.HwndHost> and <xref:System.Windows.Interop.HwndSource> classes both provide implementations of <xref:System.Windows.Interop.IKeyboardInputSink>, but they may not handle all the input messages that you want for more advanced scenarios."},{"content":"Override the appropriate methods to get the keyboard behavior you want.","pos":[24397,24468]},{"content":"The interfaces only provide support for what happens on the transition between the <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> regions.","pos":[24475,24726],"source":"The interfaces only provide support for what happens on the transition between the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] regions."},{"content":"Within the <ph id=\"ph1\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> region, tabbing behavior is entirely controlled by the <ph id=\"ph2\">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]</ph> implemented logic for tabbing, if any.","pos":[24727,24979],"source":" Within the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] region, tabbing behavior is entirely controlled by the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] implemented logic for tabbing, if any."},{"pos":[24988,24996],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[25116,25208],"content":"<bpt id=\"p1\">[</bpt>Walkthrough: Hosting a Win32 Control in WPF<ept id=\"p1\">](walkthrough-hosting-a-win32-control-in-wpf.md)</ept>","source":"[Walkthrough: Hosting a Win32 Control in WPF](walkthrough-hosting-a-win32-control-in-wpf.md)"},{"pos":[25211,25299],"content":"<bpt id=\"p1\">[</bpt>Walkthrough: Hosting WPF Content in Win32<ept id=\"p1\">](walkthrough-hosting-wpf-content-in-win32.md)</ept>","source":"[Walkthrough: Hosting WPF Content in Win32](walkthrough-hosting-wpf-content-in-win32.md)"}]}