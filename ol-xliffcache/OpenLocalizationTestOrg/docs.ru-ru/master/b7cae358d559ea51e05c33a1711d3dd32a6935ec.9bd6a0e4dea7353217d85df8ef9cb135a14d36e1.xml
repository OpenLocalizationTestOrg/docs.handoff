{"content":"---\ntitle: \"Compiled Queries  (LINQ to Entities) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-ado\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\n  - \"CSharp\"\n  - \"C++\"\nms.assetid: 8025ba1d-29c7-4407-841b-d5a3bed40b7a\ncaps.latest.revision: 5\nauthor: \"JennieHubbard\"\nms.author: \"jhubbard\"\nmanager: \"jhubbard\"\n---\n# Compiled Queries  (LINQ to Entities)\nWhen you have an application that executes structurally similar queries many times in the Entity Framework, you can frequently increase performance by compiling the query one time and executing it several times with different parameters. For example, an application might have to retrieve all the customers in a particular city; the city is specified at runtime by the user in a form. LINQ to Entities supports using compiled queries for this purpose.  \n  \n Starting with the .NET Framework 4.5, LINQ queries are cached automatically. However, you can still use compiled LINQ queries to reduce this cost in later executions and compiled queries can be more efficient than LINQ queries that are automatically cached. Note that LINQ to Entities queries that apply the `Enumerable.Contains` operator to in-memory collections are not automatically cached. Also parameterizing in-memory collections in compiled LINQ queries is not allowed.  \n  \n The <xref:System.Data.Objects.CompiledQuery> class provides compilation and caching of queries for reuse. Conceptually, this class contains a <xref:System.Data.Objects.CompiledQuery>'s `Compile` method with several overloads. Call the `Compile` method to create a new delegate to represent the compiled query. The `Compile` methods, provided with a <xref:System.Data.Objects.ObjectContext> and parameter values, return a delegate that produces some result (such as an <xref:System.Linq.IQueryable%601> instance). The query compiles once during only the first execution. The merge options set for the query at the time of the compilation cannot be changed later. Once the query is compiled you can only supply parameters of primitive type but you cannot replace parts of the query that would change the generated SQL. For more information, see [Entity Framework Merge Options and Compiled Queries](http://go.microsoft.com/fwlink/?LinkId=199591)  \n  \n The [!INCLUDE[linq_entities](../../../../../../includes/linq-entities-md.md)] query expression that the <xref:System.Data.Objects.CompiledQuery>'s `Compile` method compiles is represented by one of the generic `Func` delegates, such as <xref:System.Func%605>. At most, the query expression can encapsulate an `ObjectContext` parameter, a return parameter, and 16 query parameters. If more than 16 query parameters are required, you can create a structure whose properties represent query parameters. You can then use the properties on the structure in the query expression after you set the properties.  \n  \n## Example  \n The following example compiles and then invokes a query that accepts a <xref:System.Decimal> input parameter and returns a sequence of orders where the total due is greater than or equal to $200.00:  \n  \n [!code-csharp[DP L2E Conceptual Examples#CompiledQuery2](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery2)]\n [!code-vb[DP L2E Conceptual Examples#CompiledQuery2](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery2)]  \n  \n## Example  \n The following example compiles and then invokes a query that returns an <xref:System.Data.Objects.ObjectQuery%601> instance:  \n  \n [!code-csharp[DP L2E Conceptual Examples#CompiledQuery1_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery1_mq)]\n [!code-vb[DP L2E Conceptual Examples#CompiledQuery1_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery1_mq)]  \n  \n## Example  \n The following example compiles and then invokes a query that returns the average of the product list prices as a <xref:System.Decimal> value:  \n  \n [!code-csharp[DP L2E Conceptual Examples#CompiledQuery3_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery3_mq)]\n [!code-vb[DP L2E Conceptual Examples#CompiledQuery3_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery3_mq)]  \n  \n## Example  \n The following example compiles and then invokes a query that accepts a <xref:System.String> input parameter and then returns a `Contact` whose e-mail address starts with the specified string:  \n  \n [!code-csharp[DP L2E Conceptual Examples#CompiledQuery4_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery4_mq)]\n [!code-vb[DP L2E Conceptual Examples#CompiledQuery4_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery4_mq)]  \n  \n## Example  \n The following example compiles and then invokes a query that accepts <xref:System.DateTime> and <xref:System.Decimal> input parameters and returns a sequence of orders where the order date is later than March 8, 2003, and the total due is less than $300.00:  \n  \n [!code-csharp[DP L2E Conceptual Examples#CompiledQuery5](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery5)]\n [!code-vb[DP L2E Conceptual Examples#CompiledQuery5](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery5)]  \n  \n## Example  \n The following example compiles and then invokes a query that accepts a <xref:System.DateTime> input parameter and returns a sequence of orders where the order date is later than March 8, 2004. This query returns the order information as a sequence of anonymous types. Anonymous types are inferred by the compiler, so you cannot specify type parameters in the <xref:System.Data.Objects.CompiledQuery>'s `Compile` method and the type is defined in the query itself.  \n  \n [!code-csharp[DP L2E Conceptual Examples#CompiledQuery6](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery6)]\n [!code-vb[DP L2E Conceptual Examples#CompiledQuery6](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery6)]  \n  \n## Example  \n The following example compiles and then invokes a query that accepts a user-defined structure input parameter and returns a sequence of orders. The structure defines start date, end date, and total due query parameters, and the query returns orders shipped between March 3 and March 8, 2003 with a total due greater than $700.00.  \n  \n [!code-csharp[DP L2E Conceptual Examples#CompiledQuery7](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery7)]\n [!code-vb[DP L2E Conceptual Examples#CompiledQuery7](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery7)]  \n  \n The structure that defines the query parameters:  \n  \n [!code-csharp[DP L2E Conceptual Examples#MyParamsStruct](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#myparamsstruct)]\n [!code-vb[DP L2E Conceptual Examples#MyParamsStruct](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#myparamsstruct)]  \n  \n## See Also  \n [ADO.NET Entity Framework](../../../../../../docs/framework/data/adonet/ef/index.md)   \n [LINQ to Entities](../../../../../../docs/framework/data/adonet/ef/language-reference/linq-to-entities.md)   \n [Entity Framework Merge Options and Compiled Queries](http://go.microsoft.com/fwlink/?LinkId=199591)","nodes":[{"pos":[4,411],"embed":true,"restype":"x-metadata","content":"title: \"Compiled Queries  (LINQ to Entities) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-ado\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\n  - \"CSharp\"\n  - \"C++\"\nms.assetid: 8025ba1d-29c7-4407-841b-d5a3bed40b7a\ncaps.latest.revision: 5\nauthor: \"JennieHubbard\"\nms.author: \"jhubbard\"\nmanager: \"jhubbard\"","nodes":[{"content":"Compiled Queries  (LINQ to Entities) | Microsoft Docs","nodes":[{"pos":[0,53],"content":"Compiled Queries  (LINQ to Entities) | Microsoft Docs","nodes":[{"content":"Compiled Queries  (LINQ to Entities) | Microsoft Docs","pos":[0,53]}]}],"path":["title"]}],"yml":true},{"pos":[418,454],"content":"Compiled Queries  (LINQ to Entities)","linkify":"Compiled Queries  (LINQ to Entities)","nodes":[{"content":"Compiled Queries  (LINQ to Entities)","pos":[0,36]}]},{"content":"When you have an application that executes structurally similar queries many times in the Entity Framework, you can frequently increase performance by compiling the query one time and executing it several times with different parameters.","pos":[455,692]},{"content":"For example, an application might have to retrieve all the customers in a particular city; the city is specified at runtime by the user in a form.","pos":[693,839]},{"content":"LINQ to Entities supports using compiled queries for this purpose.","pos":[840,906]},{"content":"Starting with the .NET Framework 4.5, LINQ queries are cached automatically.","pos":[913,989]},{"content":"However, you can still use compiled LINQ queries to reduce this cost in later executions and compiled queries can be more efficient than LINQ queries that are automatically cached.","pos":[990,1170]},{"content":"Note that LINQ to Entities queries that apply the <ph id=\"ph1\">`Enumerable.Contains`</ph> operator to in-memory collections are not automatically cached.","pos":[1171,1306],"source":" Note that LINQ to Entities queries that apply the `Enumerable.Contains` operator to in-memory collections are not automatically cached."},{"content":"Also parameterizing in-memory collections in compiled LINQ queries is not allowed.","pos":[1307,1389]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Data.Objects.CompiledQuery&gt;</ph> class provides compilation and caching of queries for reuse.","pos":[1396,1501],"source":"The <xref:System.Data.Objects.CompiledQuery> class provides compilation and caching of queries for reuse."},{"content":"Conceptually, this class contains a <ph id=\"ph1\">&lt;xref:System.Data.Objects.CompiledQuery&gt;</ph>'s <ph id=\"ph2\">`Compile`</ph> method with several overloads.","pos":[1502,1621],"source":" Conceptually, this class contains a <xref:System.Data.Objects.CompiledQuery>'s `Compile` method with several overloads."},{"content":"Call the <ph id=\"ph1\">`Compile`</ph> method to create a new delegate to represent the compiled query.","pos":[1622,1705],"source":" Call the `Compile` method to create a new delegate to represent the compiled query."},{"content":"The <ph id=\"ph1\">`Compile`</ph> methods, provided with a <ph id=\"ph2\">&lt;xref:System.Data.Objects.ObjectContext&gt;</ph> and parameter values, return a delegate that produces some result (such as an <ph id=\"ph3\">&lt;xref:System.Linq.IQueryable%601&gt;</ph> instance).","pos":[1706,1908],"source":" The `Compile` methods, provided with a <xref:System.Data.Objects.ObjectContext> and parameter values, return a delegate that produces some result (such as an <xref:System.Linq.IQueryable%601> instance)."},{"content":"The query compiles once during only the first execution.","pos":[1909,1965]},{"content":"The merge options set for the query at the time of the compilation cannot be changed later.","pos":[1966,2057]},{"content":"Once the query is compiled you can only supply parameters of primitive type but you cannot replace parts of the query that would change the generated SQL.","pos":[2058,2212]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Entity Framework Merge Options and Compiled Queries<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=199591)</ept>","pos":[2213,2339],"source":" For more information, see [Entity Framework Merge Options and Compiled Queries](http://go.microsoft.com/fwlink/?LinkId=199591)"},{"content":"The <ph id=\"ph1\">[!INCLUDE[linq_entities](../../../../../../includes/linq-entities-md.md)]</ph> query expression that the <ph id=\"ph2\">&lt;xref:System.Data.Objects.CompiledQuery&gt;</ph>'s <ph id=\"ph3\">`Compile`</ph> method compiles is represented by one of the generic <ph id=\"ph4\">`Func`</ph> delegates, such as <ph id=\"ph5\">&lt;xref:System.Func%605&gt;</ph>.","pos":[2346,2605],"source":"The [!INCLUDE[linq_entities](../../../../../../includes/linq-entities-md.md)] query expression that the <xref:System.Data.Objects.CompiledQuery>'s `Compile` method compiles is represented by one of the generic `Func` delegates, such as <xref:System.Func%605>."},{"content":"At most, the query expression can encapsulate an <ph id=\"ph1\">`ObjectContext`</ph> parameter, a return parameter, and 16 query parameters.","pos":[2606,2726],"source":" At most, the query expression can encapsulate an `ObjectContext` parameter, a return parameter, and 16 query parameters."},{"content":"If more than 16 query parameters are required, you can create a structure whose properties represent query parameters.","pos":[2727,2845]},{"content":"You can then use the properties on the structure in the query expression after you set the properties.","pos":[2846,2948]},{"pos":[2957,2964],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following example compiles and then invokes a query that accepts a <ph id=\"ph1\">&lt;xref:System.Decimal&gt;</ph> input parameter and returns a sequence of orders where the total due is greater than or equal to $200.00:","pos":[2968,3166],"source":"The following example compiles and then invokes a query that accepts a <xref:System.Decimal> input parameter and returns a sequence of orders where the total due is greater than or equal to $200.00:"},{"pos":[3531,3538],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following example compiles and then invokes a query that returns an <ph id=\"ph1\">&lt;xref:System.Data.Objects.ObjectQuery%601&gt;</ph> instance:","pos":[3542,3666],"source":"The following example compiles and then invokes a query that returns an <xref:System.Data.Objects.ObjectQuery%601> instance:"},{"pos":[4043,4050],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following example compiles and then invokes a query that returns the average of the product list prices as a <ph id=\"ph1\">&lt;xref:System.Decimal&gt;</ph> value:","pos":[4054,4195],"source":"The following example compiles and then invokes a query that returns the average of the product list prices as a <xref:System.Decimal> value:"},{"pos":[4572,4579],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"pos":[4583,4774],"content":"The following example compiles and then invokes a query that accepts a <ph id=\"ph1\">&lt;xref:System.String&gt;</ph> input parameter and then returns a <ph id=\"ph2\">`Contact`</ph> whose e-mail address starts with the specified string:","source":"The following example compiles and then invokes a query that accepts a <xref:System.String> input parameter and then returns a `Contact` whose e-mail address starts with the specified string:"},{"pos":[5151,5158],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following example compiles and then invokes a query that accepts <ph id=\"ph1\">&lt;xref:System.DateTime&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Decimal&gt;</ph> input parameters and returns a sequence of orders where the order date is later than March 8, 2003, and the total due is less than $300.00:","pos":[5162,5419],"source":"The following example compiles and then invokes a query that accepts <xref:System.DateTime> and <xref:System.Decimal> input parameters and returns a sequence of orders where the order date is later than March 8, 2003, and the total due is less than $300.00:"},{"pos":[5784,5791],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following example compiles and then invokes a query that accepts a <ph id=\"ph1\">&lt;xref:System.DateTime&gt;</ph> input parameter and returns a sequence of orders where the order date is later than March 8, 2004.","pos":[5795,5987],"source":"The following example compiles and then invokes a query that accepts a <xref:System.DateTime> input parameter and returns a sequence of orders where the order date is later than March 8, 2004."},{"content":"This query returns the order information as a sequence of anonymous types.","pos":[5988,6062]},{"content":"Anonymous types are inferred by the compiler, so you cannot specify type parameters in the <ph id=\"ph1\">&lt;xref:System.Data.Objects.CompiledQuery&gt;</ph>'s <ph id=\"ph2\">`Compile`</ph> method and the type is defined in the query itself.","pos":[6063,6258],"source":" Anonymous types are inferred by the compiler, so you cannot specify type parameters in the <xref:System.Data.Objects.CompiledQuery>'s `Compile` method and the type is defined in the query itself."},{"pos":[6623,6630],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following example compiles and then invokes a query that accepts a user-defined structure input parameter and returns a sequence of orders.","pos":[6634,6777]},{"content":"The structure defines start date, end date, and total due query parameters, and the query returns orders shipped between March 3 and March 8, 2003 with a total due greater than $700.00.","pos":[6778,6963]},{"content":"The structure that defines the query parameters:","pos":[7326,7374]},{"pos":[7739,7747],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>ADO.NET Entity Framework<ept id=\"p1\">](../../../../../../docs/framework/data/adonet/ef/index.md)</ept><ph id=\"ph1\"> </ph>","pos":[7751,7836],"source":"[ADO.NET Entity Framework](../../../../../../docs/framework/data/adonet/ef/index.md) "},{"content":"<bpt id=\"p1\">[</bpt>LINQ to Entities<ept id=\"p1\">](../../../../../../docs/framework/data/adonet/ef/language-reference/linq-to-entities.md)</ept><ph id=\"ph1\"> </ph>","pos":[7840,7947],"source":"[LINQ to Entities](../../../../../../docs/framework/data/adonet/ef/language-reference/linq-to-entities.md) "},{"content":"<bpt id=\"p1\">[</bpt>Entity Framework Merge Options and Compiled Queries<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=199591)</ept>","pos":[7951,8051],"source":"[Entity Framework Merge Options and Compiled Queries](http://go.microsoft.com/fwlink/?LinkId=199591)"}]}