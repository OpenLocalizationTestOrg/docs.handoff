{"content":"---\ntitle: \"Execute a Workflow in an Imperative TransactionScope | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: bd0e8686-c1d0-4400-a541-da94ed03afc7\ncaps.latest.revision: 10\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Execute a Workflow in an Imperative TransactionScope\nThis sample shows how to execute a workflow using <xref:System.Activities.WorkflowInvoker> under a <xref:System.Transactions.Transaction> from imperative C# code.  \n  \n## Sample Details  \n In imperative C# code, the <xref:System.Transactions.TransactionScope> is used to encapsulate a set of work that executes under the same transaction. The <xref:System.Transactions.TransactionScope> works by creating an ambient transaction and initializing the <xref:System.Transactions.Transaction.Current%2A> property, which can then be accessed by any work being executed on that thread.  \n  \n To get equivalent behavior in workflow, the runtime has to do the extra work of initializing <xref:System.Transactions.Transaction.Current%2A> before executing each activity because a workflow does not maintain thread affinity between activities. With this runtime support, the resulting behavior is that when executing a workflow with <xref:System.Activities.WorkflowInvoker> inside a <xref:System.Transactions.TransactionScope>, all activities are guaranteed to run under the context of the ambient transaction created by the <xref:System.Transactions.TransactionScope>.  \n  \n A workflow can have only a single ambient transaction for each workflow instance; nested transactions are not available. Even if the workflow contains a <xref:System.Activities.Statements.TransactionScope> activity, this does not create a new inner transaction. Instead, this reuses the ambient transaction that was created outside the workflow.  \n  \n The sample begins a new <xref:System.Transactions.TransactionScope>, prints the transaction ID and begins a workflow using <xref:System.Activities.WorkflowInvoker>. The workflow prints the transaction ID again, showing that it is the same transaction, then runs a <xref:System.Activities.Statements.TransactionScope>, then completes. The <xref:System.Activities.WorkflowInvoker.Invoke%2A> call on <xref:System.Activities.WorkflowInvoker> is synchronous so the original thread blocks until the workflow completes. Once the workflow is complete, the transaction is completed and resources disposed.  \n  \n#### To use this sample  \n  \n1.  Using [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)], open the ImperativeTransactionSample.sln solution file.  \n  \n2.  To build the solution, press CTRL+SHIFT+B.  \n  \n3.  To run the solution, press F5.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Scenario\\Transactions\\ImperativeTransaction`  \n  \n## See Also","nodes":[{"pos":[12,81],"content":"Execute a Workflow in an Imperative TransactionScope | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Execute a Workflow in an Imperative TransactionScope | Microsoft Docs","pos":[0,69]}]},{"pos":[347,399],"content":"Execute a Workflow in an Imperative TransactionScope","linkify":"Execute a Workflow in an Imperative TransactionScope","nodes":[{"content":"Execute a Workflow in an Imperative TransactionScope","pos":[0,52]}]},{"content":"This sample shows how to execute a workflow using <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowInvoker&gt;</ph> under a <ph id=\"ph2\">&lt;xref:System.Transactions.Transaction&gt;</ph> from imperative C# code.","pos":[400,562],"source":"This sample shows how to execute a workflow using <xref:System.Activities.WorkflowInvoker> under a <xref:System.Transactions.Transaction> from imperative C# code."},{"pos":[571,585],"content":"Sample Details","linkify":"Sample Details","nodes":[{"content":"Sample Details","pos":[0,14]}]},{"content":"In imperative C# code, the <ph id=\"ph1\">&lt;xref:System.Transactions.TransactionScope&gt;</ph> is used to encapsulate a set of work that executes under the same transaction.","pos":[589,738],"source":"In imperative C# code, the <xref:System.Transactions.TransactionScope> is used to encapsulate a set of work that executes under the same transaction."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Transactions.TransactionScope&gt;</ph> works by creating an ambient transaction and initializing the <ph id=\"ph2\">&lt;xref:System.Transactions.Transaction.Current%2A&gt;</ph> property, which can then be accessed by any work being executed on that thread.","pos":[739,978],"source":" The <xref:System.Transactions.TransactionScope> works by creating an ambient transaction and initializing the <xref:System.Transactions.Transaction.Current%2A> property, which can then be accessed by any work being executed on that thread."},{"content":"To get equivalent behavior in workflow, the runtime has to do the extra work of initializing <ph id=\"ph1\">&lt;xref:System.Transactions.Transaction.Current%2A&gt;</ph> before executing each activity because a workflow does not maintain thread affinity between activities.","pos":[985,1231],"source":"To get equivalent behavior in workflow, the runtime has to do the extra work of initializing <xref:System.Transactions.Transaction.Current%2A> before executing each activity because a workflow does not maintain thread affinity between activities."},{"content":"With this runtime support, the resulting behavior is that when executing a workflow with <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowInvoker&gt;</ph> inside a <ph id=\"ph2\">&lt;xref:System.Transactions.TransactionScope&gt;</ph>, all activities are guaranteed to run under the context of the ambient transaction created by the <ph id=\"ph3\">&lt;xref:System.Transactions.TransactionScope&gt;</ph>.","pos":[1232,1557],"source":" With this runtime support, the resulting behavior is that when executing a workflow with <xref:System.Activities.WorkflowInvoker> inside a <xref:System.Transactions.TransactionScope>, all activities are guaranteed to run under the context of the ambient transaction created by the <xref:System.Transactions.TransactionScope>."},{"content":"A workflow can have only a single ambient transaction for each workflow instance; nested transactions are not available.","pos":[1564,1684]},{"content":"Even if the workflow contains a <ph id=\"ph1\">&lt;xref:System.Activities.Statements.TransactionScope&gt;</ph> activity, this does not create a new inner transaction.","pos":[1685,1825],"source":" Even if the workflow contains a <xref:System.Activities.Statements.TransactionScope> activity, this does not create a new inner transaction."},{"content":"Instead, this reuses the ambient transaction that was created outside the workflow.","pos":[1826,1909]},{"content":"The sample begins a new <ph id=\"ph1\">&lt;xref:System.Transactions.TransactionScope&gt;</ph>, prints the transaction ID and begins a workflow using <ph id=\"ph2\">&lt;xref:System.Activities.WorkflowInvoker&gt;</ph>.","pos":[1916,2080],"source":"The sample begins a new <xref:System.Transactions.TransactionScope>, prints the transaction ID and begins a workflow using <xref:System.Activities.WorkflowInvoker>."},{"content":"The workflow prints the transaction ID again, showing that it is the same transaction, then runs a <ph id=\"ph1\">&lt;xref:System.Activities.Statements.TransactionScope&gt;</ph>, then completes.","pos":[2081,2249],"source":" The workflow prints the transaction ID again, showing that it is the same transaction, then runs a <xref:System.Activities.Statements.TransactionScope>, then completes."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowInvoker.Invoke%2A&gt;</ph> call on <ph id=\"ph2\">&lt;xref:System.Activities.WorkflowInvoker&gt;</ph> is synchronous so the original thread blocks until the workflow completes.","pos":[2250,2428],"source":" The <xref:System.Activities.WorkflowInvoker.Invoke%2A> call on <xref:System.Activities.WorkflowInvoker> is synchronous so the original thread blocks until the workflow completes."},{"content":"Once the workflow is complete, the transaction is completed and resources disposed.","pos":[2429,2512]},{"pos":[2523,2541],"content":"To use this sample","linkify":"To use this sample","nodes":[{"content":"To use this sample","pos":[0,18]}]},{"pos":[2551,2667],"content":"Using <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph>, open the ImperativeTransactionSample.sln solution file.","source":"Using [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)], open the ImperativeTransactionSample.sln solution file."},{"content":"To build the solution, press CTRL+SHIFT+B.","pos":[2677,2719]},{"content":"To run the solution, press F5.","pos":[2729,2759]},{"pos":[2767,2899],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[2953,3279],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[3280,3330]},{"pos":[3429,3437],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]}]}