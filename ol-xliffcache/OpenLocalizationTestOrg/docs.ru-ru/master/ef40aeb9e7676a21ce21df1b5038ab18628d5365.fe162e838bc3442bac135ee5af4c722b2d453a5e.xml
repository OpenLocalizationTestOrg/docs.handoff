{"content":"---\ntitle: \"Bridging and Error Handling | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 4ae87d1a-b615-4014-a494-a53f63ff0137\ncaps.latest.revision: 21\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Bridging and Error Handling\nThis sample demonstrates how the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] routing service is used for bridging communication between a client and a service that use different bindings. This sample also shows how to use a back-up service for failover scenarios. The routing service is a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] component that makes it easy to include a content-based router in your application. This sample adapts the standard [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] Calculator Sample to communicate using the routing service.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your computer. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\RoutingServices\\ErrorHandlingAndBridging`  \n  \n## Sample Details  \n In this sample, the Calculator client is configured to send messages to an endpoint exposed by the router. The routing service is configured to accept all messages sent to it and to forward them to an endpoint that corresponds to the Calculator service. The following points describe the configuration of the primary Calculator service, the back-up Calculator service, and the Calculator client and how the communication between the client and the service happens using the routing service:  \n  \n-   The Calculator client is configured to use BasicHttpBinding while the Calculator service is configured to use NetTcpBinding. The routing service automatically converts the messages as necessary before sending them to the Calculator service and it also converts the responses so that the Calculator client can access them.  \n  \n-   The routing service knows about two Calculator services: the primary Calculator service and the back-up Calculator service. The routing service first attempts to communicate with the primary Calculator service endpoint. If this attempt fails due to the endpoint being down, the routing service then tries to communicate with the back-up Calculator service endpoint.  \n  \n Thus messages sent from the client are received by the router and are rerouted to the actual Calculator service. If the Calculator service endpoint is down, the routing service routes the message to the back-up Calculator service endpoint. Messages from the back-up Calculator service are sent back to the service router, which in turn passes them back to the Calculator client.  \n  \n> [!NOTE]\n>  A back-up list can have more than one endpoint defined. In this case if the back-up service endpoint is down, the routing service attempts to connect to the next back-up endpoint in the list until a successful connection occurs.  \n  \n#### To use this sample  \n  \n1.  Using [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], open RouterBridgingAndErrorHandling.sln.  \n  \n2.  Press F5 or CTRL+SHIFT+B in Visual Studio  \n  \n    1.  If you would like to auto-launch the necessary projects when you press F5, right-click the solution, select **Properties**, and in the **Startup Project** node under **Common Properties**, select **Multiple Startup Projects**, and set all projects to **Start**.  \n  \n    2.  If you build the project with CTRL+SHIFT+B, start the following applications:  \n  \n        1.  Calculator client (./CalculatorClient/bin/client.exe)  \n  \n        2.  Calculator service (./CalculatorService/bin/service.exe)  \n  \n        3.  Routing Service (./RoutingService/bin/RoutingService.exe)  \n  \n3.  In the Calculator Client, press ENTER to start the client.  \n  \n     You should see the following output:  \n  \n    ```Output  \n    Add(100,15.99) = 115.99  \n    Subtract(145,76.54) = 68.46  \n    Multiply(9,81.25) = 731.25  \n    Divide(22,7) = 3.14285714285714  \n  \n    ```  \n  \n## Configurable Via Code or App.config  \n The sample ships configured to use an App.config file to define the router’s behavior. You can also change the name of the App.config file to something else so that it is not recognized and uncomment the method call to `ConfigureRouterViaCode()`. Either method results in the same behavior from the router.  \n  \n### Scenario  \n This sample demonstrates the service router acting as a protocol bridge and error handler. In this scenario, no content-based routing occurs; the routing service acts as a transparent proxy node configured to pass messages directly to a preconfigured set of destination endpoints. The routing service also performs the additional steps of transparently handling errors that occur when it tries to send to the endpoints that it is configured to communicate with. By acting as a protocol bridge, the routing service enables the user to define one protocol for external communication and another for internal communication.  \n  \n### Real World Scenario  \n Contoso wants to provide an interoperable service endpoint to the world, while optimizing performance internally. Thus it exposes its services to the world through an endpoint using the BasicHttpBinding, while internally using the routing service to bridge that connection to the endpoint using NetTcpBinding, which its services use. Furthermore, Contoso wants its service offering to be tolerant of temporary outages in any one of their production services and thus virtualizes multiple endpoints behind the router service using the ’s error handling capabilities to automatically failover to back-up endpoints when necessary.  \n  \n## See Also  \n [AppFabric Hosting and Persistence Samples](http://go.microsoft.com/fwlink/?LinkId=193961)","nodes":[{"pos":[12,56],"content":"Bridging and Error Handling | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Bridging and Error Handling | Microsoft Docs","pos":[0,44]}]},{"pos":[355,382],"content":"Bridging and Error Handling","linkify":"Bridging and Error Handling","nodes":[{"content":"Bridging and Error Handling","pos":[0,27]}]},{"content":"This sample demonstrates how the <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> routing service is used for bridging communication between a client and a service that use different bindings.","pos":[383,582],"source":"This sample demonstrates how the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] routing service is used for bridging communication between a client and a service that use different bindings."},{"content":"This sample also shows how to use a back-up service for failover scenarios.","pos":[583,658]},{"content":"The routing service is a <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> component that makes it easy to include a content-based router in your application.","pos":[659,823],"source":" The routing service is a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] component that makes it easy to include a content-based router in your application."},{"content":"This sample adapts the standard <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> Calculator Sample to communicate using the routing service.","pos":[824,971],"source":" This sample adapts the standard [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] Calculator Sample to communicate using the routing service."},{"pos":[979,1112],"content":"[!IMPORTANT]\n The samples may already be installed on your computer. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your computer. Check for the following (default) directory before continuing.","pos":[13,131],"nodes":[{"content":"The samples may already be installed on your computer.","pos":[1,55]},{"content":"Check for the following (default) directory before continuing.","pos":[56,118]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[1166,1492],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[1493,1543]},{"pos":[1646,1660],"content":"Sample Details","linkify":"Sample Details","nodes":[{"content":"Sample Details","pos":[0,14]}]},{"content":"In this sample, the Calculator client is configured to send messages to an endpoint exposed by the router.","pos":[1664,1770]},{"content":"The routing service is configured to accept all messages sent to it and to forward them to an endpoint that corresponds to the Calculator service.","pos":[1771,1917]},{"content":"The following points describe the configuration of the primary Calculator service, the back-up Calculator service, and the Calculator client and how the communication between the client and the service happens using the routing service:","pos":[1918,2154]},{"content":"The Calculator client is configured to use BasicHttpBinding while the Calculator service is configured to use NetTcpBinding.","pos":[2164,2288]},{"content":"The routing service automatically converts the messages as necessary before sending them to the Calculator service and it also converts the responses so that the Calculator client can access them.","pos":[2289,2485]},{"content":"The routing service knows about two Calculator services: the primary Calculator service and the back-up Calculator service.","pos":[2495,2618]},{"content":"The routing service first attempts to communicate with the primary Calculator service endpoint.","pos":[2619,2714]},{"content":"If this attempt fails due to the endpoint being down, the routing service then tries to communicate with the back-up Calculator service endpoint.","pos":[2715,2860]},{"content":"Thus messages sent from the client are received by the router and are rerouted to the actual Calculator service.","pos":[2867,2979]},{"content":"If the Calculator service endpoint is down, the routing service routes the message to the back-up Calculator service endpoint.","pos":[2980,3106]},{"content":"Messages from the back-up Calculator service are sent back to the service router, which in turn passes them back to the Calculator client.","pos":[3107,3245]},{"pos":[3253,3492],"content":"[!NOTE]\n A back-up list can have more than one endpoint defined. In this case if the back-up service endpoint is down, the routing service attempts to connect to the next back-up endpoint in the list until a successful connection occurs.","leadings":["","> "],"nodes":[{"content":" A back-up list can have more than one endpoint defined. In this case if the back-up service endpoint is down, the routing service attempts to connect to the next back-up endpoint in the list until a successful connection occurs.","pos":[8,237],"nodes":[{"content":"A back-up list can have more than one endpoint defined.","pos":[1,56]},{"content":"In this case if the back-up service endpoint is down, the routing service attempts to connect to the next back-up endpoint in the list until a successful connection occurs.","pos":[57,229]}]}]},{"pos":[3503,3521],"content":"To use this sample","linkify":"To use this sample","nodes":[{"content":"To use this sample","pos":[0,18]}]},{"pos":[3531,3650],"content":"Using <ph id=\"ph1\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph>, open RouterBridgingAndErrorHandling.sln.","source":"Using [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], open RouterBridgingAndErrorHandling.sln."},{"content":"Press F5 or CTRL+SHIFT+B in Visual Studio","pos":[3660,3701]},{"pos":[3715,3976],"content":"If you would like to auto-launch the necessary projects when you press F5, right-click the solution, select <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>, and in the <bpt id=\"p2\">**</bpt>Startup Project<ept id=\"p2\">**</ept> node under <bpt id=\"p3\">**</bpt>Common Properties<ept id=\"p3\">**</ept>, select <bpt id=\"p4\">**</bpt>Multiple Startup Projects<ept id=\"p4\">**</ept>, and set all projects to <bpt id=\"p5\">**</bpt>Start<ept id=\"p5\">**</ept>.","source":"If you would like to auto-launch the necessary projects when you press F5, right-click the solution, select **Properties**, and in the **Startup Project** node under **Common Properties**, select **Multiple Startup Projects**, and set all projects to **Start**."},{"content":"If you build the project with CTRL+SHIFT+B, start the following applications:","pos":[3990,4067]},{"content":"Calculator client (./CalculatorClient/bin/client.exe)","pos":[4085,4138]},{"content":"Calculator service (./CalculatorService/bin/service.exe)","pos":[4156,4212]},{"content":"Routing Service (./RoutingService/bin/RoutingService.exe)","pos":[4230,4287]},{"content":"In the Calculator Client, press ENTER to start the client.","pos":[4297,4355]},{"content":"You should see the following output:","pos":[4366,4402]},{"pos":[4578,4613],"content":"Configurable Via Code or App.config","linkify":"Configurable Via Code or App.config","nodes":[{"content":"Configurable Via Code or App.config","pos":[0,35]}]},{"content":"The sample ships configured to use an App.config file to define the router’s behavior.","pos":[4617,4703]},{"content":"You can also change the name of the App.config file to something else so that it is not recognized and uncomment the method call to <ph id=\"ph1\">`ConfigureRouterViaCode()`</ph>.","pos":[4704,4863],"source":" You can also change the name of the App.config file to something else so that it is not recognized and uncomment the method call to `ConfigureRouterViaCode()`."},{"content":"Either method results in the same behavior from the router.","pos":[4864,4923]},{"pos":[4933,4941],"content":"Scenario","linkify":"Scenario","nodes":[{"content":"Scenario","pos":[0,8]}]},{"content":"This sample demonstrates the service router acting as a protocol bridge and error handler.","pos":[4945,5035]},{"content":"In this scenario, no content-based routing occurs; the routing service acts as a transparent proxy node configured to pass messages directly to a preconfigured set of destination endpoints.","pos":[5036,5225]},{"content":"The routing service also performs the additional steps of transparently handling errors that occur when it tries to send to the endpoints that it is configured to communicate with.","pos":[5226,5406]},{"content":"By acting as a protocol bridge, the routing service enables the user to define one protocol for external communication and another for internal communication.","pos":[5407,5565]},{"pos":[5575,5594],"content":"Real World Scenario","linkify":"Real World Scenario","nodes":[{"content":"Real World Scenario","pos":[0,19]}]},{"content":"Contoso wants to provide an interoperable service endpoint to the world, while optimizing performance internally.","pos":[5598,5711]},{"content":"Thus it exposes its services to the world through an endpoint using the BasicHttpBinding, while internally using the routing service to bridge that connection to the endpoint using NetTcpBinding, which its services use.","pos":[5712,5931]},{"content":"Furthermore, Contoso wants its service offering to be tolerant of temporary outages in any one of their production services and thus virtualizes multiple endpoints behind the router service using the ’s error handling capabilities to automatically failover to back-up endpoints when necessary.","pos":[5932,6225]},{"pos":[6234,6242],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[6246,6336],"content":"<bpt id=\"p1\">[</bpt>AppFabric Hosting and Persistence Samples<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=193961)</ept>","source":"[AppFabric Hosting and Persistence Samples](http://go.microsoft.com/fwlink/?LinkId=193961)"}]}