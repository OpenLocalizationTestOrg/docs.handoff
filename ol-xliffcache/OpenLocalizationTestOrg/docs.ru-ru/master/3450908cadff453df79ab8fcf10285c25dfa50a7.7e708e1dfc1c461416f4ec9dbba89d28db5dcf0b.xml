{"content":"---\ntitle: \"Data Parallelism (Task Parallel Library)\"\nms.date: \"03/30/2017\"\nms.technology: dotnet-standard\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"parallelism, data\"\nms.assetid: 3f05f33f-f1da-4b16-81c2-9ceff1bef449\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\n---\n# Data Parallelism (Task Parallel Library)\n*Data parallelism* refers to scenarios in which the same operation is performed concurrently (that is, in parallel) on elements in a source collection or array. In data parallel operations, the source collection is partitioned so that multiple threads can operate on different segments concurrently.  \n  \n The Task Parallel Library (TPL) supports data parallelism through the <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> class. This class provides method-based parallel implementations of [for](~/docs/csharp/language-reference/keywords/for.md) and [foreach](~/docs/csharp/language-reference/keywords/foreach-in.md) loops (`For` and `For Each` in Visual Basic). You write the loop logic for a <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> or <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> loop much as you would write a sequential loop. You do not have to create threads or queue work items. In basic loops, you do not have to take locks. The TPL handles all the low-level work for you. For in-depth information about the use of <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType>, download the document [Patterns for Parallel Programming: Understanding and Applying Parallel Patterns with the .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=19222). The following code example shows a simple `foreach` loop and its parallel equivalent.  \n  \n> [!NOTE]\n>  This documentation uses lambda expressions to define delegates in TPL. If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).  \n  \n [!code-csharp[TPL#20](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl/cs/tpl.cs#20)]\n [!code-vb[TPL#20](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl/vb/tpl_vb.vb#20)]  \n  \n When a parallel loop runs, the TPL partitions the data source so that the loop can operate on multiple parts concurrently. Behind the scenes, the Task Scheduler partitions the task based on system resources and workload. When possible, the scheduler redistributes work among multiple threads and processors if the workload becomes unbalanced.  \n  \n> [!NOTE]\n>  You can also supply your own custom partitioner or scheduler. For more information, see [Custom Partitioners for PLINQ and TPL](../../../docs/standard/parallel-programming/custom-partitioners-for-plinq-and-tpl.md) and [Task Schedulers](xref:System.Threading.Tasks.TaskScheduler).  \n  \n Both the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> methods have several overloads that let you stop or break loop execution, monitor the state of the loop on other threads, maintain thread-local state, finalize thread-local objects, control the degree of concurrency, and so on. The helper types that enable this functionality include <xref:System.Threading.Tasks.ParallelLoopState>, <xref:System.Threading.Tasks.ParallelOptions>, <xref:System.Threading.Tasks.ParallelLoopResult>, <xref:System.Threading.CancellationToken>, and <xref:System.Threading.CancellationTokenSource>.  \n  \n For more information, see [Patterns for Parallel Programming: Understanding and Applying Parallel Patterns with the .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=19222).  \n  \n Data parallelism with declarative, or query-like, syntax is supported by PLINQ. For more information, see [Parallel LINQ (PLINQ)](../../../docs/standard/parallel-programming/parallel-linq-plinq.md).  \n  \n## Related Topics  \n  \n|Title|Description|  \n|-----------|-----------------|  \n|[How to: Write a Simple Parallel.For Loop](../../../docs/standard/parallel-programming/how-to-write-a-simple-parallel-for-loop.md)|Describes how to write a <xref:System.Threading.Tasks.Parallel.For%2A> loop over any array or indexable <xref:System.Collections.Generic.IEnumerable%601> source collection.|  \n|[How to: Write a Simple Parallel.ForEach Loop](../../../docs/standard/parallel-programming/how-to-write-a-simple-parallel-foreach-loop.md)|Describes how to write a <xref:System.Threading.Tasks.Parallel.ForEach%2A> loop over any <xref:System.Collections.Generic.IEnumerable%601> source collection.|  \n|[How to: Stop or Break from a Parallel.For Loop](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd460721(v=vs.100))|Describes how to stop or break from a parallel loop so that all threads are informed of the action.|  \n|[How to: Write a Parallel.For Loop with Thread-Local Variables](../../../docs/standard/parallel-programming/how-to-write-a-parallel-for-loop-with-thread-local-variables.md)|Describes how to write a <xref:System.Threading.Tasks.Parallel.For%2A> loop in which each thread maintains a private variable that is not visible to any other threads, and how to synchronize the results from all threads when the loop completes.|  \n|[How to: Write a Parallel.ForEach Loop with Partition-Local Variables](../../../docs/standard/parallel-programming/how-to-write-a-parallel-foreach-loop-with-partition-local-variables.md)|Describes how to write a <xref:System.Threading.Tasks.Parallel.ForEach%2A> loop in which each thread maintains a private variable that is not visible to any other threads, and how to synchronize the results from all threads when the loop completes.|  \n|[How to: Cancel a Parallel.For or ForEach Loop](../../../docs/standard/parallel-programming/how-to-cancel-a-parallel-for-or-foreach-loop.md)|Describes how to cancel a parallel loop by using a <xref:System.Threading.CancellationToken?displayProperty=nameWithType>|  \n|[How to: Speed Up Small Loop Bodies](../../../docs/standard/parallel-programming/how-to-speed-up-small-loop-bodies.md)|Describes one way to speed up execution when a loop body is very small.|  \n|[Task Parallel Library (TPL)](../../../docs/standard/parallel-programming/task-parallel-library-tpl.md)|Provides an overview of the Task Parallel Library.|  \n|[Parallel Programming](../../../docs/standard/parallel-programming/index.md)|Introduces Parallel Programming in the .NET Framework.|  \n  \n## See also\n\n- [Parallel Programming](../../../docs/standard/parallel-programming/index.md)\n","nodes":[{"pos":[4,275],"embed":true,"restype":"x-metadata","content":"title: \"Data Parallelism (Task Parallel Library)\"\nms.date: \"03/30/2017\"\nms.technology: dotnet-standard\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"parallelism, data\"\nms.assetid: 3f05f33f-f1da-4b16-81c2-9ceff1bef449\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"","nodes":[{"content":"Data Parallelism (Task Parallel Library)","nodes":[{"pos":[0,40],"content":"Data Parallelism (Task Parallel Library)","nodes":[{"content":"Data Parallelism (Task Parallel Library)","pos":[0,40]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[282,322],"content":"Data Parallelism (Task Parallel Library)","linkify":"Data Parallelism (Task Parallel Library)","nodes":[{"content":"Data Parallelism (Task Parallel Library)","pos":[0,40]}]},{"content":"<bpt id=\"p1\">*</bpt>Data parallelism<ept id=\"p1\">*</ept> refers to scenarios in which the same operation is performed concurrently (that is, in parallel) on elements in a source collection or array.","pos":[323,483],"source":"*Data parallelism* refers to scenarios in which the same operation is performed concurrently (that is, in parallel) on elements in a source collection or array."},{"content":"In data parallel operations, the source collection is partitioned so that multiple threads can operate on different segments concurrently.","pos":[484,622]},{"content":"The Task Parallel Library (TPL) supports data parallelism through the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType&gt;</ph> class.","pos":[629,773],"source":"The Task Parallel Library (TPL) supports data parallelism through the <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> class."},{"content":"This class provides method-based parallel implementations of <bpt id=\"p1\">[</bpt>for<ept id=\"p1\">](~/docs/csharp/language-reference/keywords/for.md)</ept> and <bpt id=\"p2\">[</bpt>foreach<ept id=\"p2\">](~/docs/csharp/language-reference/keywords/foreach-in.md)</ept> loops (<ph id=\"ph1\">`For`</ph> and <ph id=\"ph2\">`For Each`</ph> in Visual Basic).","pos":[774,1007],"source":" This class provides method-based parallel implementations of [for](~/docs/csharp/language-reference/keywords/for.md) and [foreach](~/docs/csharp/language-reference/keywords/foreach-in.md) loops (`For` and `For Each` in Visual Basic)."},{"content":"You write the loop logic for a <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType&gt;</ph> or <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType&gt;</ph> loop much as you would write a sequential loop.","pos":[1008,1243],"source":" You write the loop logic for a <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> or <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> loop much as you would write a sequential loop."},{"content":"You do not have to create threads or queue work items.","pos":[1244,1298]},{"content":"In basic loops, you do not have to take locks.","pos":[1299,1345]},{"content":"The TPL handles all the low-level work for you.","pos":[1346,1393]},{"content":"For in-depth information about the use of <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType&gt;</ph>, download the document <bpt id=\"p1\">[</bpt>Patterns for Parallel Programming: Understanding and Applying Parallel Patterns with the .NET Framework 4<ept id=\"p1\">](https://www.microsoft.com/download/details.aspx?id=19222)</ept>.","pos":[1394,1783],"source":" For in-depth information about the use of <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType>, download the document [Patterns for Parallel Programming: Understanding and Applying Parallel Patterns with the .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=19222)."},{"content":"The following code example shows a simple <ph id=\"ph1\">`foreach`</ph> loop and its parallel equivalent.","pos":[1784,1869],"source":" The following code example shows a simple `foreach` loop and its parallel equivalent."},{"pos":[1877,2156],"content":"[!NOTE]\n This documentation uses lambda expressions to define delegates in TPL. If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).","leadings":["","> "],"nodes":[{"content":"This documentation uses lambda expressions to define delegates in TPL. If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).","pos":[9,277],"nodes":[{"content":"This documentation uses lambda expressions to define delegates in TPL.","pos":[0,70]},{"content":"If you are not familiar with lambda expressions in C# or Visual Basic, see <bpt id=\"p1\">[</bpt>Lambda Expressions in PLINQ and TPL<ept id=\"p1\">](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md)</ept>.","pos":[71,268],"source":" If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md)."}]}]},{"content":"When a parallel loop runs, the TPL partitions the data source so that the loop can operate on multiple parts concurrently.","pos":[2356,2478]},{"content":"Behind the scenes, the Task Scheduler partitions the task based on system resources and workload.","pos":[2479,2576]},{"content":"When possible, the scheduler redistributes work among multiple threads and processors if the workload becomes unbalanced.","pos":[2577,2698]},{"pos":[2706,2996],"content":"[!NOTE]\n You can also supply your own custom partitioner or scheduler. For more information, see [Custom Partitioners for PLINQ and TPL](../../../docs/standard/parallel-programming/custom-partitioners-for-plinq-and-tpl.md) and [Task Schedulers](xref:System.Threading.Tasks.TaskScheduler).","leadings":["","> "],"nodes":[{"content":"You can also supply your own custom partitioner or scheduler. For more information, see [Custom Partitioners for PLINQ and TPL](../../../docs/standard/parallel-programming/custom-partitioners-for-plinq-and-tpl.md) and [Task Schedulers](xref:System.Threading.Tasks.TaskScheduler).","pos":[9,288],"nodes":[{"content":"You can also supply your own custom partitioner or scheduler.","pos":[0,61]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Custom Partitioners for PLINQ and TPL<ept id=\"p1\">](../../../docs/standard/parallel-programming/custom-partitioners-for-plinq-and-tpl.md)</ept> and <bpt id=\"p2\">[</bpt>Task Schedulers<ept id=\"p2\">](xref:System.Threading.Tasks.TaskScheduler)</ept>.","pos":[62,279],"source":" For more information, see [Custom Partitioners for PLINQ and TPL](../../../docs/standard/parallel-programming/custom-partitioners-for-plinq-and-tpl.md) and [Task Schedulers](xref:System.Threading.Tasks.TaskScheduler)."}]}]},{"content":"Both the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType&gt;</ph> methods have several overloads that let you stop or break loop execution, monitor the state of the loop on other threads, maintain thread-local state, finalize thread-local objects, control the degree of concurrency, and so on.","pos":[3003,3397],"source":"Both the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> methods have several overloads that let you stop or break loop execution, monitor the state of the loop on other threads, maintain thread-local state, finalize thread-local objects, control the degree of concurrency, and so on."},{"content":"The helper types that enable this functionality include <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.ParallelLoopState&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.ParallelOptions&gt;</ph>, <ph id=\"ph3\">&lt;xref:System.Threading.Tasks.ParallelLoopResult&gt;</ph>, <ph id=\"ph4\">&lt;xref:System.Threading.CancellationToken&gt;</ph>, and <ph id=\"ph5\">&lt;xref:System.Threading.CancellationTokenSource&gt;</ph>.","pos":[3398,3695],"source":" The helper types that enable this functionality include <xref:System.Threading.Tasks.ParallelLoopState>, <xref:System.Threading.Tasks.ParallelOptions>, <xref:System.Threading.Tasks.ParallelLoopResult>, <xref:System.Threading.CancellationToken>, and <xref:System.Threading.CancellationTokenSource>."},{"pos":[3702,3894],"content":"For more information, see <bpt id=\"p1\">[</bpt>Patterns for Parallel Programming: Understanding and Applying Parallel Patterns with the .NET Framework 4<ept id=\"p1\">](https://www.microsoft.com/download/details.aspx?id=19222)</ept>.","source":"For more information, see [Patterns for Parallel Programming: Understanding and Applying Parallel Patterns with the .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=19222)."},{"content":"Data parallelism with declarative, or query-like, syntax is supported by PLINQ.","pos":[3901,3980]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Parallel LINQ (PLINQ)<ept id=\"p1\">](../../../docs/standard/parallel-programming/parallel-linq-plinq.md)</ept>.","pos":[3981,4099],"source":" For more information, see [Parallel LINQ (PLINQ)](../../../docs/standard/parallel-programming/parallel-linq-plinq.md)."},{"pos":[4108,4122],"content":"Related Topics","linkify":"Related Topics","nodes":[{"content":"Related Topics","pos":[0,14]}]},{"content":"Title","pos":[4129,4134]},{"content":"Description","pos":[4135,4146]},{"pos":[4185,4315],"content":"<bpt id=\"p1\">[</bpt>How to: Write a Simple Parallel.For Loop<ept id=\"p1\">](../../../docs/standard/parallel-programming/how-to-write-a-simple-parallel-for-loop.md)</ept>","source":"[How to: Write a Simple Parallel.For Loop](../../../docs/standard/parallel-programming/how-to-write-a-simple-parallel-for-loop.md)"},{"pos":[4316,4488],"content":"Describes how to write a <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Parallel.For%2A&gt;</ph> loop over any array or indexable <ph id=\"ph2\">&lt;xref:System.Collections.Generic.IEnumerable%601&gt;</ph> source collection.","source":"Describes how to write a <xref:System.Threading.Tasks.Parallel.For%2A> loop over any array or indexable <xref:System.Collections.Generic.IEnumerable%601> source collection."},{"pos":[4493,4631],"content":"<bpt id=\"p1\">[</bpt>How to: Write a Simple Parallel.ForEach Loop<ept id=\"p1\">](../../../docs/standard/parallel-programming/how-to-write-a-simple-parallel-foreach-loop.md)</ept>","source":"[How to: Write a Simple Parallel.ForEach Loop](../../../docs/standard/parallel-programming/how-to-write-a-simple-parallel-foreach-loop.md)"},{"pos":[4632,4789],"content":"Describes how to write a <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Parallel.ForEach%2A&gt;</ph> loop over any <ph id=\"ph2\">&lt;xref:System.Collections.Generic.IEnumerable%601&gt;</ph> source collection.","source":"Describes how to write a <xref:System.Threading.Tasks.Parallel.ForEach%2A> loop over any <xref:System.Collections.Generic.IEnumerable%601> source collection."},{"pos":[4794,4931],"content":"<bpt id=\"p1\">[</bpt>How to: Stop or Break from a Parallel.For Loop<ept id=\"p1\">](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd460721(v=vs.100))</ept>","source":"[How to: Stop or Break from a Parallel.For Loop](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd460721(v=vs.100))"},{"content":"Describes how to stop or break from a parallel loop so that all threads are informed of the action.","pos":[4932,5031]},{"pos":[5036,5208],"content":"<bpt id=\"p1\">[</bpt>How to: Write a Parallel.For Loop with Thread-Local Variables<ept id=\"p1\">](../../../docs/standard/parallel-programming/how-to-write-a-parallel-for-loop-with-thread-local-variables.md)</ept>","source":"[How to: Write a Parallel.For Loop with Thread-Local Variables](../../../docs/standard/parallel-programming/how-to-write-a-parallel-for-loop-with-thread-local-variables.md)"},{"pos":[5209,5453],"content":"Describes how to write a <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Parallel.For%2A&gt;</ph> loop in which each thread maintains a private variable that is not visible to any other threads, and how to synchronize the results from all threads when the loop completes.","source":"Describes how to write a <xref:System.Threading.Tasks.Parallel.For%2A> loop in which each thread maintains a private variable that is not visible to any other threads, and how to synchronize the results from all threads when the loop completes."},{"pos":[5458,5644],"content":"<bpt id=\"p1\">[</bpt>How to: Write a Parallel.ForEach Loop with Partition-Local Variables<ept id=\"p1\">](../../../docs/standard/parallel-programming/how-to-write-a-parallel-foreach-loop-with-partition-local-variables.md)</ept>","source":"[How to: Write a Parallel.ForEach Loop with Partition-Local Variables](../../../docs/standard/parallel-programming/how-to-write-a-parallel-foreach-loop-with-partition-local-variables.md)"},{"pos":[5645,5893],"content":"Describes how to write a <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Parallel.ForEach%2A&gt;</ph> loop in which each thread maintains a private variable that is not visible to any other threads, and how to synchronize the results from all threads when the loop completes.","source":"Describes how to write a <xref:System.Threading.Tasks.Parallel.ForEach%2A> loop in which each thread maintains a private variable that is not visible to any other threads, and how to synchronize the results from all threads when the loop completes."},{"pos":[5898,6038],"content":"<bpt id=\"p1\">[</bpt>How to: Cancel a Parallel.For or ForEach Loop<ept id=\"p1\">](../../../docs/standard/parallel-programming/how-to-cancel-a-parallel-for-or-foreach-loop.md)</ept>","source":"[How to: Cancel a Parallel.For or ForEach Loop](../../../docs/standard/parallel-programming/how-to-cancel-a-parallel-for-or-foreach-loop.md)"},{"pos":[6039,6160],"content":"Describes how to cancel a parallel loop by using a <ph id=\"ph1\">&lt;xref:System.Threading.CancellationToken?displayProperty=nameWithType&gt;</ph>","source":"Describes how to cancel a parallel loop by using a <xref:System.Threading.CancellationToken?displayProperty=nameWithType>"},{"pos":[6165,6283],"content":"<bpt id=\"p1\">[</bpt>How to: Speed Up Small Loop Bodies<ept id=\"p1\">](../../../docs/standard/parallel-programming/how-to-speed-up-small-loop-bodies.md)</ept>","source":"[How to: Speed Up Small Loop Bodies](../../../docs/standard/parallel-programming/how-to-speed-up-small-loop-bodies.md)"},{"content":"Describes one way to speed up execution when a loop body is very small.","pos":[6284,6355]},{"pos":[6360,6463],"content":"<bpt id=\"p1\">[</bpt>Task Parallel Library (TPL)<ept id=\"p1\">](../../../docs/standard/parallel-programming/task-parallel-library-tpl.md)</ept>","source":"[Task Parallel Library (TPL)](../../../docs/standard/parallel-programming/task-parallel-library-tpl.md)"},{"content":"Provides an overview of the Task Parallel Library.","pos":[6464,6514]},{"pos":[6519,6595],"content":"<bpt id=\"p1\">[</bpt>Parallel Programming<ept id=\"p1\">](../../../docs/standard/parallel-programming/index.md)</ept>","source":"[Parallel Programming](../../../docs/standard/parallel-programming/index.md)"},{"content":"Introduces Parallel Programming in the .NET Framework.","pos":[6596,6650]},{"pos":[6660,6668],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6672,6748],"content":"<bpt id=\"p1\">[</bpt>Parallel Programming<ept id=\"p1\">](../../../docs/standard/parallel-programming/index.md)</ept>","source":"[Parallel Programming](../../../docs/standard/parallel-programming/index.md)"}]}