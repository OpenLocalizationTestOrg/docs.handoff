{"content":"---\ntitle: \"FindPrivateKey | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\n  - \"CSharp\"\nhelpviewer_keywords: \n  - \"FindPrivateKey\"\nms.assetid: 16b54116-0ceb-4413-af0c-753bb2a785a6\ncaps.latest.revision: 14\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# FindPrivateKey\nIt can be difficult to find the location and name of the private key file associated with a specific X.509 certificate in the certificate store. The FindPrivateKey.exe tool facilitates this process.  \n  \n> [!IMPORTANT]\n>  FindPrivateKey is a sample that needs to be compiled prior to use. See the \"To build the FindPrivateKey project\" section below for instructions on how to build the FindPrivateKey tool.  \n  \n X.509 certificates are installed by an Administrator or any user in the machine. However the certificate may be accessed by a service running under a different account (for example, the ASPNET on [!INCLUDE[wxp](../../../../includes/wxp-md.md)] or the NETWORK SERVICE accounts on [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)]).  \n  \n This account may not have access to the private key file because the certificate was not installed by it originally. The FindPrivateKey tool gives you the location of a given X.509 Certificate's private key file. You can add permissions or remove permissions to this file once you know the location of the particular X.509 certificates' private key file.  \n  \n The samples that use certificates for security use the FindPrivateKey tool in the Setup.bat file. Once the private key file has been found you can use other tools such as Cacls.exe to set the appropriate access rights onto the file.  \n  \n When running a [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] service under a user account, such as a self-hosted executable, ensure that the user account has read-only access to the file. When running a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service under Internet Information Services (IIS) the default accounts that the service runs under are the ASPNET on [!INCLUDE[wxp](../../../../includes/wxp-md.md)] or the NETWORK SERVICE on [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)], which by default do not have access to the private key file.  \n  \n## Examples  \n When accessing a certificate for which the process does not have read privilege, you see an exception message similar to the following example.  \n  \n```  \nSystem.ArgumentException was unhandled  \nMessage=\"The certificate 'CN=localhost' must have a private key that is capable of key exchange.  The process must have access rights for the private key.\"  \nSource=\"System.ServiceModel\"  \n```  \n  \n When this occurs use the FindPrivateKey tool to find the private key file and then set the access right for the process that the service is running under. For example, this can be done with the Cacls.exe tool as shown in the following example.  \n  \n```  \ncacls.exe \"C:\\Documents and Settings\\All Users\\Application Data\\Microsoft\\Crypto\\RSA\\MachineKeys\\8aeda5eb81555f14f8f9960745b5a40d_38f7de48-5ee9-452d-8a5a-92789d7110b1\" /E /G \"NETWORK SERVICE\":R  \n```  \n  \n#### To build the FindPrivateKey project  \n  \n1.  Open [!INCLUDE[fileExplorer](../../../../includes/fileexplorer-md.md)] and navigate to the language-specific subdirectory under the directory location where you installed the sample.  \n  \n2.  Double-click the .sln file icon to open the file in Visual Studio.  \n  \n3.  In the **Build** menu, select **Rebuild Solution**. The client program files are built to client\\bin and the service program files are built to service\\bin.  \n  \n4.  Building the solution generates the file: FindPrivateKey.exe.  \n  \n## Conventions—Command-Line Entries  \n \"[*option*]\" represents an optional set of parameters.  \n  \n \"{*option*}\" represents a mandatory set of parameters.  \n  \n \"*option1* &#124; *option2*\" represents a choice between sets of options.  \n  \n \"\\<*value*>\" represents a parameter value to be entered.  \n  \n## Usage  \n  \n```  \nFindPrivateKey <storeName> <storeLocation> [{ {-n <subjectName>} | {-t <thumbprint>} } [-f | -d | -a]]  \n```  \n  \n Where:  \n  \n```  \n       <subjectName> The subject name of the certificate  \n       <thumbprint>  The thumbprint of the certificate (You can use the Certmgr.exe tool to find this)  \n       -f            output file name only  \n       -d            output directory only  \n       -a            output absolute file name  \n```  \n  \n If no parameters are specified at the command prompt then this help text is displayed.  \n  \n## Examples  \n This example finds the filename of the certificate with a subject name of \"CN=localhost\", in the Personal store of the Current User.FindPrivateKey My CurrentUser -n \"CN=localhost\".  \n  \n This example finds the filename of the certificate with a subject name of \"CN=localhost\", in the Personal store of the Current and output the full directory path.  \n  \n```  \nUser.FindPrivateKey My CurrentUser -n \"CN=localhost\" -a  \n  \n```  \n  \n This example finds the filename of the certificate with a thumbprint of \"03 33 98 63 d0 47 e7 48 71 33 62 64 76 5c 4c 9d 42 1d 6b 52\", in the Personal store of the Local Computer.  \n  \n```  \nFindPrivateKey My LocalMachine -t \"03 33 98 63 d0 47 e7 48 71 33 62 64 76 5c 4c 9d 42 1d 6b 52\" –c  \n```  \n  \n## See Also\n","nodes":[{"pos":[12,43],"content":"FindPrivateKey | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"FindPrivateKey | Microsoft Docs","pos":[0,31]}]},{"pos":[419,433],"content":"FindPrivateKey","linkify":"FindPrivateKey","nodes":[{"content":"FindPrivateKey","pos":[0,14]}]},{"content":"It can be difficult to find the location and name of the private key file associated with a specific X.509 certificate in the certificate store.","pos":[434,578]},{"content":"The FindPrivateKey.exe tool facilitates this process.","pos":[579,632]},{"pos":[640,840],"content":"[!IMPORTANT]\n FindPrivateKey is a sample that needs to be compiled prior to use. See the \"To build the FindPrivateKey project\" section below for instructions on how to build the FindPrivateKey tool.","leadings":["","> "],"nodes":[{"content":" FindPrivateKey is a sample that needs to be compiled prior to use. See the \"To build the FindPrivateKey project\" section below for instructions on how to build the FindPrivateKey tool.","pos":[13,198],"nodes":[{"content":"FindPrivateKey is a sample that needs to be compiled prior to use.","pos":[1,67]},{"content":"See the \"To build the FindPrivateKey project\" section below for instructions on how to build the FindPrivateKey tool.","pos":[68,185]}]}]},{"content":"X.509 certificates are installed by an Administrator or any user in the machine.","pos":[847,927]},{"content":"However the certificate may be accessed by a service running under a different account (for example, the ASPNET on <ph id=\"ph1\">[!INCLUDE[wxp](../../../../includes/wxp-md.md)]</ph> or the NETWORK SERVICE accounts on <ph id=\"ph2\">[!INCLUDE[ws2003](../../../../includes/ws2003-md.md)]</ph>).","pos":[928,1181],"source":" However the certificate may be accessed by a service running under a different account (for example, the ASPNET on [!INCLUDE[wxp](../../../../includes/wxp-md.md)] or the NETWORK SERVICE accounts on [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)])."},{"content":"This account may not have access to the private key file because the certificate was not installed by it originally.","pos":[1188,1304]},{"content":"The FindPrivateKey tool gives you the location of a given X.509 Certificate's private key file.","pos":[1305,1400]},{"content":"You can add permissions or remove permissions to this file once you know the location of the particular X.509 certificates' private key file.","pos":[1401,1542]},{"content":"The samples that use certificates for security use the FindPrivateKey tool in the Setup.bat file.","pos":[1549,1646]},{"content":"Once the private key file has been found you can use other tools such as Cacls.exe to set the appropriate access rights onto the file.","pos":[1647,1781]},{"content":"When running a <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> service under a user account, such as a self-hosted executable, ensure that the user account has read-only access to the file.","pos":[1788,1985],"source":"When running a [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] service under a user account, such as a self-hosted executable, ensure that the user account has read-only access to the file."},{"content":"When running a <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> service under Internet Information Services (IIS) the default accounts that the service runs under are the ASPNET on <ph id=\"ph2\">[!INCLUDE[wxp](../../../../includes/wxp-md.md)]</ph> or the NETWORK SERVICE on <ph id=\"ph3\">[!INCLUDE[ws2003](../../../../includes/ws2003-md.md)]</ph>, which by default do not have access to the private key file.","pos":[1986,2363],"source":" When running a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service under Internet Information Services (IIS) the default accounts that the service runs under are the ASPNET on [!INCLUDE[wxp](../../../../includes/wxp-md.md)] or the NETWORK SERVICE on [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)], which by default do not have access to the private key file."},{"pos":[2372,2380],"content":"Examples","linkify":"Examples","nodes":[{"content":"Examples","pos":[0,8]}]},{"content":"When accessing a certificate for which the process does not have read privilege, you see an exception message similar to the following example.","pos":[2384,2527]},{"content":"When this occurs use the FindPrivateKey tool to find the private key file and then set the access right for the process that the service is running under.","pos":[2779,2933]},{"content":"For example, this can be done with the Cacls.exe tool as shown in the following example.","pos":[2934,3022]},{"pos":[3244,3279],"content":"To build the FindPrivateKey project","linkify":"To build the FindPrivateKey project","nodes":[{"content":"To build the FindPrivateKey project","pos":[0,35]}]},{"pos":[3289,3471],"content":"Open <ph id=\"ph1\">[!INCLUDE[fileExplorer](../../../../includes/fileexplorer-md.md)]</ph> and navigate to the language-specific subdirectory under the directory location where you installed the sample.","source":"Open [!INCLUDE[fileExplorer](../../../../includes/fileexplorer-md.md)] and navigate to the language-specific subdirectory under the directory location where you installed the sample."},{"content":"Double-click the .sln file icon to open the file in Visual Studio.","pos":[3481,3547]},{"content":"In the <bpt id=\"p1\">**</bpt>Build<ept id=\"p1\">**</ept> menu, select <bpt id=\"p2\">**</bpt>Rebuild Solution<ept id=\"p2\">**</ept>.","pos":[3557,3608],"source":"In the **Build** menu, select **Rebuild Solution**."},{"content":"The client program files are built to client\\bin and the service program files are built to service\\bin.","pos":[3609,3713]},{"content":"Building the solution generates the file: FindPrivateKey.exe.","pos":[3723,3784]},{"pos":[3793,3825],"content":"Conventions—Command-Line Entries","linkify":"Conventions—Command-Line Entries","nodes":[{"content":"Conventions—Command-Line Entries","pos":[0,32]}]},{"pos":[3829,3883],"content":"\"[<bpt id=\"p1\">*</bpt>option<ept id=\"p1\">*</ept>]\" represents an optional set of parameters.","source":"\"[*option*]\" represents an optional set of parameters."},{"pos":[3890,3944],"content":"\"{<bpt id=\"p1\">*</bpt>option<ept id=\"p1\">*</ept>}\" represents a mandatory set of parameters.","source":"\"{*option*}\" represents a mandatory set of parameters."},{"pos":[3951,4024],"content":"\"<bpt id=\"p1\">*</bpt>option1<ept id=\"p1\">*</ept> &amp;#124; <bpt id=\"p2\">*</bpt>option2<ept id=\"p2\">*</ept>\" represents a choice between sets of options.","source":"\"*option1* &#124; *option2*\" represents a choice between sets of options."},{"pos":[4031,4087],"content":"\"<ph id=\"ph1\">\\&lt;</ph><bpt id=\"p1\">*</bpt>value<ept id=\"p1\">*</ept>&gt;\" represents a parameter value to be entered.","source":"\"\\<*value*>\" represents a parameter value to be entered."},{"pos":[4096,4101],"content":"Usage","linkify":"Usage","nodes":[{"content":"Usage","pos":[0,5]}]},{"content":"Where:","pos":[4228,4234]},{"content":"If no parameters are specified at the command prompt then this help text is displayed.","pos":[4559,4645]},{"pos":[4654,4662],"content":"Examples","linkify":"Examples","nodes":[{"content":"Examples","pos":[0,8]}]},{"content":"This example finds the filename of the certificate with a subject name of \"CN=localhost\", in the Personal store of the Current User.FindPrivateKey My CurrentUser -n \"CN=localhost\".","pos":[4666,4846]},{"content":"This example finds the filename of the certificate with a subject name of \"CN=localhost\", in the Personal store of the Current and output the full directory path.","pos":[4853,5015]},{"content":"This example finds the filename of the certificate with a thumbprint of \"03 33 98 63 d0 47 e7 48 71 33 62 64 76 5c 4c 9d 42 1d 6b 52\", in the Personal store of the Local Computer.","pos":[5098,5277]},{"pos":[5402,5410],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]}]}