{"content":"---\ntitle: \"How to: Use a Thread Pool (C#) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"2015-07-20\"\nms.prod: .net\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-csharp\"\n\nms.topic: \"article\"\ndev_langs: \n  - \"CSharp\"\nms.assetid: 210a9235-83a6-420b-af52-2d6a58e5133f\ncaps.latest.revision: 3\nauthor: \"BillWagner\"\nms.author: \"wiwagn\"\n\ntranslation.priority.mt: \n  - \"cs-cz\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"tr-tr\"\n---\n# How to: Use a Thread Pool (C#)\n*Thread pooling* is a form of multithreading in which tasks are added to a queue and automatically started when threads are created. For more information, see [Thread Pooling (C#)](../../../../csharp/programming-guide/concepts/threading/thread-pooling.md).  \n  \n The following example uses the .NET Framework thread pool to calculate the `Fibonacci` result for ten numbers between 20 and 40. Each `Fibonacci` result is represented by the `Fibonacci` class, which provides a method named `ThreadPoolCallback` that performs the calculation. An object that represents each `Fibonacci` value is created, and the `ThreadPoolCallback` method is passed to <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A>, which assigns an available thread in the pool to execute the method.  \n  \n Because each `Fibonacci` object is given a semi-random value to compute, and because each thread will be competing for processor time, you cannot know in advance how long it will take for all ten results to be calculated. That is why each `Fibonacci` object is passed an instance of the <xref:System.Threading.ManualResetEvent> class during construction. Each object signals the provided event object when its calculation is complete, which allows the primary thread to block execution with <xref:System.Threading.WaitHandle.WaitAll%2A> until all ten `Fibonacci` objects have calculated a result. The `Main` method then displays each `Fibonacci` result.  \n  \n## Example  \n  \n```csharp  \nusing System;  \nusing System.Threading;  \n  \npublic class Fibonacci  \n{  \n    private int _n;  \n    private int _fibOfN;  \n    private ManualResetEvent _doneEvent;  \n  \n    public int N { get { return _n; } }  \n    public int FibOfN { get { return _fibOfN; } }  \n  \n    // Constructor.  \n    public Fibonacci(int n, ManualResetEvent doneEvent)  \n    {  \n        _n = n;  \n        _doneEvent = doneEvent;  \n    }  \n  \n    // Wrapper method for use with thread pool.  \n    public void ThreadPoolCallback(Object threadContext)  \n    {  \n        int threadIndex = (int)threadContext;  \n        Console.WriteLine(\"thread {0} started...\", threadIndex);  \n        _fibOfN = Calculate(_n);  \n        Console.WriteLine(\"thread {0} result calculated...\", threadIndex);  \n        _doneEvent.Set();  \n    }  \n  \n    // Recursive method that calculates the Nth Fibonacci number.  \n    public int Calculate(int n)  \n    {  \n        if (n <= 1)  \n        {  \n            return n;  \n        }  \n  \n        return Calculate(n - 1) + Calculate(n - 2);  \n    }  \n}  \n  \npublic class ThreadPoolExample  \n{  \n    static void Main()  \n    {  \n        const int FibonacciCalculations = 10;  \n  \n        // One event is used for each Fibonacci object.  \n        ManualResetEvent[] doneEvents = new ManualResetEvent[FibonacciCalculations];  \n        Fibonacci[] fibArray = new Fibonacci[FibonacciCalculations];  \n        Random r = new Random();  \n  \n        // Configure and start threads using ThreadPool.  \n        Console.WriteLine(\"launching {0} tasks...\", FibonacciCalculations);  \n        for (int i = 0; i < FibonacciCalculations; i++)  \n        {  \n            doneEvents[i] = new ManualResetEvent(false);  \n            Fibonacci f = new Fibonacci(r.Next(20, 40), doneEvents[i]);  \n            fibArray[i] = f;  \n            ThreadPool.QueueUserWorkItem(f.ThreadPoolCallback, i);  \n        }  \n  \n        // Wait for all threads in pool to calculate.  \n        WaitHandle.WaitAll(doneEvents);  \n        Console.WriteLine(\"All calculations are complete.\");  \n  \n        // Display the results.  \n        for (int i= 0; i<FibonacciCalculations; i++)  \n        {  \n            Fibonacci f = fibArray[i];  \n            Console.WriteLine(\"Fibonacci({0}) = {1}\", f.N, f.FibOfN);  \n        }  \n    }  \n}  \n```  \n  \n Following is an example of the output.  \n  \n```  \nlaunching 10 tasks...  \nthread 0 started...  \nthread 1 started...  \nthread 1 result calculated...  \nthread 2 started...  \nthread 2 result calculated...  \nthread 3 started...  \nthread 3 result calculated...  \nthread 4 started...  \nthread 0 result calculated...  \nthread 5 started...  \nthread 5 result calculated...  \nthread 6 started...  \nthread 4 result calculated...  \nthread 7 started...  \nthread 6 result calculated...  \nthread 8 started...  \nthread 8 result calculated...  \nthread 9 started...  \nthread 9 result calculated...  \nthread 7 result calculated...  \nAll calculations are complete.  \nFibonacci(38) = 39088169  \nFibonacci(29) = 514229  \nFibonacci(25) = 75025  \nFibonacci(22) = 17711  \nFibonacci(38) = 39088169  \nFibonacci(29) = 514229  \nFibonacci(29) = 514229  \nFibonacci(38) = 39088169  \nFibonacci(21) = 10946  \nFibonacci(27) = 196418  \n```  \n  \n## See Also  \n <xref:System.Threading.Mutex>   \n <xref:System.Threading.WaitHandle.WaitAll%2A>   \n <xref:System.Threading.ManualResetEvent>   \n <xref:System.Threading.EventWaitHandle.Set%2A>   \n <xref:System.Threading.ThreadPool>   \n <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A>   \n <xref:System.Threading.ManualResetEvent>   \n [Thread Pooling (C#)](../../../../csharp/programming-guide/concepts/threading/thread-pooling.md)   \n [Threading (C#)](../../../../csharp/programming-guide/concepts/threading/index.md)   \n @System.Threading.Monitor   \n [Security](../../../../standard/security/index.md)","nodes":[{"pos":[12,59],"content":"How to: Use a Thread Pool (C#) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"How to: Use a Thread Pool (C#) | Microsoft Docs","pos":[0,47]}]},{"pos":[418,448],"content":"How to: Use a Thread Pool (C#)","linkify":"How to: Use a Thread Pool (C#)","nodes":[{"content":"How to: Use a Thread Pool (C#)","pos":[0,30]}]},{"content":"<bpt id=\"p1\">*</bpt>Thread pooling<ept id=\"p1\">*</ept> is a form of multithreading in which tasks are added to a queue and automatically started when threads are created.","pos":[449,581],"source":"*Thread pooling* is a form of multithreading in which tasks are added to a queue and automatically started when threads are created."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Thread Pooling (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/threading/thread-pooling.md)</ept>.","pos":[582,705],"source":" For more information, see [Thread Pooling (C#)](../../../../csharp/programming-guide/concepts/threading/thread-pooling.md)."},{"content":"The following example uses the .NET Framework thread pool to calculate the <ph id=\"ph1\">`Fibonacci`</ph> result for ten numbers between 20 and 40.","pos":[712,840],"source":"The following example uses the .NET Framework thread pool to calculate the `Fibonacci` result for ten numbers between 20 and 40."},{"content":"Each <ph id=\"ph1\">`Fibonacci`</ph> result is represented by the <ph id=\"ph2\">`Fibonacci`</ph> class, which provides a method named <ph id=\"ph3\">`ThreadPoolCallback`</ph> that performs the calculation.","pos":[841,987],"source":" Each `Fibonacci` result is represented by the `Fibonacci` class, which provides a method named `ThreadPoolCallback` that performs the calculation."},{"content":"An object that represents each <ph id=\"ph1\">`Fibonacci`</ph> value is created, and the <ph id=\"ph2\">`ThreadPoolCallback`</ph> method is passed to <ph id=\"ph3\">&lt;xref:System.Threading.ThreadPool.QueueUserWorkItem%2A&gt;</ph>, which assigns an available thread in the pool to execute the method.","pos":[988,1223],"source":" An object that represents each `Fibonacci` value is created, and the `ThreadPoolCallback` method is passed to <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A>, which assigns an available thread in the pool to execute the method."},{"content":"Because each <ph id=\"ph1\">`Fibonacci`</ph> object is given a semi-random value to compute, and because each thread will be competing for processor time, you cannot know in advance how long it will take for all ten results to be calculated.","pos":[1230,1451],"source":"Because each `Fibonacci` object is given a semi-random value to compute, and because each thread will be competing for processor time, you cannot know in advance how long it will take for all ten results to be calculated."},{"content":"That is why each <ph id=\"ph1\">`Fibonacci`</ph> object is passed an instance of the <ph id=\"ph2\">&lt;xref:System.Threading.ManualResetEvent&gt;</ph> class during construction.","pos":[1452,1584],"source":" That is why each `Fibonacci` object is passed an instance of the <xref:System.Threading.ManualResetEvent> class during construction."},{"content":"Each object signals the provided event object when its calculation is complete, which allows the primary thread to block execution with <ph id=\"ph1\">&lt;xref:System.Threading.WaitHandle.WaitAll%2A&gt;</ph> until all ten <ph id=\"ph2\">`Fibonacci`</ph> objects have calculated a result.","pos":[1585,1826],"source":" Each object signals the provided event object when its calculation is complete, which allows the primary thread to block execution with <xref:System.Threading.WaitHandle.WaitAll%2A> until all ten `Fibonacci` objects have calculated a result."},{"content":"The <ph id=\"ph1\">`Main`</ph> method then displays each <ph id=\"ph2\">`Fibonacci`</ph> result.","pos":[1827,1883],"source":" The `Main` method then displays each `Fibonacci` result."},{"pos":[1892,1899],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"Following is an example of the output.","pos":[4211,4249]},{"pos":[5123,5131],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.Mutex&gt;</ph>","pos":[5135,5164],"source":"<xref:System.Threading.Mutex> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.WaitHandle.WaitAll%2A&gt;</ph>","pos":[5169,5214],"source":" <xref:System.Threading.WaitHandle.WaitAll%2A> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.ManualResetEvent&gt;</ph>","pos":[5219,5259],"source":" <xref:System.Threading.ManualResetEvent> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.EventWaitHandle.Set%2A&gt;</ph>","pos":[5264,5310],"source":" <xref:System.Threading.EventWaitHandle.Set%2A> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.ThreadPool&gt;</ph>","pos":[5315,5349],"source":" <xref:System.Threading.ThreadPool> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.ThreadPool.QueueUserWorkItem%2A&gt;</ph>","pos":[5354,5409],"source":" <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.ManualResetEvent&gt;</ph>","pos":[5414,5454],"source":" <xref:System.Threading.ManualResetEvent> "},{"content":"<bpt id=\"p1\"> [</bpt>Thread Pooling (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/threading/thread-pooling.md)</ept><ph id=\"ph1\"> </ph>","pos":[5458,5556],"source":" [Thread Pooling (C#)](../../../../csharp/programming-guide/concepts/threading/thread-pooling.md) "},{"content":"<bpt id=\"p1\"> [</bpt>Threading (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/threading/index.md)</ept><ph id=\"ph1\"> </ph>","pos":[5559,5643],"source":" [Threading (C#)](../../../../csharp/programming-guide/concepts/threading/index.md) "},{"content":"<ph id=\"ph1\">@System.Threading.Monitor</ph>","pos":[5647,5672],"source":" @System.Threading.Monitor "},{"content":"<bpt id=\"p1\"> [</bpt>Security<ept id=\"p1\">](../../../../standard/security/index.md)</ept>","pos":[5676,5727],"source":" [Security](../../../../standard/security/index.md)"}]}