{"content":"---\ntitle: \"How to: Intercept Data Service Messages (WCF Data Services)\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"WCF Data Services, customizing\"\n  - \"query interceptors [WCF Data Services]\"\nms.assetid: 24b9df1b-b54b-4795-a033-edf333675de6\n---\n# How to: Intercept Data Service Messages (WCF Data Services)\nWith [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], you can intercept request messages so that you can add custom logic to an operation. To intercept a message, you use specially attributed methods in the data service. For more information, see [Interceptors](../../../../docs/framework/data/wcf/interceptors-wcf-data-services.md).  \n  \n The example in this topic uses the Northwind sample data service. This service is created when you complete the [WCF Data Services quickstart](../../../../docs/framework/data/wcf/quickstart-wcf-data-services.md).  \n  \n### To define a query interceptor for the Orders entity set  \n  \n1.  In the Northwind data service project, open the Northwind.svc file.  \n  \n2.  In the code page for the `Northwind` class, add the following `using` statement (`Imports` in Visual Basic).  \n  \n     [!code-csharp[Astoria Northwind Service#UsingLinqExpressions](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind service/cs/northwind2.svc.cs#usinglinqexpressions)]\n     [!code-vb[Astoria Northwind Service#UsingLinqExpressions](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind service/vb/northwind2.svc.vb#usinglinqexpressions)]  \n  \n3.  In the `Northwind` class, define a service operation method named `OnQueryOrders` as follows:  \n  \n     [!code-csharp[Astoria Northwind Service#QueryInterceptorDef](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind service/cs/northwind2.svc.cs#queryinterceptordef)]\n     [!code-vb[Astoria Northwind Service#QueryInterceptorDef](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind service/vb/northwind2.svc.vb#queryinterceptordef)]  \n  \n### To define a change interceptor for the Products entity set  \n  \n1.  In the Northwind data service project, open the Northwind.svc file.  \n  \n2.  In the `Northwind` class, define a service operation method named `OnChangeProducts` as follows:  \n  \n     [!code-csharp[Astoria Northwind Service#ChangeInterceptorDef](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind service/cs/northwind2.svc.cs#changeinterceptordef)]\n     [!code-vb[Astoria Northwind Service#ChangeInterceptorDef](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind service/vb/northwind2.svc.vb#changeinterceptordef)]  \n  \n## Example  \n This example defines a query interceptor method for the `Orders` entity set that returns a lambda expression. This expression contains a delegate that filters the requested `Orders` based on related `Customers` that have a specific contact name. The name is in turn determined based on the requesting user. This example assumes that the data service is hosted within an ASP.NET Web application that uses WCF, and that authentication is enabled. The <xref:System.Web.HttpContext> class is used to retrieve the principle of the current request.  \n  \n [!code-csharp[Astoria Northwind Service#QueryInterceptor](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind service/cs/northwind2.svc.cs#queryinterceptor)]\n [!code-vb[Astoria Northwind Service#QueryInterceptor](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind service/vb/northwind2.svc.vb#queryinterceptor)]  \n  \n## Example  \n This example defines a change interceptor method for the `Products` entity set. This method validates input to the service for an <xref:System.Data.Services.UpdateOperations.Add> or <xref:System.Data.Services.UpdateOperations.Change> operation and raises an exception if a change is being made to a discontinued product. It also blocks the deletion of products as an unsupported operation.  \n  \n [!code-csharp[Astoria Northwind Service#ChangeInterceptor](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind service/cs/northwind2.svc.cs#changeinterceptor)]\n [!code-vb[Astoria Northwind Service#ChangeInterceptor](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind service/vb/northwind2.svc.vb#changeinterceptor)]  \n  \n## See also\n\n- [How to: Define a Service Operation](../../../../docs/framework/data/wcf/how-to-define-a-service-operation-wcf-data-services.md)\n- [Defining WCF Data Services](../../../../docs/framework/data/wcf/defining-wcf-data-services.md)\n","nodes":[{"pos":[4,281],"embed":true,"restype":"x-metadata","content":"title: \"How to: Intercept Data Service Messages (WCF Data Services)\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"WCF Data Services, customizing\"\n  - \"query interceptors [WCF Data Services]\"\nms.assetid: 24b9df1b-b54b-4795-a033-edf333675de6","nodes":[{"content":"How to: Intercept Data Service Messages (WCF Data Services)","nodes":[{"pos":[0,59],"content":"How to: Intercept Data Service Messages (WCF Data Services)","nodes":[{"content":"How to: Intercept Data Service Messages (WCF Data Services)","pos":[0,59]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[288,347],"content":"How to: Intercept Data Service Messages (WCF Data Services)","linkify":"How to: Intercept Data Service Messages (WCF Data Services)","nodes":[{"content":"How to: Intercept Data Service Messages (WCF Data Services)","pos":[0,59]}]},{"content":"With <ph id=\"ph1\">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]</ph>, you can intercept request messages so that you can add custom logic to an operation.","pos":[348,498],"source":"With [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], you can intercept request messages so that you can add custom logic to an operation."},{"content":"To intercept a message, you use specially attributed methods in the data service.","pos":[499,580]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Interceptors<ept id=\"p1\">](../../../../docs/framework/data/wcf/interceptors-wcf-data-services.md)</ept>.","pos":[581,693],"source":" For more information, see [Interceptors](../../../../docs/framework/data/wcf/interceptors-wcf-data-services.md)."},{"content":"The example in this topic uses the Northwind sample data service.","pos":[700,765]},{"content":"This service is created when you complete the <bpt id=\"p1\">[</bpt>WCF Data Services quickstart<ept id=\"p1\">](../../../../docs/framework/data/wcf/quickstart-wcf-data-services.md)</ept>.","pos":[766,912],"source":" This service is created when you complete the [WCF Data Services quickstart](../../../../docs/framework/data/wcf/quickstart-wcf-data-services.md)."},{"pos":[922,977],"content":"To define a query interceptor for the Orders entity set","linkify":"To define a query interceptor for the Orders entity set","nodes":[{"content":"To define a query interceptor for the Orders entity set","pos":[0,55]}]},{"content":"In the Northwind data service project, open the Northwind.svc file.","pos":[987,1054]},{"pos":[1064,1172],"content":"In the code page for the <ph id=\"ph1\">`Northwind`</ph> class, add the following <ph id=\"ph2\">`using`</ph> statement (<ph id=\"ph3\">`Imports`</ph> in Visual Basic).","source":"In the code page for the `Northwind` class, add the following `using` statement (`Imports` in Visual Basic)."},{"pos":[1183,1558],"content":"[!code-csharp[Astoria Northwind Service#UsingLinqExpressions](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind service/cs/northwind2.svc.cs#usinglinqexpressions)]\n [!code-vb[Astoria Northwind Service#UsingLinqExpressions](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind service/vb/northwind2.svc.vb#usinglinqexpressions)]","leadings":["","    "],"nodes":[]},{"pos":[1568,1661],"content":"In the <ph id=\"ph1\">`Northwind`</ph> class, define a service operation method named <ph id=\"ph2\">`OnQueryOrders`</ph> as follows:","source":"In the `Northwind` class, define a service operation method named `OnQueryOrders` as follows:"},{"pos":[1672,2043],"content":"[!code-csharp[Astoria Northwind Service#QueryInterceptorDef](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind service/cs/northwind2.svc.cs#queryinterceptordef)]\n [!code-vb[Astoria Northwind Service#QueryInterceptorDef](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind service/vb/northwind2.svc.vb#queryinterceptordef)]","leadings":["","    "],"nodes":[]},{"pos":[2053,2111],"content":"To define a change interceptor for the Products entity set","linkify":"To define a change interceptor for the Products entity set","nodes":[{"content":"To define a change interceptor for the Products entity set","pos":[0,58]}]},{"content":"In the Northwind data service project, open the Northwind.svc file.","pos":[2121,2188]},{"pos":[2198,2294],"content":"In the <ph id=\"ph1\">`Northwind`</ph> class, define a service operation method named <ph id=\"ph2\">`OnChangeProducts`</ph> as follows:","source":"In the `Northwind` class, define a service operation method named `OnChangeProducts` as follows:"},{"pos":[2305,2680],"content":"[!code-csharp[Astoria Northwind Service#ChangeInterceptorDef](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind service/cs/northwind2.svc.cs#changeinterceptordef)]\n [!code-vb[Astoria Northwind Service#ChangeInterceptorDef](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind service/vb/northwind2.svc.vb#changeinterceptordef)]","leadings":["","    "],"nodes":[]},{"pos":[2689,2696],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"This example defines a query interceptor method for the <ph id=\"ph1\">`Orders`</ph> entity set that returns a lambda expression.","pos":[2700,2809],"source":"This example defines a query interceptor method for the `Orders` entity set that returns a lambda expression."},{"content":"This expression contains a delegate that filters the requested <ph id=\"ph1\">`Orders`</ph> based on related <ph id=\"ph2\">`Customers`</ph> that have a specific contact name.","pos":[2810,2945],"source":" This expression contains a delegate that filters the requested `Orders` based on related `Customers` that have a specific contact name."},{"content":"The name is in turn determined based on the requesting user.","pos":[2946,3006]},{"content":"This example assumes that the data service is hosted within an ASP.NET Web application that uses WCF, and that authentication is enabled.","pos":[3007,3144]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Web.HttpContext&gt;</ph> class is used to retrieve the principle of the current request.","pos":[3145,3242],"source":" The <xref:System.Web.HttpContext> class is used to retrieve the principle of the current request."},{"pos":[3613,3620],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"This example defines a change interceptor method for the <ph id=\"ph1\">`Products`</ph> entity set.","pos":[3624,3703],"source":"This example defines a change interceptor method for the `Products` entity set."},{"content":"This method validates input to the service for an <ph id=\"ph1\">&lt;xref:System.Data.Services.UpdateOperations.Add&gt;</ph> or <ph id=\"ph2\">&lt;xref:System.Data.Services.UpdateOperations.Change&gt;</ph> operation and raises an exception if a change is being made to a discontinued product.","pos":[3704,3944],"source":" This method validates input to the service for an <xref:System.Data.Services.UpdateOperations.Add> or <xref:System.Data.Services.UpdateOperations.Change> operation and raises an exception if a change is being made to a discontinued product."},{"content":"It also blocks the deletion of products as an unsupported operation.","pos":[3945,4013]},{"pos":[4388,4396],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[4400,4528],"content":"<bpt id=\"p1\">[</bpt>How to: Define a Service Operation<ept id=\"p1\">](../../../../docs/framework/data/wcf/how-to-define-a-service-operation-wcf-data-services.md)</ept>","source":"[How to: Define a Service Operation](../../../../docs/framework/data/wcf/how-to-define-a-service-operation-wcf-data-services.md)"},{"pos":[4531,4626],"content":"<bpt id=\"p1\">[</bpt>Defining WCF Data Services<ept id=\"p1\">](../../../../docs/framework/data/wcf/defining-wcf-data-services.md)</ept>","source":"[Defining WCF Data Services](../../../../docs/framework/data/wcf/defining-wcf-data-services.md)"}]}