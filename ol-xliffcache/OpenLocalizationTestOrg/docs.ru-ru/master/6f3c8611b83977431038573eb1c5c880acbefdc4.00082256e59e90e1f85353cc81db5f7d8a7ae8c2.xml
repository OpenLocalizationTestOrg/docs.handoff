{"content":"---\ntitle: \"Initialization for Object Elements Not in an Object Tree\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"logical tree [WPF]\"\n  - \"visual tree [WPF]\"\n  - \"elements [WPF], initializing\"\n  - \"initializing elements [WPF]\"\nms.assetid: 7b8dfc9b-46ac-4ce8-b7bb-035734d688b7\n---\n# Initialization for Object Elements Not in an Object Tree\nSome aspects of [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] initialization are deferred to processes that typically rely on that element being connected to either the logical tree or visual tree. This topic describes the steps that may be necessary in order to initialize an element that is not connected to either tree.  \n\n## Elements and the Logical Tree  \n When you create an instance of a [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] class in code, you should be aware that several aspects of object initialization for a [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] class are deliberately not a part of the code that is executed when calling the class constructor. Particularly for a control class, most of the visual representation of that control is not defined by the constructor. Instead, the visual representation is defined by the control's template. The template potentially comes from a variety of sources, but most often the template is obtained from theme styles. Templates are effectively late-binding; the necessary template is not attached to the control in question until the control is ready for layout. And the control is not ready for layout until it is attached to a logical tree that connects to a rendering surface at the root. It is that root-level element that initiates the rendering of all of its child elements as defined in the logical tree.  \n  \n The visual tree also participates in this process. Elements that are part of the visual tree through the templates are also not fully instantiated until connected.  \n  \n The consequences of this behavior are that certain operations that rely on the completed visual characteristics of an element require additional steps. An example is if you are attempting to get the visual characteristics of a class that was constructed but not yet attached to a tree. For instance, if you want to call <xref:System.Windows.Media.Imaging.RenderTargetBitmap.Render%2A> on a <xref:System.Windows.Media.Imaging.RenderTargetBitmap> and the visual you are passing is an element not connected to a tree, that element is not visually complete until additional initialization steps are completed.  \n  \n### Using BeginInit and EndInit to Initialize the Element  \n Various classes in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] implement the <xref:System.ComponentModel.ISupportInitialize> interface. You use the <xref:System.ComponentModel.ISupportInitialize.BeginInit%2A> and <xref:System.ComponentModel.ISupportInitialize.EndInit%2A> methods of the interface to denote a region in your code that contains initialization steps (such as setting property values that affect rendering). After <xref:System.ComponentModel.ISupportInitialize.EndInit%2A> is called in the sequence, the layout system can process the element and start looking for an implicit style.  \n  \n If the element you are setting properties on is a <xref:System.Windows.FrameworkElement> or <xref:System.Windows.FrameworkContentElement> derived class, then you can call the class versions of <xref:System.Windows.FrameworkElement.BeginInit%2A> and <xref:System.Windows.FrameworkElement.EndInit%2A> rather than casting to <xref:System.ComponentModel.ISupportInitialize>.  \n  \n### Sample Code  \n The following example is sample code for a console application that uses rendering [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] and <xref:System.Windows.Markup.XamlReader.Load%28System.IO.Stream%29?displayProperty=nameWithType> of a loose [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file to illustrate the proper placement of <xref:System.Windows.FrameworkElement.BeginInit%2A> and <xref:System.Windows.FrameworkElement.EndInit%2A> around other [!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] calls that adjust properties that affect rendering.  \n  \n The example illustrates the main function only. The functions `Rasterize` and `Save` (not shown) are utility functions that take care of image processing and IO.  \n  \n [!code-csharp[InitializeElements#Main](~/samples/snippets/csharp/VS_Snippets_Wpf/InitializeElements/CSharp/initializeelements.cs#main)]\n [!code-vb[InitializeElements#Main](~/samples/snippets/visualbasic/VS_Snippets_Wpf/InitializeElements/VisualBasic/initializeelements.vb#main)]  \n  \n## See also\n\n- [Trees in WPF](trees-in-wpf.md)\n- [WPF Graphics Rendering Overview](../graphics-multimedia/wpf-graphics-rendering-overview.md)\n- [XAML Overview (WPF)](xaml-overview-wpf.md)\n","nodes":[{"pos":[4,314],"embed":true,"restype":"x-metadata","content":"title: \"Initialization for Object Elements Not in an Object Tree\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"logical tree [WPF]\"\n  - \"visual tree [WPF]\"\n  - \"elements [WPF], initializing\"\n  - \"initializing elements [WPF]\"\nms.assetid: 7b8dfc9b-46ac-4ce8-b7bb-035734d688b7","nodes":[{"content":"Initialization for Object Elements Not in an Object Tree","nodes":[{"pos":[0,56],"content":"Initialization for Object Elements Not in an Object Tree","nodes":[{"content":"Initialization for Object Elements Not in an Object Tree","pos":[0,56]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[321,377],"content":"Initialization for Object Elements Not in an Object Tree","linkify":"Initialization for Object Elements Not in an Object Tree","nodes":[{"content":"Initialization for Object Elements Not in an Object Tree","pos":[0,56]}]},{"content":"Some aspects of <ph id=\"ph1\">[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]</ph> initialization are deferred to processes that typically rely on that element being connected to either the logical tree or visual tree.","pos":[378,609],"source":"Some aspects of [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] initialization are deferred to processes that typically rely on that element being connected to either the logical tree or visual tree."},{"content":"This topic describes the steps that may be necessary in order to initialize an element that is not connected to either tree.","pos":[610,734]},{"pos":[741,770],"content":"Elements and the Logical Tree","linkify":"Elements and the Logical Tree","nodes":[{"content":"Elements and the Logical Tree","pos":[0,29]}]},{"content":"When you create an instance of a <ph id=\"ph1\">[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]</ph> class in code, you should be aware that several aspects of object initialization for a <ph id=\"ph2\">[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]</ph> class are deliberately not a part of the code that is executed when calling the class constructor.","pos":[774,1152],"source":"When you create an instance of a [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] class in code, you should be aware that several aspects of object initialization for a [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] class are deliberately not a part of the code that is executed when calling the class constructor."},{"content":"Particularly for a control class, most of the visual representation of that control is not defined by the constructor.","pos":[1153,1271]},{"content":"Instead, the visual representation is defined by the control's template.","pos":[1272,1344]},{"content":"The template potentially comes from a variety of sources, but most often the template is obtained from theme styles.","pos":[1345,1461]},{"content":"Templates are effectively late-binding; the necessary template is not attached to the control in question until the control is ready for layout.","pos":[1462,1606]},{"content":"And the control is not ready for layout until it is attached to a logical tree that connects to a rendering surface at the root.","pos":[1607,1735]},{"content":"It is that root-level element that initiates the rendering of all of its child elements as defined in the logical tree.","pos":[1736,1855]},{"content":"The visual tree also participates in this process.","pos":[1862,1912]},{"content":"Elements that are part of the visual tree through the templates are also not fully instantiated until connected.","pos":[1913,2025]},{"content":"The consequences of this behavior are that certain operations that rely on the completed visual characteristics of an element require additional steps.","pos":[2032,2183]},{"content":"An example is if you are attempting to get the visual characteristics of a class that was constructed but not yet attached to a tree.","pos":[2184,2317]},{"content":"For instance, if you want to call <ph id=\"ph1\">&lt;xref:System.Windows.Media.Imaging.RenderTargetBitmap.Render%2A&gt;</ph> on a <ph id=\"ph2\">&lt;xref:System.Windows.Media.Imaging.RenderTargetBitmap&gt;</ph> and the visual you are passing is an element not connected to a tree, that element is not visually complete until additional initialization steps are completed.","pos":[2318,2637],"source":" For instance, if you want to call <xref:System.Windows.Media.Imaging.RenderTargetBitmap.Render%2A> on a <xref:System.Windows.Media.Imaging.RenderTargetBitmap> and the visual you are passing is an element not connected to a tree, that element is not visually complete until additional initialization steps are completed."},{"pos":[2647,2700],"content":"Using BeginInit and EndInit to Initialize the Element","linkify":"Using BeginInit and EndInit to Initialize the Element","nodes":[{"content":"Using BeginInit and EndInit to Initialize the Element","pos":[0,53]}]},{"content":"Various classes in <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> implement the <ph id=\"ph2\">&lt;xref:System.ComponentModel.ISupportInitialize&gt;</ph> interface.","pos":[2704,2877],"source":"Various classes in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] implement the <xref:System.ComponentModel.ISupportInitialize> interface."},{"content":"You use the <ph id=\"ph1\">&lt;xref:System.ComponentModel.ISupportInitialize.BeginInit%2A&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ComponentModel.ISupportInitialize.EndInit%2A&gt;</ph> methods of the interface to denote a region in your code that contains initialization steps (such as setting property values that affect rendering).","pos":[2878,3162],"source":" You use the <xref:System.ComponentModel.ISupportInitialize.BeginInit%2A> and <xref:System.ComponentModel.ISupportInitialize.EndInit%2A> methods of the interface to denote a region in your code that contains initialization steps (such as setting property values that affect rendering)."},{"content":"After <ph id=\"ph1\">&lt;xref:System.ComponentModel.ISupportInitialize.EndInit%2A&gt;</ph> is called in the sequence, the layout system can process the element and start looking for an implicit style.","pos":[3163,3337],"source":" After <xref:System.ComponentModel.ISupportInitialize.EndInit%2A> is called in the sequence, the layout system can process the element and start looking for an implicit style."},{"pos":[3344,3714],"content":"If the element you are setting properties on is a <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> or <ph id=\"ph2\">&lt;xref:System.Windows.FrameworkContentElement&gt;</ph> derived class, then you can call the class versions of <ph id=\"ph3\">&lt;xref:System.Windows.FrameworkElement.BeginInit%2A&gt;</ph> and <ph id=\"ph4\">&lt;xref:System.Windows.FrameworkElement.EndInit%2A&gt;</ph> rather than casting to <ph id=\"ph5\">&lt;xref:System.ComponentModel.ISupportInitialize&gt;</ph>.","source":"If the element you are setting properties on is a <xref:System.Windows.FrameworkElement> or <xref:System.Windows.FrameworkContentElement> derived class, then you can call the class versions of <xref:System.Windows.FrameworkElement.BeginInit%2A> and <xref:System.Windows.FrameworkElement.EndInit%2A> rather than casting to <xref:System.ComponentModel.ISupportInitialize>."},{"pos":[3724,3735],"content":"Sample Code","linkify":"Sample Code","nodes":[{"content":"Sample Code","pos":[0,11]}]},{"pos":[3739,4376],"content":"The following example is sample code for a console application that uses rendering <ph id=\"ph1\">[!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)]</ph> and <ph id=\"ph2\">&lt;xref:System.Windows.Markup.XamlReader.Load%28System.IO.Stream%29?displayProperty=nameWithType&gt;</ph> of a loose <ph id=\"ph3\">[!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)]</ph> file to illustrate the proper placement of <ph id=\"ph4\">&lt;xref:System.Windows.FrameworkElement.BeginInit%2A&gt;</ph> and <ph id=\"ph5\">&lt;xref:System.Windows.FrameworkElement.EndInit%2A&gt;</ph> around other <ph id=\"ph6\">[!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)]</ph> calls that adjust properties that affect rendering.","source":"The following example is sample code for a console application that uses rendering [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] and <xref:System.Windows.Markup.XamlReader.Load%28System.IO.Stream%29?displayProperty=nameWithType> of a loose [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] file to illustrate the proper placement of <xref:System.Windows.FrameworkElement.BeginInit%2A> and <xref:System.Windows.FrameworkElement.EndInit%2A> around other [!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] calls that adjust properties that affect rendering."},{"content":"The example illustrates the main function only.","pos":[4383,4430]},{"content":"The functions <ph id=\"ph1\">`Rasterize`</ph> and <ph id=\"ph2\">`Save`</ph> (not shown) are utility functions that take care of image processing and IO.","pos":[4431,4544],"source":" The functions `Rasterize` and `Save` (not shown) are utility functions that take care of image processing and IO."},{"pos":[4838,4846],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[4850,4881],"content":"<bpt id=\"p1\">[</bpt>Trees in WPF<ept id=\"p1\">](trees-in-wpf.md)</ept>","source":"[Trees in WPF](trees-in-wpf.md)"},{"pos":[4884,4976],"content":"<bpt id=\"p1\">[</bpt>WPF Graphics Rendering Overview<ept id=\"p1\">](../graphics-multimedia/wpf-graphics-rendering-overview.md)</ept>","source":"[WPF Graphics Rendering Overview](../graphics-multimedia/wpf-graphics-rendering-overview.md)"},{"pos":[4979,5022],"content":"<bpt id=\"p1\">[</bpt>XAML Overview (WPF)<ept id=\"p1\">](xaml-overview-wpf.md)</ept>","source":"[XAML Overview (WPF)](xaml-overview-wpf.md)"}]}