{"content":"---\ntitle: \"WSStreamedHttpBinding\"\nms.date: \"03/30/2017\"\nms.assetid: 97ce4d3d-ca6f-45fa-b33b-2429bb84e65b\n---\n# WSStreamedHttpBinding\nThe sample demonstrates how to create a binding that is designed to support streaming scenarios when the HTTP transport is used.  \n  \n> [!NOTE]\n>  The setup procedure and build instructions for this sample are located at the end of this topic.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Extensibility\\Binding\\WSStreamedHttpBinding`  \n  \n The steps to create and configure a new standard binding are as follows.  \n  \n1.  Create a new standard binding  \n  \n     The standard bindings in Windows Communication Foundation (WCF) such as basicHttpBinding, and netTcpBinding configure the underlying transports and channel stack for specific requirements. In this sample, `WSStreamedHttpBinding` configures the channel stack to support streaming. By default, WS-Security and reliable messaging are not added to the channel stack because both features are not supported by streaming. The new binding is implemented in the class `WSStreamedHttpBinding` that derives from <xref:System.ServiceModel.Channels.Binding>. The `WSStreamedHttpBinding` contains the following binding elements: <xref:System.ServiceModel.Channels.HttpTransportBindingElement>, <xref:System.ServiceModel.Channels.HttpsTransportBindingElement>, <xref:System.ServiceModel.Channels.TransactionFlowBindingElement>, and <xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement>. The class provides a `CreateBindingElements()` method to configure the resulting binding stack, as shown in the following sample code.  \n  \n    ```  \n    public override BindingElementCollection CreateBindingElements()  \n    {  \n         // return collection of BindingElements  \n         BindingElementCollection bindingElements = new BindingElementCollection();  \n  \n        // the order of binding elements within the collection is important: layered channels are applied in the order included, followed by  \n        // the message encoder, and finally the transport at the end  \n        if (flowTransactions)  \n        {  \n            bindingElements.Add(transactionFlow);  \n        }  \n        bindingElements.Add(textEncoding);  \n  \n        // add transport (http or https)  \n        bindingElements.Add(transport);  \n        return bindingElements.Clone();  \n    }  \n    ```  \n  \n2.  Add configuration support  \n  \n     To expose the transport through configuration the sample implements two more classes—`WSStreamedHttpBindingConfigurationElement` and `WSStreamedHttpBindingSection`. The class `WSStreamedHttpBindingSection` is a <xref:System.ServiceModel.Configuration.StandardBindingCollectionElement%602> that exposes `WSStreamedHttpBinding` to the WCF configuration system. The bulk of the implementation is delegated to `WSStreamedHttpBindingConfigurationElement`, which derives from <xref:System.ServiceModel.Configuration.StandardBindingElement>. The class `WSStreamedHttpBindingConfigurationElement` has properties that correspond to the properties of `WSStreamedHttpBinding`, and functions to map each configuration element to a binding.  \n  \n     Register the handler with the configuration system, by adding the following section to the service's configuration file.  \n  \n    ```xml  \n    <configuration>  \n      <system.serviceModel>  \n        <extensions>  \n          <bindingExtensions>  \n            <add name=\"wsStreamedHttpBinding\" type=\"Microsoft.ServiceModel.Samples.WSStreamedHttpBindingCollectionElement, WSStreamedHttpBinding, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null\" />  \n          </bindingExtensions>  \n        </extensions>  \n      </system.serviceModel>  \n    </configuration>  \n    ```  \n  \n     The handler can then be referenced from the serviceModel configuration section.  \n  \n    ```xml  \n    <configuration>  \n      <system.serviceModel>  \n        <client>  \n          <endpoint  \n                    address=\"https://localhost/servicemodelsamples/service.svc\"  \n                    bindingConfiguration=\"Binding\"  \n                    binding=\"wsStreamedHttpBinding\"  \n                    contract=\"Microsoft.ServiceModel.Samples.IStreamedEchoService\"/>  \n        </client>  \n      </system.serviceModel>  \n    </configuration>  \n    ```  \n  \n### To set up, build, and run the sample  \n  \n1.  Install [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] 4.0 using the following command.  \n  \n    ```  \n    %windir%\\Microsoft.NET\\Framework\\v4.0.XXXXX\\aspnet_regiis.exe /i /enable  \n    ```  \n  \n2.  Ensure that you have performed the steps listed in [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).  \n  \n3.  Ensure that you have performed the [Internet Information Services (IIS) Server Certificate Installation Instructions](../../../../docs/framework/wcf/samples/iis-server-certificate-installation-instructions.md).  \n  \n4.  To build the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).  \n  \n5.  To run the sample in a cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).  \n  \n6.  When the client window displays, type \"Sample.txt\". You should find a \"Copy of Sample.txt\" in your directory.  \n  \n## The WSStreamedHttpBinding Sample Service  \n The sample service that uses `WSStreamedHttpBinding` is located in the service subdirectory. The implementation of `OperationContract` uses a `MemoryStream` to first retrieve all data from the incoming stream before returning the `MemoryStream`. The sample service is hosted by Internet Information Services (IIS).  \n  \n```  \n[ServiceContract]  \npublic interface IStreamedEchoService  \n{  \n    [OperationContract]  \n    Stream Echo(Stream data);  \n}  \n  \npublic class StreamedEchoService : IStreamedEchoService  \n{  \n    public Stream Echo(Stream data)  \n    {  \n        MemoryStream dataStorage = new MemoryStream();  \n        byte[] byteArray = new byte[8192];  \n        int bytesRead = data.Read(byteArray, 0, 8192);  \n        while (bytesRead > 0)  \n        {  \n            dataStorage.Write(byteArray, 0, bytesRead);  \n            bytesRead = data.Read(byteArray, 0, 8192);  \n        }  \n        data.Close();  \n        dataStorage.Seek(0, SeekOrigin.Begin);  \n  \n        return dataStorage;  \n    }  \n}  \n```  \n  \n## The WSStreamedHttpBinding Sample Client  \n The client that is used to interact with the service using `WSStreamedHttpBinding` is located in the client subdirectory. Because the certificate used in this sample is a test certificate created with Makecert.exe, a security alert displays when you attempt to access an HTTPS address in your browser such as https://localhost/servicemodelsamples/service.svc. To allow the WCF client to work with a test certificate in place, some additional code has been added to the client to suppress the security alert. The code and the accompanying class are not required when using production certificates.  \n  \n```  \n// WARNING: This code is only required for test certificates such as those created by makecert. It is   \n// not recommended for production code.  \nPermissiveCertificatePolicy.Enact(\"CN=ServiceModelSamples-HTTPS-Server\");  \n```  \n","nodes":[{"pos":[4,105],"embed":true,"restype":"x-metadata","content":"title: \"WSStreamedHttpBinding\"\nms.date: \"03/30/2017\"\nms.assetid: 97ce4d3d-ca6f-45fa-b33b-2429bb84e65b","nodes":[{"content":"WSStreamedHttpBinding","nodes":[{"pos":[0,21],"content":"WSStreamedHttpBinding","nodes":[{"content":"WSStreamedHttpBinding","pos":[0,21]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[112,133],"content":"WSStreamedHttpBinding","linkify":"WSStreamedHttpBinding","nodes":[{"content":"WSStreamedHttpBinding","pos":[0,21]}]},{"content":"The sample demonstrates how to create a binding that is designed to support streaming scenarios when the HTTP transport is used.","pos":[134,262]},{"pos":[270,377],"content":"[!NOTE]\n The setup procedure and build instructions for this sample are located at the end of this topic.","leadings":["","> "],"nodes":[{"content":"The setup procedure and build instructions for this sample are located at the end of this topic.","pos":[9,105]}]},{"pos":[385,517],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[14,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[0,53]},{"content":"Check for the following (default) directory before continuing.","pos":[54,116]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[571,881],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[882,932]},{"content":"The steps to create and configure a new standard binding are as follows.","pos":[1030,1102]},{"content":"Create a new standard binding","pos":[1112,1141]},{"content":"The standard bindings in Windows Communication Foundation (WCF) such as basicHttpBinding, and netTcpBinding configure the underlying transports and channel stack for specific requirements.","pos":[1152,1340]},{"content":"In this sample, <ph id=\"ph1\">`WSStreamedHttpBinding`</ph> configures the channel stack to support streaming.","pos":[1341,1431],"source":" In this sample, `WSStreamedHttpBinding` configures the channel stack to support streaming."},{"content":"By default, WS-Security and reliable messaging are not added to the channel stack because both features are not supported by streaming.","pos":[1432,1567]},{"content":"The new binding is implemented in the class <ph id=\"ph1\">`WSStreamedHttpBinding`</ph> that derives from <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.Binding&gt;</ph>.","pos":[1568,1698],"source":" The new binding is implemented in the class `WSStreamedHttpBinding` that derives from <xref:System.ServiceModel.Channels.Binding>."},{"content":"The <ph id=\"ph1\">`WSStreamedHttpBinding`</ph> contains the following binding elements: <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.HttpTransportBindingElement&gt;</ph>, <ph id=\"ph3\">&lt;xref:System.ServiceModel.Channels.HttpsTransportBindingElement&gt;</ph>, <ph id=\"ph4\">&lt;xref:System.ServiceModel.Channels.TransactionFlowBindingElement&gt;</ph>, and <ph id=\"ph5\">&lt;xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement&gt;</ph>.","pos":[1699,2040],"source":" The `WSStreamedHttpBinding` contains the following binding elements: <xref:System.ServiceModel.Channels.HttpTransportBindingElement>, <xref:System.ServiceModel.Channels.HttpsTransportBindingElement>, <xref:System.ServiceModel.Channels.TransactionFlowBindingElement>, and <xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement>."},{"content":"The class provides a <ph id=\"ph1\">`CreateBindingElements()`</ph> method to configure the resulting binding stack, as shown in the following sample code.","pos":[2041,2175],"source":" The class provides a `CreateBindingElements()` method to configure the resulting binding stack, as shown in the following sample code."},{"content":"Add configuration support","pos":[2932,2957]},{"content":"To expose the transport through configuration the sample implements two more classes—<ph id=\"ph1\">`WSStreamedHttpBindingConfigurationElement`</ph> and <ph id=\"ph2\">`WSStreamedHttpBindingSection`</ph>.","pos":[2968,3132],"source":"To expose the transport through configuration the sample implements two more classes—`WSStreamedHttpBindingConfigurationElement` and `WSStreamedHttpBindingSection`."},{"content":"The class <ph id=\"ph1\">`WSStreamedHttpBindingSection`</ph> is a <ph id=\"ph2\">&lt;xref:System.ServiceModel.Configuration.StandardBindingCollectionElement%602&gt;</ph> that exposes <ph id=\"ph3\">`WSStreamedHttpBinding`</ph> to the WCF configuration system.","pos":[3133,3326],"source":" The class `WSStreamedHttpBindingSection` is a <xref:System.ServiceModel.Configuration.StandardBindingCollectionElement%602> that exposes `WSStreamedHttpBinding` to the WCF configuration system."},{"content":"The bulk of the implementation is delegated to <ph id=\"ph1\">`WSStreamedHttpBindingConfigurationElement`</ph>, which derives from <ph id=\"ph2\">&lt;xref:System.ServiceModel.Configuration.StandardBindingElement&gt;</ph>.","pos":[3327,3502],"source":" The bulk of the implementation is delegated to `WSStreamedHttpBindingConfigurationElement`, which derives from <xref:System.ServiceModel.Configuration.StandardBindingElement>."},{"content":"The class <ph id=\"ph1\">`WSStreamedHttpBindingConfigurationElement`</ph> has properties that correspond to the properties of <ph id=\"ph2\">`WSStreamedHttpBinding`</ph>, and functions to map each configuration element to a binding.","pos":[3503,3695],"source":" The class `WSStreamedHttpBindingConfigurationElement` has properties that correspond to the properties of `WSStreamedHttpBinding`, and functions to map each configuration element to a binding."},{"content":"Register the handler with the configuration system, by adding the following section to the service's configuration file.","pos":[3706,3826]},{"content":"The handler can then be referenced from the serviceModel configuration section.","pos":[4287,4366]},{"pos":[4845,4881],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[4891,4989],"content":"Install <ph id=\"ph1\">[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]</ph> 4.0 using the following command.","source":"Install [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] 4.0 using the following command."},{"pos":[5101,5316],"content":"Ensure that you have performed the steps listed in <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Ensure that you have performed the steps listed in [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"pos":[5326,5536],"content":"Ensure that you have performed the <bpt id=\"p1\">[</bpt>Internet Information Services (IIS) Server Certificate Installation Instructions<ept id=\"p1\">](../../../../docs/framework/wcf/samples/iis-server-certificate-installation-instructions.md)</ept>.","source":"Ensure that you have performed the [Internet Information Services (IIS) Server Certificate Installation Instructions](../../../../docs/framework/wcf/samples/iis-server-certificate-installation-instructions.md)."},{"pos":[5546,5716],"content":"To build the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"pos":[5726,5923],"content":"To run the sample in a cross-machine configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"content":"When the client window displays, type \"Sample.txt\".","pos":[5933,5984]},{"content":"You should find a \"Copy of Sample.txt\" in your directory.","pos":[5985,6042]},{"pos":[6051,6091],"content":"The WSStreamedHttpBinding Sample Service","linkify":"The WSStreamedHttpBinding Sample Service","nodes":[{"content":"The WSStreamedHttpBinding Sample Service","pos":[0,40]}]},{"content":"The sample service that uses <ph id=\"ph1\">`WSStreamedHttpBinding`</ph> is located in the service subdirectory.","pos":[6095,6187],"source":"The sample service that uses `WSStreamedHttpBinding` is located in the service subdirectory."},{"content":"The implementation of <ph id=\"ph1\">`OperationContract`</ph> uses a <ph id=\"ph2\">`MemoryStream`</ph> to first retrieve all data from the incoming stream before returning the <ph id=\"ph3\">`MemoryStream`</ph>.","pos":[6188,6340],"source":" The implementation of `OperationContract` uses a `MemoryStream` to first retrieve all data from the incoming stream before returning the `MemoryStream`."},{"content":"The sample service is hosted by Internet Information Services (IIS).","pos":[6341,6409]},{"pos":[7118,7157],"content":"The WSStreamedHttpBinding Sample Client","linkify":"The WSStreamedHttpBinding Sample Client","nodes":[{"content":"The WSStreamedHttpBinding Sample Client","pos":[0,39]}]},{"content":"The client that is used to interact with the service using <ph id=\"ph1\">`WSStreamedHttpBinding`</ph> is located in the client subdirectory.","pos":[7161,7282],"source":"The client that is used to interact with the service using `WSStreamedHttpBinding` is located in the client subdirectory."},{"content":"Because the certificate used in this sample is a test certificate created with Makecert.exe, a security alert displays when you attempt to access an HTTPS address in your browser such as <ph id=\"ph1\">https://localhost/servicemodelsamples/service.svc</ph>.","pos":[7283,7520],"source":" Because the certificate used in this sample is a test certificate created with Makecert.exe, a security alert displays when you attempt to access an HTTPS address in your browser such as https://localhost/servicemodelsamples/service.svc."},{"content":"To allow the WCF client to work with a test certificate in place, some additional code has been added to the client to suppress the security alert.","pos":[7521,7668]},{"content":"The code and the accompanying class are not required when using production certificates.","pos":[7669,7757]}]}