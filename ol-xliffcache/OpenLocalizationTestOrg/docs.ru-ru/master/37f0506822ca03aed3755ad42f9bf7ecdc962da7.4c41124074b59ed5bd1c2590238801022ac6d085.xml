{"content":"---\ntitle: \"WCF Web HTTP formatting\"\nms.date: \"03/30/2017\"\nms.assetid: e2414896-5463-41cd-b0a6-026a713eac2c\n---\n# WCF Web HTTP formatting\nThe WCF Web HTTP programming model allows you to dynamically determine the best format for a service operation to return its response in. Two methods for determining an appropriate format are supported: automatic and explicit.  \n  \n## Automatic formatting  \n When enabled, automatic formatting chooses the best format in which to return the response. It determines the best format by checking the following, in order:  \n  \n1.  The media types in the request message’s Accept header.  \n  \n2.  The content-type of the request message.  \n  \n3.  The default format setting in the operation.  \n  \n4.  The default format setting in the WebHttpBehavior.  \n  \n If the request message contains an Accept header the Windows Communication Foundation (WCF) infrastructure searches for a type that it supports. If the `Accept` header specifies priorities for its media types, they are honored. If no suitable format is found in the `Accept` header, the content-type of the request message is used. If no suitable content-type is specified, the default format setting for the operation is used. The default format is set with the `ResponseFormat` parameter of the <xref:System.ServiceModel.Web.WebGetAttribute> and <xref:System.ServiceModel.Web.WebInvokeAttribute> attributes. If no default format is specified on the operation, the value of the <xref:System.ServiceModel.Description.WebHttpBehavior.DefaultOutgoingResponseFormat%2A> property is used. Automatic formatting relies on the <xref:System.ServiceModel.Description.WebHttpBehavior.AutomaticFormatSelectionEnabled%2A> property. When this property is set to `true`, the WCF infrastructure determines the best format to use. Automatic format selection is disabled by default for backwards compatibility. Automatic format selection can be enabled programmatically or through configuration. The following example shows how to enable automatic format selection in code.  \n  \n```csharp\n// This code assumes the service name is MyService and the service contract is IMyContract     \nUri baseAddress = new Uri(\"http://localhost:8000\");  \n  \nWebServiceHost host = new WebServiceHost(typeof(MyService), baseAddress)  \ntry  \n{  \n   ServiceEndpoint sep = host.AddServiceEndpoint(typeof(IMyContract), new WebHttpBinding(), \"\");  \n   // Check it see if the WebHttpBehavior already exists  \n   WebHttpBehavior whb = sep.Behaviors.Find<WebHttpBehavior>();  \n  \n   if (whb != null)  \n   {  \n      whb.AutomaticFormatSelectionEnabled = true;  \n   }  \n   else  \n   {  \n      WebHttpBehavior webBehavior = new WebHttpBehavior();  \n      webBehavior.AutomaticFormatSelectionEnabled = true;  \n      sep.Behaviors.Add(webBehavior);  \n   }  \n         // Open host to start listening for messages  \n   host.Open();        \n  \n  // ...  \n}  \n  catch(CommunicationException ex)  \n  {  \n     Console.WriteLine(\"An exception occurred: \" + ex.Message());  \n  }  \n```  \n  \n Automatic formatting can also be enabled through configuration. You can set the <xref:System.ServiceModel.Description.WebHttpBehavior.AutomaticFormatSelectionEnabled%2A> property directly on the <xref:System.ServiceModel.Description.WebHttpBehavior> or using the <xref:System.ServiceModel.Description.WebHttpEndpoint>. The following example shows how to enable the automatic format selection on the <xref:System.ServiceModel.Description.WebHttpBehavior>.  \n  \n```xml  \n<system.serviceModel>  \n  <behaviors>  \n    <endpointBehaviors>  \n      <behavior>  \n        <webHttp automaticFormatSelectionEnabled=\"true\" />  \n      </behavior>  \n    </endpointBehaviors>  \n  </behaviors>  \n  <standardEndpoints>  \n    <webHttpEndpoint>  \n      <!-- the \"\" standard endpoint is used by WebServiceHost for auto creating a web endpoint. -->  \n      <standardEndpoint name=\"\" helpEnabled=\"true\" />  \n    </webHttpEndpoint>  \n  </standardEndpoints>  \n</system.serviceModel>  \n```  \n  \n The following example shows how to enable automatic format selection using <xref:System.ServiceModel.Description.WebHttpEndpoint>.  \n  \n```xml  \n<system.serviceModel>  \n    <standardEndpoints>  \n      <webHttpEndpoint>  \n        <!-- the \"\" standard endpoint is used by WebServiceHost for auto creating a web endpoint. -->  \n        <standardEndpoint name=\"\" helpEnabled=\"true\" automaticFormatSelectionEnabled=\"true\"  />  \n      </webHttpEndpoint>  \n    </standardEndpoints>  \n  </system.serviceModel>  \n```  \n  \n## Explicit formatting  \n As the name implies, in explicit formatting the developer determines the best format to use within the operation code. If the best format is XML or JSON the developer sets <xref:System.ServiceModel.Web.OutgoingWebResponseContext.Format%2A> to either <xref:System.ServiceModel.Web.WebMessageFormat.Xml> or <xref:System.ServiceModel.Web.WebMessageFormat.Json>. If the <xref:System.ServiceModel.Web.OutgoingWebResponseContext.Format%2A> property is not explicitly set, then the operation’s default format is used.  \n  \n The following example checks the format query string parameter for a format to use. If it has been specified, it sets the operation’s format using <xref:System.ServiceModel.Web.OutgoingWebResponseContext.Format%2A>.  \n  \n```csharp\npublic class Service : IService  \n{  \n    [WebGet]  \n     public string EchoWithGet(string s)  \n    {  \n        // if a format query string parameter has been specified, set the response format to that. If no such\n        // query string parameter exists the Accept header will be used\n        string formatQueryStringValue = WebOperationContext.Current.IncomingRequest.UriTemplateMatch.QueryParameters[\"format\"];  \n        if (!string.IsNullOrEmpty(formatQueryStringValue))  \n        {  \n            if (formatQueryStringValue.Equals(\"xml\", System.StringComparison.OrdinalIgnoreCase))  \n            {\n                WebOperationContext.Current.OutgoingResponse.Format = WebMessageFormat.Xml;\n            }\n            else if (formatQueryStringValue.Equals(\"json\", System.StringComparison.OrdinalIgnoreCase))  \n            {  \n                WebOperationContext.Current.OutgoingResponse.Format = WebMessageFormat.Json;  \n            }  \n            else  \n            {  \n                throw new WebFaultException<string>($\"Unsupported format '{formatQueryStringValue}'\",   HttpStatusCode.BadRequest);\n            }  \n        }  \n        return \"You said \" + s;  \n    }  \n```  \n  \n If you need to support formats other than XML or JSON, define your operation to have a return type of <xref:System.ServiceModel.Channels.Message>. Within the operation code, determine the appropriate format to use and then create a <xref:System.ServiceModel.Channels.Message> object using one of the following methods:  \n  \n-   `WebOperationContext.CreateAtom10Response`  \n  \n-   `WebOperationContext.CreateJsonResponse`  \n  \n-   `WebOperationContext.CreateStreamResponse`  \n  \n-   `WebOperationContext.CreateTextResponse`  \n  \n-   `WebOperationContext.CreateXmlResponse`  \n  \n Each of these methods takes content and creates a message with the appropriate format. The `WebOperationContext.Current.IncomingRequest.GetAcceptHeaderElements` method can be used to get a list of formats preferred by the client in order of decreasing preference. The following example shows how to use `WebOperationContext.Current.IncomingRequest.GetAcceptHeaderElements` to determine the format to use and then uses the appropriate create response method to create the response message.  \n  \n```csharp\npublic class Service : IService  \n{  \n    public Message EchoListWithGet(string list)  \n    {  \n        List<string> returnList = new List<string>(list.Split(new char[] { ',' }, StringSplitOptions.RemoveEmptyEntries));  \n        IList<ContentType> acceptHeaderElements = WebOperationContext.Current.IncomingRequest.GetAcceptHeaderElements();  \n        for (int x = 0; x < acceptHeaderElements.Count; x++)  \n        {  \n            string normalizedMediaType = acceptHeaderElements[x].MediaType.ToLowerInvariant();  \n            switch (normalizedMediaType)  \n            {  \n                case \"image/jpeg\": return CreateJpegResponse(returnList);  \n                case \"application/xhtml+xml\": return CreateXhtmlResponse(returnList);  \n                case \"application/atom+xml\": return CreateAtom10Response(returnList);  \n                case \"application/xml\": return CreateXmlResponse(returnList);  \n                case \"application/json\": return CreateJsonResponse(returnList);  \n          }  \n    }  \n  \n    // Default response format is XML  \n    return CreateXmlResponse(returnList);  \n    }  \n}  \n```  \n  \n## See also\n\n- <xref:System.UriTemplate>\n- <xref:System.UriTemplateMatch>\n- [WCF Web HTTP Programming Model](../../../../docs/framework/wcf/feature-details/wcf-web-http-programming-model.md)\n- [UriTemplate and UriTemplateTable](../../../../docs/framework/wcf/feature-details/uritemplate-and-uritemplatetable.md)\n- [WCF Web HTTP Programming Model Overview](../../../../docs/framework/wcf/feature-details/wcf-web-http-programming-model-overview.md)\n- [WCF Web HTTP Programming Object Model](../../../../docs/framework/wcf/feature-details/wcf-web-http-programming-object-model.md)\n","nodes":[{"pos":[4,107],"embed":true,"restype":"x-metadata","content":"title: \"WCF Web HTTP formatting\"\nms.date: \"03/30/2017\"\nms.assetid: e2414896-5463-41cd-b0a6-026a713eac2c","nodes":[{"content":"WCF Web HTTP formatting","nodes":[{"pos":[0,23],"content":"WCF Web HTTP formatting","nodes":[{"content":"WCF Web HTTP formatting","pos":[0,23]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[114,137],"content":"WCF Web HTTP formatting","linkify":"WCF Web HTTP formatting","nodes":[{"content":"WCF Web HTTP formatting","pos":[0,23]}]},{"content":"The WCF Web HTTP programming model allows you to dynamically determine the best format for a service operation to return its response in.","pos":[138,275]},{"content":"Two methods for determining an appropriate format are supported: automatic and explicit.","pos":[276,364]},{"pos":[373,393],"content":"Automatic formatting","linkify":"Automatic formatting","nodes":[{"content":"Automatic formatting","pos":[0,20]}]},{"content":"When enabled, automatic formatting chooses the best format in which to return the response.","pos":[397,488]},{"content":"It determines the best format by checking the following, in order:","pos":[489,555]},{"content":"The media types in the request message’s Accept header.","pos":[565,620]},{"content":"The content-type of the request message.","pos":[630,670]},{"content":"The default format setting in the operation.","pos":[680,724]},{"content":"The default format setting in the WebHttpBehavior.","pos":[734,784]},{"content":"If the request message contains an Accept header the Windows Communication Foundation (WCF) infrastructure searches for a type that it supports.","pos":[791,935]},{"content":"If the <ph id=\"ph1\">`Accept`</ph> header specifies priorities for its media types, they are honored.","pos":[936,1018],"source":" If the `Accept` header specifies priorities for its media types, they are honored."},{"content":"If no suitable format is found in the <ph id=\"ph1\">`Accept`</ph> header, the content-type of the request message is used.","pos":[1019,1122],"source":" If no suitable format is found in the `Accept` header, the content-type of the request message is used."},{"content":"If no suitable content-type is specified, the default format setting for the operation is used.","pos":[1123,1218]},{"content":"The default format is set with the <ph id=\"ph1\">`ResponseFormat`</ph> parameter of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Web.WebGetAttribute&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.ServiceModel.Web.WebInvokeAttribute&gt;</ph> attributes.","pos":[1219,1400],"source":" The default format is set with the `ResponseFormat` parameter of the <xref:System.ServiceModel.Web.WebGetAttribute> and <xref:System.ServiceModel.Web.WebInvokeAttribute> attributes."},{"content":"If no default format is specified on the operation, the value of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.WebHttpBehavior.DefaultOutgoingResponseFormat%2A&gt;</ph> property is used.","pos":[1401,1575],"source":" If no default format is specified on the operation, the value of the <xref:System.ServiceModel.Description.WebHttpBehavior.DefaultOutgoingResponseFormat%2A> property is used."},{"content":"Automatic formatting relies on the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.WebHttpBehavior.AutomaticFormatSelectionEnabled%2A&gt;</ph> property.","pos":[1576,1710],"source":" Automatic formatting relies on the <xref:System.ServiceModel.Description.WebHttpBehavior.AutomaticFormatSelectionEnabled%2A> property."},{"content":"When this property is set to <ph id=\"ph1\">`true`</ph>, the WCF infrastructure determines the best format to use.","pos":[1711,1805],"source":" When this property is set to `true`, the WCF infrastructure determines the best format to use."},{"content":"Automatic format selection is disabled by default for backwards compatibility.","pos":[1806,1884]},{"content":"Automatic format selection can be enabled programmatically or through configuration.","pos":[1885,1969]},{"content":"The following example shows how to enable automatic format selection in code.","pos":[1970,2047]},{"content":"Automatic formatting can also be enabled through configuration.","pos":[3026,3089]},{"content":"You can set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.WebHttpBehavior.AutomaticFormatSelectionEnabled%2A&gt;</ph> property directly on the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.WebHttpBehavior&gt;</ph> or using the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Description.WebHttpEndpoint&gt;</ph>.","pos":[3090,3344],"source":" You can set the <xref:System.ServiceModel.Description.WebHttpBehavior.AutomaticFormatSelectionEnabled%2A> property directly on the <xref:System.ServiceModel.Description.WebHttpBehavior> or using the <xref:System.ServiceModel.Description.WebHttpEndpoint>."},{"content":"The following example shows how to enable the automatic format selection on the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.WebHttpBehavior&gt;</ph>.","pos":[3345,3480],"source":" The following example shows how to enable the automatic format selection on the <xref:System.ServiceModel.Description.WebHttpBehavior>."},{"pos":[3996,4126],"content":"The following example shows how to enable automatic format selection using <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.WebHttpEndpoint&gt;</ph>.","source":"The following example shows how to enable automatic format selection using <xref:System.ServiceModel.Description.WebHttpEndpoint>."},{"pos":[4512,4531],"content":"Explicit formatting","linkify":"Explicit formatting","nodes":[{"content":"Explicit formatting","pos":[0,19]}]},{"content":"As the name implies, in explicit formatting the developer determines the best format to use within the operation code.","pos":[4535,4653]},{"content":"If the best format is XML or JSON the developer sets <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.OutgoingWebResponseContext.Format%2A&gt;</ph> to either <ph id=\"ph2\">&lt;xref:System.ServiceModel.Web.WebMessageFormat.Xml&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.ServiceModel.Web.WebMessageFormat.Json&gt;</ph>.","pos":[4654,4893],"source":" If the best format is XML or JSON the developer sets <xref:System.ServiceModel.Web.OutgoingWebResponseContext.Format%2A> to either <xref:System.ServiceModel.Web.WebMessageFormat.Xml> or <xref:System.ServiceModel.Web.WebMessageFormat.Json>."},{"content":"If the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.OutgoingWebResponseContext.Format%2A&gt;</ph> property is not explicitly set, then the operation’s default format is used.","pos":[4894,5045],"source":" If the <xref:System.ServiceModel.Web.OutgoingWebResponseContext.Format%2A> property is not explicitly set, then the operation’s default format is used."},{"content":"The following example checks the format query string parameter for a format to use.","pos":[5052,5135]},{"content":"If it has been specified, it sets the operation’s format using <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.OutgoingWebResponseContext.Format%2A&gt;</ph>.","pos":[5136,5267],"source":" If it has been specified, it sets the operation’s format using <xref:System.ServiceModel.Web.OutgoingWebResponseContext.Format%2A>."},{"content":"If you need to support formats other than XML or JSON, define your operation to have a return type of <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.Message&gt;</ph>.","pos":[6470,6616],"source":"If you need to support formats other than XML or JSON, define your operation to have a return type of <xref:System.ServiceModel.Channels.Message>."},{"content":"Within the operation code, determine the appropriate format to use and then create a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.Message&gt;</ph> object using one of the following methods:","pos":[6617,6788],"source":" Within the operation code, determine the appropriate format to use and then create a <xref:System.ServiceModel.Channels.Message> object using one of the following methods:"},{"content":"Each of these methods takes content and creates a message with the appropriate format.","pos":[7048,7134]},{"content":"The <ph id=\"ph1\">`WebOperationContext.Current.IncomingRequest.GetAcceptHeaderElements`</ph> method can be used to get a list of formats preferred by the client in order of decreasing preference.","pos":[7135,7311],"source":" The `WebOperationContext.Current.IncomingRequest.GetAcceptHeaderElements` method can be used to get a list of formats preferred by the client in order of decreasing preference."},{"content":"The following example shows how to use <ph id=\"ph1\">`WebOperationContext.Current.IncomingRequest.GetAcceptHeaderElements`</ph> to determine the format to use and then uses the appropriate create response method to create the response message.","pos":[7312,7536],"source":" The following example shows how to use `WebOperationContext.Current.IncomingRequest.GetAcceptHeaderElements` to determine the format to use and then uses the appropriate create response method to create the response message."},{"pos":[8674,8682],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[8747,8861],"content":"<bpt id=\"p1\">[</bpt>WCF Web HTTP Programming Model<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/wcf-web-http-programming-model.md)</ept>","source":"[WCF Web HTTP Programming Model](../../../../docs/framework/wcf/feature-details/wcf-web-http-programming-model.md)"},{"pos":[8864,8982],"content":"<bpt id=\"p1\">[</bpt>UriTemplate and UriTemplateTable<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/uritemplate-and-uritemplatetable.md)</ept>","source":"[UriTemplate and UriTemplateTable](../../../../docs/framework/wcf/feature-details/uritemplate-and-uritemplatetable.md)"},{"pos":[8985,9117],"content":"<bpt id=\"p1\">[</bpt>WCF Web HTTP Programming Model Overview<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/wcf-web-http-programming-model-overview.md)</ept>","source":"[WCF Web HTTP Programming Model Overview](../../../../docs/framework/wcf/feature-details/wcf-web-http-programming-model-overview.md)"},{"pos":[9120,9248],"content":"<bpt id=\"p1\">[</bpt>WCF Web HTTP Programming Object Model<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/wcf-web-http-programming-object-model.md)</ept>","source":"[WCF Web HTTP Programming Object Model](../../../../docs/framework/wcf/feature-details/wcf-web-http-programming-object-model.md)"}]}