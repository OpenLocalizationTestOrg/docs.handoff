{"content":"---\ntitle: \"How to: Write a Query that Finds Elements Based on Context (C#) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"2015-07-20\"\nms.prod: .net\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-csharp\"\n\nms.topic: \"article\"\ndev_langs: \n  - \"CSharp\"\nms.assetid: 3ff79ef0-fc8b-42fe-8cc0-10dc32b06b4e\ncaps.latest.revision: 3\nauthor: \"BillWagner\"\nms.author: \"wiwagn\"\n\n---\n# How to: Write a Query that Finds Elements Based on Context (C#)\nSometimes you might have to write a query that selects elements based on their context. You might want to filter based on preceding or following sibling elements. You might want to filter based on child or ancestor elements.  \n  \n You can do this by writing a query and using the results of the query in the `where` clause. If you have to first test against null, and then test the value, it is more convenient to do the query in a `let` clause, and then use the results in the `where` clause.  \n  \n## Example  \n The following example selects all `p` elements that are immediately followed by a `ul` element.  \n  \n```csharp  \nXElement doc = XElement.Parse(@\"<Root>  \n    <p id=\"\"1\"\"/>  \n    <ul>abc</ul>  \n    <Child>  \n        <p id=\"\"2\"\"/>  \n        <notul/>  \n        <p id=\"\"3\"\"/>  \n        <ul>def</ul>  \n        <p id=\"\"4\"\"/>  \n    </Child>  \n    <Child>  \n        <p id=\"\"5\"\"/>  \n        <notul/>  \n        <p id=\"\"6\"\"/>  \n        <ul>abc</ul>  \n        <p id=\"\"7\"\"/>  \n    </Child>  \n</Root>\");  \n  \nIEnumerable<XElement> items =  \n    from e in doc.Descendants(\"p\")  \n    let z = e.ElementsAfterSelf().FirstOrDefault()  \n    where z != null && z.Name.LocalName == \"ul\"  \n    select e;  \n  \nforeach (XElement e in items)  \n    Console.WriteLine(\"id = {0}\", (string)e.Attribute(\"id\"));  \n```  \n  \n This code produces the following output:  \n  \n```  \nid = 1  \nid = 3  \nid = 6  \n```  \n  \n## Example  \n The following example shows the same query for XML that is in a namespace. For more information, see [Working with XML Namespaces (C#)](../../../../csharp/programming-guide/concepts/linq/working-with-xml-namespaces.md).  \n  \n```csharp  \nXElement doc = XElement.Parse(@\"<Root xmlns='http://www.adatum.com'>  \n    <p id=\"\"1\"\"/>  \n    <ul>abc</ul>  \n    <Child>  \n        <p id=\"\"2\"\"/>  \n        <notul/>  \n        <p id=\"\"3\"\"/>  \n        <ul>def</ul>  \n        <p id=\"\"4\"\"/>  \n    </Child>  \n    <Child>  \n        <p id=\"\"5\"\"/>  \n        <notul/>  \n        <p id=\"\"6\"\"/>  \n        <ul>abc</ul>  \n        <p id=\"\"7\"\"/>  \n    </Child>  \n</Root>\");  \n  \nXNamespace ad = \"http://www.adatum.com\";  \n  \nIEnumerable<XElement> items =  \n    from e in doc.Descendants(ad + \"p\")  \n    let z = e.ElementsAfterSelf().FirstOrDefault()  \n    where z != null && z.Name == ad.GetName(\"ul\")  \n    select e;  \n  \nforeach (XElement e in items)  \n    Console.WriteLine(\"id = {0}\", (string)e.Attribute(\"id\"));  \n```  \n  \n This code produces the following output:  \n  \n```  \nid = 1  \nid = 3  \nid = 6  \n```  \n  \n## See Also  \n <xref:System.Xml.Linq.XElement.Parse%2A>   \n <xref:System.Xml.Linq.XContainer.Descendants%2A>   \n <xref:System.Xml.Linq.XNode.ElementsAfterSelf%2A>   \n <xref:System.Linq.Enumerable.FirstOrDefault%2A>   \n [Basic Queries (LINQ to XML) (C#)](../../../../csharp/programming-guide/concepts/linq/basic-queries-linq-to-xml.md)","nodes":[{"pos":[12,92],"content":"How to: Write a Query that Finds Elements Based on Context (C#) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"How to: Write a Query that Finds Elements Based on Context (C#) | Microsoft Docs","pos":[0,80]}]},{"pos":[377,440],"content":"How to: Write a Query that Finds Elements Based on Context (C#)","linkify":"How to: Write a Query that Finds Elements Based on Context (C#)","nodes":[{"content":"How to: Write a Query that Finds Elements Based on Context (C#)","pos":[0,63]}]},{"content":"Sometimes you might have to write a query that selects elements based on their context.","pos":[441,528]},{"content":"You might want to filter based on preceding or following sibling elements.","pos":[529,603]},{"content":"You might want to filter based on child or ancestor elements.","pos":[604,665]},{"content":"You can do this by writing a query and using the results of the query in the <ph id=\"ph1\">`where`</ph> clause.","pos":[672,764],"source":"You can do this by writing a query and using the results of the query in the `where` clause."},{"content":"If you have to first test against null, and then test the value, it is more convenient to do the query in a <ph id=\"ph1\">`let`</ph> clause, and then use the results in the <ph id=\"ph2\">`where`</ph> clause.","pos":[765,934],"source":" If you have to first test against null, and then test the value, it is more convenient to do the query in a `let` clause, and then use the results in the `where` clause."},{"pos":[943,950],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"pos":[954,1049],"content":"The following example selects all <ph id=\"ph1\">`p`</ph> elements that are immediately followed by a <ph id=\"ph2\">`ul`</ph> element.","source":"The following example selects all `p` elements that are immediately followed by a `ul` element."},{"content":"This code produces the following output:","pos":[1746,1786]},{"pos":[1837,1844],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following example shows the same query for XML that is in a namespace.","pos":[1848,1922]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Working with XML Namespaces (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/linq/working-with-xml-namespaces.md)</ept>.","pos":[1923,2067],"source":" For more information, see [Working with XML Namespaces (C#)](../../../../csharp/programming-guide/concepts/linq/working-with-xml-namespaces.md)."},{"content":"This code produces the following output:","pos":[2847,2887]},{"pos":[2938,2946],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.Xml.Linq.XElement.Parse%2A&gt;</ph>","pos":[2950,2990],"source":"<xref:System.Xml.Linq.XElement.Parse%2A> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Xml.Linq.XContainer.Descendants%2A&gt;</ph>","pos":[2995,3043],"source":" <xref:System.Xml.Linq.XContainer.Descendants%2A> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Xml.Linq.XNode.ElementsAfterSelf%2A&gt;</ph>","pos":[3048,3097],"source":" <xref:System.Xml.Linq.XNode.ElementsAfterSelf%2A> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Linq.Enumerable.FirstOrDefault%2A&gt;</ph>","pos":[3102,3149],"source":" <xref:System.Linq.Enumerable.FirstOrDefault%2A> "},{"content":"<bpt id=\"p1\"> [</bpt>Basic Queries (LINQ to XML) (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/linq/basic-queries-linq-to-xml.md)</ept>","pos":[3153,3269],"source":" [Basic Queries (LINQ to XML) (C#)](../../../../csharp/programming-guide/concepts/linq/basic-queries-linq-to-xml.md)"}]}