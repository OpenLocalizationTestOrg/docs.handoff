{"content":"---\ntitle: \"Service Auditing Behavior\"\nms.date: \"03/30/2017\"\nms.assetid: 59bf0cda-e496-4418-a3a1-2f0f6e85f8ce\n---\n# Service Auditing Behavior\nThis sample demonstrates how to use the <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior> to enable auditing of security events during service operations. This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md). The service and client have been configured using the [\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md). The `mode` attribute of the [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-of-custombinding.md) has been set to `Message` and `clientCredentialType` has been set to `Windows`. In this sample, the client is a console application (.exe) and the service is hosted by Internet Information Services (IIS).  \n  \n> [!NOTE]\n>  The setup procedure and build instructions for this sample are located at the end of this topic.  \n  \n The service configuration file uses the `serviceSecurityAudit` element to configure auditing.  \n  \n```xml  \n<behaviors>  \n  <serviceBehaviors>  \n    <behavior name=\"CalculatorServiceBehavior\">  \n      ...  \n<!-- serviceSecurityAudit allows specification of audit location   \n     and whether to audit success, failure or both. This service   \n     logs success and failure of messageAuthentication   \n     to the default location -->  \n     <serviceSecurityAudit auditLogLocation =\"Default\" messageAuthenticationAuditLevel = \"SuccessOrFailure\" />  \n    </behavior>  \n  </serviceBehaviors>  \n</behaviors>  \n```  \n  \n When you run the sample, the operation requests and responses are displayed in the client console window. Press ENTER in the console window to shut down the client.  \n  \n The resulting audit logs can be seen by running the Event Viewer. By default, on Windows XP the audit events can be seen in the Application Log while on Windows Server 2003 and Windows Vista, the audit events can be seen in the Security Log. On Windows Server 2008 and Windows 7, the audit events can be seen in the Applications and Services logs. The location of audit events can be specified by setting the `auditLogLocation` attribute to \"Application\" or \"Security\". For more information, see [How to: Audit Security Events](../../../../docs/framework/wcf/feature-details/how-to-audit-wcf-security-events.md). If the events are written in the Security Log the LocalSecurityPolicy-> Enable Object Access should be set for \"Success\" and \"Failure\".  \n  \n When looking at the event log, the source of the audit events is \"ServiceModel Audit 3.0.0.0\". Message authentication audit records have a category of \"MessageAuthentication\" while service authorization audit records have a category of \"ServiceAuthorization\".  \n  \n Message authentication audit events cover whether the message was tampered with, whether the message has expired, and whether the client can authenticate to the service. They provide information about whether the authentication succeeded or failed along with the identity of the client, and the endpoint the message was sent to along with the action associated with the message.  \n  \n Service authorization audit events cover the authorization decision made by a service authorization manager. They provide information about whether authorization succeeded or failed along with the identity of the client, the endpoint the message was sent to, the action associated with the message, the identifier of the authorization context that was generated from the incoming message, and the type of the authorization manager that made the access decision.  \n  \n### To set up, build, and run the sample  \n  \n1.  Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).  \n  \n2.  To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).  \n  \n3.  To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).  \n  \n## See also\n\n- [Auditing](../../../../docs/framework/wcf/feature-details/auditing-security-events.md)\n- [How to: Audit Security Events](../../../../docs/framework/wcf/feature-details/how-to-audit-wcf-security-events.md)\n","nodes":[{"pos":[4,109],"embed":true,"restype":"x-metadata","content":"title: \"Service Auditing Behavior\"\nms.date: \"03/30/2017\"\nms.assetid: 59bf0cda-e496-4418-a3a1-2f0f6e85f8ce","nodes":[{"content":"Service Auditing Behavior","nodes":[{"pos":[0,25],"content":"Service Auditing Behavior","nodes":[{"content":"Service Auditing Behavior","pos":[0,25]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[116,141],"content":"Service Auditing Behavior","linkify":"Service Auditing Behavior","nodes":[{"content":"Service Auditing Behavior","pos":[0,25]}]},{"content":"This sample demonstrates how to use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior&gt;</ph> to enable auditing of security events during service operations.","pos":[142,314],"source":"This sample demonstrates how to use the <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior> to enable auditing of security events during service operations."},{"content":"This sample is based on the <bpt id=\"p1\">[</bpt>Getting Started<ept id=\"p1\">](../../../../docs/framework/wcf/samples/getting-started-sample.md)</ept>.","pos":[315,427],"source":" This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md)."},{"content":"The service and client have been configured using the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>wsHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md)</ept>.","pos":[428,577],"source":" The service and client have been configured using the [\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md)."},{"content":"The <ph id=\"ph1\">`mode`</ph> attribute of the <bpt id=\"p1\">[</bpt><ph id=\"ph2\">\\&lt;</ph>security&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/security-of-custombinding.md)</ept> has been set to <ph id=\"ph3\">`Message`</ph> and <ph id=\"ph4\">`clientCredentialType`</ph> has been set to <ph id=\"ph5\">`Windows`</ph>.","pos":[578,787],"source":" The `mode` attribute of the [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-of-custombinding.md) has been set to `Message` and `clientCredentialType` has been set to `Windows`."},{"content":"In this sample, the client is a console application (.exe) and the service is hosted by Internet Information Services (IIS).","pos":[788,912]},{"pos":[920,1027],"content":"[!NOTE]\n The setup procedure and build instructions for this sample are located at the end of this topic.","leadings":["","> "],"nodes":[{"content":"The setup procedure and build instructions for this sample are located at the end of this topic.","pos":[9,105]}]},{"pos":[1034,1127],"content":"The service configuration file uses the <ph id=\"ph1\">`serviceSecurityAudit`</ph> element to configure auditing.","source":"The service configuration file uses the `serviceSecurityAudit` element to configure auditing."},{"content":"When you run the sample, the operation requests and responses are displayed in the client console window.","pos":[1650,1755]},{"content":"Press ENTER in the console window to shut down the client.","pos":[1756,1814]},{"content":"The resulting audit logs can be seen by running the Event Viewer.","pos":[1821,1886]},{"content":"By default, on Windows XP the audit events can be seen in the Application Log while on Windows Server 2003 and Windows Vista, the audit events can be seen in the Security Log.","pos":[1887,2062]},{"content":"On Windows Server 2008 and Windows 7, the audit events can be seen in the Applications and Services logs.","pos":[2063,2168]},{"content":"The location of audit events can be specified by setting the <ph id=\"ph1\">`auditLogLocation`</ph> attribute to \"Application\" or \"Security\".","pos":[2169,2290],"source":" The location of audit events can be specified by setting the `auditLogLocation` attribute to \"Application\" or \"Security\"."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>How to: Audit Security Events<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-audit-wcf-security-events.md)</ept>.","pos":[2291,2433],"source":" For more information, see [How to: Audit Security Events](../../../../docs/framework/wcf/feature-details/how-to-audit-wcf-security-events.md)."},{"content":"If the events are written in the Security Log the LocalSecurityPolicy-&gt; Enable Object Access should be set for \"Success\" and \"Failure\".","pos":[2434,2569],"source":" If the events are written in the Security Log the LocalSecurityPolicy-> Enable Object Access should be set for \"Success\" and \"Failure\"."},{"content":"When looking at the event log, the source of the audit events is \"ServiceModel Audit 3.0.0.0\".","pos":[2576,2670]},{"content":"Message authentication audit records have a category of \"MessageAuthentication\" while service authorization audit records have a category of \"ServiceAuthorization\".","pos":[2671,2835]},{"content":"Message authentication audit events cover whether the message was tampered with, whether the message has expired, and whether the client can authenticate to the service.","pos":[2842,3011]},{"content":"They provide information about whether the authentication succeeded or failed along with the identity of the client, and the endpoint the message was sent to along with the action associated with the message.","pos":[3012,3220]},{"content":"Service authorization audit events cover the authorization decision made by a service authorization manager.","pos":[3227,3335]},{"content":"They provide information about whether authorization succeeded or failed along with the identity of the client, the endpoint the message was sent to, the action associated with the message, the identifier of the authorization context that was generated from the incoming message, and the type of the authorization manager that made the access decision.","pos":[3336,3688]},{"pos":[3698,3734],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[3744,3943],"content":"Ensure that you have performed the <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"pos":[3953,4162],"content":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"pos":[4172,4381],"content":"To run the sample in a single- or cross-computer configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"pos":[4390,4398],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[4402,4488],"content":"<bpt id=\"p1\">[</bpt>Auditing<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/auditing-security-events.md)</ept>","source":"[Auditing](../../../../docs/framework/wcf/feature-details/auditing-security-events.md)"},{"pos":[4491,4606],"content":"<bpt id=\"p1\">[</bpt>How to: Audit Security Events<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-audit-wcf-security-events.md)</ept>","source":"[How to: Audit Security Events](../../../../docs/framework/wcf/feature-details/how-to-audit-wcf-security-events.md)"}]}