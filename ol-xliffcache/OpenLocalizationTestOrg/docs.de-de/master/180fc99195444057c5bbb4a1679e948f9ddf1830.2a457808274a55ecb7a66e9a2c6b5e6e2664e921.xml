{"content":"---\ntitle: \"Enabling Transaction Flow\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"transactions [WCF], enabling flow\"\nms.assetid: a03f5041-5049-43f4-897c-e0292d4718f7\n---\n# Enabling Transaction Flow\nWindows Communication Foundation (WCF) provides highly flexible options for controlling transaction flow. A service's transaction flow settings can be expressed using a combination of attributes and configuration.  \n  \n## Transaction Flow Settings  \n Transaction flow settings are generated for a service endpoint as a result of the intersection of the following three values:  \n  \n-   The <xref:System.ServiceModel.TransactionFlowAttribute> attribute specified for each method in the service contract.  \n  \n-   The `TransactionFlow` binding property in the specific binding.  \n  \n-   The `TransactionFlowProtocol` binding property in the specific binding. The `TransactionFlowProtocol` binding property enables you to choose among two different transaction protocols that you can use to flow a transaction. The following sections briefly describe each of them.  \n  \n### WS-AtomicTransaction Protocol  \n The WS-AtomicTransaction (WS-AT) protocol is useful for scenarios when interoperability with third-party protocol stacks is required.  \n  \n### OleTransactions Protocol  \n The OleTransactions protocol is useful for scenarios when interoperability with third-party protocol stacks is not required, and the deployer of a service knows in advance that the WS-AT protocol service is disabled locally or the existing network topology does not favor the usage of WS-AT.  \n  \n The following table shows the different types of transaction flows that can be generated using these various combinations.  \n  \n|TransactionFlow<br /><br /> binding|TransactionFlow binding property|TransactionFlowProtocol binding protocol|Type of transaction flow|  \n|---------------------------------|--------------------------------------|----------------------------------------------|------------------------------|  \n|Mandatory|true|WS-AT|Transaction must be flowed in the interoperable WS-AT format.|  \n|Mandatory|true|OleTransactions|Transaction must be flowed in the WCF OleTransactions format.|  \n|Mandatory|false|Not applicable|Not applicable because this is an invalid configuration.|  \n|Allowed|true|WS-AT|Transaction may be flowed in the interoperable WS-AT format.|  \n|Allowed|true|OleTransactions|Transaction may be flowed in the WCF OleTransactions format.|  \n|Allowed|false|Any value|A transaction is not flowed.|  \n|NotAllowed|Any value|Any value|A transaction is not flowed.|  \n  \n The following table summarizes the message processing result.  \n  \n|Incoming message|TransactionFlow setting|Transaction header|Message processing result|  \n|----------------------|-----------------------------|------------------------|-------------------------------|  \n|Transaction matches expected protocol format|Allowed or Mandatory|`MustUnderstand` equals `true`.|Process|  \n|Transaction does not match expected protocol format|Mandatory|`MustUnderstand` equals `false`.|Rejected because a transaction is required|  \n|Transaction does not match expected protocol format|Allowed|`MustUnderstand` equals `false`.|Rejected because the header is not understood|  \n|Transaction using any protocol format|NotAllowed|`MustUnderstand` equals `false`.|Rejected because the header is not understood|  \n|No transaction|Mandatory|N/A|Rejected because a transaction is required|  \n|No transaction|Allowed|N/A|Process|  \n|No transaction|NotAllowed|N/A|Process|  \n  \n While each method on a contract can have different transaction flow requirements, the transaction flow protocol setting is scoped at the level of the binding. This means that all methods that share the same endpoint (and therefore the same binding) also share the same policy allowing or requiring transaction flow, as well as the same transaction protocol if applicable.  \n  \n## Enabling Transaction Flow at the Method Level  \n Transaction flow requirements are not always the same for all methods in a service contract. Therefore, WCF also provides an attribute-based mechanism to allow each method's transaction flow preferences to be expressed. This is achieved by the <xref:System.ServiceModel.TransactionFlowAttribute> that specifies the level in which a service operation accepts a transaction header. You should mark your service contract methods with this attribute if you want to enable transaction flow. This attribute takes one of the values of the <xref:System.ServiceModel.TransactionFlowOption> enumeration, in which the default value is <xref:System.ServiceModel.TransactionFlowOption.NotAllowed>. If any value except <xref:System.ServiceModel.TransactionFlowOption.NotAllowed> is specified, the method is required to not be one-way. A developer can use this attribute to specify method-level transaction flow requirements or constraints at design time.  \n  \n## Enabling Transaction Flow at the Endpoint Level  \n In addition to the method-level transaction flow setting  the <xref:System.ServiceModel.TransactionFlowAttribute> attribute provides, WCF provides an endpoint-wide setting for transaction flow to allow administrators to control transaction flow at a higher level.  \n  \n This is achieved by the <xref:System.ServiceModel.Channels.TransactionFlowBindingElement>, which enables you to enable or disable incoming transaction flow in an endpoint’s binding settings, as well as to specify the desired transaction protocol format for incoming transactions.  \n  \n If the binding has disabled transaction flow, but one of the operations on a service contract requires an incoming transaction, then a validation exception is thrown at service startup.  \n  \n Most of the standing bindings WCF provides contain the `transactionFlow` and `transactionProtocol` attributes to enable you to configure the specific binding to accept incoming transactions. For more information about setting the configuration elements, see [\\<binding>](../../../../docs/framework/misc/binding.md).  \n  \n An administrator or deployer can use endpoint-level transaction flow to configure transaction flow requirements or constraints at deployment time using the configuration file.  \n  \n## Security  \n To ensure system security and integrity, you must secure message exchanges when flowing transactions between applications. You should not flow or disclose transaction details to any application that is not entitled to participate in the same transaction.  \n  \n When generating WCF clients to unknown or untrusted Web services through the use of metadata exchange, calls to operations on these Web services should suppress the current transaction if possible. The following example demonstrates how to do this.  \n  \n```  \n//client code which has an ambient transaction  \nusing (TransactionScope scope = new TransactionScope(TransactionScopeOption.Suppress))  \n{  \n    // No transaction will flow to this operation  \n    untrustedProxy.Operation1(...);  \n    scope.Complete();  \n}  \n//remainder of client code  \n```  \n  \n In addition, services should be configured to accept incoming transactions only from clients that they have authenticated and authorized. Incoming transactions should only be accepted if they come from highly trusted clients.  \n  \n## Policy Assertions  \n WCF uses policy assertions to control transaction flow. Policy assertions can be found in a service’s policy document, which is generated by aggregating contracts, configuration, and attributes. The client can obtain the service’s policy document using an HTTP GET or a WS-MetadataExchange request-reply. Clients can then process the policy document to determine which operations on a service contract may support or require transaction flow.  \n  \n Transaction flow policy assertions affect transaction flow by specifying the SOAP headers that a client should send to a service to represent a transaction. All transaction headers must be marked with `MustUnderstand` equal to `true`. Any message with a header marked otherwise is rejected with a SOAP fault.  \n  \n Only one transaction-related policy assertion can be present on a single operation. Policy documents with more than one transaction assertion on an operation are considered invalid and are rejected by WCF. In addition, only a single transaction protocol can be present inside each port type. Policy documents with operations referencing more than one transaction protocol inside a single port type are considered invalid, and are rejected by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md). Policy documents with transaction assertions present on output messages or one-way input messages are also considered invalid.\n","nodes":[{"pos":[4,171],"embed":true,"restype":"x-metadata","content":"title: \"Enabling Transaction Flow\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"transactions [WCF], enabling flow\"\nms.assetid: a03f5041-5049-43f4-897c-e0292d4718f7","nodes":[{"content":"Enabling Transaction Flow","nodes":[{"pos":[0,25],"content":"Enabling Transaction Flow","nodes":[{"content":"Enabling Transaction Flow","pos":[0,25]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[178,203],"content":"Enabling Transaction Flow","linkify":"Enabling Transaction Flow","nodes":[{"content":"Enabling Transaction Flow","pos":[0,25]}]},{"content":"Windows Communication Foundation (WCF) provides highly flexible options for controlling transaction flow.","pos":[204,309]},{"content":"A service's transaction flow settings can be expressed using a combination of attributes and configuration.","pos":[310,417]},{"pos":[426,451],"content":"Transaction Flow Settings","linkify":"Transaction Flow Settings","nodes":[{"content":"Transaction Flow Settings","pos":[0,25]}]},{"content":"Transaction flow settings are generated for a service endpoint as a result of the intersection of the following three values:","pos":[455,580]},{"pos":[590,706],"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.TransactionFlowAttribute&gt;</ph> attribute specified for each method in the service contract.","source":"The <xref:System.ServiceModel.TransactionFlowAttribute> attribute specified for each method in the service contract."},{"pos":[716,779],"content":"The <ph id=\"ph1\">`TransactionFlow`</ph> binding property in the specific binding.","source":"The `TransactionFlow` binding property in the specific binding."},{"content":"The <ph id=\"ph1\">`TransactionFlowProtocol`</ph> binding property in the specific binding.","pos":[789,860],"source":"The `TransactionFlowProtocol` binding property in the specific binding."},{"content":"The <ph id=\"ph1\">`TransactionFlowProtocol`</ph> binding property enables you to choose among two different transaction protocols that you can use to flow a transaction.","pos":[861,1011],"source":" The `TransactionFlowProtocol` binding property enables you to choose among two different transaction protocols that you can use to flow a transaction."},{"content":"The following sections briefly describe each of them.","pos":[1012,1065]},{"pos":[1075,1104],"content":"WS-AtomicTransaction Protocol","linkify":"WS-AtomicTransaction Protocol","nodes":[{"content":"WS-AtomicTransaction Protocol","pos":[0,29]}]},{"content":"The WS-AtomicTransaction (WS-AT) protocol is useful for scenarios when interoperability with third-party protocol stacks is required.","pos":[1108,1241]},{"pos":[1251,1275],"content":"OleTransactions Protocol","linkify":"OleTransactions Protocol","nodes":[{"content":"OleTransactions Protocol","pos":[0,24]}]},{"content":"The OleTransactions protocol is useful for scenarios when interoperability with third-party protocol stacks is not required, and the deployer of a service knows in advance that the WS-AT protocol service is disabled locally or the existing network topology does not favor the usage of WS-AT.","pos":[1279,1570]},{"content":"The following table shows the different types of transaction flows that can be generated using these various combinations.","pos":[1577,1699]},{"content":"TransactionFlow","pos":[1706,1721]},{"content":"binding","pos":[1734,1741]},{"content":"TransactionFlow binding property","pos":[1742,1774]},{"content":"TransactionFlowProtocol binding protocol","pos":[1775,1815]},{"content":"Type of transaction flow","pos":[1816,1840]},{"content":"Mandatory","pos":[2000,2009]},{"content":"true","pos":[2010,2014]},{"content":"WS-AT","pos":[2015,2020]},{"content":"Transaction must be flowed in the interoperable WS-AT format.","pos":[2021,2082]},{"content":"Mandatory","pos":[2087,2096]},{"content":"true","pos":[2097,2101]},{"content":"OleTransactions","pos":[2102,2117]},{"content":"Transaction must be flowed in the WCF OleTransactions format.","pos":[2118,2179]},{"content":"Mandatory","pos":[2184,2193]},{"content":"false","pos":[2194,2199]},{"content":"Not applicable","pos":[2200,2214]},{"content":"Not applicable because this is an invalid configuration.","pos":[2215,2271]},{"content":"Allowed","pos":[2276,2283]},{"content":"true","pos":[2284,2288]},{"content":"WS-AT","pos":[2289,2294]},{"content":"Transaction may be flowed in the interoperable WS-AT format.","pos":[2295,2355]},{"content":"Allowed","pos":[2360,2367]},{"content":"true","pos":[2368,2372]},{"content":"OleTransactions","pos":[2373,2388]},{"content":"Transaction may be flowed in the WCF OleTransactions format.","pos":[2389,2449]},{"content":"Allowed","pos":[2454,2461]},{"content":"false","pos":[2462,2467]},{"content":"Any value","pos":[2468,2477]},{"content":"A transaction is not flowed.","pos":[2478,2506]},{"content":"NotAllowed","pos":[2511,2521]},{"content":"Any value","pos":[2522,2531]},{"content":"Any value","pos":[2532,2541]},{"content":"A transaction is not flowed.","pos":[2542,2570]},{"content":"The following table summarizes the message processing result.","pos":[2578,2639]},{"content":"Incoming message","pos":[2646,2662]},{"content":"TransactionFlow setting","pos":[2663,2686]},{"content":"Transaction header","pos":[2687,2705]},{"content":"Message processing result","pos":[2706,2731]},{"content":"Transaction matches expected protocol format","pos":[2850,2894]},{"content":"Allowed or Mandatory","pos":[2895,2915]},{"pos":[2916,2947],"content":"<ph id=\"ph1\">`MustUnderstand`</ph> equals <ph id=\"ph2\">`true`</ph>.","source":"`MustUnderstand` equals `true`."},{"content":"Process","pos":[2948,2955]},{"content":"Transaction does not match expected protocol format","pos":[2960,3011]},{"content":"Mandatory","pos":[3012,3021]},{"pos":[3022,3054],"content":"<ph id=\"ph1\">`MustUnderstand`</ph> equals <ph id=\"ph2\">`false`</ph>.","source":"`MustUnderstand` equals `false`."},{"content":"Rejected because a transaction is required","pos":[3055,3097]},{"content":"Transaction does not match expected protocol format","pos":[3102,3153]},{"content":"Allowed","pos":[3154,3161]},{"pos":[3162,3194],"content":"<ph id=\"ph1\">`MustUnderstand`</ph> equals <ph id=\"ph2\">`false`</ph>.","source":"`MustUnderstand` equals `false`."},{"content":"Rejected because the header is not understood","pos":[3195,3240]},{"content":"Transaction using any protocol format","pos":[3245,3282]},{"content":"NotAllowed","pos":[3283,3293]},{"pos":[3294,3326],"content":"<ph id=\"ph1\">`MustUnderstand`</ph> equals <ph id=\"ph2\">`false`</ph>.","source":"`MustUnderstand` equals `false`."},{"content":"Rejected because the header is not understood","pos":[3327,3372]},{"content":"No transaction","pos":[3377,3391]},{"content":"Mandatory","pos":[3392,3401]},{"content":"N/A","pos":[3402,3405]},{"content":"Rejected because a transaction is required","pos":[3406,3448]},{"content":"No transaction","pos":[3453,3467]},{"content":"Allowed","pos":[3468,3475]},{"content":"N/A","pos":[3476,3479]},{"content":"Process","pos":[3480,3487]},{"content":"No transaction","pos":[3492,3506]},{"content":"NotAllowed","pos":[3507,3517]},{"content":"N/A","pos":[3518,3521]},{"content":"Process","pos":[3522,3529]},{"content":"While each method on a contract can have different transaction flow requirements, the transaction flow protocol setting is scoped at the level of the binding.","pos":[3537,3695]},{"content":"This means that all methods that share the same endpoint (and therefore the same binding) also share the same policy allowing or requiring transaction flow, as well as the same transaction protocol if applicable.","pos":[3696,3908]},{"pos":[3917,3962],"content":"Enabling Transaction Flow at the Method Level","linkify":"Enabling Transaction Flow at the Method Level","nodes":[{"content":"Enabling Transaction Flow at the Method Level","pos":[0,45]}]},{"content":"Transaction flow requirements are not always the same for all methods in a service contract.","pos":[3966,4058]},{"content":"Therefore, WCF also provides an attribute-based mechanism to allow each method's transaction flow preferences to be expressed.","pos":[4059,4185]},{"content":"This is achieved by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.TransactionFlowAttribute&gt;</ph> that specifies the level in which a service operation accepts a transaction header.","pos":[4186,4345],"source":" This is achieved by the <xref:System.ServiceModel.TransactionFlowAttribute> that specifies the level in which a service operation accepts a transaction header."},{"content":"You should mark your service contract methods with this attribute if you want to enable transaction flow.","pos":[4346,4451]},{"content":"This attribute takes one of the values of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.TransactionFlowOption&gt;</ph> enumeration, in which the default value is <ph id=\"ph2\">&lt;xref:System.ServiceModel.TransactionFlowOption.NotAllowed&gt;</ph>.","pos":[4452,4650],"source":" This attribute takes one of the values of the <xref:System.ServiceModel.TransactionFlowOption> enumeration, in which the default value is <xref:System.ServiceModel.TransactionFlowOption.NotAllowed>."},{"content":"If any value except <ph id=\"ph1\">&lt;xref:System.ServiceModel.TransactionFlowOption.NotAllowed&gt;</ph> is specified, the method is required to not be one-way.","pos":[4651,4786],"source":" If any value except <xref:System.ServiceModel.TransactionFlowOption.NotAllowed> is specified, the method is required to not be one-way."},{"content":"A developer can use this attribute to specify method-level transaction flow requirements or constraints at design time.","pos":[4787,4906]},{"pos":[4915,4962],"content":"Enabling Transaction Flow at the Endpoint Level","linkify":"Enabling Transaction Flow at the Endpoint Level","nodes":[{"content":"Enabling Transaction Flow at the Endpoint Level","pos":[0,47]}]},{"pos":[4966,5229],"content":"In addition to the method-level transaction flow setting  the <ph id=\"ph1\">&lt;xref:System.ServiceModel.TransactionFlowAttribute&gt;</ph> attribute provides, WCF provides an endpoint-wide setting for transaction flow to allow administrators to control transaction flow at a higher level.","source":"In addition to the method-level transaction flow setting  the <xref:System.ServiceModel.TransactionFlowAttribute> attribute provides, WCF provides an endpoint-wide setting for transaction flow to allow administrators to control transaction flow at a higher level."},{"pos":[5236,5515],"content":"This is achieved by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.TransactionFlowBindingElement&gt;</ph>, which enables you to enable or disable incoming transaction flow in an endpoint’s binding settings, as well as to specify the desired transaction protocol format for incoming transactions.","source":"This is achieved by the <xref:System.ServiceModel.Channels.TransactionFlowBindingElement>, which enables you to enable or disable incoming transaction flow in an endpoint’s binding settings, as well as to specify the desired transaction protocol format for incoming transactions."},{"content":"If the binding has disabled transaction flow, but one of the operations on a service contract requires an incoming transaction, then a validation exception is thrown at service startup.","pos":[5522,5707]},{"content":"Most of the standing bindings WCF provides contain the <ph id=\"ph1\">`transactionFlow`</ph> and <ph id=\"ph2\">`transactionProtocol`</ph> attributes to enable you to configure the specific binding to accept incoming transactions.","pos":[5714,5904],"source":"Most of the standing bindings WCF provides contain the `transactionFlow` and `transactionProtocol` attributes to enable you to configure the specific binding to accept incoming transactions."},{"content":"For more information about setting the configuration elements, see <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>binding&gt;<ept id=\"p1\">](../../../../docs/framework/misc/binding.md)</ept>.","pos":[5905,6029],"source":" For more information about setting the configuration elements, see [\\<binding>](../../../../docs/framework/misc/binding.md)."},{"content":"An administrator or deployer can use endpoint-level transaction flow to configure transaction flow requirements or constraints at deployment time using the configuration file.","pos":[6036,6211]},{"pos":[6220,6228],"content":"Security","linkify":"Security","nodes":[{"content":"Security","pos":[0,8]}]},{"content":"To ensure system security and integrity, you must secure message exchanges when flowing transactions between applications.","pos":[6232,6354]},{"content":"You should not flow or disclose transaction details to any application that is not entitled to participate in the same transaction.","pos":[6355,6486]},{"content":"When generating WCF clients to unknown or untrusted Web services through the use of metadata exchange, calls to operations on these Web services should suppress the current transaction if possible.","pos":[6493,6690]},{"content":"The following example demonstrates how to do this.","pos":[6691,6741]},{"content":"In addition, services should be configured to accept incoming transactions only from clients that they have authenticated and authorized.","pos":[7052,7189]},{"content":"Incoming transactions should only be accepted if they come from highly trusted clients.","pos":[7190,7277]},{"pos":[7286,7303],"content":"Policy Assertions","linkify":"Policy Assertions","nodes":[{"content":"Policy Assertions","pos":[0,17]}]},{"content":"WCF uses policy assertions to control transaction flow.","pos":[7307,7362]},{"content":"Policy assertions can be found in a service’s policy document, which is generated by aggregating contracts, configuration, and attributes.","pos":[7363,7501]},{"content":"The client can obtain the service’s policy document using an HTTP GET or a WS-MetadataExchange request-reply.","pos":[7502,7611]},{"content":"Clients can then process the policy document to determine which operations on a service contract may support or require transaction flow.","pos":[7612,7749]},{"content":"Transaction flow policy assertions affect transaction flow by specifying the SOAP headers that a client should send to a service to represent a transaction.","pos":[7756,7912]},{"content":"All transaction headers must be marked with <ph id=\"ph1\">`MustUnderstand`</ph> equal to <ph id=\"ph2\">`true`</ph>.","pos":[7913,7990],"source":" All transaction headers must be marked with `MustUnderstand` equal to `true`."},{"content":"Any message with a header marked otherwise is rejected with a SOAP fault.","pos":[7991,8064]},{"content":"Only one transaction-related policy assertion can be present on a single operation.","pos":[8071,8154]},{"content":"Policy documents with more than one transaction assertion on an operation are considered invalid and are rejected by WCF.","pos":[8155,8276]},{"content":"In addition, only a single transaction protocol can be present inside each port type.","pos":[8277,8362]},{"content":"Policy documents with operations referencing more than one transaction protocol inside a single port type are considered invalid, and are rejected by the <bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept>.","pos":[8363,8650],"source":" Policy documents with operations referencing more than one transaction protocol inside a single port type are considered invalid, and are rejected by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)."},{"content":"Policy documents with transaction assertions present on output messages or one-way input messages are also considered invalid.","pos":[8651,8777]}]}