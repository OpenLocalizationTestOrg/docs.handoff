{"content":"---\ntitle: \"Mitigation: Pool Blocking Period | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-bcl\"\n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 92d2de20-79be-4df1-b182-144143a8866a\ncaps.latest.revision: 4\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# Mitigation: Pool Blocking Period\nThe connection pool blocking period has been removed for connections to Azure SQL databases.  \n  \n## Additional description  \n In the [!INCLUDE[net_v461](../../../includes/net-v461-md.md)] and earlier versions, when an app encounters a transient connection failure when connecting to a database, the connection attempt cannot be retried quickly, because the connection pool caches the error and re-throws it for 5 seconds to 1 min. For more information, see [SQL Server Connection Pooling (ADO.NET)](../../../docs/framework/data/adonet/sql-server-connection-pooling.md). This behavior is problematic for connections to Azure SQL databases, which often fail with transient errors that are typically recovered from within a few seconds. The connection pool blocking feature means that the app cannot connect to the database for an extensive period, even though the database is available. This behavior is particularly problematic for web apps that connect to Azure SQL databases and that need to render within a few seconds.  \n  \n Starting with the [!INCLUDE[net_v462](../../../includes/net-v462-md.md)], for connection open requests to known Azure SQL databases (*.database.windows.net, \\*.database.chinacloudapi.cn, \\*.database.usgovcloudapi.net, \\*.database.cloudapi.de), connection open errors are not cached. For all other connection attempts, the connection pool blocking period continues to be enforced.  \n  \n## Impact  \n This change allows the connection open attempt to be retried immediately for Azure SQL databases, thereby improving the performance of cloud-enabled apps.  \n  \n## Mitigation  \n For apps that are adversely affected by this change, the connection pool blocking period can be configured by setting the new <xref:System.Data.SqlClient.SqlConnectionStringBuilder.PoolBlockingPeriod%2A> property.  The value of the property is a member of the <xref:System.Data.SqlClient.PoolBlockingPeriod?displayProperty=fullName> enumeration that can take either of three values:  \n  \n-   `PoolBlockingPeriod.AlwaysBlock` \n  \n-   `PoolBlockingPeriod.Auto`  \n  \n-   `PoolBlockingPeriod.NeverBlock` \n  \n The previous behavior can be restored by setting the <xref:System.Data.SqlClient.SqlConnectionStringBuilder.PoolBlockingPeriod%2A> property to `PoolBlockingPeriod.AlwaysBlock`.  \n  \n## See Also  \n [Runtime Changes](../../../docs/framework/migration-guide/runtime-changes-in-the-net-framework-4-6-2.md)","nodes":[{"pos":[12,61],"content":"Mitigation: Pool Blocking Period | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Mitigation: Pool Blocking Period | Microsoft Docs","pos":[0,49]}]},{"pos":[381,413],"content":"Mitigation: Pool Blocking Period","linkify":"Mitigation: Pool Blocking Period","nodes":[{"content":"Mitigation: Pool Blocking Period","pos":[0,32]}]},{"content":"The connection pool blocking period has been removed for connections to Azure SQL databases.","pos":[414,506]},{"pos":[515,537],"content":"Additional description","linkify":"Additional description","nodes":[{"content":"Additional description","pos":[0,22]}]},{"content":"In the <ph id=\"ph1\">[!INCLUDE[net_v461](../../../includes/net-v461-md.md)]</ph> and earlier versions, when an app encounters a transient connection failure when connecting to a database, the connection attempt cannot be retried quickly, because the connection pool caches the error and re-throws it for 5 seconds to 1 min. For more information, see <bpt id=\"p1\">[</bpt>SQL Server Connection Pooling (ADO.NET)<ept id=\"p1\">](../../../docs/framework/data/adonet/sql-server-connection-pooling.md)</ept>.","pos":[541,984],"source":"In the [!INCLUDE[net_v461](../../../includes/net-v461-md.md)] and earlier versions, when an app encounters a transient connection failure when connecting to a database, the connection attempt cannot be retried quickly, because the connection pool caches the error and re-throws it for 5 seconds to 1 min. For more information, see [SQL Server Connection Pooling (ADO.NET)](../../../docs/framework/data/adonet/sql-server-connection-pooling.md)."},{"content":"This behavior is problematic for connections to Azure SQL databases, which often fail with transient errors that are typically recovered from within a few seconds.","pos":[985,1148]},{"content":"The connection pool blocking feature means that the app cannot connect to the database for an extensive period, even though the database is available.","pos":[1149,1299]},{"content":"This behavior is particularly problematic for web apps that connect to Azure SQL databases and that need to render within a few seconds.","pos":[1300,1436]},{"content":"Starting with the <ph id=\"ph1\">[!INCLUDE[net_v462](../../../includes/net-v462-md.md)]</ph>, for connection open requests to known Azure SQL databases (*.database.windows.net, <ph id=\"ph2\">\\*</ph>.database.chinacloudapi.cn, <ph id=\"ph3\">\\*</ph>.database.usgovcloudapi.net, <ph id=\"ph4\">\\*</ph>.database.cloudapi.de), connection open errors are not cached.","pos":[1443,1725],"source":"Starting with the [!INCLUDE[net_v462](../../../includes/net-v462-md.md)], for connection open requests to known Azure SQL databases (*.database.windows.net, \\*.database.chinacloudapi.cn, \\*.database.usgovcloudapi.net, \\*.database.cloudapi.de), connection open errors are not cached."},{"content":"For all other connection attempts, the connection pool blocking period continues to be enforced.","pos":[1726,1822]},{"pos":[1831,1837],"content":"Impact","linkify":"Impact","nodes":[{"content":"Impact","pos":[0,6]}]},{"content":"This change allows the connection open attempt to be retried immediately for Azure SQL databases, thereby improving the performance of cloud-enabled apps.","pos":[1841,1995]},{"pos":[2004,2014],"content":"Mitigation","linkify":"Mitigation","nodes":[{"content":"Mitigation","pos":[0,10]}]},{"content":"For apps that are adversely affected by this change, the connection pool blocking period can be configured by setting the new <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlConnectionStringBuilder.PoolBlockingPeriod%2A&gt;</ph> property.","pos":[2018,2231],"source":"For apps that are adversely affected by this change, the connection pool blocking period can be configured by setting the new <xref:System.Data.SqlClient.SqlConnectionStringBuilder.PoolBlockingPeriod%2A> property."},{"content":"The value of the property is a member of the <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.PoolBlockingPeriod?displayProperty=fullName&gt;</ph> enumeration that can take either of three values:","pos":[2233,2400],"source":"  The value of the property is a member of the <xref:System.Data.SqlClient.PoolBlockingPeriod?displayProperty=fullName> enumeration that can take either of three values:"},{"pos":[2523,2699],"content":"The previous behavior can be restored by setting the <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlConnectionStringBuilder.PoolBlockingPeriod%2A&gt;</ph> property to <ph id=\"ph2\">`PoolBlockingPeriod.AlwaysBlock`</ph>.","source":"The previous behavior can be restored by setting the <xref:System.Data.SqlClient.SqlConnectionStringBuilder.PoolBlockingPeriod%2A> property to `PoolBlockingPeriod.AlwaysBlock`."},{"pos":[2708,2716],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[2720,2824],"content":"<bpt id=\"p1\">[</bpt>Runtime Changes<ept id=\"p1\">](../../../docs/framework/migration-guide/runtime-changes-in-the-net-framework-4-6-2.md)</ept>","source":"[Runtime Changes](../../../docs/framework/migration-guide/runtime-changes-in-the-net-framework-4-6-2.md)"}]}