{"content":"---\ntitle: \"Client Validation | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: f0c1f805-1a81-4d0d-a112-bf5e2e87a631\ncaps.latest.revision: 15\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Client Validation\nServices frequently publish metadata to enable automatic generation and configuration of client proxy types. When the service is not trusted, client applications should validate that the metadata conforms to the client application's policy regarding security, transactions, the type of service contract and so on. The following sample demonstrates how to write a client endpoint behavior that validates the service endpoint to ensure that service endpoint is safe to use.  \n  \n The service exposes four service endpoints. The first endpoint uses the WSDualHttpBinding, the second endpoint uses NTLM authentication, the third endpoint enables transaction flow, and the fourth endpoint uses certificate-based authentication.  \n  \n The client uses the <xref:System.ServiceModel.Description.MetadataResolver> class to retrieve the metadata for the service. The client enforces a policy of prohibiting duplex bindings, NTLM authentication, and transaction flow using a validating behavior. For each <xref:System.ServiceModel.Description.ServiceEndpoint> instance imported from the service's metadata, the client application adds an instance of the `InternetClientValidatorBehavior` endpoint behavior to the <xref:System.ServiceModel.Description.ServiceEndpoint> before attempting to use a [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] client to connect to the endpoint. The behavior's `Validate` method runs before any operations on the service are called and enforces the client's policy by throwing `InvalidOperationExceptions`.  \n  \n### To build the sample  \n  \n1.  To build the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).  \n  \n### To run the sample on the same computer  \n  \n1.  Open a Visual Studio command prompt with administrator privileges and run Setup.bat from the sample install folder. This installs all the certificates required for running the sample.  \n  \n2.  Run the service application from \\service\\bin\\Debug.  \n  \n3.  Run the client application from \\client\\bin\\Debug. Client activity is displayed on the client console application.  \n  \n4.  If the client and service are not able to communicate, see [Troubleshooting Tips](http://msdn.microsoft.com/en-us/8787c877-5e96-42da-8214-fa737a38f10b).  \n  \n5.  Remove the certificates by running Cleanup.bat when you have finished with the sample. Other security samples use the same certificates.  \n  \n### To run the sample across computers  \n  \n1.  On the server, in a Visual Studio command prompt run with administrator privileges, type `setup.bat service`. Running `setup.bat`with the `service` argument creates a service certificate with the fully-qualified domain name of the computer and exports the service certificate to a file named Service.cer.  \n  \n2.  On the server, edit App.config to reflect the new certificate name. That is, change the `findValue` attribute in the [\\<serviceCertificate>](../../../../docs/framework/configure-apps/file-schema/wcf/servicecertificate-of-clientcredentials-element.md) element to the fully-qualified domain name of the computer.  \n  \n3.  Copy the Service.cer file from the service directory to the client directory on the client computer.  \n  \n4.  On the client, open a Visual Studio command prompt with administrator privileges, and type `setup.bat client`. Running `setup.bat`with the `client` argument creates a client certificate named Client.com and exports the client certificate to a file named Client.cer.  \n  \n5.  In the client.cs file change the address value of the MEX endpoint and the `findValue` for setting the default server certificate to match the new address of your service. You do this by replacing localhost with the fully-qualified domain name of the server. Rebuild.  \n  \n6.  Copy the Client.cer file from the client directory to the service directory on the server.  \n  \n7.  On the client, run ImportServiceCert.bat in a Visual Studio command prompt opened with administrator privileges. This imports the service certificate from the Service.cer file into the CurrentUser - TrustedPeople store.  \n  \n8.  On the server, run ImportClientCert.bat in a Visual Studio command prompt opened with administrator privileges. This imports the client certificate from the Client.cer file into the LocalMachine - TrustedPeople store.  \n  \n9. On the service computer, build the service project in Visual Studio and run service.exe.  \n  \n10. On the client computer, run client.exe.  \n  \n    1.  If the client and service are not able to communicate, see [Troubleshooting Tips](http://msdn.microsoft.com/en-us/8787c877-5e96-42da-8214-fa737a38f10b).  \n  \n### To clean up after the sample  \n  \n-   Run Cleanup.bat in the samples folder once you have finished running the sample.  \n  \n    > [!NOTE]\n    >  This script does not remove service certificates on a client when running this sample across computers. If you have run [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] samples that use certificates across computers, be sure to clear the service certificates that have been installed in the CurrentUser - TrustedPeople store. To do this, use the following command: `certmgr -del -r CurrentUser -s TrustedPeople -c -n <Fully Qualified Server Machine Name>. For example: certmgr -del -r CurrentUser -s TrustedPeople -c -n server1.contoso.com`.  \n  \n## See Also  \n [Using Metadata](../../../../docs/framework/wcf/feature-details/using-metadata.md)","nodes":[{"pos":[12,46],"content":"Client Validation | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Client Validation | Microsoft Docs","pos":[0,34]}]},{"pos":[345,362],"content":"Client Validation","linkify":"Client Validation","nodes":[{"content":"Client Validation","pos":[0,17]}]},{"content":"Services frequently publish metadata to enable automatic generation and configuration of client proxy types.","pos":[363,471]},{"content":"When the service is not trusted, client applications should validate that the metadata conforms to the client application's policy regarding security, transactions, the type of service contract and so on.","pos":[472,676]},{"content":"The following sample demonstrates how to write a client endpoint behavior that validates the service endpoint to ensure that service endpoint is safe to use.","pos":[677,834]},{"content":"The service exposes four service endpoints.","pos":[841,884]},{"content":"The first endpoint uses the WSDualHttpBinding, the second endpoint uses NTLM authentication, the third endpoint enables transaction flow, and the fourth endpoint uses certificate-based authentication.","pos":[885,1085]},{"content":"The client uses the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.MetadataResolver&gt;</ph> class to retrieve the metadata for the service.","pos":[1092,1215],"source":"The client uses the <xref:System.ServiceModel.Description.MetadataResolver> class to retrieve the metadata for the service."},{"content":"The client enforces a policy of prohibiting duplex bindings, NTLM authentication, and transaction flow using a validating behavior.","pos":[1216,1347]},{"content":"For each <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceEndpoint&gt;</ph> instance imported from the service's metadata, the client application adds an instance of the <ph id=\"ph2\">`InternetClientValidatorBehavior`</ph> endpoint behavior to the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Description.ServiceEndpoint&gt;</ph> before attempting to use a <ph id=\"ph4\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> client to connect to the endpoint.","pos":[1348,1737],"source":" For each <xref:System.ServiceModel.Description.ServiceEndpoint> instance imported from the service's metadata, the client application adds an instance of the `InternetClientValidatorBehavior` endpoint behavior to the <xref:System.ServiceModel.Description.ServiceEndpoint> before attempting to use a [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] client to connect to the endpoint."},{"content":"The behavior's <ph id=\"ph1\">`Validate`</ph> method runs before any operations on the service are called and enforces the client's policy by throwing <ph id=\"ph2\">`InvalidOperationExceptions`</ph>.","pos":[1738,1898],"source":" The behavior's `Validate` method runs before any operations on the service are called and enforces the client's policy by throwing `InvalidOperationExceptions`."},{"pos":[1908,1927],"content":"To build the sample","linkify":"To build the sample","nodes":[{"content":"To build the sample","pos":[0,19]}]},{"pos":[1937,2107],"content":"To build the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"pos":[2117,2155],"content":"To run the sample on the same computer","linkify":"To run the sample on the same computer","nodes":[{"content":"To run the sample on the same computer","pos":[0,38]}]},{"content":"Open a Visual Studio command prompt with administrator privileges and run Setup.bat from the sample install folder.","pos":[2165,2280]},{"content":"This installs all the certificates required for running the sample.","pos":[2281,2348]},{"content":"Run the service application from \\service\\bin\\Debug.","pos":[2358,2410]},{"content":"Run the client application from \\client\\bin\\Debug.","pos":[2420,2470]},{"content":"Client activity is displayed on the client console application.","pos":[2471,2534]},{"pos":[2544,2696],"content":"If the client and service are not able to communicate, see <bpt id=\"p1\">[</bpt>Troubleshooting Tips<ept id=\"p1\">](http://msdn.microsoft.com/en-us/8787c877-5e96-42da-8214-fa737a38f10b)</ept>.","source":"If the client and service are not able to communicate, see [Troubleshooting Tips](http://msdn.microsoft.com/en-us/8787c877-5e96-42da-8214-fa737a38f10b)."},{"content":"Remove the certificates by running Cleanup.bat when you have finished with the sample.","pos":[2706,2792]},{"content":"Other security samples use the same certificates.","pos":[2793,2842]},{"pos":[2852,2886],"content":"To run the sample across computers","linkify":"To run the sample across computers","nodes":[{"content":"To run the sample across computers","pos":[0,34]}]},{"content":"On the server, in a Visual Studio command prompt run with administrator privileges, type <ph id=\"ph1\">`setup.bat service`</ph>.","pos":[2896,3005],"source":"On the server, in a Visual Studio command prompt run with administrator privileges, type `setup.bat service`."},{"content":"Running <ph id=\"ph1\">`setup.bat`</ph>with the <ph id=\"ph2\">`service`</ph> argument creates a service certificate with the fully-qualified domain name of the computer and exports the service certificate to a file named Service.cer.","pos":[3006,3200],"source":" Running `setup.bat`with the `service` argument creates a service certificate with the fully-qualified domain name of the computer and exports the service certificate to a file named Service.cer."},{"content":"On the server, edit App.config to reflect the new certificate name.","pos":[3210,3277]},{"content":"That is, change the <ph id=\"ph1\">`findValue`</ph> attribute in the <bpt id=\"p1\">[</bpt><ph id=\"ph2\">\\&lt;</ph>serviceCertificate&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/servicecertificate-of-clientcredentials-element.md)</ept> element to the fully-qualified domain name of the computer.","pos":[3278,3520],"source":" That is, change the `findValue` attribute in the [\\<serviceCertificate>](../../../../docs/framework/configure-apps/file-schema/wcf/servicecertificate-of-clientcredentials-element.md) element to the fully-qualified domain name of the computer."},{"content":"Copy the Service.cer file from the service directory to the client directory on the client computer.","pos":[3530,3630]},{"content":"On the client, open a Visual Studio command prompt with administrator privileges, and type <ph id=\"ph1\">`setup.bat client`</ph>.","pos":[3640,3750],"source":"On the client, open a Visual Studio command prompt with administrator privileges, and type `setup.bat client`."},{"content":"Running <ph id=\"ph1\">`setup.bat`</ph>with the <ph id=\"ph2\">`client`</ph> argument creates a client certificate named Client.com and exports the client certificate to a file named Client.cer.","pos":[3751,3905],"source":" Running `setup.bat`with the `client` argument creates a client certificate named Client.com and exports the client certificate to a file named Client.cer."},{"content":"In the client.cs file change the address value of the MEX endpoint and the <ph id=\"ph1\">`findValue`</ph> for setting the default server certificate to match the new address of your service.","pos":[3915,4086],"source":"In the client.cs file change the address value of the MEX endpoint and the `findValue` for setting the default server certificate to match the new address of your service."},{"content":"You do this by replacing localhost with the fully-qualified domain name of the server.","pos":[4087,4173]},{"content":"Rebuild.","pos":[4174,4182]},{"content":"Copy the Client.cer file from the client directory to the service directory on the server.","pos":[4192,4282]},{"content":"On the client, run ImportServiceCert.bat in a Visual Studio command prompt opened with administrator privileges.","pos":[4292,4404]},{"content":"This imports the service certificate from the Service.cer file into the CurrentUser - TrustedPeople store.","pos":[4405,4511]},{"content":"On the server, run ImportClientCert.bat in a Visual Studio command prompt opened with administrator privileges.","pos":[4521,4632]},{"content":"This imports the client certificate from the Client.cer file into the LocalMachine - TrustedPeople store.","pos":[4633,4738]},{"content":"On the service computer, build the service project in Visual Studio and run service.exe.","pos":[4747,4835]},{"content":"On the client computer, run client.exe.","pos":[4845,4884]},{"pos":[4898,5050],"content":"If the client and service are not able to communicate, see <bpt id=\"p1\">[</bpt>Troubleshooting Tips<ept id=\"p1\">](http://msdn.microsoft.com/en-us/8787c877-5e96-42da-8214-fa737a38f10b)</ept>.","source":"If the client and service are not able to communicate, see [Troubleshooting Tips](http://msdn.microsoft.com/en-us/8787c877-5e96-42da-8214-fa737a38f10b)."},{"pos":[5060,5088],"content":"To clean up after the sample","linkify":"To clean up after the sample","nodes":[{"content":"To clean up after the sample","pos":[0,28]}]},{"content":"Run Cleanup.bat in the samples folder once you have finished running the sample.","pos":[5098,5178]},{"pos":[5190,5753],"content":"[!NOTE]\nThis script does not remove service certificates on a client when running this sample across computers. If you have run [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] samples that use certificates across computers, be sure to clear the service certificates that have been installed in the CurrentUser - TrustedPeople store. To do this, use the following command: `certmgr -del -r CurrentUser -s TrustedPeople -c -n <Fully Qualified Server Machine Name>. For example: certmgr -del -r CurrentUser -s TrustedPeople -c -n server1.contoso.com`.","leadings":["","    >  "],"nodes":[{"content":"This script does not remove service certificates on a client when running this sample across computers. If you have run [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] samples that use certificates across computers, be sure to clear the service certificates that have been installed in the CurrentUser - TrustedPeople store. To do this, use the following command: `certmgr -del -r CurrentUser -s TrustedPeople -c -n <Fully Qualified Server Machine Name>. For example: certmgr -del -r CurrentUser -s TrustedPeople -c -n server1.contoso.com`.","pos":[8,556],"nodes":[{"content":"This script does not remove service certificates on a client when running this sample across computers.","pos":[0,103]},{"content":"If you have run <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> samples that use certificates across computers, be sure to clear the service certificates that have been installed in the CurrentUser - TrustedPeople store.","pos":[104,332],"source":" If you have run [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] samples that use certificates across computers, be sure to clear the service certificates that have been installed in the CurrentUser - TrustedPeople store."},{"content":"To do this, use the following command: <ph id=\"ph1\">`certmgr -del -r CurrentUser -s TrustedPeople -c -n &lt;Fully Qualified Server Machine Name&gt;. For example: certmgr -del -r CurrentUser -s TrustedPeople -c -n server1.contoso.com`</ph>.","pos":[333,548],"source":" To do this, use the following command: `certmgr -del -r CurrentUser -s TrustedPeople -c -n <Fully Qualified Server Machine Name>. For example: certmgr -del -r CurrentUser -s TrustedPeople -c -n server1.contoso.com`."}]}]},{"pos":[5762,5770],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[5774,5856],"content":"<bpt id=\"p1\">[</bpt>Using Metadata<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/using-metadata.md)</ept>","source":"[Using Metadata](../../../../docs/framework/wcf/feature-details/using-metadata.md)"}]}