{"content":"---\ntitle: \"Federation\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"WCF, federation\"\n  - \"federation [WCF]\"\nms.assetid: 2f1e646f-8361-48d4-9d5d-1b961f31ede4\n---\n# Federation\nThis topic provides a brief overview of the concept of federated security. It also describes Windows Communication Foundation (WCF) support for deploying federated security architectures. For a sample application that demonstrates federation, see [Federation Sample](../../../../docs/framework/wcf/samples/federation-sample.md).  \n  \n## Definition of Federated Security  \n Federated security allows for clean separation between the service a client is accessing and the associated authentication and authorization procedures. Federated security also enables collaboration across multiple systems, networks, and organizations in different trust realms.  \n  \n WCF provides support for building and deploying distributed systems that employ federated security.  \n  \n### Elements of a Federated Security Architecture  \n The federated security architecture has three key elements, as described in the following table.  \n  \n|Element|Description|  \n|-------------|-----------------|  \n|Domain/realm|A single unit of security administration or trust. A typical domain might include a single organization.|  \n|Federation|A collection of domains that have established trust. The level of trust may vary, but typically includes authentication and almost always includes authorization. A typical federation might include a number of organizations that have established trust for shared access to a set of resources.|  \n|Security Token Service (STS)|A Web service that issues security tokens; that is, it makes assertions based on evidence that it trusts, to whomever trusts it. This forms the basis of trust brokering between domains.|  \n  \n### Example Scenario  \n The following illustration shows an example of federated security.  \n  \n ![Federation](../../../../docs/framework/wcf/feature-details/media/typicalfederatedsecurityscenario.gif \"TypicalFederatedSecurityScenario\")  \n  \n This scenario includes two organizations: A and B. Organization B has a Web resource (a Web service) that some users in organization A find valuable.  \n  \n> [!NOTE]\n>  This section uses the terms *resource*, *service*, and *Web service* interchangeably.  \n  \n Typically, organization B requires that a user from organization A provide some valid form of authentication before accessing the service. In addition, the organization may also require that the user be authorized to access the specific resource in question. One way to address this problem and enable users in organization A to access the resource in organization B is as follows:  \n  \n-   Users from organization A register their credentials (a user name and password) with organization B.  \n  \n-   During the resource access, users from organization A present their credentials to organization B and are authenticated before accessing the resource.  \n  \n This approach has three significant drawbacks:  \n  \n-   Organization B has to manage the credentials for users from organization A in addition to managing the credentials of its local users.  \n  \n-   Users in organization A need to maintain an additional set of credentials (that is, remember an additional user name and password) apart from the credentials they normally use to gain access to resources within organization A. This usually encourages the practice of using the same user name and password at multiple service sites, which is a weak security measure.  \n  \n-   The architecture does not scale as more organizations perceive the resource at organization B as being of some value.  \n  \n An alternative approach, which addresses the previously mentioned drawbacks, is to employ federated security. In this approach, organizations A and B establish a trust relationship and employ Security Token Service (STS) to enable brokering of the established trust.  \n  \n In a federated security architecture, users from organization A know that if they want to access the Web service in organization B that they must present a valid security token from the STS at organization B, which authenticates and authorizes their access to the specific service.  \n  \n On contacting the STS B, the users receive another level of indirection from the policy associated with the STS. They must present a valid security token from the STS A (that is, the client trust realm) before the STS B can issue them a security token. This is a corollary of the trust relationship established between the two organizations and implies that organization B does not have to manage identities for users from organization A. In practice, STS B typically has a null `issuerAddress` and `issuerMetadataAddress`. For more information, see [How to: Configure a Local Issuer](../../../../docs/framework/wcf/feature-details/how-to-configure-a-local-issuer.md). In that case, the client consults a local policy to locate STS A. This configuration is called *home realm federation* and it scales better because STS B does not have to maintain information about STS A.  \n  \n The users then contact the STS at organization A and obtain a security token by presenting authentication credentials that they normally use to gain access to any other resource within organization A. This also alleviates the problem of users having to maintain multiple sets of credentials or using the same set of credentials at multiple service sites.  \n  \n Once the users obtain a security token from the STS A, they present the token to the STS B. Organization B proceeds to perform authorization of the users' requests and issues a security token to the users from its own set of security tokens. The users can then present their token to the resource at organization B and access the service.  \n  \n## Support for Federated Security in WCF  \n WCF provides turnkey support for deploying federated security architectures through the [\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md).  \n  \n The [\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) element provides for a secure, reliable, interoperable binding that entails the use of HTTP as the underlying transport mechanism for request-reply communication style, employing text and XML as the wire format for encoding.  \n  \n The use of [\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) in a federated security scenario can be decoupled into two logically independent phases, as described in the following sections.  \n  \n### Phase 1: Design Phase  \n During the design phase, the client uses the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to read the policy the service endpoint exposes and to collect the service's authentication and authorization requirements. The appropriate proxies are constructed to create the following federated security communication pattern at the client:  \n  \n-   Obtain a security token from the STS in the client trust realm.  \n  \n-   Present the token to the STS in the service trust realm.  \n  \n-   Obtain a security token from the STS in the service trust realm.  \n  \n-   Present the token to the service to access the service.  \n  \n### Phase 2: Run-Time Phase  \n During the run-time phase, the client instantiates an object of the WCF client class and makes a call using the WCF client. The underlying framework of WCF handles the previously mentioned steps in the federated security communication pattern and enables the client to seamlessly consume the service.  \n  \n## Sample Implementation Using WCF  \n The following illustration shows a sample implementation for a federated security architecture using native support from WCF.  \n  \n ![Federation security in WCF](../../../../docs/framework/wcf/feature-details/media/federatedsecurityinwcf.gif \"FederatedSecurityInWCF\")  \n  \n### Example MyService  \n The service `MyService` exposes a single endpoint through `MyServiceEndpoint`. The following illustration shows the address, binding, and contract associated with the endpoint.  \n  \n ![Federation](../../../../docs/framework/wcf/feature-details/media/myservice.gif \"MyService\")  \n  \n The service endpoint `MyServiceEndpoint` uses the [\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) and requires a valid Security Assertions Markup Language (SAML) token with an `accessAuthorized` claim issued by STS B. This is declaratively specified in the service configuration.  \n  \n```xml  \n<system.serviceModel>  \n  <services>  \n    <service type=\"FederationSample.MyService\"      \n        behaviorConfiguration='MyServiceBehavior'>  \n        <endpoint address=\"\"  \n            binding=\" wsFederationHttpBinding\"  \n            bindingConfiguration='MyServiceBinding'  \n            contract=\"Federation.IMyService\" />  \n   </service>  \n  </services>  \n  \n  <bindings>  \n    <wsFederationHttpBinding>  \n    <!-- This is the binding used by MyService. It redirects   \n    clients to STS-B. -->  \n      <binding name='MyServiceBinding'>  \n        <security mode=\"Message\">  \n           <message issuedTokenType=  \n\"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1\">  \n           <issuer address=\"http://localhost/FederationSample/STS-B/STS.svc\" />  \n            <issuerMetadata   \n           address=  \n\"http://localhost/FederationSample/STS-B/STS.svc/mex\" />  \n         <requiredClaimTypes>  \n            <add claimType=\"http://tempuri.org:accessAuthorized\" />  \n         </requiredClaimTypes>  \n        </message>  \n      </security>  \n      </binding>  \n    </wsFederationHttpBinding>  \n  </bindings>  \n  \n  <behaviors>  \n    <behavior name='MyServiceBehavior'>  \n      <serviceAuthorization   \noperationRequirementType=\"FederationSample.MyServiceOperationRequirement, MyService\" />  \n       <serviceCredentials>  \n         <serviceCertificate findValue=\"CN=FederationSample.com\"  \n         x509FindType=\"FindBySubjectDistinguishedName\"  \n         storeLocation='LocalMachine'  \n         storeName='My' />  \n      </serviceCredentials>  \n    </behavior>  \n  </behaviors>  \n</system.serviceModel>  \n```  \n  \n> [!NOTE]\n>  A subtle point should be noted about the claims required by `MyService`. The second figure indicates that `MyService` requires a SAML token with the `accessAuthorized` claim. To be more precise, this specifies the claim type that `MyService` requires. The fully-qualified name of this claim type is `http://tempuri.org:accessAuthorized` (along with the associated namespace), which is used in the service configuration file. The value of this claim indicates the presence of this claim and is assumed to be set to `true` by STS B.  \n  \n At runtime, this policy is enforced by the `MyServiceOperationRequirement` class that is implemented as part of the `MyService`.  \n  \n [!code-csharp[C_Federation#0](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_federation/cs/source.cs#0)]\n [!code-vb[C_Federation#0](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_federation/vb/source.vb#0)]  \n[!code-csharp[C_Federation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_federation/cs/source.cs#1)]\n[!code-vb[C_Federation#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_federation/vb/source.vb#1)]  \n  \n#### STS B  \n The following illustration shows the STS B. As stated earlier, a security token service (STS) is also a Web service and can have its associated endpoints, policy, and so on.  \n  \n ![Federation](../../../../docs/framework/wcf/feature-details/media/msservicestsb.gif \"MsServiceSTSB\")  \n  \n STS B exposes a single endpoint, called `STSEndpoint` that can be use to request security tokens. Specifically, STS B issues SAML tokens with the `accessAuthorized` claim, which can be presented at the `MyService` service site for accessing the service. However, STS B requires users to present a valid SAML token issued by STS A that contains the `userAuthenticated` claim. This is declaratively specified in the STS configuration.  \n  \n```xml  \n<system.serviceModel>  \n  <services>  \n    <service type=\"FederationSample.STS_B\" behaviorConfiguration=  \n     \"STS-B_Behavior\">  \n    <endpoint address=\"\"  \n              binding=\"wsFederationHttpBinding\"  \n              bindingConfiguration='STS-B_Binding'  \n      contract=\"FederationSample.ISts\" />  \n    </service>  \n  </services>  \n  <bindings>  \n    <wsFederationHttpBinding>  \n    <!-- This is the binding used by STS-B. It redirects clients to   \n         STS-A. -->  \n      <binding name='STS-B_Binding'>  \n        <security mode='Message'>  \n          <message issuedTokenType=\"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1\">  \n          <issuer address='http://localhost/FederationSample/STS-A/STS.svc' />  \n          <issuerMetadata address='http://localhost/FederationSample/STS-A/STS.svc/mex'/>  \n          <requiredClaimTypes>  \n            <add claimType='http://tempuri.org:userAuthenticated'/>  \n          </requiredClaimTypes>  \n          </message>  \n        </security>  \n    </binding>  \n   </wsFederationHttpBinding>  \n  </bindings>  \n  <behaviors>  \n  <behavior name='STS-B_Behavior'>  \n    <serviceAuthorization   operationRequirementType='FederationSample.STS_B_OperationRequirement, STS_B' />  \n    <serviceCredentials>  \n      <serviceCertificate findValue='CN=FederationSample.com'  \n      x509FindType='FindBySubjectDistinguishedName'  \n       storeLocation='LocalMachine'  \n       storeName='My' />  \n     </serviceCredentials>  \n   </behavior>  \n  </behaviors>  \n</system.serviceModel>  \n```  \n  \n> [!NOTE]\n>  Again, the `userAuthenticated` claim is the claim type that is required by STS B. The fully-qualified name of this claim type is `http://tempuri.org:userAuthenticated` (along with the associated namespace), which is used in the STS configuration file. The value of this claim indicates the presence of this claim and is assumed to be set to `true` by STS A.  \n  \n At runtime, the `STS_B_OperationRequirement` class enforces this policy, which is implemented as part of STS B.  \n  \n [!code-csharp[C_Federation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_federation/cs/source.cs#2)]\n [!code-vb[C_Federation#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_federation/vb/source.vb#2)]  \n  \n If the access check is clear, STS B issues a SAML token with the `accessAuthorized` claim.  \n  \n [!code-csharp[C_Federation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_federation/cs/source.cs#3)]\n [!code-vb[C_Federation#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_federation/vb/source.vb#3)]  \n  \n#### STS A  \n The following illustration shows the STS A.  \n  \n ![Federation](../../../../docs/framework/wcf/feature-details/media/sts-b.gif \"STS_B\")  \n  \n Similar to the STS B, the STS A is also a Web service that issues security tokens and exposes a single endpoint for this purpose. However, it uses a different binding (`wsHttpBinding`) and requires users to present a valid [!INCLUDE[infocard](../../../../includes/infocard-md.md)] with an `emailAddress` claim. In response, it issues SAML tokens with the `userAuthenticated` claim. This is declaratively specified in the service configuration.  \n  \n```xml  \n<system.serviceModel>  \n  <services>  \n    <service type=\"FederationSample.STS_A\" behaviorConfiguration=\"STS-A_Behavior\">  \n      <endpoint address=\"\"  \n                binding=\"wsHttpBinding\"  \n                bindingConfiguration=\"STS-A_Binding\"  \n                contract=\"FederationSample.ISts\">  \n       <identity>  \n       <certificateReference findValue=\"CN=FederationSample.com\"    \n                       x509FindType=\"FindBySubjectDistinguishedName\"  \n                       storeLocation=\"LocalMachine\"   \n                       storeName=\"My\" />  \n       </identity>  \n    <endpoint>  \n  </service>  \n</services>  \n  \n<bindings>  \n  <wsHttpBinding>  \n  <!-- This is the binding used by STS-A. It requires users to present  \n   a CardSpace. -->  \n    <binding name='STS-A_Binding'>  \n      <security mode='Message'>  \n        <message clientCredentialType=\"CardSpace\" />  \n      </security>  \n    </binding>  \n  </wsHttpBinding>  \n</bindings>  \n  \n<behaviors>  \n  <behavior name='STS-A_Behavior'>  \n    <serviceAuthorization operationRequirementType=  \n     \"FederationSample.STS_A_OperationRequirement, STS_A\" />  \n      <serviceCredentials>  \n  <serviceCertificate findValue=\"CN=FederationSample.com\"  \n                     x509FindType='FindBySubjectDistinguishedName'  \n                     storeLocation='LocalMachine'  \n                     storeName='My' />  \n      </serviceCredentials>  \n    </behavior>  \n  </behaviors>  \n</system.serviceModel>  \n```  \n  \n At runtime, the `STS_A_OperationRequirement` class enforces this policy, which is implemented as part of STS A.  \n  \n [!code-csharp[C_Federation#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_federation/cs/source.cs#4)]\n [!code-vb[C_Federation#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_federation/vb/source.vb#4)]  \n  \n If the access is `true`, STS A issues a SAML token with `userAuthenticated` claim.  \n  \n [!code-csharp[C_Federation#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_federation/cs/source.cs#5)]\n [!code-vb[C_Federation#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_federation/vb/source.vb#5)]  \n  \n### Client at Organization A  \n The following illustration shows the client at organization A, along with the steps involved in making a `MyService` service call. The other functional components are also included for completeness.  \n  \n ![Federation](../../../../docs/framework/wcf/feature-details/media/federationclienta.gif \"FederationClientA\")  \n  \n## Summary  \n Federated security provides a clean division of responsibility and helps to build secure, scalable service architectures. As a platform for building and deploying distributed applications, WCF provides native support for implementing federated security.  \n  \n## See also\n\n- [Security](../../../../docs/framework/wcf/feature-details/security.md)\n","nodes":[{"pos":[4,195],"embed":true,"restype":"x-metadata","content":"title: \"Federation\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"WCF, federation\"\n  - \"federation [WCF]\"\nms.assetid: 2f1e646f-8361-48d4-9d5d-1b961f31ede4","nodes":[{"content":"Federation","nodes":[{"pos":[0,10],"content":"Federation","nodes":[{"content":"Federation","pos":[0,10]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[202,212],"content":"Federation","linkify":"Federation","nodes":[{"content":"Federation","pos":[0,10]}]},{"content":"This topic provides a brief overview of the concept of federated security.","pos":[213,287]},{"content":"It also describes Windows Communication Foundation (WCF) support for deploying federated security architectures.","pos":[288,400]},{"content":"For a sample application that demonstrates federation, see <bpt id=\"p1\">[</bpt>Federation Sample<ept id=\"p1\">](../../../../docs/framework/wcf/samples/federation-sample.md)</ept>.","pos":[401,541],"source":" For a sample application that demonstrates federation, see [Federation Sample](../../../../docs/framework/wcf/samples/federation-sample.md)."},{"pos":[550,582],"content":"Definition of Federated Security","linkify":"Definition of Federated Security","nodes":[{"content":"Definition of Federated Security","pos":[0,32]}]},{"content":"Federated security allows for clean separation between the service a client is accessing and the associated authentication and authorization procedures.","pos":[586,738]},{"content":"Federated security also enables collaboration across multiple systems, networks, and organizations in different trust realms.","pos":[739,864]},{"content":"WCF provides support for building and deploying distributed systems that employ federated security.","pos":[871,970]},{"pos":[980,1025],"content":"Elements of a Federated Security Architecture","linkify":"Elements of a Federated Security Architecture","nodes":[{"content":"Elements of a Federated Security Architecture","pos":[0,45]}]},{"content":"The federated security architecture has three key elements, as described in the following table.","pos":[1029,1125]},{"content":"Element","pos":[1132,1139]},{"content":"Description","pos":[1140,1151]},{"content":"Domain/realm","pos":[1192,1204]},{"content":"A single unit of security administration or trust.","pos":[1205,1255]},{"content":"A typical domain might include a single organization.","pos":[1256,1309]},{"content":"Federation","pos":[1314,1324]},{"content":"A collection of domains that have established trust.","pos":[1325,1377]},{"content":"The level of trust may vary, but typically includes authentication and almost always includes authorization.","pos":[1378,1486]},{"content":"A typical federation might include a number of organizations that have established trust for shared access to a set of resources.","pos":[1487,1616]},{"content":"Security Token Service (STS)","pos":[1621,1649]},{"content":"A Web service that issues security tokens; that is, it makes assertions based on evidence that it trusts, to whomever trusts it.","pos":[1650,1778]},{"content":"This forms the basis of trust brokering between domains.","pos":[1779,1835]},{"pos":[1846,1862],"content":"Example Scenario","linkify":"Example Scenario","nodes":[{"content":"Example Scenario","pos":[0,16]}]},{"content":"The following illustration shows an example of federated security.","pos":[1866,1932]},{"pos":[1939,2078],"content":"<bpt id=\"p1\">![</bpt>Federation<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wcf/feature-details/media/typicalfederatedsecurityscenario.gif \"</bpt>TypicalFederatedSecurityScenario<ept id=\"p2\">\")</ept>","source":"![Federation](../../../../docs/framework/wcf/feature-details/media/typicalfederatedsecurityscenario.gif \"TypicalFederatedSecurityScenario\")"},{"content":"This scenario includes two organizations: A and B. Organization B has a Web resource (a Web service) that some users in organization A find valuable.","pos":[2085,2234]},{"pos":[2242,2338],"content":"[!NOTE]\n This section uses the terms *resource*, *service*, and *Web service* interchangeably.","leadings":["","> "],"nodes":[{"content":"This section uses the terms <bpt id=\"p1\">*</bpt>resource<ept id=\"p1\">*</ept>, <bpt id=\"p2\">*</bpt>service<ept id=\"p2\">*</ept>, and <bpt id=\"p3\">*</bpt>Web service<ept id=\"p3\">*</ept> interchangeably.","pos":[9,94],"source":"This section uses the terms *resource*, *service*, and *Web service* interchangeably."}]},{"content":"Typically, organization B requires that a user from organization A provide some valid form of authentication before accessing the service.","pos":[2345,2483]},{"content":"In addition, the organization may also require that the user be authorized to access the specific resource in question.","pos":[2484,2603]},{"content":"One way to address this problem and enable users in organization A to access the resource in organization B is as follows:","pos":[2604,2726]},{"content":"Users from organization A register their credentials (a user name and password) with organization B.","pos":[2736,2836]},{"content":"During the resource access, users from organization A present their credentials to organization B and are authenticated before accessing the resource.","pos":[2846,2996]},{"content":"This approach has three significant drawbacks:","pos":[3003,3049]},{"content":"Organization B has to manage the credentials for users from organization A in addition to managing the credentials of its local users.","pos":[3059,3193]},{"content":"Users in organization A need to maintain an additional set of credentials (that is, remember an additional user name and password) apart from the credentials they normally use to gain access to resources within organization A. This usually encourages the practice of using the same user name and password at multiple service sites, which is a weak security measure.","pos":[3203,3568]},{"content":"The architecture does not scale as more organizations perceive the resource at organization B as being of some value.","pos":[3578,3695]},{"content":"An alternative approach, which addresses the previously mentioned drawbacks, is to employ federated security.","pos":[3702,3811]},{"content":"In this approach, organizations A and B establish a trust relationship and employ Security Token Service (STS) to enable brokering of the established trust.","pos":[3812,3968]},{"content":"In a federated security architecture, users from organization A know that if they want to access the Web service in organization B that they must present a valid security token from the STS at organization B, which authenticates and authorizes their access to the specific service.","pos":[3975,4256]},{"content":"On contacting the STS B, the users receive another level of indirection from the policy associated with the STS.","pos":[4263,4375]},{"content":"They must present a valid security token from the STS A (that is, the client trust realm) before the STS B can issue them a security token.","pos":[4376,4515]},{"content":"This is a corollary of the trust relationship established between the two organizations and implies that organization B does not have to manage identities for users from organization A. In practice, STS B typically has a null <ph id=\"ph1\">`issuerAddress`</ph> and <ph id=\"ph2\">`issuerMetadataAddress`</ph>.","pos":[4516,4786],"source":" This is a corollary of the trust relationship established between the two organizations and implies that organization B does not have to manage identities for users from organization A. In practice, STS B typically has a null `issuerAddress` and `issuerMetadataAddress`."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>How to: Configure a Local Issuer<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-configure-a-local-issuer.md)</ept>.","pos":[4787,4931],"source":" For more information, see [How to: Configure a Local Issuer](../../../../docs/framework/wcf/feature-details/how-to-configure-a-local-issuer.md)."},{"content":"In that case, the client consults a local policy to locate STS A. This configuration is called <bpt id=\"p1\">*</bpt>home realm federation<ept id=\"p1\">*</ept> and it scales better because STS B does not have to maintain information about STS A.","pos":[4932,5136],"source":" In that case, the client consults a local policy to locate STS A. This configuration is called *home realm federation* and it scales better because STS B does not have to maintain information about STS A."},{"content":"The users then contact the STS at organization A and obtain a security token by presenting authentication credentials that they normally use to gain access to any other resource within organization A. This also alleviates the problem of users having to maintain multiple sets of credentials or using the same set of credentials at multiple service sites.","pos":[5143,5497]},{"content":"Once the users obtain a security token from the STS A, they present the token to the STS B. Organization B proceeds to perform authorization of the users' requests and issues a security token to the users from its own set of security tokens.","pos":[5504,5745]},{"content":"The users can then present their token to the resource at organization B and access the service.","pos":[5746,5842]},{"pos":[5851,5888],"content":"Support for Federated Security in WCF","linkify":"Support for Federated Security in WCF","nodes":[{"content":"Support for Federated Security in WCF","pos":[0,37]}]},{"pos":[5892,6095],"content":"WCF provides turnkey support for deploying federated security architectures through the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>wsFederationHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)</ept>.","source":"WCF provides turnkey support for deploying federated security architectures through the [\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)."},{"pos":[6102,6445],"content":"The <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>wsFederationHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)</ept> element provides for a secure, reliable, interoperable binding that entails the use of HTTP as the underlying transport mechanism for request-reply communication style, employing text and XML as the wire format for encoding.","source":"The [\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) element provides for a secure, reliable, interoperable binding that entails the use of HTTP as the underlying transport mechanism for request-reply communication style, employing text and XML as the wire format for encoding."},{"pos":[6452,6706],"content":"The use of <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>wsFederationHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)</ept> in a federated security scenario can be decoupled into two logically independent phases, as described in the following sections.","source":"The use of [\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) in a federated security scenario can be decoupled into two logically independent phases, as described in the following sections."},{"pos":[6716,6737],"content":"Phase 1: Design Phase","linkify":"Phase 1: Design Phase","nodes":[{"content":"Phase 1: Design Phase","pos":[0,21]}]},{"content":"During the design phase, the client uses the <bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept> to read the policy the service endpoint exposes and to collect the service's authentication and authorization requirements.","pos":[6741,7042],"source":"During the design phase, the client uses the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to read the policy the service endpoint exposes and to collect the service's authentication and authorization requirements."},{"content":"The appropriate proxies are constructed to create the following federated security communication pattern at the client:","pos":[7043,7162]},{"content":"Obtain a security token from the STS in the client trust realm.","pos":[7172,7235]},{"content":"Present the token to the STS in the service trust realm.","pos":[7245,7301]},{"content":"Obtain a security token from the STS in the service trust realm.","pos":[7311,7375]},{"content":"Present the token to the service to access the service.","pos":[7385,7440]},{"pos":[7450,7473],"content":"Phase 2: Run-Time Phase","linkify":"Phase 2: Run-Time Phase","nodes":[{"content":"Phase 2: Run-Time Phase","pos":[0,23]}]},{"content":"During the run-time phase, the client instantiates an object of the WCF client class and makes a call using the WCF client.","pos":[7477,7600]},{"content":"The underlying framework of WCF handles the previously mentioned steps in the federated security communication pattern and enables the client to seamlessly consume the service.","pos":[7601,7777]},{"pos":[7786,7817],"content":"Sample Implementation Using WCF","linkify":"Sample Implementation Using WCF","nodes":[{"content":"Sample Implementation Using WCF","pos":[0,31]}]},{"content":"The following illustration shows a sample implementation for a federated security architecture using native support from WCF.","pos":[7821,7946]},{"pos":[7953,8088],"content":"<bpt id=\"p1\">![</bpt>Federation security in WCF<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wcf/feature-details/media/federatedsecurityinwcf.gif \"</bpt>FederatedSecurityInWCF<ept id=\"p2\">\")</ept>","source":"![Federation security in WCF](../../../../docs/framework/wcf/feature-details/media/federatedsecurityinwcf.gif \"FederatedSecurityInWCF\")"},{"pos":[8098,8115],"content":"Example MyService","linkify":"Example MyService","nodes":[{"content":"Example MyService","pos":[0,17]}]},{"content":"The service <ph id=\"ph1\">`MyService`</ph> exposes a single endpoint through <ph id=\"ph2\">`MyServiceEndpoint`</ph>.","pos":[8119,8197],"source":"The service `MyService` exposes a single endpoint through `MyServiceEndpoint`."},{"content":"The following illustration shows the address, binding, and contract associated with the endpoint.","pos":[8198,8295]},{"pos":[8302,8395],"content":"<bpt id=\"p1\">![</bpt>Federation<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wcf/feature-details/media/myservice.gif \"</bpt>MyService<ept id=\"p2\">\")</ept>","source":"![Federation](../../../../docs/framework/wcf/feature-details/media/myservice.gif \"MyService\")"},{"pos":[8402,8748],"content":"The service endpoint <ph id=\"ph1\">`MyServiceEndpoint`</ph> uses the <bpt id=\"p1\">[</bpt><ph id=\"ph2\">\\&lt;</ph>wsFederationHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)</ept> and requires a valid Security Assertions Markup Language (SAML) token with an <ph id=\"ph3\">`accessAuthorized`</ph> claim issued by STS B. This is declaratively specified in the service configuration.","source":"The service endpoint `MyServiceEndpoint` uses the [\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) and requires a valid Security Assertions Markup Language (SAML) token with an `accessAuthorized` claim issued by STS B. This is declaratively specified in the service configuration."},{"pos":[10405,10946],"content":"[!NOTE]\n A subtle point should be noted about the claims required by `MyService`. The second figure indicates that `MyService` requires a SAML token with the `accessAuthorized` claim. To be more precise, this specifies the claim type that `MyService` requires. The fully-qualified name of this claim type is `http://tempuri.org:accessAuthorized` (along with the associated namespace), which is used in the service configuration file. The value of this claim indicates the presence of this claim and is assumed to be set to `true` by STS B.","leadings":["","> "],"nodes":[{"content":"A subtle point should be noted about the claims required by `MyService`. The second figure indicates that `MyService` requires a SAML token with the `accessAuthorized` claim. To be more precise, this specifies the claim type that `MyService` requires. The fully-qualified name of this claim type is `http://tempuri.org:accessAuthorized` (along with the associated namespace), which is used in the service configuration file. The value of this claim indicates the presence of this claim and is assumed to be set to `true` by STS B.","pos":[9,539],"nodes":[{"content":"A subtle point should be noted about the claims required by <ph id=\"ph1\">`MyService`</ph>.","pos":[0,72],"source":"A subtle point should be noted about the claims required by `MyService`."},{"content":"The second figure indicates that <ph id=\"ph1\">`MyService`</ph> requires a SAML token with the <ph id=\"ph2\">`accessAuthorized`</ph> claim.","pos":[73,174],"source":" The second figure indicates that `MyService` requires a SAML token with the `accessAuthorized` claim."},{"content":"To be more precise, this specifies the claim type that <ph id=\"ph1\">`MyService`</ph> requires.","pos":[175,251],"source":" To be more precise, this specifies the claim type that `MyService` requires."},{"content":"The fully-qualified name of this claim type is <ph id=\"ph1\">`http://tempuri.org:accessAuthorized`</ph> (along with the associated namespace), which is used in the service configuration file.","pos":[252,424],"source":" The fully-qualified name of this claim type is `http://tempuri.org:accessAuthorized` (along with the associated namespace), which is used in the service configuration file."},{"content":"The value of this claim indicates the presence of this claim and is assumed to be set to <ph id=\"ph1\">`true`</ph> by STS B.","pos":[425,530],"source":" The value of this claim indicates the presence of this claim and is assumed to be set to `true` by STS B."}]}]},{"pos":[10953,11081],"content":"At runtime, this policy is enforced by the <ph id=\"ph1\">`MyServiceOperationRequirement`</ph> class that is implemented as part of the <ph id=\"ph2\">`MyService`</ph>.","source":"At runtime, this policy is enforced by the `MyServiceOperationRequirement` class that is implemented as part of the `MyService`."},{"pos":[11551,11556],"content":"STS B","linkify":"STS B","nodes":[{"content":"STS B","pos":[0,5]}]},{"content":"The following illustration shows the STS B. As stated earlier, a security token service (STS) is also a Web service and can have its associated endpoints, policy, and so on.","pos":[11560,11733]},{"pos":[11740,11841],"content":"<bpt id=\"p1\">![</bpt>Federation<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wcf/feature-details/media/msservicestsb.gif \"</bpt>MsServiceSTSB<ept id=\"p2\">\")</ept>","source":"![Federation](../../../../docs/framework/wcf/feature-details/media/msservicestsb.gif \"MsServiceSTSB\")"},{"content":"STS B exposes a single endpoint, called <ph id=\"ph1\">`STSEndpoint`</ph> that can be use to request security tokens.","pos":[11848,11945],"source":"STS B exposes a single endpoint, called `STSEndpoint` that can be use to request security tokens."},{"content":"Specifically, STS B issues SAML tokens with the <ph id=\"ph1\">`accessAuthorized`</ph> claim, which can be presented at the <ph id=\"ph2\">`MyService`</ph> service site for accessing the service.","pos":[11946,12101],"source":" Specifically, STS B issues SAML tokens with the `accessAuthorized` claim, which can be presented at the `MyService` service site for accessing the service."},{"content":"However, STS B requires users to present a valid SAML token issued by STS A that contains the <ph id=\"ph1\">`userAuthenticated`</ph> claim.","pos":[12102,12222],"source":" However, STS B requires users to present a valid SAML token issued by STS A that contains the `userAuthenticated` claim."},{"content":"This is declaratively specified in the STS configuration.","pos":[12223,12280]},{"pos":[13855,14223],"content":"[!NOTE]\n Again, the `userAuthenticated` claim is the claim type that is required by STS B. The fully-qualified name of this claim type is `http://tempuri.org:userAuthenticated` (along with the associated namespace), which is used in the STS configuration file. The value of this claim indicates the presence of this claim and is assumed to be set to `true` by STS A.","leadings":["","> "],"nodes":[{"content":"Again, the `userAuthenticated` claim is the claim type that is required by STS B. The fully-qualified name of this claim type is `http://tempuri.org:userAuthenticated` (along with the associated namespace), which is used in the STS configuration file. The value of this claim indicates the presence of this claim and is assumed to be set to `true` by STS A.","pos":[9,366],"nodes":[{"content":"Again, the <ph id=\"ph1\">`userAuthenticated`</ph> claim is the claim type that is required by STS B. The fully-qualified name of this claim type is <ph id=\"ph2\">`http://tempuri.org:userAuthenticated`</ph> (along with the associated namespace), which is used in the STS configuration file.","pos":[0,251],"source":"Again, the `userAuthenticated` claim is the claim type that is required by STS B. The fully-qualified name of this claim type is `http://tempuri.org:userAuthenticated` (along with the associated namespace), which is used in the STS configuration file."},{"content":"The value of this claim indicates the presence of this claim and is assumed to be set to <ph id=\"ph1\">`true`</ph> by STS A.","pos":[252,357],"source":" The value of this claim indicates the presence of this claim and is assumed to be set to `true` by STS A."}]}]},{"pos":[14230,14341],"content":"At runtime, the <ph id=\"ph1\">`STS_B_OperationRequirement`</ph> class enforces this policy, which is implemented as part of STS B.","source":"At runtime, the `STS_B_OperationRequirement` class enforces this policy, which is implemented as part of STS B."},{"pos":[14580,14670],"content":"If the access check is clear, STS B issues a SAML token with the <ph id=\"ph1\">`accessAuthorized`</ph> claim.","source":"If the access check is clear, STS B issues a SAML token with the `accessAuthorized` claim."},{"pos":[14913,14918],"content":"STS A","linkify":"STS A","nodes":[{"content":"STS A","pos":[0,5]}]},{"content":"The following illustration shows the STS A.","pos":[14922,14965]},{"pos":[14972,15057],"content":"<bpt id=\"p1\">![</bpt>Federation<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wcf/feature-details/media/sts-b.gif \"</bpt>STS_B<ept id=\"p2\">\")</ept>","source":"![Federation](../../../../docs/framework/wcf/feature-details/media/sts-b.gif \"STS_B\")"},{"content":"Similar to the STS B, the STS A is also a Web service that issues security tokens and exposes a single endpoint for this purpose.","pos":[15064,15193]},{"content":"However, it uses a different binding (<ph id=\"ph1\">`wsHttpBinding`</ph>) and requires users to present a valid <ph id=\"ph2\">[!INCLUDE[infocard](../../../../includes/infocard-md.md)]</ph> with an <ph id=\"ph3\">`emailAddress`</ph> claim.","pos":[15194,15374],"source":" However, it uses a different binding (`wsHttpBinding`) and requires users to present a valid [!INCLUDE[infocard](../../../../includes/infocard-md.md)] with an `emailAddress` claim."},{"content":"In response, it issues SAML tokens with the <ph id=\"ph1\">`userAuthenticated`</ph> claim.","pos":[15375,15445],"source":" In response, it issues SAML tokens with the `userAuthenticated` claim."},{"content":"This is declaratively specified in the service configuration.","pos":[15446,15507]},{"pos":[17000,17111],"content":"At runtime, the <ph id=\"ph1\">`STS_A_OperationRequirement`</ph> class enforces this policy, which is implemented as part of STS A.","source":"At runtime, the `STS_A_OperationRequirement` class enforces this policy, which is implemented as part of STS A."},{"pos":[17350,17432],"content":"If the access is <ph id=\"ph1\">`true`</ph>, STS A issues a SAML token with <ph id=\"ph2\">`userAuthenticated`</ph> claim.","source":"If the access is `true`, STS A issues a SAML token with `userAuthenticated` claim."},{"pos":[17674,17698],"content":"Client at Organization A","linkify":"Client at Organization A","nodes":[{"content":"Client at Organization A","pos":[0,24]}]},{"content":"The following illustration shows the client at organization A, along with the steps involved in making a <ph id=\"ph1\">`MyService`</ph> service call.","pos":[17702,17832],"source":"The following illustration shows the client at organization A, along with the steps involved in making a `MyService` service call."},{"content":"The other functional components are also included for completeness.","pos":[17833,17900]},{"pos":[17907,18016],"content":"<bpt id=\"p1\">![</bpt>Federation<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wcf/feature-details/media/federationclienta.gif \"</bpt>FederationClientA<ept id=\"p2\">\")</ept>","source":"![Federation](../../../../docs/framework/wcf/feature-details/media/federationclienta.gif \"FederationClientA\")"},{"pos":[18025,18032],"content":"Summary","linkify":"Summary","nodes":[{"content":"Summary","pos":[0,7]}]},{"content":"Federated security provides a clean division of responsibility and helps to build secure, scalable service architectures.","pos":[18036,18157]},{"content":"As a platform for building and deploying distributed applications, WCF provides native support for implementing federated security.","pos":[18158,18289]},{"pos":[18298,18306],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[18310,18380],"content":"<bpt id=\"p1\">[</bpt>Security<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/security.md)</ept>","source":"[Security](../../../../docs/framework/wcf/feature-details/security.md)"}]}