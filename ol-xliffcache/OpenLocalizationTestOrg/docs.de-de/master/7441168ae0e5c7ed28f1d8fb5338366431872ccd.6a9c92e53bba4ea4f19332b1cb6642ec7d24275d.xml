{"content":"---\ntitle: \"How to: Create a Duplex Contract | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\n  - \"CSharp\"\nhelpviewer_keywords: \n  - \"duplex contracts [WCF]\"\nms.assetid: 500a75b6-998a-47d5-8e3b-24e3aba2a434\ncaps.latest.revision: 28\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# How to: Create a Duplex Contract\nThis topic shows the basic steps to create methods that use a duplex (two-way) contract. A duplex contract allows clients and servers to communicate with each other independently so that either can initiate calls to the other. The duplex contract is one of three message patterns available to [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] services. The other two message patterns are one-way and request-reply. A duplex contract consists of two one-way contracts between the client and the server and does not require that the method calls be correlated. Use this kind of contract when your service must query the client for more information or explicitly raise events on the client. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] creating a client application for a duplex contract, see [How to: Access Services with a Duplex Contract](../../../../docs/framework/wcf/feature-details/how-to-access-services-with-a-duplex-contract.md). For a working sample, see the [Duplex](../../../../docs/framework/wcf/samples/duplex.md) sample.  \n  \n### To create a duplex contract  \n  \n1.  Create the interface that makes up the server side of the duplex contract.  \n  \n2.  Apply the <xref:System.ServiceModel.ServiceContractAttribute> class to the interface.  \n  \n     [!code-csharp[S_WS_DualHttp#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ws_dualhttp/cs/service.cs#3)]\n     [!code-vb[S_WS_DualHttp#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_ws_dualhttp/vb/service.vb#3)]  \n  \n3.  Declare the method signatures in the interface.  \n  \n4.  Apply the <xref:System.ServiceModel.OperationContractAttribute> class to each method signature that must be part of the public contract.  \n  \n5.  Create the callback interface that defines the set of operations that the service can invoke on the client.  \n  \n     [!code-csharp[S_WS_DualHttp#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ws_dualhttp/cs/service.cs#4)]\n     [!code-vb[S_WS_DualHttp#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_ws_dualhttp/vb/service.vb#4)]  \n  \n6.  Declare the method signatures in the callback interface.  \n  \n7.  Apply the <xref:System.ServiceModel.OperationContractAttribute> class to each method signature that must be part of the public contract.  \n  \n8.  Link the two interfaces into a duplex contract by setting the <xref:System.ServiceModel.ServiceContractAttribute.CallbackContract%2A> property in the primary interface to the type of the callback interface.  \n  \n### To call methods on the client  \n  \n1.  In the service's implementation of the primary contract, declare a variable for the callback interface.  \n  \n2.  Set the variable to the object reference returned by the <xref:System.ServiceModel.OperationContext.GetCallbackChannel%2A> method of the <xref:System.ServiceModel.OperationContext> class.  \n  \n     [!code-csharp[S_WS_DualHttp#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ws_dualhttp/cs/service.cs#1)]\n     [!code-vb[S_WS_DualHttp#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_ws_dualhttp/vb/service.vb#1)]  \n  \n     [!code-csharp[S_WS_DualHttp#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ws_dualhttp/cs/service.cs#2)]\n     [!code-vb[S_WS_DualHttp#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_ws_dualhttp/vb/service.vb#2)]  \n  \n3.  Call the methods defined by the callback interface.  \n  \n## Example  \n The following code example demonstrates duplex communication. The service’s contract contains service operations for moving forward and backward. The client’s contract contains a service operation for reporting its position.  \n  \n [!code-csharp[S_WS_DualHttp#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ws_dualhttp/cs/service.cs#5)]\n [!code-vb[S_WS_DualHttp#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_ws_dualhttp/vb/service.vb#5)]  \n  \n-   Applying the <xref:System.ServiceModel.ServiceContractAttribute> and <xref:System.ServiceModel.OperationContractAttribute> attributes allows the automatic generation of service contract definitions in the Web Services Description Language (WSDL).  \n  \n-   Use the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to retrieve the WSDL document and (optional) code and configuration for a client.  \n  \n-   Endpoints exposing duplex services must be secured. When a service receives a duplex message, it looks at the ReplyTo in that incoming message to determine where to send the reply. If the channel is not secured, then an untrusted client could send a malicious message with a target machine's ReplyTo, leading to a denial of service of the target machine. With regular request-reply messages, this is not an issue, because the ReplyTo is ignored and the response is sent on the channel the original message came in on.  \n  \n## See Also  \n <xref:System.ServiceModel.ServiceContractAttribute>   \n <xref:System.ServiceModel.OperationContractAttribute>   \n [How to: Access Services with a Duplex Contract](../../../../docs/framework/wcf/feature-details/how-to-access-services-with-a-duplex-contract.md)   \n [Duplex](../../../../docs/framework/wcf/samples/duplex.md)   \n [Designing and Implementing Services](../../../../docs/framework/wcf/designing-and-implementing-services.md)   \n [How to: Define a Service Contract](../../../../docs/framework/wcf/how-to-define-a-wcf-service-contract.md)   \n [Session](../../../../docs/framework/wcf/samples/session.md)","nodes":[{"pos":[4,438],"nodes":[{"content":"How to: Create a Duplex Contract | Microsoft Docs","nodes":[{"pos":[0,49],"content":"How to: Create a Duplex Contract | Microsoft Docs","nodes":[{"content":"How to: Create a Duplex Contract | Microsoft Docs","pos":[0,49]}]}],"pos":[6,58],"yaml":true}],"content":"title: \"How to: Create a Duplex Contract | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\n  - \"CSharp\"\nhelpviewer_keywords: \n  - \"duplex contracts [WCF]\"\nms.assetid: 500a75b6-998a-47d5-8e3b-24e3aba2a434\ncaps.latest.revision: 28\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"","yamlblock":true},{"pos":[445,477],"content":"How to: Create a Duplex Contract","linkify":"How to: Create a Duplex Contract","nodes":[{"content":"How to: Create a Duplex Contract","pos":[0,32]}]},{"content":"This topic shows the basic steps to create methods that use a duplex (two-way) contract.","pos":[478,566]},{"content":"A duplex contract allows clients and servers to communicate with each other independently so that either can initiate calls to the other.","pos":[567,704]},{"content":"The duplex contract is one of three message patterns available to <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> services.","pos":[705,836],"source":" The duplex contract is one of three message patterns available to [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] services."},{"content":"The other two message patterns are one-way and request-reply.","pos":[837,898]},{"content":"A duplex contract consists of two one-way contracts between the client and the server and does not require that the method calls be correlated.","pos":[899,1042]},{"content":"Use this kind of contract when your service must query the client for more information or explicitly raise events on the client.","pos":[1043,1171]},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> creating a client application for a duplex contract, see <bpt id=\"p1\">[</bpt>How to: Access Services with a Duplex Contract<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-access-services-with-a-duplex-contract.md)</ept>.","pos":[1172,1431],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] creating a client application for a duplex contract, see [How to: Access Services with a Duplex Contract](../../../../docs/framework/wcf/feature-details/how-to-access-services-with-a-duplex-contract.md)."},{"content":"For a working sample, see the <bpt id=\"p1\">[</bpt>Duplex<ept id=\"p1\">](../../../../docs/framework/wcf/samples/duplex.md)</ept> sample.","pos":[1432,1528],"source":" For a working sample, see the [Duplex](../../../../docs/framework/wcf/samples/duplex.md) sample."},{"pos":[1538,1565],"content":"To create a duplex contract","linkify":"To create a duplex contract","nodes":[{"content":"To create a duplex contract","pos":[0,27]}]},{"content":"Create the interface that makes up the server side of the duplex contract.","pos":[1575,1649]},{"content":"Apply the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceContractAttribute&gt;</ph> class to the interface.","pos":[1659,1744],"source":"Apply the <xref:System.ServiceModel.ServiceContractAttribute> class to the interface."},{"pos":[1755,1990],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>S_WS_DualHttp#3<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ws_dualhttp/cs/service.cs#3)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>S_WS_DualHttp#3<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_ws_dualhttp/vb/service.vb#3)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[S_WS_DualHttp#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ws_dualhttp/cs/service.cs#3)]\n [!code-vb[S_WS_DualHttp#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_ws_dualhttp/vb/service.vb#3)]"},{"content":"Declare the method signatures in the interface.","pos":[2000,2047]},{"content":"Apply the <ph id=\"ph1\">&lt;xref:System.ServiceModel.OperationContractAttribute&gt;</ph> class to each method signature that must be part of the public contract.","pos":[2057,2193],"source":"Apply the <xref:System.ServiceModel.OperationContractAttribute> class to each method signature that must be part of the public contract."},{"content":"Create the callback interface that defines the set of operations that the service can invoke on the client.","pos":[2203,2310]},{"pos":[2321,2556],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>S_WS_DualHttp#4<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ws_dualhttp/cs/service.cs#4)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>S_WS_DualHttp#4<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_ws_dualhttp/vb/service.vb#4)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[S_WS_DualHttp#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ws_dualhttp/cs/service.cs#4)]\n [!code-vb[S_WS_DualHttp#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_ws_dualhttp/vb/service.vb#4)]"},{"content":"Declare the method signatures in the callback interface.","pos":[2566,2622]},{"content":"Apply the <ph id=\"ph1\">&lt;xref:System.ServiceModel.OperationContractAttribute&gt;</ph> class to each method signature that must be part of the public contract.","pos":[2632,2768],"source":"Apply the <xref:System.ServiceModel.OperationContractAttribute> class to each method signature that must be part of the public contract."},{"content":"Link the two interfaces into a duplex contract by setting the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceContractAttribute.CallbackContract%2A&gt;</ph> property in the primary interface to the type of the callback interface.","pos":[2778,2984],"source":"Link the two interfaces into a duplex contract by setting the <xref:System.ServiceModel.ServiceContractAttribute.CallbackContract%2A> property in the primary interface to the type of the callback interface."},{"pos":[2994,3023],"content":"To call methods on the client","linkify":"To call methods on the client","nodes":[{"content":"To call methods on the client","pos":[0,29]}]},{"content":"In the service's implementation of the primary contract, declare a variable for the callback interface.","pos":[3033,3136]},{"content":"Set the variable to the object reference returned by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.OperationContext.GetCallbackChannel%2A&gt;</ph> method of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.OperationContext&gt;</ph> class.","pos":[3146,3333],"source":"Set the variable to the object reference returned by the <xref:System.ServiceModel.OperationContext.GetCallbackChannel%2A> method of the <xref:System.ServiceModel.OperationContext> class."},{"pos":[3344,3579],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>S_WS_DualHttp#1<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ws_dualhttp/cs/service.cs#1)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>S_WS_DualHttp#1<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_ws_dualhttp/vb/service.vb#1)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[S_WS_DualHttp#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ws_dualhttp/cs/service.cs#1)]\n [!code-vb[S_WS_DualHttp#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_ws_dualhttp/vb/service.vb#1)]"},{"pos":[3590,3825],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>S_WS_DualHttp#2<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ws_dualhttp/cs/service.cs#2)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>S_WS_DualHttp#2<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_ws_dualhttp/vb/service.vb#2)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[S_WS_DualHttp#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ws_dualhttp/cs/service.cs#2)]\n [!code-vb[S_WS_DualHttp#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_ws_dualhttp/vb/service.vb#2)]"},{"content":"Call the methods defined by the callback interface.","pos":[3835,3886]},{"pos":[3895,3902],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following code example demonstrates duplex communication.","pos":[3906,3967]},{"content":"The service’s contract contains service operations for moving forward and backward.","pos":[3968,4051]},{"content":"The client’s contract contains a service operation for reporting its position.","pos":[4052,4130]},{"pos":[4137,4368],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>S_WS_DualHttp#5<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ws_dualhttp/cs/service.cs#5)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>S_WS_DualHttp#5<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_ws_dualhttp/vb/service.vb#5)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[S_WS_DualHttp#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ws_dualhttp/cs/service.cs#5)]\n [!code-vb[S_WS_DualHttp#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_ws_dualhttp/vb/service.vb#5)]"},{"content":"Applying the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceContractAttribute&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.OperationContractAttribute&gt;</ph> attributes allows the automatic generation of service contract definitions in the Web Services Description Language (WSDL).","pos":[4378,4624],"source":"Applying the <xref:System.ServiceModel.ServiceContractAttribute> and <xref:System.ServiceModel.OperationContractAttribute> attributes allows the automatic generation of service contract definitions in the Web Services Description Language (WSDL)."},{"pos":[4634,4856],"content":"Use the <bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept> to retrieve the WSDL document and (optional) code and configuration for a client.","source":"Use the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to retrieve the WSDL document and (optional) code and configuration for a client."},{"content":"Endpoints exposing duplex services must be secured.","pos":[4866,4917]},{"content":"When a service receives a duplex message, it looks at the ReplyTo in that incoming message to determine where to send the reply.","pos":[4918,5046]},{"content":"If the channel is not secured, then an untrusted client could send a malicious message with a target machine's ReplyTo, leading to a denial of service of the target machine.","pos":[5047,5220]},{"content":"With regular request-reply messages, this is not an issue, because the ReplyTo is ignored and the response is sent on the channel the original message came in on.","pos":[5221,5383]},{"pos":[5392,5400],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceContractAttribute&gt;</ph>","pos":[5404,5455],"source":"<xref:System.ServiceModel.ServiceContractAttribute> "},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.OperationContractAttribute&gt;</ph>","pos":[5460,5513],"source":"<xref:System.ServiceModel.OperationContractAttribute> "},{"content":"<bpt id=\"p1\">[</bpt>How to: Access Services with a Duplex Contract<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-access-services-with-a-duplex-contract.md)</ept><ph id=\"ph1\"> </ph>","pos":[5518,5664],"source":"[How to: Access Services with a Duplex Contract](../../../../docs/framework/wcf/feature-details/how-to-access-services-with-a-duplex-contract.md) "},{"content":"<bpt id=\"p1\">[</bpt>Duplex<ept id=\"p1\">](../../../../docs/framework/wcf/samples/duplex.md)</ept><ph id=\"ph1\"> </ph>","pos":[5668,5727],"source":"[Duplex](../../../../docs/framework/wcf/samples/duplex.md) "},{"content":"<bpt id=\"p1\">[</bpt>Designing and Implementing Services<ept id=\"p1\">](../../../../docs/framework/wcf/designing-and-implementing-services.md)</ept><ph id=\"ph1\"> </ph>","pos":[5731,5840],"source":"[Designing and Implementing Services](../../../../docs/framework/wcf/designing-and-implementing-services.md) "},{"content":"<bpt id=\"p1\">[</bpt>How to: Define a Service Contract<ept id=\"p1\">](../../../../docs/framework/wcf/how-to-define-a-wcf-service-contract.md)</ept><ph id=\"ph1\"> </ph>","pos":[5844,5952],"source":"[How to: Define a Service Contract](../../../../docs/framework/wcf/how-to-define-a-wcf-service-contract.md) "},{"content":"<bpt id=\"p1\">[</bpt>Session<ept id=\"p1\">](../../../../docs/framework/wcf/samples/session.md)</ept>","pos":[5956,6016],"source":"[Session](../../../../docs/framework/wcf/samples/session.md)"}]}