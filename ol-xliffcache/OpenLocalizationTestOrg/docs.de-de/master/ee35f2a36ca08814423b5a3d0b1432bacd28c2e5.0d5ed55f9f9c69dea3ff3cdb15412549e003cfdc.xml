{"content":"---\ntitle: \"How to: Secure Messages within Reliable Sessions\"\nms.date: \"03/30/2017\"\nms.assetid: aee33e50-936f-4486-9ca8-c1520c19a62d\n---\n\n# How to: Secure Messages within Reliable Sessions\n\nThis topic outlines the steps required to enable message-level security for messages exchanged within a reliable session using one of the system-provided bindings that support such a session, but not by default. Enable a secure, reliable session either imperatively by using code or declaratively in the configuration file. This procedure uses the client and service configuration files to enable the secure, reliable session.\n\nThis procedure consists of the following three key tasks:\n\n1. Specify that the client and service exchange messages within a reliable session.\n\n1. Require message-level security within the reliable session.\n\n1. Specify the client credential type that the client must use to be authenticated with the service.\n\nIt's important in the first task that the endpoint configuration element contain a `bindingConfiguration` attribute that references a binding configuration named (in this example) `MessageSecurity`. The [**\\<binding>**](../../../../docs/framework/misc/binding.md) configuration element then references this name to enable reliable sessions by setting the `enabled` attribute of the [**\\<reliableSession>**](https://docs.microsoft.com/previous-versions/ms731375(v=vs.90)) element to `true`. You can require that the ordered delivery assurances are available within a reliable session by setting the `ordered` attribute to `true`.\n\nFor the source copy of the example on which this configuration procedure is based, see the [WS Reliable Session](../../../../docs/framework/wcf/samples/ws-reliable-session.md).\n\nThe essential items of the second task are accomplished by setting the `mode` attribute of the **\\<security>** element contained in the **\\<binding>** element of the client and service to `Message`.\n\nThe essential items of the third task are accomplished by setting the `clientCredentialType` attribute of the **\\<message>** element contained in the **\\<security>** element of the client and service to `Certificate`.\n\n> [!NOTE]\n> When using message security with reliable sessions, Reliable Messaging attempts to authenticate an unauthenticated client until a timeout occurs instead of throwing an exception upon first failure.\n\n### Configure the service with a WSHttpBinding to use a reliable session\n\nThis procedure is described in [How to: Exchange Messages Within a Reliable Session](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-within-a-reliable-session.md).\n\n### Configure the client with a WSHttpBinding to use a reliable session\n\nThis procedure is described in [How to: Exchange Messages Within a Reliable Session](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-within-a-reliable-session.md).\n\n### Set the mode and ClientCredentialType in configuration\n\n1. Add an appropriate binding element to the [**\\<bindings>**](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md) element of the configuration file. The following example adds a [**\\<wsHttpBinding>**](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) element.\n\n1. Add a **\\<binding>** element and set its `name` attribute to an appropriate value. The example uses the name `MessageSecurity`.\n\n1. Add a **\\<security>** element and set the `mode` attribute to `Message`.\n\n1. Within the **\\<security>** element, add a **\\<message>** element and set the `clientCredentialType` attribute to `Certificate`.\n\n```xml\n<wsHttpBinding>\n  <binding name=\"MessageSecurity\">\n    <security mode=\"Message\">\n      <message clientCredentialType=\"Certificate\" />\n    </security>\n  </binding>\n</wsHttpBinding>\n```\n","nodes":[{"pos":[4,132],"embed":true,"restype":"x-metadata","content":"title: \"How to: Secure Messages within Reliable Sessions\"\nms.date: \"03/30/2017\"\nms.assetid: aee33e50-936f-4486-9ca8-c1520c19a62d","nodes":[{"content":"How to: Secure Messages within Reliable Sessions","nodes":[{"pos":[0,48],"content":"How to: Secure Messages within Reliable Sessions","nodes":[{"content":"How to: Secure Messages within Reliable Sessions","pos":[0,48]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[140,188],"content":"How to: Secure Messages within Reliable Sessions","linkify":"How to: Secure Messages within Reliable Sessions","nodes":[{"content":"How to: Secure Messages within Reliable Sessions","pos":[0,48]}]},{"content":"This topic outlines the steps required to enable message-level security for messages exchanged within a reliable session using one of the system-provided bindings that support such a session, but not by default.","pos":[190,401]},{"content":"Enable a secure, reliable session either imperatively by using code or declaratively in the configuration file.","pos":[402,513]},{"content":"This procedure uses the client and service configuration files to enable the secure, reliable session.","pos":[514,616]},{"content":"This procedure consists of the following three key tasks:","pos":[618,675]},{"content":"Specify that the client and service exchange messages within a reliable session.","pos":[680,760]},{"content":"Require message-level security within the reliable session.","pos":[765,824]},{"content":"Specify the client credential type that the client must use to be authenticated with the service.","pos":[829,926]},{"content":"It's important in the first task that the endpoint configuration element contain a <ph id=\"ph1\">`bindingConfiguration`</ph> attribute that references a binding configuration named (in this example) <ph id=\"ph2\">`MessageSecurity`</ph>.","pos":[928,1126],"source":"It's important in the first task that the endpoint configuration element contain a `bindingConfiguration` attribute that references a binding configuration named (in this example) `MessageSecurity`."},{"content":"The <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt><ph id=\"ph1\">\\&lt;</ph>binding&gt;<ept id=\"p2\">**</ept><ept id=\"p1\">](../../../../docs/framework/misc/binding.md)</ept> configuration element then references this name to enable reliable sessions by setting the <ph id=\"ph2\">`enabled`</ph> attribute of the <bpt id=\"p3\">[</bpt><bpt id=\"p4\">**</bpt><ph id=\"ph3\">\\&lt;</ph>reliableSession&gt;<ept id=\"p4\">**</ept><ept id=\"p3\">](https://docs.microsoft.com/previous-versions/ms731375(v=vs.90))</ept> element to <ph id=\"ph4\">`true`</ph>.","pos":[1127,1417],"source":" The [**\\<binding>**](../../../../docs/framework/misc/binding.md) configuration element then references this name to enable reliable sessions by setting the `enabled` attribute of the [**\\<reliableSession>**](https://docs.microsoft.com/previous-versions/ms731375(v=vs.90)) element to `true`."},{"content":"You can require that the ordered delivery assurances are available within a reliable session by setting the <ph id=\"ph1\">`ordered`</ph> attribute to <ph id=\"ph2\">`true`</ph>.","pos":[1418,1556],"source":" You can require that the ordered delivery assurances are available within a reliable session by setting the `ordered` attribute to `true`."},{"pos":[1558,1734],"content":"For the source copy of the example on which this configuration procedure is based, see the <bpt id=\"p1\">[</bpt>WS Reliable Session<ept id=\"p1\">](../../../../docs/framework/wcf/samples/ws-reliable-session.md)</ept>.","source":"For the source copy of the example on which this configuration procedure is based, see the [WS Reliable Session](../../../../docs/framework/wcf/samples/ws-reliable-session.md)."},{"pos":[1736,1934],"content":"The essential items of the second task are accomplished by setting the <ph id=\"ph1\">`mode`</ph> attribute of the <bpt id=\"p1\">**</bpt><ph id=\"ph2\">\\&lt;</ph>security&gt;<ept id=\"p1\">**</ept> element contained in the <bpt id=\"p2\">**</bpt><ph id=\"ph3\">\\&lt;</ph>binding&gt;<ept id=\"p2\">**</ept> element of the client and service to <ph id=\"ph4\">`Message`</ph>.","source":"The essential items of the second task are accomplished by setting the `mode` attribute of the **\\<security>** element contained in the **\\<binding>** element of the client and service to `Message`."},{"pos":[1936,2153],"content":"The essential items of the third task are accomplished by setting the <ph id=\"ph1\">`clientCredentialType`</ph> attribute of the <bpt id=\"p1\">**</bpt><ph id=\"ph2\">\\&lt;</ph>message&gt;<ept id=\"p1\">**</ept> element contained in the <bpt id=\"p2\">**</bpt><ph id=\"ph3\">\\&lt;</ph>security&gt;<ept id=\"p2\">**</ept> element of the client and service to <ph id=\"ph4\">`Certificate`</ph>.","source":"The essential items of the third task are accomplished by setting the `clientCredentialType` attribute of the **\\<message>** element contained in the **\\<security>** element of the client and service to `Certificate`."},{"pos":[2157,2364],"content":"[!NOTE]\nWhen using message security with reliable sessions, Reliable Messaging attempts to authenticate an unauthenticated client until a timeout occurs instead of throwing an exception upon first failure.","leadings":["","> "],"nodes":[{"content":"When using message security with reliable sessions, Reliable Messaging attempts to authenticate an unauthenticated client until a timeout occurs instead of throwing an exception upon first failure.","pos":[8,205]}]},{"pos":[2370,2438],"content":"Configure the service with a WSHttpBinding to use a reliable session","linkify":"Configure the service with a WSHttpBinding to use a reliable session","nodes":[{"content":"Configure the service with a WSHttpBinding to use a reliable session","pos":[0,68]}]},{"pos":[2440,2627],"content":"This procedure is described in <bpt id=\"p1\">[</bpt>How to: Exchange Messages Within a Reliable Session<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-within-a-reliable-session.md)</ept>.","source":"This procedure is described in [How to: Exchange Messages Within a Reliable Session](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-within-a-reliable-session.md)."},{"pos":[2633,2700],"content":"Configure the client with a WSHttpBinding to use a reliable session","linkify":"Configure the client with a WSHttpBinding to use a reliable session","nodes":[{"content":"Configure the client with a WSHttpBinding to use a reliable session","pos":[0,67]}]},{"pos":[2702,2889],"content":"This procedure is described in <bpt id=\"p1\">[</bpt>How to: Exchange Messages Within a Reliable Session<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-within-a-reliable-session.md)</ept>.","source":"This procedure is described in [How to: Exchange Messages Within a Reliable Session](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-within-a-reliable-session.md)."},{"pos":[2895,2949],"content":"Set the mode and ClientCredentialType in configuration","linkify":"Set the mode and ClientCredentialType in configuration","nodes":[{"content":"Set the mode and ClientCredentialType in configuration","pos":[0,54]}]},{"content":"Add an appropriate binding element to the <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt><ph id=\"ph1\">\\&lt;</ph>bindings&gt;<ept id=\"p2\">**</ept><ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md)</ept> element of the configuration file.","pos":[2954,3119],"source":"Add an appropriate binding element to the [**\\<bindings>**](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md) element of the configuration file."},{"content":"The following example adds a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt><ph id=\"ph1\">\\&lt;</ph>wsHttpBinding&gt;<ept id=\"p2\">**</ept><ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md)</ept> element.","pos":[3120,3256],"source":" The following example adds a [**\\<wsHttpBinding>**](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) element."},{"content":"Add a <bpt id=\"p1\">**</bpt><ph id=\"ph1\">\\&lt;</ph>binding&gt;<ept id=\"p1\">**</ept> element and set its <ph id=\"ph2\">`name`</ph> attribute to an appropriate value.","pos":[3261,3343],"source":"Add a **\\<binding>** element and set its `name` attribute to an appropriate value."},{"content":"The example uses the name <ph id=\"ph1\">`MessageSecurity`</ph>.","pos":[3344,3388],"source":" The example uses the name `MessageSecurity`."},{"pos":[3393,3465],"content":"Add a <bpt id=\"p1\">**</bpt><ph id=\"ph1\">\\&lt;</ph>security&gt;<ept id=\"p1\">**</ept> element and set the <ph id=\"ph2\">`mode`</ph> attribute to <ph id=\"ph3\">`Message`</ph>.","source":"Add a **\\<security>** element and set the `mode` attribute to `Message`."},{"pos":[3470,3597],"content":"Within the <bpt id=\"p1\">**</bpt><ph id=\"ph1\">\\&lt;</ph>security&gt;<ept id=\"p1\">**</ept> element, add a <bpt id=\"p2\">**</bpt><ph id=\"ph2\">\\&lt;</ph>message&gt;<ept id=\"p2\">**</ept> element and set the <ph id=\"ph3\">`clientCredentialType`</ph> attribute to <ph id=\"ph4\">`Certificate`</ph>.","source":"Within the **\\<security>** element, add a **\\<message>** element and set the `clientCredentialType` attribute to `Certificate`."}]}