{"content":"---\ntitle: \"How to: Decrypt XML Elements with X.509 Certificates\"\nms.date: \"03/30/2017\"\nms.technology: dotnet-standard\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"System.Security.Cryptography.EncryptedXml class\"\n  - \"XML encryption\"\n  - \"System.Security.Cryptography.X509Certificate2 class\"\n  - \"decryption\"\n  - \"X.509 certificates\"\n  - \"certificates, X.509 certificates\"\nms.assetid: bd015722-d88d-408d-8ca8-e4e475c441ed\nauthor: \"mairaw\"\nms.author: \"mairaw\"\n---\n# How to: Decrypt XML Elements with X.509 Certificates\nYou can use the classes in the <xref:System.Security.Cryptography.Xml> namespace to encrypt and decrypt an element within an XML document.  XML Encryption is a standard way to exchange or store encrypted XML data, without worrying about the data being easily read.  For more information about the XML Encryption standard, see the World Wide Web Consortium (W3C) specification for XML Encryption located at <https://www.w3.org/TR/xmldsig-core/>.  \n  \n This example decrypts an XML element that was encrypted using the methods described in: [How to: Encrypt XML Elements with X.509 Certificates](../../../docs/standard/security/how-to-encrypt-xml-elements-with-x-509-certificates.md).  It finds an <`EncryptedData`> element, decrypts the element, and then replaces the element with the original plaintext XML element.  \n  \n The code example in this procedure decrypts an XML element using an X.509 certificate from the local certificate store of the current user account.  The example uses the <xref:System.Security.Cryptography.Xml.EncryptedXml.DecryptDocument%2A> method to automatically retrieve the X.509 certificate and decrypt a session key stored in the <`EncryptedKey`> element of the <`EncryptedData`> element.  The <xref:System.Security.Cryptography.Xml.EncryptedXml.DecryptDocument%2A> method then automatically uses the session key to decrypt the XML element.  \n  \n This example is appropriate for situations where multiple applications need to share encrypted data or where an application needs to save encrypted data between the times that it runs.  \n  \n### To decrypt an XML element with an X.509 certificate  \n  \n1.  Create an <xref:System.Xml.XmlDocument> object by loading an XML file from disk.  The <xref:System.Xml.XmlDocument> object contains the XML element to decrypt.  \n  \n     [!code-csharp[HowToDecryptXMLElementX509#2](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementX509/cs/sample.cs#2)]\n     [!code-vb[HowToDecryptXMLElementX509#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementX509/vb/sample.vb#2)]  \n  \n2.  Create a new <xref:System.Security.Cryptography.Xml.EncryptedXml> object by passing the <xref:System.Xml.XmlDocument> object to the constructor.  \n  \n     [!code-csharp[HowToDecryptXMLElementX509#3](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementX509/cs/sample.cs#3)]\n     [!code-vb[HowToDecryptXMLElementX509#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementX509/vb/sample.vb#3)]  \n  \n3.  Decrypt the XML document using the <xref:System.Security.Cryptography.Xml.EncryptedXml.DecryptDocument%2A> method.  \n  \n     [!code-csharp[HowToDecryptXMLElementX509#4](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementX509/cs/sample.cs#4)]\n     [!code-vb[HowToDecryptXMLElementX509#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementX509/vb/sample.vb#4)]  \n  \n4.  Save the <xref:System.Xml.XmlDocument> object.  \n  \n     [!code-csharp[HowToDecryptXMLElementX509#5](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementX509/cs/sample.cs#5)]\n     [!code-vb[HowToDecryptXMLElementX509#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementX509/vb/sample.vb#5)]  \n  \n## Example  \n This example assumes that a file named `\"test.xml\"` exists in the same directory as the compiled program.  It also assumes that `\"test.xml\"` contains a `\"creditcard\"` element.  You can place the following XML into a file called `test.xml` and use it with this example.  \n  \n```xml  \n<root>  \n    <creditcard>  \n        <number>19834209</number>  \n        <expiry>02/02/2002</expiry>  \n    </creditcard>  \n</root>  \n```  \n  \n [!code-csharp[HowToDecryptXMLElementX509#1](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementX509/cs/sample.cs#1)]\n [!code-vb[HowToDecryptXMLElementX509#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementX509/vb/sample.vb#1)]  \n  \n## Compiling the Code  \n  \n-   To compile this example, you need to include a reference to `System.Security.dll`.  \n  \n-   Include the following namespaces: <xref:System.Xml>, <xref:System.Security.Cryptography>, and <xref:System.Security.Cryptography.Xml>.  \n  \n## .NET Framework Security  \n The X.509 certificate used in this example is for test purposes only.  Applications should use an X.509 certificate generated by a trusted certificate authority or use a certificate generated by the Microsoft Windows Certificate Server.  \n  \n## See also\n\n- <xref:System.Security.Cryptography.Xml>\n- [How to: Encrypt XML Elements with X.509 Certificates](../../../docs/standard/security/how-to-encrypt-xml-elements-with-x-509-certificates.md)\n","nodes":[{"pos":[4,474],"embed":true,"restype":"x-metadata","content":"title: \"How to: Decrypt XML Elements with X.509 Certificates\"\nms.date: \"03/30/2017\"\nms.technology: dotnet-standard\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"System.Security.Cryptography.EncryptedXml class\"\n  - \"XML encryption\"\n  - \"System.Security.Cryptography.X509Certificate2 class\"\n  - \"decryption\"\n  - \"X.509 certificates\"\n  - \"certificates, X.509 certificates\"\nms.assetid: bd015722-d88d-408d-8ca8-e4e475c441ed\nauthor: \"mairaw\"\nms.author: \"mairaw\"","nodes":[{"content":"How to: Decrypt XML Elements with X.509 Certificates","nodes":[{"pos":[0,52],"content":"How to: Decrypt XML Elements with X.509 Certificates","nodes":[{"content":"How to: Decrypt XML Elements with X.509 Certificates","pos":[0,52]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[481,533],"content":"How to: Decrypt XML Elements with X.509 Certificates","linkify":"How to: Decrypt XML Elements with X.509 Certificates","nodes":[{"content":"How to: Decrypt XML Elements with X.509 Certificates","pos":[0,52]}]},{"content":"You can use the classes in the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.Xml&gt;</ph> namespace to encrypt and decrypt an element within an XML document.","pos":[534,672],"source":"You can use the classes in the <xref:System.Security.Cryptography.Xml> namespace to encrypt and decrypt an element within an XML document."},{"content":"XML Encryption is a standard way to exchange or store encrypted XML data, without worrying about the data being easily read.","pos":[674,798]},{"content":"For more information about the XML Encryption standard, see the World Wide Web Consortium (W3C) specification for XML Encryption located at <ph id=\"ph1\">&lt;https://www.w3.org/TR/xmldsig-core/&gt;</ph>.","pos":[800,978],"source":"  For more information about the XML Encryption standard, see the World Wide Web Consortium (W3C) specification for XML Encryption located at <https://www.w3.org/TR/xmldsig-core/>."},{"content":"This example decrypts an XML element that was encrypted using the methods described in: <bpt id=\"p1\">[</bpt>How to: Encrypt XML Elements with X.509 Certificates<ept id=\"p1\">](../../../docs/standard/security/how-to-encrypt-xml-elements-with-x-509-certificates.md)</ept>.","pos":[985,1216],"source":"This example decrypts an XML element that was encrypted using the methods described in: [How to: Encrypt XML Elements with X.509 Certificates](../../../docs/standard/security/how-to-encrypt-xml-elements-with-x-509-certificates.md)."},{"content":"It finds an &lt;<ph id=\"ph1\">`EncryptedData`</ph>&gt; element, decrypts the element, and then replaces the element with the original plaintext XML element.","pos":[1218,1349],"source":"  It finds an <`EncryptedData`> element, decrypts the element, and then replaces the element with the original plaintext XML element."},{"content":"The code example in this procedure decrypts an XML element using an X.509 certificate from the local certificate store of the current user account.","pos":[1356,1503]},{"content":"The example uses the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.Xml.EncryptedXml.DecryptDocument%2A&gt;</ph> method to automatically retrieve the X.509 certificate and decrypt a session key stored in the &lt;<ph id=\"ph2\">`EncryptedKey`</ph>&gt; element of the &lt;<ph id=\"ph3\">`EncryptedData`</ph>&gt; element.","pos":[1505,1751],"source":"  The example uses the <xref:System.Security.Cryptography.Xml.EncryptedXml.DecryptDocument%2A> method to automatically retrieve the X.509 certificate and decrypt a session key stored in the <`EncryptedKey`> element of the <`EncryptedData`> element."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.Xml.EncryptedXml.DecryptDocument%2A&gt;</ph> method then automatically uses the session key to decrypt the XML element.","pos":[1753,1903],"source":"  The <xref:System.Security.Cryptography.Xml.EncryptedXml.DecryptDocument%2A> method then automatically uses the session key to decrypt the XML element."},{"content":"This example is appropriate for situations where multiple applications need to share encrypted data or where an application needs to save encrypted data between the times that it runs.","pos":[1910,2094]},{"pos":[2104,2155],"content":"To decrypt an XML element with an X.509 certificate","linkify":"To decrypt an XML element with an X.509 certificate","nodes":[{"content":"To decrypt an XML element with an X.509 certificate","pos":[0,51]}]},{"content":"Create an <ph id=\"ph1\">&lt;xref:System.Xml.XmlDocument&gt;</ph> object by loading an XML file from disk.","pos":[2165,2245],"source":"Create an <xref:System.Xml.XmlDocument> object by loading an XML file from disk."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Xml.XmlDocument&gt;</ph> object contains the XML element to decrypt.","pos":[2247,2324],"source":"  The <xref:System.Xml.XmlDocument> object contains the XML element to decrypt."},{"pos":[2335,2614],"content":"[!code-csharp[HowToDecryptXMLElementX509#2](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementX509/cs/sample.cs#2)]\n [!code-vb[HowToDecryptXMLElementX509#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementX509/vb/sample.vb#2)]","leadings":["","    "],"nodes":[]},{"pos":[2624,2768],"content":"Create a new <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.Xml.EncryptedXml&gt;</ph> object by passing the <ph id=\"ph2\">&lt;xref:System.Xml.XmlDocument&gt;</ph> object to the constructor.","source":"Create a new <xref:System.Security.Cryptography.Xml.EncryptedXml> object by passing the <xref:System.Xml.XmlDocument> object to the constructor."},{"pos":[2779,3058],"content":"[!code-csharp[HowToDecryptXMLElementX509#3](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementX509/cs/sample.cs#3)]\n [!code-vb[HowToDecryptXMLElementX509#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementX509/vb/sample.vb#3)]","leadings":["","    "],"nodes":[]},{"pos":[3068,3182],"content":"Decrypt the XML document using the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.Xml.EncryptedXml.DecryptDocument%2A&gt;</ph> method.","source":"Decrypt the XML document using the <xref:System.Security.Cryptography.Xml.EncryptedXml.DecryptDocument%2A> method."},{"pos":[3193,3472],"content":"[!code-csharp[HowToDecryptXMLElementX509#4](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementX509/cs/sample.cs#4)]\n [!code-vb[HowToDecryptXMLElementX509#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementX509/vb/sample.vb#4)]","leadings":["","    "],"nodes":[]},{"pos":[3482,3528],"content":"Save the <ph id=\"ph1\">&lt;xref:System.Xml.XmlDocument&gt;</ph> object.","source":"Save the <xref:System.Xml.XmlDocument> object."},{"pos":[3539,3818],"content":"[!code-csharp[HowToDecryptXMLElementX509#5](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementX509/cs/sample.cs#5)]\n [!code-vb[HowToDecryptXMLElementX509#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementX509/vb/sample.vb#5)]","leadings":["","    "],"nodes":[]},{"pos":[3827,3834],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"This example assumes that a file named <ph id=\"ph1\">`\"test.xml\"`</ph> exists in the same directory as the compiled program.","pos":[3838,3943],"source":"This example assumes that a file named `\"test.xml\"` exists in the same directory as the compiled program."},{"content":"It also assumes that <ph id=\"ph1\">`\"test.xml\"`</ph> contains a <ph id=\"ph2\">`\"creditcard\"`</ph> element.","pos":[3945,4013],"source":"  It also assumes that `\"test.xml\"` contains a `\"creditcard\"` element."},{"content":"You can place the following XML into a file called <ph id=\"ph1\">`test.xml`</ph> and use it with this example.","pos":[4015,4106],"source":"  You can place the following XML into a file called `test.xml` and use it with this example."},{"pos":[4547,4565],"content":"Compiling the Code","linkify":"Compiling the Code","nodes":[{"content":"Compiling the Code","pos":[0,18]}]},{"pos":[4575,4657],"content":"To compile this example, you need to include a reference to <ph id=\"ph1\">`System.Security.dll`</ph>.","source":"To compile this example, you need to include a reference to `System.Security.dll`."},{"pos":[4667,4801],"content":"Include the following namespaces: <ph id=\"ph1\">&lt;xref:System.Xml&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.Security.Cryptography&gt;</ph>, and <ph id=\"ph3\">&lt;xref:System.Security.Cryptography.Xml&gt;</ph>.","source":"Include the following namespaces: <xref:System.Xml>, <xref:System.Security.Cryptography>, and <xref:System.Security.Cryptography.Xml>."},{"pos":[4810,4833],"content":".NET Framework Security","linkify":".NET Framework Security","nodes":[{"content":".NET Framework Security","pos":[0,23]}]},{"content":"The X.509 certificate used in this example is for test purposes only.","pos":[4837,4906]},{"content":"Applications should use an X.509 certificate generated by a trusted certificate authority or use a certificate generated by the Microsoft Windows Certificate Server.","pos":[4908,5073]},{"pos":[5082,5090],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[5136,5278],"content":"<bpt id=\"p1\">[</bpt>How to: Encrypt XML Elements with X.509 Certificates<ept id=\"p1\">](../../../docs/standard/security/how-to-encrypt-xml-elements-with-x-509-certificates.md)</ept>","source":"[How to: Encrypt XML Elements with X.509 Certificates](../../../docs/standard/security/how-to-encrypt-xml-elements-with-x-509-certificates.md)"}]}