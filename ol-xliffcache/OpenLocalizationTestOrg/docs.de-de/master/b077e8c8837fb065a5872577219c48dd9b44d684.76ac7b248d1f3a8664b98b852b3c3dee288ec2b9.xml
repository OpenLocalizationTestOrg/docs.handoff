{"content":"---\ntitle: \"How to: Retrieve Metadata Over a non-MEX Binding | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 2292e124-81b2-4317-b881-ce9c1ec66ecb\ncaps.latest.revision: 10\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# How to: Retrieve Metadata Over a non-MEX Binding\nThis topic describes how to retrieve metadata from a MEX endpoint over a non-MEX binding. The code in this sample is based on the [Custom Secure Metadata Endpoint](../../../../docs/framework/wcf/samples/custom-secure-metadata-endpoint.md) sample.  \n  \n### To retrieve metadata over a non-MEX binding  \n  \n1.  Determine the binding used by the MEX endpoint. For [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] services, you can determine the MEX binding by accessing the service's configuration file. In this case, the MEX binding is defined in the following service configuration.  \n  \n    ```  \n    <services>  \n        <service name=\"Microsoft.ServiceModel.Samples.CalculatorService\"  \n                behaviorConfiguration=\"CalculatorServiceBehavior\">  \n         <!-- Use the base address provided by the host. -->  \n         <endpoint address=\"\"  \n           binding=\"wsHttpBinding\"  \n           bindingConfiguration=\"Binding2\"  \n           contract=\"Microsoft.ServiceModel.Samples.ICalculator\" />  \n         <endpoint address=\"mex\"  \n           binding=\"wsHttpBinding\"  \n           bindingConfiguration=\"Binding1\"  \n           contract=\"IMetadataExchange\" />  \n         </service>  \n     </services>  \n     <bindings>  \n       <wsHttpBinding>  \n         <binding name=\"Binding1\">  \n           <security mode=\"Message\">  \n             <message clientCredentialType=\"Certificate\" />  \n           </security>  \n         </binding>  \n         <binding name=\"Binding2\">  \n           <reliableSession inactivityTimeout=\"00:01:00\" enabled=\"true\" />  \n           <security mode=\"Message\">  \n             <message clientCredentialType=\"Certificate\" />  \n           </security>  \n         </binding>  \n       </wsHttpBinding>  \n     </bindings>  \n    ```  \n  \n2.  In the client configuration file, configure the same custom binding. Here the client also defines a `clientCredentials` behavior to provide a certificate to use to authenticate to the service when requesting metadata from the MEX endpoint. When using Svcutil.exe to request metadata over a custom binding, you should add the MEX endpoint configuration to the configuration file for Svcutil.exe (Svcutil.exe.config), and the name of the endpoint configuration should match the URI scheme of the address of the MEX endpoint, as shown in the following code.  \n  \n    ```  \n    <system.serviceModel>  \n      <client>  \n        <endpoint name=\"http\"  \n                  binding=\"wsHttpBinding\"  \n                  bindingConfiguration=\"Binding1\"  \n                  behaviorConfiguration=\"ClientCertificateBehavior\"  \n                  contract=\"IMetadataExchange\" />  \n      </client>  \n      <bindings>  \n        <wsHttpBinding>  \n          <binding name=\"Binding1\">  \n            <security mode=\"Message\">  \n              <message clientCredentialType=\"Certificate\"/>  \n            </security>  \n          </binding>  \n        </wsHttpBinding>  \n      </bindings>  \n      <behaviors>  \n        <endpointBehaviors>  \n          <behavior name=\"ClientCertificateBehavior\">  \n            <clientCredentials>  \n              <clientCertificate findValue=\"client.com\" storeLocation=\"CurrentUser\" storeName=\"My\" x509FindType=\"FindBySubjectName\" />  \n              <serviceCertificate>  \n                <authentication certificateValidationMode=\"PeerOrChainTrust\" />  \n              </serviceCertificate>  \n            </clientCredentials>  \n          </behavior>  \n        </endpointBehaviors>  \n      </behaviors>    \n    </system.serviceModel>  \n    ```  \n  \n3.  Create a `MetadataExchangeClient` and call `GetMetadata`. There are two ways to do this: you can specify the custom binding in configuration, or you can specify the custom binding in code, as shown in the following example.  \n  \n    ```  \n    // The custom binding is specified in configuration.  \n    EndpointAddress mexAddress = new EndpointAddress(\"http://localhost:8000/ServiceModelSamples/Service/mex\");  \n  \n    MetadataExchangeClient mexClient = new MetadataExchangeClient(\"http\");  \n    mexClient.ResolveMetadataReferences = true;  \n    MetadataSet mexSet = mexClient.GetMetadata(mexAddress);  \n  \n    // The custom binding is specified in code.  \n    // Specify the Metadata Exchange binding and its security mode.  \n    WSHttpBinding mexBinding = new WSHttpBinding(SecurityMode.Message);  \n    mexBinding.Security.Message.ClientCredentialType = MessageCredentialType.Certificate;  \n  \n    // Create a MetadataExchangeClient and set the certificate details.  \n    MetadataExchangeClient mexClient = new MetadataExchangeClient(mexBinding);  \n    mexClient.SoapCredentials.ClientCertificate.SetCertificate(  \n        StoreLocation.CurrentUser, StoreName.My,  \n        X509FindType.FindBySubjectName, \"client.com\");  \n    mexClient.SoapCredentials.ServiceCertificate.Authentication.  \n        CertificateValidationMode =  \n        X509CertificateValidationMode.PeerOrChainTrust;  \n    mexClient.SoapCredentials.ServiceCertificate.SetDefaultCertificate(  \n        StoreLocation.CurrentUser, StoreName.TrustedPeople,  \n        X509FindType.FindBySubjectName, \"localhost\");  \n    MetadataExchangeClient mexClient2 = new MetadataExchangeClient(customBinding);  \n    mexClient2.ResolveMetadataReferences = true;  \n    MetadataSet mexSet2 = mexClient2.GetMetadata(mexAddress);  \n    ```  \n  \n4.  Create a `WsdlImporter` and call `ImportAllEndpoints`, as shown in the following code.  \n  \n    ```  \n    WsdlImporter importer = new WsdlImporter(mexSet);  \n    ServiceEndpointCollection endpoints = importer.ImportAllEndpoints();  \n    ```  \n  \n5.  At this point, you have a collection of service endpoints. [!INCLUDE[crabout](../../../../includes/crabout-md.md)]importing metadata, see [How to: Import Metadata into Service Endpoints](../../../../docs/framework/wcf/feature-details/how-to-import-metadata-into-service-endpoints.md).  \n  \n## See Also  \n [Metadata](../../../../docs/framework/wcf/feature-details/metadata.md)","nodes":[{"pos":[12,77],"content":"How to: Retrieve Metadata Over a non-MEX Binding | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"How to: Retrieve Metadata Over a non-MEX Binding | Microsoft Docs","pos":[0,65]}]},{"pos":[376,424],"content":"How to: Retrieve Metadata Over a non-MEX Binding","linkify":"How to: Retrieve Metadata Over a non-MEX Binding","nodes":[{"content":"How to: Retrieve Metadata Over a non-MEX Binding","pos":[0,48]}]},{"content":"This topic describes how to retrieve metadata from a MEX endpoint over a non-MEX binding.","pos":[425,514]},{"content":"The code in this sample is based on the <bpt id=\"p1\">[</bpt>Custom Secure Metadata Endpoint<ept id=\"p1\">](../../../../docs/framework/wcf/samples/custom-secure-metadata-endpoint.md)</ept> sample.","pos":[515,671],"source":" The code in this sample is based on the [Custom Secure Metadata Endpoint](../../../../docs/framework/wcf/samples/custom-secure-metadata-endpoint.md) sample."},{"pos":[681,724],"content":"To retrieve metadata over a non-MEX binding","linkify":"To retrieve metadata over a non-MEX binding","nodes":[{"content":"To retrieve metadata over a non-MEX binding","pos":[0,43]}]},{"content":"Determine the binding used by the MEX endpoint.","pos":[734,781]},{"content":"For <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> services, you can determine the MEX binding by accessing the service's configuration file.","pos":[782,932],"source":" For [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] services, you can determine the MEX binding by accessing the service's configuration file."},{"content":"In this case, the MEX binding is defined in the following service configuration.","pos":[933,1013]},{"content":"In the client configuration file, configure the same custom binding.","pos":[2192,2260]},{"content":"Here the client also defines a <ph id=\"ph1\">`clientCredentials`</ph> behavior to provide a certificate to use to authenticate to the service when requesting metadata from the MEX endpoint.","pos":[2261,2431],"source":" Here the client also defines a `clientCredentials` behavior to provide a certificate to use to authenticate to the service when requesting metadata from the MEX endpoint."},{"content":"When using Svcutil.exe to request metadata over a custom binding, you should add the MEX endpoint configuration to the configuration file for Svcutil.exe (Svcutil.exe.config), and the name of the endpoint configuration should match the URI scheme of the address of the MEX endpoint, as shown in the following code.","pos":[2432,2746]},{"content":"Create a <ph id=\"ph1\">`MetadataExchangeClient`</ph> and call <ph id=\"ph2\">`GetMetadata`</ph>.","pos":[3949,4006],"source":"Create a `MetadataExchangeClient` and call `GetMetadata`."},{"content":"There are two ways to do this: you can specify the custom binding in configuration, or you can specify the custom binding in code, as shown in the following example.","pos":[4007,4172]},{"pos":[5745,5831],"content":"Create a <ph id=\"ph1\">`WsdlImporter`</ph> and call <ph id=\"ph2\">`ImportAllEndpoints`</ph>, as shown in the following code.","source":"Create a `WsdlImporter` and call `ImportAllEndpoints`, as shown in the following code."},{"content":"At this point, you have a collection of service endpoints.","pos":[5995,6053]},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph>importing metadata, see <bpt id=\"p1\">[</bpt>How to: Import Metadata into Service Endpoints<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-import-metadata-into-service-endpoints.md)</ept>.","pos":[6054,6279],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)]importing metadata, see [How to: Import Metadata into Service Endpoints](../../../../docs/framework/wcf/feature-details/how-to-import-metadata-into-service-endpoints.md)."},{"pos":[6288,6296],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[6300,6370],"content":"<bpt id=\"p1\">[</bpt>Metadata<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/metadata.md)</ept>","source":"[Metadata](../../../../docs/framework/wcf/feature-details/metadata.md)"}]}