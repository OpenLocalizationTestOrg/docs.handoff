{"content":"---\ntitle: \"Transaction Convoy Scope | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 37141708-a29f-4b6a-81fe-f8a11f825061\ncaps.latest.revision: 8\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Transaction Convoy Scope\nThis sample demonstrates how to create a Parallel Convoy messaging activity pattern in conjunction with a <xref:System.ServiceModel.Activities.TransactedReceiveScope> to model a protocol where a number of operations can happen in any order all under the same transaction. This sample also demonstrates how a <xref:System.ServiceModel.Activities.TransactedReceiveScope> automatically creates a new transaction when one is not flowed to the server, so the client does not make use of any transactions.  \n  \n The sample consists of two workflow projects that represent the client and server. The client project runs a workflow that begins by sending a message to bootstrap the server workflow, which initializes a correlation and starts a transactional scope for the remainder of the messaging activities. The client <xref:System.Activities.Statements.Sequence> activity contains an initial <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.ReceiveReply> pair and then a <xref:System.Activities.Statements.Parallel> activity with three branches. Each branch sends a one-way message to the server. The <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> property of the <xref:System.Activities.Statements.Parallel> activity is set to `false` so that all three branches complete.  \n  \n The server workflow is similar to the client workflow except the messaging activities are oriented towards the server side of the communication and they are contained within a <xref:System.ServiceModel.Activities.TransactedReceiveScope> activity so that all work done executes under the same transaction. When the first message is received on the server, a transaction is created and is made ambient for the scope of the <xref:System.ServiceModel.Activities.TransactedReceiveScope> body so that any activity within this scope can access the transaction. After this, all receives execute in parallel. All receives must execute exactly once as described by the completion condition on the parallel activity. An implicit persistence point exists at the end of the <xref:System.ServiceModel.Activities.TransactedReceiveScope> body and the persistence operation is also executed under the same transaction.  \n  \n#### To use this sample  \n  \n1.  Using [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)], open the ParallelConvoySample.sln solution file.  \n  \n2.  To build the solution, press CTRL+SHIFT+B.  \n  \n3.  Ensure both projects are set to start.  \n  \n    1.  In **Solution Explorer**, right-click the solution and select **Set Startup Projects**.  \n  \n    2.  Select **Multiple Startup Projects** and ensure the action for both projects is set to **Start**.  \n  \n4.  To run the solution, press CTRL+F5.  \n  \n     The server prints `Server is running`, which indicates the server is ready.  \n  \n     Press any key in the client console window to start the sample.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Scenario\\Transactions\\TransactedConvoyScope`  \n  \n## See Also","nodes":[{"pos":[12,53],"content":"Transaction Convoy Scope | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Transaction Convoy Scope | Microsoft Docs","pos":[0,41]}]},{"pos":[318,342],"content":"Transaction Convoy Scope","linkify":"Transaction Convoy Scope","nodes":[{"content":"Transaction Convoy Scope","pos":[0,24]}]},{"content":"This sample demonstrates how to create a Parallel Convoy messaging activity pattern in conjunction with a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.TransactedReceiveScope&gt;</ph> to model a protocol where a number of operations can happen in any order all under the same transaction.","pos":[343,614],"source":"This sample demonstrates how to create a Parallel Convoy messaging activity pattern in conjunction with a <xref:System.ServiceModel.Activities.TransactedReceiveScope> to model a protocol where a number of operations can happen in any order all under the same transaction."},{"content":"This sample also demonstrates how a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.TransactedReceiveScope&gt;</ph> automatically creates a new transaction when one is not flowed to the server, so the client does not make use of any transactions.","pos":[615,842],"source":" This sample also demonstrates how a <xref:System.ServiceModel.Activities.TransactedReceiveScope> automatically creates a new transaction when one is not flowed to the server, so the client does not make use of any transactions."},{"content":"The sample consists of two workflow projects that represent the client and server.","pos":[849,931]},{"content":"The client project runs a workflow that begins by sending a message to bootstrap the server workflow, which initializes a correlation and starts a transactional scope for the remainder of the messaging activities.","pos":[932,1145]},{"content":"The client <ph id=\"ph1\">&lt;xref:System.Activities.Statements.Sequence&gt;</ph> activity contains an initial <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.ReceiveReply&gt;</ph> pair and then a <ph id=\"ph4\">&lt;xref:System.Activities.Statements.Parallel&gt;</ph> activity with three branches.","pos":[1146,1419],"source":" The client <xref:System.Activities.Statements.Sequence> activity contains an initial <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.ReceiveReply> pair and then a <xref:System.Activities.Statements.Parallel> activity with three branches."},{"content":"Each branch sends a one-way message to the server.","pos":[1420,1470]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Activities.Statements.Parallel.CompletionCondition%2A&gt;</ph> property of the <ph id=\"ph2\">&lt;xref:System.Activities.Statements.Parallel&gt;</ph> activity is set to <ph id=\"ph3\">`false`</ph> so that all three branches complete.","pos":[1471,1667],"source":" The <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> property of the <xref:System.Activities.Statements.Parallel> activity is set to `false` so that all three branches complete."},{"content":"The server workflow is similar to the client workflow except the messaging activities are oriented towards the server side of the communication and they are contained within a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.TransactedReceiveScope&gt;</ph> activity so that all work done executes under the same transaction.","pos":[1674,1978],"source":"The server workflow is similar to the client workflow except the messaging activities are oriented towards the server side of the communication and they are contained within a <xref:System.ServiceModel.Activities.TransactedReceiveScope> activity so that all work done executes under the same transaction."},{"content":"When the first message is received on the server, a transaction is created and is made ambient for the scope of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.TransactedReceiveScope&gt;</ph> body so that any activity within this scope can access the transaction.","pos":[1979,2227],"source":" When the first message is received on the server, a transaction is created and is made ambient for the scope of the <xref:System.ServiceModel.Activities.TransactedReceiveScope> body so that any activity within this scope can access the transaction."},{"content":"After this, all receives execute in parallel.","pos":[2228,2273]},{"content":"All receives must execute exactly once as described by the completion condition on the parallel activity.","pos":[2274,2379]},{"content":"An implicit persistence point exists at the end of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.TransactedReceiveScope&gt;</ph> body and the persistence operation is also executed under the same transaction.","pos":[2380,2575],"source":" An implicit persistence point exists at the end of the <xref:System.ServiceModel.Activities.TransactedReceiveScope> body and the persistence operation is also executed under the same transaction."},{"pos":[2586,2604],"content":"To use this sample","linkify":"To use this sample","nodes":[{"content":"To use this sample","pos":[0,18]}]},{"pos":[2614,2723],"content":"Using <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph>, open the ParallelConvoySample.sln solution file.","source":"Using [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)], open the ParallelConvoySample.sln solution file."},{"content":"To build the solution, press CTRL+SHIFT+B.","pos":[2733,2775]},{"content":"Ensure both projects are set to start.","pos":[2785,2823]},{"pos":[2837,2924],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the solution and select <bpt id=\"p2\">**</bpt>Set Startup Projects<ept id=\"p2\">**</ept>.","source":"In **Solution Explorer**, right-click the solution and select **Set Startup Projects**."},{"pos":[2938,3035],"content":"Select <bpt id=\"p1\">**</bpt>Multiple Startup Projects<ept id=\"p1\">**</ept> and ensure the action for both projects is set to <bpt id=\"p2\">**</bpt>Start<ept id=\"p2\">**</ept>.","source":"Select **Multiple Startup Projects** and ensure the action for both projects is set to **Start**."},{"content":"To run the solution, press CTRL+F5.","pos":[3045,3080]},{"pos":[3091,3166],"content":"The server prints <ph id=\"ph1\">`Server is running`</ph>, which indicates the server is ready.","source":"The server prints `Server is running`, which indicates the server is ready."},{"content":"Press any key in the client console window to start the sample.","pos":[3177,3240]},{"pos":[3248,3380],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[3434,3760],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[3761,3811]},{"pos":[3910,3918],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]}]}