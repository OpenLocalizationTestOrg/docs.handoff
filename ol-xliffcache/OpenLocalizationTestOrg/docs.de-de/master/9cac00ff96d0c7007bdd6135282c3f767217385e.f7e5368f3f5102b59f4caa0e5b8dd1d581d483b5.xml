{"content":"---\ntitle: ExecNotificationQueryWmi function (Unmanaged API Reference)\ndescription: The ExecNotificationQueryWmi function executes a query to receive events.\nms.date: \"11/06/2017\"\napi_name:\n  - \"ExecNotificationQueryWmi\"\napi_location:\n  - \"WMINet_Utils.dll\"\napi_type:\n  - \"DLLExport\"\nf1_keywords:\n  - \"ExecNotificationQueryWmi\"\nhelpviewer_keywords:\n  - \"ExecNotificationQueryWmi function [.NET WMI and performance counters]\"\ntopic_type:\n  - \"Reference\"\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\n---\n\n# ExecNotificationQueryWmi function\n\nExecutes a query to receive events. The call returns immediately, and the caller can poll the returned enumerator for events as they arrive. Releasing the returned enumerator cancels the query.\n\n[!INCLUDE[internalonly-unmanaged](../../../../includes/internalonly-unmanaged.md)]\n\n## Syntax\n\n```cpp\nHRESULT ExecNotificationQueryWmi (\n   [in] BSTR                    strQueryLanguage,\n   [in] BSTR                    strQuery,\n   [in] long                    lFlags,\n   [in] IWbemContext*           pCtx,\n   [out] IEnumWbemClassObject** ppEnum,\n   [in] DWORD                   authLevel,\n   [in] DWORD                   impLevel,\n   [in] IWbemServices*          pCurrentNamespace,\n   [in] BSTR                    strUser,\n   [in] BSTR                    strPassword,\n   [in] BSTR                    strAuthority\n);\n```\n\n## Parameters\n\n`strQueryLanguage`\\\n[in] A string with the valid query language supported by Windows Management. It must be \"WQL\", the acronym for WMI Query Language.\n\n`strQuery`\\\n[in] The text of the query. This parameter cannot be `null`.\n\n`lFlags`\\\n[in] A combination of the following two flags that affect the behavior of this function. These values are defined in the *WbemCli.h* header file, or you can define them as constants in your code.\n\n| Constant | Value  | Description  |\n|---------|---------|---------|\n| `WBEM_FLAG_RETURN_IMMEDIATELY` | 0x10 | The flag causes a semisynchronous call. If this flag is not set, the call fails. This is because events are received continuously, which means the user must poll the returned enumerator. Blocking this call indefinitely makes that impossible. |\n| `WBEM_FLAG_FORWARD_ONLY` | 0x20 | The function returns a forward-only enumerator. Typically, forward-only enumerators are faster and use less memory than conventional enumerators, but they do not allow calls to [Clone](clone.md). |\n\n`pCtx`\\\n[in] Typically, this value is `null`. Otherwise, it is a pointer to an [IWbemContext](/windows/desktop/api/wbemcli/nn-wbemcli-iwbemcontext) instance that can be used by the provider that is providing the requested events.\n\n`ppEnum`\\\n[out] If no error occurs, receives the pointer to the enumerator that allows the caller to retrieve the instances in the query's result set. See the [Remarks](#remarks) section for more information.\n\n`authLevel`\\\n[in] The authorization level.\n\n`impLevel`\\\n[in] The impersonation level.\n\n`pCurrentNamespace`\\\n[in] A pointer to an [IWbemServices](/windows/desktop/api/wbemcli/nn-wbemcli-iwbemservices) object that represents the current namespace.\n\n`strUser`\\\n[in] The user name. See the [ConnectServerWmi](connectserverwmi.md) function for more information.\n\n`strPassword`\\\n[in] The password. See the [ConnectServerWmi](connectserverwmi.md) function for more information.\n\n`strAuthority`\\\n[in] The domain name of the user. See the [ConnectServerWmi](connectserverwmi.md) function for more information.\n\n## Return value\n\nThe following values returned by this function are defined in the *WbemCli.h* header file, or you can define them as constants in your code:\n\n|Constant  |Value  |Description  |\n|---------|---------|---------|\n| `WBEM_E_ACCESS_DENIED` | 0x80041003 | The user does not have permission to view one or more of the classes that the function can return. |\n| `WBEM_E_FAILED` | 0x80041001 | An unspecified error has occurred. |\n| `WBEM_E_INVALID_PARAMETER` | 0x80041008 | A parameter is not valid. |\n| `WBEM_E_INVALID_CLASS` | 0x80041010 | The query specifies a class that does not exist. |\n| `WBEMESS_E_REGISTRATION_TOO_PRECISE` | 0x80042002 | Too much precision in delivery of events has been requested. A larger polling tolerance must be specified. |\n| `WBEMESS_E_REGISTRATION_TOO_BROAD` | 0x80042001 | The query requests more information than Windows Management can provide. This `HRESULT` is returned when an event query results in a request to poll all objects in a namespace. |\n| `WBEM_E_INVALID_QUERY` | 0x80041017 | The query had a syntax error. |\n| `WBEM_E_INVALID_QUERY_TYPE` | 0x80041018 | The requested query language is not supported. |\n| `WBEM_E_QUOTA_VIOLATION` | 0x8004106c | The query is too complex. |\n| `WBEM_E_OUT_OF_MEMORY` | 0x80041006 | Not enough memory is available to complete the operation. |\n| `WBEM_E_SHUTTING_DOWN` | 0x80041033 | WMI was probably stopped and restarting. Call [ConnectServerWmi](connectserverwmi.md) again. |\n| `WBEM_E_TRANSPORT_FAILURE` | 0x80041015 | The remote procedure call (RPC) link between the current process and WMI has failed. |\n| `WBEM_E_UNPARSABLE_QUERY` | 0x80041058 | The query cannot be parsed. |\n| `WBEM_S_NO_ERROR` | 0 | The function call was successful.  |\n\n## Remarks\n\nThis function wraps a call to the [IWbemServices::ExecNotificationQuery](/windows/desktop/api/wbemcli/nf-wbemcli-iwbemservices-execnotificationquery) method.\n\nAfter the function returns, the caller periodically passes the returned `ppEnum` object to the [Next](next.md) function to see if any events are available.\n\nThere are limits to the number of `AND` and `OR` keywords that can be used in WQL queries. Large numbers of WQL keywords used in a complex query can cause WMI to return the `WBEM_E_QUOTA_VIOLATION` (or 0x8004106c) error code as an `HRESULT` value. The limit of WQL keywords depends on how complex the query is.\n\nIf the function call fails, you can obtain additional error information by calling the [GetErrorInfo](geterrorinfo.md) function.\n\n## Requirements\n\n**Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md).\n\n**Header:** WMINet_Utils.idl\n\n**.NET Framework Versions:** [!INCLUDE[net_current_v472plus](../../../../includes/net-current-v472plus.md)]\n\n## See also\n\n- [WMI and Performance Counters (Unmanaged API Reference)](index.md)","nodes":[{"pos":[4,492],"embed":true,"restype":"x-metadata","content":"title: ExecNotificationQueryWmi function (Unmanaged API Reference)\ndescription: The ExecNotificationQueryWmi function executes a query to receive events.\nms.date: \"11/06/2017\"\napi_name:\n  - \"ExecNotificationQueryWmi\"\napi_location:\n  - \"WMINet_Utils.dll\"\napi_type:\n  - \"DLLExport\"\nf1_keywords:\n  - \"ExecNotificationQueryWmi\"\nhelpviewer_keywords:\n  - \"ExecNotificationQueryWmi function [.NET WMI and performance counters]\"\ntopic_type:\n  - \"Reference\"\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"","nodes":[{"content":"ExecNotificationQueryWmi function (Unmanaged API Reference)","nodes":[{"pos":[0,59],"content":"ExecNotificationQueryWmi function (Unmanaged API Reference)","nodes":[{"content":"ExecNotificationQueryWmi function (Unmanaged API Reference)","pos":[0,59]}]}],"path":["title"],"nosxs":false},{"content":"The ExecNotificationQueryWmi function executes a query to receive events.","nodes":[{"pos":[0,73],"content":"The ExecNotificationQueryWmi function executes a query to receive events.","nodes":[{"content":"The ExecNotificationQueryWmi function executes a query to receive events.","pos":[0,73]}]}],"path":["description"],"nosxs":false}],"yml":true},{"pos":[500,533],"content":"ExecNotificationQueryWmi function","linkify":"ExecNotificationQueryWmi function","nodes":[{"content":"ExecNotificationQueryWmi function","pos":[0,33]}]},{"content":"Executes a query to receive events.","pos":[535,570]},{"content":"The call returns immediately, and the caller can poll the returned enumerator for events as they arrive.","pos":[571,675]},{"content":"Releasing the returned enumerator cancels the query.","pos":[676,728]},{"pos":[817,823],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[1355,1365],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"[in] A string with the valid query language supported by Windows Management.","pos":[1387,1463]},{"content":"It must be \"WQL\", the acronym for WMI Query Language.","pos":[1464,1517]},{"content":"[in] The text of the query.","pos":[1531,1558]},{"content":"This parameter cannot be <ph id=\"ph1\">`null`</ph>.","pos":[1559,1591],"source":" This parameter cannot be `null`."},{"content":"[in] A combination of the following two flags that affect the behavior of this function.","pos":[1603,1691]},{"content":"These values are defined in the <bpt id=\"p1\">*</bpt>WbemCli.h<ept id=\"p1\">*</ept> header file, or you can define them as constants in your code.","pos":[1692,1798],"source":" These values are defined in the *WbemCli.h* header file, or you can define them as constants in your code."},{"content":"Constant","pos":[1802,1810]},{"content":"Value","pos":[1813,1818]},{"content":"Description","pos":[1822,1833]},{"content":"0x10","pos":[1904,1908]},{"content":"The flag causes a semisynchronous call.","pos":[1911,1950]},{"content":"If this flag is not set, the call fails.","pos":[1951,1991]},{"content":"This is because events are received continuously, which means the user must poll the returned enumerator.","pos":[1992,2097]},{"content":"Blocking this call indefinitely makes that impossible.","pos":[2098,2152]},{"content":"0x20","pos":[2184,2188]},{"content":"The function returns a forward-only enumerator.","pos":[2191,2238]},{"content":"Typically, forward-only enumerators are faster and use less memory than conventional enumerators, but they do not allow calls to <bpt id=\"p1\">[</bpt>Clone<ept id=\"p1\">](clone.md)</ept>.","pos":[2239,2386],"source":" Typically, forward-only enumerators are faster and use less memory than conventional enumerators, but they do not allow calls to [Clone](clone.md)."},{"content":"[in] Typically, this value is <ph id=\"ph1\">`null`</ph>.","pos":[2398,2435],"source":"[in] Typically, this value is `null`."},{"content":"Otherwise, it is a pointer to an <bpt id=\"p1\">[</bpt>IWbemContext<ept id=\"p1\">](/windows/desktop/api/wbemcli/nn-wbemcli-iwbemcontext)</ept> instance that can be used by the provider that is providing the requested events.","pos":[2436,2619],"source":" Otherwise, it is a pointer to an [IWbemContext](/windows/desktop/api/wbemcli/nn-wbemcli-iwbemcontext) instance that can be used by the provider that is providing the requested events."},{"content":"[out] If no error occurs, receives the pointer to the enumerator that allows the caller to retrieve the instances in the query's result set.","pos":[2631,2771]},{"content":"See the <bpt id=\"p1\">[</bpt>Remarks<ept id=\"p1\">](#remarks)</ept> section for more information.","pos":[2772,2829],"source":" See the [Remarks](#remarks) section for more information."},{"content":"[in] The authorization level.","pos":[2844,2873]},{"content":"[in] The impersonation level.","pos":[2887,2916]},{"content":"[in] A pointer to an <bpt id=\"p1\">[</bpt>IWbemServices<ept id=\"p1\">](/windows/desktop/api/wbemcli/nn-wbemcli-iwbemservices)</ept> object that represents the current namespace.","pos":[2939,3076],"source":"[in] A pointer to an [IWbemServices](/windows/desktop/api/wbemcli/nn-wbemcli-iwbemservices) object that represents the current namespace."},{"content":"[in] The user name.","pos":[3089,3108]},{"content":"See the <bpt id=\"p1\">[</bpt>ConnectServerWmi<ept id=\"p1\">](connectserverwmi.md)</ept> function for more information.","pos":[3109,3187],"source":" See the [ConnectServerWmi](connectserverwmi.md) function for more information."},{"content":"[in] The password.","pos":[3204,3222]},{"content":"See the <bpt id=\"p1\">[</bpt>ConnectServerWmi<ept id=\"p1\">](connectserverwmi.md)</ept> function for more information.","pos":[3223,3301],"source":" See the [ConnectServerWmi](connectserverwmi.md) function for more information."},{"content":"[in] The domain name of the user.","pos":[3319,3352]},{"content":"See the <bpt id=\"p1\">[</bpt>ConnectServerWmi<ept id=\"p1\">](connectserverwmi.md)</ept> function for more information.","pos":[3353,3431],"source":" See the [ConnectServerWmi](connectserverwmi.md) function for more information."},{"pos":[3436,3448],"content":"Return value","linkify":"Return value","nodes":[{"content":"Return value","pos":[0,12]}]},{"pos":[3450,3590],"content":"The following values returned by this function are defined in the <bpt id=\"p1\">*</bpt>WbemCli.h<ept id=\"p1\">*</ept> header file, or you can define them as constants in your code:","source":"The following values returned by this function are defined in the *WbemCli.h* header file, or you can define them as constants in your code:"},{"content":"Constant","pos":[3593,3601]},{"content":"Value","pos":[3604,3609]},{"content":"Description","pos":[3612,3623]},{"content":"0x80041003","pos":[3686,3696]},{"content":"The user does not have permission to view one or more of the classes that the function can return.","pos":[3699,3797]},{"content":"0x80041001","pos":[3820,3830]},{"content":"An unspecified error has occurred.","pos":[3833,3867]},{"content":"0x80041008","pos":[3901,3911]},{"content":"A parameter is not valid.","pos":[3914,3939]},{"content":"0x80041010","pos":[3969,3979]},{"content":"The query specifies a class that does not exist.","pos":[3982,4030]},{"content":"0x80042002","pos":[4074,4084]},{"content":"Too much precision in delivery of events has been requested.","pos":[4087,4147]},{"content":"A larger polling tolerance must be specified.","pos":[4148,4193]},{"content":"0x80042001","pos":[4235,4245]},{"content":"The query requests more information than Windows Management can provide.","pos":[4248,4320]},{"content":"This <ph id=\"ph1\">`HRESULT`</ph> is returned when an event query results in a request to poll all objects in a namespace.","pos":[4321,4424],"source":" This `HRESULT` is returned when an event query results in a request to poll all objects in a namespace."},{"content":"0x80041017","pos":[4454,4464]},{"content":"The query had a syntax error.","pos":[4467,4496]},{"content":"0x80041018","pos":[4531,4541]},{"content":"The requested query language is not supported.","pos":[4544,4590]},{"content":"0x8004106c","pos":[4622,4632]},{"content":"The query is too complex.","pos":[4635,4660]},{"content":"0x80041006","pos":[4690,4700]},{"content":"Not enough memory is available to complete the operation.","pos":[4703,4760]},{"content":"0x80041033","pos":[4790,4800]},{"content":"WMI was probably stopped and restarting.","pos":[4803,4843]},{"content":"Call <bpt id=\"p1\">[</bpt>ConnectServerWmi<ept id=\"p1\">](connectserverwmi.md)</ept> again.","pos":[4844,4895],"source":" Call [ConnectServerWmi](connectserverwmi.md) again."},{"content":"0x80041015","pos":[4929,4939]},{"content":"The remote procedure call (RPC) link between the current process and WMI has failed.","pos":[4942,5026]},{"content":"0x80041058","pos":[5059,5069]},{"content":"The query cannot be parsed.","pos":[5072,5099]},{"content":"0","pos":[5124,5125]},{"content":"The function call was successful.","pos":[5128,5161]},{"pos":[5169,5176],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"pos":[5178,5335],"content":"This function wraps a call to the <bpt id=\"p1\">[</bpt>IWbemServices::ExecNotificationQuery<ept id=\"p1\">](/windows/desktop/api/wbemcli/nf-wbemcli-iwbemservices-execnotificationquery)</ept> method.","source":"This function wraps a call to the [IWbemServices::ExecNotificationQuery](/windows/desktop/api/wbemcli/nf-wbemcli-iwbemservices-execnotificationquery) method."},{"pos":[5337,5492],"content":"After the function returns, the caller periodically passes the returned <ph id=\"ph1\">`ppEnum`</ph> object to the <bpt id=\"p1\">[</bpt>Next<ept id=\"p1\">](next.md)</ept> function to see if any events are available.","source":"After the function returns, the caller periodically passes the returned `ppEnum` object to the [Next](next.md) function to see if any events are available."},{"content":"There are limits to the number of <ph id=\"ph1\">`AND`</ph> and <ph id=\"ph2\">`OR`</ph> keywords that can be used in WQL queries.","pos":[5494,5584],"source":"There are limits to the number of `AND` and `OR` keywords that can be used in WQL queries."},{"content":"Large numbers of WQL keywords used in a complex query can cause WMI to return the <ph id=\"ph1\">`WBEM_E_QUOTA_VIOLATION`</ph> (or 0x8004106c) error code as an <ph id=\"ph2\">`HRESULT`</ph> value.","pos":[5585,5741],"source":" Large numbers of WQL keywords used in a complex query can cause WMI to return the `WBEM_E_QUOTA_VIOLATION` (or 0x8004106c) error code as an `HRESULT` value."},{"content":"The limit of WQL keywords depends on how complex the query is.","pos":[5742,5804]},{"pos":[5806,5934],"content":"If the function call fails, you can obtain additional error information by calling the <bpt id=\"p1\">[</bpt>GetErrorInfo<ept id=\"p1\">](geterrorinfo.md)</ept> function.","source":"If the function call fails, you can obtain additional error information by calling the [GetErrorInfo](geterrorinfo.md) function."},{"pos":[5939,5951],"content":"Requirements","linkify":"Requirements","nodes":[{"content":"Requirements","pos":[0,12]}]},{"pos":[5953,6057],"content":"<bpt id=\"p1\">**</bpt>Platforms:<ept id=\"p1\">**</ept> See <bpt id=\"p2\">[</bpt>System Requirements<ept id=\"p2\">](../../../../docs/framework/get-started/system-requirements.md)</ept>.","source":"**Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md)."},{"pos":[6059,6087],"content":"<bpt id=\"p1\">**</bpt>Header:<ept id=\"p1\">**</ept> WMINet_Utils.idl","source":"**Header:** WMINet_Utils.idl"},{"pos":[6089,6196],"content":"<bpt id=\"p1\">**</bpt>.NET Framework Versions:<ept id=\"p1\">**</ept> <ph id=\"ph1\">[!INCLUDE[net_current_v472plus](../../../../includes/net-current-v472plus.md)]</ph>","source":"**.NET Framework Versions:** [!INCLUDE[net_current_v472plus](../../../../includes/net-current-v472plus.md)]"},{"pos":[6201,6209],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6213,6279],"content":"<bpt id=\"p1\">[</bpt>WMI and Performance Counters (Unmanaged API Reference)<ept id=\"p1\">](index.md)</ept>","source":"[WMI and Performance Counters (Unmanaged API Reference)](index.md)"}]}