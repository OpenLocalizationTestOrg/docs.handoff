{"content":"---\ntitle: \"Advanced Error Handling | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: ed54b687-78af-4eda-8507-9fd081bdea1a\ncaps.latest.revision: 21\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Advanced Error Handling\nThis sample demonstrates the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] routing service. The routing service is a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] component that makes it easy to include a content-based router in your application. This sample shows how the routing service intelligently recovers from errors, using transactions and other more complex messaging concepts such as multicasting.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\RoutingServices\\AdvancedErrorHandling`  \n  \n## Sample Details  \n In this sample, the routing service is configured to read a message from an MSMQ queue and multicast this message to two lists of queues. One list is used for service queues and another is used for logging queues.  \n  \n Because, by default, the MSMQ binding that the routing service is configured to use supports the use of transactions, the routing service makes sure that the message is transactional and received by at least one queue in each list before reporting to the Inbound Queue (`InQ`) that the message was successfully routed. Thus, in the case where both of the service queues or both of the logging queues are unavailable, the routing service reports that the message could not be routed and the inbound queue should take some action. This action consists of moving the message to the system dead letter queue.  \n  \n#### To use this sample  \n  \n1.  > [!IMPORTANT]\n    >  Install MSMQ before running this sample. If MSMQ is not installed, an exception message is returned when running the sample. Instructions for installing MSMQ can be found at [Installing Message Queuing (MSMQ)](http://go.microsoft.com/fwlink/?LinkId=166437).  \n  \n     Using [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], open AdvancedErrorHandling.sln.  \n  \n2.  Press **F5** or **CTRL+SHIFT+B** in [!INCLUDE[vs_current_short](../../../../includes/vs-current-short-md.md)].  \n  \n    1.  If you build the application with CTRL+SHIFT+B, you must start the application at ./RoutingService/bin/debug/RoutingService.exe.  \n  \n3.  In the console window, press ENTER to start the client.  \n  \n4.  The client returns different statistics about the queues for each case.  \n  \n    1.  The following is the output returned for case 1 (no failures).  \n  \n        ```Output  \n        The inbound queue has 0 messages.  \n        The primary service queue has 1 messages.   \n        The backup service queue has 0 messages.   \n        The primary logging queue has 1 messages.   \n        The backup logging queue has 0 messages.   \n        Press <Enter> to continue  \n  \n        ```  \n  \n    2.  The following is the output returned for case 3 (primary service and logging queue failures).  \n  \n        ```Output  \n        The inbound queue has 0 messages.   \n        The primary service queue does not exist.   \n        The backup service queue has 1 messages.   \n        The primary logging queue does not exist.   \n        The backup logging queue has 1 messages.   \n        Press <ENTER> to continue.  \n  \n        ```  \n  \n    3.  The following is the output returned for case 4 (primary service queue and primary and backup logging queue failures).  \n  \n        ```Output  \n        The inbound queue has 0 messages.   \n        The primary service queue does not exist.  \n        The backup service queue has 0 messages.   \n        The primary logging queue does not exist.   \n        The backup logging queue does not exist.   \n        The System Dead Letter queue has 1 messages.   \n        Press <ENTER> to Quit.  \n  \n        ```  \n  \n    4.  The following is the output returned for case 2 (primary service queue failure).  \n  \n        ```Output  \n        The inbound queue has 0 messages.   \n        The primary service queue does not exist.  \n        The backup service queue has 1 messages.   \n        The primary logging queue has 1 messages.   \n        The backup logging queue has 0 messages.   \n        Press <ENTER> to continue.  \n  \n        ```  \n  \n## Configurable Via Code or App.config  \n The sample ships configured to use an App.config file to define the router’s behavior. You can also change the name of the RoutingService\\App.config file to something else so that it is not recognized and change the value of the `configDriven` field in RoutingService\\Program.cs to `false` to use the configuration defined in the code. Either method results in the same behavior from the router.  \n  \n### Scenario  \n This sample demonstrates that the routing service can handle advanced messaging capabilities, such as transactions and receive context, and that it can utilize these capabilities as a part of correctly handling error scenarios.  \n  \n### Real World Scenario  \n Contoso wants to utilize transactional receives through the routing service to ensure that all necessary services receive information even during error conditions. Furthermore, they would like errors to be handled correctly and automatically and failures to be reported in the case that a message is undeliverable even when error handling logic is utilized. For this purpose, they configure the routing service to fail over to specific endpoints as expected and the routing service handles the error situations, which includes the creation, completion, and rollback/aborting of transactions/receive contexts as necessary.  \n  \n## See Also  \n [AppFabric Hosting and Persistence Samples](http://go.microsoft.com/fwlink/?LinkId=193961)","nodes":[{"pos":[12,52],"content":"Advanced Error Handling | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Advanced Error Handling | Microsoft Docs","pos":[0,40]}]},{"pos":[351,374],"content":"Advanced Error Handling","linkify":"Advanced Error Handling","nodes":[{"content":"Advanced Error Handling","pos":[0,23]}]},{"content":"This sample demonstrates the <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> routing service.","pos":[375,476],"source":"This sample demonstrates the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] routing service."},{"content":"The routing service is a <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> component that makes it easy to include a content-based router in your application.","pos":[477,641],"source":" The routing service is a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] component that makes it easy to include a content-based router in your application."},{"content":"This sample shows how the routing service intelligently recovers from errors, using transactions and other more complex messaging concepts such as multicasting.","pos":[642,802]},{"pos":[810,942],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[996,1322],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[1323,1373]},{"pos":[1473,1487],"content":"Sample Details","linkify":"Sample Details","nodes":[{"content":"Sample Details","pos":[0,14]}]},{"content":"In this sample, the routing service is configured to read a message from an MSMQ queue and multicast this message to two lists of queues.","pos":[1491,1628]},{"content":"One list is used for service queues and another is used for logging queues.","pos":[1629,1704]},{"content":"Because, by default, the MSMQ binding that the routing service is configured to use supports the use of transactions, the routing service makes sure that the message is transactional and received by at least one queue in each list before reporting to the Inbound Queue (<ph id=\"ph1\">`InQ`</ph>) that the message was successfully routed.","pos":[1711,2029],"source":"Because, by default, the MSMQ binding that the routing service is configured to use supports the use of transactions, the routing service makes sure that the message is transactional and received by at least one queue in each list before reporting to the Inbound Queue (`InQ`) that the message was successfully routed."},{"content":"Thus, in the case where both of the service queues or both of the logging queues are unavailable, the routing service reports that the message could not be routed and the inbound queue should take some action.","pos":[2030,2239]},{"content":"This action consists of moving the message to the system dead letter queue.","pos":[2240,2315]},{"pos":[2326,2344],"content":"To use this sample","linkify":"To use this sample","nodes":[{"content":"To use this sample","pos":[0,18]}]},{"pos":[2356,2633],"content":"[!IMPORTANT]\nInstall MSMQ before running this sample. If MSMQ is not installed, an exception message is returned when running the sample. Instructions for installing MSMQ can be found at [Installing Message Queuing (MSMQ)](http://go.microsoft.com/fwlink/?LinkId=166437).","leadings":["","    >  "],"nodes":[{"content":"Install MSMQ before running this sample. If MSMQ is not installed, an exception message is returned when running the sample. Instructions for installing MSMQ can be found at [Installing Message Queuing (MSMQ)](http://go.microsoft.com/fwlink/?LinkId=166437).","pos":[13,270],"nodes":[{"content":"Install MSMQ before running this sample.","pos":[0,40]},{"content":"If MSMQ is not installed, an exception message is returned when running the sample.","pos":[41,124]},{"content":"Instructions for installing MSMQ can be found at <bpt id=\"p1\">[</bpt>Installing Message Queuing (MSMQ)<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=166437)</ept>.","pos":[125,257],"source":" Instructions for installing MSMQ can be found at [Installing Message Queuing (MSMQ)](http://go.microsoft.com/fwlink/?LinkId=166437)."}]}]},{"pos":[2644,2754],"content":"Using <ph id=\"ph1\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph>, open AdvancedErrorHandling.sln.","source":"Using [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], open AdvancedErrorHandling.sln."},{"pos":[2764,2874],"content":"Press <bpt id=\"p1\">**</bpt>F5<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>CTRL+SHIFT+B<ept id=\"p2\">**</ept> in <ph id=\"ph1\">[!INCLUDE[vs_current_short](../../../../includes/vs-current-short-md.md)]</ph>.","source":"Press **F5** or **CTRL+SHIFT+B** in [!INCLUDE[vs_current_short](../../../../includes/vs-current-short-md.md)]."},{"content":"If you build the application with CTRL+SHIFT+B, you must start the application at ./RoutingService/bin/debug/RoutingService.exe.","pos":[2888,3016]},{"content":"In the console window, press ENTER to start the client.","pos":[3026,3081]},{"content":"The client returns different statistics about the queues for each case.","pos":[3091,3162]},{"content":"The following is the output returned for case 1 (no failures).","pos":[3176,3238]},{"content":"The following is the output returned for case 3 (primary service and logging queue failures).","pos":[3582,3675]},{"content":"The following is the output returned for case 4 (primary service queue and primary and backup logging queue failures).","pos":[4021,4139]},{"content":"The following is the output returned for case 2 (primary service queue failure).","pos":[4536,4616]},{"pos":[4956,4991],"content":"Configurable Via Code or App.config","linkify":"Configurable Via Code or App.config","nodes":[{"content":"Configurable Via Code or App.config","pos":[0,35]}]},{"content":"The sample ships configured to use an App.config file to define the router’s behavior.","pos":[4995,5081]},{"content":"You can also change the name of the RoutingService\\App.config file to something else so that it is not recognized and change the value of the <ph id=\"ph1\">`configDriven`</ph> field in RoutingService\\Program.cs to <ph id=\"ph2\">`false`</ph> to use the configuration defined in the code.","pos":[5082,5330],"source":" You can also change the name of the RoutingService\\App.config file to something else so that it is not recognized and change the value of the `configDriven` field in RoutingService\\Program.cs to `false` to use the configuration defined in the code."},{"content":"Either method results in the same behavior from the router.","pos":[5331,5390]},{"pos":[5400,5408],"content":"Scenario","linkify":"Scenario","nodes":[{"content":"Scenario","pos":[0,8]}]},{"content":"This sample demonstrates that the routing service can handle advanced messaging capabilities, such as transactions and receive context, and that it can utilize these capabilities as a part of correctly handling error scenarios.","pos":[5412,5639]},{"pos":[5649,5668],"content":"Real World Scenario","linkify":"Real World Scenario","nodes":[{"content":"Real World Scenario","pos":[0,19]}]},{"content":"Contoso wants to utilize transactional receives through the routing service to ensure that all necessary services receive information even during error conditions.","pos":[5672,5835]},{"content":"Furthermore, they would like errors to be handled correctly and automatically and failures to be reported in the case that a message is undeliverable even when error handling logic is utilized.","pos":[5836,6029]},{"content":"For this purpose, they configure the routing service to fail over to specific endpoints as expected and the routing service handles the error situations, which includes the creation, completion, and rollback/aborting of transactions/receive contexts as necessary.","pos":[6030,6293]},{"pos":[6302,6310],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[6314,6404],"content":"<bpt id=\"p1\">[</bpt>AppFabric Hosting and Persistence Samples<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=193961)</ept>","source":"[AppFabric Hosting and Persistence Samples](http://go.microsoft.com/fwlink/?LinkId=193961)"}]}