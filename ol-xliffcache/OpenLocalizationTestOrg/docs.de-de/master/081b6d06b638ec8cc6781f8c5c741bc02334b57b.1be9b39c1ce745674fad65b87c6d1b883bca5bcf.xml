{"content":"---\ntitle: \"Using the Discovery Client Channel | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 1494242a-1d64-4035-8ecd-eb4f06c8d2ba\ncaps.latest.revision: 6\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Using the Discovery Client Channel\nWhen writing a WCF client application you need to know the endpoint address of the service you are calling. In many situations the endpoint address of a service is not known in advance or the address of the service changes over time. The Discovery Client Channel allows you to write a WCF client application, describe the service you want to call, and the client channel automatically sends a probe request. When a service responds, the discovery client channel retrieves the endpoint address for the service from the probe response and uses it to call the service.  \n  \n## Using the Discovery Client Channel  \n To use the Discovery Client Channel, add an instance of the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> to your client channel stack. Alternatively you can use the <xref:System.ServiceModel.Discovery.DynamicEndpoint> and a <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> is automatically added to your binding if not already present.  \n  \n> [!CAUTION]\n>  It is recommended that the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> is the top-most element on your client channel stack. Any binding element that is added on top of the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> must make sure that the <xref:System.ServiceModel.ChannelFactory> or channel it creates does not use the endpoint address or `Via` address (passed to the `CreateChannel` method) because they may not contain the correct address.  \n  \n The <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> class contains two public properties:  \n  \n1.  <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.FindCriteria%2A>, which is used to describe the service you want to call.  \n  \n2.  <!--zz <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.DiscoveryEndpoint%2A>  --> `DiscoveryEndpoint`, which specifies the discovery endpoint to send discovery messages to.  \n  \n The <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.FindCriteria%2A> property allows you to specify the service contract you are searching for, any required scope URIs, and the maximum number of time to attempt to open the channel. The contract type is specified by calling the constructor <<!--zz <xref:System.ServiceModel.Discovery.FindCriteria%2A>  --> `FindCriteria`> . Scope URIs can be added to the <xref:System.ServiceModel.Discovery.FindCriteria.Scopes%2A> property. The <xref:System.ServiceModel.Discovery.FindCriteria.MaxResults%2A> property allows you to specify the maximum number of results to which the client tries to connect to. When a probe response is received the client attempts to open the channel using the endpoint address from the probe response. If an exception occurs the client moves on to the next probe response, waiting for more responses to be received if necessary. It continues to do this until the channel is successfully opened or the maximum number of results is reached. [!INCLUDE[crabout](../../../../includes/crabout-md.md)]these settings, see <<!--zz <xref:System.ServiceModel.Discovery.FindCriteria%2A>  --> `FindCriteria`>.  \n  \n The <!--zz <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.DiscoveryEndpoint%2A>  --> `DiscoveryEndpoint%2A>` property allows you to specify the discovery endpoint to use. Normally this is a <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint>, but it can be any valid endpoint.  \n  \n When you are creating the binding to use to communicate with the service, you must be careful to use the exact same binding as the service. The only difference is the client binding has a <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> on the top of the stack. If service is using one of the system-provided bindings, create a new <xref:System.ServiceModel.Channels.CustomBinding> and pass in the system-provided binding to the <!--zz <xref:System.ServiceModel.CustomBinding.CustomBinding%2A> `CustomBinding` --> constructor. Then you can add the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> by calling `Insert` on the <!--zz <xref:System.ServiceModel.Channels.Binding.Elements%2A> --> `Elements` property.  \n  \n Once you have added the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> to your binding and configured it, you can create an instance of the WCF client class, open it, and call its methods. The following example uses the Discovery Client Channel to discover a WCF service that implements the `ICalculator` class (used in the Getting Started WCF tutorial) and calls its `Add` method.  \n  \n```  \n// Create the DiscoveryClientBindingElement  \nDiscoveryClientBindingElement bindingElement = new DiscoveryClientBindingElement();  \n// Search for a service that implements the ICalculator interface, attempting to open  \n// the channel a maximum of 2 times  \nbindingElement.FindCriteria = new FindCriteria(typeof(ICalculator)) { MaxResults = 2 };  \n// Use the UdpDiscoveryEndpoint  \nbindingElement.DiscoveryEndpoint = new UdpDiscoveryEndpoint();  \n  \n// The service uses the BasicHttpBinding, so use that and insert the DiscoveryClientBindingElement at the   \n// top of the stack  \nCustomBinding binding = new CustomBinding(new BasicHttpBinding());  \nbinding.Elements.Insert(0,bindingElement);  \n  \ntry  \n{  \n    // Create the WCF client and call a method  \n    CalculatorClient client = new CalculatorClient(binding, new EndpointAddress(\"http://schemas.microsoft.com/dynamic\"));  \n    client.Open();  \n    client.Add(1, 1);  \n}  \ncatch (EndpointNotFoundException ex)  \n{  \n    Console.WriteLine(\"An exception occurred: \" + ex.Message);  \n}  \n```  \n  \n## Security and the Discovery Client Channel  \n When using the discovery client channel, two endpoints are being specified. One is used for discovery messages, usually <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint>, and the other is the application endpoint. When implementing a secure service, care must be taken to secure both endpoints. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] security, see [Securing Services and Clients](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md).","nodes":[{"pos":[12,63],"content":"Using the Discovery Client Channel | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Using the Discovery Client Channel | Microsoft Docs","pos":[0,51]}]},{"pos":[361,395],"content":"Using the Discovery Client Channel","linkify":"Using the Discovery Client Channel","nodes":[{"content":"Using the Discovery Client Channel","pos":[0,34]}]},{"content":"When writing a WCF client application you need to know the endpoint address of the service you are calling.","pos":[396,503]},{"content":"In many situations the endpoint address of a service is not known in advance or the address of the service changes over time.","pos":[504,629]},{"content":"The Discovery Client Channel allows you to write a WCF client application, describe the service you want to call, and the client channel automatically sends a probe request.","pos":[630,803]},{"content":"When a service responds, the discovery client channel retrieves the endpoint address for the service from the probe response and uses it to call the service.","pos":[804,961]},{"pos":[970,1004],"content":"Using the Discovery Client Channel","linkify":"Using the Discovery Client Channel","nodes":[{"content":"Using the Discovery Client Channel","pos":[0,34]}]},{"content":"To use the Discovery Client Channel, add an instance of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement&gt;</ph> to your client channel stack.","pos":[1008,1164],"source":"To use the Discovery Client Channel, add an instance of the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> to your client channel stack."},{"content":"Alternatively you can use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DynamicEndpoint&gt;</ph> and a <ph id=\"ph2\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement&gt;</ph> is automatically added to your binding if not already present.","pos":[1165,1383],"source":" Alternatively you can use the <xref:System.ServiceModel.Discovery.DynamicEndpoint> and a <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> is automatically added to your binding if not already present."},{"pos":[1391,1895],"content":"[!CAUTION]\n It is recommended that the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> is the top-most element on your client channel stack. Any binding element that is added on top of the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> must make sure that the <xref:System.ServiceModel.ChannelFactory> or channel it creates does not use the endpoint address or `Via` address (passed to the `CreateChannel` method) because they may not contain the correct address.","leadings":["","> "],"nodes":[{"content":" It is recommended that the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> is the top-most element on your client channel stack. Any binding element that is added on top of the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> must make sure that the <xref:System.ServiceModel.ChannelFactory> or channel it creates does not use the endpoint address or `Via` address (passed to the `CreateChannel` method) because they may not contain the correct address.","pos":[11,502],"nodes":[{"content":"It is recommended that the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement&gt;</ph> is the top-most element on your client channel stack.","pos":[1,148],"source":" It is recommended that the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> is the top-most element on your client channel stack."},{"content":"Any binding element that is added on top of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement&gt;</ph> must make sure that the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ChannelFactory&gt;</ph> or channel it creates does not use the endpoint address or <ph id=\"ph3\">`Via`</ph> address (passed to the <ph id=\"ph4\">`CreateChannel`</ph> method) because they may not contain the correct address.","pos":[149,491],"source":" Any binding element that is added on top of the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> must make sure that the <xref:System.ServiceModel.ChannelFactory> or channel it creates does not use the endpoint address or `Via` address (passed to the `CreateChannel` method) because they may not contain the correct address."}]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement&gt;</ph> class contains two public properties:","pos":[1902,2010],"source":"The <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> class contains two public properties:"},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.FindCriteria%2A&gt;</ph>, which is used to describe the service you want to call.","pos":[2020,2159],"source":"<xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.FindCriteria%2A>, which is used to describe the service you want to call."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.FindCriteria%2A&gt;</ph> property allows you to specify the service contract you are searching for, any required scope URIs, and the maximum number of time to attempt to open the channel.","pos":[2366,2615],"source":"The <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.FindCriteria%2A> property allows you to specify the service contract you are searching for, any required scope URIs, and the maximum number of time to attempt to open the channel."},{"content":"The contract type is specified by calling the constructor &lt;<ph id=\"ph1\">&lt;!--zz &lt;xref:System.ServiceModel.Discovery.FindCriteria%2A&gt;  --&gt;</ph> <ph id=\"ph2\">`FindCriteria`</ph>&gt; .","pos":[2616,2757],"source":" The contract type is specified by calling the constructor <<!--zz <xref:System.ServiceModel.Discovery.FindCriteria%2A>  --> `FindCriteria`> ."},{"content":"Scope URIs can be added to the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.FindCriteria.Scopes%2A&gt;</ph> property.","pos":[2758,2858],"source":" Scope URIs can be added to the <xref:System.ServiceModel.Discovery.FindCriteria.Scopes%2A> property."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.FindCriteria.MaxResults%2A&gt;</ph> property allows you to specify the maximum number of results to which the client tries to connect to.","pos":[2859,3028],"source":" The <xref:System.ServiceModel.Discovery.FindCriteria.MaxResults%2A> property allows you to specify the maximum number of results to which the client tries to connect to."},{"content":"When a probe response is received the client attempts to open the channel using the endpoint address from the probe response.","pos":[3029,3154]},{"content":"If an exception occurs the client moves on to the next probe response, waiting for more responses to be received if necessary.","pos":[3155,3281]},{"content":"It continues to do this until the channel is successfully opened or the maximum number of results is reached.","pos":[3282,3391]},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph>these settings, see &lt;<ph id=\"ph2\">&lt;!--zz &lt;xref:System.ServiceModel.Discovery.FindCriteria%2A&gt;  --&gt;</ph> <ph id=\"ph3\">`FindCriteria`</ph>&gt;.","pos":[3392,3549],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)]these settings, see <<!--zz <xref:System.ServiceModel.Discovery.FindCriteria%2A>  --> `FindCriteria`>."},{"content":"The <ph id=\"ph1\">&lt;!--zz &lt;xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.DiscoveryEndpoint%2A&gt;  --&gt;</ph> <ph id=\"ph2\">`DiscoveryEndpoint%2A&gt;`</ph> property allows you to specify the discovery endpoint to use.","pos":[3556,3745],"source":"The <!--zz <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement.DiscoveryEndpoint%2A>  --> `DiscoveryEndpoint%2A>` property allows you to specify the discovery endpoint to use."},{"content":"Normally this is a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint&gt;</ph>, but it can be any valid endpoint.","pos":[3746,3857],"source":" Normally this is a <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint>, but it can be any valid endpoint."},{"content":"When you are creating the binding to use to communicate with the service, you must be careful to use the exact same binding as the service.","pos":[3864,4003]},{"content":"The only difference is the client binding has a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement&gt;</ph> on the top of the stack.","pos":[4004,4143],"source":" The only difference is the client binding has a <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> on the top of the stack."},{"content":"If service is using one of the system-provided bindings, create a new <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.CustomBinding&gt;</ph> and pass in the system-provided binding to the <ph id=\"ph2\">&lt;!--zz &lt;xref:System.ServiceModel.CustomBinding.CustomBinding%2A&gt; `CustomBinding` --&gt;</ph> constructor.","pos":[4144,4408],"source":" If service is using one of the system-provided bindings, create a new <xref:System.ServiceModel.Channels.CustomBinding> and pass in the system-provided binding to the <!--zz <xref:System.ServiceModel.CustomBinding.CustomBinding%2A> `CustomBinding` --> constructor."},{"content":"Then you can add the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement&gt;</ph> by calling <ph id=\"ph2\">`Insert`</ph> on the <ph id=\"ph3\">&lt;!--zz &lt;xref:System.ServiceModel.Channels.Binding.Elements%2A&gt; --&gt;</ph> <ph id=\"ph4\">`Elements`</ph> property.","pos":[4409,4611],"source":" Then you can add the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> by calling `Insert` on the <!--zz <xref:System.ServiceModel.Channels.Binding.Elements%2A> --> `Elements` property."},{"content":"Once you have added the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement&gt;</ph> to your binding and configured it, you can create an instance of the WCF client class, open it, and call its methods.","pos":[4618,4826],"source":"Once you have added the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> to your binding and configured it, you can create an instance of the WCF client class, open it, and call its methods."},{"content":"The following example uses the Discovery Client Channel to discover a WCF service that implements the <ph id=\"ph1\">`ICalculator`</ph> class (used in the Getting Started WCF tutorial) and calls its <ph id=\"ph2\">`Add`</ph> method.","pos":[4827,5019],"source":" The following example uses the Discovery Client Channel to discover a WCF service that implements the `ICalculator` class (used in the Getting Started WCF tutorial) and calls its `Add` method."},{"pos":[6085,6126],"content":"Security and the Discovery Client Channel","linkify":"Security and the Discovery Client Channel","nodes":[{"content":"Security and the Discovery Client Channel","pos":[0,41]}]},{"content":"When using the discovery client channel, two endpoints are being specified.","pos":[6130,6205]},{"content":"One is used for discovery messages, usually <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint&gt;</ph>, and the other is the application endpoint.","pos":[6206,6351],"source":" One is used for discovery messages, usually <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint>, and the other is the application endpoint."},{"content":"When implementing a secure service, care must be taken to secure both endpoints.","pos":[6352,6432]},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> security, see <bpt id=\"p1\">[</bpt>Securing Services and Clients<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)</ept>.","pos":[6433,6616],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] security, see [Securing Services and Clients](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)."}]}