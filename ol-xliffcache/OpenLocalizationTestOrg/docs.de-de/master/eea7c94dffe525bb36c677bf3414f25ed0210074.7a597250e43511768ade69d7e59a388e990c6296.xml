{"content":"---\ntitle: \"Thread Pooling (Visual Basic) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"2015-07-20\"\nms.prod: .net\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-visual-basic\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\nms.assetid: 4903fb7a-eaad-435a-9add-1d1b32de3b83\ncaps.latest.revision: 4\nauthor: dotnet-bot\nms.author: dotnetcontent\n\ntranslation.priority.mt: \n  - \"cs-cz\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"tr-tr\"\n---\n# Thread Pooling (Visual Basic)\nA *thread pool* is a collection of threads that can be used to perform several tasks in the background. (See [Threading (Visual Basic)](../../../../visual-basic/programming-guide/concepts/threading/index.md) for background information.) This leaves the primary thread free to perform other tasks asynchronously.  \n  \n Thread pools are often employed in server applications. Each incoming request is assigned to a thread from the thread pool, so that the request can be processed asynchronously, without tying up the primary thread or delaying the processing of subsequent requests.  \n  \n Once a thread in the pool completes its task, it is returned to a queue of waiting threads, where it can be reused. This reuse enables applications to avoid the cost of creating a new thread for each task.  \n  \n Thread pools typically have a maximum number of threads. If all the threads are busy, additional tasks are put in queue until they can be serviced as threads become available.  \n  \n You can implement your own thread pool, but it is easier to use the thread pool provided by the .NET Framework through the <xref:System.Threading.ThreadPool> class.  \n  \n With thread pooling, you call the <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=fullName> method with a delegate for the procedure you want to run, and Visual Basic creates the thread and runs your procedure.  \n  \n## Thread Pooling Example  \n The following example shows how you can use thread pooling to start several tasks.  \n  \n```vb  \nPublic Sub DoWork()  \n    ' Queue a task.  \n    System.Threading.ThreadPool.QueueUserWorkItem(  \n        New System.Threading.WaitCallback(AddressOf SomeLongTask))  \n    ' Queue another task.  \n    System.Threading.ThreadPool.QueueUserWorkItem(  \n        New System.Threading.WaitCallback(AddressOf AnotherLongTask))  \nEnd Sub  \nPrivate Sub SomeLongTask(ByVal state As Object)  \n    ' Insert code to perform a long task.  \nEnd Sub  \nPrivate Sub AnotherLongTask(ByVal state As Object)  \n    ' Insert code to perform another long task.  \nEnd Sub  \n```  \n  \n One advantage of thread pooling is that you can pass arguments in a state object to the task procedure. If the procedure you are calling requires more than one argument, you can cast a structure or an instance of a class into an `Object` data type.  \n  \n## Thread Pool Parameters and Return Values  \n Returning values from a thread-pool thread is not straightforward. The standard way of returning values from a function call is not allowed because `Sub` procedures are the only type of procedure that can be queued to a thread pool. One way you can provide parameters and return values is by wrapping the parameters, return values, and methods in a wrapper class as described in [Parameters and Return Values for Multithreaded Procedures (Visual Basic)](../../../../visual-basic/programming-guide/concepts/threading/parameters-and-return-values-for-multithreaded-procedures.md).  \n  \n An easer way to provide parameters and return values is by using the optional `ByVal` state object variable of the <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A> method. If you use this variable to pass a reference to an instance of a class, the members of the instance can be modified by the thread-pool thread and used as return values.  \n  \n At first it may not be obvious that you can modify an object referred to by a variable that is passed by value. You can do this because only the object reference is passed by value. When you make changes to members of the object referred to by the object reference, the changes apply to the actual class instance.  \n  \n Structures cannot be used to return values inside state objects. Because structures are value types, changes that the asynchronous process makes do not change the members of the original structure. Use structures to provide parameters when return values are not needed.  \n  \n## See Also  \n <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A>   \n <xref:System.Threading>   \n <xref:System.Threading.ThreadPool>   \n [How to: Use a Thread Pool (Visual Basic)](../../../../visual-basic/programming-guide/concepts/threading/how-to-use-a-thread-pool.md)   \n [Threading (Visual Basic)](../../../../visual-basic/programming-guide/concepts/threading/index.md)   \n [Multithreaded Applications (Visual Basic)](../../../../visual-basic/programming-guide/concepts/threading/multithreaded-applications.md)   \n [Thread Synchronization (Visual Basic)](../../../../visual-basic/programming-guide/concepts/threading/thread-synchronization.md)","nodes":[{"pos":[4,432],"embed":true,"restype":"x-metadata","content":"title: \"Thread Pooling (Visual Basic) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"2015-07-20\"\nms.prod: .net\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-visual-basic\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\nms.assetid: 4903fb7a-eaad-435a-9add-1d1b32de3b83\ncaps.latest.revision: 4\nauthor: dotnet-bot\nms.author: dotnetcontent\n\ntranslation.priority.mt: \n  - \"cs-cz\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"tr-tr\"","nodes":[{"content":"Thread Pooling (Visual Basic) | Microsoft Docs","nodes":[{"pos":[0,46],"content":"Thread Pooling (Visual Basic) | Microsoft Docs","nodes":[{"content":"Thread Pooling (Visual Basic) | Microsoft Docs","pos":[0,46]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[439,468],"content":"Thread Pooling (Visual Basic)","linkify":"Thread Pooling (Visual Basic)","nodes":[{"content":"Thread Pooling (Visual Basic)","pos":[0,29]}]},{"content":"A <bpt id=\"p1\">*</bpt>thread pool<ept id=\"p1\">*</ept> is a collection of threads that can be used to perform several tasks in the background.","pos":[469,572],"source":"A *thread pool* is a collection of threads that can be used to perform several tasks in the background."},{"content":"(See <bpt id=\"p1\">[</bpt>Threading (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/threading/index.md)</ept> for background information.) This leaves the primary thread free to perform other tasks asynchronously.","pos":[573,780],"source":" (See [Threading (Visual Basic)](../../../../visual-basic/programming-guide/concepts/threading/index.md) for background information.) This leaves the primary thread free to perform other tasks asynchronously."},{"content":"Thread pools are often employed in server applications.","pos":[787,842]},{"content":"Each incoming request is assigned to a thread from the thread pool, so that the request can be processed asynchronously, without tying up the primary thread or delaying the processing of subsequent requests.","pos":[843,1050]},{"content":"Once a thread in the pool completes its task, it is returned to a queue of waiting threads, where it can be reused.","pos":[1057,1172]},{"content":"This reuse enables applications to avoid the cost of creating a new thread for each task.","pos":[1173,1262]},{"content":"Thread pools typically have a maximum number of threads.","pos":[1269,1325]},{"content":"If all the threads are busy, additional tasks are put in queue until they can be serviced as threads become available.","pos":[1326,1444]},{"pos":[1451,1615],"content":"You can implement your own thread pool, but it is easier to use the thread pool provided by the .NET Framework through the <ph id=\"ph1\">&lt;xref:System.Threading.ThreadPool&gt;</ph> class.","source":"You can implement your own thread pool, but it is easier to use the thread pool provided by the .NET Framework through the <xref:System.Threading.ThreadPool> class."},{"pos":[1622,1855],"content":"With thread pooling, you call the <ph id=\"ph1\">&lt;xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=fullName&gt;</ph> method with a delegate for the procedure you want to run, and Visual Basic creates the thread and runs your procedure.","source":"With thread pooling, you call the <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=fullName> method with a delegate for the procedure you want to run, and Visual Basic creates the thread and runs your procedure."},{"pos":[1864,1886],"content":"Thread Pooling Example","linkify":"Thread Pooling Example","nodes":[{"content":"Thread Pooling Example","pos":[0,22]}]},{"content":"The following example shows how you can use thread pooling to start several tasks.","pos":[1890,1972]},{"content":"One advantage of thread pooling is that you can pass arguments in a state object to the task procedure.","pos":[2542,2645]},{"content":"If the procedure you are calling requires more than one argument, you can cast a structure or an instance of a class into an <ph id=\"ph1\">`Object`</ph> data type.","pos":[2646,2790],"source":" If the procedure you are calling requires more than one argument, you can cast a structure or an instance of a class into an `Object` data type."},{"pos":[2799,2839],"content":"Thread Pool Parameters and Return Values","linkify":"Thread Pool Parameters and Return Values","nodes":[{"content":"Thread Pool Parameters and Return Values","pos":[0,40]}]},{"content":"Returning values from a thread-pool thread is not straightforward.","pos":[2843,2909]},{"content":"The standard way of returning values from a function call is not allowed because <ph id=\"ph1\">`Sub`</ph> procedures are the only type of procedure that can be queued to a thread pool.","pos":[2910,3075],"source":" The standard way of returning values from a function call is not allowed because `Sub` procedures are the only type of procedure that can be queued to a thread pool."},{"content":"One way you can provide parameters and return values is by wrapping the parameters, return values, and methods in a wrapper class as described in <bpt id=\"p1\">[</bpt>Parameters and Return Values for Multithreaded Procedures (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/threading/parameters-and-return-values-for-multithreaded-procedures.md)</ept>.","pos":[3076,3421],"source":" One way you can provide parameters and return values is by wrapping the parameters, return values, and methods in a wrapper class as described in [Parameters and Return Values for Multithreaded Procedures (Visual Basic)](../../../../visual-basic/programming-guide/concepts/threading/parameters-and-return-values-for-multithreaded-procedures.md)."},{"content":"An easer way to provide parameters and return values is by using the optional <ph id=\"ph1\">`ByVal`</ph> state object variable of the <ph id=\"ph2\">&lt;xref:System.Threading.ThreadPool.QueueUserWorkItem%2A&gt;</ph> method.","pos":[3428,3606],"source":"An easer way to provide parameters and return values is by using the optional `ByVal` state object variable of the <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A> method."},{"content":"If you use this variable to pass a reference to an instance of a class, the members of the instance can be modified by the thread-pool thread and used as return values.","pos":[3607,3775]},{"content":"At first it may not be obvious that you can modify an object referred to by a variable that is passed by value.","pos":[3782,3893]},{"content":"You can do this because only the object reference is passed by value.","pos":[3894,3963]},{"content":"When you make changes to members of the object referred to by the object reference, the changes apply to the actual class instance.","pos":[3964,4095]},{"content":"Structures cannot be used to return values inside state objects.","pos":[4102,4166]},{"content":"Because structures are value types, changes that the asynchronous process makes do not change the members of the original structure.","pos":[4167,4299]},{"content":"Use structures to provide parameters when return values are not needed.","pos":[4300,4371]},{"pos":[4380,4388],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>How to: Use a Thread Pool (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/threading/how-to-use-a-thread-pool.md)</ept><ph id=\"ph1\"> </ph>","pos":[4519,4653],"source":"[How to: Use a Thread Pool (Visual Basic)](../../../../visual-basic/programming-guide/concepts/threading/how-to-use-a-thread-pool.md) "},{"content":"<bpt id=\"p1\">[</bpt>Threading (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/threading/index.md)</ept><ph id=\"ph1\"> </ph>","pos":[4657,4756],"source":"[Threading (Visual Basic)](../../../../visual-basic/programming-guide/concepts/threading/index.md) "},{"content":"<bpt id=\"p1\">[</bpt>Multithreaded Applications (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/threading/multithreaded-applications.md)</ept><ph id=\"ph1\"> </ph>","pos":[4760,4897],"source":"[Multithreaded Applications (Visual Basic)](../../../../visual-basic/programming-guide/concepts/threading/multithreaded-applications.md) "},{"content":"<bpt id=\"p1\">[</bpt>Thread Synchronization (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/threading/thread-synchronization.md)</ept>","pos":[4901,5029],"source":"[Thread Synchronization (Visual Basic)](../../../../visual-basic/programming-guide/concepts/threading/thread-synchronization.md)"}]}