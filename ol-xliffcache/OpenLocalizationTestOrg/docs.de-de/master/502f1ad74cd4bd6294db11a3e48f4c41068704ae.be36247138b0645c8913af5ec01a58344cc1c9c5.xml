{"content":"---\ntitle: \"Queuing in WCF\"\nms.date: \"03/30/2017\"\nms.assetid: e98d76ba-1acf-42cd-b137-0f8214661112\n---\n# Queuing in WCF\nThis section describes how to use queued communication in Windows Communication Foundation (WCF).  \n  \n## Queues as a WCF transport binding  \n In WCF, the contracts specify what is being exchanged. Contracts are business-dependent or application-specific message exchanges. The mechanism used to exchange messages (or the \"how\") is specified in the bindings. Bindings in WCF encapsulate details of the message exchange. They expose configuration knobs for the user to control various aspects of the transport or the protocol that the bindings represent. Queuing in WCF is treated like any other transport binding, which is a big advantage for many queuing applications. Today, many queuing applications are written differently from other remote procedure call (RPC)-style distributed applications, making it harder to follow and maintain. With WCF, the style of writing a distributed application is much the same, making it easier to follow and maintain. Moreover, by factoring out the mechanism of exchange separately from the business logic, it is easier to configure the transport or make changes to it without affecting application specific code. The following figure illustrates the structure of a WCF service and client using MSMQ as a transport.  \n  \n ![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg \"Distributed-Queue-Figure\")  \n  \n As you can see from the preceding figure, the client and service must define only the application semantics, that is, the contract and implementation. The service configures a queued binding with preferred settings. The client uses the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to generate a WCF client to the service and to generate a configuration file that describes the bindings to use to send messages to the service. Thus, to send a queued message, the client instantiates a WCF client and invokes an operation on it. This causes the message to be sent to the transmission queue and transferred to the target queue. All the complexities of queued communication are hidden from the application that is sending and receiving messages.  \n  \n Caveats about queued binding in WCF include:  \n  \n-   All service operations must be one-way because the default queued binding in WCF does not support duplex communication using queues. A two-way communication sample ([Two-Way Communication](../../../../docs/framework/wcf/samples/two-way-communication.md)) illustrates how to use two one-way contracts to implement duplex communication using queues.  \n  \n-   To generate a WCF client using metadata exchange requires an additional HTTP endpoint on the service so that it can be queried directly to generate the WCF client and obtain binding information to appropriately configure queued communication.  \n  \n-   Based on the queued binding, extra configuration outside of WCF is required. For example, the <xref:System.ServiceModel.NetMsmqBinding> class that is shipped with WCF requires you to configure the bindings as well as minimally configure Message Queuing (MSMQ).  \n  \n The following sections describe the specific queued bindings shipped with WCF, which are based on MSMQ.  \n  \n### MSMQ  \n The queued transport in WCF uses MSMQ for its queued communication.  \n  \n MSMQ ships as an optional component with Windows and runs as an NT service. It captures messages for transmission in a transmission queue and for delivery in a target queue. The MSMQ queue managers implement a reliable message-transfer protocol so that messages are not lost in transmission. The protocol can be either native or SOAP-based, such as the SOAP Reliable Message Protocol (SRMP).  \n  \n In MSMQ, queues can be transactional or non-transactional. A transactional queue allows messages to be captured and delivered in a transaction and then stored durably in the queue. Messages sent to a transactional queue are transferred exactly once in order. You can use a non-transactional queue to send both volatile and durable messages. A message sent to a non-transactional queue does not carry any reliable transfer assurances; thus, messages can be lost.  \n  \n MSMQ queues can also be secured using a Windows identity registered with the Active Directory directory service. When installing MSMQ, you can install Active Directory integration, which requires the computer to be part of a Windows domain network.  \n  \n For more information about MSMQ, see [Installing Message Queuing (MSMQ)](../../../../docs/framework/wcf/samples/installing-message-queuing-msmq.md).  \n  \n### NetMsmqBinding  \n The [\\<netMsmqBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/netmsmqbinding.md) is the queued binding WCF provides for two WCF endpoints to communicate using MSMQ. The binding, therefore, exposes properties that are specific to MSMQ. However, not all MSMQ features and properties are exposed in the `NetMsmqBinding`. The compact `NetMsmqBinding` is designed with an optimal set of features that most customers should find sufficient.  \n  \n The `NetMsmqBinding` manifests the core queuing concepts discussed thus far in the form of properties on the bindings. These properties, in turn, communicate to MSMQ how to transfer and deliver the messages. A discussion of the property categories is in the following sections. For more information, see the conceptual topics that describe specific properties more completely.  \n  \n#### ExactlyOnce and Durable Properties  \n The `ExactlyOnce` and `Durable` properties affect how messages are transferred between queues:  \n  \n-   `ExactlyOnce`: When set to `true` (the default), the queued channel ensures that the message, if delivered, is not duplicated. It also ensures that the message is not lost. If the message cannot be delivered, or the message Time-To Live expires before the message can be delivered, the failed message along with the delivery failure reason is recorded in a dead-letter queue. When set to `false`, the queued channel makes an effort to transfer the message. In this case, you can optionally choose a dead-letter queue.  \n  \n-   `Durable:` When set to `true` (the default), the queued channel ensures that MSMQ stores the message durably on disk. Thus, if the MSMQ service were to stop and restart, the messages on disk is transferred to the target queue or delivered to the service. When set to `false`, the messages are stored in volatile store and are lost on stopping and restarting the MSMQ service.  \n  \n For `ExactlyOnce` reliable transfer, MSMQ requires the queue to be transactional. Also, MSMQ requires a transaction to read from a transactional queue. As such, when you use the `NetMsmqBinding`, remember that a transaction is required to send or receive messages when `ExactlyOnce` is set to `true`. Similarly, MSMQ requires the queue to be non-transactional for best-effort assurances, such as when `ExactlyOnce` is `false` and for volatile messaging. Thus, when setting `ExactlyOnce` to `false` or durable to `false`, you cannot send or receive using a transaction.  \n  \n> [!NOTE]\n>  Ensure that the correct queue (transactional or non-transactional) is created based on settings in the bindings. If `ExactlyOnce` is `true`, use a transactional queue; otherwise, use a non-transactional queue.  \n  \n#### Dead-Letter Queue Properties  \n The dead-letter queue is used to store messages that fail delivery. The user can write compensating logic that reads messages out of the dead-letter queue.  \n  \n Many queuing systems provide for a system-wide dead-letter queue. MSMQ provides a system-wide non-transactional dead-letter queue for messages that fail delivery to non-transactional queues and a system-wide transactional dead-letter queue for messages that fail delivery to transactional queues.  \n  \n If multiple clients sending messages to different target queues share the MSMQ service, all messages sent by the clients go to the same dead-letter queue. This is not always preferable. For better isolation, WCF and MSMQ in [!INCLUDE[wv](../../../../includes/wv-md.md)] provide a custom dead-letter queue (or application-specific dead-letter queue) that the user can specify to store messages that fail delivery. Therefore, different clients do not share the same dead-letter queue.  \n  \n The binding has two properties of interest:  \n  \n-   `DeadLetterQueue`: This property is an enumeration that indicates whether a dead-letter queue is requested. The enumeration also contains the kind of dead-letter queue, if one is requested. The values are `None`, `System`, and `Custom`. For more information about the interpretation of these properties, see [Using Dead-Letter Queues to Handle Message Transfer Failures](../../../../docs/framework/wcf/feature-details/using-dead-letter-queues-to-handle-message-transfer-failures.md)  \n  \n-   `CustomDeadLetterQueue`: This property is the Uniform Resource Identifier (URI) address of the application-specific dead-letter queue. This is required if `DeadLetterQueue`.`Custom` is chosen.  \n  \n#### Poison Message Handling properties  \n When the service reads messages from the target queue under a transaction, the service may fail to process the message for various reasons. The message is then put back into the queue to be read again. To deal with messages that fail repeatedly, a set of poison-message handling properties can be configured in the binding. There are four properties: `ReceiveRetryCount`, `MaxRetryCycles`, `RetryCycleDelay`, and `ReceiveErrorHandling`. For more information about these properties, see [Poison Message Handling](../../../../docs/framework/wcf/feature-details/poison-message-handling.md).  \n  \n#### Security Properties  \n MSMQ exposes its own security model, such as access control lists (ACLs) on a queue or sending authenticated messages. The `NetMsmqBinding` exposes these security properties as part of its transport security settings. There are two properties in the binding for transport security: `MsmqAuthenticationMode` and `MsmqProtectionLevel`. Settings in these properties depend on how MSMQ is configured. For more information, see [Securing Messages Using Transport Security](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md).  \n  \n In addition to transport security, the actual SOAP message itself can be secured using message security. For more information, see [Securing Messages Using Message Security](../../../../docs/framework/wcf/feature-details/securing-messages-using-message-security.md).  \n  \n `MsmqTransportSecurity` also exposes two properties, `MsmqEncryptionAlgorithm` and `MsmqHashAlgorithm`. These are enumerations of different algorithms to choose for queue-to-queue transfer encryption of messages and hashing of the signatures.  \n  \n#### Other Properties  \n In addition to the preceding properties, other MSMQ-specific properties exposed in the binding include:  \n  \n-   `UseSourceJournal`: A property to indicate that source journaling is turned on. Source journaling is an MSMQ feature that keeps track of messages that have been successfully transmitted from the transmission queue.  \n  \n-   `UseMsmqTracing`: A property to indicate that MSMQ tracing is turned on. MSMQ tracing sends report messages to a report queue each time a message leaves or arrives at a machine hosting an MSMQ queue manager.  \n  \n-   `QueueTransferProtocol`: An enumeration of the protocol to use for queue-to-queue message transfers. MSMQ implements a native queue-to-queue transfer protocol and a SOAP-based protocol called SOAP Reliable Messaging Protocol (SRMP). SRMP is used when using HTTP transport for queue-to-queue transfers. SRMP secure is used when using HTTPS for queue-to-queue transfers.  \n  \n-   `UseActiveDirectory`: A Boolean value to indicate whether the Active Directory must be used for queue address resolution. By default, this is off. For more information, see [Service Endpoints and Queue Addressing](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md).  \n  \n### MsmqIntegrationBinding  \n The `MsmqIntegrationBinding` is used when you want a WCF endpoint to communicate with an existing MSMQ application written in C, C++, COM, or System.Messaging APIs.  \n  \n The binding properties are the same as for `NetMsmqBinding`. However, the following differences apply:  \n  \n-   The operation contract for `MsmqIntegrationBinding` is restricted to taking a single parameter of type <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> where the type parameter is the body type.  \n  \n-   Much of MSMQ native message properties are exposed in the <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> for use.  \n  \n-   To help with serialization and deserialization of the message body, serializers such as XML and ActiveX are provided.  \n  \n### Sample Code  \n For step by step instructions on how to write WCF services that use MSMQ see the following topics:  \n  \n-   [How to: Exchange Messages with WCF Endpoints and Message Queuing Applications](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-with-wcf-endpoints-and-message-queuing-applications.md)  \n  \n-   [How to: Exchange Queued Messages with WCF Endpoints](../../../../docs/framework/wcf/feature-details/how-to-exchange-queued-messages-with-wcf-endpoints.md)  \n  \n For a completed code sample illustrating the use of MSMQ in WCF see the following topics:  \n  \n-   [Transacted MSMQ Binding](../../../../docs/framework/wcf/samples/transacted-msmq-binding.md)  \n  \n-   [Volatile Queued Communication](../../../../docs/framework/wcf/samples/volatile-queued-communication.md)  \n  \n-   [Dead Letter Queues](../../../../docs/framework/wcf/samples/dead-letter-queues.md)  \n  \n-   [Sessions and Queues](../../../../docs/framework/wcf/samples/sessions-and-queues.md)  \n  \n-   [Two-Way Communication](../../../../docs/framework/wcf/samples/two-way-communication.md) \n  \n-   [SRMP](../../../../docs/framework/wcf/samples/srmp.md)  \n  \n-   [Message Security over Message Queuing](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)  \n  \n## See also\n\n- [Service Endpoints and Queue Addressing](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)\n- [Web Hosting a Queued Application](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md)\n","nodes":[{"pos":[4,98],"embed":true,"restype":"x-metadata","content":"title: \"Queuing in WCF\"\nms.date: \"03/30/2017\"\nms.assetid: e98d76ba-1acf-42cd-b137-0f8214661112","nodes":[{"content":"Queuing in WCF","nodes":[{"pos":[0,14],"content":"Queuing in WCF","nodes":[{"content":"Queuing in WCF","pos":[0,14]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[105,119],"content":"Queuing in WCF","linkify":"Queuing in WCF","nodes":[{"content":"Queuing in WCF","pos":[0,14]}]},{"content":"This section describes how to use queued communication in Windows Communication Foundation (WCF).","pos":[120,217]},{"pos":[226,259],"content":"Queues as a WCF transport binding","linkify":"Queues as a WCF transport binding","nodes":[{"content":"Queues as a WCF transport binding","pos":[0,33]}]},{"content":"In WCF, the contracts specify what is being exchanged.","pos":[263,317]},{"content":"Contracts are business-dependent or application-specific message exchanges.","pos":[318,393]},{"content":"The mechanism used to exchange messages (or the \"how\") is specified in the bindings.","pos":[394,478]},{"content":"Bindings in WCF encapsulate details of the message exchange.","pos":[479,539]},{"content":"They expose configuration knobs for the user to control various aspects of the transport or the protocol that the bindings represent.","pos":[540,673]},{"content":"Queuing in WCF is treated like any other transport binding, which is a big advantage for many queuing applications.","pos":[674,789]},{"content":"Today, many queuing applications are written differently from other remote procedure call (RPC)-style distributed applications, making it harder to follow and maintain.","pos":[790,958]},{"content":"With WCF, the style of writing a distributed application is much the same, making it easier to follow and maintain.","pos":[959,1074]},{"content":"Moreover, by factoring out the mechanism of exchange separately from the business logic, it is easier to configure the transport or make changes to it without affecting application specific code.","pos":[1075,1270]},{"content":"The following figure illustrates the structure of a WCF service and client using MSMQ as a transport.","pos":[1271,1372]},{"pos":[1379,1518],"content":"<bpt id=\"p1\">![</bpt>Queued Application Diagram<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg \"</bpt>Distributed-Queue-Figure<ept id=\"p2\">\")</ept>","source":"![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg \"Distributed-Queue-Figure\")"},{"content":"As you can see from the preceding figure, the client and service must define only the application semantics, that is, the contract and implementation.","pos":[1525,1675]},{"content":"The service configures a queued binding with preferred settings.","pos":[1676,1740]},{"content":"The client uses the <bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept> to generate a WCF client to the service and to generate a configuration file that describes the bindings to use to send messages to the service.","pos":[1741,2038],"source":" The client uses the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to generate a WCF client to the service and to generate a configuration file that describes the bindings to use to send messages to the service."},{"content":"Thus, to send a queued message, the client instantiates a WCF client and invokes an operation on it.","pos":[2039,2139]},{"content":"This causes the message to be sent to the transmission queue and transferred to the target queue.","pos":[2140,2237]},{"content":"All the complexities of queued communication are hidden from the application that is sending and receiving messages.","pos":[2238,2354]},{"content":"Caveats about queued binding in WCF include:","pos":[2361,2405]},{"content":"All service operations must be one-way because the default queued binding in WCF does not support duplex communication using queues.","pos":[2415,2547]},{"content":"A two-way communication sample (<bpt id=\"p1\">[</bpt>Two-Way Communication<ept id=\"p1\">](../../../../docs/framework/wcf/samples/two-way-communication.md)</ept>) illustrates how to use two one-way contracts to implement duplex communication using queues.","pos":[2548,2762],"source":" A two-way communication sample ([Two-Way Communication](../../../../docs/framework/wcf/samples/two-way-communication.md)) illustrates how to use two one-way contracts to implement duplex communication using queues."},{"content":"To generate a WCF client using metadata exchange requires an additional HTTP endpoint on the service so that it can be queried directly to generate the WCF client and obtain binding information to appropriately configure queued communication.","pos":[2772,3014]},{"content":"Based on the queued binding, extra configuration outside of WCF is required.","pos":[3024,3100]},{"content":"For example, the <ph id=\"ph1\">&lt;xref:System.ServiceModel.NetMsmqBinding&gt;</ph> class that is shipped with WCF requires you to configure the bindings as well as minimally configure Message Queuing (MSMQ).","pos":[3101,3284],"source":" For example, the <xref:System.ServiceModel.NetMsmqBinding> class that is shipped with WCF requires you to configure the bindings as well as minimally configure Message Queuing (MSMQ)."},{"content":"The following sections describe the specific queued bindings shipped with WCF, which are based on MSMQ.","pos":[3291,3394]},{"pos":[3404,3408],"content":"MSMQ","linkify":"MSMQ","nodes":[{"content":"MSMQ","pos":[0,4]}]},{"content":"The queued transport in WCF uses MSMQ for its queued communication.","pos":[3412,3479]},{"content":"MSMQ ships as an optional component with Windows and runs as an NT service.","pos":[3486,3561]},{"content":"It captures messages for transmission in a transmission queue and for delivery in a target queue.","pos":[3562,3659]},{"content":"The MSMQ queue managers implement a reliable message-transfer protocol so that messages are not lost in transmission.","pos":[3660,3777]},{"content":"The protocol can be either native or SOAP-based, such as the SOAP Reliable Message Protocol (SRMP).","pos":[3778,3877]},{"content":"In MSMQ, queues can be transactional or non-transactional.","pos":[3884,3942]},{"content":"A transactional queue allows messages to be captured and delivered in a transaction and then stored durably in the queue.","pos":[3943,4064]},{"content":"Messages sent to a transactional queue are transferred exactly once in order.","pos":[4065,4142]},{"content":"You can use a non-transactional queue to send both volatile and durable messages.","pos":[4143,4224]},{"content":"A message sent to a non-transactional queue does not carry any reliable transfer assurances; thus, messages can be lost.","pos":[4225,4345]},{"content":"MSMQ queues can also be secured using a Windows identity registered with the Active Directory directory service.","pos":[4352,4464]},{"content":"When installing MSMQ, you can install Active Directory integration, which requires the computer to be part of a Windows domain network.","pos":[4465,4600]},{"pos":[4607,4755],"content":"For more information about MSMQ, see <bpt id=\"p1\">[</bpt>Installing Message Queuing (MSMQ)<ept id=\"p1\">](../../../../docs/framework/wcf/samples/installing-message-queuing-msmq.md)</ept>.","source":"For more information about MSMQ, see [Installing Message Queuing (MSMQ)](../../../../docs/framework/wcf/samples/installing-message-queuing-msmq.md)."},{"pos":[4765,4779],"content":"NetMsmqBinding","linkify":"NetMsmqBinding","nodes":[{"content":"NetMsmqBinding","pos":[0,14]}]},{"content":"The <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>netMsmqBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/netmsmqbinding.md)</ept> is the queued binding WCF provides for two WCF endpoints to communicate using MSMQ.","pos":[4783,4967],"source":"The [\\<netMsmqBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/netmsmqbinding.md) is the queued binding WCF provides for two WCF endpoints to communicate using MSMQ."},{"content":"The binding, therefore, exposes properties that are specific to MSMQ.","pos":[4968,5037]},{"content":"However, not all MSMQ features and properties are exposed in the <ph id=\"ph1\">`NetMsmqBinding`</ph>.","pos":[5038,5120],"source":" However, not all MSMQ features and properties are exposed in the `NetMsmqBinding`."},{"content":"The compact <ph id=\"ph1\">`NetMsmqBinding`</ph> is designed with an optimal set of features that most customers should find sufficient.","pos":[5121,5237],"source":" The compact `NetMsmqBinding` is designed with an optimal set of features that most customers should find sufficient."},{"content":"The <ph id=\"ph1\">`NetMsmqBinding`</ph> manifests the core queuing concepts discussed thus far in the form of properties on the bindings.","pos":[5244,5362],"source":"The `NetMsmqBinding` manifests the core queuing concepts discussed thus far in the form of properties on the bindings."},{"content":"These properties, in turn, communicate to MSMQ how to transfer and deliver the messages.","pos":[5363,5451]},{"content":"A discussion of the property categories is in the following sections.","pos":[5452,5521]},{"content":"For more information, see the conceptual topics that describe specific properties more completely.","pos":[5522,5620]},{"pos":[5631,5665],"content":"ExactlyOnce and Durable Properties","linkify":"ExactlyOnce and Durable Properties","nodes":[{"content":"ExactlyOnce and Durable Properties","pos":[0,34]}]},{"pos":[5669,5763],"content":"The <ph id=\"ph1\">`ExactlyOnce`</ph> and <ph id=\"ph2\">`Durable`</ph> properties affect how messages are transferred between queues:","source":"The `ExactlyOnce` and `Durable` properties affect how messages are transferred between queues:"},{"content":"<ph id=\"ph1\">`ExactlyOnce`</ph>: When set to <ph id=\"ph2\">`true`</ph> (the default), the queued channel ensures that the message, if delivered, is not duplicated.","pos":[5773,5899],"source":"`ExactlyOnce`: When set to `true` (the default), the queued channel ensures that the message, if delivered, is not duplicated."},{"content":"It also ensures that the message is not lost.","pos":[5900,5945]},{"content":"If the message cannot be delivered, or the message Time-To Live expires before the message can be delivered, the failed message along with the delivery failure reason is recorded in a dead-letter queue.","pos":[5946,6148]},{"content":"When set to <ph id=\"ph1\">`false`</ph>, the queued channel makes an effort to transfer the message.","pos":[6149,6229],"source":" When set to `false`, the queued channel makes an effort to transfer the message."},{"content":"In this case, you can optionally choose a dead-letter queue.","pos":[6230,6290]},{"content":"<ph id=\"ph1\">`Durable:`</ph> When set to <ph id=\"ph2\">`true`</ph> (the default), the queued channel ensures that MSMQ stores the message durably on disk.","pos":[6300,6417],"source":"`Durable:` When set to `true` (the default), the queued channel ensures that MSMQ stores the message durably on disk."},{"content":"Thus, if the MSMQ service were to stop and restart, the messages on disk is transferred to the target queue or delivered to the service.","pos":[6418,6554]},{"content":"When set to <ph id=\"ph1\">`false`</ph>, the messages are stored in volatile store and are lost on stopping and restarting the MSMQ service.","pos":[6555,6675],"source":" When set to `false`, the messages are stored in volatile store and are lost on stopping and restarting the MSMQ service."},{"content":"For <ph id=\"ph1\">`ExactlyOnce`</ph> reliable transfer, MSMQ requires the queue to be transactional.","pos":[6682,6763],"source":"For `ExactlyOnce` reliable transfer, MSMQ requires the queue to be transactional."},{"content":"Also, MSMQ requires a transaction to read from a transactional queue.","pos":[6764,6833]},{"content":"As such, when you use the <ph id=\"ph1\">`NetMsmqBinding`</ph>, remember that a transaction is required to send or receive messages when <ph id=\"ph2\">`ExactlyOnce`</ph> is set to <ph id=\"ph3\">`true`</ph>.","pos":[6834,6982],"source":" As such, when you use the `NetMsmqBinding`, remember that a transaction is required to send or receive messages when `ExactlyOnce` is set to `true`."},{"content":"Similarly, MSMQ requires the queue to be non-transactional for best-effort assurances, such as when <ph id=\"ph1\">`ExactlyOnce`</ph> is <ph id=\"ph2\">`false`</ph> and for volatile messaging.","pos":[6983,7135],"source":" Similarly, MSMQ requires the queue to be non-transactional for best-effort assurances, such as when `ExactlyOnce` is `false` and for volatile messaging."},{"content":"Thus, when setting <ph id=\"ph1\">`ExactlyOnce`</ph> to <ph id=\"ph2\">`false`</ph> or durable to <ph id=\"ph3\">`false`</ph>, you cannot send or receive using a transaction.","pos":[7136,7250],"source":" Thus, when setting `ExactlyOnce` to `false` or durable to `false`, you cannot send or receive using a transaction."},{"pos":[7258,7478],"content":"[!NOTE]\n Ensure that the correct queue (transactional or non-transactional) is created based on settings in the bindings. If `ExactlyOnce` is `true`, use a transactional queue; otherwise, use a non-transactional queue.","leadings":["","> "],"nodes":[{"content":"Ensure that the correct queue (transactional or non-transactional) is created based on settings in the bindings. If `ExactlyOnce` is `true`, use a transactional queue; otherwise, use a non-transactional queue.","pos":[9,218],"nodes":[{"content":"Ensure that the correct queue (transactional or non-transactional) is created based on settings in the bindings.","pos":[0,112]},{"content":"If <ph id=\"ph1\">`ExactlyOnce`</ph> is <ph id=\"ph2\">`true`</ph>, use a transactional queue; otherwise, use a non-transactional queue.","pos":[113,209],"source":" If `ExactlyOnce` is `true`, use a transactional queue; otherwise, use a non-transactional queue."}]}]},{"pos":[7489,7517],"content":"Dead-Letter Queue Properties","linkify":"Dead-Letter Queue Properties","nodes":[{"content":"Dead-Letter Queue Properties","pos":[0,28]}]},{"content":"The dead-letter queue is used to store messages that fail delivery.","pos":[7521,7588]},{"content":"The user can write compensating logic that reads messages out of the dead-letter queue.","pos":[7589,7676]},{"content":"Many queuing systems provide for a system-wide dead-letter queue.","pos":[7683,7748]},{"content":"MSMQ provides a system-wide non-transactional dead-letter queue for messages that fail delivery to non-transactional queues and a system-wide transactional dead-letter queue for messages that fail delivery to transactional queues.","pos":[7749,7979]},{"content":"If multiple clients sending messages to different target queues share the MSMQ service, all messages sent by the clients go to the same dead-letter queue.","pos":[7986,8140]},{"content":"This is not always preferable.","pos":[8141,8171]},{"content":"For better isolation, WCF and MSMQ in <ph id=\"ph1\">[!INCLUDE[wv](../../../../includes/wv-md.md)]</ph> provide a custom dead-letter queue (or application-specific dead-letter queue) that the user can specify to store messages that fail delivery.","pos":[8172,8398],"source":" For better isolation, WCF and MSMQ in [!INCLUDE[wv](../../../../includes/wv-md.md)] provide a custom dead-letter queue (or application-specific dead-letter queue) that the user can specify to store messages that fail delivery."},{"content":"Therefore, different clients do not share the same dead-letter queue.","pos":[8399,8468]},{"content":"The binding has two properties of interest:","pos":[8475,8518]},{"content":"<ph id=\"ph1\">`DeadLetterQueue`</ph>: This property is an enumeration that indicates whether a dead-letter queue is requested.","pos":[8528,8635],"source":"`DeadLetterQueue`: This property is an enumeration that indicates whether a dead-letter queue is requested."},{"content":"The enumeration also contains the kind of dead-letter queue, if one is requested.","pos":[8636,8717]},{"content":"The values are <ph id=\"ph1\">`None`</ph>, <ph id=\"ph2\">`System`</ph>, and <ph id=\"ph3\">`Custom`</ph>.","pos":[8718,8764],"source":" The values are `None`, `System`, and `Custom`."},{"content":"For more information about the interpretation of these properties, see <bpt id=\"p1\">[</bpt>Using Dead-Letter Queues to Handle Message Transfer Failures<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/using-dead-letter-queues-to-handle-message-transfer-failures.md)</ept>","pos":[8765,9010],"source":" For more information about the interpretation of these properties, see [Using Dead-Letter Queues to Handle Message Transfer Failures](../../../../docs/framework/wcf/feature-details/using-dead-letter-queues-to-handle-message-transfer-failures.md)"},{"content":"<ph id=\"ph1\">`CustomDeadLetterQueue`</ph>: This property is the Uniform Resource Identifier (URI) address of the application-specific dead-letter queue.","pos":[9020,9154],"source":"`CustomDeadLetterQueue`: This property is the Uniform Resource Identifier (URI) address of the application-specific dead-letter queue."},{"content":"This is required if <ph id=\"ph1\">`DeadLetterQueue`</ph>.<ph id=\"ph2\">`Custom`</ph>","pos":[9155,9201],"source":" This is required if `DeadLetterQueue`.`Custom`"},{"content":"is chosen.","pos":[9202,9212]},{"pos":[9223,9257],"content":"Poison Message Handling properties","linkify":"Poison Message Handling properties","nodes":[{"content":"Poison Message Handling properties","pos":[0,34]}]},{"content":"When the service reads messages from the target queue under a transaction, the service may fail to process the message for various reasons.","pos":[9261,9400]},{"content":"The message is then put back into the queue to be read again.","pos":[9401,9462]},{"content":"To deal with messages that fail repeatedly, a set of poison-message handling properties can be configured in the binding.","pos":[9463,9584]},{"content":"There are four properties: <ph id=\"ph1\">`ReceiveRetryCount`</ph>, <ph id=\"ph2\">`MaxRetryCycles`</ph>, <ph id=\"ph3\">`RetryCycleDelay`</ph>, and <ph id=\"ph4\">`ReceiveErrorHandling`</ph>.","pos":[9585,9697],"source":" There are four properties: `ReceiveRetryCount`, `MaxRetryCycles`, `RetryCycleDelay`, and `ReceiveErrorHandling`."},{"content":"For more information about these properties, see <bpt id=\"p1\">[</bpt>Poison Message Handling<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/poison-message-handling.md)</ept>.","pos":[9698,9848],"source":" For more information about these properties, see [Poison Message Handling](../../../../docs/framework/wcf/feature-details/poison-message-handling.md)."},{"pos":[9859,9878],"content":"Security Properties","linkify":"Security Properties","nodes":[{"content":"Security Properties","pos":[0,19]}]},{"content":"MSMQ exposes its own security model, such as access control lists (ACLs) on a queue or sending authenticated messages.","pos":[9882,10000]},{"content":"The <ph id=\"ph1\">`NetMsmqBinding`</ph> exposes these security properties as part of its transport security settings.","pos":[10001,10099],"source":" The `NetMsmqBinding` exposes these security properties as part of its transport security settings."},{"content":"There are two properties in the binding for transport security: <ph id=\"ph1\">`MsmqAuthenticationMode`</ph> and <ph id=\"ph2\">`MsmqProtectionLevel`</ph>.","pos":[10100,10215],"source":" There are two properties in the binding for transport security: `MsmqAuthenticationMode` and `MsmqProtectionLevel`."},{"content":"Settings in these properties depend on how MSMQ is configured.","pos":[10216,10278]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Securing Messages Using Transport Security<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md)</ept>.","pos":[10279,10444],"source":" For more information, see [Securing Messages Using Transport Security](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md)."},{"content":"In addition to transport security, the actual SOAP message itself can be secured using message security.","pos":[10451,10555]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Securing Messages Using Message Security<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/securing-messages-using-message-security.md)</ept>.","pos":[10556,10717],"source":" For more information, see [Securing Messages Using Message Security](../../../../docs/framework/wcf/feature-details/securing-messages-using-message-security.md)."},{"content":"<ph id=\"ph1\">`MsmqTransportSecurity`</ph> also exposes two properties, <ph id=\"ph2\">`MsmqEncryptionAlgorithm`</ph> and <ph id=\"ph3\">`MsmqHashAlgorithm`</ph>.","pos":[10724,10827],"source":"`MsmqTransportSecurity` also exposes two properties, `MsmqEncryptionAlgorithm` and `MsmqHashAlgorithm`."},{"content":"These are enumerations of different algorithms to choose for queue-to-queue transfer encryption of messages and hashing of the signatures.","pos":[10828,10966]},{"pos":[10977,10993],"content":"Other Properties","linkify":"Other Properties","nodes":[{"content":"Other Properties","pos":[0,16]}]},{"content":"In addition to the preceding properties, other MSMQ-specific properties exposed in the binding include:","pos":[10997,11100]},{"content":"<ph id=\"ph1\">`UseSourceJournal`</ph>: A property to indicate that source journaling is turned on.","pos":[11110,11189],"source":"`UseSourceJournal`: A property to indicate that source journaling is turned on."},{"content":"Source journaling is an MSMQ feature that keeps track of messages that have been successfully transmitted from the transmission queue.","pos":[11190,11324]},{"content":"<ph id=\"ph1\">`UseMsmqTracing`</ph>: A property to indicate that MSMQ tracing is turned on.","pos":[11334,11406],"source":"`UseMsmqTracing`: A property to indicate that MSMQ tracing is turned on."},{"content":"MSMQ tracing sends report messages to a report queue each time a message leaves or arrives at a machine hosting an MSMQ queue manager.","pos":[11407,11541]},{"content":"<ph id=\"ph1\">`QueueTransferProtocol`</ph>: An enumeration of the protocol to use for queue-to-queue message transfers.","pos":[11551,11651],"source":"`QueueTransferProtocol`: An enumeration of the protocol to use for queue-to-queue message transfers."},{"content":"MSMQ implements a native queue-to-queue transfer protocol and a SOAP-based protocol called SOAP Reliable Messaging Protocol (SRMP).","pos":[11652,11783]},{"content":"SRMP is used when using HTTP transport for queue-to-queue transfers.","pos":[11784,11852]},{"content":"SRMP secure is used when using HTTPS for queue-to-queue transfers.","pos":[11853,11919]},{"content":"<ph id=\"ph1\">`UseActiveDirectory`</ph>: A Boolean value to indicate whether the Active Directory must be used for queue address resolution.","pos":[11929,12050],"source":"`UseActiveDirectory`: A Boolean value to indicate whether the Active Directory must be used for queue address resolution."},{"content":"By default, this is off.","pos":[12051,12075]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Service Endpoints and Queue Addressing<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)</ept>.","pos":[12076,12233],"source":" For more information, see [Service Endpoints and Queue Addressing](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)."},{"pos":[12243,12265],"content":"MsmqIntegrationBinding","linkify":"MsmqIntegrationBinding","nodes":[{"content":"MsmqIntegrationBinding","pos":[0,22]}]},{"pos":[12269,12433],"content":"The <ph id=\"ph1\">`MsmqIntegrationBinding`</ph> is used when you want a WCF endpoint to communicate with an existing MSMQ application written in C, C++, COM, or System.Messaging APIs.","source":"The `MsmqIntegrationBinding` is used when you want a WCF endpoint to communicate with an existing MSMQ application written in C, C++, COM, or System.Messaging APIs."},{"content":"The binding properties are the same as for <ph id=\"ph1\">`NetMsmqBinding`</ph>.","pos":[12440,12500],"source":"The binding properties are the same as for `NetMsmqBinding`."},{"content":"However, the following differences apply:","pos":[12501,12542]},{"pos":[12552,12756],"content":"The operation contract for <ph id=\"ph1\">`MsmqIntegrationBinding`</ph> is restricted to taking a single parameter of type <ph id=\"ph2\">&lt;xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601&gt;</ph> where the type parameter is the body type.","source":"The operation contract for `MsmqIntegrationBinding` is restricted to taking a single parameter of type <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> where the type parameter is the body type."},{"pos":[12766,12891],"content":"Much of MSMQ native message properties are exposed in the <ph id=\"ph1\">&lt;xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601&gt;</ph> for use.","source":"Much of MSMQ native message properties are exposed in the <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> for use."},{"content":"To help with serialization and deserialization of the message body, serializers such as XML and ActiveX are provided.","pos":[12901,13018]},{"pos":[13028,13039],"content":"Sample Code","linkify":"Sample Code","nodes":[{"content":"Sample Code","pos":[0,11]}]},{"content":"For step by step instructions on how to write WCF services that use MSMQ see the following topics:","pos":[13043,13141]},{"pos":[13151,13358],"content":"<bpt id=\"p1\">[</bpt>How to: Exchange Messages with WCF Endpoints and Message Queuing Applications<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-with-wcf-endpoints-and-message-queuing-applications.md)</ept>","source":"[How to: Exchange Messages with WCF Endpoints and Message Queuing Applications](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-with-wcf-endpoints-and-message-queuing-applications.md)"},{"pos":[13368,13523],"content":"<bpt id=\"p1\">[</bpt>How to: Exchange Queued Messages with WCF Endpoints<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-exchange-queued-messages-with-wcf-endpoints.md)</ept>","source":"[How to: Exchange Queued Messages with WCF Endpoints](../../../../docs/framework/wcf/feature-details/how-to-exchange-queued-messages-with-wcf-endpoints.md)"},{"content":"For a completed code sample illustrating the use of MSMQ in WCF see the following topics:","pos":[13530,13619]},{"pos":[13629,13721],"content":"<bpt id=\"p1\">[</bpt>Transacted MSMQ Binding<ept id=\"p1\">](../../../../docs/framework/wcf/samples/transacted-msmq-binding.md)</ept>","source":"[Transacted MSMQ Binding](../../../../docs/framework/wcf/samples/transacted-msmq-binding.md)"},{"pos":[13731,13835],"content":"<bpt id=\"p1\">[</bpt>Volatile Queued Communication<ept id=\"p1\">](../../../../docs/framework/wcf/samples/volatile-queued-communication.md)</ept>","source":"[Volatile Queued Communication](../../../../docs/framework/wcf/samples/volatile-queued-communication.md)"},{"pos":[13845,13927],"content":"<bpt id=\"p1\">[</bpt>Dead Letter Queues<ept id=\"p1\">](../../../../docs/framework/wcf/samples/dead-letter-queues.md)</ept>","source":"[Dead Letter Queues](../../../../docs/framework/wcf/samples/dead-letter-queues.md)"},{"pos":[13937,14021],"content":"<bpt id=\"p1\">[</bpt>Sessions and Queues<ept id=\"p1\">](../../../../docs/framework/wcf/samples/sessions-and-queues.md)</ept>","source":"[Sessions and Queues](../../../../docs/framework/wcf/samples/sessions-and-queues.md)"},{"pos":[14031,14119],"content":"<bpt id=\"p1\">[</bpt>Two-Way Communication<ept id=\"p1\">](../../../../docs/framework/wcf/samples/two-way-communication.md)</ept>","source":"[Two-Way Communication](../../../../docs/framework/wcf/samples/two-way-communication.md)"},{"pos":[14128,14182],"content":"<bpt id=\"p1\">[</bpt>SRMP<ept id=\"p1\">](../../../../docs/framework/wcf/samples/srmp.md)</ept>","source":"[SRMP](../../../../docs/framework/wcf/samples/srmp.md)"},{"pos":[14192,14312],"content":"<bpt id=\"p1\">[</bpt>Message Security over Message Queuing<ept id=\"p1\">](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)</ept>","source":"[Message Security over Message Queuing](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)"},{"pos":[14321,14329],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[14333,14463],"content":"<bpt id=\"p1\">[</bpt>Service Endpoints and Queue Addressing<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)</ept>","source":"[Service Endpoints and Queue Addressing](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)"},{"pos":[14466,14584],"content":"<bpt id=\"p1\">[</bpt>Web Hosting a Queued Application<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md)</ept>","source":"[Web Hosting a Queued Application](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md)"}]}