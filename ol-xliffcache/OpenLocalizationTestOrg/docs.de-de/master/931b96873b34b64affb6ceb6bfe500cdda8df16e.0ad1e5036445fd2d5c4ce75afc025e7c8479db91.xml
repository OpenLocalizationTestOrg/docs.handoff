{"content":"---\ntitle: \"How to: Create a Transactional Service | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 1bd2e4ed-a557-43f9-ba98-4c70cb75c154\ncaps.latest.revision: 12\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# How to: Create a Transactional Service\nThis sample demonstrates various aspects of creating a transactional service and the use of a client-initiated transaction to coordinate service operations.  \n  \n### Creating a transactional service  \n  \n1.  Create a service contract and annotate the operations with the desired setting from the <xref:System.ServiceModel.TransactionFlowOption> enumeration to specify the incoming transaction requirements. Note that you can also place the <xref:System.ServiceModel.TransactionFlowAttribute> on the service class being implemented. This allows for a single implementation of an interface to use these transaction settings, instead of every implementation.  \n  \n    ```  \n    [ServiceContract]  \n    public interface ICalculator  \n    {  \n        [OperationContract]  \n        // Use this to require an incoming transaction  \n        [TransactionFlow(TransactionFlowOption.Mandatory)]  \n        double Add(double n1, double n2);  \n        [OperationContract]  \n        // Use this to permit an incoming transaction  \n        [TransactionFlow(TransactionFlowOption.Allowed)]  \n        double Subtract(double n1, double n2);  \n    }  \n    ```  \n  \n2.  Create an implementation class, and use the <xref:System.ServiceModel.ServiceBehaviorAttribute> to optionally specify a <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionIsolationLevel%2A> and a <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A>. You should note that in many cases, the default <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> of 60 seconds and the default <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionIsolationLevel%2A> of `Unspecified` are appropriate. For each operation, you can use the <xref:System.ServiceModel.OperationBehaviorAttribute> attribute to specify whether work performed within the method should occur within the scope of a transaction scope according to the value of the <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> attribute. In this case, the transaction used for the `Add` method is the same as the mandatory incoming transaction that is flowed from the client, and the transaction used for the `Subtract` method is either the same as the incoming transaction if one was flowed from the client, or a new implicitly and locally created transaction.  \n  \n    ```  \n    [ServiceBehavior(  \n        TransactionIsolationLevel = System.Transactions.IsolationLevel.Serializable,  \n        TransactionTimeout = \"00:00:45\")]  \n    public class CalculatorService : ICalculator  \n    {  \n        [OperationBehavior(TransactionScopeRequired = true)]  \n        public double Add(double n1, double n2)  \n        {  \n            // Perform transactional operation  \n            RecordToLog(String.Format(\"Adding {0} to {1}\", n1, n2));  \n            return n1 + n2;  \n        }  \n  \n        [OperationBehavior(TransactionScopeRequired = true)]  \n        public double Subtract(double n1, double n2)  \n        {  \n            // Perform transactional operation  \n            RecordToLog(String.Format(\"Subtracting {0} from {1}\", n2, n1));  \n            return n1 - n2;  \n        }  \n  \n        private static void RecordToLog(string recordText)  \n        {  \n            // Database operations omitted for brevity  \n            // This is where the transaction provides specific benefit  \n            // - changes to the database will be committed only when  \n            // the transaction completes.  \n        }  \n    }  \n    ```  \n  \n3.  Configure the bindings in the configuration file, specifying that the transaction context should be flowed, and the protocols to be used to do so. [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][ServiceModel Transaction Configuration](../../../../docs/framework/wcf/feature-details/servicemodel-transaction-configuration.md). Specifically, the binding type is specified in the endpoint element’s `binding` attribute. The [\\<endpoint>](http://msdn.microsoft.com/en-us/13aa23b7-2f08-4add-8dbf-a99f8127c017) element contains a `bindingConfiguration` attribute that references a binding configuration named `transactionalOleTransactionsTcpBinding`, as shown in the following sample configuration.  \n  \n    ```  \n    <service name=\"CalculatorService\">  \n      <endpoint address=\"net.tcp://localhost:8008/CalcService\"  \n        binding=\"netTcpBinding\"  \n        bindingConfiguration=\"transactionalOleTransactionsTcpBinding\"  \n        contract=\"ICalculator\"  \n        name=\"OleTransactions_endpoint\" />  \n    </service>  \n    ```  \n  \n     Transaction flow is enabled at the configuration level by using the `transactionFlow` attribute, and the transaction protocol is specified using the `transactionProtocol` attribute, as shown in the following configuration.  \n  \n    ```  \n    <bindings>  \n      <netTcpBinding>  \n        <binding name=\"transactionalOleTransactionsTcpBinding\"  \n          transactionFlow=\"true\"  \n          transactionProtocol=\"OleTransactions\"/>  \n      </netTcpBinding>  \n    </bindings>  \n    ```  \n  \n### Supporting multiple transaction protocols  \n  \n1.  For optimal performance, you should use the OleTransactions protocol for scenarios involving a client and service written using [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]. However, the WS-AtomicTransaction (WS-AT) protocol is useful for scenarios when interoperability with third-party protocol stacks is required. You can configure [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services to accept both protocols by providing multiple endpoints with appropriate protocol-specific bindings, as shown in the following sample configuration.  \n  \n    ```  \n    <service name=\"CalculatorService\">  \n      <endpoint address=\"http://localhost:8000/CalcService\"  \n        binding=\"wsHttpBinding\"  \n        bindingConfiguration=\"transactionalWsatHttpBinding\"  \n        contract=\"ICalculator\"  \n        name=\"WSAtomicTransaction_endpoint\" />  \n      <endpoint address=\"net.tcp://localhost:8008/CalcService\"  \n        binding=\"netTcpBinding\"  \n        bindingConfiguration=\"transactionalOleTransactionsTcpBinding\"  \n        contract=\"ICalculator\"  \n        name=\"OleTransactions_endpoint\" />  \n    </service>  \n    ```  \n  \n     The transaction protocol is specified using the `transactionProtocol` attribute. However, this attribute is absent from the system-provided `wsHttpBinding`, because this binding can only use the WS-AT protocol.  \n  \n    ```  \n    <bindings>  \n      <wsHttpBinding>  \n        <binding name=\"transactionalWsatHttpBinding\"  \n          transactionFlow=\"true\" />  \n      </wsHttpBinding>  \n      <netTcpBinding>  \n        <binding name=\"transactionalOleTransactionsTcpBinding\"  \n          transactionFlow=\"true\"  \n          transactionProtocol=\"OleTransactions\"/>  \n      </netTcpBinding>  \n    </bindings>  \n    ```  \n  \n### Controlling the completion of a transaction  \n  \n1.  By default, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] operations automatically complete transactions if no unhandled exceptions are thrown. You can modify this behavior by using the <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A> property and the <xref:System.ServiceModel.OperationContext.SetTransactionComplete%2A> method. When an operation is required to occur within the same transaction as another operation (for example, a debit and credit operation), you can disable the autocomplete behavior by setting the <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A> property to `false` as shown in the following `Debit` operation example. The transaction the `Debit` operation uses is not completed until a method with the <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A> property set to `true` is called, as shown in the operation `Credit1`, or when the <xref:System.ServiceModel.OperationContext.SetTransactionComplete%2A> method is called to explicitly mark the transaction as complete, as shown in the operation `Credit2`. Note that the two credit operations are shown for illustration purposes, and that a single credit operation would be more typical.  \n  \n    ```  \n    [ServiceBehavior]  \n    public class CalculatorService : IAccount  \n    {  \n        [OperationBehavior(  \n            TransactionScopeRequired = true, TransactionAutoComplete = false)]  \n        public void Debit(double n)  \n        {  \n            // Perform debit operation  \n  \n            return;  \n        }  \n  \n        [OperationBehavior(  \n            TransactionScopeRequired = true, TransactionAutoComplete = true)]  \n        public void Credit1(double n)  \n        {  \n            // Perform credit operation  \n  \n            return;  \n        }  \n  \n        [OperationBehavior(  \n            TransactionScopeRequired = true, TransactionAutoComplete = false)]  \n        public void Credit2(double n)  \n        {  \n            // Perform alternate credit operation  \n  \n            OperationContext.Current.SetTransactionComplete();  \n            return;  \n        }  \n    }  \n    ```  \n  \n2.  For the purposes of transaction correlation, setting the <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A> property to `false` requires the use of a sessionful binding. This requirement is specified with the `SessionMode` property on the <xref:System.ServiceModel.ServiceContractAttribute>.  \n  \n    ```  \n    [ServiceContract(SessionMode = SessionMode.Required)]  \n    public interface IAccount  \n    {  \n        [OperationContract]  \n        [TransactionFlow(TransactionFlowOption.Allowed)]  \n        void Debit(double n);  \n        [OperationContract]  \n        [TransactionFlow(TransactionFlowOption.Allowed)]  \n        void Credit1(double n);  \n        [OperationContract]  \n        [TransactionFlow(TransactionFlowOption.Allowed)]  \n        void Credit2(double n);  \n    }  \n    ```  \n  \n### Controlling the lifetime of a transactional service instance  \n  \n1.  [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] uses the <xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A> property to specify whether the underlying service instance is released when a transaction completes. Since this defaults to `true`, unless configured otherwise, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] exhibits an efficient and predictable \"just-in-time\" activation behavior. Calls to a service on a subsequent transaction are assured a new service instance with no remnants of the previous transaction's state. While this is often useful, sometimes you may want to maintain state within the service instance beyond the transaction completion. Examples of this would be when required state or handles to resources are expensive to retrieve or reconstitute. You can do this by setting the <xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A> property to `false`. With that setting, the instance and any associated state will be available on subsequent calls. When using this, give careful consideration to when and how state and transactions will be cleared and completed. The following sample demonstrates how to do this by maintaining the instance with the `runningTotal` variable.  \n  \n    ```  \n    [ServiceBehavior(TransactionIsolationLevel = [ServiceBehavior(  \n        ReleaseServiceInstanceOnTransactionComplete = false)]  \n    public class CalculatorService : ICalculator  \n    {  \n        double runningTotal = 0;  \n  \n        [OperationBehavior(TransactionScopeRequired = true)]  \n        public double Add(double n)  \n        {  \n            // Perform transactional operation  \n            RecordToLog(String.Format(\"Adding {0} to {1}\", n, runningTotal));  \n            runningTotal = runningTotal + n;  \n            return runningTotal;  \n        }  \n  \n        [OperationBehavior(TransactionScopeRequired = true)]  \n        public double Subtract(double n)  \n        {  \n            // Perform transactional operation  \n            RecordToLog(String.Format(\"Subtracting {0} from {1}\", n, runningTotal));  \n            runningTotal = runningTotal - n;  \n            return runningTotal;  \n        }  \n  \n        private static void RecordToLog(string recordText)  \n        {  \n            // Database operations omitted for brevity  \n        }  \n    }  \n    ```  \n  \n    > [!NOTE]\n    >  Since the instance lifetime is a behavior that is internal to the service, and controlled through the <xref:System.ServiceModel.ServiceBehaviorAttribute> property, no modification to the service configuration or service contract is required to set the instance behavior. In addition, the wire will contain no representation of this.","nodes":[{"pos":[4,359],"embed":true,"restype":"x-metadata","content":"title: \"How to: Create a Transactional Service | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 1bd2e4ed-a557-43f9-ba98-4c70cb75c154\ncaps.latest.revision: 12\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"","nodes":[{"content":"How to: Create a Transactional Service | Microsoft Docs","nodes":[{"pos":[0,55],"content":"How to: Create a Transactional Service | Microsoft Docs","nodes":[{"content":"How to: Create a Transactional Service | Microsoft Docs","pos":[0,55]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[366,404],"content":"How to: Create a Transactional Service","linkify":"How to: Create a Transactional Service","nodes":[{"content":"How to: Create a Transactional Service","pos":[0,38]}]},{"content":"This sample demonstrates various aspects of creating a transactional service and the use of a client-initiated transaction to coordinate service operations.","pos":[405,561]},{"pos":[571,603],"content":"Creating a transactional service","linkify":"Creating a transactional service","nodes":[{"content":"Creating a transactional service","pos":[0,32]}]},{"content":"Create a service contract and annotate the operations with the desired setting from the <ph id=\"ph1\">&lt;xref:System.ServiceModel.TransactionFlowOption&gt;</ph> enumeration to specify the incoming transaction requirements.","pos":[613,811],"source":"Create a service contract and annotate the operations with the desired setting from the <xref:System.ServiceModel.TransactionFlowOption> enumeration to specify the incoming transaction requirements."},{"content":"Note that you can also place the <ph id=\"ph1\">&lt;xref:System.ServiceModel.TransactionFlowAttribute&gt;</ph> on the service class being implemented.","pos":[812,936],"source":" Note that you can also place the <xref:System.ServiceModel.TransactionFlowAttribute> on the service class being implemented."},{"content":"This allows for a single implementation of an interface to use these transaction settings, instead of every implementation.","pos":[937,1060]},{"content":"Create an implementation class, and use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute&gt;</ph> to optionally specify a <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionIsolationLevel%2A&gt;</ph> and a <ph id=\"ph3\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A&gt;</ph>.","pos":[1554,1835],"source":"Create an implementation class, and use the <xref:System.ServiceModel.ServiceBehaviorAttribute> to optionally specify a <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionIsolationLevel%2A> and a <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A>."},{"content":"You should note that in many cases, the default <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A&gt;</ph> of 60 seconds and the default <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionIsolationLevel%2A&gt;</ph> of <ph id=\"ph3\">`Unspecified`</ph> are appropriate.","pos":[1836,2102],"source":" You should note that in many cases, the default <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionTimeout%2A> of 60 seconds and the default <xref:System.ServiceModel.ServiceBehaviorAttribute.TransactionIsolationLevel%2A> of `Unspecified` are appropriate."},{"content":"For each operation, you can use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.OperationBehaviorAttribute&gt;</ph> attribute to specify whether work performed within the method should occur within the scope of a transaction scope according to the value of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A&gt;</ph> attribute.","pos":[2103,2430],"source":" For each operation, you can use the <xref:System.ServiceModel.OperationBehaviorAttribute> attribute to specify whether work performed within the method should occur within the scope of a transaction scope according to the value of the <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> attribute."},{"content":"In this case, the transaction used for the <ph id=\"ph1\">`Add`</ph> method is the same as the mandatory incoming transaction that is flowed from the client, and the transaction used for the <ph id=\"ph2\">`Subtract`</ph> method is either the same as the incoming transaction if one was flowed from the client, or a new implicitly and locally created transaction.","pos":[2431,2754],"source":" In this case, the transaction used for the `Add` method is the same as the mandatory incoming transaction that is flowed from the client, and the transaction used for the `Subtract` method is either the same as the incoming transaction if one was flowed from the client, or a new implicitly and locally created transaction."},{"content":"Configure the bindings in the configuration file, specifying that the transaction context should be flowed, and the protocols to be used to do so.","pos":[3931,4077]},{"content":"<ph id=\"ph1\">[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]</ph><bpt id=\"p1\">[</bpt>ServiceModel Transaction Configuration<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/servicemodel-transaction-configuration.md)</ept>.","pos":[4078,4268],"source":"[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][ServiceModel Transaction Configuration](../../../../docs/framework/wcf/feature-details/servicemodel-transaction-configuration.md)."},{"content":"Specifically, the binding type is specified in the endpoint element’s <ph id=\"ph1\">`binding`</ph> attribute.","pos":[4269,4359],"source":" Specifically, the binding type is specified in the endpoint element’s `binding` attribute."},{"content":"The <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>endpoint&gt;<ept id=\"p1\">](http://msdn.microsoft.com/en-us/13aa23b7-2f08-4add-8dbf-a99f8127c017)</ept> element contains a <ph id=\"ph2\">`bindingConfiguration`</ph> attribute that references a binding configuration named <ph id=\"ph3\">`transactionalOleTransactionsTcpBinding`</ph>, as shown in the following sample configuration.","pos":[4360,4635],"source":" The [\\<endpoint>](http://msdn.microsoft.com/en-us/13aa23b7-2f08-4add-8dbf-a99f8127c017) element contains a `bindingConfiguration` attribute that references a binding configuration named `transactionalOleTransactionsTcpBinding`, as shown in the following sample configuration."},{"pos":[4976,5198],"content":"Transaction flow is enabled at the configuration level by using the <ph id=\"ph1\">`transactionFlow`</ph> attribute, and the transaction protocol is specified using the <ph id=\"ph2\">`transactionProtocol`</ph> attribute, as shown in the following configuration.","source":"Transaction flow is enabled at the configuration level by using the `transactionFlow` attribute, and the transaction protocol is specified using the `transactionProtocol` attribute, as shown in the following configuration."},{"pos":[5467,5508],"content":"Supporting multiple transaction protocols","linkify":"Supporting multiple transaction protocols","nodes":[{"content":"Supporting multiple transaction protocols","pos":[0,41]}]},{"content":"For optimal performance, you should use the OleTransactions protocol for scenarios involving a client and service written using <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph>.","pos":[5518,5702],"source":"For optimal performance, you should use the OleTransactions protocol for scenarios involving a client and service written using [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]."},{"content":"However, the WS-AtomicTransaction (WS-AT) protocol is useful for scenarios when interoperability with third-party protocol stacks is required.","pos":[5703,5845]},{"content":"You can configure <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> services to accept both protocols by providing multiple endpoints with appropriate protocol-specific bindings, as shown in the following sample configuration.","pos":[5846,6078],"source":" You can configure [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] services to accept both protocols by providing multiple endpoints with appropriate protocol-specific bindings, as shown in the following sample configuration."},{"content":"The transaction protocol is specified using the <ph id=\"ph1\">`transactionProtocol`</ph> attribute.","pos":[6659,6739],"source":"The transaction protocol is specified using the `transactionProtocol` attribute."},{"content":"However, this attribute is absent from the system-provided <ph id=\"ph1\">`wsHttpBinding`</ph>, because this binding can only use the WS-AT protocol.","pos":[6740,6869],"source":" However, this attribute is absent from the system-provided `wsHttpBinding`, because this binding can only use the WS-AT protocol."},{"pos":[7280,7323],"content":"Controlling the completion of a transaction","linkify":"Controlling the completion of a transaction","nodes":[{"content":"Controlling the completion of a transaction","pos":[0,43]}]},{"content":"By default, <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> operations automatically complete transactions if no unhandled exceptions are thrown.","pos":[7333,7486],"source":"By default, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] operations automatically complete transactions if no unhandled exceptions are thrown."},{"content":"You can modify this behavior by using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A&gt;</ph> property and the <ph id=\"ph2\">&lt;xref:System.ServiceModel.OperationContext.SetTransactionComplete%2A&gt;</ph> method.","pos":[7487,7704],"source":" You can modify this behavior by using the <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A> property and the <xref:System.ServiceModel.OperationContext.SetTransactionComplete%2A> method."},{"content":"When an operation is required to occur within the same transaction as another operation (for example, a debit and credit operation), you can disable the autocomplete behavior by setting the <ph id=\"ph1\">&lt;xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A&gt;</ph> property to <ph id=\"ph2\">`false`</ph> as shown in the following <ph id=\"ph3\">`Debit`</ph> operation example.","pos":[7705,8048],"source":" When an operation is required to occur within the same transaction as another operation (for example, a debit and credit operation), you can disable the autocomplete behavior by setting the <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A> property to `false` as shown in the following `Debit` operation example."},{"content":"The transaction the <ph id=\"ph1\">`Debit`</ph> operation uses is not completed until a method with the <ph id=\"ph2\">&lt;xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A&gt;</ph> property set to <ph id=\"ph3\">`true`</ph> is called, as shown in the operation <ph id=\"ph4\">`Credit1`</ph>, or when the <ph id=\"ph5\">&lt;xref:System.ServiceModel.OperationContext.SetTransactionComplete%2A&gt;</ph> method is called to explicitly mark the transaction as complete, as shown in the operation <ph id=\"ph6\">`Credit2`</ph>.","pos":[8049,8468],"source":" The transaction the `Debit` operation uses is not completed until a method with the <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A> property set to `true` is called, as shown in the operation `Credit1`, or when the <xref:System.ServiceModel.OperationContext.SetTransactionComplete%2A> method is called to explicitly mark the transaction as complete, as shown in the operation `Credit2`."},{"content":"Note that the two credit operations are shown for illustration purposes, and that a single credit operation would be more typical.","pos":[8469,8599]},{"content":"For the purposes of transaction correlation, setting the <ph id=\"ph1\">&lt;xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A&gt;</ph> property to <ph id=\"ph2\">`false`</ph> requires the use of a sessionful binding.","pos":[9523,9722],"source":"For the purposes of transaction correlation, setting the <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionAutoComplete%2A> property to `false` requires the use of a sessionful binding."},{"content":"This requirement is specified with the <ph id=\"ph1\">`SessionMode`</ph> property on the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceContractAttribute&gt;</ph>.","pos":[9723,9844],"source":" This requirement is specified with the `SessionMode` property on the <xref:System.ServiceModel.ServiceContractAttribute>."},{"pos":[10352,10412],"content":"Controlling the lifetime of a transactional service instance","linkify":"Controlling the lifetime of a transactional service instance","nodes":[{"content":"Controlling the lifetime of a transactional service instance","pos":[0,60]}]},{"content":"uses the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A&gt;</ph> property to specify whether the underlying service instance is released when a transaction completes.","pos":[10478,10687],"source":" uses the <xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A> property to specify whether the underlying service instance is released when a transaction completes."},{"content":"Since this defaults to <ph id=\"ph1\">`true`</ph>, unless configured otherwise, <ph id=\"ph2\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> exhibits an efficient and predictable \"just-in-time\" activation behavior.","pos":[10688,10877],"source":" Since this defaults to `true`, unless configured otherwise, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] exhibits an efficient and predictable \"just-in-time\" activation behavior."},{"content":"Calls to a service on a subsequent transaction are assured a new service instance with no remnants of the previous transaction's state.","pos":[10878,11013]},{"content":"While this is often useful, sometimes you may want to maintain state within the service instance beyond the transaction completion.","pos":[11014,11145]},{"content":"Examples of this would be when required state or handles to resources are expensive to retrieve or reconstitute.","pos":[11146,11258]},{"content":"You can do this by setting the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A&gt;</ph> property to <ph id=\"ph2\">`false`</ph>.","pos":[11259,11409],"source":" You can do this by setting the <xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A> property to `false`."},{"content":"With that setting, the instance and any associated state will be available on subsequent calls.","pos":[11410,11505]},{"content":"When using this, give careful consideration to when and how state and transactions will be cleared and completed.","pos":[11506,11619]},{"content":"The following sample demonstrates how to do this by maintaining the instance with the <ph id=\"ph1\">`runningTotal`</ph> variable.","pos":[11620,11730],"source":" The following sample demonstrates how to do this by maintaining the instance with the `runningTotal` variable."},{"pos":[12835,13182],"content":"[!NOTE]\nSince the instance lifetime is a behavior that is internal to the service, and controlled through the <xref:System.ServiceModel.ServiceBehaviorAttribute> property, no modification to the service configuration or service contract is required to set the instance behavior. In addition, the wire will contain no representation of this.","leadings":["","    >  "],"nodes":[{"content":"Since the instance lifetime is a behavior that is internal to the service, and controlled through the <xref:System.ServiceModel.ServiceBehaviorAttribute> property, no modification to the service configuration or service contract is required to set the instance behavior. In addition, the wire will contain no representation of this.","pos":[8,340],"nodes":[{"content":"Since the instance lifetime is a behavior that is internal to the service, and controlled through the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute&gt;</ph> property, no modification to the service configuration or service contract is required to set the instance behavior.","pos":[0,270],"source":"Since the instance lifetime is a behavior that is internal to the service, and controlled through the <xref:System.ServiceModel.ServiceBehaviorAttribute> property, no modification to the service configuration or service contract is required to set the instance behavior."},{"content":"In addition, the wire will contain no representation of this.","pos":[271,332]}]}]}]}