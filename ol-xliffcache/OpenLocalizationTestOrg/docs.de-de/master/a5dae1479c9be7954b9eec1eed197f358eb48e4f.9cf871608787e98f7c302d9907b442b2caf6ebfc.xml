{"content":"---\ntitle: \"Using Windows Management Instrumentation for Diagnostics\"\nms.date: \"03/30/2017\"\nms.assetid: fe48738d-e31b-454d-b5ec-24c85c6bf79a\n---\n# Using Windows Management Instrumentation for Diagnostics\nWindows Communication Foundation (WCF) exposes inspection data of a service at runtime through a WCF Windows Management Instrumentation (WMI) provider.  \n  \n## Enabling WMI  \n WMI is Microsoft's implementation of the Web-Based Enterprise Management (WBEM) standard. For more information about the WMI SDK, see [Windows Management Instrumentation](/windows/desktop/WmiSdk/wmi-start-page). WBEM is an industry standard for how applications expose management instrumentation to external management tools.  \n  \n A WMI provider is a component that exposes instrumentation at runtime through a WBEM-compatible interface. It consists of a set of WMI objects that have attribute/value pairs. Pairs can be of a number of simple types. Management tools can connect to the services through the interface at runtime. WCF exposes attributes of services such as addresses, bindings, behaviors, and listeners.  \n  \n The built-in WMI provider can be activated in the configuration file of the application. This is done through the `wmiProviderEnabled` attribute of the [\\<diagnostics>](../../../../../docs/framework/configure-apps/file-schema/wcf/diagnostics.md) in the [\\<system.serviceModel>](../../../../../docs/framework/configure-apps/file-schema/wcf/system-servicemodel.md) section, as shown in the following sample configuration.  \n  \n```xml  \n<system.serviceModel>  \n    …  \n    <diagnostics wmiProviderEnabled=\"true\" />  \n    …  \n</system.serviceModel>  \n```  \n  \n This configuration entry exposes a WMI interface. Management applications can now connect through this interface and access the management instrumentation of the application.  \n  \n## Accessing WMI Data  \n WMI data can be accessed in many different ways. Microsoft provides WMI APIs for scripts, Visual Basic applications, C++ applications, and the [!INCLUDE[dnprdnshort](../../../../../includes/dnprdnshort-md.md)]. For more information, see [Using WMI](https://go.microsoft.com/fwlink/?LinkId=95183).  \n  \n> [!CAUTION]\n>  If you use the .NET Framework provided methods to programmatically access WMI data, you should be aware that such methods may throw exceptions when the connection is established. The connection is not established during the construction of the <xref:System.Management.ManagementObject> instance, but on the first request involving actual data exchange. Therefore, you should use a `try..catch` block to catch the possible exceptions.  \n  \n You can change the trace and message logging level, as well as message logging options for the `System.ServiceModel` trace source in WMI. This can be done by accessing the [AppDomainInfo](../../../../../docs/framework/wcf/diagnostics/wmi/appdomaininfo.md) instance, which exposes these Boolean properties: `LogMessagesAtServiceLevel`, `LogMessagesAtTransportLevel`, `LogMalformedMessages`, and `TraceLevel`. Therefore, if you configure a trace listener for message logging, but set these options to `false` in configuration, you can later change them to `true` when the application is running. This will effectively enable message logging at runtime. Similarly, if you enable message logging in your configuration file, you can disable it at runtime using WMI.  \n  \n You should be aware that if no message logging trace listeners for message logging, or no `System.ServiceModel` trace listeners for tracing are specified in the configuration file, none of your changes are taken into effect, even though the changes are accepted by WMI. For more information on properly setting up the respective listeners, see [Configuring Message Logging](../../../../../docs/framework/wcf/diagnostics/configuring-message-logging.md) and [Configuring Tracing](../../../../../docs/framework/wcf/diagnostics/tracing/configuring-tracing.md). The trace level of all other trace sources specified by configuration is effective when the application starts, and cannot be changed.  \n  \n WCF exposes a `GetOperationCounterInstanceName` method for scripting. This method returns a performance counter instance name if you provide it with an operation name. However, it does not validate your input. Therefore, if you provide an incorrect operation name, an incorrect counter name is returned.  \n  \n The `OutgoingChannel` property of the `Service` instance does not count channels opened by a service to connect to another service, if the WCF client to the destination service is not created within the `Service` method.  \n  \n **Caution** WMI only supports a <xref:System.TimeSpan> value up to 3 decimal points. For example, if your service sets one of its properties to <xref:System.TimeSpan.MaxValue>, its value is truncated after 3 decimal points when viewed through WMI.  \n  \n## Security  \n Because the WCF WMI provider allows the discovery of services in an environment, you should exercise extreme caution for granting access to it. If you relax the default administrator-only access, you may allow less-trusted parties access to sensitive data in your environment. Specifically, if you loosen permissions on remote WMI access, flooding attacks can occur. If a process is flooded by excessive WMI requests, its performance can be degraded.  \n  \n In addition, if you relax access permissions for the MOF file, less-trusted parties can manipulate the behavior of WMI and alter the objects that are loaded in the WMI schema. For example, fields can be removed such that critical data is concealed from the administrator or that fields that do not populate or cause exceptions are added to the file.  \n  \n By default, the WCF WMI provider grants \"execute method\", \"provider write\", and \"enable account\" permission for Administrator, and \"enable account\" permission for ASP.NET, Local Service and Network Service. In particular, on non-[!INCLUDE[wv](../../../../../includes/wv-md.md)] platforms, the ASP.NET account has read access to the WMI ServiceModel namespace. If you do not want to grant these privileges to a particular user group, you should either deactivate the WMI provider (it is disabled by default), or disable access for the specific user group.  \n  \n In addition, when you attempt to enable WMI through configuration, WMI may not be enabled due to insufficient user privilege. However, no event is written to the event log to record this failure.  \n  \n To modify user privilege levels, use the following steps.  \n  \n1.  Click Start and then Run and type **compmgmt.msc**.  \n  \n2.  Right-click **Services and Application/WMI Controls** to select **Properties**.  \n  \n3.  Select the **Security** Tab, and navigate to the **Root/ServiceModel** namespace. Click the **Security** button.  \n  \n4.  Select the specific group or user that you want to control access and use the **Allow** or **Deny** checkbox to configure permissions.  \n  \n## Granting WCF WMI Registration Permissions to Additional Users  \n WCF exposes management data to WMI. It does so by hosting an in-process WMI provider, sometimes called a \"decoupled provider\". For the management data to be exposed, the account that registers this provider must have the appropriate permissions. In Windows, only a small set of privileged accounts can register decoupled providers by default. This is a problem because users commonly want to expose WMI data from a WCF service running under an account that is not in the default set.  \n  \n To provide this access, an administrator must grant the following permissions to the additional account in the following order:  \n  \n1.  Permission to access to the WCF WMI Namespace.  \n  \n2.  Permission to register the WCF Decoupled WMI Provider.  \n  \n#### To grant WMI namespace access permission  \n  \n1.  Run the following PowerShell script.  \n  \n    ```powershell  \n    write-host \"\"  \n    write-host \"Granting Access to root/servicemodel WMI namespace to built in users group\"  \n    write-host \"\"  \n  \n    # Create the binary representation of the permissions to grant in SDDL  \n    $newPermissions = \"O:BAG:BAD:P(A;CI;CCDCLCSWRPWPRCWD;;;BA)(A;CI;CC;;;NS)(A;CI;CC;;;LS)(A;CI;CC;;;BU)\"  \n    $converter = new-object system.management.ManagementClass Win32_SecurityDescriptorHelper  \n    $binarySD = $converter.SDDLToBinarySD($newPermissions)  \n    $convertedPermissions = ,$binarySD.BinarySD  \n  \n    # Get the object used to set the permissions  \n    $security = gwmi -namespace root/servicemodel -class __SystemSecurity  \n  \n    # Get and output the current settings  \n    $binarySD = @($null)  \n    $result = $security.PsBase.InvokeMethod(\"GetSD\",$binarySD)  \n  \n    $outsddl = $converter.BinarySDToSDDL($binarySD[0])  \n    write-host \"Previous ACL: \"$outsddl.SDDL  \n  \n    # Change the Access Control List (ACL) using SDDL  \n    $result = $security.PsBase.InvokeMethod(\"SetSD\",$convertedPermissions)   \n  \n    # Get and output the current settings  \n    $binarySD = @($null)  \n    $result = $security.PsBase.InvokeMethod(\"GetSD\",$binarySD)  \n  \n    $outsddl = $converter.BinarySDToSDDL($binarySD[0])  \n    write-host \"New ACL:      \"$outsddl.SDDL  \n    write-host \"\"  \n    ```  \n  \n     This PowerShell script uses Security Descriptor Definition Language (SDDL) to grant the Built-In Users group access to the \"root/servicemodel\" WMI namespace. It specifies the following ACLs:  \n  \n    -   Built-In Administrator (BA) - Already Had Access.  \n  \n    -   Network Service (NS) - Already Had Access.  \n  \n    -   Local System (LS) - Already Had Access.  \n  \n    -   Built-In Users - The group to grant access to.  \n  \n#### To grant provider registration access  \n  \n1.  Run the following PowerShell script.  \n  \n    ```powershell  \n    write-host \"\"  \n    write-host \"Granting WCF provider registration access to built in users group\"  \n    write-host \"\"  \n    # Set security on ServiceModel provider  \n    $provider = get-WmiObject -namespace \"root\\servicemodel\" __Win32Provider  \n  \n    write-host \"Previous ACL: \"$provider.SecurityDescriptor  \n    $result = $provider.SecurityDescriptor = \"O:BUG:BUD:(A;;0x1;;;BA)(A;;0x1;;;NS)(A;;0x1;;;LS)(A;;0x1;;;BU)\"  \n  \n    # Commit the changes and display it to the console  \n    $result = $provider.Put()  \n    write-host \"New ACL:      \"$provider.SecurityDescriptor  \n    write-host \"\"  \n    ```  \n  \n### Granting Access to Arbitrary Users or Groups  \n The example in this section grants WMI Provider registration privileges to all local users. If you want to grant access to a user or group that is not built in, then you must obtain that user or group’s Security Identifier (SID). There is no simple way to get the SID for an arbitrary user. One method is to log on as the desired user and then issue the following shell command.  \n  \n```  \nWhoami /user  \n```  \n  \n This provides the SID of the current user, but this method cannot be used to get the SID on any arbitrary user. Another method to get the SID is to use the [getsid.exe](https://go.microsoft.com/fwlink/?LinkId=186467) tool from the [Windows 2000 Resource Kit Tools for administrative tasks](https://go.microsoft.com/fwlink/?LinkId=178660). This tool compares the SID of two users (local or domain), and as a side effect prints the two SIDs to the command line. For more information, see [Well Known SIDs](https://go.microsoft.com/fwlink/?LinkId=186468).  \n  \n## Accessing Remote WMI Object Instances  \n If you need to access WCF WMI instances on a remote machine, you must enable packet privacy on the tools that you use for access. The following section describes how to achieve these using the WMI CIM Studio, Windows Management Instrumentation Tester, as well as .NET SDK 2.0.  \n  \n### WMI CIM Studio  \n If you have installed [WMI Administrative Tools](https://go.microsoft.com/fwlink/?LinkId=95185), you can use the WMI CIM Studio to access WMI instances. The tools are in the following folder  \n  \n **%windir%\\Program Files\\WMI Tools\\\\**  \n  \n1.  In the **Connect to namespace:** window, type **root\\ServiceModel** and click **OK.**  \n  \n2.  In the **WMI CIM Studio Login** window, click the **Options >>** button to expand the window. Select **Packet privacy** for **Authentication level**, and click **OK**.  \n  \n### Windows Management Instrumentation Tester  \n This tool is installed by Windows. To run it, launch a command console by typing **cmd.exe** in the **Start/Run** dialog box and click **OK**. Then, type **wbemtest.exe** in the command window. The Windows Management Instrumentation Tester tool is then launched.  \n  \n1.  Click the **Connect** button on the top right corner of the window.  \n  \n2.  In the new window, enter **root\\ServiceModel** for the **Namespace** field, and select **Packet privacy** for **Authentication level**. Click **Connect**.  \n  \n### Using Managed Code  \n You can also access remote WMI instances programmatically by using classes provided by the <xref:System.Management> namespace. The following code sample demonstrates how to do this.  \n  \n```csharp\nString wcfNamespace = $@\"\\\\{this.serviceMachineName}\\Root\\ServiceModel\");\n  \nConnectionOptions connection = new ConnectionOptions();  \nconnection.Authentication = AuthenticationLevel.PacketPrivacy;  \nManagementScope scope = new ManagementScope(this.wcfNamespace, connection);  \n```\n","nodes":[{"pos":[4,140],"embed":true,"restype":"x-metadata","content":"title: \"Using Windows Management Instrumentation for Diagnostics\"\nms.date: \"03/30/2017\"\nms.assetid: fe48738d-e31b-454d-b5ec-24c85c6bf79a","nodes":[{"content":"Using Windows Management Instrumentation for Diagnostics","nodes":[{"pos":[0,56],"content":"Using Windows Management Instrumentation for Diagnostics","nodes":[{"content":"Using Windows Management Instrumentation for Diagnostics","pos":[0,56]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[147,203],"content":"Using Windows Management Instrumentation for Diagnostics","linkify":"Using Windows Management Instrumentation for Diagnostics","nodes":[{"content":"Using Windows Management Instrumentation for Diagnostics","pos":[0,56]}]},{"content":"Windows Communication Foundation (WCF) exposes inspection data of a service at runtime through a WCF Windows Management Instrumentation (WMI) provider.","pos":[204,355]},{"pos":[364,376],"content":"Enabling WMI","linkify":"Enabling WMI","nodes":[{"content":"Enabling WMI","pos":[0,12]}]},{"content":"WMI is Microsoft's implementation of the Web-Based Enterprise Management (WBEM) standard.","pos":[380,469]},{"content":"For more information about the WMI SDK, see <bpt id=\"p1\">[</bpt>Windows Management Instrumentation<ept id=\"p1\">](/windows/desktop/WmiSdk/wmi-start-page)</ept>.","pos":[470,591],"source":" For more information about the WMI SDK, see [Windows Management Instrumentation](/windows/desktop/WmiSdk/wmi-start-page)."},{"content":"WBEM is an industry standard for how applications expose management instrumentation to external management tools.","pos":[592,705]},{"content":"A WMI provider is a component that exposes instrumentation at runtime through a WBEM-compatible interface.","pos":[712,818]},{"content":"It consists of a set of WMI objects that have attribute/value pairs.","pos":[819,887]},{"content":"Pairs can be of a number of simple types.","pos":[888,929]},{"content":"Management tools can connect to the services through the interface at runtime.","pos":[930,1008]},{"content":"WCF exposes attributes of services such as addresses, bindings, behaviors, and listeners.","pos":[1009,1098]},{"content":"The built-in WMI provider can be activated in the configuration file of the application.","pos":[1105,1193]},{"content":"This is done through the <ph id=\"ph1\">`wmiProviderEnabled`</ph> attribute of the <bpt id=\"p1\">[</bpt><ph id=\"ph2\">\\&lt;</ph>diagnostics&gt;<ept id=\"p1\">](../../../../../docs/framework/configure-apps/file-schema/wcf/diagnostics.md)</ept> in the <bpt id=\"p2\">[</bpt><ph id=\"ph3\">\\&lt;</ph>system.serviceModel&gt;<ept id=\"p2\">](../../../../../docs/framework/configure-apps/file-schema/wcf/system-servicemodel.md)</ept> section, as shown in the following sample configuration.","pos":[1194,1524],"source":" This is done through the `wmiProviderEnabled` attribute of the [\\<diagnostics>](../../../../../docs/framework/configure-apps/file-schema/wcf/diagnostics.md) in the [\\<system.serviceModel>](../../../../../docs/framework/configure-apps/file-schema/wcf/system-servicemodel.md) section, as shown in the following sample configuration."},{"content":"This configuration entry exposes a WMI interface.","pos":[1662,1711]},{"content":"Management applications can now connect through this interface and access the management instrumentation of the application.","pos":[1712,1836]},{"pos":[1845,1863],"content":"Accessing WMI Data","linkify":"Accessing WMI Data","nodes":[{"content":"Accessing WMI Data","pos":[0,18]}]},{"content":"WMI data can be accessed in many different ways.","pos":[1867,1915]},{"content":"Microsoft provides WMI APIs for scripts, Visual Basic applications, C++ applications, and the <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../../../includes/dnprdnshort-md.md)]</ph>.","pos":[1916,2077],"source":" Microsoft provides WMI APIs for scripts, Visual Basic applications, C++ applications, and the [!INCLUDE[dnprdnshort](../../../../../includes/dnprdnshort-md.md)]."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Using WMI<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=95183)</ept>.","pos":[2078,2163],"source":" For more information, see [Using WMI](https://go.microsoft.com/fwlink/?LinkId=95183)."},{"pos":[2171,2618],"content":"[!CAUTION]\n If you use the .NET Framework provided methods to programmatically access WMI data, you should be aware that such methods may throw exceptions when the connection is established. The connection is not established during the construction of the <xref:System.Management.ManagementObject> instance, but on the first request involving actual data exchange. Therefore, you should use a `try..catch` block to catch the possible exceptions.","leadings":["","> "],"nodes":[{"content":"If you use the .NET Framework provided methods to programmatically access WMI data, you should be aware that such methods may throw exceptions when the connection is established. The connection is not established during the construction of the <xref:System.Management.ManagementObject> instance, but on the first request involving actual data exchange. Therefore, you should use a `try..catch` block to catch the possible exceptions.","pos":[12,445],"nodes":[{"content":"If you use the .NET Framework provided methods to programmatically access WMI data, you should be aware that such methods may throw exceptions when the connection is established.","pos":[0,178]},{"content":"The connection is not established during the construction of the <ph id=\"ph1\">&lt;xref:System.Management.ManagementObject&gt;</ph> instance, but on the first request involving actual data exchange.","pos":[179,352],"source":" The connection is not established during the construction of the <xref:System.Management.ManagementObject> instance, but on the first request involving actual data exchange."},{"content":"Therefore, you should use a <ph id=\"ph1\">`try..catch`</ph> block to catch the possible exceptions.","pos":[353,433],"source":" Therefore, you should use a `try..catch` block to catch the possible exceptions."}]}]},{"content":"You can change the trace and message logging level, as well as message logging options for the <ph id=\"ph1\">`System.ServiceModel`</ph> trace source in WMI.","pos":[2625,2762],"source":"You can change the trace and message logging level, as well as message logging options for the `System.ServiceModel` trace source in WMI."},{"content":"This can be done by accessing the <bpt id=\"p1\">[</bpt>AppDomainInfo<ept id=\"p1\">](../../../../../docs/framework/wcf/diagnostics/wmi/appdomaininfo.md)</ept> instance, which exposes these Boolean properties: <ph id=\"ph1\">`LogMessagesAtServiceLevel`</ph>, <ph id=\"ph2\">`LogMessagesAtTransportLevel`</ph>, <ph id=\"ph3\">`LogMalformedMessages`</ph>, and <ph id=\"ph4\">`TraceLevel`</ph>.","pos":[2763,3032],"source":" This can be done by accessing the [AppDomainInfo](../../../../../docs/framework/wcf/diagnostics/wmi/appdomaininfo.md) instance, which exposes these Boolean properties: `LogMessagesAtServiceLevel`, `LogMessagesAtTransportLevel`, `LogMalformedMessages`, and `TraceLevel`."},{"content":"Therefore, if you configure a trace listener for message logging, but set these options to <ph id=\"ph1\">`false`</ph> in configuration, you can later change them to <ph id=\"ph2\">`true`</ph> when the application is running.","pos":[3033,3218],"source":" Therefore, if you configure a trace listener for message logging, but set these options to `false` in configuration, you can later change them to `true` when the application is running."},{"content":"This will effectively enable message logging at runtime.","pos":[3219,3275]},{"content":"Similarly, if you enable message logging in your configuration file, you can disable it at runtime using WMI.","pos":[3276,3385]},{"content":"You should be aware that if no message logging trace listeners for message logging, or no <ph id=\"ph1\">`System.ServiceModel`</ph> trace listeners for tracing are specified in the configuration file, none of your changes are taken into effect, even though the changes are accepted by WMI.","pos":[3392,3661],"source":"You should be aware that if no message logging trace listeners for message logging, or no `System.ServiceModel` trace listeners for tracing are specified in the configuration file, none of your changes are taken into effect, even though the changes are accepted by WMI."},{"content":"For more information on properly setting up the respective listeners, see <bpt id=\"p1\">[</bpt>Configuring Message Logging<ept id=\"p1\">](../../../../../docs/framework/wcf/diagnostics/configuring-message-logging.md)</ept> and <bpt id=\"p2\">[</bpt>Configuring Tracing<ept id=\"p2\">](../../../../../docs/framework/wcf/diagnostics/tracing/configuring-tracing.md)</ept>.","pos":[3662,3948],"source":" For more information on properly setting up the respective listeners, see [Configuring Message Logging](../../../../../docs/framework/wcf/diagnostics/configuring-message-logging.md) and [Configuring Tracing](../../../../../docs/framework/wcf/diagnostics/tracing/configuring-tracing.md)."},{"content":"The trace level of all other trace sources specified by configuration is effective when the application starts, and cannot be changed.","pos":[3949,4083]},{"content":"WCF exposes a <ph id=\"ph1\">`GetOperationCounterInstanceName`</ph> method for scripting.","pos":[4090,4159],"source":"WCF exposes a `GetOperationCounterInstanceName` method for scripting."},{"content":"This method returns a performance counter instance name if you provide it with an operation name.","pos":[4160,4257]},{"content":"However, it does not validate your input.","pos":[4258,4299]},{"content":"Therefore, if you provide an incorrect operation name, an incorrect counter name is returned.","pos":[4300,4393]},{"pos":[4400,4620],"content":"The <ph id=\"ph1\">`OutgoingChannel`</ph> property of the <ph id=\"ph2\">`Service`</ph> instance does not count channels opened by a service to connect to another service, if the WCF client to the destination service is not created within the <ph id=\"ph3\">`Service`</ph> method.","source":"The `OutgoingChannel` property of the `Service` instance does not count channels opened by a service to connect to another service, if the WCF client to the destination service is not created within the `Service` method."},{"content":"<bpt id=\"p1\">**</bpt>Caution<ept id=\"p1\">**</ept> WMI only supports a <ph id=\"ph1\">&lt;xref:System.TimeSpan&gt;</ph> value up to 3 decimal points.","pos":[4627,4711],"source":"**Caution** WMI only supports a <xref:System.TimeSpan> value up to 3 decimal points."},{"content":"For example, if your service sets one of its properties to <ph id=\"ph1\">&lt;xref:System.TimeSpan.MaxValue&gt;</ph>, its value is truncated after 3 decimal points when viewed through WMI.","pos":[4712,4874],"source":" For example, if your service sets one of its properties to <xref:System.TimeSpan.MaxValue>, its value is truncated after 3 decimal points when viewed through WMI."},{"pos":[4883,4891],"content":"Security","linkify":"Security","nodes":[{"content":"Security","pos":[0,8]}]},{"content":"Because the WCF WMI provider allows the discovery of services in an environment, you should exercise extreme caution for granting access to it.","pos":[4895,5038]},{"content":"If you relax the default administrator-only access, you may allow less-trusted parties access to sensitive data in your environment.","pos":[5039,5171]},{"content":"Specifically, if you loosen permissions on remote WMI access, flooding attacks can occur.","pos":[5172,5261]},{"content":"If a process is flooded by excessive WMI requests, its performance can be degraded.","pos":[5262,5345]},{"content":"In addition, if you relax access permissions for the MOF file, less-trusted parties can manipulate the behavior of WMI and alter the objects that are loaded in the WMI schema.","pos":[5352,5527]},{"content":"For example, fields can be removed such that critical data is concealed from the administrator or that fields that do not populate or cause exceptions are added to the file.","pos":[5528,5701]},{"content":"By default, the WCF WMI provider grants \"execute method\", \"provider write\", and \"enable account\" permission for Administrator, and \"enable account\" permission for ASP.NET, Local Service and Network Service.","pos":[5708,5914]},{"content":"In particular, on non-<ph id=\"ph1\">[!INCLUDE[wv](../../../../../includes/wv-md.md)]</ph> platforms, the ASP.NET account has read access to the WMI ServiceModel namespace.","pos":[5915,6067],"source":" In particular, on non-[!INCLUDE[wv](../../../../../includes/wv-md.md)] platforms, the ASP.NET account has read access to the WMI ServiceModel namespace."},{"content":"If you do not want to grant these privileges to a particular user group, you should either deactivate the WMI provider (it is disabled by default), or disable access for the specific user group.","pos":[6068,6262]},{"content":"In addition, when you attempt to enable WMI through configuration, WMI may not be enabled due to insufficient user privilege.","pos":[6269,6394]},{"content":"However, no event is written to the event log to record this failure.","pos":[6395,6464]},{"content":"To modify user privilege levels, use the following steps.","pos":[6471,6528]},{"pos":[6538,6589],"content":"Click Start and then Run and type <bpt id=\"p1\">**</bpt>compmgmt.msc<ept id=\"p1\">**</ept>.","source":"Click Start and then Run and type **compmgmt.msc**."},{"pos":[6599,6678],"content":"Right-click <bpt id=\"p1\">**</bpt>Services and Application/WMI Controls<ept id=\"p1\">**</ept> to select <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>.","source":"Right-click **Services and Application/WMI Controls** to select **Properties**."},{"content":"Select the <bpt id=\"p1\">**</bpt>Security<ept id=\"p1\">**</ept> Tab, and navigate to the <bpt id=\"p2\">**</bpt>Root/ServiceModel<ept id=\"p2\">**</ept> namespace.","pos":[6688,6769],"source":"Select the **Security** Tab, and navigate to the **Root/ServiceModel** namespace."},{"content":"Click the <bpt id=\"p1\">**</bpt>Security<ept id=\"p1\">**</ept> button.","pos":[6770,6800],"source":" Click the **Security** button."},{"pos":[6810,6944],"content":"Select the specific group or user that you want to control access and use the <bpt id=\"p1\">**</bpt>Allow<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>Deny<ept id=\"p2\">**</ept> checkbox to configure permissions.","source":"Select the specific group or user that you want to control access and use the **Allow** or **Deny** checkbox to configure permissions."},{"pos":[6953,7014],"content":"Granting WCF WMI Registration Permissions to Additional Users","linkify":"Granting WCF WMI Registration Permissions to Additional Users","nodes":[{"content":"Granting WCF WMI Registration Permissions to Additional Users","pos":[0,61]}]},{"content":"WCF exposes management data to WMI.","pos":[7018,7053]},{"content":"It does so by hosting an in-process WMI provider, sometimes called a \"decoupled provider\".","pos":[7054,7144]},{"content":"For the management data to be exposed, the account that registers this provider must have the appropriate permissions.","pos":[7145,7263]},{"content":"In Windows, only a small set of privileged accounts can register decoupled providers by default.","pos":[7264,7360]},{"content":"This is a problem because users commonly want to expose WMI data from a WCF service running under an account that is not in the default set.","pos":[7361,7501]},{"content":"To provide this access, an administrator must grant the following permissions to the additional account in the following order:","pos":[7508,7635]},{"content":"Permission to access to the WCF WMI Namespace.","pos":[7645,7691]},{"content":"Permission to register the WCF Decoupled WMI Provider.","pos":[7701,7755]},{"pos":[7766,7806],"content":"To grant WMI namespace access permission","linkify":"To grant WMI namespace access permission","nodes":[{"content":"To grant WMI namespace access permission","pos":[0,40]}]},{"content":"Run the following PowerShell script.","pos":[7816,7852]},{"content":"This PowerShell script uses Security Descriptor Definition Language (SDDL) to grant the Built-In Users group access to the \"root/servicemodel\" WMI namespace.","pos":[9203,9360]},{"content":"It specifies the following ACLs:","pos":[9361,9393]},{"content":"Built-In Administrator (BA) - Already Had Access.","pos":[9407,9456]},{"content":"Network Service (NS) - Already Had Access.","pos":[9470,9512]},{"content":"Local System (LS) - Already Had Access.","pos":[9526,9565]},{"content":"Built-In Users - The group to grant access to.","pos":[9579,9625]},{"pos":[9636,9673],"content":"To grant provider registration access","linkify":"To grant provider registration access","nodes":[{"content":"To grant provider registration access","pos":[0,37]}]},{"content":"Run the following PowerShell script.","pos":[9683,9719]},{"pos":[10363,10407],"content":"Granting Access to Arbitrary Users or Groups","linkify":"Granting Access to Arbitrary Users or Groups","nodes":[{"content":"Granting Access to Arbitrary Users or Groups","pos":[0,44]}]},{"content":"The example in this section grants WMI Provider registration privileges to all local users.","pos":[10411,10502]},{"content":"If you want to grant access to a user or group that is not built in, then you must obtain that user or group’s Security Identifier (SID).","pos":[10503,10640]},{"content":"There is no simple way to get the SID for an arbitrary user.","pos":[10641,10701]},{"content":"One method is to log on as the desired user and then issue the following shell command.","pos":[10702,10789]},{"content":"This provides the SID of the current user, but this method cannot be used to get the SID on any arbitrary user.","pos":[10826,10937]},{"content":"Another method to get the SID is to use the <bpt id=\"p1\">[</bpt>getsid.exe<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=186467)</ept> tool from the <bpt id=\"p2\">[</bpt>Windows 2000 Resource Kit Tools for administrative tasks<ept id=\"p2\">](https://go.microsoft.com/fwlink/?LinkId=178660)</ept>.","pos":[10938,11164],"source":" Another method to get the SID is to use the [getsid.exe](https://go.microsoft.com/fwlink/?LinkId=186467) tool from the [Windows 2000 Resource Kit Tools for administrative tasks](https://go.microsoft.com/fwlink/?LinkId=178660)."},{"content":"This tool compares the SID of two users (local or domain), and as a side effect prints the two SIDs to the command line.","pos":[11165,11285]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Well Known SIDs<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=186468)</ept>.","pos":[11286,11378],"source":" For more information, see [Well Known SIDs](https://go.microsoft.com/fwlink/?LinkId=186468)."},{"pos":[11387,11424],"content":"Accessing Remote WMI Object Instances","linkify":"Accessing Remote WMI Object Instances","nodes":[{"content":"Accessing Remote WMI Object Instances","pos":[0,37]}]},{"content":"If you need to access WCF WMI instances on a remote machine, you must enable packet privacy on the tools that you use for access.","pos":[11428,11557]},{"content":"The following section describes how to achieve these using the WMI CIM Studio, Windows Management Instrumentation Tester, as well as .NET SDK 2.0.","pos":[11558,11704]},{"pos":[11714,11728],"content":"WMI CIM Studio","linkify":"WMI CIM Studio","nodes":[{"content":"WMI CIM Studio","pos":[0,14]}]},{"content":"If you have installed <bpt id=\"p1\">[</bpt>WMI Administrative Tools<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=95185)</ept>, you can use the WMI CIM Studio to access WMI instances.","pos":[11732,11884],"source":"If you have installed [WMI Administrative Tools](https://go.microsoft.com/fwlink/?LinkId=95185), you can use the WMI CIM Studio to access WMI instances."},{"content":"The tools are in the following folder","pos":[11885,11922]},{"pos":[11929,11967],"content":"<bpt id=\"p1\">**</bpt>%windir%\\Program Files\\WMI Tools<ph id=\"ph1\">\\\\</ph><ept id=\"p1\">**</ept>","source":"**%windir%\\Program Files\\WMI Tools\\\\**"},{"pos":[11977,12062],"content":"In the <bpt id=\"p1\">**</bpt>Connect to namespace:<ept id=\"p1\">**</ept> window, type <bpt id=\"p2\">**</bpt>root\\ServiceModel<ept id=\"p2\">**</ept> and click <bpt id=\"p3\">**</bpt>OK.<ept id=\"p3\">**</ept>","source":"In the **Connect to namespace:** window, type **root\\ServiceModel** and click **OK.**"},{"content":"In the <bpt id=\"p1\">**</bpt>WMI CIM Studio Login<ept id=\"p1\">**</ept> window, click the <bpt id=\"p2\">**</bpt>Options &gt;&gt;<ept id=\"p2\">**</ept> button to expand the window.","pos":[12072,12165],"source":"In the **WMI CIM Studio Login** window, click the **Options >>** button to expand the window."},{"content":"Select <bpt id=\"p1\">**</bpt>Packet privacy<ept id=\"p1\">**</ept> for <bpt id=\"p2\">**</bpt>Authentication level<ept id=\"p2\">**</ept>, and click <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept>.","pos":[12166,12239],"source":" Select **Packet privacy** for **Authentication level**, and click **OK**."},{"pos":[12249,12290],"content":"Windows Management Instrumentation Tester","linkify":"Windows Management Instrumentation Tester","nodes":[{"content":"Windows Management Instrumentation Tester","pos":[0,41]}]},{"content":"This tool is installed by Windows.","pos":[12294,12328]},{"content":"To run it, launch a command console by typing <bpt id=\"p1\">**</bpt>cmd.exe<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>Start/Run<ept id=\"p2\">**</ept> dialog box and click <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept>.","pos":[12329,12436],"source":" To run it, launch a command console by typing **cmd.exe** in the **Start/Run** dialog box and click **OK**."},{"content":"Then, type <bpt id=\"p1\">**</bpt>wbemtest.exe<ept id=\"p1\">**</ept> in the command window.","pos":[12437,12487],"source":" Then, type **wbemtest.exe** in the command window."},{"content":"The Windows Management Instrumentation Tester tool is then launched.","pos":[12488,12556]},{"pos":[12566,12633],"content":"Click the <bpt id=\"p1\">**</bpt>Connect<ept id=\"p1\">**</ept> button on the top right corner of the window.","source":"Click the **Connect** button on the top right corner of the window."},{"content":"In the new window, enter <bpt id=\"p1\">**</bpt>root\\ServiceModel<ept id=\"p1\">**</ept> for the <bpt id=\"p2\">**</bpt>Namespace<ept id=\"p2\">**</ept> field, and select <bpt id=\"p3\">**</bpt>Packet privacy<ept id=\"p3\">**</ept> for <bpt id=\"p4\">**</bpt>Authentication level<ept id=\"p4\">**</ept>.","pos":[12643,12778],"source":"In the new window, enter **root\\ServiceModel** for the **Namespace** field, and select **Packet privacy** for **Authentication level**."},{"content":"Click <bpt id=\"p1\">**</bpt>Connect<ept id=\"p1\">**</ept>.","pos":[12779,12797],"source":" Click **Connect**."},{"pos":[12807,12825],"content":"Using Managed Code","linkify":"Using Managed Code","nodes":[{"content":"Using Managed Code","pos":[0,18]}]},{"content":"You can also access remote WMI instances programmatically by using classes provided by the <ph id=\"ph1\">&lt;xref:System.Management&gt;</ph> namespace.","pos":[12829,12955],"source":"You can also access remote WMI instances programmatically by using classes provided by the <xref:System.Management> namespace."},{"content":"The following code sample demonstrates how to do this.","pos":[12956,13010]}]}