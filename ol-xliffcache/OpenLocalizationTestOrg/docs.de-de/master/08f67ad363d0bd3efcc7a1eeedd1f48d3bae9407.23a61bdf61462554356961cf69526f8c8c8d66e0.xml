{"content":"---\ntitle: \"asynchronousThreadAbort MDA\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"asynchronous thread aborts\"\n  - \"AsynchronousThreadAbort MDA\"\n  - \"managed debugging assistants (MDAs), asynchronous thread aborts\"\n  - \"threading [.NET Framework], managed debugging assistants\"\n  - \"MDAs (managed debugging assistants), asynchronous thread aborts\"\nms.assetid: 9ebe40b2-d703-421e-8660-984acc42bfe0\nauthor: \"mairaw\"\nms.author: \"mairaw\"\n---\n# asynchronousThreadAbort MDA\nThe `asynchronousThreadAbort` managed debugging assistant (MDA) is activated when a thread attempts to introduce an asynchronous abort into another thread. Synchronous thread aborts do not activate the `asynchronousThreadAbort` MDA.\n\n## Symptoms\n An application crashes with an unhandled <xref:System.Threading.ThreadAbortException> when the main application thread is aborted. If the application were to continue to execute, the consequences might be worse than the application crashing, possibly resulting in further data corruption.\n\n Operations meant to be atomic have likely been interrupted after partial completion, leaving application data in an unpredictable state. A <xref:System.Threading.ThreadAbortException> can be generated from seemingly random points in the execution of code, often in places from which an exception is not expected to arise. The code might not be capable of handling such an exception, resulting in a corrupt state.\n\n Symptoms can vary widely due to the randomness inherent to the problem.\n\n## Cause\n Code in one thread called the <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> method on a target thread to introduce an asynchronous thread abort. The thread abort is asynchronous because the code that makes the call to <xref:System.Threading.Thread.Abort%2A> is running on a different thread than the target of the abort operation. Synchronous thread aborts should not cause a problem because the thread performing the <xref:System.Threading.Thread.Abort%2A> should have done so only at a safe checkpoint where application state is consistent.\n\n Asynchronous thread aborts present a problem because they are processed at unpredictable points in the target thread's execution. To avoid this, code written to run on a thread that might be aborted in this manner would need to handle a <xref:System.Threading.ThreadAbortException> at almost every line of code, taking care to put application data back into a consistent state. It is not realistic to expect code to be written with this problem in mind or to write code that protects against all possible circumstances.\n\n Calls into unmanaged code and `finally` blocks will not be aborted asynchronously but immediately upon exit from one of these categories.\n\n The cause might be difficult to determine due to the randomness inherent to the problem.\n\n## Resolution\n Avoid code design that requires the use of asynchronous thread aborts. There are several approaches more appropriate for interruption of a target thread that do not require a call to <xref:System.Threading.Thread.Abort%2A>. The safest is to introduce a mechanism, such as a common property, that signals the target thread to request an interrupt. The target thread checks the signal at certain safe checkpoints. If it notices that an interrupt has been requested, it can shut down gracefully.\n\n## Effect on the Runtime\n This MDA has no effect on the CLR. It only reports data about asynchronous thread aborts.\n\n## Output\n The MDA reports the ID of the thread performing the abort and the ID of the thread that is the target of the abort. These will never be the same because this is limited to asynchronous aborts.\n\n## Configuration\n\n```xml\n<mdaConfig>\n  <assistants>\n    <asynchronousThreadAbort />\n  </assistants>\n</mdaConfig>\n```\n\n## Example\n Activating the `asynchronousThreadAbort` MDA requires only a call to <xref:System.Threading.Thread.Abort%2A> on a separate running thread. Consider the consequences if the contents of the thread start function were a set of more complex operations which might be interrupted at any arbitrary point by the abort.\n\n```csharp\nusing System.Threading;\nvoid FireMda()\n{\n    Thread t = new Thread(delegate() { Thread.Sleep(1000); });\n    t.Start();\n    // The following line activates the MDA.\n    t.Abort();\n    t.Join();\n}\n```\n\n## See also\n\n- <xref:System.Threading.Thread>\n- [Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)\n","nodes":[{"pos":[4,440],"embed":true,"restype":"x-metadata","content":"title: \"asynchronousThreadAbort MDA\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"asynchronous thread aborts\"\n  - \"AsynchronousThreadAbort MDA\"\n  - \"managed debugging assistants (MDAs), asynchronous thread aborts\"\n  - \"threading [.NET Framework], managed debugging assistants\"\n  - \"MDAs (managed debugging assistants), asynchronous thread aborts\"\nms.assetid: 9ebe40b2-d703-421e-8660-984acc42bfe0\nauthor: \"mairaw\"\nms.author: \"mairaw\"","nodes":[{"content":"asynchronousThreadAbort MDA","nodes":[{"pos":[0,27],"content":"asynchronousThreadAbort MDA","nodes":[{"content":"asynchronousThreadAbort MDA","pos":[0,27]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[447,474],"content":"asynchronousThreadAbort MDA","linkify":"asynchronousThreadAbort MDA","nodes":[{"content":"asynchronousThreadAbort MDA","pos":[0,27]}]},{"content":"The <ph id=\"ph1\">`asynchronousThreadAbort`</ph> managed debugging assistant (MDA) is activated when a thread attempts to introduce an asynchronous abort into another thread.","pos":[475,630],"source":"The `asynchronousThreadAbort` managed debugging assistant (MDA) is activated when a thread attempts to introduce an asynchronous abort into another thread."},{"content":"Synchronous thread aborts do not activate the <ph id=\"ph1\">`asynchronousThreadAbort`</ph> MDA.","pos":[631,707],"source":" Synchronous thread aborts do not activate the `asynchronousThreadAbort` MDA."},{"pos":[712,720],"content":"Symptoms","linkify":"Symptoms","nodes":[{"content":"Symptoms","pos":[0,8]}]},{"content":"An application crashes with an unhandled <ph id=\"ph1\">&lt;xref:System.Threading.ThreadAbortException&gt;</ph> when the main application thread is aborted.","pos":[722,852],"source":"An application crashes with an unhandled <xref:System.Threading.ThreadAbortException> when the main application thread is aborted."},{"content":"If the application were to continue to execute, the consequences might be worse than the application crashing, possibly resulting in further data corruption.","pos":[853,1010]},{"content":"Operations meant to be atomic have likely been interrupted after partial completion, leaving application data in an unpredictable state.","pos":[1013,1149]},{"content":"A <ph id=\"ph1\">&lt;xref:System.Threading.ThreadAbortException&gt;</ph> can be generated from seemingly random points in the execution of code, often in places from which an exception is not expected to arise.","pos":[1150,1334],"source":" A <xref:System.Threading.ThreadAbortException> can be generated from seemingly random points in the execution of code, often in places from which an exception is not expected to arise."},{"content":"The code might not be capable of handling such an exception, resulting in a corrupt state.","pos":[1335,1425]},{"content":"Symptoms can vary widely due to the randomness inherent to the problem.","pos":[1428,1499]},{"pos":[1504,1509],"content":"Cause","linkify":"Cause","nodes":[{"content":"Cause","pos":[0,5]}]},{"content":"Code in one thread called the <ph id=\"ph1\">&lt;xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType&gt;</ph> method on a target thread to introduce an asynchronous thread abort.","pos":[1511,1678],"source":"Code in one thread called the <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> method on a target thread to introduce an asynchronous thread abort."},{"content":"The thread abort is asynchronous because the code that makes the call to <ph id=\"ph1\">&lt;xref:System.Threading.Thread.Abort%2A&gt;</ph> is running on a different thread than the target of the abort operation.","pos":[1679,1864],"source":" The thread abort is asynchronous because the code that makes the call to <xref:System.Threading.Thread.Abort%2A> is running on a different thread than the target of the abort operation."},{"content":"Synchronous thread aborts should not cause a problem because the thread performing the <ph id=\"ph1\">&lt;xref:System.Threading.Thread.Abort%2A&gt;</ph> should have done so only at a safe checkpoint where application state is consistent.","pos":[1865,2076],"source":" Synchronous thread aborts should not cause a problem because the thread performing the <xref:System.Threading.Thread.Abort%2A> should have done so only at a safe checkpoint where application state is consistent."},{"content":"Asynchronous thread aborts present a problem because they are processed at unpredictable points in the target thread's execution.","pos":[2079,2208]},{"content":"To avoid this, code written to run on a thread that might be aborted in this manner would need to handle a <ph id=\"ph1\">&lt;xref:System.Threading.ThreadAbortException&gt;</ph> at almost every line of code, taking care to put application data back into a consistent state.","pos":[2209,2456],"source":" To avoid this, code written to run on a thread that might be aborted in this manner would need to handle a <xref:System.Threading.ThreadAbortException> at almost every line of code, taking care to put application data back into a consistent state."},{"content":"It is not realistic to expect code to be written with this problem in mind or to write code that protects against all possible circumstances.","pos":[2457,2598]},{"pos":[2601,2738],"content":"Calls into unmanaged code and <ph id=\"ph1\">`finally`</ph> blocks will not be aborted asynchronously but immediately upon exit from one of these categories.","source":"Calls into unmanaged code and `finally` blocks will not be aborted asynchronously but immediately upon exit from one of these categories."},{"content":"The cause might be difficult to determine due to the randomness inherent to the problem.","pos":[2741,2829]},{"pos":[2834,2844],"content":"Resolution","linkify":"Resolution","nodes":[{"content":"Resolution","pos":[0,10]}]},{"content":"Avoid code design that requires the use of asynchronous thread aborts.","pos":[2846,2916]},{"content":"There are several approaches more appropriate for interruption of a target thread that do not require a call to <ph id=\"ph1\">&lt;xref:System.Threading.Thread.Abort%2A&gt;</ph>.","pos":[2917,3069],"source":" There are several approaches more appropriate for interruption of a target thread that do not require a call to <xref:System.Threading.Thread.Abort%2A>."},{"content":"The safest is to introduce a mechanism, such as a common property, that signals the target thread to request an interrupt.","pos":[3070,3192]},{"content":"The target thread checks the signal at certain safe checkpoints.","pos":[3193,3257]},{"content":"If it notices that an interrupt has been requested, it can shut down gracefully.","pos":[3258,3338]},{"pos":[3343,3364],"content":"Effect on the Runtime","linkify":"Effect on the Runtime","nodes":[{"content":"Effect on the Runtime","pos":[0,21]}]},{"content":"This MDA has no effect on the CLR.","pos":[3366,3400]},{"content":"It only reports data about asynchronous thread aborts.","pos":[3401,3455]},{"pos":[3460,3466],"content":"Output","linkify":"Output","nodes":[{"content":"Output","pos":[0,6]}]},{"content":"The MDA reports the ID of the thread performing the abort and the ID of the thread that is the target of the abort.","pos":[3468,3583]},{"content":"These will never be the same because this is limited to asynchronous aborts.","pos":[3584,3660]},{"pos":[3665,3678],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"pos":[3783,3790],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"Activating the <ph id=\"ph1\">`asynchronousThreadAbort`</ph> MDA requires only a call to <ph id=\"ph2\">&lt;xref:System.Threading.Thread.Abort%2A&gt;</ph> on a separate running thread.","pos":[3792,3930],"source":"Activating the `asynchronousThreadAbort` MDA requires only a call to <xref:System.Threading.Thread.Abort%2A> on a separate running thread."},{"content":"Consider the consequences if the contents of the thread start function were a set of more complex operations which might be interrupted at any arbitrary point by the abort.","pos":[3931,4103]},{"pos":[4318,4326],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[4363,4516],"content":"<bpt id=\"p1\">[</bpt>Diagnosing Errors with Managed Debugging Assistants<ept id=\"p1\">](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)</ept>","source":"[Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)"}]}