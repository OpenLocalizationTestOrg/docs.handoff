{"content":"---\ntitle: \"Programming WCF Security\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"message security [WCF], programming overview\"\nms.assetid: 739ec222-4eda-4cc9-a470-67e64a7a3f10\n---\n# Programming WCF Security\nThis topic describes the fundamental programming tasks used to create a secure Windows Communication Foundation (WCF) application. This topic covers only authentication, confidentiality, and integrity, collectively known as *transfer security*. This topic does not cover authorization (the control of access to resources or services); for information on authorization, see [Authorization](../../../../docs/framework/wcf/feature-details/authorization-in-wcf.md).  \n  \n> [!NOTE]\n>  For a valuable introduction to security concepts, especially in regard to WCF, see the set of patterns and practices tutorials on MSDN at [Scenarios, Patterns, and Implementation Guidance for Web Services Enhancements (WSE) 3.0](https://go.microsoft.com/fwlink/?LinkID=88250).  \n  \n Programming WCF security is based on three steps setting the following: the security mode, a client credential type, and the credential values. You can perform these steps either through code or configuration.  \n  \n## Setting the Security Mode  \n The following explains the general steps for programming with the security mode in WCF:  \n  \n1.  Select one of the predefined bindings appropriate to your application requirements. For a list of the binding choices, see [System-Provided Bindings](../../../../docs/framework/wcf/system-provided-bindings.md). By default, nearly every binding has security enabled. The one exception is the <xref:System.ServiceModel.BasicHttpBinding> class (using configuration, the [\\<basicHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/basichttpbinding.md)).  \n  \n     The binding you select determines the transport. For example, <xref:System.ServiceModel.WSHttpBinding> uses HTTP as the transport; <xref:System.ServiceModel.NetTcpBinding> uses TCP.  \n  \n2.  Select one of the security modes for the binding. Note that the binding you select determines the available mode choices. For example, the <xref:System.ServiceModel.WSDualHttpBinding> does not allow transport security (it is not an option). Similarly, neither the <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> nor the <xref:System.ServiceModel.NetNamedPipeBinding> allows message security.  \n  \n     You have three choices:  \n  \n    1.  `Transport`  \n  \n         Transport security depends on the mechanism that the binding you have selected uses. For example, if you are using `WSHttpBinding` then the security mechanism is Secure Sockets Layer (SSL) (also the mechanism for the HTTPS protocol). Generally speaking, the main advantage of transport security is that it delivers good throughput no matter which transport you are using. However, it does have two limitations: The first is that the transport mechanism dictates the credential type used to authenticate a user. This is a drawback only if a service needs to interoperate with other services that demand different types of credentials. The second is that, because the security is not applied at the message level, security is implemented in a hop-by-hop manner rather than end-to-end. This latter limitation is an issue only if the message path between client and service includes intermediaries. For more information about which transport to use, see [Choosing a Transport](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md). For more information about using transport security, see [Transport Security Overview](../../../../docs/framework/wcf/feature-details/transport-security-overview.md).  \n  \n    2.  `Message`  \n  \n         Message security means that every message includes the necessary headers and data to keep the message secure. Because the composition of the headers varies, you can include any number of credentials. This becomes a factor if you are interoperating with other services that demand a specific credential type that a transport mechanism can't supply, or if the message must be used with more than one service, where each service demands a different credential type.  \n  \n         For more information, see [Message Security](../../../../docs/framework/wcf/feature-details/message-security-in-wcf.md).  \n  \n    3.  `TransportWithMessageCredential`  \n  \n         This choice uses the transport layer to secure the message transfer, while every message includes the rich credentials other services need. This combines the performance advantage of transport security with the rich credentials advantage of message security. This is available with the following bindings: <xref:System.ServiceModel.BasicHttpBinding>, <xref:System.ServiceModel.WSFederationHttpBinding>, <xref:System.ServiceModel.NetPeerTcpBinding>, and <xref:System.ServiceModel.WSHttpBinding>.  \n  \n3.  If you decide to use transport security for HTTP (in other words, HTTPS), you must also configure the host with an SSL certificate and enable SSL on a port. For more information, see [HTTP Transport Security](../../../../docs/framework/wcf/feature-details/http-transport-security.md).  \n  \n4.  If you are using the <xref:System.ServiceModel.WSHttpBinding> and do not need to establish a secure session, set the <xref:System.ServiceModel.NonDualMessageSecurityOverHttp.EstablishSecurityContext%2A> property to `false`.  \n  \n     A secure session occurs when a client and service create a channel using a symmetric key (both client and server use the same key for the length of a conversation, until the dialog is closed).  \n  \n## Setting the Client Credential Type  \n Select a client credential type as appropriate. For more information, see [Selecting a Credential Type](../../../../docs/framework/wcf/feature-details/selecting-a-credential-type.md). The following client credential types are available:  \n  \n-   `Windows`  \n  \n-   `Certificate`  \n  \n-   `Digest`  \n  \n-   `Basic`  \n  \n-   `UserName`  \n  \n-   `NTLM`  \n  \n-   `IssuedToken`  \n  \n Depending on how you set the mode, you must set the credential type. For example, if you have selected the `wsHttpBinding`, and have set the mode to \"Message,\" then you can also set the `clientCredentialType` attribute of the Message element to one of the following values: `None`, `Windows`, `UserName`, `Certificate`, and `IssuedToken`, as shown in the following configuration example.  \n  \n```xml  \n<system.serviceModel>  \n<bindings>  \n  <wsHttpBinding>  \n    <binding name=\"myBinding\">  \n      <security mode=\"Message\"/>  \n      <message clientCredentialType=\"Windows\"/>  \n    </binding>  \n</bindings>  \n</system.serviceModel>  \n```  \n  \n Or in code:  \n  \n [!code-csharp[c_WsHttpService#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_wshttpservice/cs/source.cs#1)]\n [!code-vb[c_WsHttpService#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_wshttpservice/vb/source.vb#1)]  \n  \n## Setting Service Credential Values  \n Once you select a client credential type, you must set the actual credentials for the service and client to use. On the service, credentials are set using the <xref:System.ServiceModel.Description.ServiceCredentials> class and returned by the <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> property of the <xref:System.ServiceModel.ServiceHostBase> class. The binding in use implies the service credential type, the security mode chosen, and the type of the client credential. The following code sets a certificate for a service credential.  \n  \n [!code-csharp[c_tcpService#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_tcpservice/cs/source.cs#3)]\n [!code-vb[c_tcpService#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_tcpservice/vb/source.vb#3)]  \n  \n## Setting Client Credential Values  \n On the client, set client credential values using the <xref:System.ServiceModel.Description.ClientCredentials> class and returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class. The following code sets a certificate as a credential on a client using the TCP protocol.  \n  \n [!code-csharp[c_TcpClient#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_tcpclient/cs/source.cs#1)]\n [!code-vb[c_TcpClient#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_tcpclient/vb/source.vb#1)]  \n  \n## See also\n\n- [Basic WCF Programming](../../../../docs/framework/wcf/basic-wcf-programming.md)\n- [Common Security Scenarios](../../../../docs/framework/wcf/feature-details/common-security-scenarios.md)\n","nodes":[{"pos":[4,215],"embed":true,"restype":"x-metadata","content":"title: \"Programming WCF Security\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"message security [WCF], programming overview\"\nms.assetid: 739ec222-4eda-4cc9-a470-67e64a7a3f10","nodes":[{"content":"Programming WCF Security","nodes":[{"pos":[0,24],"content":"Programming WCF Security","nodes":[{"content":"Programming WCF Security","pos":[0,24]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[222,246],"content":"Programming WCF Security","linkify":"Programming WCF Security","nodes":[{"content":"Programming WCF Security","pos":[0,24]}]},{"content":"This topic describes the fundamental programming tasks used to create a secure Windows Communication Foundation (WCF) application.","pos":[247,377]},{"content":"This topic covers only authentication, confidentiality, and integrity, collectively known as <bpt id=\"p1\">*</bpt>transfer security<ept id=\"p1\">*</ept>.","pos":[378,491],"source":" This topic covers only authentication, confidentiality, and integrity, collectively known as *transfer security*."},{"content":"This topic does not cover authorization (the control of access to resources or services); for information on authorization, see <bpt id=\"p1\">[</bpt>Authorization<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/authorization-in-wcf.md)</ept>.","pos":[492,708],"source":" This topic does not cover authorization (the control of access to resources or services); for information on authorization, see [Authorization](../../../../docs/framework/wcf/feature-details/authorization-in-wcf.md)."},{"pos":[716,1003],"content":"[!NOTE]\n For a valuable introduction to security concepts, especially in regard to WCF, see the set of patterns and practices tutorials on MSDN at [Scenarios, Patterns, and Implementation Guidance for Web Services Enhancements (WSE) 3.0](https://go.microsoft.com/fwlink/?LinkID=88250).","leadings":["","> "],"nodes":[{"content":"For a valuable introduction to security concepts, especially in regard to WCF, see the set of patterns and practices tutorials on MSDN at <bpt id=\"p1\">[</bpt>Scenarios, Patterns, and Implementation Guidance for Web Services Enhancements (WSE) 3.0<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkID=88250)</ept>.","pos":[9,285],"source":"For a valuable introduction to security concepts, especially in regard to WCF, see the set of patterns and practices tutorials on MSDN at [Scenarios, Patterns, and Implementation Guidance for Web Services Enhancements (WSE) 3.0](https://go.microsoft.com/fwlink/?LinkID=88250)."}]},{"content":"Programming WCF security is based on three steps setting the following: the security mode, a client credential type, and the credential values.","pos":[1010,1153]},{"content":"You can perform these steps either through code or configuration.","pos":[1154,1219]},{"pos":[1228,1253],"content":"Setting the Security Mode","linkify":"Setting the Security Mode","nodes":[{"content":"Setting the Security Mode","pos":[0,25]}]},{"content":"The following explains the general steps for programming with the security mode in WCF:","pos":[1257,1344]},{"content":"Select one of the predefined bindings appropriate to your application requirements.","pos":[1354,1437]},{"content":"For a list of the binding choices, see <bpt id=\"p1\">[</bpt>System-Provided Bindings<ept id=\"p1\">](../../../../docs/framework/wcf/system-provided-bindings.md)</ept>.","pos":[1438,1564],"source":" For a list of the binding choices, see [System-Provided Bindings](../../../../docs/framework/wcf/system-provided-bindings.md)."},{"content":"By default, nearly every binding has security enabled.","pos":[1565,1619]},{"content":"The one exception is the <ph id=\"ph1\">&lt;xref:System.ServiceModel.BasicHttpBinding&gt;</ph> class (using configuration, the <bpt id=\"p1\">[</bpt><ph id=\"ph2\">\\&lt;</ph>basicHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/basichttpbinding.md)</ept>).","pos":[1620,1823],"source":" The one exception is the <xref:System.ServiceModel.BasicHttpBinding> class (using configuration, the [\\<basicHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/basichttpbinding.md))."},{"content":"The binding you select determines the transport.","pos":[1834,1882]},{"content":"For example, <ph id=\"ph1\">&lt;xref:System.ServiceModel.WSHttpBinding&gt;</ph> uses HTTP as the transport; <ph id=\"ph2\">&lt;xref:System.ServiceModel.NetTcpBinding&gt;</ph> uses TCP.","pos":[1883,2015],"source":" For example, <xref:System.ServiceModel.WSHttpBinding> uses HTTP as the transport; <xref:System.ServiceModel.NetTcpBinding> uses TCP."},{"content":"Select one of the security modes for the binding.","pos":[2025,2074]},{"content":"Note that the binding you select determines the available mode choices.","pos":[2075,2146]},{"content":"For example, the <ph id=\"ph1\">&lt;xref:System.ServiceModel.WSDualHttpBinding&gt;</ph> does not allow transport security (it is not an option).","pos":[2147,2265],"source":" For example, the <xref:System.ServiceModel.WSDualHttpBinding> does not allow transport security (it is not an option)."},{"content":"Similarly, neither the <ph id=\"ph1\">&lt;xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding&gt;</ph> nor the <ph id=\"ph2\">&lt;xref:System.ServiceModel.NetNamedPipeBinding&gt;</ph> allows message security.","pos":[2266,2434],"source":" Similarly, neither the <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> nor the <xref:System.ServiceModel.NetNamedPipeBinding> allows message security."},{"content":"You have three choices:","pos":[2445,2468]},{"content":"Transport security depends on the mechanism that the binding you have selected uses.","pos":[2508,2592]},{"content":"For example, if you are using <ph id=\"ph1\">`WSHttpBinding`</ph> then the security mechanism is Secure Sockets Layer (SSL) (also the mechanism for the HTTPS protocol).","pos":[2593,2741],"source":" For example, if you are using `WSHttpBinding` then the security mechanism is Secure Sockets Layer (SSL) (also the mechanism for the HTTPS protocol)."},{"content":"Generally speaking, the main advantage of transport security is that it delivers good throughput no matter which transport you are using.","pos":[2742,2879]},{"content":"However, it does have two limitations: The first is that the transport mechanism dictates the credential type used to authenticate a user.","pos":[2880,3018]},{"content":"This is a drawback only if a service needs to interoperate with other services that demand different types of credentials.","pos":[3019,3141]},{"content":"The second is that, because the security is not applied at the message level, security is implemented in a hop-by-hop manner rather than end-to-end.","pos":[3142,3290]},{"content":"This latter limitation is an issue only if the message path between client and service includes intermediaries.","pos":[3291,3402]},{"content":"For more information about which transport to use, see <bpt id=\"p1\">[</bpt>Choosing a Transport<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md)</ept>.","pos":[3403,3553],"source":" For more information about which transport to use, see [Choosing a Transport](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md)."},{"content":"For more information about using transport security, see <bpt id=\"p1\">[</bpt>Transport Security Overview<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/transport-security-overview.md)</ept>.","pos":[3554,3720],"source":" For more information about using transport security, see [Transport Security Overview](../../../../docs/framework/wcf/feature-details/transport-security-overview.md)."},{"content":"Message security means that every message includes the necessary headers and data to keep the message secure.","pos":[3758,3867]},{"content":"Because the composition of the headers varies, you can include any number of credentials.","pos":[3868,3957]},{"content":"This becomes a factor if you are interoperating with other services that demand a specific credential type that a transport mechanism can't supply, or if the message must be used with more than one service, where each service demands a different credential type.","pos":[3958,4220]},{"pos":[4235,4355],"content":"For more information, see <bpt id=\"p1\">[</bpt>Message Security<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/message-security-in-wcf.md)</ept>.","source":"For more information, see [Message Security](../../../../docs/framework/wcf/feature-details/message-security-in-wcf.md)."},{"content":"This choice uses the transport layer to secure the message transfer, while every message includes the rich credentials other services need.","pos":[4416,4555]},{"content":"This combines the performance advantage of transport security with the rich credentials advantage of message security.","pos":[4556,4674]},{"content":"This is available with the following bindings: <ph id=\"ph1\">&lt;xref:System.ServiceModel.BasicHttpBinding&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.ServiceModel.WSFederationHttpBinding&gt;</ph>, <ph id=\"ph3\">&lt;xref:System.ServiceModel.NetPeerTcpBinding&gt;</ph>, and <ph id=\"ph4\">&lt;xref:System.ServiceModel.WSHttpBinding&gt;</ph>.","pos":[4675,4910],"source":" This is available with the following bindings: <xref:System.ServiceModel.BasicHttpBinding>, <xref:System.ServiceModel.WSFederationHttpBinding>, <xref:System.ServiceModel.NetPeerTcpBinding>, and <xref:System.ServiceModel.WSHttpBinding>."},{"content":"If you decide to use transport security for HTTP (in other words, HTTPS), you must also configure the host with an SSL certificate and enable SSL on a port.","pos":[4920,5076]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>HTTP Transport Security<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/http-transport-security.md)</ept>.","pos":[5077,5204],"source":" For more information, see [HTTP Transport Security](../../../../docs/framework/wcf/feature-details/http-transport-security.md)."},{"pos":[5214,5437],"content":"If you are using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.WSHttpBinding&gt;</ph> and do not need to establish a secure session, set the <ph id=\"ph2\">&lt;xref:System.ServiceModel.NonDualMessageSecurityOverHttp.EstablishSecurityContext%2A&gt;</ph> property to <ph id=\"ph3\">`false`</ph>.","source":"If you are using the <xref:System.ServiceModel.WSHttpBinding> and do not need to establish a secure session, set the <xref:System.ServiceModel.NonDualMessageSecurityOverHttp.EstablishSecurityContext%2A> property to `false`."},{"content":"A secure session occurs when a client and service create a channel using a symmetric key (both client and server use the same key for the length of a conversation, until the dialog is closed).","pos":[5448,5640]},{"pos":[5649,5683],"content":"Setting the Client Credential Type","linkify":"Setting the Client Credential Type","nodes":[{"content":"Setting the Client Credential Type","pos":[0,34]}]},{"content":"Select a client credential type as appropriate.","pos":[5687,5734]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Selecting a Credential Type<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/selecting-a-credential-type.md)</ept>.","pos":[5735,5870],"source":" For more information, see [Selecting a Credential Type](../../../../docs/framework/wcf/feature-details/selecting-a-credential-type.md)."},{"content":"The following client credential types are available:","pos":[5871,5923]},{"content":"Depending on how you set the mode, you must set the credential type.","pos":[6066,6134]},{"content":"For example, if you have selected the <ph id=\"ph1\">`wsHttpBinding`</ph>, and have set the mode to \"Message,\" then you can also set the <ph id=\"ph2\">`clientCredentialType`</ph> attribute of the Message element to one of the following values: <ph id=\"ph3\">`None`</ph>, <ph id=\"ph4\">`Windows`</ph>, <ph id=\"ph5\">`UserName`</ph>, <ph id=\"ph6\">`Certificate`</ph>, and <ph id=\"ph7\">`IssuedToken`</ph>, as shown in the following configuration example.","pos":[6135,6453],"source":" For example, if you have selected the `wsHttpBinding`, and have set the mode to \"Message,\" then you can also set the `clientCredentialType` attribute of the Message element to one of the following values: `None`, `Windows`, `UserName`, `Certificate`, and `IssuedToken`, as shown in the following configuration example."},{"content":"Or in code:","pos":[6709,6720]},{"pos":[6973,7006],"content":"Setting Service Credential Values","linkify":"Setting Service Credential Values","nodes":[{"content":"Setting Service Credential Values","pos":[0,33]}]},{"content":"Once you select a client credential type, you must set the actual credentials for the service and client to use.","pos":[7010,7122]},{"content":"On the service, credentials are set using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceCredentials&gt;</ph> class and returned by the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceHostBase.Credentials%2A&gt;</ph> property of the <ph id=\"ph3\">&lt;xref:System.ServiceModel.ServiceHostBase&gt;</ph> class.","pos":[7123,7376],"source":" On the service, credentials are set using the <xref:System.ServiceModel.Description.ServiceCredentials> class and returned by the <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> property of the <xref:System.ServiceModel.ServiceHostBase> class."},{"content":"The binding in use implies the service credential type, the security mode chosen, and the type of the client credential.","pos":[7377,7497]},{"content":"The following code sets a certificate for a service credential.","pos":[7498,7561]},{"pos":[7802,7834],"content":"Setting Client Credential Values","linkify":"Setting Client Credential Values","nodes":[{"content":"Setting Client Credential Values","pos":[0,32]}]},{"content":"On the client, set client credential values using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ClientCredentials&gt;</ph> class and returned by the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A&gt;</ph> property of the <ph id=\"ph3\">&lt;xref:System.ServiceModel.ClientBase%601&gt;</ph> class.","pos":[7838,8102],"source":"On the client, set client credential values using the <xref:System.ServiceModel.Description.ClientCredentials> class and returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class."},{"content":"The following code sets a certificate as a credential on a client using the TCP protocol.","pos":[8103,8192]},{"pos":[8429,8437],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[8441,8521],"content":"<bpt id=\"p1\">[</bpt>Basic WCF Programming<ept id=\"p1\">](../../../../docs/framework/wcf/basic-wcf-programming.md)</ept>","source":"[Basic WCF Programming](../../../../docs/framework/wcf/basic-wcf-programming.md)"},{"pos":[8524,8628],"content":"<bpt id=\"p1\">[</bpt>Common Security Scenarios<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/common-security-scenarios.md)</ept>","source":"[Common Security Scenarios](../../../../docs/framework/wcf/feature-details/common-security-scenarios.md)"}]}