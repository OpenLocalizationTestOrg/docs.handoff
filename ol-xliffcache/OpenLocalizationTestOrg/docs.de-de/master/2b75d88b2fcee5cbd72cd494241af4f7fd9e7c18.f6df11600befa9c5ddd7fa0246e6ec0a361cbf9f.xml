{"content":"---\ntitle: \"Messaging Activities | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 8498f215-1823-4aba-a6e1-391407f8c273\ncaps.latest.revision: 13\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Messaging Activities\nMessaging activities allow workflows to send and receive WCF messages. By adding messaging activities to a workflow you can model any arbitrarily complex message exchange patterns (MEP).  \n  \n## Message Exchange Patterns  \n There are three basic message exchange patterns:  \n  \n-   **Datagram** - When using the datagram MEP the client sends a message to the service, but the service does not respond. This is sometimes called \"fire and forget\". A fire and forget exchange is one that requires out-of-band confirmation of successful delivery. The message might be lost in transit and never reach the service. If the client successfully sends a message, it does not guarantee that the service has received the message. The datagram is a fundamental building block for messaging, as you can build your own MEPs on top of it.  \n  \n-   **Request-Response** - When using the request-response MEP the client sends a message to the service, the service does the required processing, and then sends a response back to the client. The pattern consists of request-response pairs. Examples of request-response calls are remote procedure calls (RPC) and browser GET requests. This pattern is also known as half-duplex.  \n  \n-   **Duplex** - When using the duplex MEP the client and service can send messages to each other in any order. The duplex MEP is like a phone conversation, where each word being spoken is a message.  \n  \n The messaging activities allow you to implement any of these basic MEPs as well as any arbitrarily complex MEP.  \n  \n## Messaging Activities  \n The [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] defines the following messaging activities:  \n  \n-   <xref:System.ServiceModel.Activities.Send>- Use the <xref:System.ServiceModel.Activities.Send> activity to send a message.  \n  \n-   <xref:System.ServiceModel.Activities.SendReply> - Use the <xref:System.ServiceModel.Activities.SendReply> activity to send a response to a received message. This activity is used by workflow services when implementing a request/reply MEP.  \n  \n-   <xref:System.ServiceModel.Activities.Receive>- Use the <xref:System.ServiceModel.Activities.Receive> activity to receive a message.  \n  \n-   <xref:System.ServiceModel.Activities.ReceiveReply> - Use the <xref:System.ServiceModel.Activities.ReceiveReply> activity to receive a reply message. This activity is used by workflow service clients when implementing a request/reply MEP.  \n  \n## Messaging Activities and Message Exchange Patterns  \n A datagram MEP involves a client sending a message and a service receiving the message. If the client is a workflow use a <xref:System.ServiceModel.Activities.Send> activity to send the message. To receive that message in a workflow, use a <xref:System.ServiceModel.Activities.Receive> activity. The <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> activities each have a property named `Content`. This property contains the data being sent or received. When implementing the request-response MEP both the client and the service use pairs of activities. The client uses a <xref:System.ServiceModel.Activities.Send> activity to send the message and a <xref:System.ServiceModel.Activities.ReceiveReply> activity to receive the response from the service. These two activities are associated with each other by the <xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> property. This property is set to the <xref:System.ServiceModel.Activities.Send> activity that sent the original message. The service also uses a pair of associated activities: <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.SendReply>. These two activities are associated by the <xref:System.ServiceModel.Activities.SendReply.Request%2A> property. This property is set to the <xref:System.ServiceModel.Activities.Receive> activity that received the original message. The <xref:System.ServiceModel.Activities.ReceiveReply> and <xref:System.ServiceModel.Activities.SendReply> activities, like <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> allow you to send a <xref:System.ServiceModel.Channels.Message> instance or a message contract type.  \n  \n Because of the long-running nature of workflows, it is important for the duplex pattern of communication to also support long-running conversations. To support long-running conversations, clients who initiate the conversation must provide the service with an opportunity to call it back at a later time when the data becomes available. For example, a purchase order request is submitted for manager approval, but it might not be processed for a day, a week, or even a year; the workflow that manages the purchase order approval must know to resume after the approval is given. This pattern of duplex communication is supported in workflows using correlation. To implement a duplex pattern, use <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> activities. On the <xref:System.ServiceModel.Activities.Receive> activity, initialize a correlation using the special key value of <!--zz <xref:System.ServiceModel.Activities.CorrelationHandle.CallbackHandleName%2A>-->`System.ServiceModel.Activities.CorrelationHandle.CallbackHandleName`. On the <xref:System.ServiceModel.Activities.Send> activity set that correlation handle as the <xref:System.ServiceModel.Activities.Send.CorrelatesWith%2A> property value. [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][Durable Duplex](../../../../docs/framework/wcf/feature-details/durable-duplex-correlation.md).  \n  \n> [!NOTE]\n>  Workflow’s implementation of duplex using a callback correlation (\"Durable Duplex\") is intended for long-running conversations. This is not the same as WCF duplex with callback contracts where the conversation is short-running (the lifetime of the channel).  \n  \n## Message Formatting and Messaging Activities  \n The <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.ReceiveReply> activities have a property named `Content`. This property is of type <xref:System.ServiceModel.Activities.ReceiveContent> and represents data the <xref:System.ServiceModel.Activities.Receive> or <xref:System.ServiceModel.Activities.ReceiveReply> activity receives. The .NET Framework defines two related classes called <xref:System.ServiceModel.Activities.ReceiveMessageContent> and <xref:System.ServiceModel.Activities.ReceiveParametersContent> both of which are derived from <xref:System.ServiceModel.Activities.ReceiveContent>. Set the <xref:System.ServiceModel.Activities.Receive> or <xref:System.ServiceModel.Activities.ReceiveReply> activity’s `Content` property to an instance of one of these types to receive data into a workflow service. The type to use depends upon the type of data the activity receives. If the activity receives a `Message` object or a message contract type, use <xref:System.ServiceModel.Activities.ReceiveMessageContent>. If the activity receives a set of data contract or XML types that can be serialized, use <xref:System.ServiceModel.Activities.ReceiveParametersContent>. <xref:System.ServiceModel.Activities.ReceiveParametersContent> allows you to send multiple parameters, whereas <xref:System.ServiceModel.Activities.ReceiveMessageContent> only allows you to send one object, the message (or message contract type).  \n  \n> [!NOTE]\n>  <xref:System.ServiceModel.Activities.ReceiveMessageContent> can also be used with a single data contract or XML type that can be serialized. The difference between using <xref:System.ServiceModel.Activities.ReceiveParametersContent> with a single parameter and the object passed directly to <xref:System.ServiceModel.Activities.ReceiveMessageContent> is the wire-format. The parameter’s content is wrapped in an XML element that corresponds to the operation name and the serialized object is wrapped in an XML element using the parameter name (for example, `<Echo><msg>Hello, World</msg></Echo>`). The message content is not wrapped by the operation name. Instead, the serialized object is placed within an XML element using the XML-qualified type name (for example, `<string>Hello, World</string>`).  \n  \n The <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.SendReply> activities also have a property named `Content`. This property is of type <xref:System.ServiceModel.Activities.SendContent> and represents data the <xref:System.ServiceModel.Activities.Send> or <xref:System.ServiceModel.Activities.SendReply> activity sends. The .NET Framework defines two related types called <xref:System.ServiceModel.Activities.SendMessageContent> and <xref:System.ServiceModel.Activities.SendParametersContent> both of which are derived from <xref:System.ServiceModel.Activities.SendContent>. Set the <xref:System.ServiceModel.Activities.Send> or <xref:System.ServiceModel.Activities.SendReply> activity’s `Content` property to an instance of one of these types to send data from a workflow service. The type to use depends upon the type of data the activity sends. If the activity sends a `Message` object or a message contract type, use <xref:System.ServiceModel.Activities.SendMessageContent>. If the activity sends a data contract type use <xref:System.ServiceModel.Activities.SendParametersContent>. <xref:System.ServiceModel.Activities.SendParametersContent> allows you to send multiple parameters, whereas <xref:System.ServiceModel.Activities.SendMessageContent> only allows you to send one object, the message (or the message contract type).  \n  \n When programming imperatively with the messaging activities, you use the generic <xref:System.Activities.InArgument%601> and <xref:System.Activities.OutArgument%601> to wrap the objects you assign to the message or parameters properties of the <xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.Receive>, and <xref:System.ServiceModel.Activities.ReceiveReply> activities. Use <xref:System.Activities.InArgument%601> for the <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.SendReply>activities and <xref:System.Activities.OutArgument%601> for <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.ReceiveReply>activities. `In` arguments are used with the send activities because the data is being passed into the activities. `Out` arguments are used with the receive activities because data is being passed out of the activities, as shown in the following example.  \n  \n```  \nReceive reserveSeat = new Receive  \n{   \n    ...   \n    Content = new ReceiveParametersContent  \n    {  \n        Parameters =  \n        {  \n            { \"ReservationInfo\", new OutArgument<ReservationRequest>(reservationInfo) }  \n        }  \n    }  \n};  \nSendReply reserveSeat = new SendReply  \n{   \n    ...   \n    Request = reserveSeat,  \n    Content = new SendParametersContent  \n    {  \n        Parameters =  \n        {  \n            { \"ReservationId\", new InArgument<string>(reservationId) }  \n        }  \n    },  \n};  \n```  \n  \n When implementing a workflow service that defines a request/response operation that returns void, you must instantiate a <xref:System.ServiceModel.Activities.SendReply> activity and set the <xref:System.ServiceModel.Activities.SendReply.Content%2A> property to an empty instance of one of the content types (<xref:System.ServiceModel.Activities.SendMessageContent> or <xref:System.ServiceModel.Activities.SendParametersContent>) as shown in the following example.  \n  \n```  \nReceive rcv = new Receive()  \n{  \nServiceContractName = \"IService\",  \nOperationName = \"NullReturningContract\",  \nContent = new ReceiveParametersContent( new Dictionary<string, OutArgument>() { { \"message\", new OutArgument<string>() } } )  \n};  \nSendReply sr = new SendReply()  \n{  \nRequest = rcv  \n   Content = new SendParametersContent();  \n};  \n  \n```  \n  \n## Add Service Reference  \n When calling a workflow service from a workflow application, [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] generates custom messaging activities that encapsulate the usual <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.ReceiveReply> activities used in a request/reply MEP. To use this feature right-click the client project in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] and select **Add Service Reference**. Type the base address of the service in the address box and click Go. The available services are displayed in the **Services:** box. Expand the service node to display the contracts supported. Select the contract you want to call and the list of available operations is displayed in the **Operations** box. You can then specify the namespace for the generated activity and click **OK**. You then see a dialog that says the operation completed successfully and that the generated custom activities are in the toolbox after you have rebuilt the project. There is one activity for each operation defined on the service contract. After rebuilding the project you can drag and drop the custom activities onto your workflow and set any required properties in the properties window.  \n  \n<!--## Messaging Activity Templates  \n To make setting up a request/response MEP on the client and service easier, [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] provides two messaging activity templates. <xref:System.ServiceModel.Activities.Design.ReceiveAndSendReply> is used on the service and <xref:System.ServiceModel.Activities.Design.SendAndReceiveReply> is used on the client. In both cases the templates add the appropriate messaging activities to your workflow. On the service, the <xref:System.ServiceModel.Activities.Design.ReceiveAndSendReply> adds a <xref:System.ServiceModel.Activities.Receive> activity followed by a <xref:System.ServiceModel.Activities.SendReply> activity. The <xref:System.ServiceModel.Activities.SendReply.Request> property is automatically set to the <xref:System.ServiceModel.Activities.Receive> activity. On the client, the <xref:System.ServiceModel.Activities.Design.SendAndReceiveReply> adds a <xref:System.ServiceModel.Activities.Send> activity followed by a <xref:System.ServiceModel.Activities.ReceiveReply>. The <xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> property is automatically set to the <xref:System.ServiceModel.Activities.Send> activity. To use these templates, just drag and drop the appropriate template onto your workflow.  \n-->\n## Messaging Activities and Transactions  \n When a call is made to a workflow service you may want to flow a transaction to the service operation. To do this place the <xref:System.ServiceModel.Activities.Receive> activity within a <xref:System.ServiceModel.Activities.TransactedReceiveScope> activity. The <xref:System.ServiceModel.Activities.TransactedReceiveScope> activity contains a `Receive` activity and a body. The transaction flowed to the service remains ambient throughout the execution of the body of the <xref:System.ServiceModel.Activities.TransactedReceiveScope>. The transaction is completed when the body finishes executing. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] workflows and transactions see [Workflow Transactions](../../../../docs/framework/windows-workflow-foundation/workflow-transactions.md).  \n  \n## See Also  \n [How to Send and Receive Faults in Workflow Services](http://go.microsoft.com/fwlink/?LinkId=189151)   \n [Creating a Long-running Workflow Service](../../../../docs/framework/wcf/feature-details/creating-a-long-running-workflow-service.md)","nodes":[{"pos":[4,341],"embed":true,"restype":"x-metadata","content":"title: \"Messaging Activities | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 8498f215-1823-4aba-a6e1-391407f8c273\ncaps.latest.revision: 13\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"","nodes":[{"content":"Messaging Activities | Microsoft Docs","nodes":[{"pos":[0,37],"content":"Messaging Activities | Microsoft Docs","nodes":[{"content":"Messaging Activities | Microsoft Docs","pos":[0,37]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[348,368],"content":"Messaging Activities","linkify":"Messaging Activities","nodes":[{"content":"Messaging Activities","pos":[0,20]}]},{"content":"Messaging activities allow workflows to send and receive WCF messages.","pos":[369,439]},{"content":"By adding messaging activities to a workflow you can model any arbitrarily complex message exchange patterns (MEP).","pos":[440,555]},{"pos":[564,589],"content":"Message Exchange Patterns","linkify":"Message Exchange Patterns","nodes":[{"content":"Message Exchange Patterns","pos":[0,25]}]},{"content":"There are three basic message exchange patterns:","pos":[593,641]},{"content":"<bpt id=\"p1\">**</bpt>Datagram<ept id=\"p1\">**</ept> - When using the datagram MEP the client sends a message to the service, but the service does not respond.","pos":[651,770],"source":"**Datagram** - When using the datagram MEP the client sends a message to the service, but the service does not respond."},{"content":"This is sometimes called \"fire and forget\".","pos":[771,814]},{"content":"A fire and forget exchange is one that requires out-of-band confirmation of successful delivery.","pos":[815,911]},{"content":"The message might be lost in transit and never reach the service.","pos":[912,977]},{"content":"If the client successfully sends a message, it does not guarantee that the service has received the message.","pos":[978,1086]},{"content":"The datagram is a fundamental building block for messaging, as you can build your own MEPs on top of it.","pos":[1087,1191]},{"content":"<bpt id=\"p1\">**</bpt>Request-Response<ept id=\"p1\">**</ept> - When using the request-response MEP the client sends a message to the service, the service does the required processing, and then sends a response back to the client.","pos":[1201,1390],"source":"**Request-Response** - When using the request-response MEP the client sends a message to the service, the service does the required processing, and then sends a response back to the client."},{"content":"The pattern consists of request-response pairs.","pos":[1391,1438]},{"content":"Examples of request-response calls are remote procedure calls (RPC) and browser GET requests.","pos":[1439,1532]},{"content":"This pattern is also known as half-duplex.","pos":[1533,1575]},{"content":"<bpt id=\"p1\">**</bpt>Duplex<ept id=\"p1\">**</ept> - When using the duplex MEP the client and service can send messages to each other in any order.","pos":[1585,1692],"source":"**Duplex** - When using the duplex MEP the client and service can send messages to each other in any order."},{"content":"The duplex MEP is like a phone conversation, where each word being spoken is a message.","pos":[1693,1780]},{"content":"The messaging activities allow you to implement any of these basic MEPs as well as any arbitrarily complex MEP.","pos":[1787,1898]},{"pos":[1907,1927],"content":"Messaging Activities","linkify":"Messaging Activities","nodes":[{"content":"Messaging Activities","pos":[0,20]}]},{"pos":[1931,2056],"content":"The <ph id=\"ph1\">[!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)]</ph> defines the following messaging activities:","source":"The [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] defines the following messaging activities:"},{"pos":[2066,2188],"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph>- Use the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> activity to send a message.","source":"<xref:System.ServiceModel.Activities.Send>- Use the <xref:System.ServiceModel.Activities.Send> activity to send a message."},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph> - Use the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph> activity to send a response to a received message.","pos":[2198,2354],"source":"<xref:System.ServiceModel.Activities.SendReply> - Use the <xref:System.ServiceModel.Activities.SendReply> activity to send a response to a received message."},{"content":"This activity is used by workflow services when implementing a request/reply MEP.","pos":[2355,2436]},{"pos":[2446,2577],"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph>- Use the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activity to receive a message.","source":"<xref:System.ServiceModel.Activities.Receive>- Use the <xref:System.ServiceModel.Activities.Receive> activity to receive a message."},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.ReceiveReply&gt;</ph> - Use the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.ReceiveReply&gt;</ph> activity to receive a reply message.","pos":[2587,2735],"source":"<xref:System.ServiceModel.Activities.ReceiveReply> - Use the <xref:System.ServiceModel.Activities.ReceiveReply> activity to receive a reply message."},{"content":"This activity is used by workflow service clients when implementing a request/reply MEP.","pos":[2736,2824]},{"pos":[2833,2883],"content":"Messaging Activities and Message Exchange Patterns","linkify":"Messaging Activities and Message Exchange Patterns","nodes":[{"content":"Messaging Activities and Message Exchange Patterns","pos":[0,50]}]},{"content":"A datagram MEP involves a client sending a message and a service receiving the message.","pos":[2887,2974]},{"content":"If the client is a workflow use a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> activity to send the message.","pos":[2975,3081],"source":" If the client is a workflow use a <xref:System.ServiceModel.Activities.Send> activity to send the message."},{"content":"To receive that message in a workflow, use a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activity.","pos":[3082,3182],"source":" To receive that message in a workflow, use a <xref:System.ServiceModel.Activities.Receive> activity."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activities each have a property named <ph id=\"ph3\">`Content`</ph>.","pos":[3183,3328],"source":" The <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> activities each have a property named `Content`."},{"content":"This property contains the data being sent or received.","pos":[3329,3384]},{"content":"When implementing the request-response MEP both the client and the service use pairs of activities.","pos":[3385,3484]},{"content":"The client uses a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> activity to send the message and a <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.ReceiveReply&gt;</ph> activity to receive the response from the service.","pos":[3485,3682],"source":" The client uses a <xref:System.ServiceModel.Activities.Send> activity to send the message and a <xref:System.ServiceModel.Activities.ReceiveReply> activity to receive the response from the service."},{"content":"These two activities are associated with each other by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.ReceiveReply.Request%2A&gt;</ph> property.","pos":[3683,3813],"source":" These two activities are associated with each other by the <xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> property."},{"content":"This property is set to the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> activity that sent the original message.","pos":[3814,3925],"source":" This property is set to the <xref:System.ServiceModel.Activities.Send> activity that sent the original message."},{"content":"The service also uses a pair of associated activities: <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph>.","pos":[3926,4079],"source":" The service also uses a pair of associated activities: <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.SendReply>."},{"content":"These two activities are associated by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.SendReply.Request%2A&gt;</ph> property.","pos":[4080,4191],"source":" These two activities are associated by the <xref:System.ServiceModel.Activities.SendReply.Request%2A> property."},{"content":"This property is set to the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activity that received the original message.","pos":[4192,4310],"source":" This property is set to the <xref:System.ServiceModel.Activities.Receive> activity that received the original message."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.ReceiveReply&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph> activities, like <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> and <ph id=\"ph4\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> allow you to send a <ph id=\"ph5\">&lt;xref:System.ServiceModel.Channels.Message&gt;</ph> instance or a message contract type.","pos":[4311,4628],"source":" The <xref:System.ServiceModel.Activities.ReceiveReply> and <xref:System.ServiceModel.Activities.SendReply> activities, like <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> allow you to send a <xref:System.ServiceModel.Channels.Message> instance or a message contract type."},{"content":"Because of the long-running nature of workflows, it is important for the duplex pattern of communication to also support long-running conversations.","pos":[4635,4783]},{"content":"To support long-running conversations, clients who initiate the conversation must provide the service with an opportunity to call it back at a later time when the data becomes available.","pos":[4784,4970]},{"content":"For example, a purchase order request is submitted for manager approval, but it might not be processed for a day, a week, or even a year; the workflow that manages the purchase order approval must know to resume after the approval is given.","pos":[4971,5211]},{"content":"This pattern of duplex communication is supported in workflows using correlation.","pos":[5212,5293]},{"content":"To implement a duplex pattern, use <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activities.","pos":[5294,5433],"source":" To implement a duplex pattern, use <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> activities."},{"content":"On the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activity, initialize a correlation using the special key value of <ph id=\"ph2\">&lt;!--zz &lt;xref:System.ServiceModel.Activities.CorrelationHandle.CallbackHandleName%2A&gt;--&gt;</ph><ph id=\"ph3\">`System.ServiceModel.Activities.CorrelationHandle.CallbackHandleName`</ph>.","pos":[5434,5710],"source":" On the <xref:System.ServiceModel.Activities.Receive> activity, initialize a correlation using the special key value of <!--zz <xref:System.ServiceModel.Activities.CorrelationHandle.CallbackHandleName%2A>-->`System.ServiceModel.Activities.CorrelationHandle.CallbackHandleName`."},{"content":"On the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> activity set that correlation handle as the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Send.CorrelatesWith%2A&gt;</ph> property value.","pos":[5711,5881],"source":" On the <xref:System.ServiceModel.Activities.Send> activity set that correlation handle as the <xref:System.ServiceModel.Activities.Send.CorrelatesWith%2A> property value."},{"content":"<ph id=\"ph1\">[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]</ph><bpt id=\"p1\">[</bpt>Durable Duplex<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/durable-duplex-correlation.md)</ept>.","pos":[5882,6036],"source":"[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][Durable Duplex](../../../../docs/framework/wcf/feature-details/durable-duplex-correlation.md)."},{"pos":[6044,6312],"content":"[!NOTE]\n Workflow’s implementation of duplex using a callback correlation (\"Durable Duplex\") is intended for long-running conversations. This is not the same as WCF duplex with callback contracts where the conversation is short-running (the lifetime of the channel).","leadings":["","> "],"nodes":[{"content":"Workflow’s implementation of duplex using a callback correlation (\"Durable Duplex\") is intended for long-running conversations. This is not the same as WCF duplex with callback contracts where the conversation is short-running (the lifetime of the channel).","pos":[9,266],"nodes":[{"content":"Workflow’s implementation of duplex using a callback correlation (\"Durable Duplex\") is intended for long-running conversations.","pos":[0,127]},{"content":"This is not the same as WCF duplex with callback contracts where the conversation is short-running (the lifetime of the channel).","pos":[128,257]}]}]},{"pos":[6321,6364],"content":"Message Formatting and Messaging Activities","linkify":"Message Formatting and Messaging Activities","nodes":[{"content":"Message Formatting and Messaging Activities","pos":[0,43]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.ReceiveReply&gt;</ph> activities have a property named <ph id=\"ph3\">`Content`</ph>.","pos":[6368,6516],"source":"The <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.ReceiveReply> activities have a property named `Content`."},{"content":"This property is of type <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.ReceiveContent&gt;</ph> and represents data the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.ReceiveReply&gt;</ph> activity receives.","pos":[6517,6737],"source":" This property is of type <xref:System.ServiceModel.Activities.ReceiveContent> and represents data the <xref:System.ServiceModel.Activities.Receive> or <xref:System.ServiceModel.Activities.ReceiveReply> activity receives."},{"content":"The .NET Framework defines two related classes called <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.ReceiveMessageContent&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.ReceiveParametersContent&gt;</ph> both of which are derived from <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.ReceiveContent&gt;</ph>.","pos":[6738,7003],"source":" The .NET Framework defines two related classes called <xref:System.ServiceModel.Activities.ReceiveMessageContent> and <xref:System.ServiceModel.Activities.ReceiveParametersContent> both of which are derived from <xref:System.ServiceModel.Activities.ReceiveContent>."},{"content":"Set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> or <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.ReceiveReply&gt;</ph> activity’s <ph id=\"ph3\">`Content`</ph> property to an instance of one of these types to receive data into a workflow service.","pos":[7004,7219],"source":" Set the <xref:System.ServiceModel.Activities.Receive> or <xref:System.ServiceModel.Activities.ReceiveReply> activity’s `Content` property to an instance of one of these types to receive data into a workflow service."},{"content":"The type to use depends upon the type of data the activity receives.","pos":[7220,7288]},{"content":"If the activity receives a <ph id=\"ph1\">`Message`</ph> object or a message contract type, use <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.ReceiveMessageContent&gt;</ph>.","pos":[7289,7425],"source":" If the activity receives a `Message` object or a message contract type, use <xref:System.ServiceModel.Activities.ReceiveMessageContent>."},{"content":"If the activity receives a set of data contract or XML types that can be serialized, use <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.ReceiveParametersContent&gt;</ph>.","pos":[7426,7578],"source":" If the activity receives a set of data contract or XML types that can be serialized, use <xref:System.ServiceModel.Activities.ReceiveParametersContent>."},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.ReceiveParametersContent&gt;</ph> allows you to send multiple parameters, whereas <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.ReceiveMessageContent&gt;</ph> only allows you to send one object, the message (or message contract type).","pos":[7579,7825],"source":"<xref:System.ServiceModel.Activities.ReceiveParametersContent> allows you to send multiple parameters, whereas <xref:System.ServiceModel.Activities.ReceiveMessageContent> only allows you to send one object, the message (or message contract type)."},{"pos":[7833,8644],"content":"[!NOTE]\n <xref:System.ServiceModel.Activities.ReceiveMessageContent> can also be used with a single data contract or XML type that can be serialized. The difference between using <xref:System.ServiceModel.Activities.ReceiveParametersContent> with a single parameter and the object passed directly to <xref:System.ServiceModel.Activities.ReceiveMessageContent> is the wire-format. The parameter’s content is wrapped in an XML element that corresponds to the operation name and the serialized object is wrapped in an XML element using the parameter name (for example, `<Echo><msg>Hello, World</msg></Echo>`). The message content is not wrapped by the operation name. Instead, the serialized object is placed within an XML element using the XML-qualified type name (for example, `<string>Hello, World</string>`).","leadings":["","> "],"nodes":[{"content":"<xref:System.ServiceModel.Activities.ReceiveMessageContent> can also be used with a single data contract or XML type that can be serialized. The difference between using <xref:System.ServiceModel.Activities.ReceiveParametersContent> with a single parameter and the object passed directly to <xref:System.ServiceModel.Activities.ReceiveMessageContent> is the wire-format. The parameter’s content is wrapped in an XML element that corresponds to the operation name and the serialized object is wrapped in an XML element using the parameter name (for example, `<Echo><msg>Hello, World</msg></Echo>`). The message content is not wrapped by the operation name. Instead, the serialized object is placed within an XML element using the XML-qualified type name (for example, `<string>Hello, World</string>`).","pos":[9,809],"nodes":[{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.ReceiveMessageContent&gt;</ph> can also be used with a single data contract or XML type that can be serialized.","pos":[0,140],"source":"<xref:System.ServiceModel.Activities.ReceiveMessageContent> can also be used with a single data contract or XML type that can be serialized."},{"content":"The difference between using <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.ReceiveParametersContent&gt;</ph> with a single parameter and the object passed directly to <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.ReceiveMessageContent&gt;</ph> is the wire-format.","pos":[141,370],"source":" The difference between using <xref:System.ServiceModel.Activities.ReceiveParametersContent> with a single parameter and the object passed directly to <xref:System.ServiceModel.Activities.ReceiveMessageContent> is the wire-format."},{"content":"The parameter’s content is wrapped in an XML element that corresponds to the operation name and the serialized object is wrapped in an XML element using the parameter name (for example, <ph id=\"ph1\">`&lt;Echo&gt;&lt;msg&gt;Hello, World&lt;/msg&gt;&lt;/Echo&gt;`</ph>).","pos":[371,597],"source":" The parameter’s content is wrapped in an XML element that corresponds to the operation name and the serialized object is wrapped in an XML element using the parameter name (for example, `<Echo><msg>Hello, World</msg></Echo>`)."},{"content":"The message content is not wrapped by the operation name.","pos":[598,655]},{"content":"Instead, the serialized object is placed within an XML element using the XML-qualified type name (for example, <ph id=\"ph1\">`&lt;string&gt;Hello, World&lt;/string&gt;`</ph>).","pos":[656,800],"source":" Instead, the serialized object is placed within an XML element using the XML-qualified type name (for example, `<string>Hello, World</string>`)."}]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph> activities also have a property named <ph id=\"ph3\">`Content`</ph>.","pos":[8651,8798],"source":"The <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.SendReply> activities also have a property named `Content`."},{"content":"This property is of type <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.SendContent&gt;</ph> and represents data the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph> activity sends.","pos":[8799,9007],"source":" This property is of type <xref:System.ServiceModel.Activities.SendContent> and represents data the <xref:System.ServiceModel.Activities.Send> or <xref:System.ServiceModel.Activities.SendReply> activity sends."},{"content":"The .NET Framework defines two related types called <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.SendMessageContent&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.SendParametersContent&gt;</ph> both of which are derived from <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.SendContent&gt;</ph>.","pos":[9008,9262],"source":" The .NET Framework defines two related types called <xref:System.ServiceModel.Activities.SendMessageContent> and <xref:System.ServiceModel.Activities.SendParametersContent> both of which are derived from <xref:System.ServiceModel.Activities.SendContent>."},{"content":"Set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> or <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph> activity’s <ph id=\"ph3\">`Content`</ph> property to an instance of one of these types to send data from a workflow service.","pos":[9263,9469],"source":" Set the <xref:System.ServiceModel.Activities.Send> or <xref:System.ServiceModel.Activities.SendReply> activity’s `Content` property to an instance of one of these types to send data from a workflow service."},{"content":"The type to use depends upon the type of data the activity sends.","pos":[9470,9535]},{"content":"If the activity sends a <ph id=\"ph1\">`Message`</ph> object or a message contract type, use <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.SendMessageContent&gt;</ph>.","pos":[9536,9666],"source":" If the activity sends a `Message` object or a message contract type, use <xref:System.ServiceModel.Activities.SendMessageContent>."},{"content":"If the activity sends a data contract type use <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.SendParametersContent&gt;</ph>.","pos":[9667,9774],"source":" If the activity sends a data contract type use <xref:System.ServiceModel.Activities.SendParametersContent>."},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.SendParametersContent&gt;</ph> allows you to send multiple parameters, whereas <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.SendMessageContent&gt;</ph> only allows you to send one object, the message (or the message contract type).","pos":[9775,10019],"source":"<xref:System.ServiceModel.Activities.SendParametersContent> allows you to send multiple parameters, whereas <xref:System.ServiceModel.Activities.SendMessageContent> only allows you to send one object, the message (or the message contract type)."},{"content":"When programming imperatively with the messaging activities, you use the generic <ph id=\"ph1\">&lt;xref:System.Activities.InArgument%601&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Activities.OutArgument%601&gt;</ph> to wrap the objects you assign to the message or parameters properties of the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph>, <ph id=\"ph4\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph>, <ph id=\"ph5\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph>, and <ph id=\"ph6\">&lt;xref:System.ServiceModel.Activities.ReceiveReply&gt;</ph> activities.","pos":[10026,10476],"source":"When programming imperatively with the messaging activities, you use the generic <xref:System.Activities.InArgument%601> and <xref:System.Activities.OutArgument%601> to wrap the objects you assign to the message or parameters properties of the <xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.Receive>, and <xref:System.ServiceModel.Activities.ReceiveReply> activities."},{"content":"Use <ph id=\"ph1\">&lt;xref:System.Activities.InArgument%601&gt;</ph> for the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph>activities and <ph id=\"ph4\">&lt;xref:System.Activities.OutArgument%601&gt;</ph> for <ph id=\"ph5\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> and <ph id=\"ph6\">&lt;xref:System.ServiceModel.Activities.ReceiveReply&gt;</ph>activities.","pos":[10477,10794],"source":" Use <xref:System.Activities.InArgument%601> for the <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.SendReply>activities and <xref:System.Activities.OutArgument%601> for <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.ReceiveReply>activities."},{"content":"<ph id=\"ph1\">`In`</ph> arguments are used with the send activities because the data is being passed into the activities.","pos":[10795,10897],"source":"`In` arguments are used with the send activities because the data is being passed into the activities."},{"content":"<ph id=\"ph1\">`Out`</ph> arguments are used with the receive activities because data is being passed out of the activities, as shown in the following example.","pos":[10898,11037],"source":"`Out` arguments are used with the receive activities because data is being passed out of the activities, as shown in the following example."},{"pos":[11583,12046],"content":"When implementing a workflow service that defines a request/response operation that returns void, you must instantiate a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph> activity and set the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.SendReply.Content%2A&gt;</ph> property to an empty instance of one of the content types (<ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.SendMessageContent&gt;</ph> or <ph id=\"ph4\">&lt;xref:System.ServiceModel.Activities.SendParametersContent&gt;</ph>) as shown in the following example.","source":"When implementing a workflow service that defines a request/response operation that returns void, you must instantiate a <xref:System.ServiceModel.Activities.SendReply> activity and set the <xref:System.ServiceModel.Activities.SendReply.Content%2A> property to an empty instance of one of the content types (<xref:System.ServiceModel.Activities.SendMessageContent> or <xref:System.ServiceModel.Activities.SendParametersContent>) as shown in the following example."},{"pos":[12420,12441],"content":"Add Service Reference","linkify":"Add Service Reference","nodes":[{"content":"Add Service Reference","pos":[0,21]}]},{"content":"When calling a workflow service from a workflow application, <ph id=\"ph1\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph> generates custom messaging activities that encapsulate the usual <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.ReceiveReply&gt;</ph> activities used in a request/reply MEP.","pos":[12445,12780],"source":"When calling a workflow service from a workflow application, [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] generates custom messaging activities that encapsulate the usual <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.ReceiveReply> activities used in a request/reply MEP."},{"content":"To use this feature right-click the client project in <ph id=\"ph1\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph> and select <bpt id=\"p1\">**</bpt>Add Service Reference<ept id=\"p1\">**</ept>.","pos":[12781,12944],"source":" To use this feature right-click the client project in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] and select **Add Service Reference**."},{"content":"Type the base address of the service in the address box and click Go.","pos":[12945,13014]},{"content":"The available services are displayed in the <bpt id=\"p1\">**</bpt>Services:<ept id=\"p1\">**</ept> box.","pos":[13015,13077],"source":" The available services are displayed in the **Services:** box."},{"content":"Expand the service node to display the contracts supported.","pos":[13078,13137]},{"content":"Select the contract you want to call and the list of available operations is displayed in the <bpt id=\"p1\">**</bpt>Operations<ept id=\"p1\">**</ept> box.","pos":[13138,13251],"source":" Select the contract you want to call and the list of available operations is displayed in the **Operations** box."},{"content":"You can then specify the namespace for the generated activity and click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[13252,13331],"source":" You can then specify the namespace for the generated activity and click **OK**."},{"content":"You then see a dialog that says the operation completed successfully and that the generated custom activities are in the toolbox after you have rebuilt the project.","pos":[13332,13496]},{"content":"There is one activity for each operation defined on the service contract.","pos":[13497,13570]},{"content":"After rebuilding the project you can drag and drop the custom activities onto your workflow and set any required properties in the properties window.","pos":[13571,13720]},{"pos":[15057,15094],"content":"Messaging Activities and Transactions","linkify":"Messaging Activities and Transactions","nodes":[{"content":"Messaging Activities and Transactions","pos":[0,37]}]},{"content":"When a call is made to a workflow service you may want to flow a transaction to the service operation.","pos":[15098,15200]},{"content":"To do this place the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activity within a <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.TransactedReceiveScope&gt;</ph> activity.","pos":[15201,15356],"source":" To do this place the <xref:System.ServiceModel.Activities.Receive> activity within a <xref:System.ServiceModel.Activities.TransactedReceiveScope> activity."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.TransactedReceiveScope&gt;</ph> activity contains a <ph id=\"ph2\">`Receive`</ph> activity and a body.","pos":[15357,15472],"source":" The <xref:System.ServiceModel.Activities.TransactedReceiveScope> activity contains a `Receive` activity and a body."},{"content":"The transaction flowed to the service remains ambient throughout the execution of the body of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.TransactedReceiveScope&gt;</ph>.","pos":[15473,15632],"source":" The transaction flowed to the service remains ambient throughout the execution of the body of the <xref:System.ServiceModel.Activities.TransactedReceiveScope>."},{"content":"The transaction is completed when the body finishes executing.","pos":[15633,15695]},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> workflows and transactions see <bpt id=\"p1\">[</bpt>Workflow Transactions<ept id=\"p1\">](../../../../docs/framework/windows-workflow-foundation/workflow-transactions.md)</ept>.","pos":[15696,15888],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] workflows and transactions see [Workflow Transactions](../../../../docs/framework/windows-workflow-foundation/workflow-transactions.md)."},{"pos":[15897,15905],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>How to Send and Receive Faults in Workflow Services<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=189151)</ept><ph id=\"ph1\"> </ph>","pos":[15909,16010],"source":"[How to Send and Receive Faults in Workflow Services](http://go.microsoft.com/fwlink/?LinkId=189151) "},{"content":"<bpt id=\"p1\">[</bpt>Creating a Long-running Workflow Service<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/creating-a-long-running-workflow-service.md)</ept>","pos":[16014,16148],"source":"[Creating a Long-running Workflow Service](../../../../docs/framework/wcf/feature-details/creating-a-long-running-workflow-service.md)"}]}