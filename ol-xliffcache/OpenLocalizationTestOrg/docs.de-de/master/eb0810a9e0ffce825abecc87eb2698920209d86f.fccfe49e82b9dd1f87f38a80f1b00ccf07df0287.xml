{"content":"---\ntitle: \"nonComVisibleBaseClass MDA\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"visible classes\"\n  - \"managed debugging assistants (MDAs), COM visible classes\"\n  - \"nonComVisibleBaseClass MDA\"\n  - \"COM visible classes\"\n  - \"QueryInterface call failures\"\n  - \"MDAs (managed debugging assistants), COM visible classes\"\nms.assetid: 9ec1af27-604b-477e-9ee2-e833eb10d3ce\nauthor: \"mairaw\"\nms.author: \"mairaw\"\n---\n# nonComVisibleBaseClass MDA\nThe `nonComVisibleBaseClass` managed debugging assistant (MDA) is activated when a `QueryInterface` call is made by native or unmanaged code on the COM callable wrapper (CCW) of a COM-visible managed class that derives from a base class that is not COM visible.  The `QueryInterface` call causes the MDA to activate only in cases where call requests the class interface or default `IDispatch` of the COM-visible managed class.  The MDA is not activated when the `QueryInterface` is for an explicit interface that has the <xref:System.Runtime.InteropServices.ClassInterfaceAttribute> attribute applied and is explicitly implemented by the COM-visible class.  \n  \n## Symptoms  \n A `QueryInterface` call made from native code that is failing with a COR_E_INVALIDOPERATION HRESULT.  The HRESULT might be due to the runtime disallowing `QueryInterface` calls that would cause the activation of this MDA.  \n  \n## Cause  \n The runtime cannot allow `QueryInterface` calls for the class interface or default `IDispatch` interface of a COM-visible class that derives from a class that is not COM-visible because of potential versioning problems.  For example, if any public members were added to the base class that is not COM-visible, existing COM clients using the derived class could potentially break because the vtable of the derived class, which contains the base class members, would be altered by such a change.  Explicit interfaces exposed to COM do not have this problem because they do not include the base members of interfaces in the vtable.  \n  \n## Resolution  \n Do not expose the class interface. Define an explicit interface and apply the <xref:System.Runtime.InteropServices.ClassInterfaceAttribute> attribute to it.  \n  \n## Effect on the Runtime  \n This MDA has no effect on the CLR.  \n  \n## Output  \n The following is an example message for a `QueryInterface` call on a COM-visible class `Derived` that derives from a non-COM-visible class `Base`.  \n  \n```  \nA QueryInterface call was made requesting the class interface of COM   \nvisible managed class 'Derived'. However since this class derives from   \nnon COM visible class 'Base', the QueryInterface call will fail. This   \nis done to prevent the non COM visible base class from being   \nconstrained by the COM versioning rules.   \n```  \n  \n## Configuration  \n  \n```xml  \n<mdaConfig>  \n  <assistants>  \n    <nonComVisibleBaseClass />  \n  </assistants>  \n</mdaConfig>  \n```  \n  \n## See also\n\n- <xref:System.Runtime.InteropServices.MarshalAsAttribute>\n- [Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)\n- [Interop Marshaling](../../../docs/framework/interop/interop-marshaling.md)\n","nodes":[{"pos":[4,411],"embed":true,"restype":"x-metadata","content":"title: \"nonComVisibleBaseClass MDA\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"visible classes\"\n  - \"managed debugging assistants (MDAs), COM visible classes\"\n  - \"nonComVisibleBaseClass MDA\"\n  - \"COM visible classes\"\n  - \"QueryInterface call failures\"\n  - \"MDAs (managed debugging assistants), COM visible classes\"\nms.assetid: 9ec1af27-604b-477e-9ee2-e833eb10d3ce\nauthor: \"mairaw\"\nms.author: \"mairaw\"","nodes":[{"content":"nonComVisibleBaseClass MDA","nodes":[{"pos":[0,26],"content":"nonComVisibleBaseClass MDA","nodes":[{"content":"nonComVisibleBaseClass MDA","pos":[0,26]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[418,444],"content":"nonComVisibleBaseClass MDA","linkify":"nonComVisibleBaseClass MDA","nodes":[{"content":"nonComVisibleBaseClass MDA","pos":[0,26]}]},{"content":"The <ph id=\"ph1\">`nonComVisibleBaseClass`</ph> managed debugging assistant (MDA) is activated when a <ph id=\"ph2\">`QueryInterface`</ph> call is made by native or unmanaged code on the COM callable wrapper (CCW) of a COM-visible managed class that derives from a base class that is not COM visible.","pos":[445,706],"source":"The `nonComVisibleBaseClass` managed debugging assistant (MDA) is activated when a `QueryInterface` call is made by native or unmanaged code on the COM callable wrapper (CCW) of a COM-visible managed class that derives from a base class that is not COM visible."},{"content":"The <ph id=\"ph1\">`QueryInterface`</ph> call causes the MDA to activate only in cases where call requests the class interface or default <ph id=\"ph2\">`IDispatch`</ph> of the COM-visible managed class.","pos":[708,871],"source":"  The `QueryInterface` call causes the MDA to activate only in cases where call requests the class interface or default `IDispatch` of the COM-visible managed class."},{"content":"The MDA is not activated when the <ph id=\"ph1\">`QueryInterface`</ph> is for an explicit interface that has the <ph id=\"ph2\">&lt;xref:System.Runtime.InteropServices.ClassInterfaceAttribute&gt;</ph> attribute applied and is explicitly implemented by the COM-visible class.","pos":[873,1101],"source":"  The MDA is not activated when the `QueryInterface` is for an explicit interface that has the <xref:System.Runtime.InteropServices.ClassInterfaceAttribute> attribute applied and is explicitly implemented by the COM-visible class."},{"pos":[1110,1118],"content":"Symptoms","linkify":"Symptoms","nodes":[{"content":"Symptoms","pos":[0,8]}]},{"content":"A <ph id=\"ph1\">`QueryInterface`</ph> call made from native code that is failing with a COR_E_INVALIDOPERATION HRESULT.","pos":[1122,1222],"source":"A `QueryInterface` call made from native code that is failing with a COR_E_INVALIDOPERATION HRESULT."},{"content":"The HRESULT might be due to the runtime disallowing <ph id=\"ph1\">`QueryInterface`</ph> calls that would cause the activation of this MDA.","pos":[1224,1343],"source":"  The HRESULT might be due to the runtime disallowing `QueryInterface` calls that would cause the activation of this MDA."},{"pos":[1352,1357],"content":"Cause","linkify":"Cause","nodes":[{"content":"Cause","pos":[0,5]}]},{"content":"The runtime cannot allow <ph id=\"ph1\">`QueryInterface`</ph> calls for the class interface or default <ph id=\"ph2\">`IDispatch`</ph> interface of a COM-visible class that derives from a class that is not COM-visible because of potential versioning problems.","pos":[1361,1580],"source":"The runtime cannot allow `QueryInterface` calls for the class interface or default `IDispatch` interface of a COM-visible class that derives from a class that is not COM-visible because of potential versioning problems."},{"content":"For example, if any public members were added to the base class that is not COM-visible, existing COM clients using the derived class could potentially break because the vtable of the derived class, which contains the base class members, would be altered by such a change.","pos":[1582,1854]},{"content":"Explicit interfaces exposed to COM do not have this problem because they do not include the base members of interfaces in the vtable.","pos":[1856,1989]},{"pos":[1998,2008],"content":"Resolution","linkify":"Resolution","nodes":[{"content":"Resolution","pos":[0,10]}]},{"content":"Do not expose the class interface.","pos":[2012,2046]},{"content":"Define an explicit interface and apply the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.ClassInterfaceAttribute&gt;</ph> attribute to it.","pos":[2047,2168],"source":" Define an explicit interface and apply the <xref:System.Runtime.InteropServices.ClassInterfaceAttribute> attribute to it."},{"pos":[2177,2198],"content":"Effect on the Runtime","linkify":"Effect on the Runtime","nodes":[{"content":"Effect on the Runtime","pos":[0,21]}]},{"content":"This MDA has no effect on the CLR.","pos":[2202,2236]},{"pos":[2245,2251],"content":"Output","linkify":"Output","nodes":[{"content":"Output","pos":[0,6]}]},{"pos":[2255,2401],"content":"The following is an example message for a <ph id=\"ph1\">`QueryInterface`</ph> call on a COM-visible class <ph id=\"ph2\">`Derived`</ph> that derives from a non-COM-visible class <ph id=\"ph3\">`Base`</ph>.","source":"The following is an example message for a `QueryInterface` call on a COM-visible class `Derived` that derives from a non-COM-visible class `Base`."},{"pos":[2752,2765],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"pos":[2889,2897],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[2960,3113],"content":"<bpt id=\"p1\">[</bpt>Diagnosing Errors with Managed Debugging Assistants<ept id=\"p1\">](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)</ept>","source":"[Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)"},{"pos":[3116,3191],"content":"<bpt id=\"p1\">[</bpt>Interop Marshaling<ept id=\"p1\">](../../../docs/framework/interop/interop-marshaling.md)</ept>","source":"[Interop Marshaling](../../../docs/framework/interop/interop-marshaling.md)"}]}