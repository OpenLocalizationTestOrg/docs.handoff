{"content":"---\ntitle: \"Default Message Contract\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"Message Contract\"\nms.assetid: 5a200b78-1a46-4104-b7fb-da6dbab33893\n---\n# Default Message Contract\nThe Default Message Contract sample demonstrates a service where a custom user-defined message is passed to and from service operations. This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) that implements a calculator interface as a typed service. Instead of the individual service operations for addition, subtraction, multiplication, and division used in the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md), this sample passes a custom message that contains both the operands and the operator, and returns the result of the arithmetic calculation.  \n  \n The client is a console program (.exe) and the service library (.dll) is hosted by Internet Information Services (IIS). Client activity is visible in the console window.  \n  \n> [!NOTE]\n>  The setup procedure and build instructions for this sample are located at the end of this topic.  \n  \n In the service, a single service operation is defined that accepts and returns custom messages of type `MyMessage`. Although in this sample the request and response messages are of the same type, they could of course be different message contracts if necessary.  \n  \n```csharp\n[ServiceContract(Namespace=\"http://Microsoft.ServiceModel.Samples\")]  \npublic interface ICalculator  \n{  \n    [OperationContract(Action=\"http://test/MyMessage_action\",  \n                  ReplyAction=\"http://test/MyMessage_action\")]  \n    MyMessage Calculate(MyMessage request);  \n}  \n```  \n  \n The custom message `MyMessage` is defined in a class annotated with <xref:System.ServiceModel.MessageContractAttribute>, <xref:System.ServiceModel.MessageHeaderAttribute> and <xref:System.ServiceModel.MessageBodyMemberAttribute> attributes. Only the third constructor is used in this sample. Using message contracts allows you to exercise full control over the SOAP message. In this sample, the <xref:System.ServiceModel.MessageHeaderAttribute> attribute is used to put `Operation` in a SOAP header. The operands `N1`, `N2` and the `Result` appear within the SOAP body because they have the <xref:System.ServiceModel.MessageBodyMemberAttribute> attribute applied.  \n  \n```csharp\n[MessageContract]  \npublic class MyMessage  \n{  \n    private string operation;  \n    private double n1;  \n    private double n2;  \n    private double result;  \n  \n    //Constructor - create an empty message.  \n  \n    public MyMessage() {}  \n  \n    //Constructor - create a message and populate its members.  \n  \n    public MyMessage(double n1, double n2, string operation,   \n                     double result)  \n    {  \n        this.n1 = n1;  \n        this.n2 = n2;  \n        this.operation = operation;  \n        this.result = result;  \n    }  \n  \n    //Constructor - create a message from another message.  \n  \n    public MyMessage(MyMessage message)  \n    {  \n        this.n1 = message.n1;  \n        this.n2 = message.n2;  \n        this.operation = message.operation;  \n        this.result = message.result;  \n    }  \n  \n    [MessageHeader]  \n    public string Operation  \n    {  \n        get { return operation; }  \n        set { operation = value; }  \n    }  \n  \n    [MessageBodyMember]  \n    public double N1  \n    {  \n        get { return n1; }  \n        set { n1 = value; }  \n    }  \n  \n    [MessageBodyMember]  \n    public double N2  \n    {  \n        get { return n2; }  \n        set { n2 = value; }  \n    }  \n  \n    [MessageBodyMember]  \n    public double Result  \n    {  \n        get { return result; }  \n        set { result = value; }  \n    }  \n}  \n```  \n  \n The implementation class contains the code for the `Calculate` service operation. The `CalculateService` class obtains the operands and operator from the request message and creates a response message that contains the result of the requested calculation, as shown in the following sample code.  \n  \n```csharp\n// Service class which implements the service contract.  \npublic class CalculatorService : ICalculator  \n{  \n    // Perform a calculation.  \n  \n    public MyMessage Calculate(MyMessage request)  \n    {  \n        MyMessage response = new MyMessage(request);  \n        switch (request.Operation)  \n        {  \n            case \"+\":  \n                response.Result = request.N1 + request.N2;  \n                break;  \n            case \"-\":  \n                response.Result = request.N1 - request.N2;  \n                break;  \n            case \"*\":  \n                response.Result = request.N1 * request.N2;  \n                break;  \n            case \"/\":  \n                response.Result = request.N1 / request.N2;  \n                break;  \n            default:  \n                response.Result = 0.0D;  \n                break;  \n        }  \n        return response;  \n    }  \n}  \n```  \n  \n The generated client code for the client was created with the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) tool. The tool automatically creates message contract types in the generated client code if necessary. The `/messageContract` command option may be specified to force the generation of message contracts.  \n  \n```console  \nsvcutil.exe /n:\"http://Microsoft.ServiceModel.Samples,Microsoft.ServiceModel.Samples\" /o:client\\generatedClient.cs http://localhost/servicemodelsamples/service.svc/mex  \n```  \n  \n The following sample code demonstrates the client using the `MyMessage` message.  \n  \n```csharp\n// Create a client with given client endpoint configuration  \nCalculatorClient client = new CalculatorClient();  \n  \n// Perform addition using a typed message.  \n  \nMyMessage request = new MyMessage() \n                    {  \n                        N1 = 100D,  \n                        N2 = 15.99D,  \n                        Operation = \"+\"  \n                    };\nMyMessage response = ((ICalculator)client).Calculate(request);  \nConsole.WriteLine(\"Add({0},{1}) = {2}\", request.N1, request.N2, response.Result);  \n```  \n  \n When you run the sample, the calculations are displayed in the client console window. Press ENTER in the client window to shut down the client.  \n  \n```console  \nAdd(100,15.99) = 115.99  \nSubtract(145,76.54) = 68.46  \nMultiply(9,81.25) = 731.25  \nDivide(22,7) = 3.14285714285714  \n  \nPress <ENTER> to terminate client.  \n```  \n  \n At this point, custom user-defined messages have passed between the client and the service operation. The message contract defined that the operands and results were in the message body and that the operator was in a message header. Message logging can be configured to observe this message structure.  \n  \n### To set up, build, and run the sample  \n  \n1.  Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).  \n  \n2.  To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).  \n  \n3.  To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Contract\\Message\\Default`  \n","nodes":[{"pos":[4,153],"embed":true,"restype":"x-metadata","content":"title: \"Default Message Contract\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"Message Contract\"\nms.assetid: 5a200b78-1a46-4104-b7fb-da6dbab33893","nodes":[{"content":"Default Message Contract","nodes":[{"pos":[0,24],"content":"Default Message Contract","nodes":[{"content":"Default Message Contract","pos":[0,24]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[160,184],"content":"Default Message Contract","linkify":"Default Message Contract","nodes":[{"content":"Default Message Contract","pos":[0,24]}]},{"content":"The Default Message Contract sample demonstrates a service where a custom user-defined message is passed to and from service operations.","pos":[185,321]},{"content":"This sample is based on the <bpt id=\"p1\">[</bpt>Getting Started<ept id=\"p1\">](../../../../docs/framework/wcf/samples/getting-started-sample.md)</ept> that implements a calculator interface as a typed service.","pos":[322,492],"source":" This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) that implements a calculator interface as a typed service."},{"content":"Instead of the individual service operations for addition, subtraction, multiplication, and division used in the <bpt id=\"p1\">[</bpt>Getting Started<ept id=\"p1\">](../../../../docs/framework/wcf/samples/getting-started-sample.md)</ept>, this sample passes a custom message that contains both the operands and the operator, and returns the result of the arithmetic calculation.","pos":[493,830],"source":" Instead of the individual service operations for addition, subtraction, multiplication, and division used in the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md), this sample passes a custom message that contains both the operands and the operator, and returns the result of the arithmetic calculation."},{"content":"The client is a console program (.exe) and the service library (.dll) is hosted by Internet Information Services (IIS).","pos":[837,956]},{"content":"Client activity is visible in the console window.","pos":[957,1006]},{"pos":[1014,1121],"content":"[!NOTE]\n The setup procedure and build instructions for this sample are located at the end of this topic.","leadings":["","> "],"nodes":[{"content":"The setup procedure and build instructions for this sample are located at the end of this topic.","pos":[9,105]}]},{"content":"In the service, a single service operation is defined that accepts and returns custom messages of type <ph id=\"ph1\">`MyMessage`</ph>.","pos":[1128,1243],"source":"In the service, a single service operation is defined that accepts and returns custom messages of type `MyMessage`."},{"content":"Although in this sample the request and response messages are of the same type, they could of course be different message contracts if necessary.","pos":[1244,1389]},{"content":"The custom message <ph id=\"ph1\">`MyMessage`</ph> is defined in a class annotated with <ph id=\"ph2\">&lt;xref:System.ServiceModel.MessageContractAttribute&gt;</ph>, <ph id=\"ph3\">&lt;xref:System.ServiceModel.MessageHeaderAttribute&gt;</ph> and <ph id=\"ph4\">&lt;xref:System.ServiceModel.MessageBodyMemberAttribute&gt;</ph> attributes.","pos":[1700,1940],"source":"The custom message `MyMessage` is defined in a class annotated with <xref:System.ServiceModel.MessageContractAttribute>, <xref:System.ServiceModel.MessageHeaderAttribute> and <xref:System.ServiceModel.MessageBodyMemberAttribute> attributes."},{"content":"Only the third constructor is used in this sample.","pos":[1941,1991]},{"content":"Using message contracts allows you to exercise full control over the SOAP message.","pos":[1992,2074]},{"content":"In this sample, the <ph id=\"ph1\">&lt;xref:System.ServiceModel.MessageHeaderAttribute&gt;</ph> attribute is used to put <ph id=\"ph2\">`Operation`</ph> in a SOAP header.","pos":[2075,2199],"source":" In this sample, the <xref:System.ServiceModel.MessageHeaderAttribute> attribute is used to put `Operation` in a SOAP header."},{"content":"The operands <ph id=\"ph1\">`N1`</ph>, <ph id=\"ph2\">`N2`</ph> and the <ph id=\"ph3\">`Result`</ph> appear within the SOAP body because they have the <ph id=\"ph4\">&lt;xref:System.ServiceModel.MessageBodyMemberAttribute&gt;</ph> attribute applied.","pos":[2200,2363],"source":" The operands `N1`, `N2` and the `Result` appear within the SOAP body because they have the <xref:System.ServiceModel.MessageBodyMemberAttribute> attribute applied."},{"content":"The implementation class contains the code for the <ph id=\"ph1\">`Calculate`</ph> service operation.","pos":[3753,3834],"source":"The implementation class contains the code for the `Calculate` service operation."},{"content":"The <ph id=\"ph1\">`CalculateService`</ph> class obtains the operands and operator from the request message and creates a response message that contains the result of the requested calculation, as shown in the following sample code.","pos":[3835,4047],"source":" The `CalculateService` class obtains the operands and operator from the request message and creates a response message that contains the result of the requested calculation, as shown in the following sample code."},{"content":"The generated client code for the client was created with the <bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept> tool.","pos":[4962,5162],"source":"The generated client code for the client was created with the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) tool."},{"content":"The tool automatically creates message contract types in the generated client code if necessary.","pos":[5163,5259]},{"content":"The <ph id=\"ph1\">`/messageContract`</ph> command option may be specified to force the generation of message contracts.","pos":[5260,5360],"source":" The `/messageContract` command option may be specified to force the generation of message contracts."},{"pos":[5559,5639],"content":"The following sample code demonstrates the client using the <ph id=\"ph1\">`MyMessage`</ph> message.","source":"The following sample code demonstrates the client using the `MyMessage` message."},{"content":"When you run the sample, the calculations are displayed in the client console window.","pos":[6181,6266]},{"content":"Press ENTER in the client window to shut down the client.","pos":[6267,6324]},{"content":"At this point, custom user-defined messages have passed between the client and the service operation.","pos":[6512,6613]},{"content":"The message contract defined that the operands and results were in the message body and that the operator was in a message header.","pos":[6614,6744]},{"content":"Message logging can be configured to observe this message structure.","pos":[6745,6813]},{"pos":[6823,6859],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[6869,7068],"content":"Ensure that you have performed the <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"pos":[7078,7287],"content":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"pos":[7297,7505],"content":"To run the sample in a single- or cross-machine configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"pos":[7513,7645],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[14,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[0,53]},{"content":"Check for the following (default) directory before continuing.","pos":[54,116]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[7699,8009],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[8010,8060]}]}