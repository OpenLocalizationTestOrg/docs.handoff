{"content":"---\ntitle: \"Message Security with an Anonymous Client | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: cad53e1a-b7c9-4064-bc87-508c3d1dce49\ncaps.latest.revision: 15\nauthor: \"BrucePerlerMS\"\nms.author: \"bruceper\"\nmanager: \"mbaldwin\"\n---\n# Message Security with an Anonymous Client\nThe following scenario shows a client and service secured by [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] message security. A design goal is to use message security rather than transport security, so that in the future it can support a richer claims-based model. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] using rich claims for authorization, see [Managing Claims and Authorization with the Identity Model](../../../../docs/framework/wcf/feature-details/managing-claims-and-authorization-with-the-identity-model.md).  \n  \n For a sample application, see [Message Security Anonymous](../../../../docs/framework/wcf/samples/message-security-anonymous.md).  \n  \n ![Message security with an anynymous client](../../../../docs/framework/wcf/feature-details/media/b361a565-831c-4c10-90d7-66d8eeece0a1.gif \"b361a565-831c-4c10-90d7-66d8eeece0a1\")  \n  \n|Characteristic|Description|  \n|--------------------|-----------------|  \n|Security Mode|Message|  \n|Interoperability|[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] only|  \n|Authentication (Server)|Initial negotiation requires server authentication, but not client authentication|  \n|Authentication (Client)|None|  \n|Integrity|Yes, using shared security context|  \n|Confidentiality|Yes, using shared security context|  \n|Transport|HTTP|  \n  \n## Service  \n The following code and configuration are meant to run independently. Do one of the following:  \n  \n-   Create a stand-alone service using the code with no configuration.  \n  \n-   Create a service using the supplied configuration, but do not define any endpoints.  \n  \n### Code  \n The following code shows how to create a service endpoint that uses message security.  \n  \n [!code-csharp[C_SecurityScenarios#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#8)]\n [!code-vb[C_SecurityScenarios#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#8)]  \n  \n### Configuration  \n The following configuration can be used instead of the code. The service behavior element is used to specify a certificate that is used to authenticate the service to the client. The service element must specify the behavior using the `behaviorConfiguration` attribute. The binding element specifies that the client credential type is `None`, allowing anonymous clients to use the service.  \n  \n```  \n<?xml version=\"1.0\" encoding=\"utf-8\"?>  \n<configuration>  \n  <system.serviceModel>  \n    <behaviors>  \n      <serviceBehaviors>  \n        <behavior name=\"ServiceCredentialsBehavior\">  \n          <serviceCredentials>  \n            <serviceCertificate findValue=\"contoso.com\"   \n                                storeLocation=\"LocalMachine\"  \n                                storeName=\"My\" />  \n          </serviceCredentials>  \n        </behavior>  \n      </serviceBehaviors>  \n    </behaviors>  \n    <services>  \n      <service behaviorConfiguration=\"ServiceCredentialsBehavior\"   \n               name=\"ServiceModel.Calculator\">  \n        <endpoint address=\"http://localhost/Calculator\"   \n                  binding=\"wsHttpBinding\"  \n                  bindingConfiguration=\"WSHttpBinding_ICalculator\"   \n                  name=\"CalculatorService\"  \n                  contract=\"ServiceModel.ICalculator\" />  \n      </service>  \n    </services>  \n    <bindings>  \n      <wsHttpBinding>  \n        <binding name=\"WSHttpBinding_ICalculator\" >  \n          <security mode=\"Message\">  \n            <message clientCredentialType=\"None\" />  \n          </security>  \n        </binding>  \n      </wsHttpBinding>  \n    </bindings>  \n    <client />  \n  </system.serviceModel>  \n</configuration>  \n```  \n  \n## Client  \n The following code and configuration are meant to run independently. Do one of the following:  \n  \n-   Create a stand-alone client using the code (and client code).  \n  \n-   Create a client that does not define any endpoint addresses. Instead, use the client constructor that takes the configuration name as an argument. For example:  \n  \n     [!code-csharp[C_SecurityScenarios#0](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#0)]\n     [!code-vb[C_SecurityScenarios#0](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#0)]  \n  \n### Code  \n The following code creates an instance of the client. The binding uses message mode security, and the client credential type is set to none.  \n  \n [!code-csharp[C_SecurityScenarios#15](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#15)]\n [!code-vb[C_SecurityScenarios#15](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#15)]  \n  \n### Configuration  \n The following code configures the client.  \n  \n```  \n<?xml version=\"1.0\" encoding=\"utf-8\"?>  \n<configuration>  \n  <system.serviceModel>  \n    <bindings>  \n      <wsHttpBinding>  \n        <binding name=\"WSHttpBinding_ICalculator\" >  \n          <security mode=\"Message\">  \n            <message clientCredentialType=\"None\" />  \n          </security>  \n        </binding>  \n      </wsHttpBinding>  \n    </bindings>  \n    <client>  \n      <endpoint address=\"http://machineName/Calculator\"  \n        binding=\"wsHttpBinding\"  \n        bindingConfiguration=\"WSHttpBinding_ICalculator\"   \n        contract=\"ICalculator\"  \n        name=\"WSHttpBinding_ICalculator\">  \n        <identity>  \n          <dns value=\"contoso.com\" />  \n        </identity>  \n      </endpoint>  \n    </client>  \n  </system.serviceModel>  \n</configuration>  \n```  \n  \n## See Also  \n [Security Overview](../../../../docs/framework/wcf/feature-details/security-overview.md)   \n [Distributed Application Security](../../../../docs/framework/wcf/feature-details/distributed-application-security.md)   \n [Message Security Anonymous](../../../../docs/framework/wcf/samples/message-security-anonymous.md)   \n [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)   \n [Security Model for Windows Server App Fabric](http://go.microsoft.com/fwlink/?LinkID=201279&clcid=0x409)","nodes":[{"pos":[4,373],"embed":true,"restype":"x-metadata","content":"title: \"Message Security with an Anonymous Client | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: cad53e1a-b7c9-4064-bc87-508c3d1dce49\ncaps.latest.revision: 15\nauthor: \"BrucePerlerMS\"\nms.author: \"bruceper\"\nmanager: \"mbaldwin\"","nodes":[{"content":"Message Security with an Anonymous Client | Microsoft Docs","nodes":[{"pos":[0,58],"content":"Message Security with an Anonymous Client | Microsoft Docs","nodes":[{"content":"Message Security with an Anonymous Client | Microsoft Docs","pos":[0,58]}]}],"path":["title"]}],"yml":true},{"pos":[380,421],"content":"Message Security with an Anonymous Client","linkify":"Message Security with an Anonymous Client","nodes":[{"content":"Message Security with an Anonymous Client","pos":[0,41]}]},{"content":"The following scenario shows a client and service secured by <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> message security.","pos":[422,556],"source":"The following scenario shows a client and service secured by [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] message security."},{"content":"A design goal is to use message security rather than transport security, so that in the future it can support a richer claims-based model.","pos":[557,695]},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> using rich claims for authorization, see <bpt id=\"p1\">[</bpt>Managing Claims and Authorization with the Identity Model<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/managing-claims-and-authorization-with-the-identity-model.md)</ept>.","pos":[696,962],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] using rich claims for authorization, see [Managing Claims and Authorization with the Identity Model](../../../../docs/framework/wcf/feature-details/managing-claims-and-authorization-with-the-identity-model.md)."},{"pos":[969,1098],"content":"For a sample application, see <bpt id=\"p1\">[</bpt>Message Security Anonymous<ept id=\"p1\">](../../../../docs/framework/wcf/samples/message-security-anonymous.md)</ept>.","source":"For a sample application, see [Message Security Anonymous](../../../../docs/framework/wcf/samples/message-security-anonymous.md)."},{"pos":[1105,1283],"content":"<bpt id=\"p1\">![</bpt>Message security with an anynymous client<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wcf/feature-details/media/b361a565-831c-4c10-90d7-66d8eeece0a1.gif \"</bpt>b361a565-831c-4c10-90d7-66d8eeece0a1<ept id=\"p2\">\")</ept>","source":"![Message security with an anynymous client](../../../../docs/framework/wcf/feature-details/media/b361a565-831c-4c10-90d7-66d8eeece0a1.gif \"b361a565-831c-4c10-90d7-66d8eeece0a1\")"},{"content":"Characteristic","pos":[1290,1304]},{"content":"Description","pos":[1305,1316]},{"content":"Security Mode","pos":[1364,1377]},{"content":"Message","pos":[1378,1385]},{"content":"Interoperability","pos":[1390,1406]},{"pos":[1407,1467],"content":"<ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> only","source":"[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] only"},{"content":"Authentication (Server)","pos":[1472,1495]},{"content":"Initial negotiation requires server authentication, but not client authentication","pos":[1496,1577]},{"content":"Authentication (Client)","pos":[1582,1605]},{"content":"None","pos":[1606,1610]},{"content":"Integrity","pos":[1615,1624]},{"content":"Yes, using shared security context","pos":[1625,1659]},{"content":"Confidentiality","pos":[1664,1679]},{"content":"Yes, using shared security context","pos":[1680,1714]},{"content":"Transport","pos":[1719,1728]},{"content":"HTTP","pos":[1729,1733]},{"pos":[1743,1750],"content":"Service","linkify":"Service","nodes":[{"content":"Service","pos":[0,7]}]},{"content":"The following code and configuration are meant to run independently.","pos":[1754,1822]},{"content":"Do one of the following:","pos":[1823,1847]},{"content":"Create a stand-alone service using the code with no configuration.","pos":[1857,1923]},{"content":"Create a service using the supplied configuration, but do not define any endpoints.","pos":[1933,2016]},{"pos":[2026,2030],"content":"Code","linkify":"Code","nodes":[{"content":"Code","pos":[0,4]}]},{"content":"The following code shows how to create a service endpoint that uses message security.","pos":[2034,2119]},{"pos":[2389,2402],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"content":"The following configuration can be used instead of the code.","pos":[2406,2466]},{"content":"The service behavior element is used to specify a certificate that is used to authenticate the service to the client.","pos":[2467,2584]},{"content":"The service element must specify the behavior using the <ph id=\"ph1\">`behaviorConfiguration`</ph> attribute.","pos":[2585,2675],"source":" The service element must specify the behavior using the `behaviorConfiguration` attribute."},{"content":"The binding element specifies that the client credential type is <ph id=\"ph1\">`None`</ph>, allowing anonymous clients to use the service.","pos":[2676,2795],"source":" The binding element specifies that the client credential type is `None`, allowing anonymous clients to use the service."},{"pos":[4101,4107],"content":"Client","linkify":"Client","nodes":[{"content":"Client","pos":[0,6]}]},{"content":"The following code and configuration are meant to run independently.","pos":[4111,4179]},{"content":"Do one of the following:","pos":[4180,4204]},{"content":"Create a stand-alone client using the code (and client code).","pos":[4214,4275]},{"content":"Create a client that does not define any endpoint addresses.","pos":[4285,4345]},{"content":"Instead, use the client constructor that takes the configuration name as an argument.","pos":[4346,4431]},{"content":"For example:","pos":[4432,4444]},{"pos":[4455,4712],"content":"[!code-csharp[C_SecurityScenarios#0](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#0)]\n [!code-vb[C_SecurityScenarios#0](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#0)]","leadings":["","    "],"nodes":[]},{"pos":[4722,4726],"content":"Code","linkify":"Code","nodes":[{"content":"Code","pos":[0,4]}]},{"content":"The following code creates an instance of the client.","pos":[4730,4783]},{"content":"The binding uses message mode security, and the client credential type is set to none.","pos":[4784,4870]},{"pos":[5144,5157],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"content":"The following code configures the client.","pos":[5161,5202]},{"pos":[5995,6003],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Security Overview<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/security-overview.md)</ept><ph id=\"ph1\"> </ph>","pos":[6007,6096],"source":"[Security Overview](../../../../docs/framework/wcf/feature-details/security-overview.md) "},{"content":"<bpt id=\"p1\">[</bpt>Distributed Application Security<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/distributed-application-security.md)</ept><ph id=\"ph1\"> </ph>","pos":[6100,6219],"source":"[Distributed Application Security](../../../../docs/framework/wcf/feature-details/distributed-application-security.md) "},{"content":"<bpt id=\"p1\">[</bpt>Message Security Anonymous<ept id=\"p1\">](../../../../docs/framework/wcf/samples/message-security-anonymous.md)</ept><ph id=\"ph1\"> </ph>","pos":[6223,6322],"source":"[Message Security Anonymous](../../../../docs/framework/wcf/samples/message-security-anonymous.md) "},{"content":"<bpt id=\"p1\">[</bpt>Service Identity and Authentication<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)</ept><ph id=\"ph1\"> </ph>","pos":[6326,6451],"source":"[Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md) "},{"content":"<bpt id=\"p1\">[</bpt>Security Model for Windows Server App Fabric<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkID=201279&amp;clcid=0x409)</ept>","pos":[6455,6560],"source":"[Security Model for Windows Server App Fabric](http://go.microsoft.com/fwlink/?LinkID=201279&clcid=0x409)"}]}