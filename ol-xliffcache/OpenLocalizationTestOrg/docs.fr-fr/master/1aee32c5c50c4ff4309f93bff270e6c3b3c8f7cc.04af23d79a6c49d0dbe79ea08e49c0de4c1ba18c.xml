{"content":"---\ntitle: \"Mitigation: Culture and Dispatcher Operations in WPF Apps | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-bcl\"\n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 455c1452-8ce0-45ae-a092-21fb8edf1cac\ncaps.latest.revision: 3\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# Mitigation: Culture and Dispatcher Operations in WPF Apps\nIn apps that target the .NET Framework 4.6 and the .NET Framework 4.6.1, changes to the <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName> or <xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName> properties that are made within a <xref:System.Windows.Threading.Dispatcher> are lost at the end of that dispatcher operation. Similarly, changes to <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName> or <xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName> made outside of a dispatcher operation may not be reflected when that operation executes.  \n  \n This is due to a change in <xref:System.Threading.ExecutionContext> that causes the <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName> to be stored in the execution context. WPF dispatcher operations store the execution context used to begin the operation and restore the previous context when the operation is completed. Because <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName> are now part of that context, changes to them within a dispatcher operation are not persisted outside of the operation.  \n  \n## Impact  \n Practically, this means that changes to the <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName> and  <xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName> properties may not flow between WPF UI callbacks and other code in a WPF application.  \n  \n## Mitigation  \n Apps affected by this change may work around it in either of two ways:  \n  \n-   By storing the desired <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName> or  <xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName> in a field and checking in all <xref:System.Windows.Threading.Dispatcher> operation bodies (including UI event callback handlers) that the correct <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName> or  <xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName> is set.  \n  \n-   Because the change to <xref:System.Threading.ExecutionContext> only affects WPF apps that target the .NET Framework 4.6 or the .NET Framework 4.6.1, this change can be avoided by targeting the .NET Framework 4.5.2 or by targeting a version of the .NET Framework starting with 4.6.2.  \n  \n## See Also  \n [Retargeting Changes](../../../docs/framework/migration-guide/retargeting-changes-in-the-net-framework-4-6.md)","nodes":[{"pos":[12,86],"content":"Mitigation: Culture and Dispatcher Operations in WPF Apps | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Mitigation: Culture and Dispatcher Operations in WPF Apps | Microsoft Docs","pos":[0,74]}]},{"pos":[406,463],"content":"Mitigation: Culture and Dispatcher Operations in WPF Apps","linkify":"Mitigation: Culture and Dispatcher Operations in WPF Apps","nodes":[{"content":"Mitigation: Culture and Dispatcher Operations in WPF Apps","pos":[0,57]}]},{"content":"In apps that target the .NET Framework 4.6 and the .NET Framework 4.6.1, changes to the <ph id=\"ph1\">&lt;xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName&gt;</ph> or <ph id=\"ph2\">&lt;xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName&gt;</ph> properties that are made within a <ph id=\"ph3\">&lt;xref:System.Windows.Threading.Dispatcher&gt;</ph> are lost at the end of that dispatcher operation.","pos":[464,849],"source":"In apps that target the .NET Framework 4.6 and the .NET Framework 4.6.1, changes to the <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName> or <xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName> properties that are made within a <xref:System.Windows.Threading.Dispatcher> are lost at the end of that dispatcher operation."},{"content":"Similarly, changes to <ph id=\"ph1\">&lt;xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName&gt;</ph> or <ph id=\"ph2\">&lt;xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName&gt;</ph> made outside of a dispatcher operation may not be reflected when that operation executes.","pos":[850,1132],"source":" Similarly, changes to <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName> or <xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName> made outside of a dispatcher operation may not be reflected when that operation executes."},{"content":"This is due to a change in <ph id=\"ph1\">&lt;xref:System.Threading.ExecutionContext&gt;</ph> that causes the <ph id=\"ph2\">&lt;xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName&gt;</ph> to be stored in the execution context.","pos":[1139,1433],"source":"This is due to a change in <xref:System.Threading.ExecutionContext> that causes the <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName> to be stored in the execution context."},{"content":"WPF dispatcher operations store the execution context used to begin the operation and restore the previous context when the operation is completed.","pos":[1434,1581]},{"content":"Because <ph id=\"ph1\">&lt;xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName&gt;</ph> are now part of that context, changes to them within a dispatcher operation are not persisted outside of the operation.","pos":[1582,1881],"source":" Because <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName> are now part of that context, changes to them within a dispatcher operation are not persisted outside of the operation."},{"pos":[1890,1896],"content":"Impact","linkify":"Impact","nodes":[{"content":"Impact","pos":[0,6]}]},{"content":"Practically, this means that changes to the <ph id=\"ph1\">&lt;xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName&gt;</ph> and  <ph id=\"ph2\">&lt;xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName&gt;</ph> properties may not flow between WPF UI callbacks and other code in a WPF application.","pos":[1900,2202],"source":"Practically, this means that changes to the <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName> and  <xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName> properties may not flow between WPF UI callbacks and other code in a WPF application."},{"pos":[2211,2221],"content":"Mitigation","linkify":"Mitigation","nodes":[{"content":"Mitigation","pos":[0,10]}]},{"content":"Apps affected by this change may work around it in either of two ways:","pos":[2225,2295]},{"content":"By storing the desired <ph id=\"ph1\">&lt;xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName&gt;</ph> or  <ph id=\"ph2\">&lt;xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName&gt;</ph> in a field and checking in all <ph id=\"ph3\">&lt;xref:System.Windows.Threading.Dispatcher&gt;</ph> operation bodies (including UI event callback handlers) that the correct <ph id=\"ph4\">&lt;xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName&gt;</ph> or  <ph id=\"ph5\">&lt;xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName&gt;</ph> is set.","pos":[2305,2826],"source":"By storing the desired <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName> or  <xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName> in a field and checking in all <xref:System.Windows.Threading.Dispatcher> operation bodies (including UI event callback handlers) that the correct <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=fullName> or  <xref:System.Globalization.CultureInfo.CurrentUICulture%2A?displayProperty=fullName> is set."},{"content":"Because the change to <ph id=\"ph1\">&lt;xref:System.Threading.ExecutionContext&gt;</ph> only affects WPF apps that target the .NET Framework 4.6 or the .NET Framework 4.6.1, this change can be avoided by targeting the .NET Framework 4.5.2 or by targeting a version of the .NET Framework starting with 4.6.2.","pos":[2836,3118],"source":"Because the change to <xref:System.Threading.ExecutionContext> only affects WPF apps that target the .NET Framework 4.6 or the .NET Framework 4.6.1, this change can be avoided by targeting the .NET Framework 4.5.2 or by targeting a version of the .NET Framework starting with 4.6.2."},{"pos":[3127,3135],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[3139,3249],"content":"<bpt id=\"p1\">[</bpt>Retargeting Changes<ept id=\"p1\">](../../../docs/framework/migration-guide/retargeting-changes-in-the-net-framework-4-6.md)</ept>","source":"[Retargeting Changes](../../../docs/framework/migration-guide/retargeting-changes-in-the-net-framework-4-6.md)"}]}