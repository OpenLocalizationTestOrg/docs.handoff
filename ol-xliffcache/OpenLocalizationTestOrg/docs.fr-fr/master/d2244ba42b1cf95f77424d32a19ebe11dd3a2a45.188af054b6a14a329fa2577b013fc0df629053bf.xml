{"content":"---\ntitle: \"Security Considerations for Secure Sessions\"\nms.date: \"03/30/2017\"\nms.assetid: 0d5be591-9a7b-4a6f-a906-95d3abafe8db\n---\n# Security Considerations for Secure Sessions\nYou should consider the following items that affect security when implementing secure sessions. For more information about security considerations, see [Security Considerations](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md) and [Best Practices for Security](../../../../docs/framework/wcf/feature-details/best-practices-for-security-in-wcf.md).  \n  \n## Secure Sessions and Metadata  \n When a secure session is established and the <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters.RequireCancellation%2A> property is set to `false`, Windows Communication Foundation (WCF) sends an `mssp:MustNotSendCancel` assertion as part of the metadata in the Web Services Description Language (WSDL) document for the service endpoint. The `mssp:MustNotSendCancel` assertion informs clients that the service does not respond to requests to cancel the secure session. When the <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters.RequireCancellation%2A> property is set to `true`, then WCF does not emit an `mssp:MustNotSendCancel` assertion in the WSDL document. Clients are expected to send a cancel request to the service when they no longer require the secure session. When a client is generated using the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md), the client code reacts appropriately to the presence or absence of the `mssp:MustNotSendCancel` assertion.  \n  \n## Secure Conversations and Custom Tokens  \n There are some issues with mixing custom tokens and derived keys due to the way it is defined in the WS-SecureConversation specification. The specification says that `wsse:SecurityTokenReference` is an optional element that references the derived token: \"`/wsc:DerivedKeyToken/wsse:SecurityTokenReference` This optional element is used to specify security context token, security token, or shared key/secret used for the derivation. If not specified, it is assumed that the recipient can determine the shared key from the message context. If the context cannot be determined, then a fault such as `wsc:UnknownDerivationSource` should be raised.\"  \n  \n This means that if you want a custom token to be derived, you should wrap its clause type in a `SecurityTokenReference` element. There is an option to turn off derivation but the default is to derive keys. If you fail to wrap the key, serializing the derived key token succeeds, but attempting to deserialize it throws an exception.  \n  \n## See also\n\n- [How to: Disable Secure Sessions on a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-disable-secure-sessions-on-a-wsfederationhttpbinding.md)\n- [Security Considerations](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)\n- [Best Practices for Security](../../../../docs/framework/wcf/feature-details/best-practices-for-security-in-wcf.md)\n","nodes":[{"pos":[4,127],"embed":true,"restype":"x-metadata","content":"title: \"Security Considerations for Secure Sessions\"\nms.date: \"03/30/2017\"\nms.assetid: 0d5be591-9a7b-4a6f-a906-95d3abafe8db","nodes":[{"content":"Security Considerations for Secure Sessions","nodes":[{"pos":[0,43],"content":"Security Considerations for Secure Sessions","nodes":[{"content":"Security Considerations for Secure Sessions","pos":[0,43]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[134,177],"content":"Security Considerations for Secure Sessions","linkify":"Security Considerations for Secure Sessions","nodes":[{"content":"Security Considerations for Secure Sessions","pos":[0,43]}]},{"content":"You should consider the following items that affect security when implementing secure sessions.","pos":[178,273]},{"content":"For more information about security considerations, see <bpt id=\"p1\">[</bpt>Security Considerations<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)</ept> and <bpt id=\"p2\">[</bpt>Best Practices for Security<ept id=\"p2\">](../../../../docs/framework/wcf/feature-details/best-practices-for-security-in-wcf.md)</ept>.","pos":[274,558],"source":" For more information about security considerations, see [Security Considerations](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md) and [Best Practices for Security](../../../../docs/framework/wcf/feature-details/best-practices-for-security-in-wcf.md)."},{"pos":[567,595],"content":"Secure Sessions and Metadata","linkify":"Secure Sessions and Metadata","nodes":[{"content":"Secure Sessions and Metadata","pos":[0,28]}]},{"content":"When a secure session is established and the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters.RequireCancellation%2A&gt;</ph> property is set to <ph id=\"ph2\">`false`</ph>, Windows Communication Foundation (WCF) sends an <ph id=\"ph3\">`mssp:MustNotSendCancel`</ph> assertion as part of the metadata in the Web Services Description Language (WSDL) document for the service endpoint.","pos":[599,969],"source":"When a secure session is established and the <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters.RequireCancellation%2A> property is set to `false`, Windows Communication Foundation (WCF) sends an `mssp:MustNotSendCancel` assertion as part of the metadata in the Web Services Description Language (WSDL) document for the service endpoint."},{"content":"The <ph id=\"ph1\">`mssp:MustNotSendCancel`</ph> assertion informs clients that the service does not respond to requests to cancel the secure session.","pos":[970,1100],"source":" The `mssp:MustNotSendCancel` assertion informs clients that the service does not respond to requests to cancel the secure session."},{"content":"When the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters.RequireCancellation%2A&gt;</ph> property is set to <ph id=\"ph2\">`true`</ph>, then WCF does not emit an <ph id=\"ph3\">`mssp:MustNotSendCancel`</ph> assertion in the WSDL document.","pos":[1101,1327],"source":" When the <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters.RequireCancellation%2A> property is set to `true`, then WCF does not emit an `mssp:MustNotSendCancel` assertion in the WSDL document."},{"content":"Clients are expected to send a cancel request to the service when they no longer require the secure session.","pos":[1328,1436]},{"content":"When a client is generated using the <bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept>, the client code reacts appropriately to the presence or absence of the <ph id=\"ph1\">`mssp:MustNotSendCancel`</ph> assertion.","pos":[1437,1714],"source":" When a client is generated using the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md), the client code reacts appropriately to the presence or absence of the `mssp:MustNotSendCancel` assertion."},{"pos":[1723,1761],"content":"Secure Conversations and Custom Tokens","linkify":"Secure Conversations and Custom Tokens","nodes":[{"content":"Secure Conversations and Custom Tokens","pos":[0,38]}]},{"content":"There are some issues with mixing custom tokens and derived keys due to the way it is defined in the WS-SecureConversation specification.","pos":[1765,1902]},{"content":"The specification says that <ph id=\"ph1\">`wsse:SecurityTokenReference`</ph> is an optional element that references the derived token: \"<ph id=\"ph2\">`/wsc:DerivedKeyToken/wsse:SecurityTokenReference`</ph> This optional element is used to specify security context token, security token, or shared key/secret used for the derivation.","pos":[1903,2197],"source":" The specification says that `wsse:SecurityTokenReference` is an optional element that references the derived token: \"`/wsc:DerivedKeyToken/wsse:SecurityTokenReference` This optional element is used to specify security context token, security token, or shared key/secret used for the derivation."},{"content":"If not specified, it is assumed that the recipient can determine the shared key from the message context.","pos":[2198,2303]},{"content":"If the context cannot be determined, then a fault such as <ph id=\"ph1\">`wsc:UnknownDerivationSource`</ph> should be raised.\"","pos":[2304,2410],"source":" If the context cannot be determined, then a fault such as `wsc:UnknownDerivationSource` should be raised.\""},{"content":"This means that if you want a custom token to be derived, you should wrap its clause type in a <ph id=\"ph1\">`SecurityTokenReference`</ph> element.","pos":[2417,2545],"source":"This means that if you want a custom token to be derived, you should wrap its clause type in a `SecurityTokenReference` element."},{"content":"There is an option to turn off derivation but the default is to derive keys.","pos":[2546,2622]},{"content":"If you fail to wrap the key, serializing the derived key token succeeds, but attempting to deserialize it throws an exception.","pos":[2623,2749]},{"pos":[2758,2766],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[2770,2943],"content":"<bpt id=\"p1\">[</bpt>How to: Disable Secure Sessions on a WSFederationHttpBinding<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-disable-secure-sessions-on-a-wsfederationhttpbinding.md)</ept>","source":"[How to: Disable Secure Sessions on a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-disable-secure-sessions-on-a-wsfederationhttpbinding.md)"},{"pos":[2946,3053],"content":"<bpt id=\"p1\">[</bpt>Security Considerations<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)</ept>","source":"[Security Considerations](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)"},{"pos":[3056,3171],"content":"<bpt id=\"p1\">[</bpt>Best Practices for Security<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/best-practices-for-security-in-wcf.md)</ept>","source":"[Best Practices for Security](../../../../docs/framework/wcf/feature-details/best-practices-for-security-in-wcf.md)"}]}