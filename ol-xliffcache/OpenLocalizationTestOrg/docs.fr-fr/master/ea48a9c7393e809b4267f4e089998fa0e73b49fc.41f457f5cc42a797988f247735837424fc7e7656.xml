{"content":"---\ntitle: \"Expected Exceptions\"\nms.date: \"03/30/2017\"\nms.assetid: 299a6987-ae6b-43c6-987f-12b034b583ae\n---\n# Expected Exceptions\nThis sample demonstrates how to catch expected exceptions when using a typed client. This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) that implements a calculator service. In this sample, the client is a console application (.exe) and the service is hosted by Internet Information Services (IIS).  \n  \n> [!NOTE]\n>  The setup procedure and build instructions for this sample are located at the end of this topic.  \n  \n This sample demonstrates catching and handling the two expected exception types that correct programs must handle: `TimeoutException` and `CommunicationException`.  \n  \n Exceptions that are thrown from communication methods on a Windows Communication Foundation (WCF) client are either expected or unexpected. Unexpected exceptions include catastrophic failures like `OutOfMemoryException` and programming errors like `ArgumentNullException` or `InvalidOperationException`. Typically there is no useful way to handle unexpected errors, so typically you should not catch them when calling a WCF client communication method.  \n  \n Expected exceptions from communication methods on a WCF client include `TimeoutException`, `CommunicationException`, and any derived class of `CommunicationException`. These indicate a problem during communication that can be safely handled by aborting the WCF client and reporting a communication failure. Because external factors can cause these errors in any application, correct applications must catch these exceptions and recover when they occur.  \n  \n There are several derived classes of `CommunicationException` that a client can throw. In some cases, applications also catch some of these to do special handling, but let the others be handled as a `CommunicationException`. This can be accomplished by catching the more specific exception type first and then catching `CommunicationException` in a later catch-clause.  \n  \n Code that calls a client communication method must catch the `TimeoutException` and `CommunicationException`. One way to handle such errors is to abort the client and report the communication failure.  \n  \n```csharp   \ntry  \n{  \n    ...  \n    double result = client.Add(value1, value2);  \n    ...  \n    client.Close();  \n}  \ncatch (TimeoutException exception)  \n{  \n    Console.WriteLine(\"Got {0}\", exception.GetType());  \n    client.Abort();  \n}  \ncatch (CommunicationException exception)  \n{  \n    Console.WriteLine(\"Got {0}\", exception.GetType());  \n    client.Abort();  \n}  \n```  \n  \n If an expected exception occurs, the client may or may not be usable afterwards. To determine if the client is still usable, check that the `State` property is `CommunicationState`.Opened. If it is still opened, then it is still usable. Otherwise you should abort the client and release all references to it.  \n  \n> [!CAUTION]\n>  You may observe that clients that have a session are often no longer usable after an exception, and clients that do not have a session are often still usable after an exception. However, neither of these is guaranteed, so if you want to try to continue using the client after an exception your application should check the `State` property to verify the client is still opened.  \n  \n When you run the sample, the operation responses and exceptions are displayed in the client console window.  \n  \n The client process runs two scenarios, each of which attempts to call `Add` followed by `Divide`. The first scenario simulates a network issue by aborting the client before making the call to `Divide`. The second scenario causes a timeout condition by setting the timeout too short for the method to complete. The expected output from the client process is:  \n  \n```  \nAdd(100,15.99) = 115.99  \nSimulated network problem occurs...  \nGot System.ServiceModel.CommunicationObjectAbortedException  \nAdd(100,15.99) = 115.99  \nSet timeout too short for method to complete...  \nGot System.TimeoutException  \n```  \n  \n### To set up, build, and run the sample  \n  \n1.  Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).  \n  \n2.  To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).  \n  \n3.  To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Client\\ExpectedExceptions`  \n","nodes":[{"pos":[4,103],"embed":true,"restype":"x-metadata","content":"title: \"Expected Exceptions\"\nms.date: \"03/30/2017\"\nms.assetid: 299a6987-ae6b-43c6-987f-12b034b583ae","nodes":[{"content":"Expected Exceptions","nodes":[{"pos":[0,19],"content":"Expected Exceptions","nodes":[{"content":"Expected Exceptions","pos":[0,19]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[110,129],"content":"Expected Exceptions","linkify":"Expected Exceptions","nodes":[{"content":"Expected Exceptions","pos":[0,19]}]},{"content":"This sample demonstrates how to catch expected exceptions when using a typed client.","pos":[130,214]},{"content":"This sample is based on the <bpt id=\"p1\">[</bpt>Getting Started<ept id=\"p1\">](../../../../docs/framework/wcf/samples/getting-started-sample.md)</ept> that implements a calculator service.","pos":[215,364],"source":" This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) that implements a calculator service."},{"content":"In this sample, the client is a console application (.exe) and the service is hosted by Internet Information Services (IIS).","pos":[365,489]},{"pos":[497,604],"content":"[!NOTE]\n The setup procedure and build instructions for this sample are located at the end of this topic.","leadings":["","> "],"nodes":[{"content":"The setup procedure and build instructions for this sample are located at the end of this topic.","pos":[9,105]}]},{"pos":[611,774],"content":"This sample demonstrates catching and handling the two expected exception types that correct programs must handle: <ph id=\"ph1\">`TimeoutException`</ph> and <ph id=\"ph2\">`CommunicationException`</ph>.","source":"This sample demonstrates catching and handling the two expected exception types that correct programs must handle: `TimeoutException` and `CommunicationException`."},{"content":"Exceptions that are thrown from communication methods on a Windows Communication Foundation (WCF) client are either expected or unexpected.","pos":[781,920]},{"content":"Unexpected exceptions include catastrophic failures like <ph id=\"ph1\">`OutOfMemoryException`</ph> and programming errors like <ph id=\"ph2\">`ArgumentNullException`</ph> or <ph id=\"ph3\">`InvalidOperationException`</ph>.","pos":[921,1084],"source":" Unexpected exceptions include catastrophic failures like `OutOfMemoryException` and programming errors like `ArgumentNullException` or `InvalidOperationException`."},{"content":"Typically there is no useful way to handle unexpected errors, so typically you should not catch them when calling a WCF client communication method.","pos":[1085,1233]},{"content":"Expected exceptions from communication methods on a WCF client include <ph id=\"ph1\">`TimeoutException`</ph>, <ph id=\"ph2\">`CommunicationException`</ph>, and any derived class of <ph id=\"ph3\">`CommunicationException`</ph>.","pos":[1240,1407],"source":"Expected exceptions from communication methods on a WCF client include `TimeoutException`, `CommunicationException`, and any derived class of `CommunicationException`."},{"content":"These indicate a problem during communication that can be safely handled by aborting the WCF client and reporting a communication failure.","pos":[1408,1546]},{"content":"Because external factors can cause these errors in any application, correct applications must catch these exceptions and recover when they occur.","pos":[1547,1692]},{"content":"There are several derived classes of <ph id=\"ph1\">`CommunicationException`</ph> that a client can throw.","pos":[1699,1785],"source":"There are several derived classes of `CommunicationException` that a client can throw."},{"content":"In some cases, applications also catch some of these to do special handling, but let the others be handled as a <ph id=\"ph1\">`CommunicationException`</ph>.","pos":[1786,1923],"source":" In some cases, applications also catch some of these to do special handling, but let the others be handled as a `CommunicationException`."},{"content":"This can be accomplished by catching the more specific exception type first and then catching <ph id=\"ph1\">`CommunicationException`</ph> in a later catch-clause.","pos":[1924,2067],"source":" This can be accomplished by catching the more specific exception type first and then catching `CommunicationException` in a later catch-clause."},{"content":"Code that calls a client communication method must catch the <ph id=\"ph1\">`TimeoutException`</ph> and <ph id=\"ph2\">`CommunicationException`</ph>.","pos":[2074,2183],"source":"Code that calls a client communication method must catch the `TimeoutException` and `CommunicationException`."},{"content":"One way to handle such errors is to abort the client and report the communication failure.","pos":[2184,2274]},{"content":"If an expected exception occurs, the client may or may not be usable afterwards.","pos":[2663,2743]},{"content":"To determine if the client is still usable, check that the <ph id=\"ph1\">`State`</ph> property is <ph id=\"ph2\">`CommunicationState`</ph>.Opened.","pos":[2744,2851],"source":" To determine if the client is still usable, check that the `State` property is `CommunicationState`.Opened."},{"content":"If it is still opened, then it is still usable.","pos":[2852,2899]},{"content":"Otherwise you should abort the client and release all references to it.","pos":[2900,2971]},{"pos":[2979,3370],"content":"[!CAUTION]\n You may observe that clients that have a session are often no longer usable after an exception, and clients that do not have a session are often still usable after an exception. However, neither of these is guaranteed, so if you want to try to continue using the client after an exception your application should check the `State` property to verify the client is still opened.","leadings":["","> "],"nodes":[{"content":"You may observe that clients that have a session are often no longer usable after an exception, and clients that do not have a session are often still usable after an exception. However, neither of these is guaranteed, so if you want to try to continue using the client after an exception your application should check the `State` property to verify the client is still opened.","pos":[12,389],"nodes":[{"content":"You may observe that clients that have a session are often no longer usable after an exception, and clients that do not have a session are often still usable after an exception.","pos":[0,177]},{"content":"However, neither of these is guaranteed, so if you want to try to continue using the client after an exception your application should check the <ph id=\"ph1\">`State`</ph> property to verify the client is still opened.","pos":[178,377],"source":" However, neither of these is guaranteed, so if you want to try to continue using the client after an exception your application should check the `State` property to verify the client is still opened."}]}]},{"content":"When you run the sample, the operation responses and exceptions are displayed in the client console window.","pos":[3377,3484]},{"content":"The client process runs two scenarios, each of which attempts to call <ph id=\"ph1\">`Add`</ph> followed by <ph id=\"ph2\">`Divide`</ph>.","pos":[3491,3588],"source":"The client process runs two scenarios, each of which attempts to call `Add` followed by `Divide`."},{"content":"The first scenario simulates a network issue by aborting the client before making the call to <ph id=\"ph1\">`Divide`</ph>.","pos":[3589,3692],"source":" The first scenario simulates a network issue by aborting the client before making the call to `Divide`."},{"content":"The second scenario causes a timeout condition by setting the timeout too short for the method to complete.","pos":[3693,3800]},{"content":"The expected output from the client process is:","pos":[3801,3848]},{"pos":[4105,4141],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[4151,4350],"content":"Ensure that you have performed the <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"pos":[4360,4569],"content":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"pos":[4579,4787],"content":"To run the sample in a single- or cross-machine configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"pos":[4795,4927],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[14,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[0,53]},{"content":"Check for the following (default) directory before continuing.","pos":[54,116]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[4981,5291],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[5292,5342]}]}