{"content":"---\ntitle: \"Security Trust Levels in Accessing Resources | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: fb5be924-317d-4d69-b33a-3d18ecfb9d6e\ncaps.latest.revision: 3\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Security Trust Levels in Accessing Resources\nThis topic discusses how access is restricted on the types of resources that <xref:System.Transactions> exposes.  \n  \n There are three main levels of trust for <xref:System.Transactions>. The trust levels are defined based on the types of resources that <xref:System.Transactions> exposes, and the level of trust that should be required to access those resources. The resources that <xref:System.Transactions> provides access to are system memory, shared process wide resources, and system wide resources. The levels are:  \n  \n-   **AllowPartiallyTrustedCallers** (APTCA) for applications using transactions within a single application domain.  \n  \n-   **DistributedTransactionPermission** (DTP) for applications using distributed transactions.  \n  \n-   Full trust for durable resources, configuration management applications, and legacy interop applications.  \n  \n> [!NOTE]\n>  You should not call any of the enlistment interfaces with impersonated contexts.  \n  \n## Trust Levels  \n  \n### APTCA (Partial Trust)  \n The <xref:System.Transactions> assembly can be called by partially trusted code because it has been marked with the **AllowPartiallyTrustedCallers** attribute (APTCA). This attribute essentially removes the implicit <xref:System.Security.Permissions.SecurityAction> for the **FullTrust** permission set that is otherwise automatically placed on each publicly accessible method in each type. However, some types and members still require stronger permissions.  \n  \n The APTCA attribute enables applications to use transactions in partial trust within a single application domain. This enables non-escalated transactions and volatile enlistments that can be used for error handling. One example of this is a transacted hash table and an application that uses it. Data can be added to and removed from the hash table under a single transaction. If the transaction is later rolled back, all of the changes made to the hash table under that transaction can be undone.  \n  \n### DistributedTransactionPermission (DTP)  \n When a <xref:System.Transactions> transaction is escalated to be managed by MSDTC, <xref:System.Transactions> demands the <xref:System.Transactions.DistributedTransactionPermission> (DTP) to create the distributed transaction. This means that the code that causes the transaction to be escalated (such as through serialization or additional durable enlistments) would need to be granted DTP. The code that originally created the <xref:System.Transactions> transaction does not necessarily need to possess this permission.  \n  \n### FullTrust Link Demands  \n This permission level is intended to restrict applications that are writing to durable resources. Upon failure, the application needs to be able to recover with the transaction manager to determine the final outcome of the transaction, so that it can update permanent data. This type of application is known as a durable source manager. A classic example of this type of application is SQL.  \n  \n To enable recovery, this type of application has the ability to permanently consume system resources. This is because the recoverable transaction manager must remember transactions that have committed until it can confirm that all durable resource managers that are participating in the transaction have received the outcome. Therefore, this type of application requires full trust and should not be run unless that level of trust has been granted.  \n  \n For more information on durable enlistments and recovery, see the [Enlisting Resources as Participants in a Transaction](../../../../docs/framework/data/transactions/enlisting-resources-as-participants-in-a-transaction.md) and [Performing Recovery](../../../../docs/framework/data/transactions/performing-recovery.md) topics.  \n  \n Applications that perform legacy interop work with COM+ are also required to have full trust.  \n  \n The following is a list of types and members that are not callable by partially trusted code because they are decorated with the **FullTrust** declarative security attribute:  \n  \n `PermissionSetAttribute(SecurityAction.LinkDemand, Name := \"FullTrust\")`  \n  \n-   <xref:System.Transactions.Transaction.EnlistDurable%2A?displayProperty=fullName>  \n  \n-   <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A>  \n  \n-   <xref:System.Transactions.TransactionInterop>  \n  \n-   <xref:System.Transactions.TransactionManager.DistributedTransactionStarted>  \n  \n-   <xref:System.Transactions.HostCurrentTransactionCallback>  \n  \n-   <xref:System.Transactions.TransactionManager.Reenlist%2A>  \n  \n-   <xref:System.Transactions.TransactionManager.RecoveryComplete%2A>  \n  \n-   <xref:System.Transactions.TransactionScope.%23ctor%28System.Transactions.TransactionScopeOption%2CSystem.Transactions.TransactionOptions%2CSystem.Transactions.EnterpriseServicesInteropOption%29>  \n  \n Only the immediate caller is required to possess the **FullTrust** permission set to use the above types or methods.","nodes":[{"pos":[12,73],"content":"Security Trust Levels in Accessing Resources | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Security Trust Levels in Accessing Resources | Microsoft Docs","pos":[0,61]}]},{"pos":[338,382],"content":"Security Trust Levels in Accessing Resources","linkify":"Security Trust Levels in Accessing Resources","nodes":[{"content":"Security Trust Levels in Accessing Resources","pos":[0,44]}]},{"content":"This topic discusses how access is restricted on the types of resources that <ph id=\"ph1\">&lt;xref:System.Transactions&gt;</ph> exposes.","pos":[383,495],"source":"This topic discusses how access is restricted on the types of resources that <xref:System.Transactions> exposes."},{"content":"There are three main levels of trust for <ph id=\"ph1\">&lt;xref:System.Transactions&gt;</ph>.","pos":[502,570],"source":"There are three main levels of trust for <xref:System.Transactions>."},{"content":"The trust levels are defined based on the types of resources that <ph id=\"ph1\">&lt;xref:System.Transactions&gt;</ph> exposes, and the level of trust that should be required to access those resources.","pos":[571,746],"source":" The trust levels are defined based on the types of resources that <xref:System.Transactions> exposes, and the level of trust that should be required to access those resources."},{"content":"The resources that <ph id=\"ph1\">&lt;xref:System.Transactions&gt;</ph> provides access to are system memory, shared process wide resources, and system wide resources.","pos":[747,888],"source":" The resources that <xref:System.Transactions> provides access to are system memory, shared process wide resources, and system wide resources."},{"content":"The levels are:","pos":[889,904]},{"pos":[914,1026],"content":"<bpt id=\"p1\">**</bpt>AllowPartiallyTrustedCallers<ept id=\"p1\">**</ept> (APTCA) for applications using transactions within a single application domain.","source":"**AllowPartiallyTrustedCallers** (APTCA) for applications using transactions within a single application domain."},{"pos":[1036,1127],"content":"<bpt id=\"p1\">**</bpt>DistributedTransactionPermission<ept id=\"p1\">**</ept> (DTP) for applications using distributed transactions.","source":"**DistributedTransactionPermission** (DTP) for applications using distributed transactions."},{"content":"Full trust for durable resources, configuration management applications, and legacy interop applications.","pos":[1137,1242]},{"pos":[1250,1341],"content":"[!NOTE]\n You should not call any of the enlistment interfaces with impersonated contexts.","leadings":["","> "],"nodes":[{"content":"You should not call any of the enlistment interfaces with impersonated contexts.","pos":[9,89]}]},{"pos":[1350,1362],"content":"Trust Levels","linkify":"Trust Levels","nodes":[{"content":"Trust Levels","pos":[0,12]}]},{"pos":[1372,1393],"content":"APTCA (Partial Trust)","linkify":"APTCA (Partial Trust)","nodes":[{"content":"APTCA (Partial Trust)","pos":[0,21]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Transactions&gt;</ph> assembly can be called by partially trusted code because it has been marked with the <bpt id=\"p1\">**</bpt>AllowPartiallyTrustedCallers<ept id=\"p1\">**</ept> attribute (APTCA).","pos":[1397,1564],"source":"The <xref:System.Transactions> assembly can be called by partially trusted code because it has been marked with the **AllowPartiallyTrustedCallers** attribute (APTCA)."},{"content":"This attribute essentially removes the implicit <ph id=\"ph1\">&lt;xref:System.Security.Permissions.SecurityAction&gt;</ph> for the <bpt id=\"p1\">**</bpt>FullTrust<ept id=\"p1\">**</ept> permission set that is otherwise automatically placed on each publicly accessible method in each type.","pos":[1565,1787],"source":" This attribute essentially removes the implicit <xref:System.Security.Permissions.SecurityAction> for the **FullTrust** permission set that is otherwise automatically placed on each publicly accessible method in each type."},{"content":"However, some types and members still require stronger permissions.","pos":[1788,1855]},{"content":"The APTCA attribute enables applications to use transactions in partial trust within a single application domain.","pos":[1862,1975]},{"content":"This enables non-escalated transactions and volatile enlistments that can be used for error handling.","pos":[1976,2077]},{"content":"One example of this is a transacted hash table and an application that uses it.","pos":[2078,2157]},{"content":"Data can be added to and removed from the hash table under a single transaction.","pos":[2158,2238]},{"content":"If the transaction is later rolled back, all of the changes made to the hash table under that transaction can be undone.","pos":[2239,2359]},{"pos":[2369,2407],"content":"DistributedTransactionPermission (DTP)","linkify":"DistributedTransactionPermission (DTP)","nodes":[{"content":"DistributedTransactionPermission (DTP)","pos":[0,38]}]},{"content":"When a <ph id=\"ph1\">&lt;xref:System.Transactions&gt;</ph> transaction is escalated to be managed by MSDTC, <ph id=\"ph2\">&lt;xref:System.Transactions&gt;</ph> demands the <ph id=\"ph3\">&lt;xref:System.Transactions.DistributedTransactionPermission&gt;</ph> (DTP) to create the distributed transaction.","pos":[2411,2637],"source":"When a <xref:System.Transactions> transaction is escalated to be managed by MSDTC, <xref:System.Transactions> demands the <xref:System.Transactions.DistributedTransactionPermission> (DTP) to create the distributed transaction."},{"content":"This means that the code that causes the transaction to be escalated (such as through serialization or additional durable enlistments) would need to be granted DTP.","pos":[2638,2802]},{"content":"The code that originally created the <ph id=\"ph1\">&lt;xref:System.Transactions&gt;</ph> transaction does not necessarily need to possess this permission.","pos":[2803,2932],"source":" The code that originally created the <xref:System.Transactions> transaction does not necessarily need to possess this permission."},{"pos":[2942,2964],"content":"FullTrust Link Demands","linkify":"FullTrust Link Demands","nodes":[{"content":"FullTrust Link Demands","pos":[0,22]}]},{"content":"This permission level is intended to restrict applications that are writing to durable resources.","pos":[2968,3065]},{"content":"Upon failure, the application needs to be able to recover with the transaction manager to determine the final outcome of the transaction, so that it can update permanent data.","pos":[3066,3241]},{"content":"This type of application is known as a durable source manager.","pos":[3242,3304]},{"content":"A classic example of this type of application is SQL.","pos":[3305,3358]},{"content":"To enable recovery, this type of application has the ability to permanently consume system resources.","pos":[3365,3466]},{"content":"This is because the recoverable transaction manager must remember transactions that have committed until it can confirm that all durable resource managers that are participating in the transaction have received the outcome.","pos":[3467,3690]},{"content":"Therefore, this type of application requires full trust and should not be run unless that level of trust has been granted.","pos":[3691,3813]},{"pos":[3820,4145],"content":"For more information on durable enlistments and recovery, see the <bpt id=\"p1\">[</bpt>Enlisting Resources as Participants in a Transaction<ept id=\"p1\">](../../../../docs/framework/data/transactions/enlisting-resources-as-participants-in-a-transaction.md)</ept> and <bpt id=\"p2\">[</bpt>Performing Recovery<ept id=\"p2\">](../../../../docs/framework/data/transactions/performing-recovery.md)</ept> topics.","source":"For more information on durable enlistments and recovery, see the [Enlisting Resources as Participants in a Transaction](../../../../docs/framework/data/transactions/enlisting-resources-as-participants-in-a-transaction.md) and [Performing Recovery](../../../../docs/framework/data/transactions/performing-recovery.md) topics."},{"content":"Applications that perform legacy interop work with COM+ are also required to have full trust.","pos":[4152,4245]},{"pos":[4252,4426],"content":"The following is a list of types and members that are not callable by partially trusted code because they are decorated with the <bpt id=\"p1\">**</bpt>FullTrust<ept id=\"p1\">**</ept> declarative security attribute:","source":"The following is a list of types and members that are not callable by partially trusted code because they are decorated with the **FullTrust** declarative security attribute:"},{"pos":[5234,5350],"content":"Only the immediate caller is required to possess the <bpt id=\"p1\">**</bpt>FullTrust<ept id=\"p1\">**</ept> permission set to use the above types or methods.","source":"Only the immediate caller is required to possess the **FullTrust** permission set to use the above types or methods."}]}