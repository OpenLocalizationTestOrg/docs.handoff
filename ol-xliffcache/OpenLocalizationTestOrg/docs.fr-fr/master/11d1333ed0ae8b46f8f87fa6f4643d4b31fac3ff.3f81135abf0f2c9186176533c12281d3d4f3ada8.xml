{"content":"---\ntitle: \"Controlling Resource Consumption and Improving Performance\"\nms.date: \"03/30/2017\"\nms.assetid: 9a829669-5f76-4c88-80ec-92d0c62c0660\n---\n# Controlling Resource Consumption and Improving Performance\nThis topic describes various properties in different areas of the Windows Communication Foundation (WCF) architecture that work to control resource consumption and affect performance metrics.\n\n## Properties that Constrain Resource Consumption in WCF\n Windows Communication Foundation (WCF) applies constraints on certain types of processes for either security or performance purposes. These constraints come in two main forms, either quotas and throttles. *Quotas* are limits that when reached or exceeded trigger an immediate exception at some point in the system. *Throttles* are limits that do not immediately cause an exception to be thrown. Instead, when a throttle limit is reached, processing continues but within the limits set by that throttle value. This limited processing might trigger an exception elsewhere, but this depends upon the application.\n\n In addition to the distinction between quotas and throttles, some constraining properties are located at the serialization level, some at the transport level, and some at the application level. For example, the quota <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A?displayProperty=nameWithType>, which is implemented by all system-supplied transport binding elements, is set to 65,536 bytes by default to hinder malicious clients from engaging in denial-of-service attacks against a service by causing excessive memory consumption. (Typically, you can increase performance by lowering this value.)\n\n An example of a serialization quota is the <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> property, which specifies the maximum number of objects that the serializer serializes or deserializes in a single <xref:System.Runtime.Serialization.DataContractSerializer.ReadObject%2A> method call. An example of an application-level throttle is the <xref:System.ServiceModel.Dispatcher.ServiceThrottle.MaxConcurrentSessions%2A?displayProperty=nameWithType> property, which by default restricts the number of concurrent sessionful channel connections to 10. (Unlike the quotas, if this throttle value is reached, the application continues processing but accepts no new sessionful channels, which means that new clients cannot connect until one of the other sessionful channels is ended.)\n\n These controls are designed to provide an out-of-the-box mitigation against certain types of attacks or to improve performance metrics such as memory footprint, start-up time, and so on. However, depending on the application, these controls can impede service application performance or prevent the application from working at all. For example, an application designed to stream video can easily exceed the default <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A?displayProperty=nameWithType> property. This topic provides an overview of the various controls applied to applications at all levels of WCF, describes various ways to obtain more information about whether a setting is hindering your application, and describes ways to correct various problems. Most throttles and some quotas are available at the application level, even when the base property is a serialization or transport constraint. For example, you can set the <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> property using the <xref:System.ServiceModel.ServiceBehaviorAttribute.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> property on the service class.\n\n> [!NOTE]\n> If you have a particular problem, you should first read the [WCF Troubleshooting Quickstart](../../../docs/framework/wcf/wcf-troubleshooting-quickstart.md) to see whether your problem (and a solution) is listed there.\n\n Properties that restrict serialization processes are listed in [Security Considerations for Data](../../../docs/framework/wcf/feature-details/security-considerations-for-data.md). Properties that restrict the consumption of resources related to transports are listed in [Transport Quotas](../../../docs/framework/wcf/feature-details/transport-quotas.md). Properties that restrict the consumption of resources at the application layer are the members of the <xref:System.ServiceModel.Dispatcher.ServiceThrottle> class.\n\n## Detecting Application and Performance Issues Related to Quota Settings\n The defaults of the preceding values have been chosen to enable basic application functionality across a wide range of application types while providing basic protection against common security issues. However, different application designs might exceed one or more throttle settings although the application otherwise is secure and would work as designed. In these cases, you must identify which throttle values are being exceeded and at what level, and decide on the appropriate course of action to increase application throughput.\n\n Typically, when writing the application and debugging it, you set the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property to `true` in the configuration file or programmatically. This instructs WCF to return service exception stack traces to the client application for viewing. This feature reports most application-level exceptions in such a way as to display which quota settings might be involved, if that is the problem.\n\n Some exceptions happen at run time below the visibility of the application layer and are not returned using this mechanism, and they might not be handled by a custom <xref:System.ServiceModel.Dispatcher.IErrorHandler?displayProperty=nameWithType> implementation. If you are in a development environment like Microsoft Visual Studio, most of these exceptions are displayed automatically. However, some exceptions can be masked by development environment settings such as [Just My Code](/visualstudio/debugger/just-my-code) Visual Studio.\n\n Regardless of the capabilities of your development environment, you can use capabilities of WCF tracing and message logging to debug all exceptions and tune the performance of your applications. For more information, see [Using Tracing to Troubleshoot Your Application](../../../docs/framework/wcf/diagnostics/tracing/using-tracing-to-troubleshoot-your-application.md).\n\n## Performance Issues and XmlSerializer\n Services and client applications that use data types that are serializable using the <xref:System.Xml.Serialization.XmlSerializer> generate and compile serialization code for those data types at run time, which can result in slow start-up performance.\n\n> [!NOTE]\n> Pre-generated serialization code can be used only in client applications and not in services.\n\n The [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) can improve start-up performance for these applications by generating the necessary serialization code from the compiled assemblies for the application. For more information, see [How to: Improve the Startup Time of WCF Client Applications using the XmlSerializer](../../../docs/framework/wcf/feature-details/startup-time-of-wcf-client-applications-using-the-xmlserializer.md).\n\n## Performance Issues When Hosting WCF Services Under ASP.NET\n When a WCF service is hosted under IIS and ASP.NET, the configuration settings of IIS and ASP.NET can affect the throughput and memory footprint of the WCF service.  For more information about ASP.NET performance, see [Improving ASP.NET Performance](https://go.microsoft.com/fwlink/?LinkId=186462).  One setting that might have unintended consequences is <xref:System.Web.Configuration.ProcessModelSection.MinWorkerThreads%2A>, which is a property of the <xref:System.Web.Configuration.ProcessModelSection>. If your application has a fixed or small number of clients, setting <xref:System.Web.Configuration.ProcessModelSection.MinWorkerThreads%2A> to 2 might provide a throughput boost on a multiprocessor machine that has a CPU utilization close to 100%. This increase in performance comes with a cost: it will also cause an increase in memory usage, which could reduce scalability.\n\n## See also\n\n- [Administration and Diagnostics](../../../docs/framework/wcf/diagnostics/index.md)\n- [Large Data and Streaming](../../../docs/framework/wcf/feature-details/large-data-and-streaming.md)\n","nodes":[{"pos":[4,142],"embed":true,"restype":"x-metadata","content":"title: \"Controlling Resource Consumption and Improving Performance\"\nms.date: \"03/30/2017\"\nms.assetid: 9a829669-5f76-4c88-80ec-92d0c62c0660","nodes":[{"content":"Controlling Resource Consumption and Improving Performance","nodes":[{"pos":[0,58],"content":"Controlling Resource Consumption and Improving Performance","nodes":[{"content":"Controlling Resource Consumption and Improving Performance","pos":[0,58]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[149,207],"content":"Controlling Resource Consumption and Improving Performance","linkify":"Controlling Resource Consumption and Improving Performance","nodes":[{"content":"Controlling Resource Consumption and Improving Performance","pos":[0,58]}]},{"content":"This topic describes various properties in different areas of the Windows Communication Foundation (WCF) architecture that work to control resource consumption and affect performance metrics.","pos":[208,399]},{"pos":[404,457],"content":"Properties that Constrain Resource Consumption in WCF","linkify":"Properties that Constrain Resource Consumption in WCF","nodes":[{"content":"Properties that Constrain Resource Consumption in WCF","pos":[0,53]}]},{"content":"Windows Communication Foundation (WCF) applies constraints on certain types of processes for either security or performance purposes.","pos":[459,592]},{"content":"These constraints come in two main forms, either quotas and throttles.","pos":[593,663]},{"content":"<bpt id=\"p1\">*</bpt>Quotas<ept id=\"p1\">*</ept> are limits that when reached or exceeded trigger an immediate exception at some point in the system.","pos":[664,773],"source":"*Quotas* are limits that when reached or exceeded trigger an immediate exception at some point in the system."},{"content":"<bpt id=\"p1\">*</bpt>Throttles<ept id=\"p1\">*</ept> are limits that do not immediately cause an exception to be thrown.","pos":[774,853],"source":"*Throttles* are limits that do not immediately cause an exception to be thrown."},{"content":"Instead, when a throttle limit is reached, processing continues but within the limits set by that throttle value.","pos":[854,967]},{"content":"This limited processing might trigger an exception elsewhere, but this depends upon the application.","pos":[968,1068]},{"content":"In addition to the distinction between quotas and throttles, some constraining properties are located at the serialization level, some at the transport level, and some at the application level.","pos":[1071,1264]},{"content":"For example, the quota <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A?displayProperty=nameWithType&gt;</ph>, which is implemented by all system-supplied transport binding elements, is set to 65,536 bytes by default to hinder malicious clients from engaging in denial-of-service attacks against a service by causing excessive memory consumption.","pos":[1265,1639],"source":" For example, the quota <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A?displayProperty=nameWithType>, which is implemented by all system-supplied transport binding elements, is set to 65,536 bytes by default to hinder malicious clients from engaging in denial-of-service attacks against a service by causing excessive memory consumption."},{"content":"(Typically, you can increase performance by lowering this value.)","pos":[1640,1705]},{"content":"An example of a serialization quota is the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A?displayProperty=nameWithType&gt;</ph> property, which specifies the maximum number of objects that the serializer serializes or deserializes in a single <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.DataContractSerializer.ReadObject%2A&gt;</ph> method call.","pos":[1708,2064],"source":"An example of a serialization quota is the <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> property, which specifies the maximum number of objects that the serializer serializes or deserializes in a single <xref:System.Runtime.Serialization.DataContractSerializer.ReadObject%2A> method call."},{"content":"An example of an application-level throttle is the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Dispatcher.ServiceThrottle.MaxConcurrentSessions%2A?displayProperty=nameWithType&gt;</ph> property, which by default restricts the number of concurrent sessionful channel connections to 10.","pos":[2065,2323],"source":" An example of an application-level throttle is the <xref:System.ServiceModel.Dispatcher.ServiceThrottle.MaxConcurrentSessions%2A?displayProperty=nameWithType> property, which by default restricts the number of concurrent sessionful channel connections to 10."},{"content":"(Unlike the quotas, if this throttle value is reached, the application continues processing but accepts no new sessionful channels, which means that new clients cannot connect until one of the other sessionful channels is ended.)","pos":[2324,2553]},{"content":"These controls are designed to provide an out-of-the-box mitigation against certain types of attacks or to improve performance metrics such as memory footprint, start-up time, and so on.","pos":[2556,2742]},{"content":"However, depending on the application, these controls can impede service application performance or prevent the application from working at all.","pos":[2743,2887]},{"content":"For example, an application designed to stream video can easily exceed the default <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A?displayProperty=nameWithType&gt;</ph> property.","pos":[2888,3095],"source":" For example, an application designed to stream video can easily exceed the default <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A?displayProperty=nameWithType> property."},{"content":"This topic provides an overview of the various controls applied to applications at all levels of WCF, describes various ways to obtain more information about whether a setting is hindering your application, and describes ways to correct various problems.","pos":[3096,3350]},{"content":"Most throttles and some quotas are available at the application level, even when the base property is a serialization or transport constraint.","pos":[3351,3493]},{"content":"For example, you can set the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A?displayProperty=nameWithType&gt;</ph> property using the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.MaxItemsInObjectGraph%2A?displayProperty=nameWithType&gt;</ph> property on the service class.","pos":[3494,3791],"source":" For example, you can set the <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> property using the <xref:System.ServiceModel.ServiceBehaviorAttribute.MaxItemsInObjectGraph%2A?displayProperty=nameWithType> property on the service class."},{"pos":[3795,4022],"content":"[!NOTE]\nIf you have a particular problem, you should first read the [WCF Troubleshooting Quickstart](../../../docs/framework/wcf/wcf-troubleshooting-quickstart.md) to see whether your problem (and a solution) is listed there.","leadings":["","> "],"nodes":[{"content":"If you have a particular problem, you should first read the <bpt id=\"p1\">[</bpt>WCF Troubleshooting Quickstart<ept id=\"p1\">](../../../docs/framework/wcf/wcf-troubleshooting-quickstart.md)</ept> to see whether your problem (and a solution) is listed there.","pos":[8,225],"source":"If you have a particular problem, you should first read the [WCF Troubleshooting Quickstart](../../../docs/framework/wcf/wcf-troubleshooting-quickstart.md) to see whether your problem (and a solution) is listed there."}]},{"content":"Properties that restrict serialization processes are listed in <bpt id=\"p1\">[</bpt>Security Considerations for Data<ept id=\"p1\">](../../../docs/framework/wcf/feature-details/security-considerations-for-data.md)</ept>.","pos":[4025,4204],"source":"Properties that restrict serialization processes are listed in [Security Considerations for Data](../../../docs/framework/wcf/feature-details/security-considerations-for-data.md)."},{"content":"Properties that restrict the consumption of resources related to transports are listed in <bpt id=\"p1\">[</bpt>Transport Quotas<ept id=\"p1\">](../../../docs/framework/wcf/feature-details/transport-quotas.md)</ept>.","pos":[4205,4379],"source":" Properties that restrict the consumption of resources related to transports are listed in [Transport Quotas](../../../docs/framework/wcf/feature-details/transport-quotas.md)."},{"content":"Properties that restrict the consumption of resources at the application layer are the members of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Dispatcher.ServiceThrottle&gt;</ph> class.","pos":[4380,4542],"source":" Properties that restrict the consumption of resources at the application layer are the members of the <xref:System.ServiceModel.Dispatcher.ServiceThrottle> class."},{"pos":[4547,4617],"content":"Detecting Application and Performance Issues Related to Quota Settings","linkify":"Detecting Application and Performance Issues Related to Quota Settings","nodes":[{"content":"Detecting Application and Performance Issues Related to Quota Settings","pos":[0,70]}]},{"content":"The defaults of the preceding values have been chosen to enable basic application functionality across a wide range of application types while providing basic protection against common security issues.","pos":[4619,4820]},{"content":"However, different application designs might exceed one or more throttle settings although the application otherwise is secure and would work as designed.","pos":[4821,4975]},{"content":"In these cases, you must identify which throttle values are being exceeded and at what level, and decide on the appropriate course of action to increase application throughput.","pos":[4976,5152]},{"content":"Typically, when writing the application and debugging it, you set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType&gt;</ph> property to <ph id=\"ph2\">`true`</ph> in the configuration file or programmatically.","pos":[5155,5413],"source":"Typically, when writing the application and debugging it, you set the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property to `true` in the configuration file or programmatically."},{"content":"This instructs WCF to return service exception stack traces to the client application for viewing.","pos":[5414,5512]},{"content":"This feature reports most application-level exceptions in such a way as to display which quota settings might be involved, if that is the problem.","pos":[5513,5659]},{"content":"Some exceptions happen at run time below the visibility of the application layer and are not returned using this mechanism, and they might not be handled by a custom <ph id=\"ph1\">&lt;xref:System.ServiceModel.Dispatcher.IErrorHandler?displayProperty=nameWithType&gt;</ph> implementation.","pos":[5662,5924],"source":"Some exceptions happen at run time below the visibility of the application layer and are not returned using this mechanism, and they might not be handled by a custom <xref:System.ServiceModel.Dispatcher.IErrorHandler?displayProperty=nameWithType> implementation."},{"content":"If you are in a development environment like Microsoft Visual Studio, most of these exceptions are displayed automatically.","pos":[5925,6048]},{"content":"However, some exceptions can be masked by development environment settings such as <bpt id=\"p1\">[</bpt>Just My Code<ept id=\"p1\">](/visualstudio/debugger/just-my-code)</ept> Visual Studio.","pos":[6049,6198],"source":" However, some exceptions can be masked by development environment settings such as [Just My Code](/visualstudio/debugger/just-my-code) Visual Studio."},{"content":"Regardless of the capabilities of your development environment, you can use capabilities of WCF tracing and message logging to debug all exceptions and tune the performance of your applications.","pos":[6201,6395]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Using Tracing to Troubleshoot Your Application<ept id=\"p1\">](../../../docs/framework/wcf/diagnostics/tracing/using-tracing-to-troubleshoot-your-application.md)</ept>.","pos":[6396,6570],"source":" For more information, see [Using Tracing to Troubleshoot Your Application](../../../docs/framework/wcf/diagnostics/tracing/using-tracing-to-troubleshoot-your-application.md)."},{"pos":[6575,6611],"content":"Performance Issues and XmlSerializer","linkify":"Performance Issues and XmlSerializer","nodes":[{"content":"Performance Issues and XmlSerializer","pos":[0,36]}]},{"pos":[6613,6864],"content":"Services and client applications that use data types that are serializable using the <ph id=\"ph1\">&lt;xref:System.Xml.Serialization.XmlSerializer&gt;</ph> generate and compile serialization code for those data types at run time, which can result in slow start-up performance.","source":"Services and client applications that use data types that are serializable using the <xref:System.Xml.Serialization.XmlSerializer> generate and compile serialization code for those data types at run time, which can result in slow start-up performance."},{"pos":[6868,6971],"content":"[!NOTE]\nPre-generated serialization code can be used only in client applications and not in services.","leadings":["","> "],"nodes":[{"content":"Pre-generated serialization code can be used only in client applications and not in services.","pos":[8,101]}]},{"content":"The <bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept> can improve start-up performance for these applications by generating the necessary serialization code from the compiled assemblies for the application.","pos":[6974,7260],"source":"The [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) can improve start-up performance for these applications by generating the necessary serialization code from the compiled assemblies for the application."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>How to: Improve the Startup Time of WCF Client Applications using the XmlSerializer<ept id=\"p1\">](../../../docs/framework/wcf/feature-details/startup-time-of-wcf-client-applications-using-the-xmlserializer.md)</ept>.","pos":[7261,7485],"source":" For more information, see [How to: Improve the Startup Time of WCF Client Applications using the XmlSerializer](../../../docs/framework/wcf/feature-details/startup-time-of-wcf-client-applications-using-the-xmlserializer.md)."},{"pos":[7490,7548],"content":"Performance Issues When Hosting WCF Services Under ASP.NET","linkify":"Performance Issues When Hosting WCF Services Under ASP.NET","nodes":[{"content":"Performance Issues When Hosting WCF Services Under ASP.NET","pos":[0,58]}]},{"content":"When a WCF service is hosted under IIS and ASP.NET, the configuration settings of IIS and ASP.NET can affect the throughput and memory footprint of the WCF service.","pos":[7550,7714]},{"content":"For more information about ASP.NET performance, see <bpt id=\"p1\">[</bpt>Improving ASP.NET Performance<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=186462)</ept>.","pos":[7716,7848],"source":"  For more information about ASP.NET performance, see [Improving ASP.NET Performance](https://go.microsoft.com/fwlink/?LinkId=186462)."},{"content":"One setting that might have unintended consequences is <ph id=\"ph1\">&lt;xref:System.Web.Configuration.ProcessModelSection.MinWorkerThreads%2A&gt;</ph>, which is a property of the <ph id=\"ph2\">&lt;xref:System.Web.Configuration.ProcessModelSection&gt;</ph>.","pos":[7850,8057],"source":"  One setting that might have unintended consequences is <xref:System.Web.Configuration.ProcessModelSection.MinWorkerThreads%2A>, which is a property of the <xref:System.Web.Configuration.ProcessModelSection>."},{"content":"If your application has a fixed or small number of clients, setting <ph id=\"ph1\">&lt;xref:System.Web.Configuration.ProcessModelSection.MinWorkerThreads%2A&gt;</ph> to 2 might provide a throughput boost on a multiprocessor machine that has a CPU utilization close to 100%.","pos":[8058,8305],"source":" If your application has a fixed or small number of clients, setting <xref:System.Web.Configuration.ProcessModelSection.MinWorkerThreads%2A> to 2 might provide a throughput boost on a multiprocessor machine that has a CPU utilization close to 100%."},{"content":"This increase in performance comes with a cost: it will also cause an increase in memory usage, which could reduce scalability.","pos":[8306,8433]},{"pos":[8438,8446],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[8450,8532],"content":"<bpt id=\"p1\">[</bpt>Administration and Diagnostics<ept id=\"p1\">](../../../docs/framework/wcf/diagnostics/index.md)</ept>","source":"[Administration and Diagnostics](../../../docs/framework/wcf/diagnostics/index.md)"},{"pos":[8535,8634],"content":"<bpt id=\"p1\">[</bpt>Large Data and Streaming<ept id=\"p1\">](../../../docs/framework/wcf/feature-details/large-data-and-streaming.md)</ept>","source":"[Large Data and Streaming](../../../docs/framework/wcf/feature-details/large-data-and-streaming.md)"}]}