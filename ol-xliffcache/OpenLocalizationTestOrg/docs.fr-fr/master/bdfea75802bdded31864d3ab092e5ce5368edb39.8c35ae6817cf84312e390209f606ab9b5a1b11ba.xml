{"content":"---\ntitle: \"Routing Scenarios | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"rounting [WCF], scenarios\"\nms.assetid: ec22f308-665a-413e-9f94-7267cb665dab\ncaps.latest.revision: 7\nauthor: \"wadepickett\"\nms.author: \"wpickett\"\nmanager: \"wpickett\"\n---\n# Routing Scenarios\nWhile the Routing Service is highly customizable, it can be a challenge to design efficient routing logic when creating a new configuration from scratch.  However, there are several common scenarios that most Routing Service configurations follow. While these scenarios may not apply directly to your specific configuration, understanding how the Routing Service can be configured to handle these scenarios will aid you in understanding the Routing Service.  \n  \n## Common Scenarios  \n The most basic use of the Routing Service is to aggregate multiple destination endpoints to reduce the number of endpoints exposed to the client applications, and then use message filters to route each message to the correct destination. Messages may be routed based on logical or physical processing requirements, such as a message type that must be processed by a specific service, or based on arbitrary business needs such as providing priority processing of messages from a specific source. The following table lists some of the common scenarios and when they are encountered:  \n  \n|Scenario|Use when|  \n|--------------|--------------|  \n|Service versioning|You need to support multiple versions of a service or may deploy an updated service in the future|  \n|Service data partitioning|You must partition a service across multiple hosts|  \n|Dynamic update|You must dynamically reconfigure routing logic at runtime to handle changing service deployments|  \n|Multicast|You must send one message to multiple endpoints|  \n|Protocol bridging|You receive messages over one transport protocol, and the destination endpoint uses a different protocol|  \n|Error Handling|You need to provide resilience to network outages and communication failures|  \n  \n> [!NOTE]\n>  While many of the scenarios presented are specific to certain business needs or processing requirements, planning to support dynamic updates and utilizing error handling can often be considered as best practices as they allow you to modify routing logic at runtime and recover from transient network and communication failures.  \n  \n### Service Versioning  \n When introducing a new version of a service, you must often maintain the previous version until all clients have transitioned to the new service. This is especially critical if the service is a long-running process that takes days, weeks, or even months to complete. Usually this requires implementing a new endpoint address for the new service while maintaining the original endpoint for the previous version.  \n  \n By using the Routing Service, you can expose one endpoint to receive messages from client applications and then route each message to the correct service version based on the message content. The most basic implementation involves adding a custom header to the message that indicates the version of the service that the message is to be processed by. The Routing Service can use the XPathMessageFilter to inspect each message for the presence of the custom header and route the message to the appropriate destination endpoint.  \n  \n For the steps used to create a service versioning configuration, see [How To: Service Versioning](../../../../docs/framework/wcf/feature-details/how-to-service-versioning.md). For an example of using the XPathMessageFilter to route messages based on a custom header, see the [Advanced Filters](../../../../docs/framework/wcf/samples/advanced-filters.md) sample.  \n  \n### Service Data Partitioning  \n When designing a distributed environment, it is often desirable to spread processing load across multiple computers in order to provide high availability, decrease processing load on individual computers, or to provide dedicated resources for a specific subset of messages. While the Routing Service does not replace a dedicated load balancing solution, its ability to perform content based routing can be used to route otherwise similar messages to specific destinations. For example, you may have a requirement to process messages from a specific client separately from messages received from other clients.  \n  \n For the steps used to create a service data partitioning configuration, see [How To: Service Data Partitioning](../../../../docs/framework/wcf/feature-details/how-to-service-data-partitioning.md). For an example of using filters to partition data based on URL and custom headers, see the [Advanced Filters](../../../../docs/framework/wcf/samples/advanced-filters.md) sample.  \n  \n### Dynamic Routing  \n Often it is desirable to modify the routing configuration to satisfy changing business needs, such as adding a route to a newer version of a service, changing routing criteria, or changing the destination endpoint a specific message that the filter routes to. The Routing Service allows you to do this through the <xref:System.ServiceModel.Routing.RoutingExtension>, which allows you to provide a new RoutingConfiguration during run time. The new configuration takes effect immediately, but only affects any new sessions processed by the Routing Service.  \n  \n For the steps used to implement dynamic routing, see [How To: Dynamic Update](../../../../docs/framework/wcf/feature-details/how-to-dynamic-update.md). For an example of using dynamic routing, see the [Dynamic Reconfiguration](../../../../docs/framework/wcf/samples/dynamic-reconfiguration.md) sample.  \n  \n### Multicast  \n When routing messages, usually you routing each message to one specific destination endpoint.  However, you may occasionally need to route a copy of the message to multiple destination endpoints. To perform multicast routing, the following conditions must be true:  \n  \n-   The channel shape must not be request-reply (though it may be one-way or duplex,) because request-reply mandates that only one reply can be received by the client application in response to the request.  \n  \n-   Multiple filters must return **true** when evaluating the message.  \n  \n If these conditions are met, each destination endpoint that is associated with a filter that returns true will receive a copy of the message.  \n  \n### Protocol Bridging  \n When routing messages between dissimilar SOAP protocols, the Routing Service uses WCF APIs to convert the message from one protocol to the other. This occurs automatically when the service endpoint(s) exposed by the Routing Service use a different protocol than the client endpoint(s) that messages are routed to. It is possible to disable this behavior if the protocols in use are not standard; however, you must then provide your own bridging code.  \n  \n . For an example of using the Routing Service to translate messages between protocols, see the [Bridging and Error Handling](../../../../docs/framework/wcf/samples/bridging-and-error-handling.md) sample.  \n  \n### Error Handling  \n In a distributed environment, it is not uncommon to encounter transient network or communication failures. Without an intermediary service such as the Routing Service, the burden of handling such failures falls on the client application. If the client application does not include specific logic to retry in the event of network or communication failures and knowledge of alternate locations, the user may encounter scenarios where a message must be submitted multiple times before it is successfully processed by the destination service. This can lead to customer dissatisfaction with the application, as it may be perceived as unreliable.  \n  \n The Routing Service attempts to remedy this scenario by providing robust error handling capabilities for messages that encounter network or communication-related failures. By creating a list of possible destination endpoints and associating this list with each message filter, you remove the single point of failure incurred by having only one possible destination. In the event of a failure, the Routing Service will attempt to deliver the message to the next endpoint in the list until the message has been delivered, a non-communication failure occurs, or all endpoints have been exhausted.  \n  \n For the steps used to configure error handling, see [How To: Error Handling](../../../../docs/framework/wcf/feature-details/how-to-error-handling.md). For an example of implementing error handling, see the [Bridging and Error Handling](../../../../docs/framework/wcf/samples/bridging-and-error-handling.md) and [Advanced Error Handling](../../../../docs/framework/wcf/samples/advanced-error-handling.md) samples.  \n  \n### In This Section  \n [How To: Service Versioning](../../../../docs/framework/wcf/feature-details/how-to-service-versioning.md)  \n  \n [How To: Service Data Partitioning](../../../../docs/framework/wcf/feature-details/how-to-service-data-partitioning.md)  \n  \n [How To: Dynamic Update](../../../../docs/framework/wcf/feature-details/how-to-dynamic-update.md)  \n  \n [How To: Error Handling](../../../../docs/framework/wcf/feature-details/how-to-error-handling.md)  \n  \n## See Also  \n [Routing Introduction](../../../../docs/framework/wcf/feature-details/routing-introduction.md)","nodes":[{"pos":[12,46],"content":"Routing Scenarios | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Routing Scenarios | Microsoft Docs","pos":[0,34]}]},{"pos":[407,424],"content":"Routing Scenarios","linkify":"Routing Scenarios","nodes":[{"content":"Routing Scenarios","pos":[0,17]}]},{"content":"While the Routing Service is highly customizable, it can be a challenge to design efficient routing logic when creating a new configuration from scratch.","pos":[425,578]},{"content":"However, there are several common scenarios that most Routing Service configurations follow.","pos":[580,672]},{"content":"While these scenarios may not apply directly to your specific configuration, understanding how the Routing Service can be configured to handle these scenarios will aid you in understanding the Routing Service.","pos":[673,882]},{"pos":[891,907],"content":"Common Scenarios","linkify":"Common Scenarios","nodes":[{"content":"Common Scenarios","pos":[0,16]}]},{"content":"The most basic use of the Routing Service is to aggregate multiple destination endpoints to reduce the number of endpoints exposed to the client applications, and then use message filters to route each message to the correct destination.","pos":[911,1148]},{"content":"Messages may be routed based on logical or physical processing requirements, such as a message type that must be processed by a specific service, or based on arbitrary business needs such as providing priority processing of messages from a specific source.","pos":[1149,1405]},{"content":"The following table lists some of the common scenarios and when they are encountered:","pos":[1406,1491]},{"content":"Scenario","pos":[1498,1506]},{"content":"Use when","pos":[1507,1515]},{"content":"Service versioning","pos":[1554,1572]},{"content":"You need to support multiple versions of a service or may deploy an updated service in the future","pos":[1573,1670]},{"content":"Service data partitioning","pos":[1675,1700]},{"content":"You must partition a service across multiple hosts","pos":[1701,1751]},{"content":"Dynamic update","pos":[1756,1770]},{"content":"You must dynamically reconfigure routing logic at runtime to handle changing service deployments","pos":[1771,1867]},{"content":"Multicast","pos":[1872,1881]},{"content":"You must send one message to multiple endpoints","pos":[1882,1929]},{"content":"Protocol bridging","pos":[1934,1951]},{"content":"You receive messages over one transport protocol, and the destination endpoint uses a different protocol","pos":[1952,2056]},{"content":"Error Handling","pos":[2061,2075]},{"content":"You need to provide resilience to network outages and communication failures","pos":[2076,2152]},{"pos":[2161,2499],"content":"[!NOTE]\n While many of the scenarios presented are specific to certain business needs or processing requirements, planning to support dynamic updates and utilizing error handling can often be considered as best practices as they allow you to modify routing logic at runtime and recover from transient network and communication failures.","leadings":["","> "],"nodes":[{"content":"While many of the scenarios presented are specific to certain business needs or processing requirements, planning to support dynamic updates and utilizing error handling can often be considered as best practices as they allow you to modify routing logic at runtime and recover from transient network and communication failures.","pos":[9,336]}]},{"pos":[2509,2527],"content":"Service Versioning","linkify":"Service Versioning","nodes":[{"content":"Service Versioning","pos":[0,18]}]},{"content":"When introducing a new version of a service, you must often maintain the previous version until all clients have transitioned to the new service.","pos":[2531,2676]},{"content":"This is especially critical if the service is a long-running process that takes days, weeks, or even months to complete.","pos":[2677,2797]},{"content":"Usually this requires implementing a new endpoint address for the new service while maintaining the original endpoint for the previous version.","pos":[2798,2941]},{"content":"By using the Routing Service, you can expose one endpoint to receive messages from client applications and then route each message to the correct service version based on the message content.","pos":[2948,3139]},{"content":"The most basic implementation involves adding a custom header to the message that indicates the version of the service that the message is to be processed by.","pos":[3140,3298]},{"content":"The Routing Service can use the XPathMessageFilter to inspect each message for the presence of the custom header and route the message to the appropriate destination endpoint.","pos":[3299,3474]},{"content":"For the steps used to create a service versioning configuration, see <bpt id=\"p1\">[</bpt>How To: Service Versioning<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-service-versioning.md)</ept>.","pos":[3481,3656],"source":"For the steps used to create a service versioning configuration, see [How To: Service Versioning](../../../../docs/framework/wcf/feature-details/how-to-service-versioning.md)."},{"content":"For an example of using the XPathMessageFilter to route messages based on a custom header, see the <bpt id=\"p1\">[</bpt>Advanced Filters<ept id=\"p1\">](../../../../docs/framework/wcf/samples/advanced-filters.md)</ept> sample.","pos":[3657,3842],"source":" For an example of using the XPathMessageFilter to route messages based on a custom header, see the [Advanced Filters](../../../../docs/framework/wcf/samples/advanced-filters.md) sample."},{"pos":[3852,3877],"content":"Service Data Partitioning","linkify":"Service Data Partitioning","nodes":[{"content":"Service Data Partitioning","pos":[0,25]}]},{"content":"When designing a distributed environment, it is often desirable to spread processing load across multiple computers in order to provide high availability, decrease processing load on individual computers, or to provide dedicated resources for a specific subset of messages.","pos":[3881,4154]},{"content":"While the Routing Service does not replace a dedicated load balancing solution, its ability to perform content based routing can be used to route otherwise similar messages to specific destinations.","pos":[4155,4353]},{"content":"For example, you may have a requirement to process messages from a specific client separately from messages received from other clients.","pos":[4354,4490]},{"content":"For the steps used to create a service data partitioning configuration, see <bpt id=\"p1\">[</bpt>How To: Service Data Partitioning<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-service-data-partitioning.md)</ept>.","pos":[4497,4693],"source":"For the steps used to create a service data partitioning configuration, see [How To: Service Data Partitioning](../../../../docs/framework/wcf/feature-details/how-to-service-data-partitioning.md)."},{"content":"For an example of using filters to partition data based on URL and custom headers, see the <bpt id=\"p1\">[</bpt>Advanced Filters<ept id=\"p1\">](../../../../docs/framework/wcf/samples/advanced-filters.md)</ept> sample.","pos":[4694,4871],"source":" For an example of using filters to partition data based on URL and custom headers, see the [Advanced Filters](../../../../docs/framework/wcf/samples/advanced-filters.md) sample."},{"pos":[4881,4896],"content":"Dynamic Routing","linkify":"Dynamic Routing","nodes":[{"content":"Dynamic Routing","pos":[0,15]}]},{"content":"Often it is desirable to modify the routing configuration to satisfy changing business needs, such as adding a route to a newer version of a service, changing routing criteria, or changing the destination endpoint a specific message that the filter routes to.","pos":[4900,5159]},{"content":"The Routing Service allows you to do this through the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Routing.RoutingExtension&gt;</ph>, which allows you to provide a new RoutingConfiguration during run time.","pos":[5160,5338],"source":" The Routing Service allows you to do this through the <xref:System.ServiceModel.Routing.RoutingExtension>, which allows you to provide a new RoutingConfiguration during run time."},{"content":"The new configuration takes effect immediately, but only affects any new sessions processed by the Routing Service.","pos":[5339,5454]},{"content":"For the steps used to implement dynamic routing, see <bpt id=\"p1\">[</bpt>How To: Dynamic Update<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-dynamic-update.md)</ept>.","pos":[5461,5612],"source":"For the steps used to implement dynamic routing, see [How To: Dynamic Update](../../../../docs/framework/wcf/feature-details/how-to-dynamic-update.md)."},{"content":"For an example of using dynamic routing, see the <bpt id=\"p1\">[</bpt>Dynamic Reconfiguration<ept id=\"p1\">](../../../../docs/framework/wcf/samples/dynamic-reconfiguration.md)</ept> sample.","pos":[5613,5762],"source":" For an example of using dynamic routing, see the [Dynamic Reconfiguration](../../../../docs/framework/wcf/samples/dynamic-reconfiguration.md) sample."},{"pos":[5772,5781],"content":"Multicast","linkify":"Multicast","nodes":[{"content":"Multicast","pos":[0,9]}]},{"content":"When routing messages, usually you routing each message to one specific destination endpoint.","pos":[5785,5878]},{"content":"However, you may occasionally need to route a copy of the message to multiple destination endpoints.","pos":[5880,5980]},{"content":"To perform multicast routing, the following conditions must be true:","pos":[5981,6049]},{"content":"The channel shape must not be request-reply (though it may be one-way or duplex,) because request-reply mandates that only one reply can be received by the client application in response to the request.","pos":[6059,6261]},{"pos":[6271,6337],"content":"Multiple filters must return <bpt id=\"p1\">**</bpt>true<ept id=\"p1\">**</ept> when evaluating the message.","source":"Multiple filters must return **true** when evaluating the message."},{"content":"If these conditions are met, each destination endpoint that is associated with a filter that returns true will receive a copy of the message.","pos":[6344,6485]},{"pos":[6495,6512],"content":"Protocol Bridging","linkify":"Protocol Bridging","nodes":[{"content":"Protocol Bridging","pos":[0,17]}]},{"content":"When routing messages between dissimilar SOAP protocols, the Routing Service uses WCF APIs to convert the message from one protocol to the other.","pos":[6516,6661]},{"content":"This occurs automatically when the service endpoint(s) exposed by the Routing Service use a different protocol than the client endpoint(s) that messages are routed to.","pos":[6662,6829]},{"content":"It is possible to disable this behavior if the protocols in use are not standard; however, you must then provide your own bridging code.","pos":[6830,6966]},{"content":".","pos":[6973,6974]},{"content":"For an example of using the Routing Service to translate messages between protocols, see the <bpt id=\"p1\">[</bpt>Bridging and Error Handling<ept id=\"p1\">](../../../../docs/framework/wcf/samples/bridging-and-error-handling.md)</ept> sample.","pos":[6975,7176],"source":" For an example of using the Routing Service to translate messages between protocols, see the [Bridging and Error Handling](../../../../docs/framework/wcf/samples/bridging-and-error-handling.md) sample."},{"pos":[7186,7200],"content":"Error Handling","linkify":"Error Handling","nodes":[{"content":"Error Handling","pos":[0,14]}]},{"content":"In a distributed environment, it is not uncommon to encounter transient network or communication failures.","pos":[7204,7310]},{"content":"Without an intermediary service such as the Routing Service, the burden of handling such failures falls on the client application.","pos":[7311,7441]},{"content":"If the client application does not include specific logic to retry in the event of network or communication failures and knowledge of alternate locations, the user may encounter scenarios where a message must be submitted multiple times before it is successfully processed by the destination service.","pos":[7442,7742]},{"content":"This can lead to customer dissatisfaction with the application, as it may be perceived as unreliable.","pos":[7743,7844]},{"content":"The Routing Service attempts to remedy this scenario by providing robust error handling capabilities for messages that encounter network or communication-related failures.","pos":[7851,8022]},{"content":"By creating a list of possible destination endpoints and associating this list with each message filter, you remove the single point of failure incurred by having only one possible destination.","pos":[8023,8216]},{"content":"In the event of a failure, the Routing Service will attempt to deliver the message to the next endpoint in the list until the message has been delivered, a non-communication failure occurs, or all endpoints have been exhausted.","pos":[8217,8444]},{"content":"For the steps used to configure error handling, see <bpt id=\"p1\">[</bpt>How To: Error Handling<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-error-handling.md)</ept>.","pos":[8451,8601],"source":"For the steps used to configure error handling, see [How To: Error Handling](../../../../docs/framework/wcf/feature-details/how-to-error-handling.md)."},{"content":"For an example of implementing error handling, see the <bpt id=\"p1\">[</bpt>Bridging and Error Handling<ept id=\"p1\">](../../../../docs/framework/wcf/samples/bridging-and-error-handling.md)</ept> and <bpt id=\"p2\">[</bpt>Advanced Error Handling<ept id=\"p2\">](../../../../docs/framework/wcf/samples/advanced-error-handling.md)</ept> samples.","pos":[8602,8863],"source":" For an example of implementing error handling, see the [Bridging and Error Handling](../../../../docs/framework/wcf/samples/bridging-and-error-handling.md) and [Advanced Error Handling](../../../../docs/framework/wcf/samples/advanced-error-handling.md) samples."},{"pos":[8873,8888],"content":"In This Section","linkify":"In This Section","nodes":[{"content":"In This Section","pos":[0,15]}]},{"pos":[8892,8997],"content":"<bpt id=\"p1\">[</bpt>How To: Service Versioning<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-service-versioning.md)</ept>","source":"[How To: Service Versioning](../../../../docs/framework/wcf/feature-details/how-to-service-versioning.md)"},{"pos":[9004,9123],"content":"<bpt id=\"p1\">[</bpt>How To: Service Data Partitioning<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-service-data-partitioning.md)</ept>","source":"[How To: Service Data Partitioning](../../../../docs/framework/wcf/feature-details/how-to-service-data-partitioning.md)"},{"pos":[9130,9227],"content":"<bpt id=\"p1\">[</bpt>How To: Dynamic Update<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-dynamic-update.md)</ept>","source":"[How To: Dynamic Update](../../../../docs/framework/wcf/feature-details/how-to-dynamic-update.md)"},{"pos":[9234,9331],"content":"<bpt id=\"p1\">[</bpt>How To: Error Handling<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-error-handling.md)</ept>","source":"[How To: Error Handling](../../../../docs/framework/wcf/feature-details/how-to-error-handling.md)"},{"pos":[9340,9348],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[9352,9446],"content":"<bpt id=\"p1\">[</bpt>Routing Introduction<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/routing-introduction.md)</ept>","source":"[Routing Introduction](../../../../docs/framework/wcf/feature-details/routing-introduction.md)"}]}