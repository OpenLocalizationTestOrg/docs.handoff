{"content":"---\ntitle: \"How to: Host a WCF Service in a Managed Windows Service | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 8e37363b-4dad-4fb6-907f-73c30fac1d9a\ncaps.latest.revision: 21\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# How to: Host a WCF Service in a Managed Windows Service\nThis topic outlines the basic steps required to create a [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] service that is hosted by a Windows Service. The scenario is enabled by the managed Windows service hosting option that is a long-running [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service hosted outside of Internet Information Services (IIS) in a secure environment that is not message activated. The lifetime of the service is controlled instead by the operating system. This hosting option is available in all versions of Windows.  \n  \n Windows services can be managed with the Microsoft.ManagementConsole.SnapIn in Microsoft Management Console (MMC) and can be configured to start up automatically when the system boots up. This hosting option consists of registering the application domain (AppDomain) that hosts a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service as a managed Windows service so that the process lifetime of the service is controlled by the Service Control Manager (SCM) for Windows services.  \n  \n The service code includes a service implementation of the service contract, a Windows Service class, and an installer class. The service implementation class, `CalculatorService`, is a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service. The `CalculatorWindowsService` is a Windows service. To qualify as a Windows service, the class inherits from `ServiceBase` and implements the `OnStart` and `OnStop` methods. In `OnStart`, a <xref:System.ServiceModel.ServiceHost> is created for the `CalculatorService` type and opened. In `OnStop`, the service is stopped and disposed. The host is also responsible for providing a base address to the service host, which has been configured in application settings. The installer class, which inherits from <xref:System.Configuration.Install.Installer>, allows the program to be installed as a Windows service by the Installutil.exe tool.  \n  \n### Construct the service and provide the hosting code  \n  \n1.  Create a new Visual Studio Console Application project called \"Service\".  \n  \n2.  Rename Program.cs to Service.cs.  \n  \n3.  Change the namespace to Microsoft.ServiceModel.Samples.  \n  \n4.  Add references to the following assemblies.  \n  \n    -   System.ServiceModel.dll  \n  \n    -   System.ServiceProcess.dll  \n  \n    -   System.Configuration.Install.dll  \n  \n5.  Add the following using statements to Service.cs.  \n  \n     [!code-csharp[c_HowTo_HostInNTService#0](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#0)]\n     [!code-vb[c_HowTo_HostInNTService#0](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#0)]  \n  \n6.  Define the `ICalculator` service contract as shown in the following code.  \n  \n     [!code-csharp[c_HowTo_HostInNTService#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#1)]\n     [!code-vb[c_HowTo_HostInNTService#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#1)]  \n  \n7.  Implement the service contract in a class called `CalculatorService` as shown in the following code.  \n  \n     [!code-csharp[c_HowTo_HostInNTService#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#2)]\n     [!code-vb[c_HowTo_HostInNTService#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#2)]  \n  \n8.  Create a new class called `CalculatorWindowsService` that inherits from the <xref:System.ServiceProcess.ServiceBase> class. Add a local variable called `serviceHost` to reference the <xref:System.ServiceModel.ServiceHost> instance. Define the `Main` method that calls `ServiceBase.Run(new CalculatorWindowsService)`  \n  \n     [!code-csharp[c_HowTo_HostInNTService#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#3)]\n     [!code-vb[c_HowTo_HostInNTService#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#3)]  \n  \n9. Override the <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> method by creating and opening a new <xref:System.ServiceModel.ServiceHost> instance as shown in the following code.  \n  \n     [!code-csharp[c_HowTo_HostInNTService#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#4)]\n     [!code-vb[c_HowTo_HostInNTService#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#4)]  \n  \n10. Override the <xref:System.ServiceProcess.ServiceBase.OnStop%2A> method closing the <xref:System.ServiceModel.ServiceHost> as shown in the following code.  \n  \n     [!code-csharp[c_HowTo_HostInNTService#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#5)]\n     [!code-vb[c_HowTo_HostInNTService#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#5)]  \n  \n11. Create a new class called `ProjectInstaller` that inherits from <xref:System.Configuration.Install.Installer> and that is marked with the <xref:System.ComponentModel.RunInstallerAttribute> set to `true`. This allows the Windows service to be installed by the Installutil.exe tool.  \n  \n     [!code-csharp[c_HowTo_HostInNTService#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#6)]\n     [!code-vb[c_HowTo_HostInNTService#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#6)]  \n  \n12. Remove the `Service` class that was generated when you created the project.  \n  \n13. Add an application configuration file to the project. Replace the contents of the file with the following configuration XML.  \n  \n    ```xml  \n    <?xml version=\"1.0\" encoding=\"utf-8\" ?>  \n    <configuration>  \n      <system.serviceModel>    <services>  \n          <!-- This section is optional with the new configuration model  \n               introduced in .NET Framework 4. -->  \n          <service name=\"Microsoft.ServiceModel.Samples.CalculatorService\"  \n                   behaviorConfiguration=\"CalculatorServiceBehavior\">  \n            <host>  \n              <baseAddresses>  \n                <add baseAddress=\"http://localhost:8000/ServiceModelSamples/service\"/>  \n              </baseAddresses>  \n            </host>  \n            <!-- this endpoint is exposed at the base address provided by host: http://localhost:8000/ServiceModelSamples/service  -->  \n            <endpoint address=\"\"  \n                      binding=\"wsHttpBinding\"  \n                      contract=\"Microsoft.ServiceModel.Samples.ICalculator\" />  \n            <!-- the mex endpoint is exposed at http://localhost:8000/ServiceModelSamples/service/mex -->  \n            <endpoint address=\"mex\"  \n                      binding=\"mexHttpBinding\"  \n                      contract=\"IMetadataExchange\" />  \n          </service>  \n        </services>  \n        <behaviors>  \n          <serviceBehaviors>  \n            <behavior name=\"CalculatorServiceBehavior\">  \n              <serviceMetadata httpGetEnabled=\"true\"/>  \n              <serviceDebug includeExceptionDetailInFaults=\"False\"/>  \n            </behavior>  \n          </serviceBehaviors>  \n        </behaviors>  \n      </system.serviceModel>  \n    </configuration>  \n    ```  \n  \n     Right click the App.config file in the **Solution Explorer** and select **Properties**. Under **Copy to Output Directory** select **Copy if Newer**.  \n  \n     This example explicitly specifies endpoints in the configuration file. If you do not add any endpoints to the service, the runtime adds default endpoints for you. In this example, because the service has a <xref:System.ServiceModel.Description.ServiceMetadataBehavior> set to `true`, your service also has publishing metadata enabled. [!INCLUDE[crabout](../../../../includes/crabout-md.md)]default endpoints, bindings, and behaviors, see [Simplified Configuration](../../../../docs/framework/wcf/simplified-configuration.md) and [Simplified Configuration for WCF Services](../../../../docs/framework/wcf/samples/simplified-configuration-for-wcf-services.md).  \n  \n### Install and run the service  \n  \n1.  Build the solution to create the `Service.exe` executable.  \n  \n2.  Open the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] command prompt and navigate to the project directory. Type `installutil bin\\service.exe` at the command prompt to install the Windows service.  \n  \n    > [!NOTE]\n    >  If you do not use the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] command prompt, make sure that the `%WinDir%\\Microsoft.NET\\Framework\\v4.0.<current version>` directory is in the system path.  \n  \n     Type `services.msc` at the command prompt to access the Service Control Manager (SCM). The Windows service should appear in Services as \"WCFWindowsServiceSample\". The [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service can only respond to clients if the Windows service is running. To start the service, right-click it in the SCM and select \"Start\", or type **net start WCFWindowsServiceSample** at the command prompt.  \n  \n3.  If you make changes to the service, you must first stop it and uninstall it. To stop the service, right-click the service in the SCM and select \"Stop\", or **type net stop WCFWindowsServiceSample** at the command prompt. Note that if you stop the Windows service and then run a client, an <xref:System.ServiceModel.EndpointNotFoundException> exception occurs when a client attempts to access the service. To uninstall the Windows service type **installutil /u bin\\service.exe** at the command prompt.  \n  \n## Example  \n The following is a complete listing of the code used by this topic.  \n  \n [!code-csharp[c_HowTo_HostInNTService#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#8)]\n [!code-vb[c_HowTo_HostInNTService#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#8)]  \n  \n Like the \"Self-Hosting\" option, the Windows service hosting environment requires that some hosting code be written as part of the application. The service is implemented as a console application and contains its own hosting code. In other hosting environments, such as Windows Process Activation Service (WAS) hosting in Internet Information Services (IIS), it is not necessary for developers to write hosting code.  \n  \n## See Also  \n [Simplified Configuration](../../../../docs/framework/wcf/simplified-configuration.md)   \n [Hosting in a Managed Application](../../../../docs/framework/wcf/feature-details/hosting-in-a-managed-application.md)   \n [Hosting Services](../../../../docs/framework/wcf/hosting-services.md)   \n [Windows Server App Fabric Hosting Features](http://go.microsoft.com/fwlink/?LinkId=201276)","nodes":[{"pos":[4,376],"embed":true,"restype":"x-metadata","content":"title: \"How to: Host a WCF Service in a Managed Windows Service | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 8e37363b-4dad-4fb6-907f-73c30fac1d9a\ncaps.latest.revision: 21\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"","nodes":[{"content":"How to: Host a WCF Service in a Managed Windows Service | Microsoft Docs","nodes":[{"pos":[0,72],"content":"How to: Host a WCF Service in a Managed Windows Service | Microsoft Docs","nodes":[{"content":"How to: Host a WCF Service in a Managed Windows Service | Microsoft Docs","pos":[0,72]}]}],"path":["title"]}],"yml":true},{"pos":[383,438],"content":"How to: Host a WCF Service in a Managed Windows Service","linkify":"How to: Host a WCF Service in a Managed Windows Service","nodes":[{"content":"How to: Host a WCF Service in a Managed Windows Service","pos":[0,55]}]},{"content":"This topic outlines the basic steps required to create a <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> service that is hosted by a Windows Service.","pos":[439,596],"source":"This topic outlines the basic steps required to create a [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] service that is hosted by a Windows Service."},{"content":"The scenario is enabled by the managed Windows service hosting option that is a long-running <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> service hosted outside of Internet Information Services (IIS) in a secure environment that is not message activated.","pos":[597,862],"source":" The scenario is enabled by the managed Windows service hosting option that is a long-running [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service hosted outside of Internet Information Services (IIS) in a secure environment that is not message activated."},{"content":"The lifetime of the service is controlled instead by the operating system.","pos":[863,937]},{"content":"This hosting option is available in all versions of Windows.","pos":[938,998]},{"content":"Windows services can be managed with the Microsoft.ManagementConsole.SnapIn in Microsoft Management Console (MMC) and can be configured to start up automatically when the system boots up.","pos":[1005,1192]},{"content":"This hosting option consists of registering the application domain (AppDomain) that hosts a <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> service as a managed Windows service so that the process lifetime of the service is controlled by the Service Control Manager (SCM) for Windows services.","pos":[1193,1494],"source":" This hosting option consists of registering the application domain (AppDomain) that hosts a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service as a managed Windows service so that the process lifetime of the service is controlled by the Service Control Manager (SCM) for Windows services."},{"content":"The service code includes a service implementation of the service contract, a Windows Service class, and an installer class.","pos":[1501,1625]},{"content":"The service implementation class, <ph id=\"ph1\">`CalculatorService`</ph>, is a <ph id=\"ph2\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> service.","pos":[1626,1750],"source":" The service implementation class, `CalculatorService`, is a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service."},{"content":"The <ph id=\"ph1\">`CalculatorWindowsService`</ph> is a Windows service.","pos":[1751,1803],"source":" The `CalculatorWindowsService` is a Windows service."},{"content":"To qualify as a Windows service, the class inherits from <ph id=\"ph1\">`ServiceBase`</ph> and implements the <ph id=\"ph2\">`OnStart`</ph> and <ph id=\"ph3\">`OnStop`</ph> methods.","pos":[1804,1925],"source":" To qualify as a Windows service, the class inherits from `ServiceBase` and implements the `OnStart` and `OnStop` methods."},{"content":"In <ph id=\"ph1\">`OnStart`</ph>, a <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> is created for the <ph id=\"ph3\">`CalculatorService`</ph> type and opened.","pos":[1926,2036],"source":" In `OnStart`, a <xref:System.ServiceModel.ServiceHost> is created for the `CalculatorService` type and opened."},{"content":"In <ph id=\"ph1\">`OnStop`</ph>, the service is stopped and disposed.","pos":[2037,2086],"source":" In `OnStop`, the service is stopped and disposed."},{"content":"The host is also responsible for providing a base address to the service host, which has been configured in application settings.","pos":[2087,2216]},{"content":"The installer class, which inherits from <ph id=\"ph1\">&lt;xref:System.Configuration.Install.Installer&gt;</ph>, allows the program to be installed as a Windows service by the Installutil.exe tool.","pos":[2217,2389],"source":" The installer class, which inherits from <xref:System.Configuration.Install.Installer>, allows the program to be installed as a Windows service by the Installutil.exe tool."},{"pos":[2399,2449],"content":"Construct the service and provide the hosting code","linkify":"Construct the service and provide the hosting code","nodes":[{"content":"Construct the service and provide the hosting code","pos":[0,50]}]},{"content":"Create a new Visual Studio Console Application project called \"Service\".","pos":[2459,2531]},{"content":"Rename Program.cs to Service.cs.","pos":[2541,2573]},{"content":"Change the namespace to Microsoft.ServiceModel.Samples.","pos":[2583,2638]},{"content":"Add references to the following assemblies.","pos":[2648,2691]},{"content":"System.ServiceModel.dll","pos":[2705,2728]},{"content":"System.ServiceProcess.dll","pos":[2742,2767]},{"content":"System.Configuration.Install.dll","pos":[2781,2813]},{"content":"Add the following using statements to Service.cs.","pos":[2823,2872]},{"pos":[2883,3158],"content":"[!code-csharp[c_HowTo_HostInNTService#0](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#0)]\n [!code-vb[c_HowTo_HostInNTService#0](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#0)]","leadings":["","    "],"nodes":[{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_HowTo_HostInNTService#0<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#0)</ept><ept id=\"p1\">]</ept>","pos":[0,134],"source":"[!code-csharp[c_HowTo_HostInNTService#0](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#0)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>c_HowTo_HostInNTService#0<ept id=\"p2\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#0)</ept><ept id=\"p1\">]</ept>","pos":[136,271],"source":"[!code-vb[c_HowTo_HostInNTService#0](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#0)]"}]},{"pos":[3168,3241],"content":"Define the <ph id=\"ph1\">`ICalculator`</ph> service contract as shown in the following code.","source":"Define the `ICalculator` service contract as shown in the following code."},{"pos":[3252,3527],"content":"[!code-csharp[c_HowTo_HostInNTService#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#1)]\n [!code-vb[c_HowTo_HostInNTService#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#1)]","leadings":["","    "],"nodes":[{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_HowTo_HostInNTService#1<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#1)</ept><ept id=\"p1\">]</ept>","pos":[0,134],"source":"[!code-csharp[c_HowTo_HostInNTService#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#1)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>c_HowTo_HostInNTService#1<ept id=\"p2\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#1)</ept><ept id=\"p1\">]</ept>","pos":[136,271],"source":"[!code-vb[c_HowTo_HostInNTService#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#1)]"}]},{"pos":[3537,3637],"content":"Implement the service contract in a class called <ph id=\"ph1\">`CalculatorService`</ph> as shown in the following code.","source":"Implement the service contract in a class called `CalculatorService` as shown in the following code."},{"pos":[3648,3923],"content":"[!code-csharp[c_HowTo_HostInNTService#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#2)]\n [!code-vb[c_HowTo_HostInNTService#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#2)]","leadings":["","    "],"nodes":[{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_HowTo_HostInNTService#2<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#2)</ept><ept id=\"p1\">]</ept>","pos":[0,134],"source":"[!code-csharp[c_HowTo_HostInNTService#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#2)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>c_HowTo_HostInNTService#2<ept id=\"p2\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#2)</ept><ept id=\"p1\">]</ept>","pos":[136,271],"source":"[!code-vb[c_HowTo_HostInNTService#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#2)]"}]},{"content":"Create a new class called <ph id=\"ph1\">`CalculatorWindowsService`</ph> that inherits from the <ph id=\"ph2\">&lt;xref:System.ServiceProcess.ServiceBase&gt;</ph> class.","pos":[3933,4056],"source":"Create a new class called `CalculatorWindowsService` that inherits from the <xref:System.ServiceProcess.ServiceBase> class."},{"content":"Add a local variable called <ph id=\"ph1\">`serviceHost`</ph> to reference the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> instance.","pos":[4057,4164],"source":" Add a local variable called `serviceHost` to reference the <xref:System.ServiceModel.ServiceHost> instance."},{"content":"Define the <ph id=\"ph1\">`Main`</ph> method that calls <ph id=\"ph2\">`ServiceBase.Run(new CalculatorWindowsService)`</ph>","pos":[4165,4248],"source":" Define the `Main` method that calls `ServiceBase.Run(new CalculatorWindowsService)`"},{"pos":[4259,4534],"content":"[!code-csharp[c_HowTo_HostInNTService#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#3)]\n [!code-vb[c_HowTo_HostInNTService#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#3)]","leadings":["","    "],"nodes":[{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_HowTo_HostInNTService#3<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#3)</ept><ept id=\"p1\">]</ept>","pos":[0,134],"source":"[!code-csharp[c_HowTo_HostInNTService#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#3)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>c_HowTo_HostInNTService#3<ept id=\"p2\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#3)</ept><ept id=\"p1\">]</ept>","pos":[136,271],"source":"[!code-vb[c_HowTo_HostInNTService#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#3)]"}]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29&gt;</ph> method by creating and opening a new <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> instance as shown in the following code.","pos":[4543,4746],"source":"Override the <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> method by creating and opening a new <xref:System.ServiceModel.ServiceHost> instance as shown in the following code."},{"pos":[4757,5032],"content":"[!code-csharp[c_HowTo_HostInNTService#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#4)]\n  [!code-vb[c_HowTo_HostInNTService#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#4)]","leadings":["","   "],"nodes":[{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_HowTo_HostInNTService#4<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#4)</ept><ept id=\"p1\">]</ept>","pos":[0,134],"source":"[!code-csharp[c_HowTo_HostInNTService#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#4)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>c_HowTo_HostInNTService#4<ept id=\"p2\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#4)</ept><ept id=\"p1\">]</ept>","pos":[137,272],"source":"[!code-vb[c_HowTo_HostInNTService#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#4)]"}]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceProcess.ServiceBase.OnStop%2A&gt;</ph> method closing the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> as shown in the following code.","pos":[5042,5195],"source":"Override the <xref:System.ServiceProcess.ServiceBase.OnStop%2A> method closing the <xref:System.ServiceModel.ServiceHost> as shown in the following code."},{"pos":[5206,5481],"content":"[!code-csharp[c_HowTo_HostInNTService#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#5)]\n [!code-vb[c_HowTo_HostInNTService#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#5)]","leadings":["","    "],"nodes":[{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_HowTo_HostInNTService#5<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#5)</ept><ept id=\"p1\">]</ept>","pos":[0,134],"source":"[!code-csharp[c_HowTo_HostInNTService#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#5)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>c_HowTo_HostInNTService#5<ept id=\"p2\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#5)</ept><ept id=\"p1\">]</ept>","pos":[136,271],"source":"[!code-vb[c_HowTo_HostInNTService#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#5)]"}]},{"content":"Create a new class called <ph id=\"ph1\">`ProjectInstaller`</ph> that inherits from <ph id=\"ph2\">&lt;xref:System.Configuration.Install.Installer&gt;</ph> and that is marked with the <ph id=\"ph3\">&lt;xref:System.ComponentModel.RunInstallerAttribute&gt;</ph> set to <ph id=\"ph4\">`true`</ph>.","pos":[5491,5694],"source":"Create a new class called `ProjectInstaller` that inherits from <xref:System.Configuration.Install.Installer> and that is marked with the <xref:System.ComponentModel.RunInstallerAttribute> set to `true`."},{"content":"This allows the Windows service to be installed by the Installutil.exe tool.","pos":[5695,5771]},{"pos":[5782,6057],"content":"[!code-csharp[c_HowTo_HostInNTService#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#6)]\n [!code-vb[c_HowTo_HostInNTService#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#6)]","leadings":["","    "],"nodes":[{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_HowTo_HostInNTService#6<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#6)</ept><ept id=\"p1\">]</ept>","pos":[0,134],"source":"[!code-csharp[c_HowTo_HostInNTService#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#6)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>c_HowTo_HostInNTService#6<ept id=\"p2\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#6)</ept><ept id=\"p1\">]</ept>","pos":[136,271],"source":"[!code-vb[c_HowTo_HostInNTService#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#6)]"}]},{"pos":[6067,6142],"content":"Remove the <ph id=\"ph1\">`Service`</ph> class that was generated when you created the project.","source":"Remove the `Service` class that was generated when you created the project."},{"content":"Add an application configuration file to the project.","pos":[6152,6205]},{"content":"Replace the contents of the file with the following configuration XML.","pos":[6206,6276]},{"content":"Right click the App.config file in the <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>.","pos":[7870,7957],"source":"Right click the App.config file in the **Solution Explorer** and select **Properties**."},{"content":"Under <bpt id=\"p1\">**</bpt>Copy to Output Directory<ept id=\"p1\">**</ept> select <bpt id=\"p2\">**</bpt>Copy if Newer<ept id=\"p2\">**</ept>.","pos":[7958,8018],"source":" Under **Copy to Output Directory** select **Copy if Newer**."},{"content":"This example explicitly specifies endpoints in the configuration file.","pos":[8029,8099]},{"content":"If you do not add any endpoints to the service, the runtime adds default endpoints for you.","pos":[8100,8191]},{"content":"In this example, because the service has a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceMetadataBehavior&gt;</ph> set to <ph id=\"ph2\">`true`</ph>, your service also has publishing metadata enabled.","pos":[8192,8363],"source":" In this example, because the service has a <xref:System.ServiceModel.Description.ServiceMetadataBehavior> set to `true`, your service also has publishing metadata enabled."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph>default endpoints, bindings, and behaviors, see <bpt id=\"p1\">[</bpt>Simplified Configuration<ept id=\"p1\">](../../../../docs/framework/wcf/simplified-configuration.md)</ept> and <bpt id=\"p2\">[</bpt>Simplified Configuration for WCF Services<ept id=\"p2\">](../../../../docs/framework/wcf/samples/simplified-configuration-for-wcf-services.md)</ept>.","pos":[8364,8687],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)]default endpoints, bindings, and behaviors, see [Simplified Configuration](../../../../docs/framework/wcf/simplified-configuration.md) and [Simplified Configuration for WCF Services](../../../../docs/framework/wcf/samples/simplified-configuration-for-wcf-services.md)."},{"pos":[8697,8724],"content":"Install and run the service","linkify":"Install and run the service","nodes":[{"content":"Install and run the service","pos":[0,27]}]},{"pos":[8734,8792],"content":"Build the solution to create the <ph id=\"ph1\">`Service.exe`</ph> executable.","source":"Build the solution to create the `Service.exe` executable."},{"content":"Open the <ph id=\"ph1\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph> command prompt and navigate to the project directory.","pos":[8802,8936],"source":"Open the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] command prompt and navigate to the project directory."},{"content":"Type <ph id=\"ph1\">`installutil bin\\service.exe`</ph> at the command prompt to install the Windows service.","pos":[8937,9025],"source":" Type `installutil bin\\service.exe` at the command prompt to install the Windows service."},{"pos":[9037,9271],"content":"[!NOTE]\nIf you do not use the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] command prompt, make sure that the `%WinDir%\\Microsoft.NET\\Framework\\v4.0.<current version>` directory is in the system path.","leadings":["","    >  "],"nodes":[{"content":"If you do not use the <ph id=\"ph1\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph> command prompt, make sure that the <ph id=\"ph2\">`%WinDir%\\Microsoft.NET\\Framework\\v4.0.&lt;current version&gt;`</ph> directory is in the system path.","pos":[8,227],"source":"If you do not use the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] command prompt, make sure that the `%WinDir%\\Microsoft.NET\\Framework\\v4.0.<current version>` directory is in the system path."}]},{"content":"Type <ph id=\"ph1\">`services.msc`</ph> at the command prompt to access the Service Control Manager (SCM).","pos":[9282,9368],"source":"Type `services.msc` at the command prompt to access the Service Control Manager (SCM)."},{"content":"The Windows service should appear in Services as \"WCFWindowsServiceSample\".","pos":[9369,9444]},{"content":"The <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> service can only respond to clients if the Windows service is running.","pos":[9445,9575],"source":" The [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service can only respond to clients if the Windows service is running."},{"content":"To start the service, right-click it in the SCM and select \"Start\", or type <bpt id=\"p1\">**</bpt>net start WCFWindowsServiceSample<ept id=\"p1\">**</ept> at the command prompt.","pos":[9576,9712],"source":" To start the service, right-click it in the SCM and select \"Start\", or type **net start WCFWindowsServiceSample** at the command prompt."},{"content":"If you make changes to the service, you must first stop it and uninstall it.","pos":[9722,9798]},{"content":"To stop the service, right-click the service in the SCM and select \"Stop\", or <bpt id=\"p1\">**</bpt>type net stop WCFWindowsServiceSample<ept id=\"p1\">**</ept> at the command prompt.","pos":[9799,9941],"source":" To stop the service, right-click the service in the SCM and select \"Stop\", or **type net stop WCFWindowsServiceSample** at the command prompt."},{"content":"Note that if you stop the Windows service and then run a client, an <ph id=\"ph1\">&lt;xref:System.ServiceModel.EndpointNotFoundException&gt;</ph> exception occurs when a client attempts to access the service.","pos":[9942,10125],"source":" Note that if you stop the Windows service and then run a client, an <xref:System.ServiceModel.EndpointNotFoundException> exception occurs when a client attempts to access the service."},{"content":"To uninstall the Windows service type <bpt id=\"p1\">**</bpt>installutil /u bin\\service.exe<ept id=\"p1\">**</ept> at the command prompt.","pos":[10126,10221],"source":" To uninstall the Windows service type **installutil /u bin\\service.exe** at the command prompt."},{"pos":[10230,10237],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following is a complete listing of the code used by this topic.","pos":[10241,10308]},{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_HowTo_HostInNTService#8<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#8)</ept><ept id=\"p1\">]</ept>","pos":[10315,10449],"source":"[!code-csharp[c_HowTo_HostInNTService#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_hostinntservice/cs/service.cs#8)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>c_HowTo_HostInNTService#8<ept id=\"p2\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#8)</ept><ept id=\"p1\">]</ept>","pos":[10451,10586],"source":"[!code-vb[c_HowTo_HostInNTService#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_hostinntservice/vb/service.vb#8)]"},{"content":"Like the \"Self-Hosting\" option, the Windows service hosting environment requires that some hosting code be written as part of the application.","pos":[10593,10735]},{"content":"The service is implemented as a console application and contains its own hosting code.","pos":[10736,10822]},{"content":"In other hosting environments, such as Windows Process Activation Service (WAS) hosting in Internet Information Services (IIS), it is not necessary for developers to write hosting code.","pos":[10823,11008]},{"pos":[11017,11025],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Simplified Configuration<ept id=\"p1\">](../../../../docs/framework/wcf/simplified-configuration.md)</ept><ph id=\"ph1\"> </ph>","pos":[11029,11116],"source":"[Simplified Configuration](../../../../docs/framework/wcf/simplified-configuration.md) "},{"content":"<bpt id=\"p1\">[</bpt>Hosting in a Managed Application<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/hosting-in-a-managed-application.md)</ept><ph id=\"ph1\"> </ph>","pos":[11120,11239],"source":"[Hosting in a Managed Application](../../../../docs/framework/wcf/feature-details/hosting-in-a-managed-application.md) "},{"content":"<bpt id=\"p1\">[</bpt>Hosting Services<ept id=\"p1\">](../../../../docs/framework/wcf/hosting-services.md)</ept><ph id=\"ph1\"> </ph>","pos":[11243,11314],"source":"[Hosting Services](../../../../docs/framework/wcf/hosting-services.md) "},{"content":"<bpt id=\"p1\">[</bpt>Windows Server App Fabric Hosting Features<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=201276)</ept>","pos":[11318,11409],"source":"[Windows Server App Fabric Hosting Features](http://go.microsoft.com/fwlink/?LinkId=201276)"}]}