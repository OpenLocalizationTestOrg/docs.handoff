{"content":"---\ntitle: \"Entity Activities | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: c04f7413-7fb8-40c6-819e-dc92b145b62e\ncaps.latest.revision: 9\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Entity Activities\nThis sample shows how to use the ADO.NET Entity Framework with [!INCLUDE[wf2](../../../../includes/wf2-md.md)] to simplify data access.  \n  \n The ADO.NET Entity Framework enables developers to work with data in the form of domain-specific objects, properties and relationships such as Customers, Orders, Order Details and the relationships between these entities. The ADO.NET Entity Framework does this by providing a level of abstraction that enables programming against a conceptual application model instead of programming directly against a relational storage schema. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] the ADO.NET Entity Framework see [ADO.NET Entity Framework](http://go.microsoft.com/fwlink/?LinkId=165549).  \n  \n## Sample details  \n This sample uses the `Northwind` database and includes scripts for creating and removing the `Northwind` database (Setup.cmd and Cleanup.cmd). The projects in this sample include an Entity Data Model based on the `Northwind` database. You can find the model by opening the `Northwind.edmx` file that is included in the project. This is the model that defines the shape of the objects that can be accessed using the ADO.NET Entity Framework.  \n  \n The following activities are included in this sample:  \n  \n-   `EntitySQLQuery`: The `EntitySQLQuery` activity allows you to retrieve objects from the database based on an Entity SQL query string. Entity SQL is a store independent language that is similar to SQL and it allows you to specify queries based on the conceptual model and the entities that are a part of the model or domain. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] Entity SQL Language, see [Entity SQL Language](http://go.microsoft.com/fwlink/?LinkId=165646).  \n  \n-   `EntityLinqQuery`: This activity allows you to retrieve objects from the database based on a LINQ query or predicate.  \n  \n-   `EntityAdd`: The `EntityAdd` activity allows you to add an entity or a collection of entities to the database.  \n  \n-   `EntityDelete`: The `EntityDelete` activity allows you to delete an entity or a collection of entities from the database.  \n  \n-   `ObjectContextScope`: The previously mentioned activities can only be used within a containing `ObjectContextScope` activity instance. The `ObjectContextScope` activity sets up the connection to the database. It requires a connection string (that is either passed in or retrieved using a configuration file setting). The `ObjectContextScope` activity makes it easy to perform a group of related operations on entities. Because this scope maintains an active connection, it is a No Persist scope. In addition, when the `ObjectContextScope` activity exits, any changes that are made to objects retrieved using Entity Activities within that scope automatically get persisted back to the database, and no explicit or subsequent action is required to save objects back to the database.  \n  \n## Using the entity activities  \n The following code snippets demonstrate how to use the entity activities presented in this sample.  \n  \n### EntitySql  \n The code snippet below shows how to query all customers in London sorted by name and how to iterate through the list of customers.  \n  \n```  \nVariable<IEnumerable<Customer>> londonCustomers = new Variable<IEnumerable<Customer>>();  \nDelegateInArgument<Customer> iterationVariable = new DelegateInArgument<Customer>();  \n  \n// create and return the workflow  \nreturn new ObjectContextScope  \n{  \n    ConnectionString = new InArgument<string>(connStr),  \n    ContainerName = \"NorthwindEntities\",  \n    Variables = { londonCustomers },  \n    Body = new Sequence  \n        {  \n            Activities =   \n                {               \n                    new WriteLine { Text = \"Executing query\" },                            \n                    // query for all customers that are in london   \n                    new EntitySqlQuery<Customer>  \n                    {  \n                        EntitySql =  @\"SELECT VALUE Customer   \n                                        FROM NorthwindEntities.Customers AS Customer   \n                                        WHERE Customer.City = 'London'   \n                                        ORDER BY Customer.ContactName\",  \n                        Result = londonCustomers  \n                    },  \n  \n                    // iterate through the list of customers and display them   \n                    new ForEach<Customer>  \n                    {                                      \n                        Values = londonCustomers,  \n                        Body = new ActivityAction<Customer>  \n                        {  \n                            Argument = iterationVariable,  \n                            Handler = new WriteLine   \n                            {   \n                                  Text = new InArgument<String>(e =>    \n                                              iterationVariable.Get(e).ContactName)   \n                            }  \n                        }  \n                    }  \n                }  \n        }                 \n};     \n```  \n  \n### EntityLinqQuery  \n The code snippet below shows how to query all customers in London and how to iterate through the resulting list of customers.  \n  \n```  \nVariable<IEnumerable<Customer>> londonCustomers = new Variable<IEnumerable<Customer>>() { Name = \"LondonCustomers\" };  \nDelegateInArgument<Customer> iterationVariable = new DelegateInArgument<Customer>() { Name = \"iterationVariable\" };  \n  \nreturn new ObjectContextScope  \n{  \n    ConnectionString = new InArgument<string>(connStr),  \n    ContainerName = \"NorthwindEntities\",  \n    Variables = { londonCustomers },  \n    Body = new Sequence  \n    {  \n        Activities =   \n        {               \n            // return all the customers that match with the provided Linq predicate  \n            new EntityLinqQuery<Customer>  \n            {   \n                Predicate = new LambdaValue<Func<Customer, bool>>(  \n                          ctx => new Func<Customer, bool>(c => c.City.Equals(\"London\"))),                              \n                Result = londonCustomers  \n            },  \n  \n            // iterate through the list of customers and display in the console  \n            new ForEach<Customer>  \n            {                                      \n                Values = londonCustomers,  \n                Body = new ActivityAction<Customer>  \n                {  \n                    Argument = iterationVariable,  \n                    Handler = new WriteLine   \n                    {   \n                        Text = new InArgument<String>(e =>   \n                                      iterationVariable.Get(e).ContactName)   \n                    }  \n                }  \n            }  \n        }  \n    }  \n};  \n```  \n  \n### EntityAdd  \n The code snippet below shows how to add an OrderDetail record to an existing Order.  \n  \n```  \nVariable<IEnumerable<Order>> orders = new Variable<IEnumerable<Order>>();  \nVariable<IEnumerable<OrderDetail>> orderDetails = new Variable<IEnumerable<OrderDetail>>();  \nVariable<Order> order = new Variable<Order>();  \nVariable<OrderDetail> orderDetail = new Variable<OrderDetail>();              \n  \nreturn new ObjectContextScope  \n{  \n    Variables = { order, orders, orderDetail, orderDetails },  \n    ContainerName = \"NorthwindEntities\",  \n    ConnectionString = new InArgument<string>(connStr),                  \n    Body = new Sequence  \n    {                      \n        Activities =   \n        {                            \n           // get the order where we want to add the detail  \n           new EntitySqlQuery<Order>  \n           {  \n               EntitySql =    \n                    @\"SELECT VALUE [Order]  \n                      FROM NorthwindEntities.Orders as [Order]  \n                      WHERE Order.OrderID == 10249\",  \n               Result = orders  \n           },  \n  \n           // store the order in a variable  \n           new Assign<Order>   \n           {  \n               To = new OutArgument<Order>(order),  \n               Value = new InArgument<Order>(c => orders.Get(c).First<Order>())  \n           },  \n  \n           // add the detail to the order  \n           new EntityAdd<OrderDetail>  \n           {  \n               Entity = new InArgument<OrderDetail>(c =>   \n                                         new OrderDetail {   \n                                                  OrderID=10249, ProductID=11,   \n                                                  Quantity=1, UnitPrice = 15,   \n                                                  Discount = 0, Order = order.Get(c) })  \n           }  \n        }  \n    }  \n};  \n```  \n  \n### EntityDelete  \n The code snippet below shows how to delete an existing OrderDetail record in an Order (if it exists).  \n  \n```  \nVariable<IEnumerable<OrderDetail>> orderDetails = new Variable<IEnumerable<OrderDetail>>();              \n  \nreturn new ObjectContextScope  \n{  \n    Variables = { orderDetails },  \n    ConnectionString = new InArgument<string>(connStr),  \n    ContainerName = \"NorthwindEntities\",  \n    Body = new Sequence  \n    {  \n        Activities =   \n        {               \n            // find the entitiy to be deleted (order detail for product 11 in order 10249)  \n            new EntitySqlQuery<OrderDetail>  \n            {  \n                EntitySql = @\"SELECT VALUE OrderDetail  \n                                FROM NorthwindEntities.OrderDetails as OrderDetail  \n                               WHERE OrderDetail.OrderID == 10249   \n                                 AND OrderDetail.ProductID == 11\",  \n                Result = orderDetails  \n            },  \n  \n            // if the order detail is found, delete it, otherwise, display a message  \n            new If  \n            {  \n                Condition = new InArgument<bool>(c=>orderDetails.Get(c).Count() > 0),  \n                Then = new Sequence  \n                {   \n                    Activities =   \n                    {                                      \n                        new EntityDelete<OrderDetail>  \n                        {  \n                            Entity = new InArgument<OrderDetail>(c =>   \n                                              orderDetails.Get(c).First<OrderDetail>())  \n                        },  \n                    }  \n                },                              \n                Else = new WriteLine { Text = \"Order Detail for Deleting not found\" }                              \n            }                                                  \n        }  \n    }  \n};  \n```  \n  \n## To use this sample  \n You must create the `Northwind` database in your local SQL server Express instance before running this sample.  \n  \n#### To set up the Northwind database  \n  \n1.  Open a command prompt.  \n  \n2.  In the new command prompt window, navigate to the EntityActivities\\CS folder.  \n  \n3.  Type `setup.cmd` and press ENTER.  \n  \n#### To run the sample  \n  \n1.  Using [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], open the EntityActivities.sln solution file.  \n  \n2.  To build the solution, press CTRL+SHIFT+B.  \n  \n3.  To run the solution, press CTRL+F5.  \n  \n After running this sample, you may want to remove the `Northwind` database.  \n  \n#### To uninstall the Northwind database  \n  \n1.  Open a command prompt.  \n  \n2.  In the new command prompt window, navigate to the EntityActivities\\CS folder.  \n  \n3.  Type `cleanup.cmd` and press ENTER.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Scenario\\ActivityLibrary\\EntityActivities`  \n  \n## See Also","nodes":[{"pos":[12,46],"content":"Entity Activities | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Entity Activities | Microsoft Docs","pos":[0,34]}]},{"pos":[311,328],"content":"Entity Activities","linkify":"Entity Activities","nodes":[{"content":"Entity Activities","pos":[0,17]}]},{"pos":[329,464],"content":"This sample shows how to use the ADO.NET Entity Framework with <ph id=\"ph1\">[!INCLUDE[wf2](../../../../includes/wf2-md.md)]</ph> to simplify data access.","source":"This sample shows how to use the ADO.NET Entity Framework with [!INCLUDE[wf2](../../../../includes/wf2-md.md)] to simplify data access."},{"content":"The ADO.NET Entity Framework enables developers to work with data in the form of domain-specific objects, properties and relationships such as Customers, Orders, Order Details and the relationships between these entities.","pos":[471,692]},{"content":"The ADO.NET Entity Framework does this by providing a level of abstraction that enables programming against a conceptual application model instead of programming directly against a relational storage schema.","pos":[693,900]},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> the ADO.NET Entity Framework see <bpt id=\"p1\">[</bpt>ADO.NET Entity Framework<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=165549)</ept>.","pos":[901,1064],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] the ADO.NET Entity Framework see [ADO.NET Entity Framework](http://go.microsoft.com/fwlink/?LinkId=165549)."},{"pos":[1073,1087],"content":"Sample details","linkify":"Sample details","nodes":[{"content":"Sample details","pos":[0,14]}]},{"content":"This sample uses the <ph id=\"ph1\">`Northwind`</ph> database and includes scripts for creating and removing the <ph id=\"ph2\">`Northwind`</ph> database (Setup.cmd and Cleanup.cmd).","pos":[1091,1233],"source":"This sample uses the `Northwind` database and includes scripts for creating and removing the `Northwind` database (Setup.cmd and Cleanup.cmd)."},{"content":"The projects in this sample include an Entity Data Model based on the <ph id=\"ph1\">`Northwind`</ph> database.","pos":[1234,1325],"source":" The projects in this sample include an Entity Data Model based on the `Northwind` database."},{"content":"You can find the model by opening the <ph id=\"ph1\">`Northwind.edmx`</ph> file that is included in the project.","pos":[1326,1418],"source":" You can find the model by opening the `Northwind.edmx` file that is included in the project."},{"content":"This is the model that defines the shape of the objects that can be accessed using the ADO.NET Entity Framework.","pos":[1419,1531]},{"content":"The following activities are included in this sample:","pos":[1538,1591]},{"content":"<ph id=\"ph1\">`EntitySQLQuery`</ph>: The <ph id=\"ph2\">`EntitySQLQuery`</ph> activity allows you to retrieve objects from the database based on an Entity SQL query string.","pos":[1601,1734],"source":"`EntitySQLQuery`: The `EntitySQLQuery` activity allows you to retrieve objects from the database based on an Entity SQL query string."},{"content":"Entity SQL is a store independent language that is similar to SQL and it allows you to specify queries based on the conceptual model and the entities that are a part of the model or domain.","pos":[1735,1924]},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> Entity SQL Language, see <bpt id=\"p1\">[</bpt>Entity SQL Language<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=165646)</ept>.","pos":[1925,2075],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] Entity SQL Language, see [Entity SQL Language](http://go.microsoft.com/fwlink/?LinkId=165646)."},{"pos":[2085,2202],"content":"<ph id=\"ph1\">`EntityLinqQuery`</ph>: This activity allows you to retrieve objects from the database based on a LINQ query or predicate.","source":"`EntityLinqQuery`: This activity allows you to retrieve objects from the database based on a LINQ query or predicate."},{"pos":[2212,2322],"content":"<ph id=\"ph1\">`EntityAdd`</ph>: The <ph id=\"ph2\">`EntityAdd`</ph> activity allows you to add an entity or a collection of entities to the database.","source":"`EntityAdd`: The `EntityAdd` activity allows you to add an entity or a collection of entities to the database."},{"pos":[2332,2453],"content":"<ph id=\"ph1\">`EntityDelete`</ph>: The <ph id=\"ph2\">`EntityDelete`</ph> activity allows you to delete an entity or a collection of entities from the database.","source":"`EntityDelete`: The `EntityDelete` activity allows you to delete an entity or a collection of entities from the database."},{"content":"<ph id=\"ph1\">`ObjectContextScope`</ph>: The previously mentioned activities can only be used within a containing <ph id=\"ph2\">`ObjectContextScope`</ph> activity instance.","pos":[2463,2597],"source":"`ObjectContextScope`: The previously mentioned activities can only be used within a containing `ObjectContextScope` activity instance."},{"content":"The <ph id=\"ph1\">`ObjectContextScope`</ph> activity sets up the connection to the database.","pos":[2598,2671],"source":" The `ObjectContextScope` activity sets up the connection to the database."},{"content":"It requires a connection string (that is either passed in or retrieved using a configuration file setting).","pos":[2672,2779]},{"content":"The <ph id=\"ph1\">`ObjectContextScope`</ph> activity makes it easy to perform a group of related operations on entities.","pos":[2780,2881],"source":" The `ObjectContextScope` activity makes it easy to perform a group of related operations on entities."},{"content":"Because this scope maintains an active connection, it is a No Persist scope.","pos":[2882,2958]},{"content":"In addition, when the <ph id=\"ph1\">`ObjectContextScope`</ph> activity exits, any changes that are made to objects retrieved using Entity Activities within that scope automatically get persisted back to the database, and no explicit or subsequent action is required to save objects back to the database.","pos":[2959,3243],"source":" In addition, when the `ObjectContextScope` activity exits, any changes that are made to objects retrieved using Entity Activities within that scope automatically get persisted back to the database, and no explicit or subsequent action is required to save objects back to the database."},{"pos":[3252,3279],"content":"Using the entity activities","linkify":"Using the entity activities","nodes":[{"content":"Using the entity activities","pos":[0,27]}]},{"content":"The following code snippets demonstrate how to use the entity activities presented in this sample.","pos":[3283,3381]},{"pos":[3391,3400],"content":"EntitySql","linkify":"EntitySql","nodes":[{"content":"EntitySql","pos":[0,9]}]},{"content":"The code snippet below shows how to query all customers in London sorted by name and how to iterate through the list of customers.","pos":[3404,3534]},{"pos":[5440,5455],"content":"EntityLinqQuery","linkify":"EntityLinqQuery","nodes":[{"content":"EntityLinqQuery","pos":[0,15]}]},{"content":"The code snippet below shows how to query all customers in London and how to iterate through the resulting list of customers.","pos":[5459,5584]},{"pos":[7146,7155],"content":"EntityAdd","linkify":"EntityAdd","nodes":[{"content":"EntityAdd","pos":[0,9]}]},{"content":"The code snippet below shows how to add an OrderDetail record to an existing Order.","pos":[7159,7242]},{"pos":[9026,9038],"content":"EntityDelete","linkify":"EntityDelete","nodes":[{"content":"EntityDelete","pos":[0,12]}]},{"content":"The code snippet below shows how to delete an existing OrderDetail record in an Order (if it exists).","pos":[9042,9143]},{"pos":[10948,10966],"content":"To use this sample","linkify":"To use this sample","nodes":[{"content":"To use this sample","pos":[0,18]}]},{"pos":[10970,11080],"content":"You must create the <ph id=\"ph1\">`Northwind`</ph> database in your local SQL server Express instance before running this sample.","source":"You must create the `Northwind` database in your local SQL server Express instance before running this sample."},{"pos":[11091,11123],"content":"To set up the Northwind database","linkify":"To set up the Northwind database","nodes":[{"content":"To set up the Northwind database","pos":[0,32]}]},{"content":"Open a command prompt.","pos":[11133,11155]},{"content":"In the new command prompt window, navigate to the EntityActivities\\CS folder.","pos":[11165,11242]},{"pos":[11252,11285],"content":"Type <ph id=\"ph1\">`setup.cmd`</ph> and press ENTER.","source":"Type `setup.cmd` and press ENTER."},{"pos":[11296,11313],"content":"To run the sample","linkify":"To run the sample","nodes":[{"content":"To run the sample","pos":[0,17]}]},{"pos":[11323,11446],"content":"Using <ph id=\"ph1\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph>, open the EntityActivities.sln solution file.","source":"Using [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], open the EntityActivities.sln solution file."},{"content":"To build the solution, press CTRL+SHIFT+B.","pos":[11456,11498]},{"content":"To run the solution, press CTRL+F5.","pos":[11508,11543]},{"pos":[11550,11625],"content":"After running this sample, you may want to remove the <ph id=\"ph1\">`Northwind`</ph> database.","source":"After running this sample, you may want to remove the `Northwind` database."},{"pos":[11636,11671],"content":"To uninstall the Northwind database","linkify":"To uninstall the Northwind database","nodes":[{"content":"To uninstall the Northwind database","pos":[0,35]}]},{"content":"Open a command prompt.","pos":[11681,11703]},{"content":"In the new command prompt window, navigate to the EntityActivities\\CS folder.","pos":[11713,11790]},{"pos":[11800,11835],"content":"Type <ph id=\"ph1\">`cleanup.cmd`</ph> and press ENTER.","source":"Type `cleanup.cmd` and press ENTER."},{"pos":[11843,11975],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[12029,12355],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[12356,12406]},{"pos":[12503,12511],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]}]}