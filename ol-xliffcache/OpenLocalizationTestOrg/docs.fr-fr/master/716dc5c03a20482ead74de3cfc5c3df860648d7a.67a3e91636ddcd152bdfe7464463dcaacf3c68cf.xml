{"content":"---\ntitle: \"ICorProfilerCallback6::GetAssemblyReferences Method | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\napi_name: \n  - \"ICorProfilerCallback6.GetAssemblyReferences\"\napi_location: \n  - \"mscorwks.dll\"\n  - \"corprof.idl\"\napi_type: \n  - \"COM\"\ndev_langs: \n  - \"C++\"\nms.assetid: 8b391afb-d79f-41bd-94ce-43ce62c6b5fc\ntopic_type: \n  - \"apiref\"\ncaps.latest.revision: 10\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# ICorProfilerCallback6::GetAssemblyReferences Method\n[Supported in the .NET Framework 4.5.2 and later versions]  \n  \n Notifies the profiler that an assembly is in a very early loading stage, when the common language runtime performs an assembly reference closure walk.  \n  \n## Syntax  \n  \n```vb  \n  \nHRESULT GetAssemblyReferences(        [in, string] const WCHAR* wszAssemblyPath,  \n        [in] ICorProfilerAssemblyReferenceProvider* pAsmRefProvider  \n);  \n  \n```  \n  \n#### Parameters  \n `wszAssemblyPath`  \n [in] The path and name of the assembly whose metadata will be modified.  \n  \n `pAsmRefProvider`  \n [in] A pointer to the address of an [ICorProfilerAssemblyReferenceProvider](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-interface.md) interface that specifies the assembly references to add.  \n  \n## Return Value  \n Return values from this callback are ignored.  \n  \n## Remarks  \n This callback is controlled by setting the [COR_PRF_HIGH_ADD_ASSEMBLY_REFERENCES](../../../../docs/framework/unmanaged-api/profiling/cor-prf-high-monitor-enumeration.md) event mask flag when calling the [ICorProfilerCallback5::SetEventMask2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo5-seteventmask2-method.md) method. If the profiler registers for the [ICorProfilerCallback6::GetAssemblyReferences](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback6-getassemblyreferences-method.md) callback method, the runtime passes the path and name of the assembly to be loaded, along with a pointer to an [ICorProfilerAssemblyReferenceProvider](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-interface.md) interface object to that method. The profiler can then call the [ICorProfilerAssemblyReferenceProvider::AddAssemblyReference](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-addassemblyreference-method.md) method with a `COR_PRF_ASSEMBLY_REFERENCE_INFO` object for each target assembly it plans to reference from the assembly specified in the `GetAssemblyReferences` callback.  \n  \n Use the `GetAssemblyReferences` callback only if the profiler has to modify an assembly's metadata to add assembly references. (But note that the actual modification of an assembly's metadata is done in the [ICorProfilerCallback::ModuleLoadFinished](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-moduleloadfinished-method.md)callback method.) The profiler should implement the `GetAssemblyReferences` callback method to inform the common language runtime (CLR) that assembly references will be added when the module has been loaded.  This helps ensure that assembly sharing decisions made by the CLR during this early stage remain valid although the profiler plans to modify the metadata assembly references later.  This can avoid some instances in which profiler metadata modifications cause an `SECURITY_E_INCOMPATIBLE_SHARE` error.  \n  \n The profiler uses the [ICorProfilerAssemblyReferenceProvider](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-interface.md) object provided by this method to add assembly references to the CLR assembly reference closure walker.  The [ICorProfilerAssemblyReferenceProvider](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-interface.md) object should be used only from within this callback. Calls to the [ICorProfilerAssemblyReferenceProvider::AddAssemblyReference](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-addassemblyreference-method.md) method from this callback don't result in modified metadata, but only in a modified assembly reference closure walk. The profiler will still have to use an [IMetaDataAssemblyEmit](../../../../docs/framework/unmanaged-api/metadata/imetadataassemblyemit-interface.md) object to explicitly add assembly references from within the [ICorProfilerCallback::ModuleLoadFinished](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-moduleloadfinished-method.md) callback for the referencing assembly, even if it implements the `GetAssemblyReferences` callback.  \n  \n The profiler should be prepared to receive duplicate calls to this callback for the same assembly, and should respond identically for each such duplicate call (by making the same set of [ICorProfilerAssemblyReferenceProvider::AddAssemblyReference](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-addassemblyreference-method.md) calls).  \n  \n## Requirements  \n **Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md).  \n  \n **Header:** CorProf.idl, CorProf.h  \n  \n **Library:** CorGuids.lib  \n  \n **.NET Framework Versions:** [!INCLUDE[net_current_v452plus](../../../../includes/net-current-v452plus-md.md)]  \n  \n## See Also  \n [ICorProfilerCallback6 Interface](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback6-interface.md)   \n [ModuleLoadFinished Method](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-moduleloadfinished-method.md)   \n [COR_PRF_ASSEMBLY_REFERENCE_INFO Structure](../../../../docs/framework/unmanaged-api/profiling/cor-prf-assembly-reference-info-structure.md)   \n [ICorProfilerAssemblyReferenceProvider Interface](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-interface.md)","nodes":[{"pos":[4,561],"embed":true,"restype":"x-metadata","content":"title: \"ICorProfilerCallback6::GetAssemblyReferences Method | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\napi_name: \n  - \"ICorProfilerCallback6.GetAssemblyReferences\"\napi_location: \n  - \"mscorwks.dll\"\n  - \"corprof.idl\"\napi_type: \n  - \"COM\"\ndev_langs: \n  - \"C++\"\nms.assetid: 8b391afb-d79f-41bd-94ce-43ce62c6b5fc\ntopic_type: \n  - \"apiref\"\ncaps.latest.revision: 10\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"","nodes":[{"content":"ICorProfilerCallback6::GetAssemblyReferences Method | Microsoft Docs","nodes":[{"pos":[0,68],"content":"ICorProfilerCallback6::GetAssemblyReferences Method | Microsoft Docs","nodes":[{"content":"ICorProfilerCallback6::GetAssemblyReferences Method | Microsoft Docs","pos":[0,68]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[568,619],"content":"ICorProfilerCallback6::GetAssemblyReferences Method","linkify":"ICorProfilerCallback6::GetAssemblyReferences Method","nodes":[{"content":"ICorProfilerCallback6::GetAssemblyReferences Method","pos":[0,51]}]},{"content":"[Supported in the .NET Framework 4.5.2 and later versions]","pos":[620,678]},{"content":"Notifies the profiler that an assembly is in a very early loading stage, when the common language runtime performs an assembly reference closure walk.","pos":[685,835]},{"pos":[844,850],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[1042,1052],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"[in] The path and name of the assembly whose metadata will be modified.","pos":[1077,1148]},{"content":"[in] A pointer to the address of an <bpt id=\"p1\">[</bpt>ICorProfilerAssemblyReferenceProvider<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-interface.md)</ept> interface that specifies the assembly references to add.","pos":[1176,1411],"source":"[in] A pointer to the address of an [ICorProfilerAssemblyReferenceProvider](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-interface.md) interface that specifies the assembly references to add."},{"pos":[1420,1432],"content":"Return Value","linkify":"Return Value","nodes":[{"content":"Return Value","pos":[0,12]}]},{"content":"Return values from this callback are ignored.","pos":[1436,1481]},{"pos":[1490,1497],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"This callback is controlled by setting the <bpt id=\"p1\">[</bpt>COR_PRF_HIGH_ADD_ASSEMBLY_REFERENCES<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/cor-prf-high-monitor-enumeration.md)</ept> event mask flag when calling the <bpt id=\"p2\">[</bpt>ICorProfilerCallback5::SetEventMask2<ept id=\"p2\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo5-seteventmask2-method.md)</ept> method.","pos":[1501,1844],"source":"This callback is controlled by setting the [COR_PRF_HIGH_ADD_ASSEMBLY_REFERENCES](../../../../docs/framework/unmanaged-api/profiling/cor-prf-high-monitor-enumeration.md) event mask flag when calling the [ICorProfilerCallback5::SetEventMask2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo5-seteventmask2-method.md) method."},{"content":"If the profiler registers for the <bpt id=\"p1\">[</bpt>ICorProfilerCallback6::GetAssemblyReferences<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback6-getassemblyreferences-method.md)</ept> callback method, the runtime passes the path and name of the assembly to be loaded, along with a pointer to an <bpt id=\"p2\">[</bpt>ICorProfilerAssemblyReferenceProvider<ept id=\"p2\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-interface.md)</ept> interface object to that method.","pos":[1845,2318],"source":" If the profiler registers for the [ICorProfilerCallback6::GetAssemblyReferences](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback6-getassemblyreferences-method.md) callback method, the runtime passes the path and name of the assembly to be loaded, along with a pointer to an [ICorProfilerAssemblyReferenceProvider](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-interface.md) interface object to that method."},{"content":"The profiler can then call the <bpt id=\"p1\">[</bpt>ICorProfilerAssemblyReferenceProvider::AddAssemblyReference<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-addassemblyreference-method.md)</ept> method with a <ph id=\"ph1\">`COR_PRF_ASSEMBLY_REFERENCE_INFO`</ph> object for each target assembly it plans to reference from the assembly specified in the <ph id=\"ph2\">`GetAssemblyReferences`</ph> callback.","pos":[2319,2703],"source":" The profiler can then call the [ICorProfilerAssemblyReferenceProvider::AddAssemblyReference](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-addassemblyreference-method.md) method with a `COR_PRF_ASSEMBLY_REFERENCE_INFO` object for each target assembly it plans to reference from the assembly specified in the `GetAssemblyReferences` callback."},{"content":"Use the <ph id=\"ph1\">`GetAssemblyReferences`</ph> callback only if the profiler has to modify an assembly's metadata to add assembly references.","pos":[2710,2836],"source":"Use the `GetAssemblyReferences` callback only if the profiler has to modify an assembly's metadata to add assembly references."},{"content":"(But note that the actual modification of an assembly's metadata is done in the <bpt id=\"p1\">[</bpt>ICorProfilerCallback::ModuleLoadFinished<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-moduleloadfinished-method.md)</ept>callback method.) The profiler should implement the <ph id=\"ph1\">`GetAssemblyReferences`</ph> callback method to inform the common language runtime (CLR) that assembly references will be added when the module has been loaded.","pos":[2837,3268],"source":" (But note that the actual modification of an assembly's metadata is done in the [ICorProfilerCallback::ModuleLoadFinished](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-moduleloadfinished-method.md)callback method.) The profiler should implement the `GetAssemblyReferences` callback method to inform the common language runtime (CLR) that assembly references will be added when the module has been loaded."},{"content":"This helps ensure that assembly sharing decisions made by the CLR during this early stage remain valid although the profiler plans to modify the metadata assembly references later.","pos":[3270,3450]},{"content":"This can avoid some instances in which profiler metadata modifications cause an <ph id=\"ph1\">`SECURITY_E_INCOMPATIBLE_SHARE`</ph> error.","pos":[3452,3570],"source":"  This can avoid some instances in which profiler metadata modifications cause an `SECURITY_E_INCOMPATIBLE_SHARE` error."},{"content":"The profiler uses the <bpt id=\"p1\">[</bpt>ICorProfilerAssemblyReferenceProvider<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-interface.md)</ept> object provided by this method to add assembly references to the CLR assembly reference closure walker.","pos":[3577,3845],"source":"The profiler uses the [ICorProfilerAssemblyReferenceProvider](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-interface.md) object provided by this method to add assembly references to the CLR assembly reference closure walker."},{"content":"The <bpt id=\"p1\">[</bpt>ICorProfilerAssemblyReferenceProvider<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-interface.md)</ept> object should be used only from within this callback.","pos":[3847,4047],"source":"  The [ICorProfilerAssemblyReferenceProvider](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-interface.md) object should be used only from within this callback."},{"content":"Calls to the <bpt id=\"p1\">[</bpt>ICorProfilerAssemblyReferenceProvider::AddAssemblyReference<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-addassemblyreference-method.md)</ept> method from this callback don't result in modified metadata, but only in a modified assembly reference closure walk.","pos":[4048,4360],"source":" Calls to the [ICorProfilerAssemblyReferenceProvider::AddAssemblyReference](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-addassemblyreference-method.md) method from this callback don't result in modified metadata, but only in a modified assembly reference closure walk."},{"content":"The profiler will still have to use an <bpt id=\"p1\">[</bpt>IMetaDataAssemblyEmit<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/metadata/imetadataassemblyemit-interface.md)</ept> object to explicitly add assembly references from within the <bpt id=\"p2\">[</bpt>ICorProfilerCallback::ModuleLoadFinished<ept id=\"p2\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-moduleloadfinished-method.md)</ept> callback for the referencing assembly, even if it implements the <ph id=\"ph1\">`GetAssemblyReferences`</ph> callback.","pos":[4361,4814],"source":" The profiler will still have to use an [IMetaDataAssemblyEmit](../../../../docs/framework/unmanaged-api/metadata/imetadataassemblyemit-interface.md) object to explicitly add assembly references from within the [ICorProfilerCallback::ModuleLoadFinished](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-moduleloadfinished-method.md) callback for the referencing assembly, even if it implements the `GetAssemblyReferences` callback."},{"pos":[4821,5197],"content":"The profiler should be prepared to receive duplicate calls to this callback for the same assembly, and should respond identically for each such duplicate call (by making the same set of <bpt id=\"p1\">[</bpt>ICorProfilerAssemblyReferenceProvider::AddAssemblyReference<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-addassemblyreference-method.md)</ept> calls).","source":"The profiler should be prepared to receive duplicate calls to this callback for the same assembly, and should respond identically for each such duplicate call (by making the same set of [ICorProfilerAssemblyReferenceProvider::AddAssemblyReference](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-addassemblyreference-method.md) calls)."},{"pos":[5206,5218],"content":"Requirements","linkify":"Requirements","nodes":[{"content":"Requirements","pos":[0,12]}]},{"pos":[5222,5326],"content":"<bpt id=\"p1\">**</bpt>Platforms:<ept id=\"p1\">**</ept> See <bpt id=\"p2\">[</bpt>System Requirements<ept id=\"p2\">](../../../../docs/framework/get-started/system-requirements.md)</ept>.","source":"**Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md)."},{"pos":[5333,5367],"content":"<bpt id=\"p1\">**</bpt>Header:<ept id=\"p1\">**</ept> CorProf.idl, CorProf.h","source":"**Header:** CorProf.idl, CorProf.h"},{"pos":[5374,5399],"content":"<bpt id=\"p1\">**</bpt>Library:<ept id=\"p1\">**</ept> CorGuids.lib","source":"**Library:** CorGuids.lib"},{"pos":[5406,5516],"content":"<bpt id=\"p1\">**</bpt>.NET Framework Versions:<ept id=\"p1\">**</ept> <ph id=\"ph1\">[!INCLUDE[net_current_v452plus](../../../../includes/net-current-v452plus-md.md)]</ph>","source":"**.NET Framework Versions:** [!INCLUDE[net_current_v452plus](../../../../includes/net-current-v452plus-md.md)]"},{"pos":[5525,5533],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>ICorProfilerCallback6 Interface<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback6-interface.md)</ept><ph id=\"ph1\"> </ph>","pos":[5537,5658],"source":"[ICorProfilerCallback6 Interface](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback6-interface.md) "},{"content":"<bpt id=\"p1\">[</bpt>ModuleLoadFinished Method<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-moduleloadfinished-method.md)</ept><ph id=\"ph1\"> </ph>","pos":[5662,5792],"source":"[ModuleLoadFinished Method](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-moduleloadfinished-method.md) "},{"content":"<bpt id=\"p1\">[</bpt>COR_PRF_ASSEMBLY_REFERENCE_INFO Structure<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/cor-prf-assembly-reference-info-structure.md)</ept><ph id=\"ph1\"> </ph>","pos":[5796,5937],"source":"[COR_PRF_ASSEMBLY_REFERENCE_INFO Structure](../../../../docs/framework/unmanaged-api/profiling/cor-prf-assembly-reference-info-structure.md) "},{"content":"<bpt id=\"p1\">[</bpt>ICorProfilerAssemblyReferenceProvider Interface<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-interface.md)</ept>","pos":[5941,6093],"source":"[ICorProfilerAssemblyReferenceProvider Interface](../../../../docs/framework/unmanaged-api/profiling/icorprofilerassemblyreferenceprovider-interface.md)"}]}