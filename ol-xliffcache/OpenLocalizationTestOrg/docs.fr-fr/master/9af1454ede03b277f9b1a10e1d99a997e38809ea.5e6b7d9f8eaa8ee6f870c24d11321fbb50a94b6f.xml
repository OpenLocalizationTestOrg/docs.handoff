{"content":"---\ntitle: Runtime roll forward for .NET Core self-contained app deployments.\ndescription: Learn about dotnet publish changes for self-contained deployments.\nauthor: KathleenDollard\nms.date: 05/31/2018\nms.custom: seodec18\n---\n# Self-contained deployment runtime roll forward\n\n.NET Core [self-contained application deployments](index.md) include both the .NET Core libraries and the .NET Core runtime. Starting in .NET Core 2.1 SDK (version 2.1.300), a self-contained application deployment [publishes the highest patch runtime on your machine](https://github.com/dotnet/designs/pull/36). By default, [`dotnet publish`](../tools/dotnet-publish.md) for a self-contained deployment selects the latest version installed as part of the SDK on the publishing machine. This enables your deployed application to run with security fixes (and other fixes) available during `publish`. The application must be re-published to obtain a new patch. Self-contained applications are created by specifying `-r <RID>` on the `dotnet publish` command or by specifying the [runtime identifier (RID)](../rid-catalog.md) in the project file (csproj / vbproj) or on the command line.\n\n## Patch version roll forward overview\n\n[`restore`](../tools/dotnet-restore.md), [`build`](../tools/dotnet-build.md) and [`publish`](../tools/dotnet-publish.md) are `dotnet` commands that can run separately. The runtime choice is part of the `restore` operation, not `publish` or `build`. If you call `publish`, the latest patch version will be chosen. If you call `publish` with the `--no-restore` argument, then you may not get the desired patch version because a prior `restore` may not have been executed with the new self-contained application publishing policy. In this case, a build error is generated with text similar to the following:\n\n  \"The project was restored using Microsoft.NETCore.App version 2.0.0, but with current settings, version 2.0.6 would be used instead. To resolve this issue, make sure the same settings are used for restore and for subsequent operations such as build or publish. Typically this issue can occur if the RuntimeIdentifier property is set during build or publish but not during restore.\"\n\n> [!NOTE]\n> `restore` and `build` can be run implicitly as part of another command, like `publish`. When run implicitly as part of another command, they are provided with additional context so that the right artifacts are produced. When you `publish` with a runtime (for example, `dotnet publish -r linux-x64`), the implicit `restore` restores packages for the linux-x64 runtime. If you call `restore` explicitly, it does not restore runtime packages by default, because it doesn't have that context.\n\n## How to avoid restore during publish\n\nRunning `restore` as part of the `publish` operation may be undesirable for your scenario. To avoid `restore` during `publish` while creating self-contained applications, do the following:\n\n* Set the `RuntimeIdentifiers` property to a semicolon-separated list of all the [RIDs](../rid-catalog.md) to be published.\n* Set the `TargetLatestRuntimePatch` property to `true`.\n\n## No-restore argument with dotnet publish options\n\nIf you want to create both self-contained applications and [framework-dependent applications](index.md) with the same project file, and you want to use the `--no-restore` argument with `dotnet publish`, then choose one of the following:\n\n1. Prefer the framework-dependent behavior. If the application is framework-dependent, this is the default behavior. If the application is self-contained, and can use an unpatched 2.1.0 local runtime, set the `TargetLatestRuntimePatch` to `false` in the project file.\n\n2. Prefer the self-contained behavior. If the application is self-contained, this is the default behavior. If the application is framework-dependent, and requires the latest patch installed, set `TargetLatestRuntimePatch` to `true` in the project file.\n\n3. Take explicit control of the runtime framework version by setting `RuntimeFrameworkVersion` to the specific patch version in the project file.\n","nodes":[{"pos":[4,221],"embed":true,"restype":"x-metadata","content":"title: Runtime roll forward for .NET Core self-contained app deployments.\ndescription: Learn about dotnet publish changes for self-contained deployments.\nauthor: KathleenDollard\nms.date: 05/31/2018\nms.custom: seodec18","nodes":[{"content":"Runtime roll forward for .NET Core self-contained app deployments.","nodes":[{"pos":[0,66],"content":"Runtime roll forward for .NET Core self-contained app deployments.","nodes":[{"content":"Runtime roll forward for .NET Core self-contained app deployments.","pos":[0,66]}]}],"path":["title"],"nosxs":false},{"content":"Learn about dotnet publish changes for self-contained deployments.","nodes":[{"pos":[0,66],"content":"Learn about dotnet publish changes for self-contained deployments.","nodes":[{"content":"Learn about dotnet publish changes for self-contained deployments.","pos":[0,66]}]}],"path":["description"],"nosxs":false}],"yml":true},{"pos":[228,274],"content":"Self-contained deployment runtime roll forward","linkify":"Self-contained deployment runtime roll forward","nodes":[{"content":"Self-contained deployment runtime roll forward","pos":[0,46]}]},{"content":".NET Core <bpt id=\"p1\">[</bpt>self-contained application deployments<ept id=\"p1\">](index.md)</ept> include both the .NET Core libraries and the .NET Core runtime.","pos":[276,400],"source":".NET Core [self-contained application deployments](index.md) include both the .NET Core libraries and the .NET Core runtime."},{"content":"Starting in .NET Core 2.1 SDK (version 2.1.300), a self-contained application deployment <bpt id=\"p1\">[</bpt>publishes the highest patch runtime on your machine<ept id=\"p1\">](https://github.com/dotnet/designs/pull/36)</ept>.","pos":[401,587],"source":" Starting in .NET Core 2.1 SDK (version 2.1.300), a self-contained application deployment [publishes the highest patch runtime on your machine](https://github.com/dotnet/designs/pull/36)."},{"content":"By default, <bpt id=\"p1\">[</bpt><ph id=\"ph1\">`dotnet publish`</ph><ept id=\"p1\">](../tools/dotnet-publish.md)</ept> for a self-contained deployment selects the latest version installed as part of the SDK on the publishing machine.","pos":[588,761],"source":" By default, [`dotnet publish`](../tools/dotnet-publish.md) for a self-contained deployment selects the latest version installed as part of the SDK on the publishing machine."},{"content":"This enables your deployed application to run with security fixes (and other fixes) available during <ph id=\"ph1\">`publish`</ph>.","pos":[762,873],"source":" This enables your deployed application to run with security fixes (and other fixes) available during `publish`."},{"content":"The application must be re-published to obtain a new patch.","pos":[874,933]},{"content":"Self-contained applications are created by specifying <ph id=\"ph1\">`-r &lt;RID&gt;`</ph> on the <ph id=\"ph2\">`dotnet publish`</ph> command or by specifying the <bpt id=\"p1\">[</bpt>runtime identifier (RID)<ept id=\"p1\">](../rid-catalog.md)</ept> in the project file (csproj / vbproj) or on the command line.","pos":[934,1159],"source":" Self-contained applications are created by specifying `-r <RID>` on the `dotnet publish` command or by specifying the [runtime identifier (RID)](../rid-catalog.md) in the project file (csproj / vbproj) or on the command line."},{"pos":[1164,1199],"content":"Patch version roll forward overview","linkify":"Patch version roll forward overview","nodes":[{"content":"Patch version roll forward overview","pos":[0,35]}]},{"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">`restore`</ph><ept id=\"p1\">](../tools/dotnet-restore.md)</ept>, <bpt id=\"p2\">[</bpt><ph id=\"ph2\">`build`</ph><ept id=\"p2\">](../tools/dotnet-build.md)</ept> and <bpt id=\"p3\">[</bpt><ph id=\"ph3\">`publish`</ph><ept id=\"p3\">](../tools/dotnet-publish.md)</ept> are <ph id=\"ph4\">`dotnet`</ph> commands that can run separately.","pos":[1201,1368],"source":"[`restore`](../tools/dotnet-restore.md), [`build`](../tools/dotnet-build.md) and [`publish`](../tools/dotnet-publish.md) are `dotnet` commands that can run separately."},{"content":"The runtime choice is part of the <ph id=\"ph1\">`restore`</ph> operation, not <ph id=\"ph2\">`publish`</ph> or <ph id=\"ph3\">`build`</ph>.","pos":[1369,1449],"source":" The runtime choice is part of the `restore` operation, not `publish` or `build`."},{"content":"If you call <ph id=\"ph1\">`publish`</ph>, the latest patch version will be chosen.","pos":[1450,1513],"source":" If you call `publish`, the latest patch version will be chosen."},{"content":"If you call <ph id=\"ph1\">`publish`</ph> with the <ph id=\"ph2\">`--no-restore`</ph> argument, then you may not get the desired patch version because a prior <ph id=\"ph3\">`restore`</ph> may not have been executed with the new self-contained application publishing policy.","pos":[1514,1728],"source":" If you call `publish` with the `--no-restore` argument, then you may not get the desired patch version because a prior `restore` may not have been executed with the new self-contained application publishing policy."},{"content":"In this case, a build error is generated with text similar to the following:","pos":[1729,1805]},{"content":"\"The project was restored using Microsoft.NETCore.App version 2.0.0, but with current settings, version 2.0.6 would be used instead.","pos":[1809,1941]},{"content":"To resolve this issue, make sure the same settings are used for restore and for subsequent operations such as build or publish.","pos":[1942,2069]},{"content":"Typically this issue can occur if the RuntimeIdentifier property is set during build or publish but not during restore.\"","pos":[2070,2190]},{"pos":[2194,2692],"content":"[!NOTE]\n`restore` and `build` can be run implicitly as part of another command, like `publish`. When run implicitly as part of another command, they are provided with additional context so that the right artifacts are produced. When you `publish` with a runtime (for example, `dotnet publish -r linux-x64`), the implicit `restore` restores packages for the linux-x64 runtime. If you call `restore` explicitly, it does not restore runtime packages by default, because it doesn't have that context.","leadings":["","> "],"nodes":[{"content":"`restore` and `build` can be run implicitly as part of another command, like `publish`. When run implicitly as part of another command, they are provided with additional context so that the right artifacts are produced. When you `publish` with a runtime (for example, `dotnet publish -r linux-x64`), the implicit `restore` restores packages for the linux-x64 runtime. If you call `restore` explicitly, it does not restore runtime packages by default, because it doesn't have that context.","pos":[8,496],"nodes":[{"content":"<ph id=\"ph1\">`restore`</ph> and <ph id=\"ph2\">`build`</ph> can be run implicitly as part of another command, like <ph id=\"ph3\">`publish`</ph>.","pos":[0,87],"source":"`restore` and `build` can be run implicitly as part of another command, like `publish`."},{"content":"When run implicitly as part of another command, they are provided with additional context so that the right artifacts are produced.","pos":[88,219]},{"content":"When you <ph id=\"ph1\">`publish`</ph> with a runtime (for example, <ph id=\"ph2\">`dotnet publish -r linux-x64`</ph>), the implicit <ph id=\"ph3\">`restore`</ph> restores packages for the linux-x64 runtime.","pos":[220,367],"source":" When you `publish` with a runtime (for example, `dotnet publish -r linux-x64`), the implicit `restore` restores packages for the linux-x64 runtime."},{"content":"If you call <ph id=\"ph1\">`restore`</ph> explicitly, it does not restore runtime packages by default, because it doesn't have that context.","pos":[368,488],"source":" If you call `restore` explicitly, it does not restore runtime packages by default, because it doesn't have that context."}]}]},{"pos":[2697,2732],"content":"How to avoid restore during publish","linkify":"How to avoid restore during publish","nodes":[{"content":"How to avoid restore during publish","pos":[0,35]}]},{"content":"Running <ph id=\"ph1\">`restore`</ph> as part of the <ph id=\"ph2\">`publish`</ph> operation may be undesirable for your scenario.","pos":[2734,2824],"source":"Running `restore` as part of the `publish` operation may be undesirable for your scenario."},{"content":"To avoid <ph id=\"ph1\">`restore`</ph> during <ph id=\"ph2\">`publish`</ph> while creating self-contained applications, do the following:","pos":[2825,2922],"source":" To avoid `restore` during `publish` while creating self-contained applications, do the following:"},{"pos":[2926,3047],"content":"Set the <ph id=\"ph1\">`RuntimeIdentifiers`</ph> property to a semicolon-separated list of all the <bpt id=\"p1\">[</bpt>RIDs<ept id=\"p1\">](../rid-catalog.md)</ept> to be published.","source":"Set the `RuntimeIdentifiers` property to a semicolon-separated list of all the [RIDs](../rid-catalog.md) to be published."},{"pos":[3050,3104],"content":"Set the <ph id=\"ph1\">`TargetLatestRuntimePatch`</ph> property to <ph id=\"ph2\">`true`</ph>.","source":"Set the `TargetLatestRuntimePatch` property to `true`."},{"pos":[3109,3156],"content":"No-restore argument with dotnet publish options","linkify":"No-restore argument with dotnet publish options","nodes":[{"content":"No-restore argument with dotnet publish options","pos":[0,47]}]},{"pos":[3158,3394],"content":"If you want to create both self-contained applications and <bpt id=\"p1\">[</bpt>framework-dependent applications<ept id=\"p1\">](index.md)</ept> with the same project file, and you want to use the <ph id=\"ph1\">`--no-restore`</ph> argument with <ph id=\"ph2\">`dotnet publish`</ph>, then choose one of the following:","source":"If you want to create both self-contained applications and [framework-dependent applications](index.md) with the same project file, and you want to use the `--no-restore` argument with `dotnet publish`, then choose one of the following:"},{"content":"Prefer the framework-dependent behavior.","pos":[3399,3439]},{"content":"If the application is framework-dependent, this is the default behavior.","pos":[3440,3512]},{"content":"If the application is self-contained, and can use an unpatched 2.1.0 local runtime, set the <ph id=\"ph1\">`TargetLatestRuntimePatch`</ph> to <ph id=\"ph2\">`false`</ph> in the project file.","pos":[3513,3663],"source":" If the application is self-contained, and can use an unpatched 2.1.0 local runtime, set the `TargetLatestRuntimePatch` to `false` in the project file."},{"content":"Prefer the self-contained behavior.","pos":[3668,3703]},{"content":"If the application is self-contained, this is the default behavior.","pos":[3704,3771]},{"content":"If the application is framework-dependent, and requires the latest patch installed, set <ph id=\"ph1\">`TargetLatestRuntimePatch`</ph> to <ph id=\"ph2\">`true`</ph> in the project file.","pos":[3772,3917],"source":" If the application is framework-dependent, and requires the latest patch installed, set `TargetLatestRuntimePatch` to `true` in the project file."},{"pos":[3922,4064],"content":"Take explicit control of the runtime framework version by setting <ph id=\"ph1\">`RuntimeFrameworkVersion`</ph> to the specific patch version in the project file.","source":"Take explicit control of the runtime framework version by setting `RuntimeFrameworkVersion` to the specific patch version in the project file."}]}