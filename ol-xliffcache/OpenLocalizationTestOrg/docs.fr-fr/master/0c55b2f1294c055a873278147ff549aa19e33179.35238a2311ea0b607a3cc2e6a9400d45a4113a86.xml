{"content":"---\ntitle: \"Peer Name Publication and Resolution\"\nms.date: \"03/30/2017\"\nms.assetid: f0370e08-9fa6-4ee5-ab78-9a58a20a7da2\n---\n# Peer Name Publication and Resolution\n\n## Publishing a peer name  \n\n To publish a new PNRP ID, a peer performs the following:  \n  \n-   Sends PNRP publication messages to its cache neighbors (the peers that have registered PNRP IDs in the lowest level of the cache) to seed their caches.  \n  \n-   Chooses random nodes in the cloud that are not its neighbors and sends them PNRP name resolution requests for its own P2P ID. The resulting endpoint determination process seeds the caches of random nodes in the cloud with the PNRP ID of the publishing peer.  \n  \nPNRP version 2 nodes do not publish PNRP IDs if they are only resolving other P2P IDs. The HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\PeerNet\\PNRP\\IPV6-Global\\SearchOnly=1 registry value (REG_DWORD type) specifies that peers only use PNRP for name resolution, never for name publication. This registry value can also be configured through Group Policy.  \n  \n## Resolving a peer name\n\n Locating other peers in a PNRP network or cloud is a process comprised of two phases:  \n  \n1.  Endpoint Determination  \n  \n2.  PNRP ID Resolution  \n  \n In the endpoint determination phase, a peer that is attempting to resolve the PNRP ID of a service on another computer determines the IPv6 address of that remote peer.  The remote peer is the one that published, or is associated with, the PNRP ID of the computer or service.  \n  \n After confirming that the remote endpoint has been registered into the PNRP cloud, the requesting peer in the PNRP ID resolution phase sends a request to that peer endpoint for the PNRP ID of the desired service. The endpoint sends a reply confirming the PNRP ID of the service, a comment, and up to 4 kilobytes of additional information that the requesting peer can use for future communication. For example, if the desired endpoint is a gaming server, the additional peer name record data can contain information about the game, the level of play, and the current number of players.  \n  \n In the endpoint determination phase, PNRP uses an iterative process for locating the node that published the PNRP ID, in which the node performing the resolution is responsible for contacting nodes that are successively closer to the target PNRP ID.  \n  \n To perform name resolution in PNRP, the peer examines the entries in its own cache for an entry that matches the target PNRP ID. If found, the peer sends a PNRP Request message to the peer and waits for a response. If an entry for the PNRP ID is not found, the peer sends a PNRP Request message to the peer that corresponds to the entry that has a PNRP ID that most closely matches the target PNRP ID. The node that receives the PNRP Request message examines its own cache and does the following:  \n  \n-   If the PNRP ID is found, the requested endpoint peer replies directly to the requesting peer.  \n  \n-   If the PNRP ID is not found and a PNRP ID in the cache is closer to the target PNRP ID, the requested peer sends a response to the requesting peer containing the IPv6 address of the peer that represents the entry with a PNRP ID that more closely matches the target PNRP ID. Using the IP address in the response, the requesting node sends another PNRP Request message to the IPv6 address to respond or examine its cache.  \n  \n-   If the PNRP ID is not found and there is no PNRP ID in its cache that is closer to the target PNRP ID, the requested peer sends the requesting peer a response that indicates this condition. The requesting peer then chooses the next-closest PNRP ID.  \n  \nThe requesting peer continues this process with successive iterations, eventually locating the node that registered the PNRP ID.  \n  \n Within the <xref:System.Net.PeerToPeer> namespace, there is a many-to-many relationship between the <xref:System.Net.PeerToPeer.PeerName> records that contain endpoints and PNRP clouds or meshes in which they communicate. When there are duplicate or stale entries, or multiple nodes with the same peer name, PNRP nodes can obtain current information using the <xref:System.Net.PeerToPeer.PeerNameResolver> class. The <xref:System.Net.PeerToPeer.PeerNameResolver> methods use a single peer name to simplify the perspective to one peer-to-many peer name records and the same one peer to many clouds. This is similar to a query performed using a relational-table join. Upon successful completion, the Resolver object returns a <xref:System.Net.PeerToPeer.PeerNameRecordCollection> for the specified peer name.  For example, a peer name would occur in all the peer name records in the collection, ordered by cloud. These are the instances of the peer name whose supporting data may be requested by a PNRP-based application.  \n  \n## See also\n\n- <xref:System.Net.PeerToPeer>\n","nodes":[{"pos":[4,120],"embed":true,"restype":"x-metadata","content":"title: \"Peer Name Publication and Resolution\"\nms.date: \"03/30/2017\"\nms.assetid: f0370e08-9fa6-4ee5-ab78-9a58a20a7da2","nodes":[{"content":"Peer Name Publication and Resolution","nodes":[{"pos":[0,36],"content":"Peer Name Publication and Resolution","nodes":[{"content":"Peer Name Publication and Resolution","pos":[0,36]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[127,163],"content":"Peer Name Publication and Resolution","linkify":"Peer Name Publication and Resolution","nodes":[{"content":"Peer Name Publication and Resolution","pos":[0,36]}]},{"pos":[168,190],"content":"Publishing a peer name","linkify":"Publishing a peer name","nodes":[{"content":"Publishing a peer name","pos":[0,22]}]},{"content":"To publish a new PNRP ID, a peer performs the following:","pos":[195,251]},{"content":"Sends PNRP publication messages to its cache neighbors (the peers that have registered PNRP IDs in the lowest level of the cache) to seed their caches.","pos":[261,412]},{"content":"Chooses random nodes in the cloud that are not its neighbors and sends them PNRP name resolution requests for its own P2P ID.","pos":[422,547]},{"content":"The resulting endpoint determination process seeds the caches of random nodes in the cloud with the PNRP ID of the publishing peer.","pos":[548,679]},{"content":"PNRP version 2 nodes do not publish PNRP IDs if they are only resolving other P2P IDs.","pos":[685,771]},{"content":"The HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\PeerNet\\PNRP\\IPV6-Global\\SearchOnly=1 registry value (REG_DWORD type) specifies that peers only use PNRP for name resolution, never for name publication.","pos":[772,993]},{"content":"This registry value can also be configured through Group Policy.","pos":[994,1058]},{"pos":[1067,1088],"content":"Resolving a peer name","linkify":"Resolving a peer name","nodes":[{"content":"Resolving a peer name","pos":[0,21]}]},{"content":"Locating other peers in a PNRP network or cloud is a process comprised of two phases:","pos":[1091,1176]},{"content":"Endpoint Determination","pos":[1186,1208]},{"content":"PNRP ID Resolution","pos":[1218,1236]},{"content":"In the endpoint determination phase, a peer that is attempting to resolve the PNRP ID of a service on another computer determines the IPv6 address of that remote peer.","pos":[1243,1410]},{"content":"The remote peer is the one that published, or is associated with, the PNRP ID of the computer or service.","pos":[1412,1517]},{"content":"After confirming that the remote endpoint has been registered into the PNRP cloud, the requesting peer in the PNRP ID resolution phase sends a request to that peer endpoint for the PNRP ID of the desired service.","pos":[1524,1736]},{"content":"The endpoint sends a reply confirming the PNRP ID of the service, a comment, and up to 4 kilobytes of additional information that the requesting peer can use for future communication.","pos":[1737,1920]},{"content":"For example, if the desired endpoint is a gaming server, the additional peer name record data can contain information about the game, the level of play, and the current number of players.","pos":[1921,2108]},{"content":"In the endpoint determination phase, PNRP uses an iterative process for locating the node that published the PNRP ID, in which the node performing the resolution is responsible for contacting nodes that are successively closer to the target PNRP ID.","pos":[2115,2364]},{"content":"To perform name resolution in PNRP, the peer examines the entries in its own cache for an entry that matches the target PNRP ID.","pos":[2371,2499]},{"content":"If found, the peer sends a PNRP Request message to the peer and waits for a response.","pos":[2500,2585]},{"content":"If an entry for the PNRP ID is not found, the peer sends a PNRP Request message to the peer that corresponds to the entry that has a PNRP ID that most closely matches the target PNRP ID.","pos":[2586,2772]},{"content":"The node that receives the PNRP Request message examines its own cache and does the following:","pos":[2773,2867]},{"content":"If the PNRP ID is found, the requested endpoint peer replies directly to the requesting peer.","pos":[2877,2970]},{"content":"If the PNRP ID is not found and a PNRP ID in the cache is closer to the target PNRP ID, the requested peer sends a response to the requesting peer containing the IPv6 address of the peer that represents the entry with a PNRP ID that more closely matches the target PNRP ID.","pos":[2980,3253]},{"content":"Using the IP address in the response, the requesting node sends another PNRP Request message to the IPv6 address to respond or examine its cache.","pos":[3254,3399]},{"content":"If the PNRP ID is not found and there is no PNRP ID in its cache that is closer to the target PNRP ID, the requested peer sends the requesting peer a response that indicates this condition.","pos":[3409,3598]},{"content":"The requesting peer then chooses the next-closest PNRP ID.","pos":[3599,3657]},{"content":"The requesting peer continues this process with successive iterations, eventually locating the node that registered the PNRP ID.","pos":[3663,3791]},{"content":"Within the <ph id=\"ph1\">&lt;xref:System.Net.PeerToPeer&gt;</ph> namespace, there is a many-to-many relationship between the <ph id=\"ph2\">&lt;xref:System.Net.PeerToPeer.PeerName&gt;</ph> records that contain endpoints and PNRP clouds or meshes in which they communicate.","pos":[3798,4019],"source":"Within the <xref:System.Net.PeerToPeer> namespace, there is a many-to-many relationship between the <xref:System.Net.PeerToPeer.PeerName> records that contain endpoints and PNRP clouds or meshes in which they communicate."},{"content":"When there are duplicate or stale entries, or multiple nodes with the same peer name, PNRP nodes can obtain current information using the <ph id=\"ph1\">&lt;xref:System.Net.PeerToPeer.PeerNameResolver&gt;</ph> class.","pos":[4020,4210],"source":" When there are duplicate or stale entries, or multiple nodes with the same peer name, PNRP nodes can obtain current information using the <xref:System.Net.PeerToPeer.PeerNameResolver> class."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Net.PeerToPeer.PeerNameResolver&gt;</ph> methods use a single peer name to simplify the perspective to one peer-to-many peer name records and the same one peer to many clouds.","pos":[4211,4395],"source":" The <xref:System.Net.PeerToPeer.PeerNameResolver> methods use a single peer name to simplify the perspective to one peer-to-many peer name records and the same one peer to many clouds."},{"content":"This is similar to a query performed using a relational-table join.","pos":[4396,4463]},{"content":"Upon successful completion, the Resolver object returns a <ph id=\"ph1\">&lt;xref:System.Net.PeerToPeer.PeerNameRecordCollection&gt;</ph> for the specified peer name.","pos":[4464,4604],"source":" Upon successful completion, the Resolver object returns a <xref:System.Net.PeerToPeer.PeerNameRecordCollection> for the specified peer name."},{"content":"For example, a peer name would occur in all the peer name records in the collection, ordered by cloud.","pos":[4606,4708]},{"content":"These are the instances of the peer name whose supporting data may be requested by a PNRP-based application.","pos":[4709,4817]},{"pos":[4826,4834],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]}]}