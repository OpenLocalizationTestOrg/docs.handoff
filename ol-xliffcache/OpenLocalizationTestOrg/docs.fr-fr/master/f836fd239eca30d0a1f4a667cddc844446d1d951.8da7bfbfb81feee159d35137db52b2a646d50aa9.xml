{"content":"---\ntitle: \"Creating Application Roles in SQL Server\"\nms.date: \"03/30/2017\"\nms.assetid: 27442435-dfb2-4062-8c59-e2960833a638\n---\n# Creating Application Roles in SQL Server\nApplication roles provide a way to assign permissions to an application instead of a database role or user. Users can connect to the database, activate the application role, and assume the permissions granted to the application. The permissions granted to the application role are in force for the duration of the connection.  \n  \n> [!IMPORTANT]\n>  Application roles are activated when a client application supplies an application role name and a password in the connection string. They present a security vulnerability in a two-tier application because the password must be stored on the client computer. In a three-tier application, you can store the password so that it cannot be accessed by users of the application.  \n  \n## Application Role Features  \n Application roles have the following features:  \n  \n-   Unlike database roles, application roles contain no members.  \n  \n-   Application roles are activated when an application supplies the application role name and a password to the `sp_setapprole` system stored procedure.  \n  \n-   The password must be stored on the client computer and supplied at run time; an application role cannot be activated from inside of SQL Server.  \n  \n-   The password is not encrypted. The parameter password is stored as a one-way hash.  \n  \n-   Once activated, permissions acquired through the application role remain in effect for the duration of the connection.  \n  \n-   The application role inherits permissions granted to the `public` role.  \n  \n-   If a member of the `sysadmin` fixed server role activates an application role, the security context switches to that of the application role for the duration of the connection.  \n  \n-   If you create a `guest` account in a database that has an application role, you do not need to create a database user account for the application role or for any of the logins that invoke it. Application roles can directly access another database only if a `guest` account exists in the second database  \n  \n-   Built-in functions that return login names, such as SYSTEM_USER, return the name of the login that invoked the application role. Built-in functions that return database user names return the name of the application role.  \n  \n### The Principle of Least Privilege  \n Application roles should be granted only required permissions in case the password is compromised. Permissions to the `public` role should be revoked in any database using an application role. Disable the `guest` account in any database you do not want callers of the application role to have access to.  \n  \n### Application Role Enhancements  \n The execution context can be switched back to the original caller after activating an application role, removing the need to disable connection pooling. The `sp_setapprole` procedure has a new option that creates a cookie, which contains context information about the caller. You can revert the session by calling the `sp_unsetapprole` procedure, passing it the cookie.  \n  \n## Application Role Alternatives  \n Application roles depend on the security of a password, which presents a potential security vulnerability. Passwords may be exposed by being embedded in application code or saved on disk.  \n  \n You may want to consider the following alternatives.  \n  \n-   Use context switching with the EXECUTE AS statement with its NO REVERT and WITH COOKIE clauses. You can create a user account in a database that is not mapped to a login. You then assign permissions to this account. Using EXECUTE AS with a login-less user is more secure because it is permission-based, not password-based. For more information, see [Customizing Permissions with Impersonation in SQL Server](../../../../../docs/framework/data/adonet/sql/customizing-permissions-with-impersonation-in-sql-server.md).  \n  \n-   Sign stored procedures with certificates, granting only permission to execute the procedures. For more information, see [Signing Stored Procedures in SQL Server](../../../../../docs/framework/data/adonet/sql/signing-stored-procedures-in-sql-server.md).  \n  \n## External Resources  \n For more information, see the following resources.  \n  \n|Resource|Description|  \n|--------------|-----------------|  \n|[Application Roles](/sql/relational-databases/security/authentication-access/application-roles)|Describes how to create and use application roles in SQL Server 2008.|  \n  \n## See also\n\n- [Securing ADO.NET Applications](../../../../../docs/framework/data/adonet/securing-ado-net-applications.md)\n- [Overview of SQL Server Security](../../../../../docs/framework/data/adonet/sql/overview-of-sql-server-security.md)\n- [Application Security Scenarios in SQL Server](../../../../../docs/framework/data/adonet/sql/application-security-scenarios-in-sql-server.md)\n- [ADO.NET Managed Providers and DataSet Developer Center](https://go.microsoft.com/fwlink/?LinkId=217917)\n","nodes":[{"pos":[4,124],"embed":true,"restype":"x-metadata","content":"title: \"Creating Application Roles in SQL Server\"\nms.date: \"03/30/2017\"\nms.assetid: 27442435-dfb2-4062-8c59-e2960833a638","nodes":[{"content":"Creating Application Roles in SQL Server","nodes":[{"pos":[0,40],"content":"Creating Application Roles in SQL Server","nodes":[{"content":"Creating Application Roles in SQL Server","pos":[0,40]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[131,171],"content":"Creating Application Roles in SQL Server","linkify":"Creating Application Roles in SQL Server","nodes":[{"content":"Creating Application Roles in SQL Server","pos":[0,40]}]},{"content":"Application roles provide a way to assign permissions to an application instead of a database role or user.","pos":[172,279]},{"content":"Users can connect to the database, activate the application role, and assume the permissions granted to the application.","pos":[280,400]},{"content":"The permissions granted to the application role are in force for the duration of the connection.","pos":[401,497]},{"pos":[505,892],"content":"[!IMPORTANT]\n Application roles are activated when a client application supplies an application role name and a password in the connection string. They present a security vulnerability in a two-tier application because the password must be stored on the client computer. In a three-tier application, you can store the password so that it cannot be accessed by users of the application.","leadings":["","> "],"nodes":[{"content":"Application roles are activated when a client application supplies an application role name and a password in the connection string. They present a security vulnerability in a two-tier application because the password must be stored on the client computer. In a three-tier application, you can store the password so that it cannot be accessed by users of the application.","pos":[14,385],"nodes":[{"content":"Application roles are activated when a client application supplies an application role name and a password in the connection string.","pos":[0,132]},{"content":"They present a security vulnerability in a two-tier application because the password must be stored on the client computer.","pos":[133,256]},{"content":"In a three-tier application, you can store the password so that it cannot be accessed by users of the application.","pos":[257,371]}]}]},{"pos":[901,926],"content":"Application Role Features","linkify":"Application Role Features","nodes":[{"content":"Application Role Features","pos":[0,25]}]},{"content":"Application roles have the following features:","pos":[930,976]},{"content":"Unlike database roles, application roles contain no members.","pos":[986,1046]},{"pos":[1056,1205],"content":"Application roles are activated when an application supplies the application role name and a password to the <ph id=\"ph1\">`sp_setapprole`</ph> system stored procedure.","source":"Application roles are activated when an application supplies the application role name and a password to the `sp_setapprole` system stored procedure."},{"content":"The password must be stored on the client computer and supplied at run time; an application role cannot be activated from inside of SQL Server.","pos":[1215,1358]},{"content":"The password is not encrypted.","pos":[1368,1398]},{"content":"The parameter password is stored as a one-way hash.","pos":[1399,1450]},{"content":"Once activated, permissions acquired through the application role remain in effect for the duration of the connection.","pos":[1460,1578]},{"pos":[1588,1659],"content":"The application role inherits permissions granted to the <ph id=\"ph1\">`public`</ph> role.","source":"The application role inherits permissions granted to the `public` role."},{"pos":[1669,1845],"content":"If a member of the <ph id=\"ph1\">`sysadmin`</ph> fixed server role activates an application role, the security context switches to that of the application role for the duration of the connection.","source":"If a member of the `sysadmin` fixed server role activates an application role, the security context switches to that of the application role for the duration of the connection."},{"content":"If you create a <ph id=\"ph1\">`guest`</ph> account in a database that has an application role, you do not need to create a database user account for the application role or for any of the logins that invoke it.","pos":[1855,2046],"source":"If you create a `guest` account in a database that has an application role, you do not need to create a database user account for the application role or for any of the logins that invoke it."},{"content":"Application roles can directly access another database only if a <ph id=\"ph1\">`guest`</ph> account exists in the second database","pos":[2047,2157],"source":" Application roles can directly access another database only if a `guest` account exists in the second database"},{"content":"Built-in functions that return login names, such as SYSTEM_USER, return the name of the login that invoked the application role.","pos":[2167,2295]},{"content":"Built-in functions that return database user names return the name of the application role.","pos":[2296,2387]},{"pos":[2397,2429],"content":"The Principle of Least Privilege","linkify":"The Principle of Least Privilege","nodes":[{"content":"The Principle of Least Privilege","pos":[0,32]}]},{"content":"Application roles should be granted only required permissions in case the password is compromised.","pos":[2433,2531]},{"content":"Permissions to the <ph id=\"ph1\">`public`</ph> role should be revoked in any database using an application role.","pos":[2532,2625],"source":" Permissions to the `public` role should be revoked in any database using an application role."},{"content":"Disable the <ph id=\"ph1\">`guest`</ph> account in any database you do not want callers of the application role to have access to.","pos":[2626,2736],"source":" Disable the `guest` account in any database you do not want callers of the application role to have access to."},{"pos":[2746,2775],"content":"Application Role Enhancements","linkify":"Application Role Enhancements","nodes":[{"content":"Application Role Enhancements","pos":[0,29]}]},{"content":"The execution context can be switched back to the original caller after activating an application role, removing the need to disable connection pooling.","pos":[2779,2931]},{"content":"The <ph id=\"ph1\">`sp_setapprole`</ph> procedure has a new option that creates a cookie, which contains context information about the caller.","pos":[2932,3054],"source":" The `sp_setapprole` procedure has a new option that creates a cookie, which contains context information about the caller."},{"content":"You can revert the session by calling the <ph id=\"ph1\">`sp_unsetapprole`</ph> procedure, passing it the cookie.","pos":[3055,3148],"source":" You can revert the session by calling the `sp_unsetapprole` procedure, passing it the cookie."},{"pos":[3157,3186],"content":"Application Role Alternatives","linkify":"Application Role Alternatives","nodes":[{"content":"Application Role Alternatives","pos":[0,29]}]},{"content":"Application roles depend on the security of a password, which presents a potential security vulnerability.","pos":[3190,3296]},{"content":"Passwords may be exposed by being embedded in application code or saved on disk.","pos":[3297,3377]},{"content":"You may want to consider the following alternatives.","pos":[3384,3436]},{"content":"Use context switching with the EXECUTE AS statement with its NO REVERT and WITH COOKIE clauses.","pos":[3446,3541]},{"content":"You can create a user account in a database that is not mapped to a login.","pos":[3542,3616]},{"content":"You then assign permissions to this account.","pos":[3617,3661]},{"content":"Using EXECUTE AS with a login-less user is more secure because it is permission-based, not password-based.","pos":[3662,3768]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Customizing Permissions with Impersonation in SQL Server<ept id=\"p1\">](../../../../../docs/framework/data/adonet/sql/customizing-permissions-with-impersonation-in-sql-server.md)</ept>.","pos":[3769,3961],"source":" For more information, see [Customizing Permissions with Impersonation in SQL Server](../../../../../docs/framework/data/adonet/sql/customizing-permissions-with-impersonation-in-sql-server.md)."},{"content":"Sign stored procedures with certificates, granting only permission to execute the procedures.","pos":[3971,4064]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Signing Stored Procedures in SQL Server<ept id=\"p1\">](../../../../../docs/framework/data/adonet/sql/signing-stored-procedures-in-sql-server.md)</ept>.","pos":[4065,4223],"source":" For more information, see [Signing Stored Procedures in SQL Server](../../../../../docs/framework/data/adonet/sql/signing-stored-procedures-in-sql-server.md)."},{"pos":[4232,4250],"content":"External Resources","linkify":"External Resources","nodes":[{"content":"External Resources","pos":[0,18]}]},{"content":"For more information, see the following resources.","pos":[4254,4304]},{"content":"Resource","pos":[4311,4319]},{"content":"Description","pos":[4320,4331]},{"pos":[4373,4468],"content":"<bpt id=\"p1\">[</bpt>Application Roles<ept id=\"p1\">](/sql/relational-databases/security/authentication-access/application-roles)</ept>","source":"[Application Roles](/sql/relational-databases/security/authentication-access/application-roles)"},{"content":"Describes how to create and use application roles in SQL Server 2008.","pos":[4469,4538]},{"pos":[4548,4556],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[4560,4667],"content":"<bpt id=\"p1\">[</bpt>Securing ADO.NET Applications<ept id=\"p1\">](../../../../../docs/framework/data/adonet/securing-ado-net-applications.md)</ept>","source":"[Securing ADO.NET Applications](../../../../../docs/framework/data/adonet/securing-ado-net-applications.md)"},{"pos":[4670,4785],"content":"<bpt id=\"p1\">[</bpt>Overview of SQL Server Security<ept id=\"p1\">](../../../../../docs/framework/data/adonet/sql/overview-of-sql-server-security.md)</ept>","source":"[Overview of SQL Server Security](../../../../../docs/framework/data/adonet/sql/overview-of-sql-server-security.md)"},{"pos":[4788,4929],"content":"<bpt id=\"p1\">[</bpt>Application Security Scenarios in SQL Server<ept id=\"p1\">](../../../../../docs/framework/data/adonet/sql/application-security-scenarios-in-sql-server.md)</ept>","source":"[Application Security Scenarios in SQL Server](../../../../../docs/framework/data/adonet/sql/application-security-scenarios-in-sql-server.md)"},{"pos":[4932,5036],"content":"<bpt id=\"p1\">[</bpt>ADO.NET Managed Providers and DataSet Developer Center<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=217917)</ept>","source":"[ADO.NET Managed Providers and DataSet Developer Center](https://go.microsoft.com/fwlink/?LinkId=217917)"}]}