{"content":"---\ntitle: \"WIF Claims Programming Model\"\nms.date: \"03/30/2017\"\nms.assetid: 149cb875-9b1c-4695-b88a-fbf1725a02f9\nauthor: \"BrucePerlerMS\"\n---\n# WIF Claims Programming Model\nASP.NET and Windows Communication Foundation (WCF) developers ordinarily use the IIdentity and IPrincipal interfaces to work with the user’s identity information. In .NET 4.5, Windows Identity Foundation (WIF) has been integrated such that claims are now always present for any principal as illustrated in the following diagram:\n\n ![Diagram that shows the WIF Claims programming model.](./media/wif-claims-programming-model/wif-claims-programming-model.png)\n\n In .NET 4.5, System.Security.Claims contains the new ClaimsPrincipal and ClaimsIdentity classes (see diagram above). All principals in .NET now derive from ClaimsPrincipal. All built-in identity classes, like FormsIdentity for ASP.NET and WindowsIdentity now derive from ClaimsIdentity. Similarly, all built-in principal classes like GenericPrincipal and WindowsPrincipal derive from ClaimsPrincipal.\n\n A claim is represented by <xref:System.Security.Claims.Claim> class. This class has the following important properties:\n\n- <xref:System.Security.Claims.Claim.Type%2A> represents the type of claim and is typically a URI. For example, the email address claim is represented as `http://schemas.microsoft.com/ws/2008/06/identity/claims/email`.\n\n- <xref:System.Security.Claims.Claim.Value%2A> contains the value of the claim and is represented as a string. For example, the email address can be represented as \"someone@contoso.com\".\n\n- <xref:System.Security.Claims.Claim.ValueType%2A> represents the type of the claim value and is typically a URI. For example, the string type is represented as `http://www.w3.org/2001/XMLSchema#string`. The value type must be a QName according to the XML schema. The value should be of the format `namespace#format` to enable WIF to output a valid QName value. If the namespace is not a well-defined namespace, the generated XML probably cannot be schema validated, because there will not be a published XSD file for that namespace. The default value type is `http://www.w3.org/2001/XMLSchema#string`. For information about well-known value types that you can use safely, see the [W3C XML Schema](https://www.w3.org/2001/XMLSchema) page.\n\n- <xref:System.Security.Claims.Claim.Issuer%2A> is the identifier of the security token service (STS) that issued the claim. This can be represented as URL of the STS or a name that represents the STS, such as `https://sts1.contoso.com/sts`.\n\n- <xref:System.Security.Claims.Claim.OriginalIssuer%2A> is the identifier of the STS that originally issued the claim, regardless of how many STSs are in the chain. This is represented just like <xref:System.Security.Claims.Claim.Issuer%2A>.\n\n- <xref:System.Security.Claims.Claim.Subject%2A> is the subject whose identity is being examined. It contains a <xref:System.Security.Claims.ClaimsIdentity>.\n\n- <xref:System.Security.Claims.Claim.Properties%2A> is a dictionary that lets the developer provide application-specific data to be transferred on the wire together with the other properties, and can be used for custom validation.\n\n## Identity Delegation\nAn important property of <xref:System.Security.Claims.ClaimsIdentity> is <xref:System.Security.Claims.ClaimsIdentity.Actor%2A>. This property enables the delegation of credentials in a multi-tier system in which a middle tier acts as the client to make requests to a back-end service.\n\n### Accessing Claims through Thread.CurrentPrincipal\nTo access the current user’s set of claims in an RP application, use `Thread.CurrentPrincipal`.\n\nThe following code sample shows the usage of this method to get a System.Security.Claims.ClaimsIdentity:\n\n```csharp\nClaimsPrincipal claimsPrincipal = Thread.CurrentPrincipal as ClaimsPrincipal;\n```\n\nFor more information, see <xref:System.Security.Claims>.\n\n### Role Claim Type\nPart of configuring your RP application is to determine what your role claim type should be. This claim type is used by System.Security.Claims.ClaimsPrincipal.IsInRole(System.String). The default claim type is `http://schemas.microsoft.com/ws/2008/06/identity/claims/role`.\n\n### Claims Extracted by Windows Identity Foundation from Different Token Types\nWIF supports several combinations of authentication mechanisms out of the box. The following table lists the claims that WIF extracts from different token types.\n\n|Token Type|Claim Generated|Map To Windows Access Token|\n|-|-|-|\n|SAML 1.1|1.  All claims from System.IdentityModel.SecurityTokenService.GetOutputClaimsIdentity(System.Security.Claims.ClaimsPrincipal,System.IdentityModel.Protocols.WSTrust.RequestSecurityToken,System.IdentityModel.Scope).<br />2.  The `http://schemas.microsoft.com/ws/2008/06/identity/claims/confirmationkey` claim that contains the XML serialization of the confirmation key, if the token contains a proof token.<br />3.  The `http://schemas.microsoft.com/ws/2008/06/identity/claims/samlissuername` claim from the Issuer element.<br />4.  AuthenticationMethod and AuthenticationInstant claims, if the token contains an authentication statement.|In addition to the claims listed in \"SAML 1.1\", except claims of type  `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name`, Windows authentication related claims will be added and the identity will be represented by WindowsClaimsIdentity.|\n|SAML 2.0|Same as \"SAML 1.1\".|Same as \"SAML 1.1 Mapped to Windows Account\".|\n|X509|1.  Claims with the X500 distinguished name, emailName, dnsName, SimpleName, UpnName, UrlName, thumbprint, RsaKey (this can be extracted using the RSACryptoServiceProvider.ExportParameters method from the X509Certificate2.PublicKey.Key property), DsaKey (this can be extracted using the DSACryptoServiceProvider.ExportParameters method from the X509Certificate2.PublicKey.Key property), SerialNumber properties from the X509 Certificate.<br />2.  AuthenticationMethod claim with value `http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/x509`. AuthenticationInstant claim with the value of the time when the certificate was validated in XmlSchema DateTime format.|1.  It uses the Windows account fully qualified domain name as the `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name` claim value. .<br />2.  Claims from the X509 Certificate not mapped to Windows, and claims from the windows account obtained by mapping the certificate to Windows.|\n|UPN|1.  Claims are similar to the claims in the Windows authentication section.<br />2.  AuthenticationMethod claim with value `http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/password`. The AuthenticationInstant claim with the value of the time when the password was validated in XmlSchema DateTime format.||\n|Windows (Kerberos or NTLM)|1.  Claims generated from the access token such as: PrimarySID, DenyOnlyPrimarySID, PrimaryGroupSID, DenyOnlyPrimaryGroupSID, GroupSID, DenyOnlySID, and Name<br />2.  AuthenticationMethod with the value `http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/windows`. AuthenticationInstant with the value of the time when the Windows access token was created in the XMLSchema DateTime format.||\n|RSA Key Pair|1.  The `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/rsa` claim with the value of RSAKeyValue.<br />2.  AuthenticationMethod claim with the value `http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/signature`. AuthenticationInstant claim with the value of the time when the RSA key was authenticated (that is, the signature was verified) in the XMLSchema DateTime format.||\n\n|Authentication Type|URI emitted in \"AuthenticationMethod\" claim|\n|-|-|\n|Password|`urn:oasis:names:tc:SAML:1.0:am:password`|\n|Kerberos|`urn:ietf:rfc:1510`|\n|SecureRemotePassword|`urn:ietf:rfc:2945`|\n|TLSClient|`urn:ietf:rfc:2246`|\n|X509|`urn:oasis:names:tc:SAML:1.0:am:X509-PKI`|\n|PGP|`urn:oasis:names:tc:SAML:1.0:am:PGP`|\n|Spki|`urn:oasis:names:tc:SAML:1.0:am:SPKI`|\n|XmlDSig|`urn:ietf:rfc:3075`|\n|Unspecified|`urn:oasis:names:tc:SAML:1.0:am:unspecified`|","nodes":[{"pos":[4,136],"embed":true,"restype":"x-metadata","content":"title: \"WIF Claims Programming Model\"\nms.date: \"03/30/2017\"\nms.assetid: 149cb875-9b1c-4695-b88a-fbf1725a02f9\nauthor: \"BrucePerlerMS\"","nodes":[{"content":"WIF Claims Programming Model","nodes":[{"pos":[0,28],"content":"WIF Claims Programming Model","nodes":[{"content":"WIF Claims Programming Model","pos":[0,28]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[143,171],"content":"WIF Claims Programming Model","linkify":"WIF Claims Programming Model","nodes":[{"content":"WIF Claims Programming Model","pos":[0,28]}]},{"content":"ASP.NET and Windows Communication Foundation (WCF) developers ordinarily use the IIdentity and IPrincipal interfaces to work with the user’s identity information.","pos":[172,334]},{"content":"In .NET 4.5, Windows Identity Foundation (WIF) has been integrated such that claims are now always present for any principal as illustrated in the following diagram:","pos":[335,500]},{"content":"Diagram that shows the WIF Claims programming model.","pos":[505,557]},{"content":"In .NET 4.5, System.Security.Claims contains the new ClaimsPrincipal and ClaimsIdentity classes (see diagram above).","pos":[632,748]},{"content":"All principals in .NET now derive from ClaimsPrincipal.","pos":[749,804]},{"content":"All built-in identity classes, like FormsIdentity for ASP.NET and WindowsIdentity now derive from ClaimsIdentity.","pos":[805,918]},{"content":"Similarly, all built-in principal classes like GenericPrincipal and WindowsPrincipal derive from ClaimsPrincipal.","pos":[919,1032]},{"content":"A claim is represented by <ph id=\"ph1\">&lt;xref:System.Security.Claims.Claim&gt;</ph> class.","pos":[1035,1103],"source":"A claim is represented by <xref:System.Security.Claims.Claim> class."},{"content":"This class has the following important properties:","pos":[1104,1154]},{"content":"<ph id=\"ph1\">&lt;xref:System.Security.Claims.Claim.Type%2A&gt;</ph> represents the type of claim and is typically a URI.","pos":[1158,1254],"source":"<xref:System.Security.Claims.Claim.Type%2A> represents the type of claim and is typically a URI."},{"content":"For example, the email address claim is represented as <ph id=\"ph1\">`http://schemas.microsoft.com/ws/2008/06/identity/claims/email`</ph>.","pos":[1255,1374],"source":" For example, the email address claim is represented as `http://schemas.microsoft.com/ws/2008/06/identity/claims/email`."},{"content":"<ph id=\"ph1\">&lt;xref:System.Security.Claims.Claim.Value%2A&gt;</ph> contains the value of the claim and is represented as a string.","pos":[1378,1486],"source":"<xref:System.Security.Claims.Claim.Value%2A> contains the value of the claim and is represented as a string."},{"content":"For example, the email address can be represented as \"<ph id=\"ph1\">someone@contoso.com</ph>\".","pos":[1487,1562],"source":" For example, the email address can be represented as \"someone@contoso.com\"."},{"content":"<ph id=\"ph1\">&lt;xref:System.Security.Claims.Claim.ValueType%2A&gt;</ph> represents the type of the claim value and is typically a URI.","pos":[1566,1677],"source":"<xref:System.Security.Claims.Claim.ValueType%2A> represents the type of the claim value and is typically a URI."},{"content":"For example, the string type is represented as <ph id=\"ph1\">`http://www.w3.org/2001/XMLSchema#string`</ph>.","pos":[1678,1767],"source":" For example, the string type is represented as `http://www.w3.org/2001/XMLSchema#string`."},{"content":"The value type must be a QName according to the XML schema.","pos":[1768,1827]},{"content":"The value should be of the format <ph id=\"ph1\">`namespace#format`</ph> to enable WIF to output a valid QName value.","pos":[1828,1925],"source":" The value should be of the format `namespace#format` to enable WIF to output a valid QName value."},{"content":"If the namespace is not a well-defined namespace, the generated XML probably cannot be schema validated, because there will not be a published XSD file for that namespace.","pos":[1926,2097]},{"content":"The default value type is <ph id=\"ph1\">`http://www.w3.org/2001/XMLSchema#string`</ph>.","pos":[2098,2166],"source":" The default value type is `http://www.w3.org/2001/XMLSchema#string`."},{"content":"For information about well-known value types that you can use safely, see the <bpt id=\"p1\">[</bpt>W3C XML Schema<ept id=\"p1\">](https://www.w3.org/2001/XMLSchema)</ept> page.","pos":[2167,2302],"source":" For information about well-known value types that you can use safely, see the [W3C XML Schema](https://www.w3.org/2001/XMLSchema) page."},{"content":"<ph id=\"ph1\">&lt;xref:System.Security.Claims.Claim.Issuer%2A&gt;</ph> is the identifier of the security token service (STS) that issued the claim.","pos":[2306,2428],"source":"<xref:System.Security.Claims.Claim.Issuer%2A> is the identifier of the security token service (STS) that issued the claim."},{"content":"This can be represented as URL of the STS or a name that represents the STS, such as <ph id=\"ph1\">`https://sts1.contoso.com/sts`</ph>.","pos":[2429,2545],"source":" This can be represented as URL of the STS or a name that represents the STS, such as `https://sts1.contoso.com/sts`."},{"content":"<ph id=\"ph1\">&lt;xref:System.Security.Claims.Claim.OriginalIssuer%2A&gt;</ph> is the identifier of the STS that originally issued the claim, regardless of how many STSs are in the chain.","pos":[2549,2711],"source":"<xref:System.Security.Claims.Claim.OriginalIssuer%2A> is the identifier of the STS that originally issued the claim, regardless of how many STSs are in the chain."},{"content":"This is represented just like <ph id=\"ph1\">&lt;xref:System.Security.Claims.Claim.Issuer%2A&gt;</ph>.","pos":[2712,2788],"source":" This is represented just like <xref:System.Security.Claims.Claim.Issuer%2A>."},{"content":"<ph id=\"ph1\">&lt;xref:System.Security.Claims.Claim.Subject%2A&gt;</ph> is the subject whose identity is being examined.","pos":[2792,2887],"source":"<xref:System.Security.Claims.Claim.Subject%2A> is the subject whose identity is being examined."},{"content":"It contains a <ph id=\"ph1\">&lt;xref:System.Security.Claims.ClaimsIdentity&gt;</ph>.","pos":[2888,2947],"source":" It contains a <xref:System.Security.Claims.ClaimsIdentity>."},{"pos":[2951,3179],"content":"<ph id=\"ph1\">&lt;xref:System.Security.Claims.Claim.Properties%2A&gt;</ph> is a dictionary that lets the developer provide application-specific data to be transferred on the wire together with the other properties, and can be used for custom validation.","source":"<xref:System.Security.Claims.Claim.Properties%2A> is a dictionary that lets the developer provide application-specific data to be transferred on the wire together with the other properties, and can be used for custom validation."},{"pos":[3184,3203],"content":"Identity Delegation","linkify":"Identity Delegation","nodes":[{"content":"Identity Delegation","pos":[0,19]}]},{"content":"An important property of <ph id=\"ph1\">&lt;xref:System.Security.Claims.ClaimsIdentity&gt;</ph> is <ph id=\"ph2\">&lt;xref:System.Security.Claims.ClaimsIdentity.Actor%2A&gt;</ph>.","pos":[3204,3331],"source":"An important property of <xref:System.Security.Claims.ClaimsIdentity> is <xref:System.Security.Claims.ClaimsIdentity.Actor%2A>."},{"content":"This property enables the delegation of credentials in a multi-tier system in which a middle tier acts as the client to make requests to a back-end service.","pos":[3332,3488]},{"pos":[3494,3542],"content":"Accessing Claims through Thread.CurrentPrincipal","linkify":"Accessing Claims through Thread.CurrentPrincipal","nodes":[{"content":"Accessing Claims through Thread.CurrentPrincipal","pos":[0,48]}]},{"pos":[3543,3638],"content":"To access the current user’s set of claims in an RP application, use <ph id=\"ph1\">`Thread.CurrentPrincipal`</ph>.","source":"To access the current user’s set of claims in an RP application, use `Thread.CurrentPrincipal`."},{"content":"The following code sample shows the usage of this method to get a System.Security.Claims.ClaimsIdentity:","pos":[3640,3744]},{"pos":[3839,3895],"content":"For more information, see <ph id=\"ph1\">&lt;xref:System.Security.Claims&gt;</ph>.","source":"For more information, see <xref:System.Security.Claims>."},{"pos":[3901,3916],"content":"Role Claim Type","linkify":"Role Claim Type","nodes":[{"content":"Role Claim Type","pos":[0,15]}]},{"content":"Part of configuring your RP application is to determine what your role claim type should be.","pos":[3917,4009]},{"content":"This claim type is used by System.Security.Claims.ClaimsPrincipal.IsInRole(System.String).","pos":[4010,4100]},{"content":"The default claim type is <ph id=\"ph1\">`http://schemas.microsoft.com/ws/2008/06/identity/claims/role`</ph>.","pos":[4101,4190],"source":" The default claim type is `http://schemas.microsoft.com/ws/2008/06/identity/claims/role`."},{"pos":[4196,4270],"content":"Claims Extracted by Windows Identity Foundation from Different Token Types","linkify":"Claims Extracted by Windows Identity Foundation from Different Token Types","nodes":[{"content":"Claims Extracted by Windows Identity Foundation from Different Token Types","pos":[0,74]}]},{"content":"WIF supports several combinations of authentication mechanisms out of the box.","pos":[4271,4349]},{"content":"The following table lists the claims that WIF extracts from different token types.","pos":[4350,4432]},{"content":"Token Type","pos":[4435,4445]},{"content":"Claim Generated","pos":[4446,4461]},{"content":"Map To Windows Access Token","pos":[4462,4489]},{"content":"SAML 1.1","pos":[4500,4508]},{"content":"1.  All claims from System.IdentityModel.SecurityTokenService.GetOutputClaimsIdentity(System.Security.Claims.ClaimsPrincipal,System.IdentityModel.Protocols.WSTrust.RequestSecurityToken,System.IdentityModel.Scope).","pos":[4509,4722]},{"content":"2.  The <ph id=\"ph1\">`http://schemas.microsoft.com/ws/2008/06/identity/claims/confirmationkey`</ph> claim that contains the XML serialization of the confirmation key, if the token contains a proof token.","pos":[4728,4913],"source":"2.  The `http://schemas.microsoft.com/ws/2008/06/identity/claims/confirmationkey` claim that contains the XML serialization of the confirmation key, if the token contains a proof token."},{"content":"3.  The <ph id=\"ph1\">`http://schemas.microsoft.com/ws/2008/06/identity/claims/samlissuername`</ph> claim from the Issuer element.","pos":[4919,5030],"source":"3.  The `http://schemas.microsoft.com/ws/2008/06/identity/claims/samlissuername` claim from the Issuer element."},{"content":"4.  AuthenticationMethod and AuthenticationInstant claims, if the token contains an authentication statement.","pos":[5036,5145]},{"pos":[5146,5393],"content":"In addition to the claims listed in \"SAML 1.1\", except claims of type  <ph id=\"ph1\">`http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name`</ph>, Windows authentication related claims will be added and the identity will be represented by WindowsClaimsIdentity.","source":"In addition to the claims listed in \"SAML 1.1\", except claims of type  `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name`, Windows authentication related claims will be added and the identity will be represented by WindowsClaimsIdentity."},{"content":"SAML 2.0","pos":[5396,5404]},{"content":"Same as \"SAML 1.1\".","pos":[5405,5424]},{"content":"Same as \"SAML 1.1 Mapped to Windows Account\".","pos":[5425,5470]},{"content":"X509","pos":[5473,5477]},{"content":"1.  Claims with the X500 distinguished name, emailName, dnsName, SimpleName, UpnName, UrlName, thumbprint, RsaKey (this can be extracted using the RSACryptoServiceProvider.ExportParameters method from the X509Certificate2.PublicKey.Key property), DsaKey (this can be extracted using the DSACryptoServiceProvider.ExportParameters method from the X509Certificate2.PublicKey.Key property), SerialNumber properties from the X509 Certificate.","pos":[5478,5915]},{"content":"2.  AuthenticationMethod claim with value <ph id=\"ph1\">`http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/x509`</ph>.","pos":[5921,6040],"source":"2.  AuthenticationMethod claim with value `http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/x509`."},{"content":"AuthenticationInstant claim with the value of the time when the certificate was validated in XmlSchema DateTime format.","pos":[6041,6160]},{"content":"1.  It uses the Windows account fully qualified domain name as the <ph id=\"ph1\">`http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name`</ph> claim value.","pos":[6161,6301],"source":"1.  It uses the Windows account fully qualified domain name as the `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name` claim value."},{"content":".","pos":[6302,6303]},{"content":"2.  Claims from the X509 Certificate not mapped to Windows, and claims from the windows account obtained by mapping the certificate to Windows.","pos":[6309,6452]},{"content":"UPN","pos":[6455,6458]},{"content":"1.  Claims are similar to the claims in the Windows authentication section.","pos":[6459,6534]},{"content":"2.  AuthenticationMethod claim with value <ph id=\"ph1\">`http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/password`</ph>.","pos":[6540,6663],"source":"2.  AuthenticationMethod claim with value `http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/password`."},{"content":"The AuthenticationInstant claim with the value of the time when the password was validated in XmlSchema DateTime format.","pos":[6664,6784]},{"content":"Windows (Kerberos or NTLM)","pos":[6788,6814]},{"content":"1.  Claims generated from the access token such as: PrimarySID, DenyOnlyPrimarySID, PrimaryGroupSID, DenyOnlyPrimaryGroupSID, GroupSID, DenyOnlySID, and Name","pos":[6815,6972]},{"content":"2.  AuthenticationMethod with the value <ph id=\"ph1\">`http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/windows`</ph>.","pos":[6978,7098],"source":"2.  AuthenticationMethod with the value `http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/windows`."},{"content":"AuthenticationInstant with the value of the time when the Windows access token was created in the XMLSchema DateTime format.","pos":[7099,7223]},{"content":"RSA Key Pair","pos":[7227,7239]},{"content":"1.  The <ph id=\"ph1\">`http://schemas.xmlsoap.org/ws/2005/05/identity/claims/rsa`</ph> claim with the value of RSAKeyValue.","pos":[7240,7344],"source":"1.  The `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/rsa` claim with the value of RSAKeyValue."},{"content":"2.  AuthenticationMethod claim with the value <ph id=\"ph1\">`http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/signature`</ph>.","pos":[7350,7478],"source":"2.  AuthenticationMethod claim with the value `http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/signature`."},{"content":"AuthenticationInstant claim with the value of the time when the RSA key was authenticated (that is, the signature was verified) in the XMLSchema DateTime format.","pos":[7479,7640]},{"content":"Authentication Type","pos":[7645,7664]},{"content":"URI emitted in \"AuthenticationMethod\" claim","pos":[7665,7708]},{"content":"Password","pos":[7717,7725]},{"content":"Kerberos","pos":[7770,7778]},{"content":"SecureRemotePassword","pos":[7801,7821]},{"content":"TLSClient","pos":[7844,7853]},{"content":"X509","pos":[7876,7880]},{"content":"PGP","pos":[7925,7928]},{"content":"Spki","pos":[7968,7972]},{"content":"XmlDSig","pos":[8013,8020]},{"content":"Unspecified","pos":[8043,8054]}]}