{"content":"---\ntitle: \"Security and On-the-Fly Code Generation\"\nms.date: \"03/30/2017\"\nms.technology: dotnet-standard\nhelpviewer_keywords: \n  - \"code security, on-the-fly code generation\"\n  - \"on-the-fly code generation\"\n  - \"security [.NET Framework], on-the-fly code generation\"\n  - \"secure coding, on-the-fly code generation\"\nms.assetid: 6d221724-bb21-4d76-90c3-0ee2a2e69be2\nauthor: \"mairaw\"\nms.author: \"mairaw\"\n---\n# Security and On-the-Fly Code Generation\nSome libraries operate by generating code and running it to perform some operation for the caller. The basic problem is generating code on behalf of lesser-trust code and running it at a higher trust. The problem worsens when the caller can influence code generation, so you must ensure that only code you consider safe is generated.  \n  \n You need to know exactly what code you are generating at all times. This means that you must have strict controls on any values that you get from a user, be they quote-enclosed strings (which should be escaped so they cannot include unexpected code elements), identifiers (which should be checked to verify that they are valid identifiers), or anything else. Identifiers can be dangerous because a compiled assembly can be modified so that its identifiers contain strange characters, which will probably break it (although this is rarely a security vulnerability).  \n  \n It is recommended that you generate code with reflection emit, which often helps you avoid many of these problems.  \n  \n When you compile the code, consider whether there is some way a malicious program could modify it. Is there a small window of time during which malicious code can change source code on disk before the compiler reads it or before your code loads the .dll file? If so, you must protect the directory containing these files, using an Access Control List in the file system, as appropriate.  \n  \n## See also\n\n- [Secure Coding Guidelines](../../../docs/standard/security/secure-coding-guidelines.md)\n","nodes":[{"pos":[4,402],"embed":true,"restype":"x-metadata","content":"title: \"Security and On-the-Fly Code Generation\"\nms.date: \"03/30/2017\"\nms.technology: dotnet-standard\nhelpviewer_keywords: \n  - \"code security, on-the-fly code generation\"\n  - \"on-the-fly code generation\"\n  - \"security [.NET Framework], on-the-fly code generation\"\n  - \"secure coding, on-the-fly code generation\"\nms.assetid: 6d221724-bb21-4d76-90c3-0ee2a2e69be2\nauthor: \"mairaw\"\nms.author: \"mairaw\"","nodes":[{"content":"Security and On-the-Fly Code Generation","nodes":[{"pos":[0,39],"content":"Security and On-the-Fly Code Generation","nodes":[{"content":"Security and On-the-Fly Code Generation","pos":[0,39]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[409,448],"content":"Security and On-the-Fly Code Generation","linkify":"Security and On-the-Fly Code Generation","nodes":[{"content":"Security and On-the-Fly Code Generation","pos":[0,39]}]},{"content":"Some libraries operate by generating code and running it to perform some operation for the caller.","pos":[449,547]},{"content":"The basic problem is generating code on behalf of lesser-trust code and running it at a higher trust.","pos":[548,649]},{"content":"The problem worsens when the caller can influence code generation, so you must ensure that only code you consider safe is generated.","pos":[650,782]},{"content":"You need to know exactly what code you are generating at all times.","pos":[789,856]},{"content":"This means that you must have strict controls on any values that you get from a user, be they quote-enclosed strings (which should be escaped so they cannot include unexpected code elements), identifiers (which should be checked to verify that they are valid identifiers), or anything else.","pos":[857,1147]},{"content":"Identifiers can be dangerous because a compiled assembly can be modified so that its identifiers contain strange characters, which will probably break it (although this is rarely a security vulnerability).","pos":[1148,1353]},{"content":"It is recommended that you generate code with reflection emit, which often helps you avoid many of these problems.","pos":[1360,1474]},{"content":"When you compile the code, consider whether there is some way a malicious program could modify it.","pos":[1481,1579]},{"content":"Is there a small window of time during which malicious code can change source code on disk before the compiler reads it or before your code loads the .dll file?","pos":[1580,1740]},{"content":"If so, you must protect the directory containing these files, using an Access Control List in the file system, as appropriate.","pos":[1741,1867]},{"pos":[1876,1884],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[1888,1975],"content":"<bpt id=\"p1\">[</bpt>Secure Coding Guidelines<ept id=\"p1\">](../../../docs/standard/security/secure-coding-guidelines.md)</ept>","source":"[Secure Coding Guidelines](../../../docs/standard/security/secure-coding-guidelines.md)"}]}