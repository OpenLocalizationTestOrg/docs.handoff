{"content":"---\ntitle: \"How to: Hook Up a Delegate Using Reflection | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"events [.NET Framework], adding event handlers with reflection\"\n  - \"reflection, adding event-handler delegates\"\n  - \"delegates [.NET Framework], adding event handlers with reflection\"\nms.assetid: 076ee62d-a964-449e-a447-c31b33518b81\ncaps.latest.revision: 12\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# How to: Hook Up a Delegate Using Reflection\nWhen you use reflection to load and run assemblies, you cannot use language features like the C# `+=` operator or the Visual Basic [AddHandler statement](~/docs/visual-basic/language-reference/statements/addhandler-statement.md) to hook up events. The following procedures show how to hook up an existing method to an event by getting all the necessary types through reflection, and how to create a dynamic method using reflection emit and hook it up to an event.  \n  \n> [!NOTE]\n>  For another way to hook up an event-handling delegate, see the code example for the <xref:System.Reflection.EventInfo.AddEventHandler%2A> method of the <xref:System.Reflection.EventInfo> class.  \n  \n### To hook up a delegate using reflection  \n  \n1.  Load an assembly that contains a type that raises events. Assemblies are usually loaded with the <xref:System.Reflection.Assembly.Load%2A?displayProperty=fullName> method. To keep this example simple, a derived form in the current assembly is used, so the <xref:System.Reflection.Assembly.GetExecutingAssembly%2A> method is used to load the current assembly.  \n  \n     [!code-cpp[HookUpDelegate#3](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#3)]\n     [!code-csharp[HookUpDelegate#3](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#3)]\n     [!code-vb[HookUpDelegate#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#3)]  \n  \n2.  Get a <xref:System.Type> object representing the type, and create an instance of the type. The <xref:System.Activator.CreateInstance%28System.Type%29> method is used in the following code because the form has a default constructor. There are several other overloads of the <xref:System.Activator.CreateInstance%2A> method that you can use if the type you are creating does not have a default constructor. The new instance is stored as type <xref:System.Object> to maintain the fiction that nothing is known about the assembly. (Reflection allows you to get the types in an assembly without knowing their names in advance.)  \n  \n     [!code-cpp[HookUpDelegate#4](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#4)]\n     [!code-csharp[HookUpDelegate#4](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#4)]\n     [!code-vb[HookUpDelegate#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#4)]  \n  \n3.  Get an <xref:System.Reflection.EventInfo> object representing the event, and use the <xref:System.Reflection.EventInfo.EventHandlerType%2A> property to get the type of delegate used to handle the event. In the following code, an <xref:System.Reflection.EventInfo> for the <xref:System.Windows.Forms.Control.Click> event is obtained.  \n  \n     [!code-cpp[HookUpDelegate#5](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#5)]\n     [!code-csharp[HookUpDelegate#5](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#5)]\n     [!code-vb[HookUpDelegate#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#5)]  \n  \n4.  Get a <xref:System.Reflection.MethodInfo> object representing the method that handles the event. The complete program code in the Example section later in this topic contains a method that matches the signature of the <xref:System.EventHandler> delegate, which handles the <xref:System.Windows.Forms.Control.Click> event, but you can also generate dynamic methods at run time. For details, see the accompanying procedure, for generating an event handler at run time by using a dynamic method.  \n  \n     [!code-cpp[HookUpDelegate#6](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#6)]\n     [!code-csharp[HookUpDelegate#6](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#6)]\n     [!code-vb[HookUpDelegate#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#6)]  \n  \n5.  Create an instance of the delegate, using the <xref:System.Delegate.CreateDelegate%2A> method. This method is static (`Shared` in Visual Basic), so the delegate type must be supplied. Using the overloads of <xref:System.Delegate.CreateDelegate%2A> that take a <xref:System.Reflection.MethodInfo> is recommended.  \n  \n     [!code-cpp[HookUpDelegate#7](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#7)]\n     [!code-csharp[HookUpDelegate#7](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#7)]\n     [!code-vb[HookUpDelegate#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#7)]  \n  \n6.  Get the `add` accessor method and invoke it to hook up the event. All events have an `add` accessor and a `remove` accessor, which are hidden by the syntax of high-level languages. For example, C# uses the `+=` operator to hook up events, and Visual Basic uses the [AddHandler statement](~/docs/visual-basic/language-reference/statements/addhandler-statement.md). The following code gets the `add` accessor of the <xref:System.Windows.Forms.Control.Click> event and invokes it late-bound, passing in the delegate instance. The arguments must be passed as an array.  \n  \n     [!code-cpp[HookUpDelegate#8](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#8)]\n     [!code-csharp[HookUpDelegate#8](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#8)]\n     [!code-vb[HookUpDelegate#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#8)]  \n  \n7.  Test the event. The following code shows the form defined in the code example. Clicking the form invokes the event handler.  \n  \n     [!code-cpp[HookUpDelegate#12](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#12)]\n     [!code-csharp[HookUpDelegate#12](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#12)]\n     [!code-vb[HookUpDelegate#12](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#12)]  \n  \n<a name=\"procedureSection1\"></a>   \n### To generate an event handler at run time by using a dynamic method  \n  \n1.  Event-handler methods can be generated at run time, using lightweight dynamic methods and reflection emit. To construct an event handler, you need the return type and parameter types of the delegate. These can be obtained by examining the delegate's `Invoke` method. The following code uses the `GetDelegateReturnType` and `GetDelegateParameterTypes` methods to obtain this information. The code for these methods can be found in the Example section later in this topic.  \n  \n     It is not necessary to name a <xref:System.Reflection.Emit.DynamicMethod>, so the empty string can be used. In the following code, the last argument associates the dynamic method with the current type, giving the delegate access to all the public and private members of the `Example` class.  \n  \n     [!code-cpp[HookUpDelegate#9](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#9)]\n     [!code-csharp[HookUpDelegate#9](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#9)]\n     [!code-vb[HookUpDelegate#9](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#9)]  \n  \n2.  Generate a method body. This method loads a string, calls the overload of the <xref:System.Windows.Forms.MessageBox.Show%2A?displayProperty=fullName> method that takes a string, pops the return value off the stack (because the handler has no return type), and returns. To learn more about emitting dynamic methods, see [How to: Define and Execute Dynamic Methods](../../../docs/framework/reflection-and-codedom/how-to-define-and-execute-dynamic-methods.md).  \n  \n     [!code-cpp[HookUpDelegate#10](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#10)]\n     [!code-csharp[HookUpDelegate#10](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#10)]\n     [!code-vb[HookUpDelegate#10](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#10)]  \n  \n3.  Complete the dynamic method by calling its <xref:System.Reflection.Emit.DynamicMethod.CreateDelegate%2A> method. Use the `add` accessor to add the delegate to the invocation list for the event.  \n  \n     [!code-cpp[HookUpDelegate#11](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#11)]\n     [!code-csharp[HookUpDelegate#11](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#11)]\n     [!code-vb[HookUpDelegate#11](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#11)]  \n  \n4.  Test the event. The following code loads the form defined in the code example. Clicking the form invokes both the predefined event handler and the emitted event handler.  \n  \n     [!code-cpp[HookUpDelegate#12](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#12)]\n     [!code-csharp[HookUpDelegate#12](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#12)]\n     [!code-vb[HookUpDelegate#12](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#12)]  \n  \n## Example  \n The following code example shows how to hook up an existing method to an event using reflection, and also how to use the <xref:System.Reflection.Emit.DynamicMethod> class to emit a method at run time and hook it up to an event.  \n  \n [!code-cpp[HookUpDelegate#1](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#1)]\n [!code-csharp[HookUpDelegate#1](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#1)]\n [!code-vb[HookUpDelegate#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#1)]  \n  \n## Compiling the Code  \n  \n-   The code contains the C# `using` statements (`Imports` in Visual Basic) necessary for compilation.  \n  \n-   No additional assembly references are required for compiling from the command line. In Visual Studio you must add a reference to System.Windows.Forms.dll because this example is a console application.  \n  \n-   Compile the code at the command line using csc.exe, vbc.exe, or cl.exe. To compile the code in Visual Studio, place it in a console application project template.  \n  \n## See Also  \n <xref:System.Reflection.Assembly.Load%2A?displayProperty=fullName>   \n <xref:System.Reflection.Emit.DynamicMethod>   \n <xref:System.Activator.CreateInstance%2A>   \n <xref:System.Delegate.CreateDelegate%2A>   \n [How to: Define and Execute Dynamic Methods](../../../docs/framework/reflection-and-codedom/how-to-define-and-execute-dynamic-methods.md)   \n [Reflection](../../../docs/framework/reflection-and-codedom/reflection.md)","nodes":[{"pos":[12,72],"content":"How to: Hook Up a Delegate Using Reflection | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"How to: Hook Up a Delegate Using Reflection | Microsoft Docs","pos":[0,60]}]},{"pos":[588,631],"content":"How to: Hook Up a Delegate Using Reflection","linkify":"How to: Hook Up a Delegate Using Reflection","nodes":[{"content":"How to: Hook Up a Delegate Using Reflection","pos":[0,43]}]},{"content":"When you use reflection to load and run assemblies, you cannot use language features like the C# <ph id=\"ph1\">`+=`</ph> operator or the Visual Basic <bpt id=\"p1\">[</bpt>AddHandler statement<ept id=\"p1\">](~/docs/visual-basic/language-reference/statements/addhandler-statement.md)</ept> to hook up events.","pos":[632,879],"source":"When you use reflection to load and run assemblies, you cannot use language features like the C# `+=` operator or the Visual Basic [AddHandler statement](~/docs/visual-basic/language-reference/statements/addhandler-statement.md) to hook up events."},{"content":"The following procedures show how to hook up an existing method to an event by getting all the necessary types through reflection, and how to create a dynamic method using reflection emit and hook it up to an event.","pos":[880,1095]},{"pos":[1103,1307],"content":"[!NOTE]\n For another way to hook up an event-handling delegate, see the code example for the <xref:System.Reflection.EventInfo.AddEventHandler%2A> method of the <xref:System.Reflection.EventInfo> class.","leadings":["","> "],"nodes":[{"content":"For another way to hook up an event-handling delegate, see the code example for the <ph id=\"ph1\">&lt;xref:System.Reflection.EventInfo.AddEventHandler%2A&gt;</ph> method of the <ph id=\"ph2\">&lt;xref:System.Reflection.EventInfo&gt;</ph> class.","pos":[9,202],"source":" For another way to hook up an event-handling delegate, see the code example for the <xref:System.Reflection.EventInfo.AddEventHandler%2A> method of the <xref:System.Reflection.EventInfo> class."}]},{"pos":[1317,1355],"content":"To hook up a delegate using reflection","linkify":"To hook up a delegate using reflection","nodes":[{"content":"To hook up a delegate using reflection","pos":[0,38]}]},{"content":"Load an assembly that contains a type that raises events.","pos":[1365,1422]},{"content":"Assemblies are usually loaded with the <ph id=\"ph1\">&lt;xref:System.Reflection.Assembly.Load%2A?displayProperty=fullName&gt;</ph> method.","pos":[1423,1536],"source":" Assemblies are usually loaded with the <xref:System.Reflection.Assembly.Load%2A?displayProperty=fullName> method."},{"content":"To keep this example simple, a derived form in the current assembly is used, so the <ph id=\"ph1\">&lt;xref:System.Reflection.Assembly.GetExecutingAssembly%2A&gt;</ph> method is used to load the current assembly.","pos":[1537,1723],"source":" To keep this example simple, a derived form in the current assembly is used, so the <xref:System.Reflection.Assembly.GetExecutingAssembly%2A> method is used to load the current assembly."},{"pos":[1734,2079],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>HookUpDelegate#3<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#3)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>HookUpDelegate#3<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#3)</ept><ept id=\"p3\">]</ept>  <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>HookUpDelegate#3<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#3)</ept><ept id=\"p5\">]</ept>","leadings":["","    ","    "],"source":"[!code-cpp[HookUpDelegate#3](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#3)]\n [!code-csharp[HookUpDelegate#3](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#3)]\n [!code-vb[HookUpDelegate#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#3)]"},{"content":"Get a <ph id=\"ph1\">&lt;xref:System.Type&gt;</ph> object representing the type, and create an instance of the type.","pos":[2089,2179],"source":"Get a <xref:System.Type> object representing the type, and create an instance of the type."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Activator.CreateInstance%28System.Type%29&gt;</ph> method is used in the following code because the form has a default constructor.","pos":[2180,2320],"source":" The <xref:System.Activator.CreateInstance%28System.Type%29> method is used in the following code because the form has a default constructor."},{"content":"There are several other overloads of the <ph id=\"ph1\">&lt;xref:System.Activator.CreateInstance%2A&gt;</ph> method that you can use if the type you are creating does not have a default constructor.","pos":[2321,2493],"source":" There are several other overloads of the <xref:System.Activator.CreateInstance%2A> method that you can use if the type you are creating does not have a default constructor."},{"content":"The new instance is stored as type <ph id=\"ph1\">&lt;xref:System.Object&gt;</ph> to maintain the fiction that nothing is known about the assembly.","pos":[2494,2615],"source":" The new instance is stored as type <xref:System.Object> to maintain the fiction that nothing is known about the assembly."},{"content":"(Reflection allows you to get the types in an assembly without knowing their names in advance.)","pos":[2616,2711]},{"pos":[2722,3067],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>HookUpDelegate#4<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#4)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>HookUpDelegate#4<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#4)</ept><ept id=\"p3\">]</ept>  <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>HookUpDelegate#4<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#4)</ept><ept id=\"p5\">]</ept>","leadings":["","    ","    "],"source":"[!code-cpp[HookUpDelegate#4](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#4)]\n [!code-csharp[HookUpDelegate#4](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#4)]\n [!code-vb[HookUpDelegate#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#4)]"},{"content":"Get an <ph id=\"ph1\">&lt;xref:System.Reflection.EventInfo&gt;</ph> object representing the event, and use the <ph id=\"ph2\">&lt;xref:System.Reflection.EventInfo.EventHandlerType%2A&gt;</ph> property to get the type of delegate used to handle the event.","pos":[3077,3279],"source":"Get an <xref:System.Reflection.EventInfo> object representing the event, and use the <xref:System.Reflection.EventInfo.EventHandlerType%2A> property to get the type of delegate used to handle the event."},{"content":"In the following code, an <ph id=\"ph1\">&lt;xref:System.Reflection.EventInfo&gt;</ph> for the <ph id=\"ph2\">&lt;xref:System.Windows.Forms.Control.Click&gt;</ph> event is obtained.","pos":[3280,3409],"source":" In the following code, an <xref:System.Reflection.EventInfo> for the <xref:System.Windows.Forms.Control.Click> event is obtained."},{"pos":[3420,3765],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>HookUpDelegate#5<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#5)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>HookUpDelegate#5<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#5)</ept><ept id=\"p3\">]</ept>  <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>HookUpDelegate#5<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#5)</ept><ept id=\"p5\">]</ept>","leadings":["","    ","    "],"source":"[!code-cpp[HookUpDelegate#5](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#5)]\n [!code-csharp[HookUpDelegate#5](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#5)]\n [!code-vb[HookUpDelegate#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#5)]"},{"content":"Get a <ph id=\"ph1\">&lt;xref:System.Reflection.MethodInfo&gt;</ph> object representing the method that handles the event.","pos":[3775,3871],"source":"Get a <xref:System.Reflection.MethodInfo> object representing the method that handles the event."},{"content":"The complete program code in the Example section later in this topic contains a method that matches the signature of the <ph id=\"ph1\">&lt;xref:System.EventHandler&gt;</ph> delegate, which handles the <ph id=\"ph2\">&lt;xref:System.Windows.Forms.Control.Click&gt;</ph> event, but you can also generate dynamic methods at run time.","pos":[3872,4151],"source":" The complete program code in the Example section later in this topic contains a method that matches the signature of the <xref:System.EventHandler> delegate, which handles the <xref:System.Windows.Forms.Control.Click> event, but you can also generate dynamic methods at run time."},{"content":"For details, see the accompanying procedure, for generating an event handler at run time by using a dynamic method.","pos":[4152,4267]},{"pos":[4278,4623],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>HookUpDelegate#6<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#6)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>HookUpDelegate#6<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#6)</ept><ept id=\"p3\">]</ept>  <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>HookUpDelegate#6<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#6)</ept><ept id=\"p5\">]</ept>","leadings":["","    ","    "],"source":"[!code-cpp[HookUpDelegate#6](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#6)]\n [!code-csharp[HookUpDelegate#6](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#6)]\n [!code-vb[HookUpDelegate#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#6)]"},{"content":"Create an instance of the delegate, using the <ph id=\"ph1\">&lt;xref:System.Delegate.CreateDelegate%2A&gt;</ph> method.","pos":[4633,4727],"source":"Create an instance of the delegate, using the <xref:System.Delegate.CreateDelegate%2A> method."},{"content":"This method is static (<ph id=\"ph1\">`Shared`</ph> in Visual Basic), so the delegate type must be supplied.","pos":[4728,4816],"source":" This method is static (`Shared` in Visual Basic), so the delegate type must be supplied."},{"content":"Using the overloads of <ph id=\"ph1\">&lt;xref:System.Delegate.CreateDelegate%2A&gt;</ph> that take a <ph id=\"ph2\">&lt;xref:System.Reflection.MethodInfo&gt;</ph> is recommended.","pos":[4817,4944],"source":" Using the overloads of <xref:System.Delegate.CreateDelegate%2A> that take a <xref:System.Reflection.MethodInfo> is recommended."},{"pos":[4955,5300],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>HookUpDelegate#7<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#7)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>HookUpDelegate#7<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#7)</ept><ept id=\"p3\">]</ept>  <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>HookUpDelegate#7<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#7)</ept><ept id=\"p5\">]</ept>","leadings":["","    ","    "],"source":"[!code-cpp[HookUpDelegate#7](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#7)]\n [!code-csharp[HookUpDelegate#7](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#7)]\n [!code-vb[HookUpDelegate#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#7)]"},{"content":"Get the <ph id=\"ph1\">`add`</ph> accessor method and invoke it to hook up the event.","pos":[5310,5375],"source":"Get the `add` accessor method and invoke it to hook up the event."},{"content":"All events have an <ph id=\"ph1\">`add`</ph> accessor and a <ph id=\"ph2\">`remove`</ph> accessor, which are hidden by the syntax of high-level languages.","pos":[5376,5490],"source":" All events have an `add` accessor and a `remove` accessor, which are hidden by the syntax of high-level languages."},{"content":"For example, C# uses the <ph id=\"ph1\">`+=`</ph> operator to hook up events, and Visual Basic uses the <bpt id=\"p1\">[</bpt>AddHandler statement<ept id=\"p1\">](~/docs/visual-basic/language-reference/statements/addhandler-statement.md)</ept>.","pos":[5491,5673],"source":" For example, C# uses the `+=` operator to hook up events, and Visual Basic uses the [AddHandler statement](~/docs/visual-basic/language-reference/statements/addhandler-statement.md)."},{"content":"The following code gets the <ph id=\"ph1\">`add`</ph> accessor of the <ph id=\"ph2\">&lt;xref:System.Windows.Forms.Control.Click&gt;</ph> event and invokes it late-bound, passing in the delegate instance.","pos":[5674,5832],"source":" The following code gets the `add` accessor of the <xref:System.Windows.Forms.Control.Click> event and invokes it late-bound, passing in the delegate instance."},{"content":"The arguments must be passed as an array.","pos":[5833,5874]},{"pos":[5885,6230],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>HookUpDelegate#8<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#8)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>HookUpDelegate#8<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#8)</ept><ept id=\"p3\">]</ept>  <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>HookUpDelegate#8<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#8)</ept><ept id=\"p5\">]</ept>","leadings":["","    ","    "],"source":"[!code-cpp[HookUpDelegate#8](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#8)]\n [!code-csharp[HookUpDelegate#8](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#8)]\n [!code-vb[HookUpDelegate#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#8)]"},{"content":"Test the event.","pos":[6240,6255]},{"content":"The following code shows the form defined in the code example.","pos":[6256,6318]},{"content":"Clicking the form invokes the event handler.","pos":[6319,6363]},{"pos":[6374,6725],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>HookUpDelegate#12<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#12)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>HookUpDelegate#12<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#12)</ept><ept id=\"p3\">]</ept>  <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>HookUpDelegate#12<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#12)</ept><ept id=\"p5\">]</ept>","leadings":["","    ","    "],"source":"[!code-cpp[HookUpDelegate#12](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#12)]\n [!code-csharp[HookUpDelegate#12](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#12)]\n [!code-vb[HookUpDelegate#12](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#12)]"},{"pos":[6771,6837],"content":"To generate an event handler at run time by using a dynamic method","linkify":"To generate an event handler at run time by using a dynamic method","nodes":[{"content":"To generate an event handler at run time by using a dynamic method","pos":[0,66]}]},{"content":"Event-handler methods can be generated at run time, using lightweight dynamic methods and reflection emit.","pos":[6847,6953]},{"content":"To construct an event handler, you need the return type and parameter types of the delegate.","pos":[6954,7046]},{"content":"These can be obtained by examining the delegate's <ph id=\"ph1\">`Invoke`</ph> method.","pos":[7047,7113],"source":" These can be obtained by examining the delegate's `Invoke` method."},{"content":"The following code uses the <ph id=\"ph1\">`GetDelegateReturnType`</ph> and <ph id=\"ph2\">`GetDelegateParameterTypes`</ph> methods to obtain this information.","pos":[7114,7233],"source":" The following code uses the `GetDelegateReturnType` and `GetDelegateParameterTypes` methods to obtain this information."},{"content":"The code for these methods can be found in the Example section later in this topic.","pos":[7234,7317]},{"content":"It is not necessary to name a <ph id=\"ph1\">&lt;xref:System.Reflection.Emit.DynamicMethod&gt;</ph>, so the empty string can be used.","pos":[7328,7435],"source":"It is not necessary to name a <xref:System.Reflection.Emit.DynamicMethod>, so the empty string can be used."},{"content":"In the following code, the last argument associates the dynamic method with the current type, giving the delegate access to all the public and private members of the <ph id=\"ph1\">`Example`</ph> class.","pos":[7436,7618],"source":" In the following code, the last argument associates the dynamic method with the current type, giving the delegate access to all the public and private members of the `Example` class."},{"pos":[7629,7974],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>HookUpDelegate#9<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#9)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>HookUpDelegate#9<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#9)</ept><ept id=\"p3\">]</ept>  <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>HookUpDelegate#9<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#9)</ept><ept id=\"p5\">]</ept>","leadings":["","    ","    "],"source":"[!code-cpp[HookUpDelegate#9](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#9)]\n [!code-csharp[HookUpDelegate#9](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#9)]\n [!code-vb[HookUpDelegate#9](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#9)]"},{"content":"Generate a method body.","pos":[7984,8007]},{"content":"This method loads a string, calls the overload of the <ph id=\"ph1\">&lt;xref:System.Windows.Forms.MessageBox.Show%2A?displayProperty=fullName&gt;</ph> method that takes a string, pops the return value off the stack (because the handler has no return type), and returns.","pos":[8008,8252],"source":" This method loads a string, calls the overload of the <xref:System.Windows.Forms.MessageBox.Show%2A?displayProperty=fullName> method that takes a string, pops the return value off the stack (because the handler has no return type), and returns."},{"content":"To learn more about emitting dynamic methods, see <bpt id=\"p1\">[</bpt>How to: Define and Execute Dynamic Methods<ept id=\"p1\">](../../../docs/framework/reflection-and-codedom/how-to-define-and-execute-dynamic-methods.md)</ept>.","pos":[8253,8441],"source":" To learn more about emitting dynamic methods, see [How to: Define and Execute Dynamic Methods](../../../docs/framework/reflection-and-codedom/how-to-define-and-execute-dynamic-methods.md)."},{"pos":[8452,8803],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>HookUpDelegate#10<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#10)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>HookUpDelegate#10<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#10)</ept><ept id=\"p3\">]</ept>  <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>HookUpDelegate#10<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#10)</ept><ept id=\"p5\">]</ept>","leadings":["","    ","    "],"source":"[!code-cpp[HookUpDelegate#10](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#10)]\n [!code-csharp[HookUpDelegate#10](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#10)]\n [!code-vb[HookUpDelegate#10](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#10)]"},{"content":"Complete the dynamic method by calling its <ph id=\"ph1\">&lt;xref:System.Reflection.Emit.DynamicMethod.CreateDelegate%2A&gt;</ph> method.","pos":[8813,8925],"source":"Complete the dynamic method by calling its <xref:System.Reflection.Emit.DynamicMethod.CreateDelegate%2A> method."},{"content":"Use the <ph id=\"ph1\">`add`</ph> accessor to add the delegate to the invocation list for the event.","pos":[8926,9006],"source":" Use the `add` accessor to add the delegate to the invocation list for the event."},{"pos":[9017,9368],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>HookUpDelegate#11<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#11)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>HookUpDelegate#11<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#11)</ept><ept id=\"p3\">]</ept>  <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>HookUpDelegate#11<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#11)</ept><ept id=\"p5\">]</ept>","leadings":["","    ","    "],"source":"[!code-cpp[HookUpDelegate#11](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#11)]\n [!code-csharp[HookUpDelegate#11](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#11)]\n [!code-vb[HookUpDelegate#11](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#11)]"},{"content":"Test the event.","pos":[9378,9393]},{"content":"The following code loads the form defined in the code example.","pos":[9394,9456]},{"content":"Clicking the form invokes both the predefined event handler and the emitted event handler.","pos":[9457,9547]},{"pos":[9558,9909],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>HookUpDelegate#12<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#12)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>HookUpDelegate#12<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#12)</ept><ept id=\"p3\">]</ept>  <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>HookUpDelegate#12<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#12)</ept><ept id=\"p5\">]</ept>","leadings":["","    ","    "],"source":"[!code-cpp[HookUpDelegate#12](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#12)]\n [!code-csharp[HookUpDelegate#12](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#12)]\n [!code-vb[HookUpDelegate#12](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#12)]"},{"pos":[9918,9925],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following code example shows how to hook up an existing method to an event using reflection, and also how to use the <ph id=\"ph1\">&lt;xref:System.Reflection.Emit.DynamicMethod&gt;</ph> class to emit a method at run time and hook it up to an event.","pos":[9929,10156],"source":"The following code example shows how to hook up an existing method to an event using reflection, and also how to use the <xref:System.Reflection.Emit.DynamicMethod> class to emit a method at run time and hook it up to an event."},{"pos":[10163,10500],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>HookUpDelegate#1<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#1)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>HookUpDelegate#1<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#1)</ept><ept id=\"p3\">]</ept> <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>HookUpDelegate#1<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#1)</ept><ept id=\"p5\">]</ept>","source":"[!code-cpp[HookUpDelegate#1](../../../samples/snippets/cpp/VS_Snippets_CLR/HookUpDelegate/cpp/source.cpp#1)]\n [!code-csharp[HookUpDelegate#1](../../../samples/snippets/csharp/VS_Snippets_CLR/HookUpDelegate/cs/source.cs#1)]\n [!code-vb[HookUpDelegate#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HookUpDelegate/vb/source.vb#1)]"},{"pos":[10509,10527],"content":"Compiling the Code","linkify":"Compiling the Code","nodes":[{"content":"Compiling the Code","pos":[0,18]}]},{"pos":[10537,10635],"content":"The code contains the C# <ph id=\"ph1\">`using`</ph> statements (<ph id=\"ph2\">`Imports`</ph> in Visual Basic) necessary for compilation.","source":"The code contains the C# `using` statements (`Imports` in Visual Basic) necessary for compilation."},{"content":"No additional assembly references are required for compiling from the command line.","pos":[10645,10728]},{"content":"In Visual Studio you must add a reference to System.Windows.Forms.dll because this example is a console application.","pos":[10729,10845]},{"content":"Compile the code at the command line using csc.exe, vbc.exe, or cl.exe.","pos":[10855,10926]},{"content":"To compile the code in Visual Studio, place it in a console application project template.","pos":[10927,11016]},{"pos":[11025,11033],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.Reflection.Assembly.Load%2A?displayProperty=fullName&gt;</ph>","pos":[11037,11103],"source":"<xref:System.Reflection.Assembly.Load%2A?displayProperty=fullName> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Reflection.Emit.DynamicMethod&gt;</ph>","pos":[11108,11151],"source":" <xref:System.Reflection.Emit.DynamicMethod> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Activator.CreateInstance%2A&gt;</ph>","pos":[11156,11197],"source":" <xref:System.Activator.CreateInstance%2A> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Delegate.CreateDelegate%2A&gt;</ph>","pos":[11202,11242],"source":" <xref:System.Delegate.CreateDelegate%2A> "},{"content":"<bpt id=\"p1\"> [</bpt>How to: Define and Execute Dynamic Methods<ept id=\"p1\">](../../../docs/framework/reflection-and-codedom/how-to-define-and-execute-dynamic-methods.md)</ept><ph id=\"ph1\"> </ph>","pos":[11246,11385],"source":" [How to: Define and Execute Dynamic Methods](../../../docs/framework/reflection-and-codedom/how-to-define-and-execute-dynamic-methods.md) "},{"content":"<bpt id=\"p1\"> [</bpt>Reflection<ept id=\"p1\">](../../../docs/framework/reflection-and-codedom/reflection.md)</ept>","pos":[11388,11463],"source":" [Reflection](../../../docs/framework/reflection-and-codedom/reflection.md)"}]}