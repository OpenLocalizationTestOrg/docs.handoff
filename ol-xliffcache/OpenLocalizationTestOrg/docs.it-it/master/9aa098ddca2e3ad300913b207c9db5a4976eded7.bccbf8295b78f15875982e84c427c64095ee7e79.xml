{"content":"---\ntitle: \"How to: Query for the Total Number of Bytes in a Set of Folders (LINQ) (Visual Basic)\"\nms.date: 07/20/2015\nms.assetid: bfe85ed2-44dc-4ef1-aac7-241622b80a69\n---\n# How to: Query for the Total Number of Bytes in a Set of Folders (LINQ) (Visual Basic)\nThis example shows how to retrieve the total number of bytes used by all the files in a specified folder and all its subfolders.  \n  \n## Example  \n The <xref:System.Linq.Enumerable.Sum%2A> method adds the values of all the items selected in the `select` clause. You can easily modify this query to retrieve the biggest or smallest file in the specified directory tree by calling the <xref:System.Linq.Enumerable.Min%2A> or <xref:System.Linq.Enumerable.Max%2A> method instead of <xref:System.Linq.Enumerable.Sum%2A>.  \n  \n```vb  \nModule QueryTotalBytes  \n    Sub Main()  \n  \n        ' Change the drive\\path if necessary.  \n        Dim root As String = \"C:\\Program Files\\Microsoft Visual Studio 9.0\\VB\"  \n  \n        'Take a snapshot of the folder contents.  \n        ' This method assumes that the application has discovery permissions  \n        ' for all folders under the specified path.  \n        Dim fileList = My.Computer.FileSystem.GetFiles _  \n                  (root, FileIO.SearchOption.SearchAllSubDirectories, \"*.*\")  \n  \n        Dim fileQuery = From file In fileList _  \n                        Select GetFileLength(file)  \n  \n        ' Force execution and cache the results to avoid multiple trips to the file system.  \n        Dim fileLengths = fileQuery.ToArray()  \n  \n        ' Find the largest file  \n        Dim maxSize = Aggregate aFile In fileLengths Into Max()  \n  \n        ' Find the total number of bytes  \n        Dim totalBytes = Aggregate aFile In fileLengths Into Sum()  \n  \n        Console.WriteLine(\"The largest file is \" & maxSize & \" bytes\")  \n        Console.WriteLine(\"There are \" & totalBytes & \" total bytes in \" & _  \n                          fileList.Count & \" files under \" & root)  \n  \n        ' Keep the console window open in debug mode  \n        Console.WriteLine(\"Press any key to exit.\")  \n        Console.ReadKey()  \n    End Sub  \n  \n    ' This method is used to catch the possible exception  \n    ' that can be raised when accessing the FileInfo.Length property.  \n    Function GetFileLength(ByVal filename As String) As Long  \n        Dim retval As Long  \n        Try  \n            Dim fi As New System.IO.FileInfo(filename)  \n            retval = fi.Length  \n        Catch ex As System.IO.FileNotFoundException  \n            ' If a file is no longer present,  \n            ' just return zero bytes.   \n            retval = 0  \n        End Try  \n  \n        Return retval  \n    End Function  \nEnd Module  \n```  \n  \n If you only have to count the number of bytes in a specified directory tree, you can do this more efficiently without creating a LINQ query, which incurs the overhead of creating the list collection as a data source. The usefulness of the LINQ approach increases as the query becomes more complex, or when you have to run multiple queries against the same data source.  \n  \n The query calls out to a separate method to obtain the file length. It does this in order to consume the possible exception that will be raised if the file was deleted on another thread after the <xref:System.IO.FileInfo> object was created in the call to `GetFiles`. Even though the <xref:System.IO.FileInfo> object has already been created, the exception can occur because a <xref:System.IO.FileInfo> object will try to refresh its <xref:System.IO.FileInfo.Length%2A> property with the most current length the first time the property is accessed. By putting this operation in a try-catch block outside the query, the code follows the rule of avoiding operations in queries that can cause side-effects. In general, great care must be taken when you consume exceptions to make sure that an application is not left in an unknown state.  \n  \n## Compiling the Code  \n Create a project that targets the .NET Framework version 3.5 or higher with a reference to System.Core.dll and a   `Imports` statement for the System.Linq namespace.  \n  \n## See also\n\n- [LINQ to Objects (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/linq-to-objects.md)\n- [LINQ and File Directories (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/linq-and-file-directories.md)\n","nodes":[{"pos":[4,167],"embed":true,"restype":"x-metadata","content":"title: \"How to: Query for the Total Number of Bytes in a Set of Folders (LINQ) (Visual Basic)\"\nms.date: 07/20/2015\nms.assetid: bfe85ed2-44dc-4ef1-aac7-241622b80a69","nodes":[{"content":"How to: Query for the Total Number of Bytes in a Set of Folders (LINQ) (Visual Basic)","nodes":[{"pos":[0,85],"content":"How to: Query for the Total Number of Bytes in a Set of Folders (LINQ) (Visual Basic)","nodes":[{"content":"How to: Query for the Total Number of Bytes in a Set of Folders (LINQ) (Visual Basic)","pos":[0,85]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[174,259],"content":"How to: Query for the Total Number of Bytes in a Set of Folders (LINQ) (Visual Basic)","linkify":"How to: Query for the Total Number of Bytes in a Set of Folders (LINQ) (Visual Basic)","nodes":[{"content":"How to: Query for the Total Number of Bytes in a Set of Folders (LINQ) (Visual Basic)","pos":[0,85]}]},{"content":"This example shows how to retrieve the total number of bytes used by all the files in a specified folder and all its subfolders.","pos":[260,388]},{"pos":[397,404],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Linq.Enumerable.Sum%2A&gt;</ph> method adds the values of all the items selected in the <ph id=\"ph2\">`select`</ph> clause.","pos":[408,521],"source":"The <xref:System.Linq.Enumerable.Sum%2A> method adds the values of all the items selected in the `select` clause."},{"content":"You can easily modify this query to retrieve the biggest or smallest file in the specified directory tree by calling the <ph id=\"ph1\">&lt;xref:System.Linq.Enumerable.Min%2A&gt;</ph> or <ph id=\"ph2\">&lt;xref:System.Linq.Enumerable.Max%2A&gt;</ph> method instead of <ph id=\"ph3\">&lt;xref:System.Linq.Enumerable.Sum%2A&gt;</ph>.","pos":[522,775],"source":" You can easily modify this query to retrieve the biggest or smallest file in the specified directory tree by calling the <xref:System.Linq.Enumerable.Min%2A> or <xref:System.Linq.Enumerable.Max%2A> method instead of <xref:System.Linq.Enumerable.Sum%2A>."},{"content":"If you only have to count the number of bytes in a specified directory tree, you can do this more efficiently without creating a LINQ query, which incurs the overhead of creating the list collection as a data source.","pos":[2721,2937]},{"content":"The usefulness of the LINQ approach increases as the query becomes more complex, or when you have to run multiple queries against the same data source.","pos":[2938,3089]},{"content":"The query calls out to a separate method to obtain the file length.","pos":[3096,3163]},{"content":"It does this in order to consume the possible exception that will be raised if the file was deleted on another thread after the <ph id=\"ph1\">&lt;xref:System.IO.FileInfo&gt;</ph> object was created in the call to <ph id=\"ph2\">`GetFiles`</ph>.","pos":[3164,3363],"source":" It does this in order to consume the possible exception that will be raised if the file was deleted on another thread after the <xref:System.IO.FileInfo> object was created in the call to `GetFiles`."},{"content":"Even though the <ph id=\"ph1\">&lt;xref:System.IO.FileInfo&gt;</ph> object has already been created, the exception can occur because a <ph id=\"ph2\">&lt;xref:System.IO.FileInfo&gt;</ph> object will try to refresh its <ph id=\"ph3\">&lt;xref:System.IO.FileInfo.Length%2A&gt;</ph> property with the most current length the first time the property is accessed.","pos":[3364,3644],"source":" Even though the <xref:System.IO.FileInfo> object has already been created, the exception can occur because a <xref:System.IO.FileInfo> object will try to refresh its <xref:System.IO.FileInfo.Length%2A> property with the most current length the first time the property is accessed."},{"content":"By putting this operation in a try-catch block outside the query, the code follows the rule of avoiding operations in queries that can cause side-effects.","pos":[3645,3799]},{"content":"In general, great care must be taken when you consume exceptions to make sure that an application is not left in an unknown state.","pos":[3800,3930]},{"pos":[3939,3957],"content":"Compiling the Code","linkify":"Compiling the Code","nodes":[{"content":"Compiling the Code","pos":[0,18]}]},{"pos":[3961,4126],"content":"Create a project that targets the .NET Framework version 3.5 or higher with a reference to System.Core.dll and a   <ph id=\"ph1\">`Imports`</ph> statement for the System.Linq namespace.","source":"Create a project that targets the .NET Framework version 3.5 or higher with a reference to System.Core.dll and a   `Imports` statement for the System.Linq namespace."},{"pos":[4135,4143],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[4147,4256],"content":"<bpt id=\"p1\">[</bpt>LINQ to Objects (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/linq/linq-to-objects.md)</ept>","source":"[LINQ to Objects (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/linq-to-objects.md)"},{"pos":[4259,4388],"content":"<bpt id=\"p1\">[</bpt>LINQ and File Directories (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/linq/linq-and-file-directories.md)</ept>","source":"[LINQ and File Directories (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/linq-and-file-directories.md)"}]}