{"content":"---\ntitle: \"How to: Handle Exceptions in a PLINQ Query | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"PLINQ queries, how to handle exceptions\"\nms.assetid: 8d56ff9b-a571-4d31-b41f-80c0b51b70a5\ncaps.latest.revision: 13\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# How to: Handle Exceptions in a PLINQ Query\nThe first example in this topic shows how to handle the <xref:System.AggregateException?displayProperty=fullName> that can be thrown from a PLINQ query when it executes. The second example shows how to put try-catch blocks within delegates, as close as possible to where the exception will be thrown. In this way, you can catch them as soon as they occur and possibly continue query execution. When exceptions are allowed to bubble up back to the joining thread, then it is possible that a query may continue to process some items after the exception is raised.  \n  \n In some cases when PLINQ falls back to sequential execution, and an exception occurs, the exception may be propagated directly, and not wrapped in an <xref:System.AggregateException>. Also, <xref:System.Threading.ThreadAbortException>s are always propagated directly.  \n  \n> [!NOTE]\n>  When \"Just My Code\" is enabled, Visual Studio will break on the line that throws the exception and display an error message that says \"exception not handled by user code.\" This error is benign. You can press F5 to continue from it, and see the exception-handling behavior that is demonstrated in the examples below. To prevent Visual Studio from breaking on the first error, just uncheck the \"Just My Code\" checkbox under **Tools, Options, Debugging, General**.  \n>   \n>  This example is intended to demonstrate usage, and might not run faster than the equivalent sequential LINQ to Objects query. For more information about speedup, see [Understanding Speedup in PLINQ](../../../docs/standard/parallel-programming/understanding-speedup-in-plinq.md).  \n  \n## Example  \n This example shows how to put the try-catch blocks around the code that executes the query to catch any <xref:System.AggregateException?displayProperty=fullName>s that are thrown.  \n  \n [!code-csharp[PLINQ#41](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinqsamples.cs#41)]\n [!code-vb[PLINQ#41](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinqsnippets1.vb#41)]  \n  \n In this example, the query cannot continue after the exception is thrown. By the time your application code catches the exception, PLINQ has already stopped the query on all threads.  \n  \n## Example  \n The following example shows how to put a try-catch block in a delegate to make it possible to catch an exception and continue with the query execution.  \n  \n [!code-csharp[PLINQ#42](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinqsamples.cs#42)]\n [!code-vb[PLINQ#42](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinqsnippets1.vb#42)]  \n  \n## Compiling the Code  \n  \n-   To compile and run these examples, copy them into the PLINQ Data Sample example and call the method from Main.  \n  \n## Robust Programming  \n Do not catch an exception unless you know how to handle it so that you do not corrupt the state of your program.  \n  \n## See Also  \n <xref:System.Linq.ParallelEnumerable>   \n [Parallel LINQ (PLINQ)](../../../docs/standard/parallel-programming/parallel-linq-plinq.md)","nodes":[{"pos":[12,71],"content":"How to: Handle Exceptions in a PLINQ Query | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"How to: Handle Exceptions in a PLINQ Query | Microsoft Docs","pos":[0,59]}]},{"pos":[431,473],"content":"How to: Handle Exceptions in a PLINQ Query","linkify":"How to: Handle Exceptions in a PLINQ Query","nodes":[{"content":"How to: Handle Exceptions in a PLINQ Query","pos":[0,42]}]},{"content":"The first example in this topic shows how to handle the <ph id=\"ph1\">&lt;xref:System.AggregateException?displayProperty=fullName&gt;</ph> that can be thrown from a PLINQ query when it executes.","pos":[474,643],"source":"The first example in this topic shows how to handle the <xref:System.AggregateException?displayProperty=fullName> that can be thrown from a PLINQ query when it executes."},{"content":"The second example shows how to put try-catch blocks within delegates, as close as possible to where the exception will be thrown.","pos":[644,774]},{"content":"In this way, you can catch them as soon as they occur and possibly continue query execution.","pos":[775,867]},{"content":"When exceptions are allowed to bubble up back to the joining thread, then it is possible that a query may continue to process some items after the exception is raised.","pos":[868,1035]},{"content":"In some cases when PLINQ falls back to sequential execution, and an exception occurs, the exception may be propagated directly, and not wrapped in an <ph id=\"ph1\">&lt;xref:System.AggregateException&gt;</ph>.","pos":[1042,1225],"source":"In some cases when PLINQ falls back to sequential execution, and an exception occurs, the exception may be propagated directly, and not wrapped in an <xref:System.AggregateException>."},{"content":"Also, <ph id=\"ph1\">&lt;xref:System.Threading.ThreadAbortException&gt;</ph>s are always propagated directly.","pos":[1226,1309],"source":" Also, <xref:System.Threading.ThreadAbortException>s are always propagated directly."},{"pos":[1317,1789],"content":"[!NOTE]\n When \"Just My Code\" is enabled, Visual Studio will break on the line that throws the exception and display an error message that says \"exception not handled by user code.\" This error is benign. You can press F5 to continue from it, and see the exception-handling behavior that is demonstrated in the examples below. To prevent Visual Studio from breaking on the first error, just uncheck the \"Just My Code\" checkbox under **Tools, Options, Debugging, General**.","leadings":["","> "],"nodes":[{"content":" When \"Just My Code\" is enabled, Visual Studio will break on the line that throws the exception and display an error message that says \"exception not handled by user code.\" This error is benign. You can press F5 to continue from it, and see the exception-handling behavior that is demonstrated in the examples below. To prevent Visual Studio from breaking on the first error, just uncheck the \"Just My Code\" checkbox under **Tools, Options, Debugging, General**.","pos":[8,470],"nodes":[{"content":"When \"Just My Code\" is enabled, Visual Studio will break on the line that throws the exception and display an error message that says \"exception not handled by user code.\"","pos":[1,172]},{"content":"This error is benign.","pos":[173,194]},{"content":"You can press F5 to continue from it, and see the exception-handling behavior that is demonstrated in the examples below.","pos":[195,316]},{"content":"To prevent Visual Studio from breaking on the first error, just uncheck the \"Just My Code\" checkbox under <bpt id=\"p1\">**</bpt>Tools, Options, Debugging, General<ept id=\"p1\">**</ept>.","pos":[317,462],"source":" To prevent Visual Studio from breaking on the first error, just uncheck the \"Just My Code\" checkbox under **Tools, Options, Debugging, General**."}]}]},{"content":"This example is intended to demonstrate usage, and might not run faster than the equivalent sequential LINQ to Objects query.","pos":[1800,1925]},{"content":"For more information about speedup, see <bpt id=\"p1\">[</bpt>Understanding Speedup in PLINQ<ept id=\"p1\">](../../../docs/standard/parallel-programming/understanding-speedup-in-plinq.md)</ept>.","pos":[1926,2078],"source":" For more information about speedup, see [Understanding Speedup in PLINQ](../../../docs/standard/parallel-programming/understanding-speedup-in-plinq.md)."},{"pos":[2087,2094],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"This example shows how to put the try-catch blocks around the code that executes the query to catch any <ph id=\"ph1\">&lt;xref:System.AggregateException?displayProperty=fullName&gt;</ph>s that are thrown.","pos":[2098,2277],"source":"This example shows how to put the try-catch blocks around the code that executes the query to catch any <xref:System.AggregateException?displayProperty=fullName>s that are thrown."},{"pos":[2284,2495],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>PLINQ#41<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinqsamples.cs#41)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>PLINQ#41<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinqsnippets1.vb#41)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[PLINQ#41](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinqsamples.cs#41)]\n [!code-vb[PLINQ#41](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinqsnippets1.vb#41)]"},{"content":"In this example, the query cannot continue after the exception is thrown.","pos":[2502,2575]},{"content":"By the time your application code catches the exception, PLINQ has already stopped the query on all threads.","pos":[2576,2684]},{"pos":[2693,2700],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following example shows how to put a try-catch block in a delegate to make it possible to catch an exception and continue with the query execution.","pos":[2704,2855]},{"pos":[2862,3073],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>PLINQ#42<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinqsamples.cs#42)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>PLINQ#42<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinqsnippets1.vb#42)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[PLINQ#42](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinqsamples.cs#42)]\n [!code-vb[PLINQ#42](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinqsnippets1.vb#42)]"},{"pos":[3082,3100],"content":"Compiling the Code","linkify":"Compiling the Code","nodes":[{"content":"Compiling the Code","pos":[0,18]}]},{"content":"To compile and run these examples, copy them into the PLINQ Data Sample example and call the method from Main.","pos":[3110,3220]},{"pos":[3229,3247],"content":"Robust Programming","linkify":"Robust Programming","nodes":[{"content":"Robust Programming","pos":[0,18]}]},{"content":"Do not catch an exception unless you know how to handle it so that you do not corrupt the state of your program.","pos":[3251,3363]},{"pos":[3372,3380],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\"> [</bpt>Parallel LINQ (PLINQ)<ept id=\"p1\">](../../../docs/standard/parallel-programming/parallel-linq-plinq.md)</ept>","pos":[3425,3517],"source":" [Parallel LINQ (PLINQ)](../../../docs/standard/parallel-programming/parallel-linq-plinq.md)"}]}