{"content":"---\ntitle: \"How to: Store Asymmetric Keys in a Key Container | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\n  - \"CSharp\"\n  - \"C++\"\n  - \"jsharp\"\nhelpviewer_keywords: \n  - \"cryptography [.NET Framework], asymmetric keys\"\n  - \"storing asymmetric keys\"\n  - \"keys, asymmetric\"\n  - \"encryption keys\"\n  - \"keys, storing in key containers\"\n  - \"asymmetric keys [.NET Framework]\"\n  - \"encryption [.NET Framework], asymmetric keys\"\n  - \"decryption keys\"\nms.assetid: 0dbcbd8d-0dcf-40e9-9f0c-e3f162d35ccc\ncaps.latest.revision: 20\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"\n---\n# How to: Store Asymmetric Keys in a Key Container\nAsymmetric private keys should never be stored verbatim or in plain text on the local computer. If you need to store a private key, you should use a key container. For more information on key containers, see [Understanding Machine-Level and User-Level RSA Key Containers](http://msdn.microsoft.com/library/9a179f38-8fb7-4442-964c-fb7b9f39f5b9).  \n  \n### To create an asymmetric key and save it in a key container  \n  \n1.  Create a new instance of a <xref:System.Security.Cryptography.CspParameters> class and pass the name that you want to call the key container to the <xref:System.Security.Cryptography.CspParameters.KeyContainerName?displayProperty=fullName> field.  \n  \n2.  Create a new instance of a class that derives from the <xref:System.Security.Cryptography.AsymmetricAlgorithm> class (usually **RSACryptoServiceProvider** or **DSACryptoServiceProvider**) and pass the previously created **CspParameters** object to its constructor.  \n  \n### To delete the key from a key container  \n  \n1.  Create a new instance of a **CspParameters** class and pass the name that you want to call the key container to the **CspParameters.KeyContainerName** field.  \n  \n2.  Create a new instance of a class that derives from the **AsymmetricAlgorithm** class (usually **RSACryptoServiceProvider** or **DSACryptoServiceProvider**) and pass the previously created **CspParameters** object to its constructor.  \n  \n3.  Set the **PersistKeyInCSP** property of the class that derives from **AsymmetricAlgorithm** to **false** (**False** in Visual Basic).  \n  \n4.  Call the **Clear** method of the class that derives from **AsymmetricAlgorithm**. This method releases all resources of the class and clears the key container.  \n  \n## Example  \n The following example demonstrates how to create an asymmetric key, save it in a key container, retrieve the key at a later time, and delete the key from the container.  \n  \n Notice that code in the `GenKey_SaveInContainer` method and the `GetKeyFromContainer` method is similar.  When you specify a key container name for a <xref:System.Security.Cryptography.CspParameters> object and pass it to an <xref:System.Security.Cryptography.AsymmetricAlgorithm> object with the <xref:System.Security.Cryptography.RSACryptoServiceProvider.PersistKeyInCsp%2A> property or <xref:System.Security.Cryptography.DSACryptoServiceProvider.PersistKeyInCsp%2A> property set to true, the following occurs.  If a key container with the specified name does not exist, then one is created and the key is persisted.  If a key container with the specified name does exist, then the key in the container is automatically loaded into the current <xref:System.Security.Cryptography.AsymmetricAlgorithm> object.  Therefore, the code in the `GenKey_SaveInContainer` method persists the key because it is run first, while the code in the `GetKeyFromContainer` method loads the key because it is run second.  \n  \n```vb  \nImports System  \nImports System.IO  \nImports System.Security.Cryptography  \n _  \n  \nPublic Class StoreKey  \n  \n    Public Shared Sub Main()  \n        Try  \n            ' Create a key and save it in a container.  \n            GenKey_SaveInContainer(\"MyKeyContainer\")  \n  \n            ' Retrieve the key from the container.  \n            GetKeyFromContainer(\"MyKeyContainer\")  \n  \n            ' Delete the key from the container.  \n            DeleteKeyFromContainer(\"MyKeyContainer\")  \n  \n            ' Create a key and save it in a container.  \n            GenKey_SaveInContainer(\"MyKeyContainer\")  \n  \n            ' Delete the key from the container.  \n            DeleteKeyFromContainer(\"MyKeyContainer\")  \n        Catch e As CryptographicException  \n            Console.WriteLine(e.Message)  \n        End Try  \n    End Sub  \n  \n    Public Shared Sub GenKey_SaveInContainer(ByVal ContainerName As String)  \n        ' Create the CspParameters object and set the key container   \n        ' name used to store the RSA key pair.  \n        Dim cp As New CspParameters()  \n        cp.KeyContainerName = ContainerName  \n  \n        ' Create a new instance of RSACryptoServiceProvider that accesses  \n        ' the key container MyKeyContainerName.  \n        Dim rsa As New RSACryptoServiceProvider(cp)  \n  \n        ' Display the key information to the console.  \n        Console.WriteLine(\"Key added to container:  {0}\", rsa.ToXmlString(True))  \n    End Sub  \n  \n    Public Shared Sub GetKeyFromContainer(ByVal ContainerName As String)  \n        ' Create the CspParameters object and set the key container   \n        '  name used to store the RSA key pair.  \n        Dim cp As New CspParameters()  \n        cp.KeyContainerName = ContainerName  \n  \n        ' Create a new instance of RSACryptoServiceProvider that accesses  \n        ' the key container MyKeyContainerName.  \n        Dim rsa As New RSACryptoServiceProvider(cp)  \n  \n        ' Display the key information to the console.  \n        Console.WriteLine(\"Key retrieved from container : {0}\", rsa.ToXmlString(True))  \n    End Sub  \n  \n    Public Shared Sub DeleteKeyFromContainer(ByVal ContainerName As String)  \n        ' Create the CspParameters object and set the key container   \n        '  name used to store the RSA key pair.  \n        Dim cp As New CspParameters()  \n        cp.KeyContainerName = ContainerName  \n  \n        ' Create a new instance of RSACryptoServiceProvider that accesses  \n        ' the key container.  \n        Dim rsa As New RSACryptoServiceProvider(cp)  \n  \n        ' Delete the key entry in the container.  \n        rsa.PersistKeyInCsp = False  \n  \n        ' Call Clear to release resources and delete the key from the container.  \n        rsa.Clear()  \n  \n        Console.WriteLine(\"Key deleted.\")  \n    End Sub  \nEnd Class  \n  \n```  \n  \n```csharp  \nusing System;  \nusing System.IO;  \nusing System.Security.Cryptography;  \n  \npublic class StoreKey  \n  \n{  \n    public static void Main()  \n    {  \n        try  \n        {  \n            // Create a key and save it in a container.  \n            GenKey_SaveInContainer(\"MyKeyContainer\");  \n  \n            // Retrieve the key from the container.  \n            GetKeyFromContainer(\"MyKeyContainer\");  \n  \n            // Delete the key from the container.  \n            DeleteKeyFromContainer(\"MyKeyContainer\");  \n  \n            // Create a key and save it in a container.  \n            GenKey_SaveInContainer(\"MyKeyContainer\");  \n  \n            // Delete the key from the container.  \n            DeleteKeyFromContainer(\"MyKeyContainer\");  \n        }  \n        catch(CryptographicException e)  \n        {  \n            Console.WriteLine(e.Message);  \n        }  \n  \n    }  \n  \n    public static void GenKey_SaveInContainer(string ContainerName)  \n    {  \n        // Create the CspParameters object and set the key container   \n        // name used to store the RSA key pair.  \n        CspParameters cp = new CspParameters();  \n        cp.KeyContainerName = ContainerName;  \n  \n        // Create a new instance of RSACryptoServiceProvider that accesses  \n        // the key container MyKeyContainerName.  \n        RSACryptoServiceProvider rsa = new RSACryptoServiceProvider(cp);  \n  \n        // Display the key information to the console.  \n        Console.WriteLine(\"Key added to container: \\n  {0}\", rsa.ToXmlString(true));  \n    }  \n  \n    public static void GetKeyFromContainer(string ContainerName)  \n    {  \n        // Create the CspParameters object and set the key container   \n        // name used to store the RSA key pair.  \n        CspParameters cp = new CspParameters();  \n        cp.KeyContainerName = ContainerName;  \n  \n        // Create a new instance of RSACryptoServiceProvider that accesses  \n        // the key container MyKeyContainerName.  \n        RSACryptoServiceProvider rsa = new RSACryptoServiceProvider(cp);  \n  \n        // Display the key information to the console.  \n        Console.WriteLine(\"Key retrieved from container : \\n {0}\", rsa.ToXmlString(true));  \n    }  \n  \n    public static void DeleteKeyFromContainer(string ContainerName)  \n    {  \n        // Create the CspParameters object and set the key container   \n        // name used to store the RSA key pair.  \n        CspParameters cp = new CspParameters();  \n        cp.KeyContainerName = ContainerName;  \n  \n        // Create a new instance of RSACryptoServiceProvider that accesses  \n        // the key container.  \n        RSACryptoServiceProvider rsa = new RSACryptoServiceProvider(cp);  \n  \n        // Delete the key entry in the container.  \n        rsa.PersistKeyInCsp = false;  \n  \n        // Call Clear to release resources and delete the key from the container.  \n        rsa.Clear();  \n  \n        Console.WriteLine(\"Key deleted.\");  \n    }  \n}  \n```  \n  \n```Output  \nKey added to container:  \n<RSAKeyValue> Key Information A</RSAKeyValue>  \nKey retrieved from container :  \n<RSAKeyValue> Key Information A</RSAKeyValue>  \nKey deleted.  \nKey added to container:  \n<RSAKeyValue> Key Information B</RSAKeyValue>  \nKey deleted.  \n```  \n  \n## See Also  \n [Generating Keys for Encryption and Decryption](../../../docs/standard/security/generating-keys-for-encryption-and-decryption.md)   \n [Encrypting Data](../../../docs/standard/security/encrypting-data.md)   \n [Decrypting Data](../../../docs/standard/security/decrypting-data.md)   \n [Cryptographic Services](../../../docs/standard/security/cryptographic-services.md)","nodes":[{"pos":[4,716],"nodes":[{"content":"How to: Store Asymmetric Keys in a Key Container | Microsoft Docs","nodes":[{"pos":[0,65],"content":"How to: Store Asymmetric Keys in a Key Container | Microsoft Docs","nodes":[{"content":"How to: Store Asymmetric Keys in a Key Container | Microsoft Docs","pos":[0,65]}]}],"pos":[6,74],"yaml":true}],"content":"title: \"How to: Store Asymmetric Keys in a Key Container | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\n  - \"CSharp\"\n  - \"C++\"\n  - \"jsharp\"\nhelpviewer_keywords: \n  - \"cryptography [.NET Framework], asymmetric keys\"\n  - \"storing asymmetric keys\"\n  - \"keys, asymmetric\"\n  - \"encryption keys\"\n  - \"keys, storing in key containers\"\n  - \"asymmetric keys [.NET Framework]\"\n  - \"encryption [.NET Framework], asymmetric keys\"\n  - \"decryption keys\"\nms.assetid: 0dbcbd8d-0dcf-40e9-9f0c-e3f162d35ccc\ncaps.latest.revision: 20\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"","yamlblock":true},{"pos":[723,771],"content":"How to: Store Asymmetric Keys in a Key Container","linkify":"How to: Store Asymmetric Keys in a Key Container","nodes":[{"content":"How to: Store Asymmetric Keys in a Key Container","pos":[0,48]}]},{"content":"Asymmetric private keys should never be stored verbatim or in plain text on the local computer.","pos":[772,867]},{"content":"If you need to store a private key, you should use a key container.","pos":[868,935]},{"content":"For more information on key containers, see <bpt id=\"p1\">[</bpt>Understanding Machine-Level and User-Level RSA Key Containers<ept id=\"p1\">](http://msdn.microsoft.com/library/9a179f38-8fb7-4442-964c-fb7b9f39f5b9)</ept>.","pos":[936,1116],"source":" For more information on key containers, see [Understanding Machine-Level and User-Level RSA Key Containers](http://msdn.microsoft.com/library/9a179f38-8fb7-4442-964c-fb7b9f39f5b9)."},{"pos":[1126,1184],"content":"To create an asymmetric key and save it in a key container","linkify":"To create an asymmetric key and save it in a key container","nodes":[{"content":"To create an asymmetric key and save it in a key container","pos":[0,58]}]},{"content":"Create a new instance of a <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.CspParameters&gt;</ph> class and pass the name that you want to call the key container to the <ph id=\"ph2\">&lt;xref:System.Security.Cryptography.CspParameters.KeyContainerName?displayProperty=fullName&gt;</ph> field.","pos":[1194,1440],"source":"Create a new instance of a <xref:System.Security.Cryptography.CspParameters> class and pass the name that you want to call the key container to the <xref:System.Security.Cryptography.CspParameters.KeyContainerName?displayProperty=fullName> field."},{"pos":[1450,1714],"content":"Create a new instance of a class that derives from the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.AsymmetricAlgorithm&gt;</ph> class (usually <bpt id=\"p1\">**</bpt>RSACryptoServiceProvider<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>DSACryptoServiceProvider<ept id=\"p2\">**</ept>) and pass the previously created <bpt id=\"p3\">**</bpt>CspParameters<ept id=\"p3\">**</ept> object to its constructor.","source":"Create a new instance of a class that derives from the <xref:System.Security.Cryptography.AsymmetricAlgorithm> class (usually **RSACryptoServiceProvider** or **DSACryptoServiceProvider**) and pass the previously created **CspParameters** object to its constructor."},{"pos":[1724,1762],"content":"To delete the key from a key container","linkify":"To delete the key from a key container","nodes":[{"content":"To delete the key from a key container","pos":[0,38]}]},{"pos":[1772,1929],"content":"Create a new instance of a <bpt id=\"p1\">**</bpt>CspParameters<ept id=\"p1\">**</ept> class and pass the name that you want to call the key container to the <bpt id=\"p2\">**</bpt>CspParameters.KeyContainerName<ept id=\"p2\">**</ept> field.","source":"Create a new instance of a **CspParameters** class and pass the name that you want to call the key container to the **CspParameters.KeyContainerName** field."},{"pos":[1939,2171],"content":"Create a new instance of a class that derives from the <bpt id=\"p1\">**</bpt>AsymmetricAlgorithm<ept id=\"p1\">**</ept> class (usually <bpt id=\"p2\">**</bpt>RSACryptoServiceProvider<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>DSACryptoServiceProvider<ept id=\"p3\">**</ept>) and pass the previously created <bpt id=\"p4\">**</bpt>CspParameters<ept id=\"p4\">**</ept> object to its constructor.","source":"Create a new instance of a class that derives from the **AsymmetricAlgorithm** class (usually **RSACryptoServiceProvider** or **DSACryptoServiceProvider**) and pass the previously created **CspParameters** object to its constructor."},{"pos":[2181,2314],"content":"Set the <bpt id=\"p1\">**</bpt>PersistKeyInCSP<ept id=\"p1\">**</ept> property of the class that derives from <bpt id=\"p2\">**</bpt>AsymmetricAlgorithm<ept id=\"p2\">**</ept> to <bpt id=\"p3\">**</bpt>false<ept id=\"p3\">**</ept> (<bpt id=\"p4\">**</bpt>False<ept id=\"p4\">**</ept> in Visual Basic).","source":"Set the **PersistKeyInCSP** property of the class that derives from **AsymmetricAlgorithm** to **false** (**False** in Visual Basic)."},{"content":"Call the <bpt id=\"p1\">**</bpt>Clear<ept id=\"p1\">**</ept> method of the class that derives from <bpt id=\"p2\">**</bpt>AsymmetricAlgorithm<ept id=\"p2\">**</ept>.","pos":[2324,2405],"source":"Call the **Clear** method of the class that derives from **AsymmetricAlgorithm**."},{"content":"This method releases all resources of the class and clears the key container.","pos":[2406,2483]},{"pos":[2492,2499],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following example demonstrates how to create an asymmetric key, save it in a key container, retrieve the key at a later time, and delete the key from the container.","pos":[2503,2671]},{"content":"Notice that code in the <ph id=\"ph1\">`GenKey_SaveInContainer`</ph> method and the <ph id=\"ph2\">`GetKeyFromContainer`</ph> method is similar.","pos":[2678,2782],"source":"Notice that code in the `GenKey_SaveInContainer` method and the `GetKeyFromContainer` method is similar."},{"content":"When you specify a key container name for a <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.CspParameters&gt;</ph> object and pass it to an <ph id=\"ph2\">&lt;xref:System.Security.Cryptography.AsymmetricAlgorithm&gt;</ph> object with the <ph id=\"ph3\">&lt;xref:System.Security.Cryptography.RSACryptoServiceProvider.PersistKeyInCsp%2A&gt;</ph> property or <ph id=\"ph4\">&lt;xref:System.Security.Cryptography.DSACryptoServiceProvider.PersistKeyInCsp%2A&gt;</ph> property set to true, the following occurs.","pos":[2784,3190],"source":"  When you specify a key container name for a <xref:System.Security.Cryptography.CspParameters> object and pass it to an <xref:System.Security.Cryptography.AsymmetricAlgorithm> object with the <xref:System.Security.Cryptography.RSACryptoServiceProvider.PersistKeyInCsp%2A> property or <xref:System.Security.Cryptography.DSACryptoServiceProvider.PersistKeyInCsp%2A> property set to true, the following occurs."},{"content":"If a key container with the specified name does not exist, then one is created and the key is persisted.","pos":[3192,3296]},{"content":"If a key container with the specified name does exist, then the key in the container is automatically loaded into the current <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.AsymmetricAlgorithm&gt;</ph> object.","pos":[3298,3487],"source":"  If a key container with the specified name does exist, then the key in the container is automatically loaded into the current <xref:System.Security.Cryptography.AsymmetricAlgorithm> object."},{"content":"Therefore, the code in the <ph id=\"ph1\">`GenKey_SaveInContainer`</ph> method persists the key because it is run first, while the code in the <ph id=\"ph2\">`GetKeyFromContainer`</ph> method loads the key because it is run second.","pos":[3489,3680],"source":"  Therefore, the code in the `GenKey_SaveInContainer` method persists the key because it is run first, while the code in the `GetKeyFromContainer` method loads the key because it is run second."},{"pos":[9764,9772],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Generating Keys for Encryption and Decryption<ept id=\"p1\">](../../../docs/standard/security/generating-keys-for-encryption-and-decryption.md)</ept><ph id=\"ph1\"> </ph>","pos":[9776,9906],"source":"[Generating Keys for Encryption and Decryption](../../../docs/standard/security/generating-keys-for-encryption-and-decryption.md) "},{"content":"<bpt id=\"p1\">[</bpt>Encrypting Data<ept id=\"p1\">](../../../docs/standard/security/encrypting-data.md)</ept><ph id=\"ph1\"> </ph>","pos":[9910,9980],"source":"[Encrypting Data](../../../docs/standard/security/encrypting-data.md) "},{"content":"<bpt id=\"p1\">[</bpt>Decrypting Data<ept id=\"p1\">](../../../docs/standard/security/decrypting-data.md)</ept><ph id=\"ph1\"> </ph>","pos":[9984,10054],"source":"[Decrypting Data](../../../docs/standard/security/decrypting-data.md) "},{"content":"<bpt id=\"p1\">[</bpt>Cryptographic Services<ept id=\"p1\">](../../../docs/standard/security/cryptographic-services.md)</ept>","pos":[10058,10141],"source":"[Cryptographic Services](../../../docs/standard/security/cryptographic-services.md)"}]}