{"content":"---\ntitle: \"How to: Use Data Protection\"\nms.date: \"03/30/2017\"\nms.technology: dotnet-standard\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"DPAPI\"\n  - \"encryption [.NET Framework], data protection API\"\n  - \"data [.NET Framework], decryption\"\n  - \"ProtectedMemory class, about ProtectedMemory class\"\n  - \"ProtectedData class, about ProtectedData class\"\n  - \"cryptography [.NET Framework], data protection API\"\n  - \"data protection API [.NET Framework]\"\n  - \"decryption\"\n  - \"data [.NET Framework], encryption\"\nms.assetid: 606698b0-cb1a-42ca-beeb-0bea34205d20\nauthor: \"mairaw\"\nms.author: \"mairaw\"\n---\n# How to: Use Data Protection\nThe .NET Framework provides access to the data protection API (DPAPI), which allows you to encrypt data using information from the current user account or computer.  When you use the DPAPI, you alleviate the difficult problem of explicitly generating and storing a cryptographic key.  \n  \n Use the <xref:System.Security.Cryptography.ProtectedMemory> class to encrypt an array of in-memory bytes.  This functionality is available in Microsoft Windows XP and later operating systems.  You can specify that memory encrypted by the current process can be decrypted by the current process only, by all processes, or from the same user context.  See the <xref:System.Security.Cryptography.MemoryProtectionScope> enumeration for a detailed description of <xref:System.Security.Cryptography.ProtectedMemory> options.  \n  \n Use the <xref:System.Security.Cryptography.ProtectedData> class to encrypt a copy of an array of bytes. This functionality is available in Microsoft Windows 2000 and later operating systems.  You can specify that data encrypted by the current user account can be decrypted only by the same user account, or you can specify that data encrypted by the current user account can be decrypted by any account on the computer.  See the <xref:System.Security.Cryptography.DataProtectionScope> enumeration for a detailed description of <xref:System.Security.Cryptography.ProtectedData> options.  \n  \n### To encrypt in-memory data using data protection  \n  \n1.  Call the static <xref:System.Security.Cryptography.ProtectedMemory.Protect%2A> method while passing an array of bytes to encrypt, the entropy, and the memory protection scope.  \n  \n### To decrypt in-memory data using data protection  \n  \n1.  Call the static <xref:System.Security.Cryptography.ProtectedMemory.Unprotect%2A> method while passing an array of bytes to decrypt and the memory protection scope.  \n  \n### To encrypt data to a file or stream using data protection  \n  \n1.  Create random entropy.  \n  \n2.  Call the static <xref:System.Security.Cryptography.ProtectedData.Protect%2A> method while passing an array of bytes to encrypt, the entropy, and the data protection scope.  \n  \n3.  Write the encrypted data to a file or stream.  \n  \n### To decrypt data from a file or stream using data protection  \n  \n1.  Read the encrypted data from a file or stream.  \n  \n2.  Call the static <xref:System.Security.Cryptography.ProtectedData.Unprotect%2A> method while passing an array of bytes to decrypt and the data protection scope.  \n  \n## Example  \n The following code example demonstrates two forms of encryption and decryption.  First, the code example encrypts and then decrypts an in-memory array of bytes.  Next, the code example encrypts a copy of a byte array, saves it to a file, loads the data back from the file, and then decrypts the data.  The example displays the original data, the encrypted data, and the decrypted data.  \n  \n [!code-csharp[DPAPI-HowTO#1](../../../samples/snippets/csharp/VS_Snippets_CLR/DPAPI-HowTO/cs/sample.cs#1)]\n [!code-vb[DPAPI-HowTO#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/DPAPI-HowTO/vb/sample.vb#1)]  \n  \n## Compiling the Code  \n  \n-   Include a reference to `System.Security.dll`.  \n  \n-   Include the <xref:System>, <xref:System.IO>, <xref:System.Security.Cryptography>, and <xref:System.Text> namespace.  \n  \n## See also\n\n- <xref:System.Security.Cryptography.ProtectedMemory>\n- <xref:System.Security.Cryptography.ProtectedData>\n","nodes":[{"pos":[4,609],"embed":true,"restype":"x-metadata","content":"title: \"How to: Use Data Protection\"\nms.date: \"03/30/2017\"\nms.technology: dotnet-standard\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"DPAPI\"\n  - \"encryption [.NET Framework], data protection API\"\n  - \"data [.NET Framework], decryption\"\n  - \"ProtectedMemory class, about ProtectedMemory class\"\n  - \"ProtectedData class, about ProtectedData class\"\n  - \"cryptography [.NET Framework], data protection API\"\n  - \"data protection API [.NET Framework]\"\n  - \"decryption\"\n  - \"data [.NET Framework], encryption\"\nms.assetid: 606698b0-cb1a-42ca-beeb-0bea34205d20\nauthor: \"mairaw\"\nms.author: \"mairaw\"","nodes":[{"content":"How to: Use Data Protection","nodes":[{"pos":[0,27],"content":"How to: Use Data Protection","nodes":[{"content":"How to: Use Data Protection","pos":[0,27]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[616,643],"content":"How to: Use Data Protection","linkify":"How to: Use Data Protection","nodes":[{"content":"How to: Use Data Protection","pos":[0,27]}]},{"content":"The .NET Framework provides access to the data protection API (DPAPI), which allows you to encrypt data using information from the current user account or computer.","pos":[644,808]},{"content":"When you use the DPAPI, you alleviate the difficult problem of explicitly generating and storing a cryptographic key.","pos":[810,927]},{"content":"Use the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.ProtectedMemory&gt;</ph> class to encrypt an array of in-memory bytes.","pos":[934,1039],"source":"Use the <xref:System.Security.Cryptography.ProtectedMemory> class to encrypt an array of in-memory bytes."},{"content":"This functionality is available in Microsoft Windows XP and later operating systems.","pos":[1041,1125]},{"content":"You can specify that memory encrypted by the current process can be decrypted by the current process only, by all processes, or from the same user context.","pos":[1127,1282]},{"content":"See the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.MemoryProtectionScope&gt;</ph> enumeration for a detailed description of <ph id=\"ph2\">&lt;xref:System.Security.Cryptography.ProtectedMemory&gt;</ph> options.","pos":[1284,1452],"source":"  See the <xref:System.Security.Cryptography.MemoryProtectionScope> enumeration for a detailed description of <xref:System.Security.Cryptography.ProtectedMemory> options."},{"content":"Use the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.ProtectedData&gt;</ph> class to encrypt a copy of an array of bytes.","pos":[1459,1562],"source":"Use the <xref:System.Security.Cryptography.ProtectedData> class to encrypt a copy of an array of bytes."},{"content":"This functionality is available in Microsoft Windows 2000 and later operating systems.","pos":[1563,1649]},{"content":"You can specify that data encrypted by the current user account can be decrypted only by the same user account, or you can specify that data encrypted by the current user account can be decrypted by any account on the computer.","pos":[1651,1878]},{"content":"See the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.DataProtectionScope&gt;</ph> enumeration for a detailed description of <ph id=\"ph2\">&lt;xref:System.Security.Cryptography.ProtectedData&gt;</ph> options.","pos":[1880,2044],"source":"  See the <xref:System.Security.Cryptography.DataProtectionScope> enumeration for a detailed description of <xref:System.Security.Cryptography.ProtectedData> options."},{"pos":[2054,2101],"content":"To encrypt in-memory data using data protection","linkify":"To encrypt in-memory data using data protection","nodes":[{"content":"To encrypt in-memory data using data protection","pos":[0,47]}]},{"pos":[2111,2286],"content":"Call the static <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.ProtectedMemory.Protect%2A&gt;</ph> method while passing an array of bytes to encrypt, the entropy, and the memory protection scope.","source":"Call the static <xref:System.Security.Cryptography.ProtectedMemory.Protect%2A> method while passing an array of bytes to encrypt, the entropy, and the memory protection scope."},{"pos":[2296,2343],"content":"To decrypt in-memory data using data protection","linkify":"To decrypt in-memory data using data protection","nodes":[{"content":"To decrypt in-memory data using data protection","pos":[0,47]}]},{"pos":[2353,2516],"content":"Call the static <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.ProtectedMemory.Unprotect%2A&gt;</ph> method while passing an array of bytes to decrypt and the memory protection scope.","source":"Call the static <xref:System.Security.Cryptography.ProtectedMemory.Unprotect%2A> method while passing an array of bytes to decrypt and the memory protection scope."},{"pos":[2526,2583],"content":"To encrypt data to a file or stream using data protection","linkify":"To encrypt data to a file or stream using data protection","nodes":[{"content":"To encrypt data to a file or stream using data protection","pos":[0,57]}]},{"content":"Create random entropy.","pos":[2593,2615]},{"pos":[2625,2796],"content":"Call the static <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.ProtectedData.Protect%2A&gt;</ph> method while passing an array of bytes to encrypt, the entropy, and the data protection scope.","source":"Call the static <xref:System.Security.Cryptography.ProtectedData.Protect%2A> method while passing an array of bytes to encrypt, the entropy, and the data protection scope."},{"content":"Write the encrypted data to a file or stream.","pos":[2806,2851]},{"pos":[2861,2920],"content":"To decrypt data from a file or stream using data protection","linkify":"To decrypt data from a file or stream using data protection","nodes":[{"content":"To decrypt data from a file or stream using data protection","pos":[0,59]}]},{"content":"Read the encrypted data from a file or stream.","pos":[2930,2976]},{"pos":[2986,3145],"content":"Call the static <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.ProtectedData.Unprotect%2A&gt;</ph> method while passing an array of bytes to decrypt and the data protection scope.","source":"Call the static <xref:System.Security.Cryptography.ProtectedData.Unprotect%2A> method while passing an array of bytes to decrypt and the data protection scope."},{"pos":[3154,3161],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following code example demonstrates two forms of encryption and decryption.","pos":[3165,3244]},{"content":"First, the code example encrypts and then decrypts an in-memory array of bytes.","pos":[3246,3325]},{"content":"Next, the code example encrypts a copy of a byte array, saves it to a file, loads the data back from the file, and then decrypts the data.","pos":[3327,3465]},{"content":"The example displays the original data, the encrypted data, and the decrypted data.","pos":[3467,3550]},{"pos":[3781,3799],"content":"Compiling the Code","linkify":"Compiling the Code","nodes":[{"content":"Compiling the Code","pos":[0,18]}]},{"pos":[3809,3854],"content":"Include a reference to <ph id=\"ph1\">`System.Security.dll`</ph>.","source":"Include a reference to `System.Security.dll`."},{"pos":[3864,3979],"content":"Include the <ph id=\"ph1\">&lt;xref:System&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.IO&gt;</ph>, <ph id=\"ph3\">&lt;xref:System.Security.Cryptography&gt;</ph>, and <ph id=\"ph4\">&lt;xref:System.Text&gt;</ph> namespace.","source":"Include the <xref:System>, <xref:System.IO>, <xref:System.Security.Cryptography>, and <xref:System.Text> namespace."},{"pos":[3988,3996],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]}]}