{"content":"---\ntitle: \"Mixing Trust Protocols in Federated Scenarios\"\nms.date: \"03/30/2017\"\nms.assetid: d7b5fee9-2246-4b09-b8d7-9e63cb817279\n---\n# Mixing Trust Protocols in Federated Scenarios\nThere may be scenarios in which federated clients communicate with a service and a Security Token Service (STS) that do not have the same trust version. The service WSDL can contain a `RequestSecurityTokenTemplate` assertion with WS-Trust elements that are of different versions than the STS. In such cases, a Windows Communication Foundation (WCF) client converts the WS-Trust elements received from the `RequestSecurityTokenTemplate` to match the STS trust version. WCF handles mismatched trust versions only for standard bindings. All standard algorithm parameters that are recognized by WCF are part of the standard binding. This topic describes the WCF behavior with various trust settings between the service and the STS.  \n  \n## RP Feb 2005 and STS Feb 2005  \n The WSDL for Relying Party (RP) contains the following elements within the `RequestSecurityTokenTemplate` section:  \n  \n-   `CanonicalizationAlgorithm`  \n  \n-   `EncryptionAlgorithm`  \n  \n-   `EncryptWith`  \n  \n-   `SignWith`  \n  \n-   `KeySize`  \n  \n-   `KeyType`  \n  \n The client configuration file contains a list of parameters.  \n  \n WCF cannot differentiate between the client and service parameters; it adds all the parameters and sends them in the `RequestSecurityTokenTemplate` (RST).  \n  \n## RP Trust 1.3 and STS Trust 1.3  \n The WSDL for RP contains the following elements within the `RequestSecurityTokenTemplate` section:  \n  \n-   `CanonicalizationAlgorithm`  \n  \n-   `EncryptionAlgorithm`  \n  \n-   `EncryptWith`  \n  \n-   `SignWith`  \n  \n-   `KeySize`  \n  \n-   `KeyType`  \n  \n-   `KeyWrapAlgorithm`  \n  \n The client configuration file contains a `secondaryParameters` element that wraps the parameters specified by the RP.  \n  \n WCF removes the `EncryptionAlgorithm`, `CanonicalizationAlgorithm` and `KeyWrapAlgorithm` elements from the top-level element under the RST if these are present inside the `SecondaryParameters` element. WCF appends the `SecondaryParameters` element to the outgoing RST unmodified.  \n  \n## RP Trust Feb 2005 and STS Trust 1.3  \n The WSDL for RP contains the following elements in the `RequestSecurityTokenTemplate` section:  \n  \n-   `CanonicalizationAlgorithm`  \n  \n-   `EncryptionAlgorithm`  \n  \n-   `EncryptWith`  \n  \n-   `SignWith`  \n  \n-   `KeySize`  \n  \n-   `KeyType`  \n  \n The client configuration file contains a list of parameters.  \n  \n From the client configuration file, WCF cannot differentiate between the service and client parameters. Therefore WCF converts all the parameters to a Trust version 1.3 namespace.  \n  \n WCF handles the `KeyType`, `KeySize`, and `TokenType` elements as follows:  \n  \n-   Download the WSDL, create the binding, and assign `KeyType`, `KeySize`, and `TokenType` from the RP parameters. The client configuration file is then generated.  \n  \n-   The client can now change any parameter in the configuration file.  \n  \n-   During runtime, WCF copies all parameters specified into the `AdditionalTokenParameters` section of the client configuration file except `KeyType`, `KeySize` and `TokenType`, because these parameters are accounted for during the configuration file generation.  \n  \n## RP Trust 1.3 and STS Trust Feb 2005  \n The WSDL for RP contains the following elements in the `RequestSecurityTokenTemplate` section:  \n  \n-   `CanonicalizationAlgorithm`  \n  \n-   `EncryptionAlgorithm`  \n  \n-   `EncryptWith`  \n  \n-   `SignWith`  \n  \n-   `KeySize`  \n  \n-   `KeyType`  \n  \n-   `KeyWrapAlgorithm`  \n  \n The client configuration file contains a `secondaryParamters` element that wraps the parameters specified by the RP.  \n  \n WCF copies all the parameters specified within the `SecondaryParameters` section to the top-level RST element, but does not convert them to the 2005 WS-Trust namespace.\n","nodes":[{"pos":[4,129],"embed":true,"restype":"x-metadata","content":"title: \"Mixing Trust Protocols in Federated Scenarios\"\nms.date: \"03/30/2017\"\nms.assetid: d7b5fee9-2246-4b09-b8d7-9e63cb817279","nodes":[{"content":"Mixing Trust Protocols in Federated Scenarios","nodes":[{"pos":[0,45],"content":"Mixing Trust Protocols in Federated Scenarios","nodes":[{"content":"Mixing Trust Protocols in Federated Scenarios","pos":[0,45]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[136,181],"content":"Mixing Trust Protocols in Federated Scenarios","linkify":"Mixing Trust Protocols in Federated Scenarios","nodes":[{"content":"Mixing Trust Protocols in Federated Scenarios","pos":[0,45]}]},{"content":"There may be scenarios in which federated clients communicate with a service and a Security Token Service (STS) that do not have the same trust version.","pos":[182,334]},{"content":"The service WSDL can contain a <ph id=\"ph1\">`RequestSecurityTokenTemplate`</ph> assertion with WS-Trust elements that are of different versions than the STS.","pos":[335,474],"source":" The service WSDL can contain a `RequestSecurityTokenTemplate` assertion with WS-Trust elements that are of different versions than the STS."},{"content":"In such cases, a Windows Communication Foundation (WCF) client converts the WS-Trust elements received from the <ph id=\"ph1\">`RequestSecurityTokenTemplate`</ph> to match the STS trust version.","pos":[475,649],"source":" In such cases, a Windows Communication Foundation (WCF) client converts the WS-Trust elements received from the `RequestSecurityTokenTemplate` to match the STS trust version."},{"content":"WCF handles mismatched trust versions only for standard bindings.","pos":[650,715]},{"content":"All standard algorithm parameters that are recognized by WCF are part of the standard binding.","pos":[716,810]},{"content":"This topic describes the WCF behavior with various trust settings between the service and the STS.","pos":[811,909]},{"pos":[918,946],"content":"RP Feb 2005 and STS Feb 2005","linkify":"RP Feb 2005 and STS Feb 2005","nodes":[{"content":"RP Feb 2005 and STS Feb 2005","pos":[0,28]}]},{"pos":[950,1064],"content":"The WSDL for Relying Party (RP) contains the following elements within the <ph id=\"ph1\">`RequestSecurityTokenTemplate`</ph> section:","source":"The WSDL for Relying Party (RP) contains the following elements within the `RequestSecurityTokenTemplate` section:"},{"content":"The client configuration file contains a list of parameters.","pos":[1220,1280]},{"pos":[1287,1441],"content":"WCF cannot differentiate between the client and service parameters; it adds all the parameters and sends them in the <ph id=\"ph1\">`RequestSecurityTokenTemplate`</ph> (RST).","source":"WCF cannot differentiate between the client and service parameters; it adds all the parameters and sends them in the `RequestSecurityTokenTemplate` (RST)."},{"pos":[1450,1480],"content":"RP Trust 1.3 and STS Trust 1.3","linkify":"RP Trust 1.3 and STS Trust 1.3","nodes":[{"content":"RP Trust 1.3 and STS Trust 1.3","pos":[0,30]}]},{"pos":[1484,1582],"content":"The WSDL for RP contains the following elements within the <ph id=\"ph1\">`RequestSecurityTokenTemplate`</ph> section:","source":"The WSDL for RP contains the following elements within the `RequestSecurityTokenTemplate` section:"},{"pos":[1766,1883],"content":"The client configuration file contains a <ph id=\"ph1\">`secondaryParameters`</ph> element that wraps the parameters specified by the RP.","source":"The client configuration file contains a `secondaryParameters` element that wraps the parameters specified by the RP."},{"content":"WCF removes the <ph id=\"ph1\">`EncryptionAlgorithm`</ph>, <ph id=\"ph2\">`CanonicalizationAlgorithm`</ph> and <ph id=\"ph3\">`KeyWrapAlgorithm`</ph> elements from the top-level element under the RST if these are present inside the <ph id=\"ph4\">`SecondaryParameters`</ph> element.","pos":[1890,2092],"source":"WCF removes the `EncryptionAlgorithm`, `CanonicalizationAlgorithm` and `KeyWrapAlgorithm` elements from the top-level element under the RST if these are present inside the `SecondaryParameters` element."},{"content":"WCF appends the <ph id=\"ph1\">`SecondaryParameters`</ph> element to the outgoing RST unmodified.","pos":[2093,2170],"source":" WCF appends the `SecondaryParameters` element to the outgoing RST unmodified."},{"pos":[2179,2214],"content":"RP Trust Feb 2005 and STS Trust 1.3","linkify":"RP Trust Feb 2005 and STS Trust 1.3","nodes":[{"content":"RP Trust Feb 2005 and STS Trust 1.3","pos":[0,35]}]},{"pos":[2218,2312],"content":"The WSDL for RP contains the following elements in the <ph id=\"ph1\">`RequestSecurityTokenTemplate`</ph> section:","source":"The WSDL for RP contains the following elements in the `RequestSecurityTokenTemplate` section:"},{"content":"The client configuration file contains a list of parameters.","pos":[2468,2528]},{"content":"From the client configuration file, WCF cannot differentiate between the service and client parameters.","pos":[2535,2638]},{"content":"Therefore WCF converts all the parameters to a Trust version 1.3 namespace.","pos":[2639,2714]},{"pos":[2721,2795],"content":"WCF handles the <ph id=\"ph1\">`KeyType`</ph>, <ph id=\"ph2\">`KeySize`</ph>, and <ph id=\"ph3\">`TokenType`</ph> elements as follows:","source":"WCF handles the `KeyType`, `KeySize`, and `TokenType` elements as follows:"},{"content":"Download the WSDL, create the binding, and assign <ph id=\"ph1\">`KeyType`</ph>, <ph id=\"ph2\">`KeySize`</ph>, and <ph id=\"ph3\">`TokenType`</ph> from the RP parameters.","pos":[2805,2916],"source":"Download the WSDL, create the binding, and assign `KeyType`, `KeySize`, and `TokenType` from the RP parameters."},{"content":"The client configuration file is then generated.","pos":[2917,2965]},{"content":"The client can now change any parameter in the configuration file.","pos":[2975,3041]},{"pos":[3051,3310],"content":"During runtime, WCF copies all parameters specified into the <ph id=\"ph1\">`AdditionalTokenParameters`</ph> section of the client configuration file except <ph id=\"ph2\">`KeyType`</ph>, <ph id=\"ph3\">`KeySize`</ph> and <ph id=\"ph4\">`TokenType`</ph>, because these parameters are accounted for during the configuration file generation.","source":"During runtime, WCF copies all parameters specified into the `AdditionalTokenParameters` section of the client configuration file except `KeyType`, `KeySize` and `TokenType`, because these parameters are accounted for during the configuration file generation."},{"pos":[3319,3354],"content":"RP Trust 1.3 and STS Trust Feb 2005","linkify":"RP Trust 1.3 and STS Trust Feb 2005","nodes":[{"content":"RP Trust 1.3 and STS Trust Feb 2005","pos":[0,35]}]},{"pos":[3358,3452],"content":"The WSDL for RP contains the following elements in the <ph id=\"ph1\">`RequestSecurityTokenTemplate`</ph> section:","source":"The WSDL for RP contains the following elements in the `RequestSecurityTokenTemplate` section:"},{"pos":[3636,3752],"content":"The client configuration file contains a <ph id=\"ph1\">`secondaryParamters`</ph> element that wraps the parameters specified by the RP.","source":"The client configuration file contains a `secondaryParamters` element that wraps the parameters specified by the RP."},{"pos":[3759,3927],"content":"WCF copies all the parameters specified within the <ph id=\"ph1\">`SecondaryParameters`</ph> section to the top-level RST element, but does not convert them to the 2005 WS-Trust namespace.","source":"WCF copies all the parameters specified within the `SecondaryParameters` section to the top-level RST element, but does not convert them to the 2005 WS-Trust namespace."}]}