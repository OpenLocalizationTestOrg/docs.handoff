{"content":"---\ntitle: \"How to: Enable Persistence for Workflows and Workflow Services\"\nms.date: \"03/30/2017\"\nms.assetid: 2b1c8bf3-9866-45a4-b06d-ee562393e503\n---\n# How to: Enable Persistence for Workflows and Workflow Services\nThis topic describes how to enable persistence for workflows and workflow services.  \n  \n## Enable Persistence for Workflows  \n You can associate an instance store with a **WorkflowApplication** by using the <xref:System.Activities.WorkflowApplication.InstanceStore%2A> property of the <xref:System.Activities.WorkflowApplication> class. The <xref:System.Activities.WorkflowApplication.Persist%2A> method saves or persists a workflow into the instance store associated with the application. The <xref:System.Activities.WorkflowApplication.Unload%2A> method persists a workflow into the instance store and then unloads the instance from the memory. The **Load** method loads a workflow into memory using the workflow data stored in the instance persistence store.  \n  \n The **Persist** method performs the following steps:  \n  \n1.  Pauses the workflow scheduler and waits until the workflow enters the idle state.  \n  \n2.  Persists or saves the workflow into the persistence store.  \n  \n3.  Resumes the workflow scheduler.  \n  \n The **Unload** method performs the following steps:  \n  \n1.  Pauses the workflow scheduler and waits until the workflow enters the idle state.  \n  \n2.  Persists or saves the workflow into the persistence store.  \n  \n3.  Disposes the workflow instance in the memory.  \n  \n Both the **Persist** and **Unload** methods will block while a workflow is in a no-persist zone until the workflow exits the no-persist zone. The method continues with the persist or unload operation after the no-persist zone completes. If the no-persist zone does not complete before the time-out elapses, or if the persistence process takes too long, a TimeoutException will be thrown.  \n  \n## Enable Persistence for Workflow Services in Code  \n The **DurableInstancingOptions** member of the <xref:System.ServiceModel.WorkflowServiceHost> class has a property named **InstanceStore** that you can use to associate an instance store with the **WorkflowServiceHost**.  \n  \n```  \n// wsh is an instance of WorkflowServiceHost class  \nwsh.DurableInstancingOptions.InstanceStore = new SqlWorkflowInstanceStore();  \n```  \n  \n When the **WorkflowServiceHost** is opened, persistence is automatically enabled if the **DurableInstancingOptions.InstanceStore** is not null.  \n  \n Typically, a service behavior provides the concrete instance store to be used with a workflow service host by using the **InstanceStore** property. For example, the SqlWorkflowInstanceStoreBehavior creates an instance of the **SqlWorkflowInstanceStore**, configures it, and assigns it to the **DurableInstancingOptions.InstanceStore**.  \n  \n## Enable Persistence for Workflow Services Using an Application Configuration File  \n Persistence can be enabled using an application configuration file by adding the following code to your app.config or web.config file:  \n  \n```xml  \n<configuration>  \n  <system.serviceModel>  \n    <behaviors>  \n      <serviceBehaviors>  \n        <behavior name=\"myBehavior\">  \n          <SqlWorkflowInstanceStore connectionString=\"Data Source=myDatatbaseServer;Initial Catalog=myPersistenceDatabase\">  \n        </behavior>  \n      </serviceBehaviors>  \n    <behaviors>  \n  </system.serviceModel>  \n</configuration>  \n```\n","nodes":[{"pos":[4,146],"embed":true,"restype":"x-metadata","content":"title: \"How to: Enable Persistence for Workflows and Workflow Services\"\nms.date: \"03/30/2017\"\nms.assetid: 2b1c8bf3-9866-45a4-b06d-ee562393e503","nodes":[{"content":"How to: Enable Persistence for Workflows and Workflow Services","nodes":[{"pos":[0,62],"content":"How to: Enable Persistence for Workflows and Workflow Services","nodes":[{"content":"How to: Enable Persistence for Workflows and Workflow Services","pos":[0,62]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[153,215],"content":"How to: Enable Persistence for Workflows and Workflow Services","linkify":"How to: Enable Persistence for Workflows and Workflow Services","nodes":[{"content":"How to: Enable Persistence for Workflows and Workflow Services","pos":[0,62]}]},{"content":"This topic describes how to enable persistence for workflows and workflow services.","pos":[216,299]},{"pos":[308,340],"content":"Enable Persistence for Workflows","linkify":"Enable Persistence for Workflows","nodes":[{"content":"Enable Persistence for Workflows","pos":[0,32]}]},{"content":"You can associate an instance store with a <bpt id=\"p1\">**</bpt>WorkflowApplication<ept id=\"p1\">**</ept> by using the <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowApplication.InstanceStore%2A&gt;</ph> property of the <ph id=\"ph2\">&lt;xref:System.Activities.WorkflowApplication&gt;</ph> class.","pos":[344,553],"source":"You can associate an instance store with a **WorkflowApplication** by using the <xref:System.Activities.WorkflowApplication.InstanceStore%2A> property of the <xref:System.Activities.WorkflowApplication> class."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowApplication.Persist%2A&gt;</ph> method saves or persists a workflow into the instance store associated with the application.","pos":[554,706],"source":" The <xref:System.Activities.WorkflowApplication.Persist%2A> method saves or persists a workflow into the instance store associated with the application."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowApplication.Unload%2A&gt;</ph> method persists a workflow into the instance store and then unloads the instance from the memory.","pos":[707,863],"source":" The <xref:System.Activities.WorkflowApplication.Unload%2A> method persists a workflow into the instance store and then unloads the instance from the memory."},{"content":"The <bpt id=\"p1\">**</bpt>Load<ept id=\"p1\">**</ept> method loads a workflow into memory using the workflow data stored in the instance persistence store.","pos":[864,978],"source":" The **Load** method loads a workflow into memory using the workflow data stored in the instance persistence store."},{"pos":[985,1037],"content":"The <bpt id=\"p1\">**</bpt>Persist<ept id=\"p1\">**</ept> method performs the following steps:","source":"The **Persist** method performs the following steps:"},{"content":"Pauses the workflow scheduler and waits until the workflow enters the idle state.","pos":[1047,1128]},{"content":"Persists or saves the workflow into the persistence store.","pos":[1138,1196]},{"content":"Resumes the workflow scheduler.","pos":[1206,1237]},{"pos":[1244,1295],"content":"The <bpt id=\"p1\">**</bpt>Unload<ept id=\"p1\">**</ept> method performs the following steps:","source":"The **Unload** method performs the following steps:"},{"content":"Pauses the workflow scheduler and waits until the workflow enters the idle state.","pos":[1305,1386]},{"content":"Persists or saves the workflow into the persistence store.","pos":[1396,1454]},{"content":"Disposes the workflow instance in the memory.","pos":[1464,1509]},{"content":"Both the <bpt id=\"p1\">**</bpt>Persist<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Unload<ept id=\"p2\">**</ept> methods will block while a workflow is in a no-persist zone until the workflow exits the no-persist zone.","pos":[1516,1657],"source":"Both the **Persist** and **Unload** methods will block while a workflow is in a no-persist zone until the workflow exits the no-persist zone."},{"content":"The method continues with the persist or unload operation after the no-persist zone completes.","pos":[1658,1752]},{"content":"If the no-persist zone does not complete before the time-out elapses, or if the persistence process takes too long, a TimeoutException will be thrown.","pos":[1753,1903]},{"pos":[1912,1960],"content":"Enable Persistence for Workflow Services in Code","linkify":"Enable Persistence for Workflow Services in Code","nodes":[{"content":"Enable Persistence for Workflow Services in Code","pos":[0,48]}]},{"pos":[1964,2184],"content":"The <bpt id=\"p1\">**</bpt>DurableInstancingOptions<ept id=\"p1\">**</ept> member of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.WorkflowServiceHost&gt;</ph> class has a property named <bpt id=\"p2\">**</bpt>InstanceStore<ept id=\"p2\">**</ept> that you can use to associate an instance store with the <bpt id=\"p3\">**</bpt>WorkflowServiceHost<ept id=\"p3\">**</ept>.","source":"The **DurableInstancingOptions** member of the <xref:System.ServiceModel.WorkflowServiceHost> class has a property named **InstanceStore** that you can use to associate an instance store with the **WorkflowServiceHost**."},{"pos":[2338,2481],"content":"When the <bpt id=\"p1\">**</bpt>WorkflowServiceHost<ept id=\"p1\">**</ept> is opened, persistence is automatically enabled if the <bpt id=\"p2\">**</bpt>DurableInstancingOptions.InstanceStore<ept id=\"p2\">**</ept> is not null.","source":"When the **WorkflowServiceHost** is opened, persistence is automatically enabled if the **DurableInstancingOptions.InstanceStore** is not null."},{"content":"Typically, a service behavior provides the concrete instance store to be used with a workflow service host by using the <bpt id=\"p1\">**</bpt>InstanceStore<ept id=\"p1\">**</ept> property.","pos":[2488,2635],"source":"Typically, a service behavior provides the concrete instance store to be used with a workflow service host by using the **InstanceStore** property."},{"content":"For example, the SqlWorkflowInstanceStoreBehavior creates an instance of the <bpt id=\"p1\">**</bpt>SqlWorkflowInstanceStore<ept id=\"p1\">**</ept>, configures it, and assigns it to the <bpt id=\"p2\">**</bpt>DurableInstancingOptions.InstanceStore<ept id=\"p2\">**</ept>.","pos":[2636,2823],"source":" For example, the SqlWorkflowInstanceStoreBehavior creates an instance of the **SqlWorkflowInstanceStore**, configures it, and assigns it to the **DurableInstancingOptions.InstanceStore**."},{"pos":[2832,2912],"content":"Enable Persistence for Workflow Services Using an Application Configuration File","linkify":"Enable Persistence for Workflow Services Using an Application Configuration File","nodes":[{"content":"Enable Persistence for Workflow Services Using an Application Configuration File","pos":[0,80]}]},{"content":"Persistence can be enabled using an application configuration file by adding the following code to your app.config or web.config file:","pos":[2916,3050]}]}