{"content":"---\ntitle: \"Message Security with an Anonymous Client\"\nms.date: \"03/30/2017\"\ndev_langs:\n  - \"csharp\"\n  - \"vb\"\nms.assetid: cad53e1a-b7c9-4064-bc87-508c3d1dce49\n---\n\n# Message Security with an Anonymous Client\n\nThe following scenario shows a client and service secured by Windows Communication Foundation (WCF) message security. A design goal is to use message security rather than transport security, so that in the future it can support a richer claims-based model. For more information about using rich claims for authorization, see [Managing Claims and Authorization with the Identity Model](../../../../docs/framework/wcf/feature-details/managing-claims-and-authorization-with-the-identity-model.md).\n\nFor a sample application, see [Message Security Anonymous](../../../../docs/framework/wcf/samples/message-security-anonymous.md).\n\n![Message security with an anonymous client](../../../../docs/framework/wcf/feature-details/media/b361a565-831c-4c10-90d7-66d8eeece0a1.gif \"b361a565-831c-4c10-90d7-66d8eeece0a1\")\n\n|Characteristic|Description|\n|--------------------|-----------------|\n|Security Mode|Message|\n|Interoperability|WCF only|\n|Authentication (Server)|Initial negotiation requires server authentication, but not client authentication|\n|Authentication (Client)|None|\n|Integrity|Yes, using shared security context|\n|Confidentiality|Yes, using shared security context|\n|Transport|HTTP|\n\n## Service\n\nThe following code and configuration are meant to run independently. Do one of the following:\n\n- Create a stand-alone service using the code with no configuration.\n\n- Create a service using the supplied configuration, but do not define any endpoints.\n\n### Code\n\nThe following code shows how to create a service endpoint that uses message security.\n\n[!code-csharp[C_SecurityScenarios#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#8)]\n[!code-vb[C_SecurityScenarios#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#8)]\n\n### Configuration\n\nThe following configuration can be used instead of the code. The service behavior element is used to specify a certificate that is used to authenticate the service to the client. The service element must specify the behavior using the `behaviorConfiguration` attribute. The binding element specifies that the client credential type is `None`, allowing anonymous clients to use the service.\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<configuration>\n  <system.serviceModel>\n    <behaviors>\n      <serviceBehaviors>\n        <behavior name=\"ServiceCredentialsBehavior\">\n          <serviceCredentials>\n            <serviceCertificate findValue=\"contoso.com\"\n                                storeLocation=\"LocalMachine\"\n                                storeName=\"My\" />\n          </serviceCredentials>\n        </behavior>\n      </serviceBehaviors>\n    </behaviors>\n    <services>\n      <service behaviorConfiguration=\"ServiceCredentialsBehavior\"\n               name=\"ServiceModel.Calculator\">\n        <endpoint address=\"http://localhost/Calculator\"\n                  binding=\"wsHttpBinding\"\n                  bindingConfiguration=\"WSHttpBinding_ICalculator\"\n                  name=\"CalculatorService\"\n                  contract=\"ServiceModel.ICalculator\" />\n      </service>\n    </services>\n    <bindings>\n      <wsHttpBinding>\n        <binding name=\"WSHttpBinding_ICalculator\" >\n          <security mode=\"Message\">\n            <message clientCredentialType=\"None\" />\n          </security>\n        </binding>\n      </wsHttpBinding>\n    </bindings>\n    <client />\n  </system.serviceModel>\n</configuration>\n```\n\n## Client\n\nThe following code and configuration are meant to run independently. Do one of the following:\n\n- Create a stand-alone client using the code (and client code).\n\n- Create a client that does not define any endpoint addresses. Instead, use the client constructor that takes the configuration name as an argument. For example:\n\n    [!code-csharp[C_SecurityScenarios#0](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#0)]\n    [!code-vb[C_SecurityScenarios#0](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#0)]\n\n### Code\n\nThe following code creates an instance of the client. The binding uses message mode security, and the client credential type is set to none.\n\n[!code-csharp[C_SecurityScenarios#15](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#15)]\n[!code-vb[C_SecurityScenarios#15](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#15)]\n\n### Configuration\n\nThe following code configures the client.\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<configuration>\n  <system.serviceModel>\n    <bindings>\n      <wsHttpBinding>\n        <binding name=\"WSHttpBinding_ICalculator\" >\n          <security mode=\"Message\">\n            <message clientCredentialType=\"None\" />\n          </security>\n        </binding>\n      </wsHttpBinding>\n    </bindings>\n    <client>\n      <endpoint address=\"http://machineName/Calculator\"\n        binding=\"wsHttpBinding\"\n        bindingConfiguration=\"WSHttpBinding_ICalculator\"\n        contract=\"ICalculator\"\n        name=\"WSHttpBinding_ICalculator\">\n        <identity>\n          <dns value=\"contoso.com\" />\n        </identity>\n      </endpoint>\n    </client>\n  </system.serviceModel>\n</configuration>\n```\n\n## See also\n\n- [Security Overview](../../../../docs/framework/wcf/feature-details/security-overview.md)\n- [Distributed Application Security](../../../../docs/framework/wcf/feature-details/distributed-application-security.md)\n- [Message Security Anonymous](../../../../docs/framework/wcf/samples/message-security-anonymous.md)\n- [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)\n- [Security Model for Windows Server App Fabric](https://go.microsoft.com/fwlink/?LinkID=201279&clcid=0x409)\n","nodes":[{"pos":[4,158],"embed":true,"restype":"x-metadata","content":"title: \"Message Security with an Anonymous Client\"\nms.date: \"03/30/2017\"\ndev_langs:\n  - \"csharp\"\n  - \"vb\"\nms.assetid: cad53e1a-b7c9-4064-bc87-508c3d1dce49","nodes":[{"content":"Message Security with an Anonymous Client","nodes":[{"pos":[0,41],"content":"Message Security with an Anonymous Client","nodes":[{"content":"Message Security with an Anonymous Client","pos":[0,41]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[166,207],"content":"Message Security with an Anonymous Client","linkify":"Message Security with an Anonymous Client","nodes":[{"content":"Message Security with an Anonymous Client","pos":[0,41]}]},{"content":"The following scenario shows a client and service secured by Windows Communication Foundation (WCF) message security.","pos":[209,326]},{"content":"A design goal is to use message security rather than transport security, so that in the future it can support a richer claims-based model.","pos":[327,465]},{"content":"For more information about using rich claims for authorization, see <bpt id=\"p1\">[</bpt>Managing Claims and Authorization with the Identity Model<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/managing-claims-and-authorization-with-the-identity-model.md)</ept>.","pos":[466,703],"source":" For more information about using rich claims for authorization, see [Managing Claims and Authorization with the Identity Model](../../../../docs/framework/wcf/feature-details/managing-claims-and-authorization-with-the-identity-model.md)."},{"pos":[705,834],"content":"For a sample application, see <bpt id=\"p1\">[</bpt>Message Security Anonymous<ept id=\"p1\">](../../../../docs/framework/wcf/samples/message-security-anonymous.md)</ept>.","source":"For a sample application, see [Message Security Anonymous](../../../../docs/framework/wcf/samples/message-security-anonymous.md)."},{"pos":[836,1014],"content":"<bpt id=\"p1\">![</bpt>Message security with an anonymous client<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wcf/feature-details/media/b361a565-831c-4c10-90d7-66d8eeece0a1.gif \"</bpt>b361a565-831c-4c10-90d7-66d8eeece0a1<ept id=\"p2\">\")</ept>","source":"![Message security with an anonymous client](../../../../docs/framework/wcf/feature-details/media/b361a565-831c-4c10-90d7-66d8eeece0a1.gif \"b361a565-831c-4c10-90d7-66d8eeece0a1\")"},{"content":"Characteristic","pos":[1017,1031]},{"content":"Description","pos":[1032,1043]},{"content":"Security Mode","pos":[1087,1100]},{"content":"Message","pos":[1101,1108]},{"content":"Interoperability","pos":[1111,1127]},{"content":"WCF only","pos":[1128,1136]},{"content":"Authentication (Server)","pos":[1139,1162]},{"content":"Initial negotiation requires server authentication, but not client authentication","pos":[1163,1244]},{"content":"Authentication (Client)","pos":[1247,1270]},{"content":"None","pos":[1271,1275]},{"content":"Integrity","pos":[1278,1287]},{"content":"Yes, using shared security context","pos":[1288,1322]},{"content":"Confidentiality","pos":[1325,1340]},{"content":"Yes, using shared security context","pos":[1341,1375]},{"content":"Transport","pos":[1378,1387]},{"content":"HTTP","pos":[1388,1392]},{"pos":[1398,1405],"content":"Service","linkify":"Service","nodes":[{"content":"Service","pos":[0,7]}]},{"content":"The following code and configuration are meant to run independently.","pos":[1407,1475]},{"content":"Do one of the following:","pos":[1476,1500]},{"content":"Create a stand-alone service using the code with no configuration.","pos":[1504,1570]},{"content":"Create a service using the supplied configuration, but do not define any endpoints.","pos":[1574,1657]},{"pos":[1663,1667],"content":"Code","linkify":"Code","nodes":[{"content":"Code","pos":[0,4]}]},{"content":"The following code shows how to create a service endpoint that uses message security.","pos":[1669,1754]},{"pos":[2014,2027],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"content":"The following configuration can be used instead of the code.","pos":[2029,2089]},{"content":"The service behavior element is used to specify a certificate that is used to authenticate the service to the client.","pos":[2090,2207]},{"content":"The service element must specify the behavior using the <ph id=\"ph1\">`behaviorConfiguration`</ph> attribute.","pos":[2208,2298],"source":" The service element must specify the behavior using the `behaviorConfiguration` attribute."},{"content":"The binding element specifies that the client credential type is <ph id=\"ph1\">`None`</ph>, allowing anonymous clients to use the service.","pos":[2299,2418],"source":" The binding element specifies that the client credential type is `None`, allowing anonymous clients to use the service."},{"pos":[3641,3647],"content":"Client","linkify":"Client","nodes":[{"content":"Client","pos":[0,6]}]},{"content":"The following code and configuration are meant to run independently.","pos":[3649,3717]},{"content":"Do one of the following:","pos":[3718,3742]},{"content":"Create a stand-alone client using the code (and client code).","pos":[3746,3807]},{"content":"Create a client that does not define any endpoint addresses.","pos":[3811,3871]},{"content":"Instead, use the client constructor that takes the configuration name as an argument.","pos":[3872,3957]},{"content":"For example:","pos":[3958,3970]},{"pos":[3976,4232],"content":"[!code-csharp[C_SecurityScenarios#0](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#0)]\n  [!code-vb[C_SecurityScenarios#0](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#0)]","leadings":["","  "],"nodes":[]},{"pos":[4238,4242],"content":"Code","linkify":"Code","nodes":[{"content":"Code","pos":[0,4]}]},{"content":"The following code creates an instance of the client.","pos":[4244,4297]},{"content":"The binding uses message mode security, and the client credential type is set to none.","pos":[4298,4384]},{"pos":[4648,4661],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"content":"The following code configures the client.","pos":[4663,4704]},{"pos":[5439,5447],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[5451,5539],"content":"<bpt id=\"p1\">[</bpt>Security Overview<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/security-overview.md)</ept>","source":"[Security Overview](../../../../docs/framework/wcf/feature-details/security-overview.md)"},{"pos":[5542,5660],"content":"<bpt id=\"p1\">[</bpt>Distributed Application Security<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/distributed-application-security.md)</ept>","source":"[Distributed Application Security](../../../../docs/framework/wcf/feature-details/distributed-application-security.md)"},{"pos":[5663,5761],"content":"<bpt id=\"p1\">[</bpt>Message Security Anonymous<ept id=\"p1\">](../../../../docs/framework/wcf/samples/message-security-anonymous.md)</ept>","source":"[Message Security Anonymous](../../../../docs/framework/wcf/samples/message-security-anonymous.md)"},{"pos":[5764,5888],"content":"<bpt id=\"p1\">[</bpt>Service Identity and Authentication<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)</ept>","source":"[Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)"},{"pos":[5891,5997],"content":"<bpt id=\"p1\">[</bpt>Security Model for Windows Server App Fabric<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkID=201279&amp;clcid=0x409)</ept>","source":"[Security Model for Windows Server App Fabric](https://go.microsoft.com/fwlink/?LinkID=201279&clcid=0x409)"}]}