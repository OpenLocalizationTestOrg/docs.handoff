{"content":"---\ntitle: \"How to: Implement a Client Application that Uses the Discovery Proxy to Find a Service\"\nms.date: \"03/30/2017\"\nms.assetid: 62b41a75-cf40-4c52-a842-a5f1c70e247f\n---\n# How to: Implement a Client Application that Uses the Discovery Proxy to Find a Service\nThis topic is the third of three topics that discusses how to implement a discovery proxy. In the previous topic, [How to: Implement a Discoverable Service that Registers with the Discovery Proxy](../../../../docs/framework/wcf/feature-details/discoverable-service-that-registers-with-the-discovery-proxy.md), you implemented a WCF service that registers itself with the discovery proxy. In this topic you create a WCF client that uses the discovery proxy to find the WCF service.  \n  \n### Implement the client  \n  \n1.  Add a new console application project to the `DiscoveryProxyExample` solution called `Client`.  \n  \n2.  Add references to the following assemblies:  \n  \n    1.  System.ServiceModel  \n  \n    2.  System.ServiceModel.Discovery  \n  \n3.  Add the GeneratedClient.cs found at the bottom of this topic to the project.  \n  \n    > [!NOTE]\n    >  This file is usually generated using a tool such as Svcutil.exe. It is provided in this topic to simplify the task.  \n  \n4.  Open the Program.cs file and add the following method. This method takes an endpoint address and uses it to initialize the service client (proxy).  \n  \n    ```csharp  \n    static void InvokeCalculatorService(EndpointAddress endpointAddress)  \n    {  \n        // Create a client  \n        CalculatorServiceClient client = new CalculatorServiceClient(new NetTcpBinding(), endpointAddress);  \n        Console.WriteLine(\"Invoking CalculatorService at {0}\", endpointAddress.Uri);  \n        Console.WriteLine();  \n\n        double value1 = 100.00D;  \n        double value2 = 15.99D;  \n\n        // Call the Add service operation.  \n        double result = client.Add(value1, value2);  \n        Console.WriteLine(\"Add({0},{1}) = {2}\", value1, value2, result);  \n\n        // Call the Subtract service operation.  \n        result = client.Subtract(value1, value2);  \n        Console.WriteLine(\"Subtract({0},{1}) = {2}\", value1, value2, result);  \n\n        // Call the Multiply service operation.  \n        result = client.Multiply(value1, value2);  \n        Console.WriteLine(\"Multiply({0},{1}) = {2}\", value1, value2, result);  \n\n        // Call the Divide service operation.  \n        result = client.Divide(value1, value2);  \n        Console.WriteLine(\"Divide({0},{1}) = {2}\", value1, value2, result);  \n        Console.WriteLine();  \n\n        // Closing the client gracefully closes the connection and cleans up resources  \n        client.Close();  \n    }  \n    ```  \n  \n5.  Add the following code to the `Main` method.  \n  \n    ```csharp  \n    public static void Main()  \n    {  \n        // Create a DiscoveryEndpoint that points to the DiscoveryProxy  \n        Uri probeEndpointAddress = new Uri(\"net.tcp://localhost:8001/Probe\");  \n        DiscoveryEndpoint discoveryEndpoint = new DiscoveryEndpoint(new NetTcpBinding(), new EndpointAddress(probeEndpointAddress));  \n\n        // Create a DiscoveryClient passing in the discovery endpoint  \n        DiscoveryClient discoveryClient = new DiscoveryClient(discoveryEndpoint);  \n\n        Console.WriteLine(\"Finding ICalculatorService endpoints using the proxy at {0}\", probeEndpointAddress);  \n        Console.WriteLine();  \n\n        try  \n        {  \n            // Search for services that implement ICalculatorService              \n            FindResponse findResponse = discoveryClient.Find(new FindCriteria(typeof(ICalculatorService)));  \n\n            Console.WriteLine(\"Found {0} ICalculatorService endpoint(s).\", findResponse.Endpoints.Count);  \n            Console.WriteLine();  \n\n            // Check to see if endpoints were found, if so then invoke the service.  \n            if (findResponse.Endpoints.Count > 0)  \n            {  \n                InvokeCalculatorService(findResponse.Endpoints[0].Address);  \n            }  \n        }  \n        catch (TargetInvocationException)  \n        {  \n            Console.WriteLine(\"This client was unable to connect to and query the proxy. Ensure that the proxy is up and running.\");  \n        }  \n\n        Console.WriteLine(\"Press <ENTER> to exit.\");  \n        Console.ReadLine();  \n    }  \n    ```  \n  \n You have completed implementing the client application. Continue on to [How to: Test the Discovery Proxy](../../../../docs/framework/wcf/feature-details/how-to-test-the-discovery-proxy.md).  \n  \n## Example  \n This is the full code listing for this topic.  \n  \n```csharp  \n// GeneratedClient.cs  \n//----------------------------------------------------------------  \n// Copyright (c) Microsoft Corporation.  All rights reserved.  \n//----------------------------------------------------------------  \n//------------------------------------------------------------------------------  \n// <auto-generated>  \n//     This code was generated by a tool.  \n//     Runtime Version:2.0.50727.1434  \n//  \n//     Changes to this file may cause incorrect behavior and will be lost if  \n//     the code is regenerated.  \n// </auto-generated>  \n//------------------------------------------------------------------------------  \n  \nnamespace Microsoft.Samples.Discovery  \n{  \n    [System.CodeDom.Compiler.GeneratedCodeAttribute(\"System.ServiceModel\", \"4.0.0.0\")]  \n    [System.ServiceModel.ServiceContractAttribute(Namespace = \"http://Microsoft.Samples.Discovery\", ConfigurationName = \"ICalculatorService\")]  \n    public interface ICalculatorService  \n    {  \n  \n        [System.ServiceModel.OperationContractAttribute(ProtectionLevel = System.Net.Security.ProtectionLevel.EncryptAndSign, Action = \"http://Microsoft.Samples.Discovery/ICalculatorService/Add\", ReplyAction = \"http://Microsoft.Samples.Discovery/ICalculatorService/AddResponse\")]  \n        double Add(double n1, double n2);  \n  \n        [System.ServiceModel.OperationContractAttribute(ProtectionLevel = System.Net.Security.ProtectionLevel.EncryptAndSign, Action = \"http://Microsoft.Samples.Discovery/ICalculatorService/Subtract\", ReplyAction = \"http://Microsoft.Samples.Discovery/ICalculatorService/SubtractResponse\")]  \n        double Subtract(double n1, double n2);  \n  \n        [System.ServiceModel.OperationContractAttribute(ProtectionLevel = System.Net.Security.ProtectionLevel.EncryptAndSign, Action = \"http://Microsoft.Samples.Discovery/ICalculatorService/Multiply\", ReplyAction = \"http://Microsoft.Samples.Discovery/ICalculatorService/MultiplyResponse\")]  \n        double Multiply(double n1, double n2);  \n  \n        [System.ServiceModel.OperationContractAttribute(ProtectionLevel = System.Net.Security.ProtectionLevel.EncryptAndSign, Action = \"http://Microsoft.Samples.Discovery/ICalculatorService/Divide\", ReplyAction = \"http://Microsoft.Samples.Discovery/ICalculatorService/DivideResponse\")]  \n        double Divide(double n1, double n2);  \n    }  \n  \n    [System.CodeDom.Compiler.GeneratedCodeAttribute(\"System.ServiceModel\", \"4.0.0.0\")]  \n    public interface ICalculatorServiceChannel : ICalculatorService, System.ServiceModel.IClientChannel  \n    {  \n    }  \n  \n    [System.Diagnostics.DebuggerStepThroughAttribute()]  \n    [System.CodeDom.Compiler.GeneratedCodeAttribute(\"System.ServiceModel\", \"4.0.0.0\")]  \n    public partial class CalculatorServiceClient : System.ServiceModel.ClientBase<ICalculatorService>, ICalculatorService  \n    {  \n  \n        public CalculatorServiceClient()  \n        {  \n        }  \n  \n        public CalculatorServiceClient(string endpointConfigurationName) :  \n            base(endpointConfigurationName)  \n        {  \n        }  \n  \n        public CalculatorServiceClient(string endpointConfigurationName, string remoteAddress) :  \n            base(endpointConfigurationName, remoteAddress)  \n        {  \n        }  \n  \n        public CalculatorServiceClient(string endpointConfigurationName, System.ServiceModel.EndpointAddress remoteAddress) :  \n            base(endpointConfigurationName, remoteAddress)  \n        {  \n        }  \n  \n        public CalculatorServiceClient(System.ServiceModel.Channels.Binding binding, System.ServiceModel.EndpointAddress remoteAddress) :  \n            base(binding, remoteAddress)  \n        {  \n        }  \n  \n        public double Add(double n1, double n2)  \n        {  \n            return base.Channel.Add(n1, n2);  \n        }  \n  \n        public double Subtract(double n1, double n2)  \n        {  \n            return base.Channel.Subtract(n1, n2);  \n        }  \n  \n        public double Multiply(double n1, double n2)  \n        {  \n            return base.Channel.Multiply(n1, n2);  \n        }  \n  \n        public double Divide(double n1, double n2)  \n        {  \n            return base.Channel.Divide(n1, n2);  \n        }  \n    }  \n}  \n```  \n  \n```csharp  \n// Program.cs  \n//----------------------------------------------------------------  \n// Copyright (c) Microsoft Corporation.  All rights reserved.  \n//----------------------------------------------------------------  \n  \nusing System;  \nusing System.Reflection;  \nusing System.ServiceModel;  \nusing System.ServiceModel.Discovery;  \n  \nnamespace Microsoft.Samples.Discovery  \n{  \n    class Client  \n    {  \n        public static void Main()  \n        {  \n            // Create a DiscoveryEndpoint that points to the DiscoveryProxy  \n            Uri probeEndpointAddress = new Uri(\"net.tcp://localhost:8001/Probe\");  \n            DiscoveryEndpoint discoveryEndpoint = new DiscoveryEndpoint(new NetTcpBinding(), new EndpointAddress(probeEndpointAddress));  \n  \n            DiscoveryClient discoveryClient = new DiscoveryClient(discoveryEndpoint);  \n  \n            Console.WriteLine(\"Finding ICalculatorService endpoints using the proxy at {0}\", probeEndpointAddress);  \n            Console.WriteLine();  \n  \n            try  \n            {  \n                // Find ICalculatorService endpoints              \n                FindResponse findResponse = discoveryClient.Find(new FindCriteria(typeof(ICalculatorService)));  \n  \n                Console.WriteLine(\"Found {0} ICalculatorService endpoint(s).\", findResponse.Endpoints.Count);  \n                Console.WriteLine();  \n  \n                // Check to see if endpoints were found, if so then invoke the service.  \n                if (findResponse.Endpoints.Count > 0)  \n                {  \n                    InvokeCalculatorService(findResponse.Endpoints[0].Address);  \n                }  \n            }  \n            catch (TargetInvocationException)  \n            {  \n                Console.WriteLine(\"This client was unable to connect to and query the proxy. Ensure that the proxy is up and running.\");  \n            }  \n  \n            Console.WriteLine(\"Press <ENTER> to exit.\");  \n            Console.ReadLine();  \n        }  \n  \n        static void InvokeCalculatorService(EndpointAddress endpointAddress)  \n        {  \n            // Create a client  \n            CalculatorServiceClient client = new CalculatorServiceClient(new NetTcpBinding(), endpointAddress);  \n            Console.WriteLine(\"Invoking CalculatorService at {0}\", endpointAddress.Uri);  \n            Console.WriteLine();  \n  \n            double value1 = 100.00D;  \n            double value2 = 15.99D;  \n  \n            // Call the Add service operation.  \n            double result = client.Add(value1, value2);  \n            Console.WriteLine(\"Add({0},{1}) = {2}\", value1, value2, result);  \n  \n            // Call the Subtract service operation.  \n            result = client.Subtract(value1, value2);  \n            Console.WriteLine(\"Subtract({0},{1}) = {2}\", value1, value2, result);  \n  \n            // Call the Multiply service operation.  \n            result = client.Multiply(value1, value2);  \n            Console.WriteLine(\"Multiply({0},{1}) = {2}\", value1, value2, result);  \n  \n            // Call the Divide service operation.  \n            result = client.Divide(value1, value2);  \n            Console.WriteLine(\"Divide({0},{1}) = {2}\", value1, value2, result);  \n            Console.WriteLine();  \n  \n            // Closing the client gracefully closes the connection and cleans up resources  \n            client.Close();  \n        }  \n    }  \n}  \n```  \n  \n## See also\n\n- [WCF Discovery Overview](../../../../docs/framework/wcf/feature-details/wcf-discovery-overview.md)\n- [How to: Implement a Discovery Proxy](../../../../docs/framework/wcf/feature-details/how-to-implement-a-discovery-proxy.md)\n- [How to: Implement a Discoverable Service that Registers with the Discovery Proxy](../../../../docs/framework/wcf/feature-details/discoverable-service-that-registers-with-the-discovery-proxy.md)\n","nodes":[{"pos":[4,170],"embed":true,"restype":"x-metadata","content":"title: \"How to: Implement a Client Application that Uses the Discovery Proxy to Find a Service\"\nms.date: \"03/30/2017\"\nms.assetid: 62b41a75-cf40-4c52-a842-a5f1c70e247f","nodes":[{"content":"How to: Implement a Client Application that Uses the Discovery Proxy to Find a Service","nodes":[{"pos":[0,86],"content":"How to: Implement a Client Application that Uses the Discovery Proxy to Find a Service","nodes":[{"content":"How to: Implement a Client Application that Uses the Discovery Proxy to Find a Service","pos":[0,86]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[177,263],"content":"How to: Implement a Client Application that Uses the Discovery Proxy to Find a Service","linkify":"How to: Implement a Client Application that Uses the Discovery Proxy to Find a Service","nodes":[{"content":"How to: Implement a Client Application that Uses the Discovery Proxy to Find a Service","pos":[0,86]}]},{"content":"This topic is the third of three topics that discusses how to implement a discovery proxy.","pos":[264,354]},{"content":"In the previous topic, <bpt id=\"p1\">[</bpt>How to: Implement a Discoverable Service that Registers with the Discovery Proxy<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/discoverable-service-that-registers-with-the-discovery-proxy.md)</ept>, you implemented a WCF service that registers itself with the discovery proxy.","pos":[355,651],"source":" In the previous topic, [How to: Implement a Discoverable Service that Registers with the Discovery Proxy](../../../../docs/framework/wcf/feature-details/discoverable-service-that-registers-with-the-discovery-proxy.md), you implemented a WCF service that registers itself with the discovery proxy."},{"content":"In this topic you create a WCF client that uses the discovery proxy to find the WCF service.","pos":[652,744]},{"pos":[754,774],"content":"Implement the client","linkify":"Implement the client","nodes":[{"content":"Implement the client","pos":[0,20]}]},{"pos":[784,878],"content":"Add a new console application project to the <ph id=\"ph1\">`DiscoveryProxyExample`</ph> solution called <ph id=\"ph2\">`Client`</ph>.","source":"Add a new console application project to the `DiscoveryProxyExample` solution called `Client`."},{"content":"Add references to the following assemblies:","pos":[888,931]},{"content":"System.ServiceModel","pos":[945,964]},{"content":"System.ServiceModel.Discovery","pos":[978,1007]},{"content":"Add the GeneratedClient.cs found at the bottom of this topic to the project.","pos":[1017,1093]},{"pos":[1105,1235],"content":"[!NOTE]\nThis file is usually generated using a tool such as Svcutil.exe. It is provided in this topic to simplify the task.","leadings":["","    >  "],"nodes":[{"content":"This file is usually generated using a tool such as Svcutil.exe. It is provided in this topic to simplify the task.","pos":[8,123],"nodes":[{"content":"This file is usually generated using a tool such as Svcutil.exe.","pos":[0,64]},{"content":"It is provided in this topic to simplify the task.","pos":[65,115]}]}]},{"content":"Open the Program.cs file and add the following method.","pos":[1245,1299]},{"content":"This method takes an endpoint address and uses it to initialize the service client (proxy).","pos":[1300,1391]},{"pos":[2713,2757],"content":"Add the following code to the <ph id=\"ph1\">`Main`</ph> method.","source":"Add the following code to the `Main` method."},{"content":"You have completed implementing the client application.","pos":[4347,4402]},{"content":"Continue on to <bpt id=\"p1\">[</bpt>How to: Test the Discovery Proxy<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-test-the-discovery-proxy.md)</ept>.","pos":[4403,4536],"source":" Continue on to [How to: Test the Discovery Proxy](../../../../docs/framework/wcf/feature-details/how-to-test-the-discovery-proxy.md)."},{"pos":[4545,4552],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"This is the full code listing for this topic.","pos":[4556,4601]},{"pos":[12242,12250],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[12254,12352],"content":"<bpt id=\"p1\">[</bpt>WCF Discovery Overview<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/wcf-discovery-overview.md)</ept>","source":"[WCF Discovery Overview](../../../../docs/framework/wcf/feature-details/wcf-discovery-overview.md)"},{"pos":[12355,12478],"content":"<bpt id=\"p1\">[</bpt>How to: Implement a Discovery Proxy<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-implement-a-discovery-proxy.md)</ept>","source":"[How to: Implement a Discovery Proxy](../../../../docs/framework/wcf/feature-details/how-to-implement-a-discovery-proxy.md)"},{"pos":[12481,12675],"content":"<bpt id=\"p1\">[</bpt>How to: Implement a Discoverable Service that Registers with the Discovery Proxy<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/discoverable-service-that-registers-with-the-discovery-proxy.md)</ept>","source":"[How to: Implement a Discoverable Service that Registers with the Discovery Proxy](../../../../docs/framework/wcf/feature-details/discoverable-service-that-registers-with-the-discovery-proxy.md)"}]}