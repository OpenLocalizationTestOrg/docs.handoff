{"content":"---\ntitle: \"Securing Messages Using Transport Security | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 9029771a-097e-448a-a13a-55d2878330b8\ncaps.latest.revision: 21\nauthor: \"BrucePerlerMS\"\nms.author: \"bruceper\"\nmanager: \"mbaldwin\"\n---\n# Securing Messages Using Transport Security\nThis section discusses Message Queuing (MSMQ) transport security that you can use to secure messages sent to a queue.  \n  \n> [!NOTE]\n>  Before reading through this topic, it is recommended that you read [Security Concepts](../../../../docs/framework/wcf/feature-details/security-concepts.md).  \n  \n The following illustration provides a conceptual model of queued communication using [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]. This illustration and terminology is used to explain transport security concepts.  \n  \n ![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg \"Distributed-Queue-Figure\")  \n  \n When sending queued messages using [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] with <xref:System.ServiceModel.NetMsmqBinding>, the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] message is attached as a body of the MSMQ message. Transport security secures the entire MSMQ message (MSMQ message headers or properties and the message body). Because it is the body of the MSMQ message, using transport security also secures the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] message.  \n  \n The key concept behind transport security is that the client has to meet security requirements to get the message to the target queue. This is unlike Message security, where the message is secured for the application that receives the message.  \n  \n Transport security using <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> impacts how MSMQ messages are secured in-transit between the transmission queue and the target queue where secured implies:  \n  \n-   Signing the message to ensure it is not tampered with.  \n  \n-   Encrypting the message to ensure that it cannot be seen or tampered with. This is recommended but optional.  \n  \n-   The target queue manager that identifies the sender of the message for non-repudiation.  \n  \n In MSMQ, independent of authentication, the target queue has an access control list (ACL) to check whether the client has permission to send the message to the target queue. The receiving application is also checked for permission to receive the message from the target queue.  \n  \n## WCF MSMQ Transport Security Properties  \n MSMQ uses Windows security for authentication. It uses the Windows security identifier (SID) to identify the client and uses Active Directory directory service as the certificate authority when authenticating the client. This requires MSMQ to be installed with Active Directory integration. Because the Windows domain SID is used to identify the client, this security option is only meaningful when both the client and service are part of the same Windows domain.  \n  \n MSMQ also provides the ability to attach a certificate with the message that is not registered with Active Directory. In this case, it ensures that the message was signed using the attached certificate.  \n  \n [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] provides both these options as part of MSMQ transport security and they are the key pivot for transport security.  \n  \n By default, transport security is turned on.  \n  \n Given these basics, the following sections detail transport security properties bundled with <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.  \n  \n#### MSMQ Authentication Mode  \n The <xref:System.ServiceModel.MsmqTransportSecurity.MsmqAuthenticationMode%2A> dictates whether to use the Windows domain security or an external certificate-based security to secure the message. In both authentication modes, the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] queued transport channel uses the `CertificateValidationMode` specified in the service configuration. The certificate validation mode specifies the mechanism used to check the validity of the certificate.  \n  \n When transport security is turned on, the default setting is <xref:System.ServiceModel.MsmqAuthenticationMode>.  \n  \n#### Windows Domain Authentication Mode  \n The choice of using Windows security requires Active Directory integration. <xref:System.ServiceModel.MsmqAuthenticationMode> is the default transport security mode. When this is set, the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] channel attaches the Windows SID to the MSMQ message and uses its internal certificate obtained from Active Directory. MSMQ uses this internal certificate to secure the message. The receiving queue manager uses Active Directory to search and find a matching certificate to authenticate the client and checks that the SID also matches that of the client. This authentication step is executed if a certificate, either internally generated in the case of `WindowsDomain` authentication mode or externally generated in the case of `Certificate` authentication mode, is attached to the message even if the target queue is not marked as requiring authentication.  \n  \n> [!NOTE]\n>  When creating a queue, you can mark the queue as an authenticated queue to indicate that the queue requires authentication of the client sending messages to the queue. This ensures that no unauthenticated messages are accepted in the queue.  \n  \n The SID attached with the message is also used to check against the target queue's ACL to ensure that the client has the authority to send messages to the queue.  \n  \n#### Certificate Authentication Mode  \n The choice of using certificate authentication mode does not require Active Directory integration. In fact, in some cases, such as when MSMQ is installed in workgroup mode (without Active Directory integration) or when using the SOAP Reliable Messaging Protocol (SRMP) transfer protocol to send messages to the queue, only <xref:System.ServiceModel.MsmqAuthenticationMode> works.  \n  \n When sending a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] message with <xref:System.ServiceModel.MsmqAuthenticationMode>, the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] channel does not attach a Windows SID to the MSMQ message. As such, the target queue ACL must allow for `Anonymous` user access to send to the queue. The receiving queue manager checks whether the MSMQ message was signed with the certificate but does not perform any authentication.  \n  \n The certificate with its claims and identity information is populated in the <xref:System.ServiceModel.ServiceSecurityContext> by the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] queued transport channel. The service can use this information to perform its own authentication of the sender.  \n  \n### MSMQ Protection Level  \n The protection level dictates how to protect the MSMQ message to ensure that it is not tampered with. It is specified in the <xref:System.ServiceModel.MsmqTransportSecurity.MsmqProtectionLevel%2A> property. The default value is <xref:System.Net.Security.ProtectionLevel>.  \n  \n#### Sign Protection Level  \n The MSMQ message is signed using the internally generated certificate when using `WindowsDomain` authentication mode or an externally generated certificate when using `Certificate` authentication mode.  \n  \n#### Sign and Encrypt Protection Level  \n The MSMQ message is signed using the internally generated certificate when using `WindowsDomain` authentication mode or externally generated certificate when using `Certificate` authentication mode.  \n  \n In addition to signing the message, the MSMQ message is encrypted using the public key of the certificate obtained from Active Directory that belongs to the receiving queue manager that hosts the target queue. The sending queue manager ensures that the MSMQ message is encrypted in transit. The receiving queue manager decrypts the MSMQ message using the private key of its internal certificate and stores the message in the queue (if authenticated and authorized) in clear text.  \n  \n> [!NOTE]\n>  To encrypt the message, Active Directory access is required (`UseActiveDirectory` property of <xref:System.ServiceModel.NetMsmqBinding> must be set to `true`) and can be used with both <xref:System.ServiceModel.MsmqAuthenticationMode> and <xref:System.ServiceModel.MsmqAuthenticationMode>.  \n  \n#### None Protection Level  \n This is implied when <xref:System.ServiceModel.MsmqTransportSecurity.MsmqProtectionLevel%2A> is set to <xref:System.Net.Security.ProtectionLevel>. This cannot be a valid value for any other authentication modes.  \n  \n> [!NOTE]\n>  If the MSMQ message is signed, MSMQ checks whether the message is signed with the attached certificate (internal or external) independent of the state of the queue, that is, authenticated queue or not.  \n  \n### MSMQ Encryption Algorithm  \n The encryption algorithm specifies the algorithm to use to encrypt the MSMQ message on the wire. This property is used only if <xref:System.ServiceModel.MsmqTransportSecurity.MsmqProtectionLevel%2A> is set to <xref:System.Net.Security.ProtectionLevel>.  \n  \n The supported algorithms are `RC4Stream` and `AES` and the default is `RC4Stream`.  \n  \n You can use the `AES` algorithm only if the sender has MSMQ 4.0 installed. In addition, the target queue must also be hosted on MSMQ 4.0.  \n  \n### MSMQ Hash Algorithm  \n The hash algorithm specifies the algorithm used to create a digital signature of the MSMQ message. The receiving queue manager uses this same algorithm to authenticate the MSMQ message. This property is used only if <xref:System.ServiceModel.MsmqTransportSecurity.MsmqProtectionLevel%2A> is set to <xref:System.Net.Security.ProtectionLevel> or <xref:System.Net.Security.ProtectionLevel>.  \n  \n The supported algorithms are `MD5`, `SHA1`, `SHA256`, and `SHA512`. The default is `SHA1`.  \n  \n## See Also  \n [Message Queuing](http://msdn.microsoft.com/en-us/ff917e87-05d5-478f-9430-0f560675ece1)   \n [Security Concepts](../../../../docs/framework/wcf/feature-details/security-concepts.md)   \n [Securing Services and Clients](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)","nodes":[{"pos":[12,71],"content":"Securing Messages Using Transport Security | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Securing Messages Using Transport Security | Microsoft Docs","pos":[0,59]}]},{"pos":[381,423],"content":"Securing Messages Using Transport Security","linkify":"Securing Messages Using Transport Security","nodes":[{"content":"Securing Messages Using Transport Security","pos":[0,42]}]},{"content":"This section discusses Message Queuing (MSMQ) transport security that you can use to secure messages sent to a queue.","pos":[424,541]},{"pos":[549,716],"content":"[!NOTE]\n Before reading through this topic, it is recommended that you read [Security Concepts](../../../../docs/framework/wcf/feature-details/security-concepts.md).","leadings":["","> "],"nodes":[{"content":"Before reading through this topic, it is recommended that you read <bpt id=\"p1\">[</bpt>Security Concepts<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/security-concepts.md)</ept>.","pos":[9,165],"source":" Before reading through this topic, it is recommended that you read [Security Concepts](../../../../docs/framework/wcf/feature-details/security-concepts.md)."}]},{"content":"The following illustration provides a conceptual model of queued communication using <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph>.","pos":[723,864],"source":"The following illustration provides a conceptual model of queued communication using [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]."},{"content":"This illustration and terminology is used to explain transport security concepts.","pos":[865,946]},{"pos":[953,1092],"content":"<bpt id=\"p1\">![</bpt>Queued Application Diagram<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg \"</bpt>Distributed-Queue-Figure<ept id=\"p2\">\")</ept>","source":"![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg \"Distributed-Queue-Figure\")"},{"content":"When sending queued messages using <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> with <ph id=\"ph2\">&lt;xref:System.ServiceModel.NetMsmqBinding&gt;</ph>, the <ph id=\"ph3\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> message is attached as a body of the MSMQ message.","pos":[1099,1348],"source":"When sending queued messages using [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] with <xref:System.ServiceModel.NetMsmqBinding>, the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] message is attached as a body of the MSMQ message."},{"content":"Transport security secures the entire MSMQ message (MSMQ message headers or properties and the message body).","pos":[1349,1458]},{"content":"Because it is the body of the MSMQ message, using transport security also secures the <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> message.","pos":[1459,1609],"source":" Because it is the body of the MSMQ message, using transport security also secures the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] message."},{"content":"The key concept behind transport security is that the client has to meet security requirements to get the message to the target queue.","pos":[1616,1750]},{"content":"This is unlike Message security, where the message is secured for the application that receives the message.","pos":[1751,1859]},{"content":"Transport security using <ph id=\"ph1\">&lt;xref:System.ServiceModel.NetMsmqBinding&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding&gt;</ph> impacts how MSMQ messages are secured in-transit between the transmission queue and the target queue where secured implies:","pos":[1866,2126],"source":"Transport security using <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> impacts how MSMQ messages are secured in-transit between the transmission queue and the target queue where secured implies:"},{"content":"Signing the message to ensure it is not tampered with.","pos":[2136,2190]},{"content":"Encrypting the message to ensure that it cannot be seen or tampered with.","pos":[2200,2273]},{"content":"This is recommended but optional.","pos":[2274,2307]},{"content":"The target queue manager that identifies the sender of the message for non-repudiation.","pos":[2317,2404]},{"content":"In MSMQ, independent of authentication, the target queue has an access control list (ACL) to check whether the client has permission to send the message to the target queue.","pos":[2411,2584]},{"content":"The receiving application is also checked for permission to receive the message from the target queue.","pos":[2585,2687]},{"pos":[2696,2734],"content":"WCF MSMQ Transport Security Properties","linkify":"WCF MSMQ Transport Security Properties","nodes":[{"content":"WCF MSMQ Transport Security Properties","pos":[0,38]}]},{"content":"MSMQ uses Windows security for authentication.","pos":[2738,2784]},{"content":"It uses the Windows security identifier (SID) to identify the client and uses Active Directory directory service as the certificate authority when authenticating the client.","pos":[2785,2958]},{"content":"This requires MSMQ to be installed with Active Directory integration.","pos":[2959,3028]},{"content":"Because the Windows domain SID is used to identify the client, this security option is only meaningful when both the client and service are part of the same Windows domain.","pos":[3029,3201]},{"content":"MSMQ also provides the ability to attach a certificate with the message that is not registered with Active Directory.","pos":[3208,3325]},{"content":"In this case, it ensures that the message was signed using the attached certificate.","pos":[3326,3410]},{"pos":[3417,3586],"content":"<ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> provides both these options as part of MSMQ transport security and they are the key pivot for transport security.","source":"[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] provides both these options as part of MSMQ transport security and they are the key pivot for transport security."},{"content":"By default, transport security is turned on.","pos":[3593,3637]},{"content":"Given these basics, the following sections detail transport security properties bundled with <ph id=\"ph1\">&lt;xref:System.ServiceModel.NetMsmqBinding&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding&gt;</ph>.","pos":[3644,3849],"source":"Given these basics, the following sections detail transport security properties bundled with <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>."},{"pos":[3860,3884],"content":"MSMQ Authentication Mode","linkify":"MSMQ Authentication Mode","nodes":[{"content":"MSMQ Authentication Mode","pos":[0,24]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.MsmqTransportSecurity.MsmqAuthenticationMode%2A&gt;</ph> dictates whether to use the Windows domain security or an external certificate-based security to secure the message.","pos":[3888,4083],"source":"The <xref:System.ServiceModel.MsmqTransportSecurity.MsmqAuthenticationMode%2A> dictates whether to use the Windows domain security or an external certificate-based security to secure the message."},{"content":"In both authentication modes, the <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> queued transport channel uses the <ph id=\"ph2\">`CertificateValidationMode`</ph> specified in the service configuration.","pos":[4084,4275],"source":" In both authentication modes, the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] queued transport channel uses the `CertificateValidationMode` specified in the service configuration."},{"content":"The certificate validation mode specifies the mechanism used to check the validity of the certificate.","pos":[4276,4378]},{"content":"When transport security is turned on, the default setting is <ph id=\"ph1\">&lt;xref:System.ServiceModel.MsmqAuthenticationMode&gt;</ph>.","pos":[4385,4496],"source":"When transport security is turned on, the default setting is <xref:System.ServiceModel.MsmqAuthenticationMode>."},{"pos":[4507,4541],"content":"Windows Domain Authentication Mode","linkify":"Windows Domain Authentication Mode","nodes":[{"content":"Windows Domain Authentication Mode","pos":[0,34]}]},{"content":"The choice of using Windows security requires Active Directory integration.","pos":[4545,4620]},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.MsmqAuthenticationMode&gt;</ph> is the default transport security mode.","pos":[4621,4710],"source":"<xref:System.ServiceModel.MsmqAuthenticationMode> is the default transport security mode."},{"content":"When this is set, the <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> channel attaches the Windows SID to the MSMQ message and uses its internal certificate obtained from Active Directory.","pos":[4711,4907],"source":" When this is set, the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] channel attaches the Windows SID to the MSMQ message and uses its internal certificate obtained from Active Directory."},{"content":"MSMQ uses this internal certificate to secure the message.","pos":[4908,4966]},{"content":"The receiving queue manager uses Active Directory to search and find a matching certificate to authenticate the client and checks that the SID also matches that of the client.","pos":[4967,5142]},{"content":"This authentication step is executed if a certificate, either internally generated in the case of <ph id=\"ph1\">`WindowsDomain`</ph> authentication mode or externally generated in the case of <ph id=\"ph2\">`Certificate`</ph> authentication mode, is attached to the message even if the target queue is not marked as requiring authentication.","pos":[5143,5445],"source":" This authentication step is executed if a certificate, either internally generated in the case of `WindowsDomain` authentication mode or externally generated in the case of `Certificate` authentication mode, is attached to the message even if the target queue is not marked as requiring authentication."},{"pos":[5453,5704],"content":"[!NOTE]\n When creating a queue, you can mark the queue as an authenticated queue to indicate that the queue requires authentication of the client sending messages to the queue. This ensures that no unauthenticated messages are accepted in the queue.","leadings":["","> "],"nodes":[{"content":" When creating a queue, you can mark the queue as an authenticated queue to indicate that the queue requires authentication of the client sending messages to the queue. This ensures that no unauthenticated messages are accepted in the queue.","pos":[8,249],"nodes":[{"content":"When creating a queue, you can mark the queue as an authenticated queue to indicate that the queue requires authentication of the client sending messages to the queue.","pos":[1,168]},{"content":"This ensures that no unauthenticated messages are accepted in the queue.","pos":[169,241]}]}]},{"content":"The SID attached with the message is also used to check against the target queue's ACL to ensure that the client has the authority to send messages to the queue.","pos":[5711,5872]},{"pos":[5883,5914],"content":"Certificate Authentication Mode","linkify":"Certificate Authentication Mode","nodes":[{"content":"Certificate Authentication Mode","pos":[0,31]}]},{"content":"The choice of using certificate authentication mode does not require Active Directory integration.","pos":[5918,6016]},{"content":"In fact, in some cases, such as when MSMQ is installed in workgroup mode (without Active Directory integration) or when using the SOAP Reliable Messaging Protocol (SRMP) transfer protocol to send messages to the queue, only <ph id=\"ph1\">&lt;xref:System.ServiceModel.MsmqAuthenticationMode&gt;</ph> works.","pos":[6017,6297],"source":" In fact, in some cases, such as when MSMQ is installed in workgroup mode (without Active Directory integration) or when using the SOAP Reliable Messaging Protocol (SRMP) transfer protocol to send messages to the queue, only <xref:System.ServiceModel.MsmqAuthenticationMode> works."},{"content":"When sending a <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> message with <ph id=\"ph2\">&lt;xref:System.ServiceModel.MsmqAuthenticationMode&gt;</ph>, the <ph id=\"ph3\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> channel does not attach a Windows SID to the MSMQ message.","pos":[6304,6557],"source":"When sending a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] message with <xref:System.ServiceModel.MsmqAuthenticationMode>, the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] channel does not attach a Windows SID to the MSMQ message."},{"content":"As such, the target queue ACL must allow for <ph id=\"ph1\">`Anonymous`</ph> user access to send to the queue.","pos":[6558,6648],"source":" As such, the target queue ACL must allow for `Anonymous` user access to send to the queue."},{"content":"The receiving queue manager checks whether the MSMQ message was signed with the certificate but does not perform any authentication.","pos":[6649,6781]},{"content":"The certificate with its claims and identity information is populated in the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceSecurityContext&gt;</ph> by the <ph id=\"ph2\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> queued transport channel.","pos":[6788,7003],"source":"The certificate with its claims and identity information is populated in the <xref:System.ServiceModel.ServiceSecurityContext> by the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] queued transport channel."},{"content":"The service can use this information to perform its own authentication of the sender.","pos":[7004,7089]},{"pos":[7099,7120],"content":"MSMQ Protection Level","linkify":"MSMQ Protection Level","nodes":[{"content":"MSMQ Protection Level","pos":[0,21]}]},{"content":"The protection level dictates how to protect the MSMQ message to ensure that it is not tampered with.","pos":[7124,7225]},{"content":"It is specified in the <ph id=\"ph1\">&lt;xref:System.ServiceModel.MsmqTransportSecurity.MsmqProtectionLevel%2A&gt;</ph> property.","pos":[7226,7330],"source":" It is specified in the <xref:System.ServiceModel.MsmqTransportSecurity.MsmqProtectionLevel%2A> property."},{"content":"The default value is <ph id=\"ph1\">&lt;xref:System.Net.Security.ProtectionLevel&gt;</ph>.","pos":[7331,7395],"source":" The default value is <xref:System.Net.Security.ProtectionLevel>."},{"pos":[7406,7427],"content":"Sign Protection Level","linkify":"Sign Protection Level","nodes":[{"content":"Sign Protection Level","pos":[0,21]}]},{"pos":[7431,7632],"content":"The MSMQ message is signed using the internally generated certificate when using <ph id=\"ph1\">`WindowsDomain`</ph> authentication mode or an externally generated certificate when using <ph id=\"ph2\">`Certificate`</ph> authentication mode.","source":"The MSMQ message is signed using the internally generated certificate when using `WindowsDomain` authentication mode or an externally generated certificate when using `Certificate` authentication mode."},{"pos":[7643,7676],"content":"Sign and Encrypt Protection Level","linkify":"Sign and Encrypt Protection Level","nodes":[{"content":"Sign and Encrypt Protection Level","pos":[0,33]}]},{"pos":[7680,7878],"content":"The MSMQ message is signed using the internally generated certificate when using <ph id=\"ph1\">`WindowsDomain`</ph> authentication mode or externally generated certificate when using <ph id=\"ph2\">`Certificate`</ph> authentication mode.","source":"The MSMQ message is signed using the internally generated certificate when using `WindowsDomain` authentication mode or externally generated certificate when using `Certificate` authentication mode."},{"content":"In addition to signing the message, the MSMQ message is encrypted using the public key of the certificate obtained from Active Directory that belongs to the receiving queue manager that hosts the target queue.","pos":[7885,8094]},{"content":"The sending queue manager ensures that the MSMQ message is encrypted in transit.","pos":[8095,8175]},{"content":"The receiving queue manager decrypts the MSMQ message using the private key of its internal certificate and stores the message in the queue (if authenticated and authorized) in clear text.","pos":[8176,8364]},{"pos":[8372,8672],"content":"[!NOTE]\n To encrypt the message, Active Directory access is required (`UseActiveDirectory` property of <xref:System.ServiceModel.NetMsmqBinding> must be set to `true`) and can be used with both <xref:System.ServiceModel.MsmqAuthenticationMode> and <xref:System.ServiceModel.MsmqAuthenticationMode>.","leadings":["","> "],"nodes":[{"content":"To encrypt the message, Active Directory access is required (<ph id=\"ph1\">`UseActiveDirectory`</ph> property of <ph id=\"ph2\">&lt;xref:System.ServiceModel.NetMsmqBinding&gt;</ph> must be set to <ph id=\"ph3\">`true`</ph>) and can be used with both <ph id=\"ph4\">&lt;xref:System.ServiceModel.MsmqAuthenticationMode&gt;</ph> and <ph id=\"ph5\">&lt;xref:System.ServiceModel.MsmqAuthenticationMode&gt;</ph>.","pos":[9,298],"source":" To encrypt the message, Active Directory access is required (`UseActiveDirectory` property of <xref:System.ServiceModel.NetMsmqBinding> must be set to `true`) and can be used with both <xref:System.ServiceModel.MsmqAuthenticationMode> and <xref:System.ServiceModel.MsmqAuthenticationMode>."}]},{"pos":[8683,8704],"content":"None Protection Level","linkify":"None Protection Level","nodes":[{"content":"None Protection Level","pos":[0,21]}]},{"content":"This is implied when <ph id=\"ph1\">&lt;xref:System.ServiceModel.MsmqTransportSecurity.MsmqProtectionLevel%2A&gt;</ph> is set to <ph id=\"ph2\">&lt;xref:System.Net.Security.ProtectionLevel&gt;</ph>.","pos":[8708,8854],"source":"This is implied when <xref:System.ServiceModel.MsmqTransportSecurity.MsmqProtectionLevel%2A> is set to <xref:System.Net.Security.ProtectionLevel>."},{"content":"This cannot be a valid value for any other authentication modes.","pos":[8855,8919]},{"pos":[8927,9139],"content":"[!NOTE]\n If the MSMQ message is signed, MSMQ checks whether the message is signed with the attached certificate (internal or external) independent of the state of the queue, that is, authenticated queue or not.","leadings":["","> "],"nodes":[{"content":"If the MSMQ message is signed, MSMQ checks whether the message is signed with the attached certificate (internal or external) independent of the state of the queue, that is, authenticated queue or not.","pos":[9,210]}]},{"pos":[9149,9174],"content":"MSMQ Encryption Algorithm","linkify":"MSMQ Encryption Algorithm","nodes":[{"content":"MSMQ Encryption Algorithm","pos":[0,25]}]},{"content":"The encryption algorithm specifies the algorithm to use to encrypt the MSMQ message on the wire.","pos":[9178,9274]},{"content":"This property is used only if <ph id=\"ph1\">&lt;xref:System.ServiceModel.MsmqTransportSecurity.MsmqProtectionLevel%2A&gt;</ph> is set to <ph id=\"ph2\">&lt;xref:System.Net.Security.ProtectionLevel&gt;</ph>.","pos":[9275,9430],"source":" This property is used only if <xref:System.ServiceModel.MsmqTransportSecurity.MsmqProtectionLevel%2A> is set to <xref:System.Net.Security.ProtectionLevel>."},{"pos":[9437,9519],"content":"The supported algorithms are <ph id=\"ph1\">`RC4Stream`</ph> and <ph id=\"ph2\">`AES`</ph> and the default is <ph id=\"ph3\">`RC4Stream`</ph>.","source":"The supported algorithms are `RC4Stream` and `AES` and the default is `RC4Stream`."},{"content":"You can use the <ph id=\"ph1\">`AES`</ph> algorithm only if the sender has MSMQ 4.0 installed.","pos":[9526,9600],"source":"You can use the `AES` algorithm only if the sender has MSMQ 4.0 installed."},{"content":"In addition, the target queue must also be hosted on MSMQ 4.0.","pos":[9601,9663]},{"pos":[9673,9692],"content":"MSMQ Hash Algorithm","linkify":"MSMQ Hash Algorithm","nodes":[{"content":"MSMQ Hash Algorithm","pos":[0,19]}]},{"content":"The hash algorithm specifies the algorithm used to create a digital signature of the MSMQ message.","pos":[9696,9794]},{"content":"The receiving queue manager uses this same algorithm to authenticate the MSMQ message.","pos":[9795,9881]},{"content":"This property is used only if <ph id=\"ph1\">&lt;xref:System.ServiceModel.MsmqTransportSecurity.MsmqProtectionLevel%2A&gt;</ph> is set to <ph id=\"ph2\">&lt;xref:System.Net.Security.ProtectionLevel&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.Net.Security.ProtectionLevel&gt;</ph>.","pos":[9882,10083],"source":" This property is used only if <xref:System.ServiceModel.MsmqTransportSecurity.MsmqProtectionLevel%2A> is set to <xref:System.Net.Security.ProtectionLevel> or <xref:System.Net.Security.ProtectionLevel>."},{"content":"The supported algorithms are <ph id=\"ph1\">`MD5`</ph>, <ph id=\"ph2\">`SHA1`</ph>, <ph id=\"ph3\">`SHA256`</ph>, and <ph id=\"ph4\">`SHA512`</ph>.","pos":[10090,10157],"source":"The supported algorithms are `MD5`, `SHA1`, `SHA256`, and `SHA512`."},{"content":"The default is <ph id=\"ph1\">`SHA1`</ph>.","pos":[10158,10180],"source":" The default is `SHA1`."},{"pos":[10189,10197],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Message Queuing<ept id=\"p1\">](http://msdn.microsoft.com/en-us/ff917e87-05d5-478f-9430-0f560675ece1)</ept><ph id=\"ph1\"> </ph>","pos":[10201,10289],"source":"[Message Queuing](http://msdn.microsoft.com/en-us/ff917e87-05d5-478f-9430-0f560675ece1) "},{"content":"<bpt id=\"p1\"> [</bpt>Security Concepts<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/security-concepts.md)</ept><ph id=\"ph1\"> </ph>","pos":[10292,10382],"source":" [Security Concepts](../../../../docs/framework/wcf/feature-details/security-concepts.md) "},{"content":"<bpt id=\"p1\"> [</bpt>Securing Services and Clients<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)</ept>","pos":[10385,10498],"source":" [Securing Services and Clients](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)"}]}