{"content":"---\ntitle: \"SpinWait | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"synchronization primitives, SpinWait\"\nms.assetid: 36012f42-34e5-4f86-adf4-973f433ed6c6\ncaps.latest.revision: 9\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# SpinWait\n<xref:System.Threading.SpinWait?displayProperty=fullName> is a lightweight synchronization type that you can use in low-level scenarios to avoid the expensive context switches and kernel transitions that are required for kernel events. On multicore computers, when a resource is not expected to be held for long periods of time, it can be more efficient for a waiting thread to spin in user mode for a few dozen or a few hundred cycles, and then retry to acquire the resource. If the resource is available after spinning, then you have saved several thousand cycles. If the resource is still not available, then you have spent only a few cycles and can still enter a kernel-based wait. This spinning-then-waiting combination is sometimes referred to as a *two-phase wait operation*.  \n  \n <xref:System.Threading.SpinWait> is designed to be used in conjunction with the .NET Framework types that wrap kernel events such as <xref:System.Threading.ManualResetEvent>. <xref:System.Threading.SpinWait> can also be used by itself for basic spinning functionality in just one program.  \n  \n <xref:System.Threading.SpinWait> is more than just an empty loop. It is carefully implemented to provide correct spinning behavior for the general case, and will itself initiate context switches if it spins long enough (roughly the length of time required for a kernel transition). For example, on single-core computers, <xref:System.Threading.SpinWait> yields the time slice of the thread immediately because spinning blocks forward progress on all threads. <xref:System.Threading.SpinWait> also yields even on multi-core machines to prevent the waiting thread from blocking higher-priority threads or the garbage collector. Therefore, if you are using a <xref:System.Threading.SpinWait> in a two-phase wait operation, we recommend that you invoke the kernel wait before the <xref:System.Threading.SpinWait> itself initiates a context switch. <xref:System.Threading.SpinWait> provides the <xref:System.Threading.SpinWait.NextSpinWillYield%2A> property, which you can check before every call to <xref:System.Threading.SpinWait.SpinOnce%2A>. When the property returns `true`, initiate your own Wait operation. For an example, see [How to: Use SpinWait to Implement a Two-Phase Wait Operation](../../../docs/standard/threading/how-to-use-spinwait-to-implement-a-two-phase-wait-operation.md).  \n  \n If you are not performing a two-phase wait operation but are just spinning until some condition is true, you can enable <xref:System.Threading.SpinWait> to perform its context switches so that it is a good citizen in the Windows operating system environment. The following basic example shows a <xref:System.Threading.SpinWait> in a lock-free stack. If you require a high-performance, thread-safe stack, consider using <xref:System.Collections.Concurrent.ConcurrentStack%601?displayProperty=fullName>.  \n  \n [!code-csharp[CDS_SpinWait#05](../../../samples/snippets/csharp/VS_Snippets_Misc/cds_spinwait/cs/spinwait.cs#05)]\n [!code-vb[CDS_SpinWait#05](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_spinwait/vb/cds_spinwait1.vb#05)]  \n  \n## See Also  \n <xref:System.Threading.Thread.SpinWait%2A>   \n [Threading Objects and Features](../../../docs/standard/threading/threading-objects-and-features.md)","nodes":[{"pos":[12,37],"content":"SpinWait | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"SpinWait | Microsoft Docs","pos":[0,25]}]},{"pos":[393,401],"content":"SpinWait","linkify":"SpinWait","nodes":[{"content":"SpinWait","pos":[0,8]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.SpinWait?displayProperty=fullName&gt;</ph> is a lightweight synchronization type that you can use in low-level scenarios to avoid the expensive context switches and kernel transitions that are required for kernel events.","pos":[402,637],"source":"<xref:System.Threading.SpinWait?displayProperty=fullName> is a lightweight synchronization type that you can use in low-level scenarios to avoid the expensive context switches and kernel transitions that are required for kernel events."},{"content":"On multicore computers, when a resource is not expected to be held for long periods of time, it can be more efficient for a waiting thread to spin in user mode for a few dozen or a few hundred cycles, and then retry to acquire the resource.","pos":[638,878]},{"content":"If the resource is available after spinning, then you have saved several thousand cycles.","pos":[879,968]},{"content":"If the resource is still not available, then you have spent only a few cycles and can still enter a kernel-based wait.","pos":[969,1087]},{"content":"This spinning-then-waiting combination is sometimes referred to as a <bpt id=\"p1\">*</bpt>two-phase wait operation<ept id=\"p1\">*</ept>.","pos":[1088,1184],"source":" This spinning-then-waiting combination is sometimes referred to as a *two-phase wait operation*."},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.SpinWait&gt;</ph> is designed to be used in conjunction with the .NET Framework types that wrap kernel events such as <ph id=\"ph2\">&lt;xref:System.Threading.ManualResetEvent&gt;</ph>.","pos":[1191,1365],"source":"<xref:System.Threading.SpinWait> is designed to be used in conjunction with the .NET Framework types that wrap kernel events such as <xref:System.Threading.ManualResetEvent>."},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.SpinWait&gt;</ph> can also be used by itself for basic spinning functionality in just one program.","pos":[1366,1479],"source":"<xref:System.Threading.SpinWait> can also be used by itself for basic spinning functionality in just one program."},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.SpinWait&gt;</ph> is more than just an empty loop.","pos":[1486,1551],"source":"<xref:System.Threading.SpinWait> is more than just an empty loop."},{"content":"It is carefully implemented to provide correct spinning behavior for the general case, and will itself initiate context switches if it spins long enough (roughly the length of time required for a kernel transition).","pos":[1552,1767]},{"content":"For example, on single-core computers, <ph id=\"ph1\">&lt;xref:System.Threading.SpinWait&gt;</ph> yields the time slice of the thread immediately because spinning blocks forward progress on all threads.","pos":[1768,1944],"source":" For example, on single-core computers, <xref:System.Threading.SpinWait> yields the time slice of the thread immediately because spinning blocks forward progress on all threads."},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.SpinWait&gt;</ph> also yields even on multi-core machines to prevent the waiting thread from blocking higher-priority threads or the garbage collector.","pos":[1945,2111],"source":"<xref:System.Threading.SpinWait> also yields even on multi-core machines to prevent the waiting thread from blocking higher-priority threads or the garbage collector."},{"content":"Therefore, if you are using a <ph id=\"ph1\">&lt;xref:System.Threading.SpinWait&gt;</ph> in a two-phase wait operation, we recommend that you invoke the kernel wait before the <ph id=\"ph2\">&lt;xref:System.Threading.SpinWait&gt;</ph> itself initiates a context switch.","pos":[2112,2329],"source":" Therefore, if you are using a <xref:System.Threading.SpinWait> in a two-phase wait operation, we recommend that you invoke the kernel wait before the <xref:System.Threading.SpinWait> itself initiates a context switch."},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.SpinWait&gt;</ph> provides the <ph id=\"ph2\">&lt;xref:System.Threading.SpinWait.NextSpinWillYield%2A&gt;</ph> property, which you can check before every call to <ph id=\"ph3\">&lt;xref:System.Threading.SpinWait.SpinOnce%2A&gt;</ph>.","pos":[2330,2526],"source":"<xref:System.Threading.SpinWait> provides the <xref:System.Threading.SpinWait.NextSpinWillYield%2A> property, which you can check before every call to <xref:System.Threading.SpinWait.SpinOnce%2A>."},{"content":"When the property returns <ph id=\"ph1\">`true`</ph>, initiate your own Wait operation.","pos":[2527,2594],"source":" When the property returns `true`, initiate your own Wait operation."},{"content":"For an example, see <bpt id=\"p1\">[</bpt>How to: Use SpinWait to Implement a Two-Phase Wait Operation<ept id=\"p1\">](../../../docs/standard/threading/how-to-use-spinwait-to-implement-a-two-phase-wait-operation.md)</ept>.","pos":[2595,2775],"source":" For an example, see [How to: Use SpinWait to Implement a Two-Phase Wait Operation](../../../docs/standard/threading/how-to-use-spinwait-to-implement-a-two-phase-wait-operation.md)."},{"content":"If you are not performing a two-phase wait operation but are just spinning until some condition is true, you can enable <ph id=\"ph1\">&lt;xref:System.Threading.SpinWait&gt;</ph> to perform its context switches so that it is a good citizen in the Windows operating system environment.","pos":[2782,3040],"source":"If you are not performing a two-phase wait operation but are just spinning until some condition is true, you can enable <xref:System.Threading.SpinWait> to perform its context switches so that it is a good citizen in the Windows operating system environment."},{"content":"The following basic example shows a <ph id=\"ph1\">&lt;xref:System.Threading.SpinWait&gt;</ph> in a lock-free stack.","pos":[3041,3131],"source":" The following basic example shows a <xref:System.Threading.SpinWait> in a lock-free stack."},{"content":"If you require a high-performance, thread-safe stack, consider using <ph id=\"ph1\">&lt;xref:System.Collections.Concurrent.ConcurrentStack%601?displayProperty=fullName&gt;</ph>.","pos":[3132,3283],"source":" If you require a high-performance, thread-safe stack, consider using <xref:System.Collections.Concurrent.ConcurrentStack%601?displayProperty=fullName>."},{"pos":[3290,3524],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>CDS_SpinWait#05<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/cds_spinwait/cs/spinwait.cs#05)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>CDS_SpinWait#05<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_spinwait/vb/cds_spinwait1.vb#05)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[CDS_SpinWait#05](../../../samples/snippets/csharp/VS_Snippets_Misc/cds_spinwait/cs/spinwait.cs#05)]\n [!code-vb[CDS_SpinWait#05](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_spinwait/vb/cds_spinwait1.vb#05)]"},{"pos":[3533,3541],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\"> [</bpt>Threading Objects and Features<ept id=\"p1\">](../../../docs/standard/threading/threading-objects-and-features.md)</ept>","pos":[3591,3692],"source":" [Threading Objects and Features](../../../docs/standard/threading/threading-objects-and-features.md)"}]}