{"content":"---\ntitle: \"Performance Counters and In-Process Side-By-Side Applications\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"performance counters\"\n  - \"performance counters,and in-process side-by-side applications\"\n  - \"performance,.NET Framework applications\"\n  - \"performance monitoring,counters\"\nms.assetid: 6888f9be-c65b-4b03-a07b-df7ebdee2436\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\n---\n# Performance Counters and In-Process Side-By-Side Applications\nUsing the Performance Monitor (Perfmon.exe), it is possible to differentiate the performance counters on a per-runtime basis. This topic describes the registry change needed to enable this functionality.  \n  \n## The Default Behavior  \n By default, the Performance Monitor displays performance counters on a per-application basis. However, there are two scenarios in which this is problematic:  \n  \n-   When you monitor two applications that have the same name. For example, if both applications are named myapp.exe, one will be displayed as **myapp** and the other as **myapp#1** in the **Instance** column. In this case, it is difficult to match a performance counter to a particular application. It is not clear whether the data collected for **myapp#1** refers to the first myapp.exe or the second myapp.exe.  \n  \n-   When an application uses multiple instances of the common language runtime. The [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)] supports in-process side-by-side hosting scenarios; that is, a single process or application can load multiple instances of the common language runtime. If a single application named myapp.exe loads two runtime instances, by default, they will be designated in the **Instance** column as **myapp** and **myapp#1**. In this case, it is not clear whether **myapp** and **myapp#1** refer to two applications with the same name, or to the same application with two runtimes. If multiple applications with the same name load multiple runtimes, the ambiguity is even greater.  \n  \n You can set a registry key to eliminate this ambiguity. For applications developed using the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], this registry change adds a process identifier followed by a runtime instance identifier to the application name in the **Instance** column. Instead of *application* or *application*#1, the application is now identified as *application*_`p`*processID*\\_`r`*runtimeID* in the **Instance** column. If an application was developed using a previous version of the common language runtime, that instance is represented as *application\\_*`p`*processID* provided that the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] is installed.  \n  \n## Performance Counters for In-Process Side-by-Side Applications  \n To handle performance counters for multiple common language runtime versions that are hosted in a single application, you must change a single registry key setting, as shown in the following table.  \n  \n|||  \n|-|-|  \n|Key name|HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\\\.NETFramework\\Performance|  \n|Value name|ProcessNameFormat|  \n|Value type|REG_DWORD|  \n|Value|1 (0x00000001)|  \n  \n A value of 0 for `ProcessNameFormat` indicates that the default behavior is enabled; that is, Perfmon.exe displays performance counters on a per-application basis. When you set this value to 1, Perfmon.exe disambiguates multiple versions of an application and provides performance counters on a per-runtime basis. Any other value for the `ProcessNameFormat` registry key setting is unsupported and reserved for future use.  \n  \n After you update the `ProcessNameFormat` registry key setting, you must restart Perfmon.exe or any other consumers of performance counters so that the new instance naming feature works correctly.  \n  \n The following example shows how to change the `ProcessNameFormat` value programmatically.  \n  \n [!code-csharp[Conceptual.PerfCounters.InProSxS#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.perfcounters.inprosxs/cs/regsetting1.cs#1)]\n [!code-vb[Conceptual.PerfCounters.InProSxS#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.perfcounters.inprosxs/vb/regsetting1.vb#1)]  \n  \n When you make this registry change, Perfmon.exe displays the names of applications that target the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] as *application*_`p`*processID*\\_`r`*runtimeID*, where *application* is the name of the application, *processID* is the application's process identifier, and *runtimeID* is a common language runtime identifier. For example, if an application named myapp.exe loads two instances of the common language runtime, Perfmon.exe may identify one instance as myapp_p1416_r10 and the second as myapp_p3160_r10. The runtime identifier only disambiguates the runtimes within a process; it does not provide any other information about the runtime. (For example, the runtime ID has no relation to the version or the SKU of the runtime.)  \n  \n If the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] is installed, the registry change also affects applications that were developed using earlier versions of the .NET Framework. These appear in Perfmon.exe as *application_*`p`*processID*, where *application* is the application name and *processID* is the process identifier. For example, if the performance counters of two applications named myapp.exe are monitored, one might appear as myapp_p23900 and the other as myapp_p24908.  \n  \n> [!NOTE]\n>  The process identifier eliminates the ambiguity of resolving two applications with the same name that use earlier versions of the runtime. A runtime identifier is not required for previous versions, because previous versions of the common language runtime do not support side-by-side scenarios.  \n  \n If the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] is not present or was uninstalled, setting the registry key has no effect. This means that two applications with the same name will continue to appear in Perfmon.exe as *application* and *application#1* (for example, as **myapp** and **myapp#1**).\n","nodes":[{"pos":[4,420],"embed":true,"restype":"x-metadata","content":"title: \"Performance Counters and In-Process Side-By-Side Applications\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"performance counters\"\n  - \"performance counters,and in-process side-by-side applications\"\n  - \"performance,.NET Framework applications\"\n  - \"performance monitoring,counters\"\nms.assetid: 6888f9be-c65b-4b03-a07b-df7ebdee2436\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"","nodes":[{"content":"Performance Counters and In-Process Side-By-Side Applications","nodes":[{"pos":[0,61],"content":"Performance Counters and In-Process Side-By-Side Applications","nodes":[{"content":"Performance Counters and In-Process Side-By-Side Applications","pos":[0,61]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[427,488],"content":"Performance Counters and In-Process Side-By-Side Applications","linkify":"Performance Counters and In-Process Side-By-Side Applications","nodes":[{"content":"Performance Counters and In-Process Side-By-Side Applications","pos":[0,61]}]},{"content":"Using the Performance Monitor (Perfmon.exe), it is possible to differentiate the performance counters on a per-runtime basis.","pos":[489,614]},{"content":"This topic describes the registry change needed to enable this functionality.","pos":[615,692]},{"pos":[701,721],"content":"The Default Behavior","linkify":"The Default Behavior","nodes":[{"content":"The Default Behavior","pos":[0,20]}]},{"content":"By default, the Performance Monitor displays performance counters on a per-application basis.","pos":[725,818]},{"content":"However, there are two scenarios in which this is problematic:","pos":[819,881]},{"content":"When you monitor two applications that have the same name.","pos":[891,949]},{"content":"For example, if both applications are named myapp.exe, one will be displayed as <bpt id=\"p1\">**</bpt>myapp<ept id=\"p1\">**</ept> and the other as <bpt id=\"p2\">**</bpt>myapp#1<ept id=\"p2\">**</ept> in the <bpt id=\"p3\">**</bpt>Instance<ept id=\"p3\">**</ept> column.","pos":[950,1096],"source":" For example, if both applications are named myapp.exe, one will be displayed as **myapp** and the other as **myapp#1** in the **Instance** column."},{"content":"In this case, it is difficult to match a performance counter to a particular application.","pos":[1097,1186]},{"content":"It is not clear whether the data collected for <bpt id=\"p1\">**</bpt>myapp#1<ept id=\"p1\">**</ept> refers to the first myapp.exe or the second myapp.exe.","pos":[1187,1300],"source":" It is not clear whether the data collected for **myapp#1** refers to the first myapp.exe or the second myapp.exe."},{"content":"When an application uses multiple instances of the common language runtime.","pos":[1310,1385]},{"content":"The <ph id=\"ph1\">[!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)]</ph> supports in-process side-by-side hosting scenarios; that is, a single process or application can load multiple instances of the common language runtime.","pos":[1386,1605],"source":" The [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)] supports in-process side-by-side hosting scenarios; that is, a single process or application can load multiple instances of the common language runtime."},{"content":"If a single application named myapp.exe loads two runtime instances, by default, they will be designated in the <bpt id=\"p1\">**</bpt>Instance<ept id=\"p1\">**</ept> column as <bpt id=\"p2\">**</bpt>myapp<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>myapp#1<ept id=\"p3\">**</ept>.","pos":[1606,1767],"source":" If a single application named myapp.exe loads two runtime instances, by default, they will be designated in the **Instance** column as **myapp** and **myapp#1**."},{"content":"In this case, it is not clear whether <bpt id=\"p1\">**</bpt>myapp<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>myapp#1<ept id=\"p2\">**</ept> refer to two applications with the same name, or to the same application with two runtimes.","pos":[1768,1923],"source":" In this case, it is not clear whether **myapp** and **myapp#1** refer to two applications with the same name, or to the same application with two runtimes."},{"content":"If multiple applications with the same name load multiple runtimes, the ambiguity is even greater.","pos":[1924,2022]},{"content":"You can set a registry key to eliminate this ambiguity.","pos":[2029,2084]},{"content":"For applications developed using the <ph id=\"ph1\">[!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)]</ph>, this registry change adds a process identifier followed by a runtime instance identifier to the application name in the <bpt id=\"p1\">**</bpt>Instance<ept id=\"p1\">**</ept> column.","pos":[2085,2328],"source":" For applications developed using the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], this registry change adds a process identifier followed by a runtime instance identifier to the application name in the **Instance** column."},{"content":"Instead of <bpt id=\"p1\">*</bpt>application<ept id=\"p1\">*</ept> or <bpt id=\"p2\">*</bpt>application<ept id=\"p2\">*</ept>#1, the application is now identified as <bpt id=\"p3\">*</bpt>application<ept id=\"p3\">*</ept>_<ph id=\"ph1\">`p`</ph><bpt id=\"p4\">*</bpt>processID<ept id=\"p4\">*</ept><ph id=\"ph2\">\\_</ph><ph id=\"ph3\">`r`</ph><bpt id=\"p5\">*</bpt>runtimeID<ept id=\"p5\">*</ept> in the <bpt id=\"p6\">**</bpt>Instance<ept id=\"p6\">**</ept> column.","pos":[2329,2483],"source":" Instead of *application* or *application*#1, the application is now identified as *application*_`p`*processID*\\_`r`*runtimeID* in the **Instance** column."},{"content":"If an application was developed using a previous version of the common language runtime, that instance is represented as <bpt id=\"p1\">*</bpt>application<ph id=\"ph1\">\\_</ph><ept id=\"p1\">*</ept><ph id=\"ph2\">`p`</ph><bpt id=\"p2\">*</bpt>processID<ept id=\"p2\">*</ept> provided that the <ph id=\"ph3\">[!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)]</ph> is installed.","pos":[2484,2731],"source":" If an application was developed using a previous version of the common language runtime, that instance is represented as *application\\_*`p`*processID* provided that the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] is installed."},{"pos":[2740,2801],"content":"Performance Counters for In-Process Side-by-Side Applications","linkify":"Performance Counters for In-Process Side-by-Side Applications","nodes":[{"content":"Performance Counters for In-Process Side-by-Side Applications","pos":[0,61]}]},{"content":"To handle performance counters for multiple common language runtime versions that are hosted in a single application, you must change a single registry key setting, as shown in the following table.","pos":[2805,3002]},{"content":"Key name","pos":[3023,3031]},{"content":"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services<ph id=\"ph1\">\\\\</ph>.NETFramework\\Performance","pos":[3032,3111],"source":"HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\\\.NETFramework\\Performance"},{"content":"Value name","pos":[3116,3126]},{"content":"ProcessNameFormat","pos":[3127,3144]},{"content":"Value type","pos":[3149,3159]},{"content":"REG_DWORD","pos":[3160,3169]},{"content":"Value","pos":[3174,3179]},{"content":"1 (0x00000001)","pos":[3180,3194]},{"content":"A value of 0 for <ph id=\"ph1\">`ProcessNameFormat`</ph> indicates that the default behavior is enabled; that is, Perfmon.exe displays performance counters on a per-application basis.","pos":[3202,3365],"source":"A value of 0 for `ProcessNameFormat` indicates that the default behavior is enabled; that is, Perfmon.exe displays performance counters on a per-application basis."},{"content":"When you set this value to 1, Perfmon.exe disambiguates multiple versions of an application and provides performance counters on a per-runtime basis.","pos":[3366,3515]},{"content":"Any other value for the <ph id=\"ph1\">`ProcessNameFormat`</ph> registry key setting is unsupported and reserved for future use.","pos":[3516,3624],"source":" Any other value for the `ProcessNameFormat` registry key setting is unsupported and reserved for future use."},{"pos":[3631,3826],"content":"After you update the <ph id=\"ph1\">`ProcessNameFormat`</ph> registry key setting, you must restart Perfmon.exe or any other consumers of performance counters so that the new instance naming feature works correctly.","source":"After you update the `ProcessNameFormat` registry key setting, you must restart Perfmon.exe or any other consumers of performance counters so that the new instance naming feature works correctly."},{"pos":[3833,3922],"content":"The following example shows how to change the <ph id=\"ph1\">`ProcessNameFormat`</ph> value programmatically.","source":"The following example shows how to change the `ProcessNameFormat` value programmatically."},{"content":"When you make this registry change, Perfmon.exe displays the names of applications that target the <ph id=\"ph1\">[!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)]</ph> as <bpt id=\"p1\">*</bpt>application<ept id=\"p1\">*</ept>_<ph id=\"ph2\">`p`</ph><bpt id=\"p2\">*</bpt>processID<ept id=\"p2\">*</ept><ph id=\"ph3\">\\_</ph><ph id=\"ph4\">`r`</ph><bpt id=\"p3\">*</bpt>runtimeID<ept id=\"p3\">*</ept>, where <bpt id=\"p4\">*</bpt>application<ept id=\"p4\">*</ept> is the name of the application, <bpt id=\"p5\">*</bpt>processID<ept id=\"p5\">*</ept> is the application's process identifier, and <bpt id=\"p6\">*</bpt>runtimeID<ept id=\"p6\">*</ept> is a common language runtime identifier.","pos":[4245,4619],"source":"When you make this registry change, Perfmon.exe displays the names of applications that target the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] as *application*_`p`*processID*\\_`r`*runtimeID*, where *application* is the name of the application, *processID* is the application's process identifier, and *runtimeID* is a common language runtime identifier."},{"content":"For example, if an application named myapp.exe loads two instances of the common language runtime, Perfmon.exe may identify one instance as myapp_p1416_r10 and the second as myapp_p3160_r10.","pos":[4620,4810]},{"content":"The runtime identifier only disambiguates the runtimes within a process; it does not provide any other information about the runtime.","pos":[4811,4944]},{"content":"(For example, the runtime ID has no relation to the version or the SKU of the runtime.)","pos":[4945,5032]},{"content":"If the <ph id=\"ph1\">[!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)]</ph> is installed, the registry change also affects applications that were developed using earlier versions of the .NET Framework.","pos":[5039,5236],"source":"If the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] is installed, the registry change also affects applications that were developed using earlier versions of the .NET Framework."},{"content":"These appear in Perfmon.exe as <bpt id=\"p1\">*</bpt>application_<ept id=\"p1\">*</ept><ph id=\"ph1\">`p`</ph><bpt id=\"p2\">*</bpt>processID<ept id=\"p2\">*</ept>, where <bpt id=\"p3\">*</bpt>application<ept id=\"p3\">*</ept> is the application name and <bpt id=\"p4\">*</bpt>processID<ept id=\"p4\">*</ept> is the process identifier.","pos":[5237,5384],"source":" These appear in Perfmon.exe as *application_*`p`*processID*, where *application* is the application name and *processID* is the process identifier."},{"content":"For example, if the performance counters of two applications named myapp.exe are monitored, one might appear as myapp_p23900 and the other as myapp_p24908.","pos":[5385,5540]},{"pos":[5548,5853],"content":"[!NOTE]\n The process identifier eliminates the ambiguity of resolving two applications with the same name that use earlier versions of the runtime. A runtime identifier is not required for previous versions, because previous versions of the common language runtime do not support side-by-side scenarios.","leadings":["","> "],"nodes":[{"content":"The process identifier eliminates the ambiguity of resolving two applications with the same name that use earlier versions of the runtime. A runtime identifier is not required for previous versions, because previous versions of the common language runtime do not support side-by-side scenarios.","pos":[9,303],"nodes":[{"content":"The process identifier eliminates the ambiguity of resolving two applications with the same name that use earlier versions of the runtime.","pos":[0,138]},{"content":"A runtime identifier is not required for previous versions, because previous versions of the common language runtime do not support side-by-side scenarios.","pos":[139,294]}]}]},{"content":"If the <ph id=\"ph1\">[!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)]</ph> is not present or was uninstalled, setting the registry key has no effect.","pos":[5860,6006],"source":"If the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] is not present or was uninstalled, setting the registry key has no effect."},{"content":"This means that two applications with the same name will continue to appear in Perfmon.exe as <bpt id=\"p1\">*</bpt>application<ept id=\"p1\">*</ept> and <bpt id=\"p2\">*</bpt>application#1<ept id=\"p2\">*</ept> (for example, as <bpt id=\"p3\">**</bpt>myapp<ept id=\"p3\">**</ept> and <bpt id=\"p4\">**</bpt>myapp#1<ept id=\"p4\">**</ept>).","pos":[6007,6179],"source":" This means that two applications with the same name will continue to appear in Perfmon.exe as *application* and *application#1* (for example, as **myapp** and **myapp#1**)."}]}