{"content":"---\ntitle: \"Walkthrough: Using Client Application Services | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"application services host [client application services]\"\n  - \"client application services, walkthroughs\"\nms.assetid: bb7c8950-4517-4dae-b705-b74a14059b26\ncaps.latest.revision: 47\nauthor: dotnet-bot\nms.author: dotnetcontent\nmanager: \"wpickett\"\n---\n# Walkthrough: Using Client Application Services\nThis topic describes how to create a Windows application that uses client application services to authenticate users and retrieve user roles and settings.  \n  \n In this walkthrough, you perform the following tasks:  \n  \n-   Create a Windows Forms application and use the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] project designer to enable and configure client application services.  \n  \n-   Create a simple ASP.NET Web Service application to host the application services and test your client configuration.  \n  \n-   Add forms authentication to your application. You will start by using a hard-coded user name and password to test the service. You will then add a login form by specifying it as a credentials provider in your application configuration.  \n  \n-   Add role-based functionality, enabling and displaying a button only for users in the \"manager\" role.  \n  \n-   Access Web settings. You will start by loading Web settings for an authenticated (test) user on the **Settings** page of the project designer. You will then use the Windows Forms Designer to bind a text box to a Web setting. Finally, you will save the modified value back to the server.  \n  \n-   Implement logout. You will add a logout option to the form and call a logout method.  \n  \n-   Enable offline mode. You will provide a check box so that users can specify their connection status. You will then use this value to specify whether the client application service providers will use locally cached data instead of accessing their Web services. Finally, you will re-authenticate the current user when the application returns to online mode.  \n  \n## Prerequisites  \n You need the following component to complete this walkthrough:  \n  \n-   [!INCLUDE[vs_orcas_long](../../../includes/vs-orcas-long-md.md)].  \n  \n## Creating the Client Application  \n The first thing that you will do is create a Windows Forms project. This walkthrough uses Windows Forms because more people are familiar with it, but the process is similar for Windows Presentation Foundation (WPF) projects.  \n  \n#### To create a client application and enable client application services  \n  \n1.  In [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], select the **File &#124; New &#124; Project** menu option.  \n  \n2.  In the **New Project** dialog box, in the **Project types** pane, expand the **Visual Basic** or **Visual C#** node and select the **Windows** project type.  \n  \n3.  Make sure that **.NET Framework 3.5** is selected, and then select the **Windows Forms Application** template.  \n  \n4.  Change the project **Name** to `ClientAppServicesDemo`, and then click **OK**.  \n  \n     A new Windows Forms project is opened in [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].  \n  \n5.  On the **Project** menu, select **ClientAppServicesDemo Properties**.  \n  \n     The project designer appears.  \n  \n6.  On the **Services** tab, select **Enable client application services**.  \n  \n7.  Make sure that **Use Forms authentication** is selected, and then set **Authentication service location**, **Roles service location**, and **Web settings service location** to `http://localhost:55555/AppServices`.  \n  \n8.  For [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)], on the **Application** tab, set **Authentication mode** to **Application-defined**.  \n  \n The designer stores the specified settings in the application's app.config file.  \n  \n At this point, the application is configured to access all three services from the same host. In the next section, you will create the host as a simple Web service application, enabling you to test your client configuration.  \n  \n## Creating the Application Services Host  \n In this section, you will create a simple Web service application that accesses user data from a local SQL Server Compact database file. Then, you will populate the database using the [ASP.NET Web Site Administration Tool](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec). This simple configuration enables you to quickly test your client application. As an alternative, you can configure the Web service host to access user data from a full SQL Server database or through custom <xref:System.Web.Security.MembershipProvider> and <xref:System.Web.Security.RoleProvider> classes. For more information, see [Creating and Configuring the Application Services Database for SQL Server](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2).  \n  \n In the following procedure, you create and configure the AppServices Web service.  \n  \n#### To create and configure the application services host  \n  \n1.  In **Solution Explorer**, select the ClientAppServicesDemo solution, and then on the **File** menu, select **Add &#124; New Project**.  \n  \n2.  In the **Add New Project** dialog box, in the **Project types** pane, expand the **Visual Basic** or **Visual C#** node and select the **Web** project type.  \n  \n3.  Make sure that **.NET Framework 3.5** is selected, and then select the **ASP.NET Web Service Application** template.  \n  \n4.  Change the project **Name** to `AppServices` and then click **OK**.  \n  \n     A new ASP.NET Web service application project is added to the solution, and the Service1.asmx.vb or Service1.asmx.cs file appears in the editor.  \n  \n    > [!NOTE]\n    >  The Service1.asmx.vb or Service1.asmx.cs file is not used in this example. If you want to keep your work environment uncluttered, you can close it and delete it from **Solution Explorer**.  \n  \n5.  In **Solution Explorer**, select the AppServices project, and then on the **Project** menu, select **AppServices Properties**.  \n  \n     The project designer appears.  \n  \n6.  On the **Web** tab, make sure that **Use Visual Studio Development Server** is selected.  \n  \n7.  Select **Specific port**, specify a value of `55555`, and then set **Virtual path** to `/AppServices`.  \n  \n8.  Save all files.  \n  \n9. In **Solution Explorer**, open Web.config and find the `<system.web>` opening tag.  \n  \n10. Add the following markup before the `<system.web>` tag.  \n  \n     The `authenticationService`, `profileService`, and `roleService` elements in this markup enable and configure the application services. For testing purposes, the `requireSSL` attribute of the `authenticationService` element is set to \"false\". The `readAccessProperties` and `writeAccessProperties` attributes of the `profileService` element indicate that the `WebSettingsTestText` property is read/write.  \n  \n    > [!NOTE]\n    >  In production code, you should always access the authentication service over the secure sockets layer (SSL, by using the HTTPS protocol). For information about how to set up SSL, see [Configuring Secure Sockets Layer (IIS 6.0 Operations Guide)](http://go.microsoft.com/fwlink/?LinkId=91844).  \n  \n    ```  \n    <system.web.extensions>  \n      <scripting>  \n        <webServices>  \n          <authenticationService enabled=\"true\" requireSSL = \"false\"/>  \n          <profileService enabled=\"true\"  \n            readAccessProperties=\"WebSettingsTestText\"  \n            writeAccessProperties=\"WebSettingsTestText\" />  \n          <roleService enabled=\"true\"/>  \n        </webServices>  \n      </scripting>  \n    </system.web.extensions>  \n    ```  \n  \n11. Add the following markup after the `<system.web>` opening tag so that it is within the `<system.web>` element.  \n  \n     The `profile` element configures a single Web setting named `WebSettingsTestText`.  \n  \n    ```  \n    <profile enabled=\"true\" >  \n      <properties>  \n        <add name=\"WebSettingsTestText\" type=\"string\"   \n          readOnly=\"false\" defaultValue=\"DefaultText\"   \n          serializeAs=\"String\" allowAnonymous=\"false\" />  \n      </properties>  \n    </profile>  \n  \n    ```  \n  \n In the following procedure, you use the ASP.NET Web Site Administration tool to complete the service configuration and populate the local database file. You will add two users named `employee` and `manager` belonging to two roles with the same names. The user passwords are `employee!` and `manager!` respectively.  \n  \n#### To configure membership and roles  \n  \n1.  In **Solution Explorer**, select the AppServices project, and then on the **Project** menu, select **ASP.NET Configuration**.  \n  \n     The **ASP.NET Web Site Administration Tool** appears.  \n  \n2.  On the **Security** tab, click **Use the security Setup Wizard to configure security step by step**.  \n  \n     The **Security Setup Wizard** appears and displays the **Welcome** step.  \n  \n3.  Click **Next**.  \n  \n     The **Select Access Method** step appears.  \n  \n4.  Select **From the internet**. This configures the service to use Forms authentication instead of Windows authentication.  \n  \n5.  Click **Next** twice.  \n  \n     The **Define Roles** step appears.  \n  \n6.  Select **Enable roles for this Web site**.  \n  \n7.  Click **Next**. The **Create New Role** form appears.  \n  \n8.  In the **New Role Name** text box, type `manager` and then click **Add Role**.  \n  \n     The **Existing Roles** table appears with the specified value.  \n  \n9. In the **New Role Name** text box, replace `manager` with `employee` and then click **Add Role**.  \n  \n     The new value appears in the **Existing Roles** table.  \n  \n10. Click **Next**.  \n  \n     The **Add New Users** step appears.  \n  \n11. In the **Create User** form, specify the following values.  \n  \n    |||  \n    |-|-|  \n    |**User Name**|`manager`|  \n    |**Password**|`manager!`|  \n    |**Confirm Password**|`manager!`|  \n    |**E-mail**|`manager@contoso.com`|  \n    |**Security Question**|`manager`|  \n    |**Security Answer**|`manager`|  \n  \n12. Click **Create User**.  \n  \n     A success message appears.  \n  \n    > [!NOTE]\n    >  The **E-mail**, **Security Question**, and **Security Answer** values are required by the form, but are not used in this example.  \n  \n13. Click **Continue**.  \n  \n     The **Create User** form reappears.  \n  \n14. In the **Create User** form, specify the following values.  \n  \n    |||  \n    |-|-|  \n    |**User Name**|`employee`|  \n    |**Password**|`employee!`|  \n    |**Confirm Password**|`employee!`|  \n    |**E-mail**|`employee@contoso.com`|  \n    |**Security Question**|`Employee`|  \n    |**Security Answer**|`employee`|  \n  \n15. Click **Create User**.  \n  \n     A success message appears.  \n  \n16. Click **Finish**.  \n  \n     The **Web Site Administration Tool** reappears.  \n  \n17. Click **Manager users**.  \n  \n     The list of users appears.  \n  \n18. Click **Edit roles** for the **employee** user, and then select the **employee** role.  \n  \n19. Click **Edit roles** for the **manager** user, and then select the **manager** role.  \n  \n20. Close the browser window that hosts the **Web Site Administration Tool**.  \n  \n21. If a message box appears asking if you want to reload the modified Web.config file, click **Yes**.  \n  \n This completes the Web service setup. At this point, you can press F5 to run the client application, and the **ASP.NET Development Server** will start automatically along with your client application. The server will continue to run after you exit the application, but will restart when you restart the application. This allows it to detect any changes you have made to Web.config.  \n  \n To stop the server manually, right-click the ASP.NET Development Server icon in the notification area of the taskbar and then click **Stop**. This is useful occasionally to make sure that a clean restart occurs.  \n  \n## Adding Forms Authentication  \n In the following procedure, you add code to the main form that attempts to validate the user, and denies access when the user supplies invalid credentials. You use a hard-coded user name and password to test the service.  \n  \n#### To validate the user in your application code  \n  \n1.  In **Solution Explorer**, in the ClientAppServicesDemo project, add a reference to the System.Web assembly.  \n  \n2.  Select the Form1 file and then select **View &#124; Code** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.  \n  \n3.  In the code editor, add the following statements to the top of the Form1 file.  \n  \n     [!code-csharp[ClientApplicationServices#001](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#001)]\n     [!code-vb[ClientApplicationServices#001](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#001)]  \n  \n4.  In **Solution Explorer**, double-click Form1 to display the designer.  \n  \n5.  In the designer, double-click the form surface to generate a <xref:System.Windows.Forms.Form.Load?displayProperty=fullName> event handler named `Form1_Load`.  \n  \n     The code editor appears with the cursor in the `Form1_Load` method.  \n  \n6.  Add the following code to the `Form1_Load` method.  \n  \n     This code denies access to unauthenticated users by exiting the application. Alternatively, you could allow unauthenticated users access to the form, but deny access to specific functionality. Normally, you will not hard-code the user name and password like this, but it is useful for testing purposes. In the next section, you will replace this code with more robust code that displays a login dialog box and includes exception handling.  \n  \n     Note that the `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName> method is in the [!INCLUDE[dnprdnext](../../../includes/dnprdnext-md.md)]. This method delegates its work to the configured authentication provider, and returns `true` if authentication is successful. Your application does not require a direct reference to the client authentication provider.  \n  \n     [!code-csharp[ClientApplicationServices#300](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#300)]\n     [!code-vb[ClientApplicationServices#300](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#300)]  \n  \n You can now press F5 to run the application, and because you provide a correct user name and password, you will see the form.  \n  \n> [!NOTE]\n>  If you are unable to run the application, try stopping the ASP.NET Development Server. When the server restarts, verify that the port is set to 55555.  \n  \n To see the error message instead, change the <xref:System.Web.Security.Membership.ValidateUser%2A> parameters. For example, replace the second `\"manager!\"` parameter with an incorrect password like `\"MANAGER\"`.  \n  \n## Adding a Login Form as a Credentials Provider  \n You can acquire the user credentials in your application code and pass them to the <xref:System.Web.Security.Membership.ValidateUser%2A> method. However, it is often useful to keep your credentials-acquiring code separate from your application code, in case you want to change it later.  \n  \n In the following procedure, you configure your application to use a credentials provider, and then change your <xref:System.Web.Security.Membership.ValidateUser%2A> method call to pass <xref:System.String.Empty> for both parameters. The empty strings signal the <xref:System.Web.Security.Membership.ValidateUser%2A> method to call the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> method of the configured credentials provider.  \n  \n#### To configure your application to use a credentials provider  \n  \n1.  In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **ClientAppServicesDemo Properties**.  \n  \n     The project designer appears.  \n  \n2.  On the **Services** tab, set **Optional: Credential provider** to the following value. This value indicates the assembly-qualified type name.  \n  \n    ```  \n    ClientAppServicesDemo.Login, ClientAppServicesDemo  \n    ```  \n  \n3.  In the Form1 code file, replace the code in the `Form1_Load` method with the following code.  \n  \n     This code displays a welcome message and then calls the `ValidateUsingCredentialsProvider` method that you will add in the next step. If the user is not authenticated, the `ValidateUsingCredentialsProvider` method returns `false` and the `Form1_Load` method returns. This prevents any additional code from running before the application exits. The welcome message is useful to make it clear when the application restarts. You will add code to restart the application when you implement logout later in this walkthrough.  \n  \n     [!code-csharp[ClientApplicationServices#011](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#011)]\n     [!code-vb[ClientApplicationServices#011](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#011)]  \n  \n4.  Add the following method after the `Form1_Load` method.  \n  \n     This method passes empty strings to the `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName> method, which causes the Login dialog box to appear. If the authentication service is unavailable, the <xref:System.Web.Security.Membership.ValidateUser%2A> method will throw a <xref:System.Net.WebException>. In this case, the `ValidateUsingCredentialsProvider` method displays a warning message and asks if the user wants to try again in offline mode. This functionality requires the **Save password hash locally to enable offline login** feature described in [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md). This feature is enabled by default for new projects.  \n  \n     If the user is not validated, the `ValidateUsingCredentialsProvider` method displays an error message and exits the application. Finally, this method returns the result of the authentication attempt.  \n  \n     [!code-csharp[ClientApplicationServices#020](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#020)]\n     [!code-vb[ClientApplicationServices#020](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#020)]  \n  \n### Creating a Login Form  \n A credentials provider is a class that implements the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> interface. This interface has a single method named <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> that returns a <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationCredentials> object. The following procedures describe how to create a login dialog box that implements <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> to display itself and return the user-specified credentials.  \n  \n Separate procedures are provided for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] and C# because [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] provides a **Login Form** template. This saves some time and coding effort.  \n  \n##### To create a login dialog box as a credentials provider in Visual Basic  \n  \n1.  In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **Add New Item**.  \n  \n2.  In the **Add New Item** dialog box, select the **Login Form** template, change the item **Name** to `Login.vb`, and then click **Add**.  \n  \n     The login dialog box appears in the Windows Forms Designer.  \n  \n3.  In the designer, select the **OK** button and then, in the **Properties** window, set `DialogResult` to `OK`.  \n  \n4.  In the designer, add a `CheckBox` control to the form under the **Password** text box.  \n  \n5.  In the **Properties** window, specify a **(Name)** value of `rememberMeCheckBox` and a **Text** value of `&Remember me`.  \n  \n6.  Select **View &#124; Code** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.  \n  \n7.  In the code editor, add the following code to the top of the file.  \n  \n     [!code-vb[ClientApplicationServices#101](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Login.vb#101)]  \n  \n8.  Modify the class signature so that the class implements the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> interface.  \n  \n     [!code-vb[ClientApplicationServices#110](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#110)]  \n  \n9. Make sure that the cursor is after `IClientformsAuthenticationCredentialsProvider`, and then press ENTER to generate the `GetCredentials` method.  \n  \n10. Locate the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> implementation and then replace it with the following code.  \n  \n     [!code-vb[ClientApplicationServices#120](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Login.vb#120)]  \n  \n The following C# procedure provides the entire code listing for a simple login dialog box. The layout for this dialog box is a bit crude, but the important part is the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> implementation.  \n  \n##### To create a login dialog box as a credentials provider in C#  \n  \n1.  In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **Add Class**.  \n  \n2.  In the **Add New Item** dialog box, change the **Name** to `Login.cs`, and then click **Add**.  \n  \n     The Login.cs file opens in the code editor.  \n  \n3.  Replace the default code with the following code.  \n  \n     [!code-csharp[ClientApplicationServices#200](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Login.cs#200)]  \n  \n You can now run the application and see the login dialog box appear. To test this code, try different credentials, both valid and invalid, and confirm that you can access the form only with valid credentials. Valid user names are `employee` and `manager` with passwords `employee!` and `manager!` respectively.  \n  \n> [!NOTE]\n>  Do not select **Remember me** at this point or you will not be able to login as another user until you implement logout later in this walkthrough.  \n  \n## Adding Role-Based Functionality  \n In the following procedure, you add a button to the form and display it only for users in the manager role.  \n  \n#### To change the user interface based on user role  \n  \n1.  In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.  \n  \n2.  In the designer, add a <xref:System.Windows.Forms.Button> control to the form from the **ToolBox**.  \n  \n3.  In the **Properties** window, set the following properties for the button.  \n  \n    |Property|Value|  \n    |--------------|-----------|  \n    |**(Name)**|managerOnlyButton|  \n    |**Text**|&Manager task|  \n    |**Visible**|`False`|  \n  \n4.  In the code editor for Form1, add the following code to the end of the `Form1_Load` method.  \n  \n     This code calls the `DisplayButtonForManagerRole` method that you will add in the next step.  \n  \n     [!code-csharp[ClientApplicationServices#012](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#012)]\n     [!code-vb[ClientApplicationServices#012](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#012)]  \n  \n5.  Add the following method to the end of the Form1 class.  \n  \n     This method calls the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method of the <xref:System.Security.Principal.IPrincipal> returned by the `static` <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName> property. For applications configured to use client application services, this property returns a <xref:System.Web.ClientServices.ClientRolePrincipal>. Because this class implements the <xref:System.Security.Principal.IPrincipal> interface, you do not need to reference it explicitly.  \n  \n     If the user is in the \"manager\" role, the `DisplayButtonForManagerRole` method sets the <xref:System.Windows.Forms.Control.Visible%2A> property of the `managerOnlyButton` to `true`. This method also displays an error message if a <xref:System.Net.WebException> is thrown, which indicates that the roles service is unavailable.  \n  \n    > [!NOTE]\n    >  The <xref:System.Web.ClientServices.ClientRolePrincipal.IsInRole%2A> method will always return `false` if the user login has expired. This will not occur if your application calls the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method one time shortly after authentication, as shown in the example code for this walkthrough. If your application must retrieve user roles at other times, you might want to add code to revalidate users whose login has expired. If all valid users are assigned to roles, you can determine whether the login has expired by calling the <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A?displayProperty=fullName> method. If no roles are returned, the login has expired. For an example of this functionality, see the <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A> method. This functionality is only necessary if you have selected **Require users to log on again whenever the server cookie expires** in your application configuration. For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).  \n  \n     [!code-csharp[ClientApplicationServices#030](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#030)]\n     [!code-vb[ClientApplicationServices#030](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#030)]  \n  \n If authentication is successful, the client authentication provider sets the <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName> property to an instance of the <xref:System.Web.ClientServices.ClientRolePrincipal> class. This class implements the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method so that the work is delegated to the configured role provider. As before, your application code does not require a direct reference to the service provider.  \n  \n You can now run the application and log in as employee to see that the button does not appear, and then log in as manager to see the button.  \n  \n## Accessing Web Settings  \n In the following procedure, you add a text box to the form and bind it to a Web setting. Like the previous code that uses authentication and roles, your settings code does not access the settings provider directly. Instead, it uses the strongly-typed `Settings` class (accessed as `Properties.Settings.Default` in C# and `My.Settings` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) generated for your project by [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].  \n  \n#### To use Web settings in your user interface  \n  \n1.  Make sure that the **ASP.NET Web Development Server** is still running by checking the notification area of the taskbar. If you have stopped the server, restart the application (which starts the server automatically) then close the login dialog box.  \n  \n2.  In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **ClientAppServicesDemo Properties**.  \n  \n     The project designer appears.  \n  \n3.  On the **Settings** tab, click **Load Web Settings**.  \n  \n     A **Login** dialog box appears.  \n  \n4.  Enter credentials for employee or manager and click **Log In**. The Web setting you will use is configured for access by authenticated users only, so clicking **Skip Login** will not load any settings.  \n  \n     The `WebSettingsTestText` setting appears in the designer with the default value of `DefaultText`. Additionally, a `Settings` class that contains a `WebSettingsTestText` property is generated for your project.  \n  \n5.  In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.  \n  \n6.  In the designer, add a <xref:System.Windows.Forms.TextBox> control to the form.  \n  \n7.  In the **Properties** window, specify a **(Name)** value of `webSettingsTestTextBox`.  \n  \n8.  In the code editor, add the following code to the end of the `Form1_Load` method.  \n  \n     This code calls the `BindWebSettingsTestTextBox` method that you will add in the next step.  \n  \n     [!code-csharp[ClientApplicationServices#013](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#013)]\n     [!code-vb[ClientApplicationServices#013](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#013)]  \n  \n9. Add the following method to the end of the Form1 class.  \n  \n     This method binds the <xref:System.Windows.Forms.TextBox.Text%2A> property of the `webSettingsTestTextBox` to the `WebSettingsTestText` property of the `Settings` class generated earlier in this procedure. This method also displays an error message if a <xref:System.Net.WebException> is thrown, which indicates that the Web settings service is unavailable.  \n  \n     [!code-csharp[ClientApplicationServices#040](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#040)]\n     [!code-vb[ClientApplicationServices#040](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#040)]  \n  \n    > [!NOTE]\n    >  You will typically use data binding to enable automatic two-way communication between a control and a Web setting. However, you can also access Web settings directly as shown in the following example:  \n  \n     [!code-csharp[ClientApplicationServices#322](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#322)]\n     [!code-vb[ClientApplicationServices#322](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#322)]  \n  \n10. In the designer, select the form, and then, in the **Properties** window, click the **Events** button.  \n  \n11. Select the <xref:System.Windows.Forms.Form.FormClosing> event and then press ENTER to generate an event handler.  \n  \n12. Replace the generated method with the following code.  \n  \n     The <xref:System.Windows.Forms.Form.FormClosing> event handler calls the `SaveSettings` method, which is also used by the logout functionality that you will add in the next section. The `SaveSettings` method first confirms that the user has not logged out. It does this by checking the <xref:System.Security.Principal.IIdentity.AuthenticationType%2A> property of the <xref:System.Security.Principal.IIdentity> returned by the current principal. The current principal is retrieved through the `static` <xref:System.Threading.Thread.CurrentPrincipal%2A> property. If the user has been authenticated for client application services, the authentication type will be \"ClientForms\". The `SaveSettings` method cannot just check the <xref:System.Security.Principal.IIdentity.IsAuthenticated%2A?displayProperty=fullName> property because the user might have a valid Windows identity after logout.  \n  \n     If the user has not logged out, the `SaveSettings` method calls the <xref:System.Configuration.ApplicationSettingsBase.Save%2A> method of the `Settings` class generated earlier in this procedure. This method can throw a <xref:System.Net.WebException> if the authentication cookie has expired. This occurs only if you have selected **Require users to log on again whenever the server cookie expires** in your application configuration. For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md). The `SaveSettings` method handles cookie expiration by calling <xref:System.Web.Security.Membership.ValidateUser%2A> to display the login dialog box. If the user logs in successfully, the `SaveSettings` method tries to save the settings again by calling itself.  \n  \n     Like in previous code, the `SaveSettings` method displays an error message if the remote service is unavailable. If the settings provider cannot access the remote service, the settings are still saved to the local cache and reloaded when the application restarts.  \n  \n     [!code-csharp[ClientApplicationServices#050](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#050)]\n     [!code-vb[ClientApplicationServices#050](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#050)]  \n  \n13. Add the following method to the end of the Form1 class.  \n  \n     This code handles the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved?displayProperty=fullName> event and displays a warning if any of the settings could not be saved. The <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event does not occur if the settings service is unavailable or if the authentication cookie has expired. One example of when the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event will occur is if the user has already logged out. You can test this event handler by adding logout code to the `SaveSettings` method directly before the <xref:System.Configuration.ApplicationSettingsBase.Save%2A> method call. Logout code that you can use is described in the next section.  \n  \n     [!code-csharp[ClientApplicationServices#090](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#090)]\n     [!code-vb[ClientApplicationServices#090](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#090)]  \n  \n14. For C#, add the following code to the end of the `Form1_Load` method. This code associates the method you added in the last step with the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event.  \n  \n     [!code-csharp[ClientApplicationServices#015](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#015)]  \n  \n To test the application at this point, run it multiple times as both employee and manager, and type different values into the text box. The values will persist across sessions on a per-user basis.  \n  \n## Implementing Logout  \n When the user selects the **Remember me** check box when logging in, the application will automatically authenticate the user on subsequent runs. Automatic authentication will then continue while the application is in offline mode or until the authentication cookie expires. Sometimes, however, multiple users will need access to the application or a single user might occasionally log in with different credentials. To enable this scenario, you must implement logout functionality, as described in the following procedure.  \n  \n#### To implement logout functionality  \n  \n1.  In the Form1 designer, add a <xref:System.Windows.Forms.Button> control to the form from the **ToolBox**.  \n  \n2.  In the **Properties** window, specify a **(Name)** value of `logoutButton` and a **Text** value of **&Log Out**.  \n  \n3.  Double-click the `logoutButton` to generate a <xref:System.Windows.Forms.Control.Click> event handler.  \n  \n     The code editor appears with the cursor in the `logoutButton_Click` method.  \n  \n4.  Replace the generated `logoutButton_Click` method with the following code.  \n  \n     This event handler first calls the `SaveSettings` method that you added in the previous section. Then, the event handler calls the <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A?displayProperty=fullName> method. If the authentication service is unavailable, the <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A> method will throw a <xref:System.Net.WebException>. In this case, the `logoutButton_Click` method displays a warning message and switches temporarily to offline mode to log the user out. Offline mode is described in the next section.  \n  \n     Logout deletes the local authentication cookie so that login will be required when the application is restarted. After logout, the event handler restarts the application. When the application restarts, it displays the welcome message followed by the login dialog box. The welcome message makes it clear that the application has restarted. This prevents potential confusion if the user must log in to save settings, and then must log in again because the application has restarted.  \n  \n     [!code-csharp[ClientApplicationServices#070](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#070)]\n     [!code-vb[ClientApplicationServices#070](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#070)]  \n  \n To test the logout functionality, run the application and select **Remember me** on the Login dialog box. Next, close and restart the application to confirm that you no longer have to log in. Finally, restart the application by clicking Log out.  \n  \n## Enabling Offline Mode  \n In the following procedure, you add a check box to the form to enable the user to enter offline mode. Your application indicates offline mode by setting the `static` <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A?displayProperty=fullName> property to `true`. The offline status is stored on the local hard disk at the location indicated by the <xref:System.Windows.Forms.Application.UserAppDataPath%2A?displayProperty=fullName> property. This means that the offline status is stored on a per-user, per-application basis.  \n  \n In offline mode, all client application service requests retrieve data from the local cache instead of trying to access the services. In the default configuration, the local data includes an encrypted form of the user's password. This enables the user to log in while the application is in offline mode. For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).  \n  \n#### To enable offline mode in your application  \n  \n1.  In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.  \n  \n2.  In the designer, add a <xref:System.Windows.Forms.CheckBox> control to the form.  \n  \n3.  In the **Properties** window, specify a **(Name)** value of `workOfflineCheckBox` and a **Text** value of **&Work offline**.  \n  \n4.  In the **Properties** window, click the **Events** button.  \n  \n5.  Select the <xref:System.Windows.Forms.CheckBox.CheckedChanged> event and then press ENTER to generate an event handler.  \n  \n6.  Replace the generated method with the following code.  \n  \n     This code updates the <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A> value and silently revalidates the user when they return to online mode. The <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A?displayProperty=fullName> method uses the cached credentials so that the user does not have to explicitly log in. If the authentication service is unavailable, a warning message appears and the application stays offline.  \n  \n    > [!NOTE]\n    >  The <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A> method is for convenience only. Because it does not have a return value, it cannot indicate whether revalidation has failed. Revalidation can fail, for example, if the user credentials have changed on the server. In this case, you might want to include code that explicitly validates users after a service call fails. For more information, see the Accessing Web Settings section earlier in this walkthrough.  \n  \n     After revalidation, this code saves any changes to the local Web settings by calling the `SaveSettings` method that you added previously. It then retrieves any new values on the server by calling the <xref:System.Configuration.ApplicationSettingsBase.Reload%2A> method of the project's `Settings` class (accessed as `Properties.Settings.Default` in C# and `My.Settings` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]).  \n  \n     [!code-csharp[ClientApplicationServices#080](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#080)]\n     [!code-vb[ClientApplicationServices#080](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#080)]  \n  \n7.  Add the following code to the end of the `Form1_Load` method to make sure that the check box displays the current connection state.  \n  \n     [!code-csharp[ClientApplicationServices#014](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#014)]\n     [!code-vb[ClientApplicationServices#014](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#014)]  \n  \n This completes the example application. To test the offline capability, run the application, log in as either employee or manager, and then select **Work offline**. Modify the value in the text box, and then close the application. Restart the application. Before you log in, right-click the ASP.NET Development Server icon in the notification area of the taskbar and then click **Stop**. Then, log in like normal. Even when the server is not running, you can still log in. Modify the text box value, exit, and restart to see the modified value.  \n  \n## Summary  \n In this walkthrough, you learned how to enable and use client application services in a Windows Forms application. After setting up a test server, you added code to your application to authenticate users and retrieve user roles and application settings from the server. You also learned how to enable offline mode so that your application uses a local data cache instead of the remote services when connectivity is not available.  \n  \n## Next Steps  \n In a real-world application, you will access data for many users from a remote server that may not always be available, or may go down without notice. To make your application robust, you must respond appropriately to situations where the service is not available. This walkthrough includes try/catch blocks to catch a <xref:System.Net.WebException> and display an error message when the service is not available. In production code, you might want to handle this case by switching to offline mode, exiting the application, or denying access to specific functionality.  \n  \n To increase the security of your application, make sure to thoroughly test the application and server before deployment.  \n  \n## See Also  \n [Client Application Services](../../../docs/framework/common-client-technologies/client-application-services.md)   \n [Client Application Services Overview](../../../docs/framework/common-client-technologies/client-application-services-overview.md)   \n [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md)   \n [ASP.NET Web Site Administration Tool](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec)   \n [Creating and Configuring the Application Services Database for SQL Server](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2)   \n [Walkthrough: Using ASP.NET Application Services](http://msdn.microsoft.com/library/f3f394f0-20d6-4361-aa8f-4b21bf4933eb)","nodes":[{"pos":[4,508],"embed":true,"restype":"x-metadata","content":"title: \"Walkthrough: Using Client Application Services | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"application services host [client application services]\"\n  - \"client application services, walkthroughs\"\nms.assetid: bb7c8950-4517-4dae-b705-b74a14059b26\ncaps.latest.revision: 47\nauthor: dotnet-bot\nms.author: dotnetcontent\nmanager: \"wpickett\"","nodes":[{"content":"Walkthrough: Using Client Application Services | Microsoft Docs","nodes":[{"pos":[0,63],"content":"Walkthrough: Using Client Application Services | Microsoft Docs","nodes":[{"content":"Walkthrough: Using Client Application Services | Microsoft Docs","pos":[0,63]}]}],"path":["title"]}],"yml":true},{"pos":[515,561],"content":"Walkthrough: Using Client Application Services","linkify":"Walkthrough: Using Client Application Services","nodes":[{"content":"Walkthrough: Using Client Application Services","pos":[0,46]}]},{"content":"This topic describes how to create a Windows application that uses client application services to authenticate users and retrieve user roles and settings.","pos":[562,716]},{"content":"In this walkthrough, you perform the following tasks:","pos":[723,776]},{"pos":[786,953],"content":"Create a Windows Forms application and use the <ph id=\"ph1\">[!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]</ph> project designer to enable and configure client application services.","source":"Create a Windows Forms application and use the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] project designer to enable and configure client application services."},{"content":"Create a simple ASP.NET Web Service application to host the application services and test your client configuration.","pos":[963,1079]},{"content":"Add forms authentication to your application.","pos":[1089,1134]},{"content":"You will start by using a hard-coded user name and password to test the service.","pos":[1135,1215]},{"content":"You will then add a login form by specifying it as a credentials provider in your application configuration.","pos":[1216,1324]},{"content":"Add role-based functionality, enabling and displaying a button only for users in the \"manager\" role.","pos":[1334,1434]},{"content":"Access Web settings.","pos":[1444,1464]},{"content":"You will start by loading Web settings for an authenticated (test) user on the <bpt id=\"p1\">**</bpt>Settings<ept id=\"p1\">**</ept> page of the project designer.","pos":[1465,1586],"source":" You will start by loading Web settings for an authenticated (test) user on the **Settings** page of the project designer."},{"content":"You will then use the Windows Forms Designer to bind a text box to a Web setting.","pos":[1587,1668]},{"content":"Finally, you will save the modified value back to the server.","pos":[1669,1730]},{"content":"Implement logout.","pos":[1740,1757]},{"content":"You will add a logout option to the form and call a logout method.","pos":[1758,1824]},{"content":"Enable offline mode.","pos":[1834,1854]},{"content":"You will provide a check box so that users can specify their connection status.","pos":[1855,1934]},{"content":"You will then use this value to specify whether the client application service providers will use locally cached data instead of accessing their Web services.","pos":[1935,2093]},{"content":"Finally, you will re-authenticate the current user when the application returns to online mode.","pos":[2094,2189]},{"pos":[2198,2211],"content":"Prerequisites","linkify":"Prerequisites","nodes":[{"content":"Prerequisites","pos":[0,13]}]},{"content":"You need the following component to complete this walkthrough:","pos":[2215,2277]},{"pos":[2287,2352],"content":"<ph id=\"ph1\">[!INCLUDE[vs_orcas_long](../../../includes/vs-orcas-long-md.md)]</ph>.","source":"[!INCLUDE[vs_orcas_long](../../../includes/vs-orcas-long-md.md)]."},{"pos":[2361,2392],"content":"Creating the Client Application","linkify":"Creating the Client Application","nodes":[{"content":"Creating the Client Application","pos":[0,31]}]},{"content":"The first thing that you will do is create a Windows Forms project.","pos":[2396,2463]},{"content":"This walkthrough uses Windows Forms because more people are familiar with it, but the process is similar for Windows Presentation Foundation (WPF) projects.","pos":[2464,2620]},{"pos":[2631,2700],"content":"To create a client application and enable client application services","linkify":"To create a client application and enable client application services","nodes":[{"content":"To create a client application and enable client application services","pos":[0,69]}]},{"pos":[2710,2823],"content":"In <ph id=\"ph1\">[!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]</ph>, select the <bpt id=\"p1\">**</bpt>File &amp;#124; New &amp;#124; Project<ept id=\"p1\">**</ept> menu option.","source":"In [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], select the **File &#124; New &#124; Project** menu option."},{"pos":[2833,2989],"content":"In the <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept> dialog box, in the <bpt id=\"p2\">**</bpt>Project types<ept id=\"p2\">**</ept> pane, expand the <bpt id=\"p3\">**</bpt>Visual Basic<ept id=\"p3\">**</ept> or <bpt id=\"p4\">**</bpt>Visual C#<ept id=\"p4\">**</ept> node and select the <bpt id=\"p5\">**</bpt>Windows<ept id=\"p5\">**</ept> project type.","source":"In the **New Project** dialog box, in the **Project types** pane, expand the **Visual Basic** or **Visual C#** node and select the **Windows** project type."},{"pos":[2999,3109],"content":"Make sure that <bpt id=\"p1\">**</bpt>.NET Framework 3.5<ept id=\"p1\">**</ept> is selected, and then select the <bpt id=\"p2\">**</bpt>Windows Forms Application<ept id=\"p2\">**</ept> template.","source":"Make sure that **.NET Framework 3.5** is selected, and then select the **Windows Forms Application** template."},{"pos":[3119,3197],"content":"Change the project <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept> to <ph id=\"ph1\">`ClientAppServicesDemo`</ph>, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>.","source":"Change the project **Name** to `ClientAppServicesDemo`, and then click **OK**."},{"pos":[3208,3300],"content":"A new Windows Forms project is opened in <ph id=\"ph1\">[!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]</ph>.","source":"A new Windows Forms project is opened in [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]."},{"pos":[3310,3379],"content":"On the <bpt id=\"p1\">**</bpt>Project<ept id=\"p1\">**</ept> menu, select <bpt id=\"p2\">**</bpt>ClientAppServicesDemo Properties<ept id=\"p2\">**</ept>.","source":"On the **Project** menu, select **ClientAppServicesDemo Properties**."},{"content":"The project designer appears.","pos":[3390,3419]},{"pos":[3429,3500],"content":"On the <bpt id=\"p1\">**</bpt>Services<ept id=\"p1\">**</ept> tab, select <bpt id=\"p2\">**</bpt>Enable client application services<ept id=\"p2\">**</ept>.","source":"On the **Services** tab, select **Enable client application services**."},{"pos":[3510,3723],"content":"Make sure that <bpt id=\"p1\">**</bpt>Use Forms authentication<ept id=\"p1\">**</ept> is selected, and then set <bpt id=\"p2\">**</bpt>Authentication service location<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Roles service location<ept id=\"p3\">**</ept>, and <bpt id=\"p4\">**</bpt>Web settings service location<ept id=\"p4\">**</ept> to <ph id=\"ph1\">`http://localhost:55555/AppServices`</ph>.","source":"Make sure that **Use Forms authentication** is selected, and then set **Authentication service location**, **Roles service location**, and **Web settings service location** to `http://localhost:55555/AppServices`."},{"pos":[3733,3872],"content":"For <ph id=\"ph1\">[!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]</ph>, on the <bpt id=\"p1\">**</bpt>Application<ept id=\"p1\">**</ept> tab, set <bpt id=\"p2\">**</bpt>Authentication mode<ept id=\"p2\">**</ept> to <bpt id=\"p3\">**</bpt>Application-defined<ept id=\"p3\">**</ept>.","source":"For [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)], on the **Application** tab, set **Authentication mode** to **Application-defined**."},{"content":"The designer stores the specified settings in the application's app.config file.","pos":[3879,3959]},{"content":"At this point, the application is configured to access all three services from the same host.","pos":[3966,4059]},{"content":"In the next section, you will create the host as a simple Web service application, enabling you to test your client configuration.","pos":[4060,4190]},{"pos":[4199,4237],"content":"Creating the Application Services Host","linkify":"Creating the Application Services Host","nodes":[{"content":"Creating the Application Services Host","pos":[0,38]}]},{"content":"In this section, you will create a simple Web service application that accesses user data from a local SQL Server Compact database file.","pos":[4241,4377]},{"content":"Then, you will populate the database using the <bpt id=\"p1\">[</bpt>ASP.NET Web Site Administration Tool<ept id=\"p1\">](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec)</ept>.","pos":[4378,4536],"source":" Then, you will populate the database using the [ASP.NET Web Site Administration Tool](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec)."},{"content":"This simple configuration enables you to quickly test your client application.","pos":[4537,4615]},{"content":"As an alternative, you can configure the Web service host to access user data from a full SQL Server database or through custom <ph id=\"ph1\">&lt;xref:System.Web.Security.MembershipProvider&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Web.Security.RoleProvider&gt;</ph> classes.","pos":[4616,4842],"source":" As an alternative, you can configure the Web service host to access user data from a full SQL Server database or through custom <xref:System.Web.Security.MembershipProvider> and <xref:System.Web.Security.RoleProvider> classes."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Creating and Configuring the Application Services Database for SQL Server<ept id=\"p1\">](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2)</ept>.","pos":[4843,5017],"source":" For more information, see [Creating and Configuring the Application Services Database for SQL Server](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2)."},{"content":"In the following procedure, you create and configure the AppServices Web service.","pos":[5024,5105]},{"pos":[5116,5169],"content":"To create and configure the application services host","linkify":"To create and configure the application services host","nodes":[{"content":"To create and configure the application services host","pos":[0,53]}]},{"pos":[5179,5313],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, select the ClientAppServicesDemo solution, and then on the <bpt id=\"p2\">**</bpt>File<ept id=\"p2\">**</ept> menu, select <bpt id=\"p3\">**</bpt>Add &amp;#124; New Project<ept id=\"p3\">**</ept>.","source":"In **Solution Explorer**, select the ClientAppServicesDemo solution, and then on the **File** menu, select **Add &#124; New Project**."},{"pos":[5323,5479],"content":"In the <bpt id=\"p1\">**</bpt>Add New Project<ept id=\"p1\">**</ept> dialog box, in the <bpt id=\"p2\">**</bpt>Project types<ept id=\"p2\">**</ept> pane, expand the <bpt id=\"p3\">**</bpt>Visual Basic<ept id=\"p3\">**</ept> or <bpt id=\"p4\">**</bpt>Visual C#<ept id=\"p4\">**</ept> node and select the <bpt id=\"p5\">**</bpt>Web<ept id=\"p5\">**</ept> project type.","source":"In the **Add New Project** dialog box, in the **Project types** pane, expand the **Visual Basic** or **Visual C#** node and select the **Web** project type."},{"pos":[5489,5605],"content":"Make sure that <bpt id=\"p1\">**</bpt>.NET Framework 3.5<ept id=\"p1\">**</ept> is selected, and then select the <bpt id=\"p2\">**</bpt>ASP.NET Web Service Application<ept id=\"p2\">**</ept> template.","source":"Make sure that **.NET Framework 3.5** is selected, and then select the **ASP.NET Web Service Application** template."},{"pos":[5615,5682],"content":"Change the project <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept> to <ph id=\"ph1\">`AppServices`</ph> and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>.","source":"Change the project **Name** to `AppServices` and then click **OK**."},{"content":"A new ASP.NET Web service application project is added to the solution, and the Service1.asmx.vb or Service1.asmx.cs file appears in the editor.","pos":[5693,5837]},{"pos":[5849,6052],"content":"[!NOTE]\nThe Service1.asmx.vb or Service1.asmx.cs file is not used in this example. If you want to keep your work environment uncluttered, you can close it and delete it from **Solution Explorer**.","leadings":["","    >  "],"nodes":[{"content":"The Service1.asmx.vb or Service1.asmx.cs file is not used in this example. If you want to keep your work environment uncluttered, you can close it and delete it from **Solution Explorer**.","pos":[8,196],"nodes":[{"content":"The Service1.asmx.vb or Service1.asmx.cs file is not used in this example.","pos":[0,74]},{"content":"If you want to keep your work environment uncluttered, you can close it and delete it from <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>.","pos":[75,188],"source":" If you want to keep your work environment uncluttered, you can close it and delete it from **Solution Explorer**."}]}]},{"pos":[6062,6188],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, select the AppServices project, and then on the <bpt id=\"p2\">**</bpt>Project<ept id=\"p2\">**</ept> menu, select <bpt id=\"p3\">**</bpt>AppServices Properties<ept id=\"p3\">**</ept>.","source":"In **Solution Explorer**, select the AppServices project, and then on the **Project** menu, select **AppServices Properties**."},{"content":"The project designer appears.","pos":[6199,6228]},{"pos":[6238,6326],"content":"On the <bpt id=\"p1\">**</bpt>Web<ept id=\"p1\">**</ept> tab, make sure that <bpt id=\"p2\">**</bpt>Use Visual Studio Development Server<ept id=\"p2\">**</ept> is selected.","source":"On the **Web** tab, make sure that **Use Visual Studio Development Server** is selected."},{"pos":[6336,6438],"content":"Select <bpt id=\"p1\">**</bpt>Specific port<ept id=\"p1\">**</ept>, specify a value of <ph id=\"ph1\">`55555`</ph>, and then set <bpt id=\"p2\">**</bpt>Virtual path<ept id=\"p2\">**</ept> to <ph id=\"ph2\">`/AppServices`</ph>.","source":"Select **Specific port**, specify a value of `55555`, and then set **Virtual path** to `/AppServices`."},{"content":"Save all files.","pos":[6448,6463]},{"pos":[6472,6554],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, open Web.config and find the <ph id=\"ph1\">`&lt;system.web&gt;`</ph> opening tag.","source":"In **Solution Explorer**, open Web.config and find the `<system.web>` opening tag."},{"pos":[6564,6619],"content":"Add the following markup before the <ph id=\"ph1\">`&lt;system.web&gt;`</ph> tag.","source":"Add the following markup before the `<system.web>` tag."},{"content":"The <ph id=\"ph1\">`authenticationService`</ph>, <ph id=\"ph2\">`profileService`</ph>, and <ph id=\"ph3\">`roleService`</ph> elements in this markup enable and configure the application services.","pos":[6630,6765],"source":"The `authenticationService`, `profileService`, and `roleService` elements in this markup enable and configure the application services."},{"content":"For testing purposes, the <ph id=\"ph1\">`requireSSL`</ph> attribute of the <ph id=\"ph2\">`authenticationService`</ph> element is set to \"false\".","pos":[6766,6872],"source":" For testing purposes, the `requireSSL` attribute of the `authenticationService` element is set to \"false\"."},{"content":"The <ph id=\"ph1\">`readAccessProperties`</ph> and <ph id=\"ph2\">`writeAccessProperties`</ph> attributes of the <ph id=\"ph3\">`profileService`</ph> element indicate that the <ph id=\"ph4\">`WebSettingsTestText`</ph> property is read/write.","pos":[6873,7034],"source":" The `readAccessProperties` and `writeAccessProperties` attributes of the `profileService` element indicate that the `WebSettingsTestText` property is read/write."},{"pos":[7046,7352],"content":"[!NOTE]\nIn production code, you should always access the authentication service over the secure sockets layer (SSL, by using the HTTPS protocol). For information about how to set up SSL, see [Configuring Secure Sockets Layer (IIS 6.0 Operations Guide)](http://go.microsoft.com/fwlink/?LinkId=91844).","leadings":["","    >  "],"nodes":[{"content":"In production code, you should always access the authentication service over the secure sockets layer (SSL, by using the HTTPS protocol). For information about how to set up SSL, see [Configuring Secure Sockets Layer (IIS 6.0 Operations Guide)](http://go.microsoft.com/fwlink/?LinkId=91844).","pos":[8,299],"nodes":[{"content":"In production code, you should always access the authentication service over the secure sockets layer (SSL, by using the HTTPS protocol).","pos":[0,137]},{"content":"For information about how to set up SSL, see <bpt id=\"p1\">[</bpt>Configuring Secure Sockets Layer (IIS 6.0 Operations Guide)<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=91844)</ept>.","pos":[138,291],"source":" For information about how to set up SSL, see [Configuring Secure Sockets Layer (IIS 6.0 Operations Guide)](http://go.microsoft.com/fwlink/?LinkId=91844)."}]}]},{"pos":[7812,7922],"content":"Add the following markup after the <ph id=\"ph1\">`&lt;system.web&gt;`</ph> opening tag so that it is within the <ph id=\"ph2\">`&lt;system.web&gt;`</ph> element.","source":"Add the following markup after the `<system.web>` opening tag so that it is within the `<system.web>` element."},{"pos":[7933,8015],"content":"The <ph id=\"ph1\">`profile`</ph> element configures a single Web setting named <ph id=\"ph2\">`WebSettingsTestText`</ph>.","source":"The `profile` element configures a single Web setting named `WebSettingsTestText`."},{"content":"In the following procedure, you use the ASP.NET Web Site Administration tool to complete the service configuration and populate the local database file.","pos":[8313,8465]},{"content":"You will add two users named <ph id=\"ph1\">`employee`</ph> and <ph id=\"ph2\">`manager`</ph> belonging to two roles with the same names.","pos":[8466,8563],"source":" You will add two users named `employee` and `manager` belonging to two roles with the same names."},{"content":"The user passwords are <ph id=\"ph1\">`employee!`</ph> and <ph id=\"ph2\">`manager!`</ph> respectively.","pos":[8564,8627],"source":" The user passwords are `employee!` and `manager!` respectively."},{"pos":[8638,8671],"content":"To configure membership and roles","linkify":"To configure membership and roles","nodes":[{"content":"To configure membership and roles","pos":[0,33]}]},{"pos":[8681,8806],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, select the AppServices project, and then on the <bpt id=\"p2\">**</bpt>Project<ept id=\"p2\">**</ept> menu, select <bpt id=\"p3\">**</bpt>ASP.NET Configuration<ept id=\"p3\">**</ept>.","source":"In **Solution Explorer**, select the AppServices project, and then on the **Project** menu, select **ASP.NET Configuration**."},{"pos":[8817,8870],"content":"The <bpt id=\"p1\">**</bpt>ASP.NET Web Site Administration Tool<ept id=\"p1\">**</ept> appears.","source":"The **ASP.NET Web Site Administration Tool** appears."},{"pos":[8880,8980],"content":"On the <bpt id=\"p1\">**</bpt>Security<ept id=\"p1\">**</ept> tab, click <bpt id=\"p2\">**</bpt>Use the security Setup Wizard to configure security step by step<ept id=\"p2\">**</ept>.","source":"On the **Security** tab, click **Use the security Setup Wizard to configure security step by step**."},{"pos":[8991,9063],"content":"The <bpt id=\"p1\">**</bpt>Security Setup Wizard<ept id=\"p1\">**</ept> appears and displays the <bpt id=\"p2\">**</bpt>Welcome<ept id=\"p2\">**</ept> step.","source":"The **Security Setup Wizard** appears and displays the **Welcome** step."},{"pos":[9073,9088],"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.","source":"Click **Next**."},{"pos":[9099,9141],"content":"The <bpt id=\"p1\">**</bpt>Select Access Method<ept id=\"p1\">**</ept> step appears.","source":"The **Select Access Method** step appears."},{"content":"Select <bpt id=\"p1\">**</bpt>From the internet<ept id=\"p1\">**</ept>.","pos":[9151,9180],"source":"Select **From the internet**."},{"content":"This configures the service to use Forms authentication instead of Windows authentication.","pos":[9181,9271]},{"pos":[9281,9302],"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept> twice.","source":"Click **Next** twice."},{"pos":[9313,9347],"content":"The <bpt id=\"p1\">**</bpt>Define Roles<ept id=\"p1\">**</ept> step appears.","source":"The **Define Roles** step appears."},{"pos":[9357,9399],"content":"Select <bpt id=\"p1\">**</bpt>Enable roles for this Web site<ept id=\"p1\">**</ept>.","source":"Select **Enable roles for this Web site**."},{"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.","pos":[9409,9424],"source":"Click **Next**."},{"content":"The <bpt id=\"p1\">**</bpt>Create New Role<ept id=\"p1\">**</ept> form appears.","pos":[9425,9462],"source":" The **Create New Role** form appears."},{"pos":[9472,9550],"content":"In the <bpt id=\"p1\">**</bpt>New Role Name<ept id=\"p1\">**</ept> text box, type <ph id=\"ph1\">`manager`</ph> and then click <bpt id=\"p2\">**</bpt>Add Role<ept id=\"p2\">**</ept>.","source":"In the **New Role Name** text box, type `manager` and then click **Add Role**."},{"pos":[9561,9623],"content":"The <bpt id=\"p1\">**</bpt>Existing Roles<ept id=\"p1\">**</ept> table appears with the specified value.","source":"The **Existing Roles** table appears with the specified value."},{"pos":[9632,9729],"content":"In the <bpt id=\"p1\">**</bpt>New Role Name<ept id=\"p1\">**</ept> text box, replace <ph id=\"ph1\">`manager`</ph> with <ph id=\"ph2\">`employee`</ph> and then click <bpt id=\"p2\">**</bpt>Add Role<ept id=\"p2\">**</ept>.","source":"In the **New Role Name** text box, replace `manager` with `employee` and then click **Add Role**."},{"pos":[9740,9794],"content":"The new value appears in the <bpt id=\"p1\">**</bpt>Existing Roles<ept id=\"p1\">**</ept> table.","source":"The new value appears in the **Existing Roles** table."},{"pos":[9804,9819],"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.","source":"Click **Next**."},{"pos":[9830,9865],"content":"The <bpt id=\"p1\">**</bpt>Add New Users<ept id=\"p1\">**</ept> step appears.","source":"The **Add New Users** step appears."},{"pos":[9875,9933],"content":"In the <bpt id=\"p1\">**</bpt>Create User<ept id=\"p1\">**</ept> form, specify the following values.","source":"In the **Create User** form, specify the following values."},{"pos":[9966,9979],"content":"<bpt id=\"p1\">**</bpt>User Name<ept id=\"p1\">**</ept>","source":"**User Name**"},{"pos":[9998,10010],"content":"<bpt id=\"p1\">**</bpt>Password<ept id=\"p1\">**</ept>","source":"**Password**"},{"pos":[10030,10050],"content":"<bpt id=\"p1\">**</bpt>Confirm Password<ept id=\"p1\">**</ept>","source":"**Confirm Password**"},{"pos":[10070,10080],"content":"<bpt id=\"p1\">**</bpt>E-mail<ept id=\"p1\">**</ept>","source":"**E-mail**"},{"pos":[10111,10132],"content":"<bpt id=\"p1\">**</bpt>Security Question<ept id=\"p1\">**</ept>","source":"**Security Question**"},{"pos":[10151,10170],"content":"<bpt id=\"p1\">**</bpt>Security Answer<ept id=\"p1\">**</ept>","source":"**Security Answer**"},{"pos":[10191,10213],"content":"Click <bpt id=\"p1\">**</bpt>Create User<ept id=\"p1\">**</ept>.","source":"Click **Create User**."},{"content":"A success message appears.","pos":[10224,10250]},{"pos":[10262,10406],"content":"[!NOTE]\nThe **E-mail**, **Security Question**, and **Security Answer** values are required by the form, but are not used in this example.","leadings":["","    >  "],"nodes":[{"content":"The <bpt id=\"p1\">**</bpt>E-mail<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Security Question<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Security Answer<ept id=\"p3\">**</ept> values are required by the form, but are not used in this example.","pos":[8,137],"source":"The **E-mail**, **Security Question**, and **Security Answer** values are required by the form, but are not used in this example."}]},{"pos":[10416,10435],"content":"Click <bpt id=\"p1\">**</bpt>Continue<ept id=\"p1\">**</ept>.","source":"Click **Continue**."},{"pos":[10446,10481],"content":"The <bpt id=\"p1\">**</bpt>Create User<ept id=\"p1\">**</ept> form reappears.","source":"The **Create User** form reappears."},{"pos":[10491,10549],"content":"In the <bpt id=\"p1\">**</bpt>Create User<ept id=\"p1\">**</ept> form, specify the following values.","source":"In the **Create User** form, specify the following values."},{"pos":[10582,10595],"content":"<bpt id=\"p1\">**</bpt>User Name<ept id=\"p1\">**</ept>","source":"**User Name**"},{"pos":[10615,10627],"content":"<bpt id=\"p1\">**</bpt>Password<ept id=\"p1\">**</ept>","source":"**Password**"},{"pos":[10648,10668],"content":"<bpt id=\"p1\">**</bpt>Confirm Password<ept id=\"p1\">**</ept>","source":"**Confirm Password**"},{"pos":[10689,10699],"content":"<bpt id=\"p1\">**</bpt>E-mail<ept id=\"p1\">**</ept>","source":"**E-mail**"},{"pos":[10731,10752],"content":"<bpt id=\"p1\">**</bpt>Security Question<ept id=\"p1\">**</ept>","source":"**Security Question**"},{"pos":[10772,10791],"content":"<bpt id=\"p1\">**</bpt>Security Answer<ept id=\"p1\">**</ept>","source":"**Security Answer**"},{"pos":[10813,10835],"content":"Click <bpt id=\"p1\">**</bpt>Create User<ept id=\"p1\">**</ept>.","source":"Click **Create User**."},{"content":"A success message appears.","pos":[10846,10872]},{"pos":[10882,10899],"content":"Click <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept>.","source":"Click **Finish**."},{"pos":[10910,10957],"content":"The <bpt id=\"p1\">**</bpt>Web Site Administration Tool<ept id=\"p1\">**</ept> reappears.","source":"The **Web Site Administration Tool** reappears."},{"pos":[10967,10991],"content":"Click <bpt id=\"p1\">**</bpt>Manager users<ept id=\"p1\">**</ept>.","source":"Click **Manager users**."},{"content":"The list of users appears.","pos":[11002,11028]},{"pos":[11038,11124],"content":"Click <bpt id=\"p1\">**</bpt>Edit roles<ept id=\"p1\">**</ept> for the <bpt id=\"p2\">**</bpt>employee<ept id=\"p2\">**</ept> user, and then select the <bpt id=\"p3\">**</bpt>employee<ept id=\"p3\">**</ept> role.","source":"Click **Edit roles** for the **employee** user, and then select the **employee** role."},{"pos":[11134,11218],"content":"Click <bpt id=\"p1\">**</bpt>Edit roles<ept id=\"p1\">**</ept> for the <bpt id=\"p2\">**</bpt>manager<ept id=\"p2\">**</ept> user, and then select the <bpt id=\"p3\">**</bpt>manager<ept id=\"p3\">**</ept> role.","source":"Click **Edit roles** for the **manager** user, and then select the **manager** role."},{"pos":[11228,11301],"content":"Close the browser window that hosts the <bpt id=\"p1\">**</bpt>Web Site Administration Tool<ept id=\"p1\">**</ept>.","source":"Close the browser window that hosts the **Web Site Administration Tool**."},{"pos":[11311,11409],"content":"If a message box appears asking if you want to reload the modified Web.config file, click <bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>.","source":"If a message box appears asking if you want to reload the modified Web.config file, click **Yes**."},{"content":"This completes the Web service setup.","pos":[11416,11453]},{"content":"At this point, you can press F5 to run the client application, and the <bpt id=\"p1\">**</bpt>ASP.NET Development Server<ept id=\"p1\">**</ept> will start automatically along with your client application.","pos":[11454,11616],"source":" At this point, you can press F5 to run the client application, and the **ASP.NET Development Server** will start automatically along with your client application."},{"content":"The server will continue to run after you exit the application, but will restart when you restart the application.","pos":[11617,11731]},{"content":"This allows it to detect any changes you have made to Web.config.","pos":[11732,11797]},{"content":"To stop the server manually, right-click the ASP.NET Development Server icon in the notification area of the taskbar and then click <bpt id=\"p1\">**</bpt>Stop<ept id=\"p1\">**</ept>.","pos":[11804,11945],"source":"To stop the server manually, right-click the ASP.NET Development Server icon in the notification area of the taskbar and then click **Stop**."},{"content":"This is useful occasionally to make sure that a clean restart occurs.","pos":[11946,12015]},{"pos":[12024,12051],"content":"Adding Forms Authentication","linkify":"Adding Forms Authentication","nodes":[{"content":"Adding Forms Authentication","pos":[0,27]}]},{"content":"In the following procedure, you add code to the main form that attempts to validate the user, and denies access when the user supplies invalid credentials.","pos":[12055,12210]},{"content":"You use a hard-coded user name and password to test the service.","pos":[12211,12275]},{"pos":[12286,12331],"content":"To validate the user in your application code","linkify":"To validate the user in your application code","nodes":[{"content":"To validate the user in your application code","pos":[0,45]}]},{"pos":[12341,12448],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, in the ClientAppServicesDemo project, add a reference to the System.Web assembly.","source":"In **Solution Explorer**, in the ClientAppServicesDemo project, add a reference to the System.Web assembly."},{"pos":[12458,12587],"content":"Select the Form1 file and then select <bpt id=\"p1\">**</bpt>View &amp;#124; Code<ept id=\"p1\">**</ept> from the <ph id=\"ph1\">[!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]</ph> main menu.","source":"Select the Form1 file and then select **View &#124; Code** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu."},{"content":"In the code editor, add the following statements to the top of the Form1 file.","pos":[12597,12675]},{"pos":[12686,12977],"content":"[!code-csharp[ClientApplicationServices#001](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#001)]\n [!code-vb[ClientApplicationServices#001](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#001)]","leadings":["","    "],"nodes":[]},{"pos":[12987,13056],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, double-click Form1 to display the designer.","source":"In **Solution Explorer**, double-click Form1 to display the designer."},{"pos":[13066,13223],"content":"In the designer, double-click the form surface to generate a <ph id=\"ph1\">&lt;xref:System.Windows.Forms.Form.Load?displayProperty=fullName&gt;</ph> event handler named <ph id=\"ph2\">`Form1_Load`</ph>.","source":"In the designer, double-click the form surface to generate a <xref:System.Windows.Forms.Form.Load?displayProperty=fullName> event handler named `Form1_Load`."},{"pos":[13234,13301],"content":"The code editor appears with the cursor in the <ph id=\"ph1\">`Form1_Load`</ph> method.","source":"The code editor appears with the cursor in the `Form1_Load` method."},{"pos":[13311,13361],"content":"Add the following code to the <ph id=\"ph1\">`Form1_Load`</ph> method.","source":"Add the following code to the `Form1_Load` method."},{"content":"This code denies access to unauthenticated users by exiting the application.","pos":[13372,13448]},{"content":"Alternatively, you could allow unauthenticated users access to the form, but deny access to specific functionality.","pos":[13449,13564]},{"content":"Normally, you will not hard-code the user name and password like this, but it is useful for testing purposes.","pos":[13565,13674]},{"content":"In the next section, you will replace this code with more robust code that displays a login dialog box and includes exception handling.","pos":[13675,13810]},{"content":"Note that the <ph id=\"ph1\">`static`</ph> <ph id=\"ph2\">&lt;xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName&gt;</ph> method is in the <ph id=\"ph3\">[!INCLUDE[dnprdnext](../../../includes/dnprdnext-md.md)]</ph>.","pos":[13821,13997],"source":"Note that the `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName> method is in the [!INCLUDE[dnprdnext](../../../includes/dnprdnext-md.md)]."},{"content":"This method delegates its work to the configured authentication provider, and returns <ph id=\"ph1\">`true`</ph> if authentication is successful.","pos":[13998,14123],"source":" This method delegates its work to the configured authentication provider, and returns `true` if authentication is successful."},{"content":"Your application does not require a direct reference to the client authentication provider.","pos":[14124,14215]},{"pos":[14226,14519],"content":"[!code-csharp[ClientApplicationServices#300](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#300)]\n [!code-vb[ClientApplicationServices#300](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#300)]","leadings":["","    "],"nodes":[]},{"content":"You can now press F5 to run the application, and because you provide a correct user name and password, you will see the form.","pos":[14526,14651]},{"pos":[14659,14820],"content":"[!NOTE]\n If you are unable to run the application, try stopping the ASP.NET Development Server. When the server restarts, verify that the port is set to 55555.","leadings":["","> "],"nodes":[{"content":"If you are unable to run the application, try stopping the ASP.NET Development Server. When the server restarts, verify that the port is set to 55555.","pos":[9,159],"nodes":[{"content":"If you are unable to run the application, try stopping the ASP.NET Development Server.","pos":[0,86]},{"content":"When the server restarts, verify that the port is set to 55555.","pos":[87,150]}]}]},{"content":"To see the error message instead, change the <ph id=\"ph1\">&lt;xref:System.Web.Security.Membership.ValidateUser%2A&gt;</ph> parameters.","pos":[14827,14937],"source":"To see the error message instead, change the <xref:System.Web.Security.Membership.ValidateUser%2A> parameters."},{"content":"For example, replace the second <ph id=\"ph1\">`\"manager!\"`</ph> parameter with an incorrect password like <ph id=\"ph2\">`\"MANAGER\"`</ph>.","pos":[14938,15037],"source":" For example, replace the second `\"manager!\"` parameter with an incorrect password like `\"MANAGER\"`."},{"pos":[15046,15091],"content":"Adding a Login Form as a Credentials Provider","linkify":"Adding a Login Form as a Credentials Provider","nodes":[{"content":"Adding a Login Form as a Credentials Provider","pos":[0,45]}]},{"content":"You can acquire the user credentials in your application code and pass them to the <ph id=\"ph1\">&lt;xref:System.Web.Security.Membership.ValidateUser%2A&gt;</ph> method.","pos":[15095,15239],"source":"You can acquire the user credentials in your application code and pass them to the <xref:System.Web.Security.Membership.ValidateUser%2A> method."},{"content":"However, it is often useful to keep your credentials-acquiring code separate from your application code, in case you want to change it later.","pos":[15240,15381]},{"content":"In the following procedure, you configure your application to use a credentials provider, and then change your <ph id=\"ph1\">&lt;xref:System.Web.Security.Membership.ValidateUser%2A&gt;</ph> method call to pass <ph id=\"ph2\">&lt;xref:System.String.Empty&gt;</ph> for both parameters.","pos":[15388,15620],"source":"In the following procedure, you configure your application to use a credentials provider, and then change your <xref:System.Web.Security.Membership.ValidateUser%2A> method call to pass <xref:System.String.Empty> for both parameters."},{"content":"The empty strings signal the <ph id=\"ph1\">&lt;xref:System.Web.Security.Membership.ValidateUser%2A&gt;</ph> method to call the <ph id=\"ph2\">&lt;xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A&gt;</ph> method of the configured credentials provider.","pos":[15621,15876],"source":" The empty strings signal the <xref:System.Web.Security.Membership.ValidateUser%2A> method to call the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> method of the configured credentials provider."},{"pos":[15887,15946],"content":"To configure your application to use a credentials provider","linkify":"To configure your application to use a credentials provider","nodes":[{"content":"To configure your application to use a credentials provider","pos":[0,59]}]},{"pos":[15956,16102],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, select the ClientAppServicesDemo project, and then on the <bpt id=\"p2\">**</bpt>Project<ept id=\"p2\">**</ept> menu, select <bpt id=\"p3\">**</bpt>ClientAppServicesDemo Properties<ept id=\"p3\">**</ept>.","source":"In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **ClientAppServicesDemo Properties**."},{"content":"The project designer appears.","pos":[16113,16142]},{"content":"On the <bpt id=\"p1\">**</bpt>Services<ept id=\"p1\">**</ept> tab, set <bpt id=\"p2\">**</bpt>Optional: Credential provider<ept id=\"p2\">**</ept> to the following value.","pos":[16152,16238],"source":"On the **Services** tab, set **Optional: Credential provider** to the following value."},{"content":"This value indicates the assembly-qualified type name.","pos":[16239,16293]},{"pos":[16383,16475],"content":"In the Form1 code file, replace the code in the <ph id=\"ph1\">`Form1_Load`</ph> method with the following code.","source":"In the Form1 code file, replace the code in the `Form1_Load` method with the following code."},{"content":"This code displays a welcome message and then calls the <ph id=\"ph1\">`ValidateUsingCredentialsProvider`</ph> method that you will add in the next step.","pos":[16486,16619],"source":"This code displays a welcome message and then calls the `ValidateUsingCredentialsProvider` method that you will add in the next step."},{"content":"If the user is not authenticated, the <ph id=\"ph1\">`ValidateUsingCredentialsProvider`</ph> method returns <ph id=\"ph2\">`false`</ph> and the <ph id=\"ph3\">`Form1_Load`</ph> method returns.","pos":[16620,16752],"source":" If the user is not authenticated, the `ValidateUsingCredentialsProvider` method returns `false` and the `Form1_Load` method returns."},{"content":"This prevents any additional code from running before the application exits.","pos":[16753,16829]},{"content":"The welcome message is useful to make it clear when the application restarts.","pos":[16830,16907]},{"content":"You will add code to restart the application when you implement logout later in this walkthrough.","pos":[16908,17005]},{"pos":[17016,17307],"content":"[!code-csharp[ClientApplicationServices#011](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#011)]\n [!code-vb[ClientApplicationServices#011](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#011)]","leadings":["","    "],"nodes":[]},{"pos":[17317,17372],"content":"Add the following method after the <ph id=\"ph1\">`Form1_Load`</ph> method.","source":"Add the following method after the `Form1_Load` method."},{"content":"This method passes empty strings to the <ph id=\"ph1\">`static`</ph> <ph id=\"ph2\">&lt;xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName&gt;</ph> method, which causes the Login dialog box to appear.","pos":[17383,17563],"source":"This method passes empty strings to the `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName> method, which causes the Login dialog box to appear."},{"content":"If the authentication service is unavailable, the <ph id=\"ph1\">&lt;xref:System.Web.Security.Membership.ValidateUser%2A&gt;</ph> method will throw a <ph id=\"ph2\">&lt;xref:System.Net.WebException&gt;</ph>.","pos":[17564,17719],"source":" If the authentication service is unavailable, the <xref:System.Web.Security.Membership.ValidateUser%2A> method will throw a <xref:System.Net.WebException>."},{"content":"In this case, the <ph id=\"ph1\">`ValidateUsingCredentialsProvider`</ph> method displays a warning message and asks if the user wants to try again in offline mode.","pos":[17720,17863],"source":" In this case, the `ValidateUsingCredentialsProvider` method displays a warning message and asks if the user wants to try again in offline mode."},{"content":"This functionality requires the <bpt id=\"p1\">**</bpt>Save password hash locally to enable offline login<ept id=\"p1\">**</ept> feature described in <bpt id=\"p2\">[</bpt>How to: Configure Client Application Services<ept id=\"p2\">](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md)</ept>.","pos":[17864,18120],"source":" This functionality requires the **Save password hash locally to enable offline login** feature described in [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md)."},{"content":"This feature is enabled by default for new projects.","pos":[18121,18173]},{"content":"If the user is not validated, the <ph id=\"ph1\">`ValidateUsingCredentialsProvider`</ph> method displays an error message and exits the application.","pos":[18184,18312],"source":"If the user is not validated, the `ValidateUsingCredentialsProvider` method displays an error message and exits the application."},{"content":"Finally, this method returns the result of the authentication attempt.","pos":[18313,18383]},{"pos":[18394,18685],"content":"[!code-csharp[ClientApplicationServices#020](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#020)]\n [!code-vb[ClientApplicationServices#020](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#020)]","leadings":["","    "],"nodes":[]},{"pos":[18695,18716],"content":"Creating a Login Form","linkify":"Creating a Login Form","nodes":[{"content":"Creating a Login Form","pos":[0,21]}]},{"content":"A credentials provider is a class that implements the <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider&gt;</ph> interface.","pos":[18720,18873],"source":"A credentials provider is a class that implements the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> interface."},{"content":"This interface has a single method named <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A&gt;</ph> that returns a <ph id=\"ph2\">&lt;xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationCredentials&gt;</ph> object.","pos":[18874,19124],"source":" This interface has a single method named <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> that returns a <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationCredentials> object."},{"content":"The following procedures describe how to create a login dialog box that implements <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A&gt;</ph> to display itself and return the user-specified credentials.","pos":[19125,19375],"source":" The following procedures describe how to create a login dialog box that implements <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> to display itself and return the user-specified credentials."},{"content":"Separate procedures are provided for <ph id=\"ph1\">[!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]</ph> and C# because <ph id=\"ph2\">[!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]</ph> provides a <bpt id=\"p1\">**</bpt>Login Form<ept id=\"p1\">**</ept> template.","pos":[19382,19571],"source":"Separate procedures are provided for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] and C# because [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] provides a **Login Form** template."},{"content":"This saves some time and coding effort.","pos":[19572,19611]},{"pos":[19623,19693],"content":"To create a login dialog box as a credentials provider in Visual Basic","linkify":"To create a login dialog box as a credentials provider in Visual Basic","nodes":[{"content":"To create a login dialog box as a credentials provider in Visual Basic","pos":[0,70]}]},{"pos":[19703,19829],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, select the ClientAppServicesDemo project, and then on the <bpt id=\"p2\">**</bpt>Project<ept id=\"p2\">**</ept> menu, select <bpt id=\"p3\">**</bpt>Add New Item<ept id=\"p3\">**</ept>.","source":"In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **Add New Item**."},{"pos":[19839,19974],"content":"In the <bpt id=\"p1\">**</bpt>Add New Item<ept id=\"p1\">**</ept> dialog box, select the <bpt id=\"p2\">**</bpt>Login Form<ept id=\"p2\">**</ept> template, change the item <bpt id=\"p3\">**</bpt>Name<ept id=\"p3\">**</ept> to <ph id=\"ph1\">`Login.vb`</ph>, and then click <bpt id=\"p4\">**</bpt>Add<ept id=\"p4\">**</ept>.","source":"In the **Add New Item** dialog box, select the **Login Form** template, change the item **Name** to `Login.vb`, and then click **Add**."},{"content":"The login dialog box appears in the Windows Forms Designer.","pos":[19985,20044]},{"pos":[20054,20163],"content":"In the designer, select the <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> button and then, in the <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept> window, set <ph id=\"ph1\">`DialogResult`</ph> to <ph id=\"ph2\">`OK`</ph>.","source":"In the designer, select the **OK** button and then, in the **Properties** window, set `DialogResult` to `OK`."},{"pos":[20173,20259],"content":"In the designer, add a <ph id=\"ph1\">`CheckBox`</ph> control to the form under the <bpt id=\"p1\">**</bpt>Password<ept id=\"p1\">**</ept> text box.","source":"In the designer, add a `CheckBox` control to the form under the **Password** text box."},{"pos":[20269,20389],"content":"In the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> window, specify a <bpt id=\"p2\">**</bpt>(Name)<ept id=\"p2\">**</ept> value of <ph id=\"ph1\">`rememberMeCheckBox`</ph> and a <bpt id=\"p3\">**</bpt>Text<ept id=\"p3\">**</ept> value of <ph id=\"ph2\">`&amp;Remember me`</ph>.","source":"In the **Properties** window, specify a **(Name)** value of `rememberMeCheckBox` and a **Text** value of `&Remember me`."},{"pos":[20399,20497],"content":"Select <bpt id=\"p1\">**</bpt>View &amp;#124; Code<ept id=\"p1\">**</ept> from the <ph id=\"ph1\">[!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]</ph> main menu.","source":"Select **View &#124; Code** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu."},{"content":"In the code editor, add the following code to the top of the file.","pos":[20507,20573]},{"content":"Modify the class signature so that the class implements the <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider&gt;</ph> interface.","pos":[20737,20896],"source":"Modify the class signature so that the class implements the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> interface."},{"pos":[21060,21205],"content":"Make sure that the cursor is after <ph id=\"ph1\">`IClientformsAuthenticationCredentialsProvider`</ph>, and then press ENTER to generate the <ph id=\"ph2\">`GetCredentials`</ph> method.","source":"Make sure that the cursor is after `IClientformsAuthenticationCredentialsProvider`, and then press ENTER to generate the `GetCredentials` method."},{"content":"Locate the <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A&gt;</ph> implementation and then replace it with the following code.","pos":[21215,21392],"source":"Locate the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> implementation and then replace it with the following code."},{"content":"The following C# procedure provides the entire code listing for a simple login dialog box.","pos":[21553,21643]},{"content":"The layout for this dialog box is a bit crude, but the important part is the <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A&gt;</ph> implementation.","pos":[21644,21843],"source":" The layout for this dialog box is a bit crude, but the important part is the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> implementation."},{"pos":[21855,21915],"content":"To create a login dialog box as a credentials provider in C#","linkify":"To create a login dialog box as a credentials provider in C#","nodes":[{"content":"To create a login dialog box as a credentials provider in C#","pos":[0,60]}]},{"pos":[21925,22048],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, select the ClientAppServicesDemo project, and then on the <bpt id=\"p2\">**</bpt>Project<ept id=\"p2\">**</ept> menu, select <bpt id=\"p3\">**</bpt>Add Class<ept id=\"p3\">**</ept>.","source":"In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **Add Class**."},{"pos":[22058,22152],"content":"In the <bpt id=\"p1\">**</bpt>Add New Item<ept id=\"p1\">**</ept> dialog box, change the <bpt id=\"p2\">**</bpt>Name<ept id=\"p2\">**</ept> to <ph id=\"ph1\">`Login.cs`</ph>, and then click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>.","source":"In the **Add New Item** dialog box, change the **Name** to `Login.cs`, and then click **Add**."},{"content":"The Login.cs file opens in the code editor.","pos":[22163,22206]},{"content":"Replace the default code with the following code.","pos":[22216,22265]},{"content":"You can now run the application and see the login dialog box appear.","pos":[22425,22493]},{"content":"To test this code, try different credentials, both valid and invalid, and confirm that you can access the form only with valid credentials.","pos":[22494,22633]},{"content":"Valid user names are <ph id=\"ph1\">`employee`</ph> and <ph id=\"ph2\">`manager`</ph> with passwords <ph id=\"ph3\">`employee!`</ph> and <ph id=\"ph4\">`manager!`</ph> respectively.","pos":[22634,22735],"source":" Valid user names are `employee` and `manager` with passwords `employee!` and `manager!` respectively."},{"pos":[22743,22900],"content":"[!NOTE]\n Do not select **Remember me** at this point or you will not be able to login as another user until you implement logout later in this walkthrough.","leadings":["","> "],"nodes":[{"content":"Do not select <bpt id=\"p1\">**</bpt>Remember me<ept id=\"p1\">**</ept> at this point or you will not be able to login as another user until you implement logout later in this walkthrough.","pos":[9,155],"source":"Do not select **Remember me** at this point or you will not be able to login as another user until you implement logout later in this walkthrough."}]},{"pos":[22909,22940],"content":"Adding Role-Based Functionality","linkify":"Adding Role-Based Functionality","nodes":[{"content":"Adding Role-Based Functionality","pos":[0,31]}]},{"content":"In the following procedure, you add a button to the form and display it only for users in the manager role.","pos":[22944,23051]},{"pos":[23062,23109],"content":"To change the user interface based on user role","linkify":"To change the user interface based on user role","nodes":[{"content":"To change the user interface based on user role","pos":[0,47]}]},{"pos":[23119,23307],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, in the ClientAppServicesDemo project, select Form1 and then select <bpt id=\"p2\">**</bpt>View &amp;#124; Designer<ept id=\"p2\">**</ept> from the <ph id=\"ph1\">[!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]</ph> main menu.","source":"In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu."},{"pos":[23317,23416],"content":"In the designer, add a <ph id=\"ph1\">&lt;xref:System.Windows.Forms.Button&gt;</ph> control to the form from the <bpt id=\"p1\">**</bpt>ToolBox<ept id=\"p1\">**</ept>.","source":"In the designer, add a <xref:System.Windows.Forms.Button> control to the form from the **ToolBox**."},{"pos":[23426,23500],"content":"In the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> window, set the following properties for the button.","source":"In the **Properties** window, set the following properties for the button."},{"content":"Property","pos":[23511,23519]},{"content":"Value","pos":[23520,23525]},{"pos":[23569,23579],"content":"<bpt id=\"p1\">**</bpt>(Name)<ept id=\"p1\">**</ept>","source":"**(Name)**"},{"content":"managerOnlyButton","pos":[23580,23597]},{"pos":[23606,23614],"content":"<bpt id=\"p1\">**</bpt>Text<ept id=\"p1\">**</ept>","source":"**Text**"},{"content":"&amp;Manager task","pos":[23615,23628],"source":"&Manager task"},{"pos":[23637,23648],"content":"<bpt id=\"p1\">**</bpt>Visible<ept id=\"p1\">**</ept>","source":"**Visible**"},{"pos":[23667,23758],"content":"In the code editor for Form1, add the following code to the end of the <ph id=\"ph1\">`Form1_Load`</ph> method.","source":"In the code editor for Form1, add the following code to the end of the `Form1_Load` method."},{"pos":[23769,23861],"content":"This code calls the <ph id=\"ph1\">`DisplayButtonForManagerRole`</ph> method that you will add in the next step.","source":"This code calls the `DisplayButtonForManagerRole` method that you will add in the next step."},{"pos":[23872,24163],"content":"[!code-csharp[ClientApplicationServices#012](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#012)]\n [!code-vb[ClientApplicationServices#012](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#012)]","leadings":["","    "],"nodes":[]},{"content":"Add the following method to the end of the Form1 class.","pos":[24173,24228]},{"content":"This method calls the <ph id=\"ph1\">&lt;xref:System.Security.Principal.IPrincipal.IsInRole%2A&gt;</ph> method of the <ph id=\"ph2\">&lt;xref:System.Security.Principal.IPrincipal&gt;</ph> returned by the <ph id=\"ph3\">`static`</ph> <ph id=\"ph4\">&lt;xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName&gt;</ph> property.","pos":[24239,24485],"source":"This method calls the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method of the <xref:System.Security.Principal.IPrincipal> returned by the `static` <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName> property."},{"content":"For applications configured to use client application services, this property returns a <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.ClientRolePrincipal&gt;</ph>.","pos":[24486,24627],"source":" For applications configured to use client application services, this property returns a <xref:System.Web.ClientServices.ClientRolePrincipal>."},{"content":"Because this class implements the <ph id=\"ph1\">&lt;xref:System.Security.Principal.IPrincipal&gt;</ph> interface, you do not need to reference it explicitly.","pos":[24628,24760],"source":" Because this class implements the <xref:System.Security.Principal.IPrincipal> interface, you do not need to reference it explicitly."},{"content":"If the user is in the \"manager\" role, the <ph id=\"ph1\">`DisplayButtonForManagerRole`</ph> method sets the <ph id=\"ph2\">&lt;xref:System.Windows.Forms.Control.Visible%2A&gt;</ph> property of the <ph id=\"ph3\">`managerOnlyButton`</ph> to <ph id=\"ph4\">`true`</ph>.","pos":[24771,24952],"source":"If the user is in the \"manager\" role, the `DisplayButtonForManagerRole` method sets the <xref:System.Windows.Forms.Control.Visible%2A> property of the `managerOnlyButton` to `true`."},{"content":"This method also displays an error message if a <ph id=\"ph1\">&lt;xref:System.Net.WebException&gt;</ph> is thrown, which indicates that the roles service is unavailable.","pos":[24953,25097],"source":" This method also displays an error message if a <xref:System.Net.WebException> is thrown, which indicates that the roles service is unavailable."},{"pos":[25109,26333],"content":"[!NOTE]\nThe <xref:System.Web.ClientServices.ClientRolePrincipal.IsInRole%2A> method will always return `false` if the user login has expired. This will not occur if your application calls the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method one time shortly after authentication, as shown in the example code for this walkthrough. If your application must retrieve user roles at other times, you might want to add code to revalidate users whose login has expired. If all valid users are assigned to roles, you can determine whether the login has expired by calling the <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A?displayProperty=fullName> method. If no roles are returned, the login has expired. For an example of this functionality, see the <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A> method. This functionality is only necessary if you have selected **Require users to log on again whenever the server cookie expires** in your application configuration. For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).","leadings":["","    >  "],"nodes":[{"content":"The <xref:System.Web.ClientServices.ClientRolePrincipal.IsInRole%2A> method will always return `false` if the user login has expired. This will not occur if your application calls the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method one time shortly after authentication, as shown in the example code for this walkthrough. If your application must retrieve user roles at other times, you might want to add code to revalidate users whose login has expired. If all valid users are assigned to roles, you can determine whether the login has expired by calling the <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A?displayProperty=fullName> method. If no roles are returned, the login has expired. For an example of this functionality, see the <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A> method. This functionality is only necessary if you have selected **Require users to log on again whenever the server cookie expires** in your application configuration. For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).","pos":[8,1217],"nodes":[{"content":"The <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.ClientRolePrincipal.IsInRole%2A&gt;</ph> method will always return <ph id=\"ph2\">`false`</ph> if the user login has expired.","pos":[0,133],"source":"The <xref:System.Web.ClientServices.ClientRolePrincipal.IsInRole%2A> method will always return `false` if the user login has expired."},{"content":"This will not occur if your application calls the <ph id=\"ph1\">&lt;xref:System.Security.Principal.IPrincipal.IsInRole%2A&gt;</ph> method one time shortly after authentication, as shown in the example code for this walkthrough.","pos":[134,336],"source":" This will not occur if your application calls the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method one time shortly after authentication, as shown in the example code for this walkthrough."},{"content":"If your application must retrieve user roles at other times, you might want to add code to revalidate users whose login has expired.","pos":[337,469]},{"content":"If all valid users are assigned to roles, you can determine whether the login has expired by calling the <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A?displayProperty=fullName&gt;</ph> method.","pos":[470,688],"source":" If all valid users are assigned to roles, you can determine whether the login has expired by calling the <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A?displayProperty=fullName> method."},{"content":"If no roles are returned, the login has expired.","pos":[689,737]},{"content":"For an example of this functionality, see the <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A&gt;</ph> method.","pos":[738,872],"source":" For an example of this functionality, see the <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A> method."},{"content":"This functionality is only necessary if you have selected <bpt id=\"p1\">**</bpt>Require users to log on again whenever the server cookie expires<ept id=\"p1\">**</ept> in your application configuration.","pos":[873,1034],"source":" This functionality is only necessary if you have selected **Require users to log on again whenever the server cookie expires** in your application configuration."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>How to: Configure Client Application Services<ept id=\"p1\">](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md)</ept>.","pos":[1035,1209],"source":" For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md)."}]}]},{"pos":[26344,26635],"content":"[!code-csharp[ClientApplicationServices#030](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#030)]\n [!code-vb[ClientApplicationServices#030](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#030)]","leadings":["","    "],"nodes":[]},{"content":"If authentication is successful, the client authentication provider sets the <ph id=\"ph1\">&lt;xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName&gt;</ph> property to an instance of the <ph id=\"ph2\">&lt;xref:System.Web.ClientServices.ClientRolePrincipal&gt;</ph> class.","pos":[26642,26885],"source":"If authentication is successful, the client authentication provider sets the <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName> property to an instance of the <xref:System.Web.ClientServices.ClientRolePrincipal> class."},{"content":"This class implements the <ph id=\"ph1\">&lt;xref:System.Security.Principal.IPrincipal.IsInRole%2A&gt;</ph> method so that the work is delegated to the configured role provider.","pos":[26886,27037],"source":" This class implements the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method so that the work is delegated to the configured role provider."},{"content":"As before, your application code does not require a direct reference to the service provider.","pos":[27038,27131]},{"content":"You can now run the application and log in as employee to see that the button does not appear, and then log in as manager to see the button.","pos":[27138,27278]},{"pos":[27287,27309],"content":"Accessing Web Settings","linkify":"Accessing Web Settings","nodes":[{"content":"Accessing Web Settings","pos":[0,22]}]},{"content":"In the following procedure, you add a text box to the form and bind it to a Web setting.","pos":[27313,27401]},{"content":"Like the previous code that uses authentication and roles, your settings code does not access the settings provider directly.","pos":[27402,27527]},{"content":"Instead, it uses the strongly-typed <ph id=\"ph1\">`Settings`</ph> class (accessed as <ph id=\"ph2\">`Properties.Settings.Default`</ph> in C# and <ph id=\"ph3\">`My.Settings`</ph> in <ph id=\"ph4\">[!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]</ph>) generated for your project by <ph id=\"ph5\">[!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]</ph>.","pos":[27528,27784],"source":" Instead, it uses the strongly-typed `Settings` class (accessed as `Properties.Settings.Default` in C# and `My.Settings` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) generated for your project by [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]."},{"pos":[27795,27837],"content":"To use Web settings in your user interface","linkify":"To use Web settings in your user interface","nodes":[{"content":"To use Web settings in your user interface","pos":[0,42]}]},{"content":"Make sure that the <bpt id=\"p1\">**</bpt>ASP.NET Web Development Server<ept id=\"p1\">**</ept> is still running by checking the notification area of the taskbar.","pos":[27847,27967],"source":"Make sure that the **ASP.NET Web Development Server** is still running by checking the notification area of the taskbar."},{"content":"If you have stopped the server, restart the application (which starts the server automatically) then close the login dialog box.","pos":[27968,28096]},{"pos":[28106,28252],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, select the ClientAppServicesDemo project, and then on the <bpt id=\"p2\">**</bpt>Project<ept id=\"p2\">**</ept> menu, select <bpt id=\"p3\">**</bpt>ClientAppServicesDemo Properties<ept id=\"p3\">**</ept>.","source":"In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **ClientAppServicesDemo Properties**."},{"content":"The project designer appears.","pos":[28263,28292]},{"pos":[28302,28355],"content":"On the <bpt id=\"p1\">**</bpt>Settings<ept id=\"p1\">**</ept> tab, click <bpt id=\"p2\">**</bpt>Load Web Settings<ept id=\"p2\">**</ept>.","source":"On the **Settings** tab, click **Load Web Settings**."},{"pos":[28366,28397],"content":"A <bpt id=\"p1\">**</bpt>Login<ept id=\"p1\">**</ept> dialog box appears.","source":"A **Login** dialog box appears."},{"content":"Enter credentials for employee or manager and click <bpt id=\"p1\">**</bpt>Log In<ept id=\"p1\">**</ept>.","pos":[28407,28470],"source":"Enter credentials for employee or manager and click **Log In**."},{"content":"The Web setting you will use is configured for access by authenticated users only, so clicking <bpt id=\"p1\">**</bpt>Skip Login<ept id=\"p1\">**</ept> will not load any settings.","pos":[28471,28608],"source":" The Web setting you will use is configured for access by authenticated users only, so clicking **Skip Login** will not load any settings."},{"content":"The <ph id=\"ph1\">`WebSettingsTestText`</ph> setting appears in the designer with the default value of <ph id=\"ph2\">`DefaultText`</ph>.","pos":[28619,28717],"source":"The `WebSettingsTestText` setting appears in the designer with the default value of `DefaultText`."},{"content":"Additionally, a <ph id=\"ph1\">`Settings`</ph> class that contains a <ph id=\"ph2\">`WebSettingsTestText`</ph> property is generated for your project.","pos":[28718,28828],"source":" Additionally, a `Settings` class that contains a `WebSettingsTestText` property is generated for your project."},{"pos":[28838,29026],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, in the ClientAppServicesDemo project, select Form1 and then select <bpt id=\"p2\">**</bpt>View &amp;#124; Designer<ept id=\"p2\">**</ept> from the <ph id=\"ph1\">[!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]</ph> main menu.","source":"In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu."},{"content":"In the designer, add a <ph id=\"ph1\">&lt;xref:System.Windows.Forms.TextBox&gt;</ph> control to the form.","pos":[29036,29115],"source":"In the designer, add a <xref:System.Windows.Forms.TextBox> control to the form."},{"pos":[29125,29210],"content":"In the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> window, specify a <bpt id=\"p2\">**</bpt>(Name)<ept id=\"p2\">**</ept> value of <ph id=\"ph1\">`webSettingsTestTextBox`</ph>.","source":"In the **Properties** window, specify a **(Name)** value of `webSettingsTestTextBox`."},{"pos":[29220,29301],"content":"In the code editor, add the following code to the end of the <ph id=\"ph1\">`Form1_Load`</ph> method.","source":"In the code editor, add the following code to the end of the `Form1_Load` method."},{"pos":[29312,29403],"content":"This code calls the <ph id=\"ph1\">`BindWebSettingsTestTextBox`</ph> method that you will add in the next step.","source":"This code calls the `BindWebSettingsTestTextBox` method that you will add in the next step."},{"pos":[29414,29705],"content":"[!code-csharp[ClientApplicationServices#013](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#013)]\n [!code-vb[ClientApplicationServices#013](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#013)]","leadings":["","    "],"nodes":[]},{"content":"Add the following method to the end of the Form1 class.","pos":[29714,29769]},{"content":"This method binds the <ph id=\"ph1\">&lt;xref:System.Windows.Forms.TextBox.Text%2A&gt;</ph> property of the <ph id=\"ph2\">`webSettingsTestTextBox`</ph> to the <ph id=\"ph3\">`WebSettingsTestText`</ph> property of the <ph id=\"ph4\">`Settings`</ph> class generated earlier in this procedure.","pos":[29780,29985],"source":"This method binds the <xref:System.Windows.Forms.TextBox.Text%2A> property of the `webSettingsTestTextBox` to the `WebSettingsTestText` property of the `Settings` class generated earlier in this procedure."},{"content":"This method also displays an error message if a <ph id=\"ph1\">&lt;xref:System.Net.WebException&gt;</ph> is thrown, which indicates that the Web settings service is unavailable.","pos":[29986,30137],"source":" This method also displays an error message if a <xref:System.Net.WebException> is thrown, which indicates that the Web settings service is unavailable."},{"pos":[30148,30439],"content":"[!code-csharp[ClientApplicationServices#040](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#040)]\n  [!code-vb[ClientApplicationServices#040](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#040)]","leadings":["","   "],"nodes":[]},{"pos":[30451,30666],"content":"[!NOTE]\nYou will typically use data binding to enable automatic two-way communication between a control and a Web setting. However, you can also access Web settings directly as shown in the following example:","leadings":["","    >  "],"nodes":[{"content":"You will typically use data binding to enable automatic two-way communication between a control and a Web setting. However, you can also access Web settings directly as shown in the following example:","pos":[8,208],"nodes":[{"content":"You will typically use data binding to enable automatic two-way communication between a control and a Web setting.","pos":[0,114]},{"content":"However, you can also access Web settings directly as shown in the following example:","pos":[115,200]}]}]},{"pos":[30677,30970],"content":"[!code-csharp[ClientApplicationServices#322](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#322)]\n  [!code-vb[ClientApplicationServices#322](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#322)]","leadings":["","   "],"nodes":[]},{"pos":[30980,31082],"content":"In the designer, select the form, and then, in the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> window, click the <bpt id=\"p2\">**</bpt>Events<ept id=\"p2\">**</ept> button.","source":"In the designer, select the form, and then, in the **Properties** window, click the **Events** button."},{"content":"Select the <ph id=\"ph1\">&lt;xref:System.Windows.Forms.Form.FormClosing&gt;</ph> event and then press ENTER to generate an event handler.","pos":[31092,31204],"source":"Select the <xref:System.Windows.Forms.Form.FormClosing> event and then press ENTER to generate an event handler."},{"content":"Replace the generated method with the following code.","pos":[31214,31267]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Windows.Forms.Form.FormClosing&gt;</ph> event handler calls the <ph id=\"ph2\">`SaveSettings`</ph> method, which is also used by the logout functionality that you will add in the next section.","pos":[31278,31459],"source":"The <xref:System.Windows.Forms.Form.FormClosing> event handler calls the `SaveSettings` method, which is also used by the logout functionality that you will add in the next section."},{"content":"The <ph id=\"ph1\">`SaveSettings`</ph> method first confirms that the user has not logged out. It does this by checking the <ph id=\"ph2\">&lt;xref:System.Security.Principal.IIdentity.AuthenticationType%2A&gt;</ph> property of the <ph id=\"ph3\">&lt;xref:System.Security.Principal.IIdentity&gt;</ph> returned by the current principal.","pos":[31460,31722],"source":" The `SaveSettings` method first confirms that the user has not logged out. It does this by checking the <xref:System.Security.Principal.IIdentity.AuthenticationType%2A> property of the <xref:System.Security.Principal.IIdentity> returned by the current principal."},{"content":"The current principal is retrieved through the <ph id=\"ph1\">`static`</ph> <ph id=\"ph2\">&lt;xref:System.Threading.Thread.CurrentPrincipal%2A&gt;</ph> property.","pos":[31723,31839],"source":" The current principal is retrieved through the `static` <xref:System.Threading.Thread.CurrentPrincipal%2A> property."},{"content":"If the user has been authenticated for client application services, the authentication type will be \"ClientForms\".","pos":[31840,31954]},{"content":"The <ph id=\"ph1\">`SaveSettings`</ph> method cannot just check the <ph id=\"ph2\">&lt;xref:System.Security.Principal.IIdentity.IsAuthenticated%2A?displayProperty=fullName&gt;</ph> property because the user might have a valid Windows identity after logout.","pos":[31955,32165],"source":" The `SaveSettings` method cannot just check the <xref:System.Security.Principal.IIdentity.IsAuthenticated%2A?displayProperty=fullName> property because the user might have a valid Windows identity after logout."},{"content":"If the user has not logged out, the <ph id=\"ph1\">`SaveSettings`</ph> method calls the <ph id=\"ph2\">&lt;xref:System.Configuration.ApplicationSettingsBase.Save%2A&gt;</ph> method of the <ph id=\"ph3\">`Settings`</ph> class generated earlier in this procedure.","pos":[32176,32371],"source":"If the user has not logged out, the `SaveSettings` method calls the <xref:System.Configuration.ApplicationSettingsBase.Save%2A> method of the `Settings` class generated earlier in this procedure."},{"content":"This method can throw a <ph id=\"ph1\">&lt;xref:System.Net.WebException&gt;</ph> if the authentication cookie has expired.","pos":[32372,32468],"source":" This method can throw a <xref:System.Net.WebException> if the authentication cookie has expired."},{"content":"This occurs only if you have selected <bpt id=\"p1\">**</bpt>Require users to log on again whenever the server cookie expires<ept id=\"p1\">**</ept> in your application configuration.","pos":[32469,32610],"source":" This occurs only if you have selected **Require users to log on again whenever the server cookie expires** in your application configuration."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>How to: Configure Client Application Services<ept id=\"p1\">](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md)</ept>.","pos":[32611,32785],"source":" For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md)."},{"content":"The <ph id=\"ph1\">`SaveSettings`</ph> method handles cookie expiration by calling <ph id=\"ph2\">&lt;xref:System.Web.Security.Membership.ValidateUser%2A&gt;</ph> to display the login dialog box.","pos":[32786,32935],"source":" The `SaveSettings` method handles cookie expiration by calling <xref:System.Web.Security.Membership.ValidateUser%2A> to display the login dialog box."},{"content":"If the user logs in successfully, the <ph id=\"ph1\">`SaveSettings`</ph> method tries to save the settings again by calling itself.","pos":[32936,33047],"source":" If the user logs in successfully, the `SaveSettings` method tries to save the settings again by calling itself."},{"content":"Like in previous code, the <ph id=\"ph1\">`SaveSettings`</ph> method displays an error message if the remote service is unavailable.","pos":[33058,33170],"source":"Like in previous code, the `SaveSettings` method displays an error message if the remote service is unavailable."},{"content":"If the settings provider cannot access the remote service, the settings are still saved to the local cache and reloaded when the application restarts.","pos":[33171,33321]},{"pos":[33332,33623],"content":"[!code-csharp[ClientApplicationServices#050](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#050)]\n [!code-vb[ClientApplicationServices#050](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#050)]","leadings":["","    "],"nodes":[]},{"content":"Add the following method to the end of the Form1 class.","pos":[33633,33688]},{"content":"This code handles the <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved?displayProperty=fullName&gt;</ph> event and displays a warning if any of the settings could not be saved.","pos":[33699,33897],"source":"This code handles the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved?displayProperty=fullName> event and displays a warning if any of the settings could not be saved."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved&gt;</ph> event does not occur if the settings service is unavailable or if the authentication cookie has expired.","pos":[33898,34086],"source":" The <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event does not occur if the settings service is unavailable or if the authentication cookie has expired."},{"content":"One example of when the <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved&gt;</ph> event will occur is if the user has already logged out. You can test this event handler by adding logout code to the <ph id=\"ph2\">`SaveSettings`</ph> method directly before the <ph id=\"ph3\">&lt;xref:System.Configuration.ApplicationSettingsBase.Save%2A&gt;</ph> method call.","pos":[34087,34422],"source":" One example of when the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event will occur is if the user has already logged out. You can test this event handler by adding logout code to the `SaveSettings` method directly before the <xref:System.Configuration.ApplicationSettingsBase.Save%2A> method call."},{"content":"Logout code that you can use is described in the next section.","pos":[34423,34485]},{"pos":[34496,34787],"content":"[!code-csharp[ClientApplicationServices#090](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#090)]\n [!code-vb[ClientApplicationServices#090](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#090)]","leadings":["","    "],"nodes":[]},{"content":"For C#, add the following code to the end of the <ph id=\"ph1\">`Form1_Load`</ph> method.","pos":[34797,34866],"source":"For C#, add the following code to the end of the `Form1_Load` method."},{"content":"This code associates the method you added in the last step with the <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved&gt;</ph> event.","pos":[34867,35021],"source":" This code associates the method you added in the last step with the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event."},{"content":"To test the application at this point, run it multiple times as both employee and manager, and type different values into the text box.","pos":[35181,35316]},{"content":"The values will persist across sessions on a per-user basis.","pos":[35317,35377]},{"pos":[35386,35405],"content":"Implementing Logout","linkify":"Implementing Logout","nodes":[{"content":"Implementing Logout","pos":[0,19]}]},{"content":"When the user selects the <bpt id=\"p1\">**</bpt>Remember me<ept id=\"p1\">**</ept> check box when logging in, the application will automatically authenticate the user on subsequent runs.","pos":[35409,35554],"source":"When the user selects the **Remember me** check box when logging in, the application will automatically authenticate the user on subsequent runs."},{"content":"Automatic authentication will then continue while the application is in offline mode or until the authentication cookie expires.","pos":[35555,35683]},{"content":"Sometimes, however, multiple users will need access to the application or a single user might occasionally log in with different credentials.","pos":[35684,35825]},{"content":"To enable this scenario, you must implement logout functionality, as described in the following procedure.","pos":[35826,35932]},{"pos":[35943,35976],"content":"To implement logout functionality","linkify":"To implement logout functionality","nodes":[{"content":"To implement logout functionality","pos":[0,33]}]},{"pos":[35986,36091],"content":"In the Form1 designer, add a <ph id=\"ph1\">&lt;xref:System.Windows.Forms.Button&gt;</ph> control to the form from the <bpt id=\"p1\">**</bpt>ToolBox<ept id=\"p1\">**</ept>.","source":"In the Form1 designer, add a <xref:System.Windows.Forms.Button> control to the form from the **ToolBox**."},{"pos":[36101,36213],"content":"In the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> window, specify a <bpt id=\"p2\">**</bpt>(Name)<ept id=\"p2\">**</ept> value of <ph id=\"ph1\">`logoutButton`</ph> and a <bpt id=\"p3\">**</bpt>Text<ept id=\"p3\">**</ept> value of <bpt id=\"p4\">**</bpt>&amp;Log Out<ept id=\"p4\">**</ept>.","source":"In the **Properties** window, specify a **(Name)** value of `logoutButton` and a **Text** value of **&Log Out**."},{"pos":[36223,36325],"content":"Double-click the <ph id=\"ph1\">`logoutButton`</ph> to generate a <ph id=\"ph2\">&lt;xref:System.Windows.Forms.Control.Click&gt;</ph> event handler.","source":"Double-click the `logoutButton` to generate a <xref:System.Windows.Forms.Control.Click> event handler."},{"pos":[36336,36411],"content":"The code editor appears with the cursor in the <ph id=\"ph1\">`logoutButton_Click`</ph> method.","source":"The code editor appears with the cursor in the `logoutButton_Click` method."},{"pos":[36421,36495],"content":"Replace the generated <ph id=\"ph1\">`logoutButton_Click`</ph> method with the following code.","source":"Replace the generated `logoutButton_Click` method with the following code."},{"content":"This event handler first calls the <ph id=\"ph1\">`SaveSettings`</ph> method that you added in the previous section.","pos":[36506,36602],"source":"This event handler first calls the `SaveSettings` method that you added in the previous section."},{"content":"Then, the event handler calls the <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A?displayProperty=fullName&gt;</ph> method.","pos":[36603,36766],"source":" Then, the event handler calls the <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A?displayProperty=fullName> method."},{"content":"If the authentication service is unavailable, the <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A&gt;</ph> method will throw a <ph id=\"ph2\">&lt;xref:System.Net.WebException&gt;</ph>.","pos":[36767,36965],"source":" If the authentication service is unavailable, the <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A> method will throw a <xref:System.Net.WebException>."},{"content":"In this case, the <ph id=\"ph1\">`logoutButton_Click`</ph> method displays a warning message and switches temporarily to offline mode to log the user out. Offline mode is described in the next section.","pos":[36966,37147],"source":" In this case, the `logoutButton_Click` method displays a warning message and switches temporarily to offline mode to log the user out. Offline mode is described in the next section."},{"content":"Logout deletes the local authentication cookie so that login will be required when the application is restarted.","pos":[37158,37270]},{"content":"After logout, the event handler restarts the application.","pos":[37271,37328]},{"content":"When the application restarts, it displays the welcome message followed by the login dialog box.","pos":[37329,37425]},{"content":"The welcome message makes it clear that the application has restarted.","pos":[37426,37496]},{"content":"This prevents potential confusion if the user must log in to save settings, and then must log in again because the application has restarted.","pos":[37497,37638]},{"pos":[37649,37940],"content":"[!code-csharp[ClientApplicationServices#070](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#070)]\n [!code-vb[ClientApplicationServices#070](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#070)]","leadings":["","    "],"nodes":[]},{"content":"To test the logout functionality, run the application and select <bpt id=\"p1\">**</bpt>Remember me<ept id=\"p1\">**</ept> on the Login dialog box.","pos":[37947,38052],"source":"To test the logout functionality, run the application and select **Remember me** on the Login dialog box."},{"content":"Next, close and restart the application to confirm that you no longer have to log in.","pos":[38053,38138]},{"content":"Finally, restart the application by clicking Log out.","pos":[38139,38192]},{"pos":[38201,38222],"content":"Enabling Offline Mode","linkify":"Enabling Offline Mode","nodes":[{"content":"Enabling Offline Mode","pos":[0,21]}]},{"content":"In the following procedure, you add a check box to the form to enable the user to enter offline mode.","pos":[38226,38327]},{"content":"Your application indicates offline mode by setting the <ph id=\"ph1\">`static`</ph> <ph id=\"ph2\">&lt;xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A?displayProperty=fullName&gt;</ph> property to <ph id=\"ph3\">`true`</ph>.","pos":[38328,38501],"source":" Your application indicates offline mode by setting the `static` <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A?displayProperty=fullName> property to `true`."},{"content":"The offline status is stored on the local hard disk at the location indicated by the <ph id=\"ph1\">&lt;xref:System.Windows.Forms.Application.UserAppDataPath%2A?displayProperty=fullName&gt;</ph> property.","pos":[38502,38680],"source":" The offline status is stored on the local hard disk at the location indicated by the <xref:System.Windows.Forms.Application.UserAppDataPath%2A?displayProperty=fullName> property."},{"content":"This means that the offline status is stored on a per-user, per-application basis.","pos":[38681,38763]},{"content":"In offline mode, all client application service requests retrieve data from the local cache instead of trying to access the services.","pos":[38770,38903]},{"content":"In the default configuration, the local data includes an encrypted form of the user's password.","pos":[38904,38999]},{"content":"This enables the user to log in while the application is in offline mode.","pos":[39000,39073]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>How to: Configure Client Application Services<ept id=\"p1\">](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md)</ept>.","pos":[39074,39248],"source":" For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md)."},{"pos":[39259,39301],"content":"To enable offline mode in your application","linkify":"To enable offline mode in your application","nodes":[{"content":"To enable offline mode in your application","pos":[0,42]}]},{"pos":[39311,39499],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, in the ClientAppServicesDemo project, select Form1 and then select <bpt id=\"p2\">**</bpt>View &amp;#124; Designer<ept id=\"p2\">**</ept> from the <ph id=\"ph1\">[!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]</ph> main menu.","source":"In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu."},{"content":"In the designer, add a <ph id=\"ph1\">&lt;xref:System.Windows.Forms.CheckBox&gt;</ph> control to the form.","pos":[39509,39589],"source":"In the designer, add a <xref:System.Windows.Forms.CheckBox> control to the form."},{"pos":[39599,39723],"content":"In the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> window, specify a <bpt id=\"p2\">**</bpt>(Name)<ept id=\"p2\">**</ept> value of <ph id=\"ph1\">`workOfflineCheckBox`</ph> and a <bpt id=\"p3\">**</bpt>Text<ept id=\"p3\">**</ept> value of <bpt id=\"p4\">**</bpt>&amp;Work offline<ept id=\"p4\">**</ept>.","source":"In the **Properties** window, specify a **(Name)** value of `workOfflineCheckBox` and a **Text** value of **&Work offline**."},{"pos":[39733,39791],"content":"In the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> window, click the <bpt id=\"p2\">**</bpt>Events<ept id=\"p2\">**</ept> button.","source":"In the **Properties** window, click the **Events** button."},{"content":"Select the <ph id=\"ph1\">&lt;xref:System.Windows.Forms.CheckBox.CheckedChanged&gt;</ph> event and then press ENTER to generate an event handler.","pos":[39801,39920],"source":"Select the <xref:System.Windows.Forms.CheckBox.CheckedChanged> event and then press ENTER to generate an event handler."},{"content":"Replace the generated method with the following code.","pos":[39930,39983]},{"content":"This code updates the <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A&gt;</ph> value and silently revalidates the user when they return to online mode.","pos":[39994,40153],"source":"This code updates the <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A> value and silently revalidates the user when they return to online mode."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A?displayProperty=fullName&gt;</ph> method uses the cached credentials so that the user does not have to explicitly log in.","pos":[40154,40341],"source":" The <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A?displayProperty=fullName> method uses the cached credentials so that the user does not have to explicitly log in."},{"content":"If the authentication service is unavailable, a warning message appears and the application stays offline.","pos":[40342,40448]},{"pos":[40460,40957],"content":"[!NOTE]\nThe <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A> method is for convenience only. Because it does not have a return value, it cannot indicate whether revalidation has failed. Revalidation can fail, for example, if the user credentials have changed on the server. In this case, you might want to include code that explicitly validates users after a service call fails. For more information, see the Accessing Web Settings section earlier in this walkthrough.","leadings":["","    >  "],"nodes":[{"content":"The <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A> method is for convenience only. Because it does not have a return value, it cannot indicate whether revalidation has failed. Revalidation can fail, for example, if the user credentials have changed on the server. In this case, you might want to include code that explicitly validates users after a service call fails. For more information, see the Accessing Web Settings section earlier in this walkthrough.","pos":[8,490],"nodes":[{"content":"The <ph id=\"ph1\">&lt;xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A&gt;</ph> method is for convenience only.","pos":[0,106],"source":"The <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A> method is for convenience only."},{"content":"Because it does not have a return value, it cannot indicate whether revalidation has failed.","pos":[107,199]},{"content":"Revalidation can fail, for example, if the user credentials have changed on the server.","pos":[200,287]},{"content":"In this case, you might want to include code that explicitly validates users after a service call fails.","pos":[288,392]},{"content":"For more information, see the Accessing Web Settings section earlier in this walkthrough.","pos":[393,482]}]}]},{"content":"After revalidation, this code saves any changes to the local Web settings by calling the <ph id=\"ph1\">`SaveSettings`</ph> method that you added previously.","pos":[40968,41105],"source":"After revalidation, this code saves any changes to the local Web settings by calling the `SaveSettings` method that you added previously."},{"content":"It then retrieves any new values on the server by calling the <ph id=\"ph1\">&lt;xref:System.Configuration.ApplicationSettingsBase.Reload%2A&gt;</ph> method of the project's <ph id=\"ph2\">`Settings`</ph> class (accessed as <ph id=\"ph3\">`Properties.Settings.Default`</ph> in C# and <ph id=\"ph4\">`My.Settings`</ph> in <ph id=\"ph5\">[!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]</ph>).","pos":[41106,41393],"source":" It then retrieves any new values on the server by calling the <xref:System.Configuration.ApplicationSettingsBase.Reload%2A> method of the project's `Settings` class (accessed as `Properties.Settings.Default` in C# and `My.Settings` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)])."},{"pos":[41404,41695],"content":"[!code-csharp[ClientApplicationServices#080](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#080)]\n [!code-vb[ClientApplicationServices#080](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#080)]","leadings":["","    "],"nodes":[]},{"pos":[41705,41836],"content":"Add the following code to the end of the <ph id=\"ph1\">`Form1_Load`</ph> method to make sure that the check box displays the current connection state.","source":"Add the following code to the end of the `Form1_Load` method to make sure that the check box displays the current connection state."},{"pos":[41847,42138],"content":"[!code-csharp[ClientApplicationServices#014](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#014)]\n [!code-vb[ClientApplicationServices#014](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#014)]","leadings":["","    "],"nodes":[]},{"content":"This completes the example application.","pos":[42145,42184]},{"content":"To test the offline capability, run the application, log in as either employee or manager, and then select <bpt id=\"p1\">**</bpt>Work offline<ept id=\"p1\">**</ept>.","pos":[42185,42309],"source":" To test the offline capability, run the application, log in as either employee or manager, and then select **Work offline**."},{"content":"Modify the value in the text box, and then close the application.","pos":[42310,42375]},{"content":"Restart the application.","pos":[42376,42400]},{"content":"Before you log in, right-click the ASP.NET Development Server icon in the notification area of the taskbar and then click <bpt id=\"p1\">**</bpt>Stop<ept id=\"p1\">**</ept>.","pos":[42401,42532],"source":" Before you log in, right-click the ASP.NET Development Server icon in the notification area of the taskbar and then click **Stop**."},{"content":"Then, log in like normal.","pos":[42533,42558]},{"content":"Even when the server is not running, you can still log in.","pos":[42559,42617]},{"content":"Modify the text box value, exit, and restart to see the modified value.","pos":[42618,42689]},{"pos":[42698,42705],"content":"Summary","linkify":"Summary","nodes":[{"content":"Summary","pos":[0,7]}]},{"content":"In this walkthrough, you learned how to enable and use client application services in a Windows Forms application.","pos":[42709,42823]},{"content":"After setting up a test server, you added code to your application to authenticate users and retrieve user roles and application settings from the server.","pos":[42824,42978]},{"content":"You also learned how to enable offline mode so that your application uses a local data cache instead of the remote services when connectivity is not available.","pos":[42979,43138]},{"pos":[43147,43157],"content":"Next Steps","linkify":"Next Steps","nodes":[{"content":"Next Steps","pos":[0,10]}]},{"content":"In a real-world application, you will access data for many users from a remote server that may not always be available, or may go down without notice.","pos":[43161,43311]},{"content":"To make your application robust, you must respond appropriately to situations where the service is not available.","pos":[43312,43425]},{"content":"This walkthrough includes try/catch blocks to catch a <ph id=\"ph1\">&lt;xref:System.Net.WebException&gt;</ph> and display an error message when the service is not available.","pos":[43426,43574],"source":" This walkthrough includes try/catch blocks to catch a <xref:System.Net.WebException> and display an error message when the service is not available."},{"content":"In production code, you might want to handle this case by switching to offline mode, exiting the application, or denying access to specific functionality.","pos":[43575,43729]},{"content":"To increase the security of your application, make sure to thoroughly test the application and server before deployment.","pos":[43736,43856]},{"pos":[43865,43873],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Client Application Services<ept id=\"p1\">](../../../docs/framework/common-client-technologies/client-application-services.md)</ept><ph id=\"ph1\"> </ph>","pos":[43877,43990],"source":"[Client Application Services](../../../docs/framework/common-client-technologies/client-application-services.md) "},{"content":"<bpt id=\"p1\">[</bpt>Client Application Services Overview<ept id=\"p1\">](../../../docs/framework/common-client-technologies/client-application-services-overview.md)</ept><ph id=\"ph1\"> </ph>","pos":[43994,44125],"source":"[Client Application Services Overview](../../../docs/framework/common-client-technologies/client-application-services-overview.md) "},{"content":"<bpt id=\"p1\">[</bpt>How to: Configure Client Application Services<ept id=\"p1\">](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md)</ept><ph id=\"ph1\"> </ph>","pos":[44129,44277],"source":"[How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md) "},{"content":"<bpt id=\"p1\">[</bpt>ASP.NET Web Site Administration Tool<ept id=\"p1\">](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec)</ept><ph id=\"ph1\"> </ph>","pos":[44281,44392],"source":"[ASP.NET Web Site Administration Tool](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec) "},{"content":"<bpt id=\"p1\">[</bpt>Creating and Configuring the Application Services Database for SQL Server<ept id=\"p1\">](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2)</ept><ph id=\"ph1\"> </ph>","pos":[44396,44544],"source":"[Creating and Configuring the Application Services Database for SQL Server](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2) "},{"content":"<bpt id=\"p1\">[</bpt>Walkthrough: Using ASP.NET Application Services<ept id=\"p1\">](http://msdn.microsoft.com/library/f3f394f0-20d6-4361-aa8f-4b21bf4933eb)</ept>","pos":[44548,44669],"source":"[Walkthrough: Using ASP.NET Application Services](http://msdn.microsoft.com/library/f3f394f0-20d6-4361-aa8f-4b21bf4933eb)"}]}