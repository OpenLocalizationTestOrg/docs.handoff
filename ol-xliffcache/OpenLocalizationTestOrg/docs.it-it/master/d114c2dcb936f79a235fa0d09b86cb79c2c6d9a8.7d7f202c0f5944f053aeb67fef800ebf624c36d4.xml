{"content":"---\ntitle: \"Calling Synchronous Methods Asynchronously | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"asynchronous programming, delegates\"\n  - \"asynchronous delegates\"\n  - \"AsyncWaitHandle property\"\n  - \"callback methods\"\n  - \"calling synchronous methods in asynchronous manner\"\n  - \"WaitHandle class, code examples\"\n  - \"asynchronous programming, status polling\"\n  - \"polling asynchronous operation status\"\n  - \"delegates [.NET Framework], asynchronous\"\n  - \"synchronous calling in asynchronous manner\"\n  - \"waiting for asynchronous calls\"\n  - \"status information [.NET Framework], asynchronous operations\"\nms.assetid: 41972034-92ed-450a-9664-ab93fcc6f1fb\ncaps.latest.revision: 24\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# Calling Synchronous Methods Asynchronously\nThe .NET Framework enables you to call any method asynchronously. To do this you define a delegate with the same signature as the method you want to call; the common language runtime automatically defines `BeginInvoke` and `EndInvoke` methods for this delegate, with the appropriate signatures.  \n  \n> [!NOTE]\n>  Asynchronous delegate calls, specifically the `BeginInvoke` and `EndInvoke` methods, are not supported in the .NET Compact Framework.  \n  \n The `BeginInvoke` method initiates the asynchronous call. It has the same parameters as the method that you want to execute asynchronously, plus two additional optional parameters. The first parameter is an <xref:System.AsyncCallback> delegate that references a method to be called when the asynchronous call completes. The second parameter is a user-defined object that passes information into the callback method. `BeginInvoke` returns immediately and does not wait for the asynchronous call to complete. `BeginInvoke` returns an <xref:System.IAsyncResult>, which can be used to monitor the progress of the asynchronous call.  \n  \n The `EndInvoke` method retrieves the results of the asynchronous call. It can be called any time after `BeginInvoke`. If the asynchronous call has not completed, `EndInvoke` blocks the calling thread until it completes. The parameters of `EndInvoke` include the `out` and `ref` parameters (`<Out>` `ByRef` and `ByRef` in Visual Basic) of the method that you want to execute asynchronously, plus the <xref:System.IAsyncResult> returned by `BeginInvoke`.  \n  \n> [!NOTE]\n>  The IntelliSense feature in [!INCLUDE[vsprvslong](../../../includes/vsprvslong-md.md)] displays the parameters of `BeginInvoke` and `EndInvoke`. If you are not using Visual Studio or a similar tool, or if you are using C# with [!INCLUDE[vsprvslong](../../../includes/vsprvslong-md.md)], see [Asynchronous Programming Model (APM)](../../../docs/standard/asynchronous-programming-patterns/asynchronous-programming-model-apm.md) for a description of the parameters defined for these methods.  \n  \n The code examples in this topic demonstrate four common ways to use `BeginInvoke` and `EndInvoke` to make asynchronous calls. After calling `BeginInvoke` you can do the following:  \n  \n-   Do some work and then call `EndInvoke` to block until the call completes.  \n  \n-   Obtain a <xref:System.Threading.WaitHandle> using the <xref:System.IAsyncResult.AsyncWaitHandle%2A?displayProperty=fullName> property, use its <xref:System.Threading.WaitHandle.WaitOne%2A> method to block execution until the <xref:System.Threading.WaitHandle> is signaled, and then call `EndInvoke`.  \n  \n-   Poll the <xref:System.IAsyncResult> returned by `BeginInvoke` to determine when the asynchronous call has completed, and then call `EndInvoke`.  \n  \n-   Pass a delegate for a callback method to `BeginInvoke`. The method is executed on a <xref:System.Threading.ThreadPool> thread when the asynchronous call completes. The callback method calls `EndInvoke`.  \n  \n> [!IMPORTANT]\n>  No matter which technique you use, always call `EndInvoke` to complete your asynchronous call.  \n  \n## Defining the Test Method and Asynchronous Delegate  \n The code examples that follow demonstrate various ways of calling the same long-running method, `TestMethod`, asynchronously. The `TestMethod` method displays a console message to show that it has begun processing, sleeps for a few seconds, and then ends. `TestMethod` has an `out` parameter to demonstrate the way such parameters are added to the signatures of `BeginInvoke` and `EndInvoke`. You can handle `ref` parameters similarly.  \n  \n The following code example shows the definition of `TestMethod` and the delegate named `AsyncMethodCaller` that can be used to call `TestMethod` asynchronously. To compile the code examples, you must include the definitions for `TestMethod` and the `AsyncMethodCaller` delegate.  \n  \n [!code-cpp[AsyncDelegateExamples#1](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/TestMethod.cpp#1)]\n [!code-csharp[AsyncDelegateExamples#1](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/TestMethod.cs#1)]\n [!code-vb[AsyncDelegateExamples#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/TestMethod.vb#1)]  \n  \n## Waiting for an Asynchronous Call with EndInvoke  \n The simplest way to execute a method asynchronously is to start executing the method by calling the delegate's `BeginInvoke` method, do some work on the main thread, and then call the delegate's `EndInvoke` method. `EndInvoke` might block the calling thread because it does not return until the asynchronous call completes. This is a good technique to use with file or network operations.  \n  \n> [!IMPORTANT]\n>  Because `EndInvoke` might block, you should never call it from threads that service the user interface.  \n  \n [!code-cpp[AsyncDelegateExamples#2](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/EndInvoke.cpp#2)]\n [!code-csharp[AsyncDelegateExamples#2](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/EndInvoke.cs#2)]\n [!code-vb[AsyncDelegateExamples#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/EndInvoke.vb#2)]  \n  \n## Waiting for an Asynchronous Call with WaitHandle  \n You can obtain a <xref:System.Threading.WaitHandle> by using the <xref:System.IAsyncResult.AsyncWaitHandle%2A> property of the <xref:System.IAsyncResult> returned by `BeginInvoke`. The <xref:System.Threading.WaitHandle> is signaled when the asynchronous call completes, and you can wait for it by calling the <xref:System.Threading.WaitHandle.WaitOne%2A> method.  \n  \n If you use a <xref:System.Threading.WaitHandle>, you can perform additional processing before or after the asynchronous call completes, but before calling `EndInvoke` to retrieve the results.  \n  \n> [!NOTE]\n>  The wait handle is not closed automatically when you call `EndInvoke`. If you release all references to the wait handle, system resources are freed when garbage collection reclaims the wait handle. To free the system resources as soon as you are finished using the wait handle, dispose of it by calling the <xref:System.Threading.WaitHandle.Close%2A?displayProperty=fullName> method. Garbage collection works more efficiently when disposable objects are explicitly disposed.  \n  \n [!code-cpp[AsyncDelegateExamples#3](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/waithandle.cpp#3)]\n [!code-csharp[AsyncDelegateExamples#3](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/waithandle.cs#3)]\n [!code-vb[AsyncDelegateExamples#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/WaitHandle.vb#3)]  \n  \n## Polling for Asynchronous Call Completion  \n You can use the <xref:System.IAsyncResult.IsCompleted%2A> property of the <xref:System.IAsyncResult> returned by `BeginInvoke` to discover when the asynchronous call completes. You might do this when making the asynchronous call from a thread that services the user interface. Polling for completion allows the calling thread to continue executing while the asynchronous call executes on a <xref:System.Threading.ThreadPool> thread.  \n  \n [!code-cpp[AsyncDelegateExamples#4](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/polling.cpp#4)]\n [!code-csharp[AsyncDelegateExamples#4](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/polling.cs#4)]\n [!code-vb[AsyncDelegateExamples#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/polling.vb#4)]  \n  \n## Executing a Callback Method When an Asynchronous Call Completes  \n If the thread that initiates the asynchronous call does not need to be the thread that processes the results, you can execute a callback method when the call completes. The callback method is executed on a <xref:System.Threading.ThreadPool> thread.  \n  \n To use a callback method, you must pass `BeginInvoke` an <xref:System.AsyncCallback> delegate that represents the callback method. You can also pass an object that contains information to be used by the callback method. In the callback method, you can cast the <xref:System.IAsyncResult>, which is the only parameter of the callback method, to an <xref:System.Runtime.Remoting.Messaging.AsyncResult> object. You can then use the <xref:System.Runtime.Remoting.Messaging.AsyncResult.AsyncDelegate%2A?displayProperty=fullName> property to get the delegate that was used to initiate the call so that you can call `EndInvoke`.  \n  \n Notes on the example:  \n  \n-   The `threadId` parameter of `TestMethod` is an `out` parameter ([`<Out>` `ByRef` in Visual Basic), so its input value is never used by `TestMethod`. A dummy variable is passed to the `BeginInvoke` call. If the `threadId` parameter were a `ref` parameter (`ByRef` in Visual Basic), the variable would have to be a class-level field so that it could be passed to both `BeginInvoke` and `EndInvoke`.  \n  \n-   The state information that is passed to `BeginInvoke` is a format string, which the callback method uses to format an output message. Because it is passed as type <xref:System.Object>, the state information must be cast to its proper type before it can be used.  \n  \n-   The callback is made on a <xref:System.Threading.ThreadPool> thread. <xref:System.Threading.ThreadPool> threads are background threads, which do not keep the application running if the main thread ends, so the main thread of the example has to sleep long enough for the callback to finish.  \n  \n [!code-cpp[AsyncDelegateExamples#5](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/callback.cpp#5)]\n [!code-csharp[AsyncDelegateExamples#5](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/callback.cs#5)]\n [!code-vb[AsyncDelegateExamples#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/callback.vb#5)]  \n  \n## See Also  \n <xref:System.Delegate>   \n [Event-based Asynchronous Pattern (EAP)](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-eap.md)","nodes":[{"pos":[12,71],"content":"Calling Synchronous Methods Asynchronously | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Calling Synchronous Methods Asynchronously | Microsoft Docs","pos":[0,59]}]},{"pos":[896,938],"content":"Calling Synchronous Methods Asynchronously","linkify":"Calling Synchronous Methods Asynchronously","nodes":[{"content":"Calling Synchronous Methods Asynchronously","pos":[0,42]}]},{"content":"The .NET Framework enables you to call any method asynchronously.","pos":[939,1004]},{"content":"To do this you define a delegate with the same signature as the method you want to call; the common language runtime automatically defines <ph id=\"ph1\">`BeginInvoke`</ph> and <ph id=\"ph2\">`EndInvoke`</ph> methods for this delegate, with the appropriate signatures.","pos":[1005,1233],"source":" To do this you define a delegate with the same signature as the method you want to call; the common language runtime automatically defines `BeginInvoke` and `EndInvoke` methods for this delegate, with the appropriate signatures."},{"pos":[1241,1385],"content":"[!NOTE]\n Asynchronous delegate calls, specifically the `BeginInvoke` and `EndInvoke` methods, are not supported in the .NET Compact Framework.","leadings":["","> "],"nodes":[{"content":"Asynchronous delegate calls, specifically the <ph id=\"ph1\">`BeginInvoke`</ph> and <ph id=\"ph2\">`EndInvoke`</ph> methods, are not supported in the .NET Compact Framework.","pos":[9,142],"source":" Asynchronous delegate calls, specifically the `BeginInvoke` and `EndInvoke` methods, are not supported in the .NET Compact Framework."}]},{"content":"The <ph id=\"ph1\">`BeginInvoke`</ph> method initiates the asynchronous call.","pos":[1392,1449],"source":"The `BeginInvoke` method initiates the asynchronous call."},{"content":"It has the same parameters as the method that you want to execute asynchronously, plus two additional optional parameters.","pos":[1450,1572]},{"content":"The first parameter is an <ph id=\"ph1\">&lt;xref:System.AsyncCallback&gt;</ph> delegate that references a method to be called when the asynchronous call completes.","pos":[1573,1711],"source":" The first parameter is an <xref:System.AsyncCallback> delegate that references a method to be called when the asynchronous call completes."},{"content":"The second parameter is a user-defined object that passes information into the callback method.","pos":[1712,1807]},{"content":"<ph id=\"ph1\">`BeginInvoke`</ph> returns immediately and does not wait for the asynchronous call to complete.","pos":[1808,1898],"source":"`BeginInvoke` returns immediately and does not wait for the asynchronous call to complete."},{"content":"<ph id=\"ph1\">`BeginInvoke`</ph> returns an <ph id=\"ph2\">&lt;xref:System.IAsyncResult&gt;</ph>, which can be used to monitor the progress of the asynchronous call.","pos":[1899,2019],"source":"`BeginInvoke` returns an <xref:System.IAsyncResult>, which can be used to monitor the progress of the asynchronous call."},{"content":"The <ph id=\"ph1\">`EndInvoke`</ph> method retrieves the results of the asynchronous call.","pos":[2026,2096],"source":"The `EndInvoke` method retrieves the results of the asynchronous call."},{"content":"It can be called any time after <ph id=\"ph1\">`BeginInvoke`</ph>.","pos":[2097,2143],"source":" It can be called any time after `BeginInvoke`."},{"content":"If the asynchronous call has not completed, <ph id=\"ph1\">`EndInvoke`</ph> blocks the calling thread until it completes.","pos":[2144,2245],"source":" If the asynchronous call has not completed, `EndInvoke` blocks the calling thread until it completes."},{"content":"The parameters of <ph id=\"ph1\">`EndInvoke`</ph> include the <ph id=\"ph2\">`out`</ph> and <ph id=\"ph3\">`ref`</ph> parameters (<ph id=\"ph4\">`&lt;Out&gt;`</ph> <ph id=\"ph5\">`ByRef`</ph> and <ph id=\"ph6\">`ByRef`</ph> in Visual Basic) of the method that you want to execute asynchronously, plus the <ph id=\"ph7\">&lt;xref:System.IAsyncResult&gt;</ph> returned by <ph id=\"ph8\">`BeginInvoke`</ph>.","pos":[2246,2478],"source":" The parameters of `EndInvoke` include the `out` and `ref` parameters (`<Out>` `ByRef` and `ByRef` in Visual Basic) of the method that you want to execute asynchronously, plus the <xref:System.IAsyncResult> returned by `BeginInvoke`."},{"pos":[2486,2985],"content":"[!NOTE]\n The IntelliSense feature in [!INCLUDE[vsprvslong](../../../includes/vsprvslong-md.md)] displays the parameters of `BeginInvoke` and `EndInvoke`. If you are not using Visual Studio or a similar tool, or if you are using C# with [!INCLUDE[vsprvslong](../../../includes/vsprvslong-md.md)], see [Asynchronous Programming Model (APM)](../../../docs/standard/asynchronous-programming-patterns/asynchronous-programming-model-apm.md) for a description of the parameters defined for these methods.","leadings":["","> "],"nodes":[{"content":" The IntelliSense feature in [!INCLUDE[vsprvslong](../../../includes/vsprvslong-md.md)] displays the parameters of `BeginInvoke` and `EndInvoke`. If you are not using Visual Studio or a similar tool, or if you are using C# with [!INCLUDE[vsprvslong](../../../includes/vsprvslong-md.md)], see [Asynchronous Programming Model (APM)](../../../docs/standard/asynchronous-programming-patterns/asynchronous-programming-model-apm.md) for a description of the parameters defined for these methods.","pos":[8,497],"nodes":[{"content":"The IntelliSense feature in <ph id=\"ph1\">[!INCLUDE[vsprvslong](../../../includes/vsprvslong-md.md)]</ph> displays the parameters of <ph id=\"ph2\">`BeginInvoke`</ph> and <ph id=\"ph3\">`EndInvoke`</ph>.","pos":[1,145],"source":" The IntelliSense feature in [!INCLUDE[vsprvslong](../../../includes/vsprvslong-md.md)] displays the parameters of `BeginInvoke` and `EndInvoke`."},{"content":"If you are not using Visual Studio or a similar tool, or if you are using C# with <ph id=\"ph1\">[!INCLUDE[vsprvslong](../../../includes/vsprvslong-md.md)]</ph>, see <bpt id=\"p1\">[</bpt>Asynchronous Programming Model (APM)<ept id=\"p1\">](../../../docs/standard/asynchronous-programming-patterns/asynchronous-programming-model-apm.md)</ept> for a description of the parameters defined for these methods.","pos":[146,489],"source":" If you are not using Visual Studio or a similar tool, or if you are using C# with [!INCLUDE[vsprvslong](../../../includes/vsprvslong-md.md)], see [Asynchronous Programming Model (APM)](../../../docs/standard/asynchronous-programming-patterns/asynchronous-programming-model-apm.md) for a description of the parameters defined for these methods."}]}]},{"content":"The code examples in this topic demonstrate four common ways to use <ph id=\"ph1\">`BeginInvoke`</ph> and <ph id=\"ph2\">`EndInvoke`</ph> to make asynchronous calls.","pos":[2992,3117],"source":"The code examples in this topic demonstrate four common ways to use `BeginInvoke` and `EndInvoke` to make asynchronous calls."},{"content":"After calling <ph id=\"ph1\">`BeginInvoke`</ph> you can do the following:","pos":[3118,3171],"source":" After calling `BeginInvoke` you can do the following:"},{"pos":[3181,3254],"content":"Do some work and then call <ph id=\"ph1\">`EndInvoke`</ph> to block until the call completes.","source":"Do some work and then call `EndInvoke` to block until the call completes."},{"pos":[3264,3563],"content":"Obtain a <ph id=\"ph1\">&lt;xref:System.Threading.WaitHandle&gt;</ph> using the <ph id=\"ph2\">&lt;xref:System.IAsyncResult.AsyncWaitHandle%2A?displayProperty=fullName&gt;</ph> property, use its <ph id=\"ph3\">&lt;xref:System.Threading.WaitHandle.WaitOne%2A&gt;</ph> method to block execution until the <ph id=\"ph4\">&lt;xref:System.Threading.WaitHandle&gt;</ph> is signaled, and then call <ph id=\"ph5\">`EndInvoke`</ph>.","source":"Obtain a <xref:System.Threading.WaitHandle> using the <xref:System.IAsyncResult.AsyncWaitHandle%2A?displayProperty=fullName> property, use its <xref:System.Threading.WaitHandle.WaitOne%2A> method to block execution until the <xref:System.Threading.WaitHandle> is signaled, and then call `EndInvoke`."},{"pos":[3573,3716],"content":"Poll the <ph id=\"ph1\">&lt;xref:System.IAsyncResult&gt;</ph> returned by <ph id=\"ph2\">`BeginInvoke`</ph> to determine when the asynchronous call has completed, and then call <ph id=\"ph3\">`EndInvoke`</ph>.","source":"Poll the <xref:System.IAsyncResult> returned by `BeginInvoke` to determine when the asynchronous call has completed, and then call `EndInvoke`."},{"content":"Pass a delegate for a callback method to <ph id=\"ph1\">`BeginInvoke`</ph>.","pos":[3726,3781],"source":"Pass a delegate for a callback method to `BeginInvoke`."},{"content":"The method is executed on a <ph id=\"ph1\">&lt;xref:System.Threading.ThreadPool&gt;</ph> thread when the asynchronous call completes.","pos":[3782,3889],"source":" The method is executed on a <xref:System.Threading.ThreadPool> thread when the asynchronous call completes."},{"content":"The callback method calls <ph id=\"ph1\">`EndInvoke`</ph>.","pos":[3890,3928],"source":" The callback method calls `EndInvoke`."},{"pos":[3936,4046],"content":"[!IMPORTANT]\n No matter which technique you use, always call `EndInvoke` to complete your asynchronous call.","leadings":["","> "],"nodes":[{"content":"No matter which technique you use, always call <ph id=\"ph1\">`EndInvoke`</ph> to complete your asynchronous call.","pos":[14,108],"source":" No matter which technique you use, always call `EndInvoke` to complete your asynchronous call."}]},{"pos":[4055,4105],"content":"Defining the Test Method and Asynchronous Delegate","linkify":"Defining the Test Method and Asynchronous Delegate","nodes":[{"content":"Defining the Test Method and Asynchronous Delegate","pos":[0,50]}]},{"content":"The code examples that follow demonstrate various ways of calling the same long-running method, <ph id=\"ph1\">`TestMethod`</ph>, asynchronously.","pos":[4109,4234],"source":"The code examples that follow demonstrate various ways of calling the same long-running method, `TestMethod`, asynchronously."},{"content":"The <ph id=\"ph1\">`TestMethod`</ph> method displays a console message to show that it has begun processing, sleeps for a few seconds, and then ends.","pos":[4235,4364],"source":" The `TestMethod` method displays a console message to show that it has begun processing, sleeps for a few seconds, and then ends."},{"content":"<ph id=\"ph1\">`TestMethod`</ph> has an <ph id=\"ph2\">`out`</ph> parameter to demonstrate the way such parameters are added to the signatures of <ph id=\"ph3\">`BeginInvoke`</ph> and <ph id=\"ph4\">`EndInvoke`</ph>.","pos":[4365,4501],"source":"`TestMethod` has an `out` parameter to demonstrate the way such parameters are added to the signatures of `BeginInvoke` and `EndInvoke`."},{"content":"You can handle <ph id=\"ph1\">`ref`</ph> parameters similarly.","pos":[4502,4544],"source":" You can handle `ref` parameters similarly."},{"content":"The following code example shows the definition of <ph id=\"ph1\">`TestMethod`</ph> and the delegate named <ph id=\"ph2\">`AsyncMethodCaller`</ph> that can be used to call <ph id=\"ph3\">`TestMethod`</ph> asynchronously.","pos":[4551,4711],"source":"The following code example shows the definition of `TestMethod` and the delegate named `AsyncMethodCaller` that can be used to call `TestMethod` asynchronously."},{"content":"To compile the code examples, you must include the definitions for <ph id=\"ph1\">`TestMethod`</ph> and the <ph id=\"ph2\">`AsyncMethodCaller`</ph> delegate.","pos":[4712,4829],"source":" To compile the code examples, you must include the definitions for `TestMethod` and the `AsyncMethodCaller` delegate."},{"pos":[4836,5227],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>AsyncDelegateExamples#1<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/TestMethod.cpp#1)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>AsyncDelegateExamples#1<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/TestMethod.cs#1)</ept><ept id=\"p3\">]</ept> <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>AsyncDelegateExamples#1<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/TestMethod.vb#1)</ept><ept id=\"p5\">]</ept>","source":"[!code-cpp[AsyncDelegateExamples#1](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/TestMethod.cpp#1)]\n [!code-csharp[AsyncDelegateExamples#1](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/TestMethod.cs#1)]\n [!code-vb[AsyncDelegateExamples#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/TestMethod.vb#1)]"},{"pos":[5236,5283],"content":"Waiting for an Asynchronous Call with EndInvoke","linkify":"Waiting for an Asynchronous Call with EndInvoke","nodes":[{"content":"Waiting for an Asynchronous Call with EndInvoke","pos":[0,47]}]},{"content":"The simplest way to execute a method asynchronously is to start executing the method by calling the delegate's <ph id=\"ph1\">`BeginInvoke`</ph> method, do some work on the main thread, and then call the delegate's <ph id=\"ph2\">`EndInvoke`</ph> method.","pos":[5287,5501],"source":"The simplest way to execute a method asynchronously is to start executing the method by calling the delegate's `BeginInvoke` method, do some work on the main thread, and then call the delegate's `EndInvoke` method."},{"content":"<ph id=\"ph1\">`EndInvoke`</ph> might block the calling thread because it does not return until the asynchronous call completes.","pos":[5502,5610],"source":"`EndInvoke` might block the calling thread because it does not return until the asynchronous call completes."},{"content":"This is a good technique to use with file or network operations.","pos":[5611,5675]},{"pos":[5683,5802],"content":"[!IMPORTANT]\n Because `EndInvoke` might block, you should never call it from threads that service the user interface.","leadings":["","> "],"nodes":[{"content":"Because <ph id=\"ph1\">`EndInvoke`</ph> might block, you should never call it from threads that service the user interface.","pos":[14,117],"source":" Because `EndInvoke` might block, you should never call it from threads that service the user interface."}]},{"pos":[5809,6197],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>AsyncDelegateExamples#2<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/EndInvoke.cpp#2)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>AsyncDelegateExamples#2<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/EndInvoke.cs#2)</ept><ept id=\"p3\">]</ept> <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>AsyncDelegateExamples#2<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/EndInvoke.vb#2)</ept><ept id=\"p5\">]</ept>","source":"[!code-cpp[AsyncDelegateExamples#2](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/EndInvoke.cpp#2)]\n [!code-csharp[AsyncDelegateExamples#2](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/EndInvoke.cs#2)]\n [!code-vb[AsyncDelegateExamples#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/EndInvoke.vb#2)]"},{"pos":[6206,6254],"content":"Waiting for an Asynchronous Call with WaitHandle","linkify":"Waiting for an Asynchronous Call with WaitHandle","nodes":[{"content":"Waiting for an Asynchronous Call with WaitHandle","pos":[0,48]}]},{"content":"You can obtain a <ph id=\"ph1\">&lt;xref:System.Threading.WaitHandle&gt;</ph> by using the <ph id=\"ph2\">&lt;xref:System.IAsyncResult.AsyncWaitHandle%2A&gt;</ph> property of the <ph id=\"ph3\">&lt;xref:System.IAsyncResult&gt;</ph> returned by <ph id=\"ph4\">`BeginInvoke`</ph>.","pos":[6258,6438],"source":"You can obtain a <xref:System.Threading.WaitHandle> by using the <xref:System.IAsyncResult.AsyncWaitHandle%2A> property of the <xref:System.IAsyncResult> returned by `BeginInvoke`."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Threading.WaitHandle&gt;</ph> is signaled when the asynchronous call completes, and you can wait for it by calling the <ph id=\"ph2\">&lt;xref:System.Threading.WaitHandle.WaitOne%2A&gt;</ph> method.","pos":[6439,6620],"source":" The <xref:System.Threading.WaitHandle> is signaled when the asynchronous call completes, and you can wait for it by calling the <xref:System.Threading.WaitHandle.WaitOne%2A> method."},{"pos":[6627,6818],"content":"If you use a <ph id=\"ph1\">&lt;xref:System.Threading.WaitHandle&gt;</ph>, you can perform additional processing before or after the asynchronous call completes, but before calling <ph id=\"ph2\">`EndInvoke`</ph> to retrieve the results.","source":"If you use a <xref:System.Threading.WaitHandle>, you can perform additional processing before or after the asynchronous call completes, but before calling `EndInvoke` to retrieve the results."},{"pos":[6826,7311],"content":"[!NOTE]\n The wait handle is not closed automatically when you call `EndInvoke`. If you release all references to the wait handle, system resources are freed when garbage collection reclaims the wait handle. To free the system resources as soon as you are finished using the wait handle, dispose of it by calling the <xref:System.Threading.WaitHandle.Close%2A?displayProperty=fullName> method. Garbage collection works more efficiently when disposable objects are explicitly disposed.","leadings":["","> "],"nodes":[{"content":" The wait handle is not closed automatically when you call `EndInvoke`. If you release all references to the wait handle, system resources are freed when garbage collection reclaims the wait handle. To free the system resources as soon as you are finished using the wait handle, dispose of it by calling the <xref:System.Threading.WaitHandle.Close%2A?displayProperty=fullName> method. Garbage collection works more efficiently when disposable objects are explicitly disposed.","pos":[8,483],"nodes":[{"content":"The wait handle is not closed automatically when you call <ph id=\"ph1\">`EndInvoke`</ph>.","pos":[1,71],"source":" The wait handle is not closed automatically when you call `EndInvoke`."},{"content":"If you release all references to the wait handle, system resources are freed when garbage collection reclaims the wait handle.","pos":[72,198]},{"content":"To free the system resources as soon as you are finished using the wait handle, dispose of it by calling the <ph id=\"ph1\">&lt;xref:System.Threading.WaitHandle.Close%2A?displayProperty=fullName&gt;</ph> method.","pos":[199,384],"source":" To free the system resources as soon as you are finished using the wait handle, dispose of it by calling the <xref:System.Threading.WaitHandle.Close%2A?displayProperty=fullName> method."},{"content":"Garbage collection works more efficiently when disposable objects are explicitly disposed.","pos":[385,475]}]}]},{"pos":[7318,7709],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>AsyncDelegateExamples#3<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/waithandle.cpp#3)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>AsyncDelegateExamples#3<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/waithandle.cs#3)</ept><ept id=\"p3\">]</ept> <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>AsyncDelegateExamples#3<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/WaitHandle.vb#3)</ept><ept id=\"p5\">]</ept>","source":"[!code-cpp[AsyncDelegateExamples#3](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/waithandle.cpp#3)]\n [!code-csharp[AsyncDelegateExamples#3](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/waithandle.cs#3)]\n [!code-vb[AsyncDelegateExamples#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/WaitHandle.vb#3)]"},{"pos":[7718,7758],"content":"Polling for Asynchronous Call Completion","linkify":"Polling for Asynchronous Call Completion","nodes":[{"content":"Polling for Asynchronous Call Completion","pos":[0,40]}]},{"content":"You can use the <ph id=\"ph1\">&lt;xref:System.IAsyncResult.IsCompleted%2A&gt;</ph> property of the <ph id=\"ph2\">&lt;xref:System.IAsyncResult&gt;</ph> returned by <ph id=\"ph3\">`BeginInvoke`</ph> to discover when the asynchronous call completes.","pos":[7762,7938],"source":"You can use the <xref:System.IAsyncResult.IsCompleted%2A> property of the <xref:System.IAsyncResult> returned by `BeginInvoke` to discover when the asynchronous call completes."},{"content":"You might do this when making the asynchronous call from a thread that services the user interface.","pos":[7939,8038]},{"content":"Polling for completion allows the calling thread to continue executing while the asynchronous call executes on a <ph id=\"ph1\">&lt;xref:System.Threading.ThreadPool&gt;</ph> thread.","pos":[8039,8194],"source":" Polling for completion allows the calling thread to continue executing while the asynchronous call executes on a <xref:System.Threading.ThreadPool> thread."},{"pos":[8201,8583],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>AsyncDelegateExamples#4<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/polling.cpp#4)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>AsyncDelegateExamples#4<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/polling.cs#4)</ept><ept id=\"p3\">]</ept> <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>AsyncDelegateExamples#4<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/polling.vb#4)</ept><ept id=\"p5\">]</ept>","source":"[!code-cpp[AsyncDelegateExamples#4](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/polling.cpp#4)]\n [!code-csharp[AsyncDelegateExamples#4](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/polling.cs#4)]\n [!code-vb[AsyncDelegateExamples#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/polling.vb#4)]"},{"pos":[8592,8655],"content":"Executing a Callback Method When an Asynchronous Call Completes","linkify":"Executing a Callback Method When an Asynchronous Call Completes","nodes":[{"content":"Executing a Callback Method When an Asynchronous Call Completes","pos":[0,63]}]},{"content":"If the thread that initiates the asynchronous call does not need to be the thread that processes the results, you can execute a callback method when the call completes.","pos":[8659,8827]},{"content":"The callback method is executed on a <ph id=\"ph1\">&lt;xref:System.Threading.ThreadPool&gt;</ph> thread.","pos":[8828,8907],"source":" The callback method is executed on a <xref:System.Threading.ThreadPool> thread."},{"content":"To use a callback method, you must pass <ph id=\"ph1\">`BeginInvoke`</ph> an <ph id=\"ph2\">&lt;xref:System.AsyncCallback&gt;</ph> delegate that represents the callback method.","pos":[8914,9044],"source":"To use a callback method, you must pass `BeginInvoke` an <xref:System.AsyncCallback> delegate that represents the callback method."},{"content":"You can also pass an object that contains information to be used by the callback method.","pos":[9045,9133]},{"content":"In the callback method, you can cast the <ph id=\"ph1\">&lt;xref:System.IAsyncResult&gt;</ph>, which is the only parameter of the callback method, to an <ph id=\"ph2\">&lt;xref:System.Runtime.Remoting.Messaging.AsyncResult&gt;</ph> object.","pos":[9134,9321],"source":" In the callback method, you can cast the <xref:System.IAsyncResult>, which is the only parameter of the callback method, to an <xref:System.Runtime.Remoting.Messaging.AsyncResult> object."},{"content":"You can then use the <ph id=\"ph1\">&lt;xref:System.Runtime.Remoting.Messaging.AsyncResult.AsyncDelegate%2A?displayProperty=fullName&gt;</ph> property to get the delegate that was used to initiate the call so that you can call <ph id=\"ph2\">`EndInvoke`</ph>.","pos":[9322,9535],"source":" You can then use the <xref:System.Runtime.Remoting.Messaging.AsyncResult.AsyncDelegate%2A?displayProperty=fullName> property to get the delegate that was used to initiate the call so that you can call `EndInvoke`."},{"content":"Notes on the example:","pos":[9542,9563]},{"content":"The <ph id=\"ph1\">`threadId`</ph> parameter of <ph id=\"ph2\">`TestMethod`</ph> is an <ph id=\"ph3\">`out`</ph> parameter ([<ph id=\"ph4\">`&lt;Out&gt;`</ph> <ph id=\"ph5\">`ByRef`</ph> in Visual Basic), so its input value is never used by <ph id=\"ph6\">`TestMethod`</ph>.","pos":[9573,9721],"source":"The `threadId` parameter of `TestMethod` is an `out` parameter ([`<Out>` `ByRef` in Visual Basic), so its input value is never used by `TestMethod`."},{"content":"A dummy variable is passed to the <ph id=\"ph1\">`BeginInvoke`</ph> call.","pos":[9722,9775],"source":" A dummy variable is passed to the `BeginInvoke` call."},{"content":"If the <ph id=\"ph1\">`threadId`</ph> parameter were a <ph id=\"ph2\">`ref`</ph> parameter (<ph id=\"ph3\">`ByRef`</ph> in Visual Basic), the variable would have to be a class-level field so that it could be passed to both <ph id=\"ph4\">`BeginInvoke`</ph> and <ph id=\"ph5\">`EndInvoke`</ph>.","pos":[9776,9969],"source":" If the `threadId` parameter were a `ref` parameter (`ByRef` in Visual Basic), the variable would have to be a class-level field so that it could be passed to both `BeginInvoke` and `EndInvoke`."},{"content":"The state information that is passed to <ph id=\"ph1\">`BeginInvoke`</ph> is a format string, which the callback method uses to format an output message.","pos":[9979,10112],"source":"The state information that is passed to `BeginInvoke` is a format string, which the callback method uses to format an output message."},{"content":"Because it is passed as type <ph id=\"ph1\">&lt;xref:System.Object&gt;</ph>, the state information must be cast to its proper type before it can be used.","pos":[10113,10240],"source":" Because it is passed as type <xref:System.Object>, the state information must be cast to its proper type before it can be used."},{"content":"The callback is made on a <ph id=\"ph1\">&lt;xref:System.Threading.ThreadPool&gt;</ph> thread.","pos":[10250,10318],"source":"The callback is made on a <xref:System.Threading.ThreadPool> thread."},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.ThreadPool&gt;</ph> threads are background threads, which do not keep the application running if the main thread ends, so the main thread of the example has to sleep long enough for the callback to finish.","pos":[10319,10539],"source":"<xref:System.Threading.ThreadPool> threads are background threads, which do not keep the application running if the main thread ends, so the main thread of the example has to sleep long enough for the callback to finish."},{"pos":[10546,10931],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>AsyncDelegateExamples#5<ept id=\"p2\">](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/callback.cpp#5)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>AsyncDelegateExamples#5<ept id=\"p4\">](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/callback.cs#5)</ept><ept id=\"p3\">]</ept> <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>AsyncDelegateExamples#5<ept id=\"p6\">](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/callback.vb#5)</ept><ept id=\"p5\">]</ept>","leadings":[""," "," "],"source":"[!code-cpp[AsyncDelegateExamples#5](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/callback.cpp#5)]\n[!code-csharp[AsyncDelegateExamples#5](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/callback.cs#5)]\n[!code-vb[AsyncDelegateExamples#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/callback.vb#5)]"},{"pos":[10940,10948],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\"> [</bpt>Event-based Asynchronous Pattern (EAP)<ept id=\"p1\">](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-eap.md)</ept>","pos":[10978,11117],"source":" [Event-based Asynchronous Pattern (EAP)](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-eap.md)"}]}