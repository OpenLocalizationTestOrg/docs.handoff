{"content":"---\ntitle: \"contextSwitchDeadlock MDA | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\n  - \"CSharp\"\n  - \"C++\"\n  - \"jsharp\"\nhelpviewer_keywords: \n  - \"deadlocks [.NET Framework]\"\n  - \"pumping messages\"\n  - \"STA message pumping\"\n  - \"single-threaded COM components\"\n  - \"MDAs (managed debugging assistants), context switching deadlocks\"\n  - \"managed debugging assistants (MDAs), context switching deadlocks\"\n  - \"ContextSwitchDeadlock MDA\"\n  - \"message pumping\"\n  - \"context switching deadlocks\"\nms.assetid: 26dfaa15-9ddb-4b0a-b6da-999bba664fa6\ncaps.latest.revision: 22\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"\n---\n# contextSwitchDeadlock MDA\nThe `contextSwitchDeadlock` managed debugging assistant (MDA) is activated when a deadlock is detected during an attempted COM context transition.  \n  \n## Symptoms  \n The most common symptom is that a call on an unmanaged COM component from managed code does not return.  Another symptom is memory usage increasing over time.  \n  \n## Cause  \n The most probable cause is that a single-threaded apartment (STA) thread is not pumping messages. The STA thread is either waiting without pumping messages or is performing lengthy operations and is not allowing the message queue to pump.  \n  \n Memory usage increasing over time is caused by the finalizer thread attempting to call `Release` on an unmanaged COM component and that component is not returning.  This prevents the finalizer from reclaiming other objects.  \n  \n By default, the threading model for the main thread of Visual Basic console applications is STA. This MDA is activated if an STA thread uses COM interoperability either directly or indirectly through the common language runtime or a third-party control.  To avoid activating this MDA in a Visual Basic console application, apply the <xref:System.MTAThreadAttribute> attribute to the main method or modify the application to pump messages.  \n  \n It is possible for this MDA to be falsely activated when all of the following conditions are met:  \n  \n-   An application creates COM components from STA threads either directly or indirectly through libraries.  \n  \n-   The application was stopped in the debugger and the user either continued the application or performed a step operation.  \n  \n-   Unmanaged debugging is not enabled.  \n  \n To determine if the MDA is being falsely activated, disable all breakpoints, restart the application, and allow it to run without stopping. If the MDA is not activated, it is likely the initial activation was false. In this case, disable the MDA to avoid interference with the debugging session.  \n  \n> [!NOTE]\n>  This MDA is in the default set for [!INCLUDE[vsprvslong](../../../includes/vsprvslong-md.md)] and later versions. When the hosting process is enabled in [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], you cannot disable MDAs that are in the default set. The hosting process is enabled by default, so it must be explicitly disabled. For information about how to disable MDAs, see \"Enabling and Disabling MDAs\" in [Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md).  \n  \n## Resolution  \n Follow COM rules regarding STA message pumping.  \n  \n## Effect on the Runtime  \n This MDA has no effect on the CLR. It only reports data about COM contexts.  \n  \n## Output  \n A message describing the current context and the target context.  \n  \n## Configuration  \n  \n```  \n<mdaConfig>  \n  <assistants>  \n    <contextSwitchDeadlock />  \n  </assistants>  \n</mdaConfig>  \n```  \n  \n## See Also  \n <xref:System.Runtime.InteropServices.MarshalAsAttribute>   \n [Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)   \n [Interop Marshaling](../../../docs/framework/interop/interop-marshaling.md)","nodes":[{"pos":[4,776],"nodes":[{"content":"contextSwitchDeadlock MDA | Microsoft Docs","nodes":[{"pos":[0,42],"content":"contextSwitchDeadlock MDA | Microsoft Docs","nodes":[{"content":"contextSwitchDeadlock MDA | Microsoft Docs","pos":[0,42]}]}],"pos":[6,51],"yaml":true}],"content":"title: \"contextSwitchDeadlock MDA | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\n  - \"CSharp\"\n  - \"C++\"\n  - \"jsharp\"\nhelpviewer_keywords: \n  - \"deadlocks [.NET Framework]\"\n  - \"pumping messages\"\n  - \"STA message pumping\"\n  - \"single-threaded COM components\"\n  - \"MDAs (managed debugging assistants), context switching deadlocks\"\n  - \"managed debugging assistants (MDAs), context switching deadlocks\"\n  - \"ContextSwitchDeadlock MDA\"\n  - \"message pumping\"\n  - \"context switching deadlocks\"\nms.assetid: 26dfaa15-9ddb-4b0a-b6da-999bba664fa6\ncaps.latest.revision: 22\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"","yamlblock":true},{"pos":[783,808],"content":"contextSwitchDeadlock MDA","linkify":"contextSwitchDeadlock MDA","nodes":[{"content":"contextSwitchDeadlock MDA","pos":[0,25]}]},{"pos":[809,955],"content":"The <ph id=\"ph1\">`contextSwitchDeadlock`</ph> managed debugging assistant (MDA) is activated when a deadlock is detected during an attempted COM context transition.","source":"The `contextSwitchDeadlock` managed debugging assistant (MDA) is activated when a deadlock is detected during an attempted COM context transition."},{"pos":[964,972],"content":"Symptoms","linkify":"Symptoms","nodes":[{"content":"Symptoms","pos":[0,8]}]},{"content":"The most common symptom is that a call on an unmanaged COM component from managed code does not return.","pos":[976,1079]},{"content":"Another symptom is memory usage increasing over time.","pos":[1081,1134]},{"pos":[1143,1148],"content":"Cause","linkify":"Cause","nodes":[{"content":"Cause","pos":[0,5]}]},{"content":"The most probable cause is that a single-threaded apartment (STA) thread is not pumping messages.","pos":[1152,1249]},{"content":"The STA thread is either waiting without pumping messages or is performing lengthy operations and is not allowing the message queue to pump.","pos":[1250,1390]},{"content":"Memory usage increasing over time is caused by the finalizer thread attempting to call <ph id=\"ph1\">`Release`</ph> on an unmanaged COM component and that component is not returning.","pos":[1397,1560],"source":"Memory usage increasing over time is caused by the finalizer thread attempting to call `Release` on an unmanaged COM component and that component is not returning."},{"content":"This prevents the finalizer from reclaiming other objects.","pos":[1562,1620]},{"content":"By default, the threading model for the main thread of Visual Basic console applications is STA.","pos":[1627,1723]},{"content":"This MDA is activated if an STA thread uses COM interoperability either directly or indirectly through the common language runtime or a third-party control.","pos":[1724,1880]},{"content":"To avoid activating this MDA in a Visual Basic console application, apply the <ph id=\"ph1\">&lt;xref:System.MTAThreadAttribute&gt;</ph> attribute to the main method or modify the application to pump messages.","pos":[1882,2065],"source":"  To avoid activating this MDA in a Visual Basic console application, apply the <xref:System.MTAThreadAttribute> attribute to the main method or modify the application to pump messages."},{"content":"It is possible for this MDA to be falsely activated when all of the following conditions are met:","pos":[2072,2169]},{"content":"An application creates COM components from STA threads either directly or indirectly through libraries.","pos":[2179,2282]},{"content":"The application was stopped in the debugger and the user either continued the application or performed a step operation.","pos":[2292,2412]},{"content":"Unmanaged debugging is not enabled.","pos":[2422,2457]},{"content":"To determine if the MDA is being falsely activated, disable all breakpoints, restart the application, and allow it to run without stopping.","pos":[2464,2603]},{"content":"If the MDA is not activated, it is likely the initial activation was false.","pos":[2604,2679]},{"content":"In this case, disable the MDA to avoid interference with the debugging session.","pos":[2680,2759]},{"pos":[2767,3348],"content":"[!NOTE]\n This MDA is in the default set for [!INCLUDE[vsprvslong](../../../includes/vsprvslong-md.md)] and later versions. When the hosting process is enabled in [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], you cannot disable MDAs that are in the default set. The hosting process is enabled by default, so it must be explicitly disabled. For information about how to disable MDAs, see \"Enabling and Disabling MDAs\" in [Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md).","leadings":["","> "],"nodes":[{"content":"This MDA is in the default set for [!INCLUDE[vsprvslong](../../../includes/vsprvslong-md.md)] and later versions. When the hosting process is enabled in [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], you cannot disable MDAs that are in the default set. The hosting process is enabled by default, so it must be explicitly disabled. For information about how to disable MDAs, see \"Enabling and Disabling MDAs\" in [Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md).","pos":[9,579],"nodes":[{"content":"This MDA is in the default set for <ph id=\"ph1\">[!INCLUDE[vsprvslong](../../../includes/vsprvslong-md.md)]</ph> and later versions.","pos":[0,113],"source":"This MDA is in the default set for [!INCLUDE[vsprvslong](../../../includes/vsprvslong-md.md)] and later versions."},{"content":"When the hosting process is enabled in <ph id=\"ph1\">[!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]</ph>, you cannot disable MDAs that are in the default set.","pos":[114,257],"source":" When the hosting process is enabled in [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], you cannot disable MDAs that are in the default set."},{"content":"The hosting process is enabled by default, so it must be explicitly disabled.","pos":[258,335]},{"content":"For information about how to disable MDAs, see \"Enabling and Disabling MDAs\" in <bpt id=\"p1\">[</bpt>Diagnosing Errors with Managed Debugging Assistants<ept id=\"p1\">](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)</ept>.","pos":[336,570],"source":" For information about how to disable MDAs, see \"Enabling and Disabling MDAs\" in [Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)."}]}]},{"pos":[3357,3367],"content":"Resolution","linkify":"Resolution","nodes":[{"content":"Resolution","pos":[0,10]}]},{"content":"Follow COM rules regarding STA message pumping.","pos":[3371,3418]},{"pos":[3427,3448],"content":"Effect on the Runtime","linkify":"Effect on the Runtime","nodes":[{"content":"Effect on the Runtime","pos":[0,21]}]},{"content":"This MDA has no effect on the CLR.","pos":[3452,3486]},{"content":"It only reports data about COM contexts.","pos":[3487,3527]},{"pos":[3536,3542],"content":"Output","linkify":"Output","nodes":[{"content":"Output","pos":[0,6]}]},{"content":"A message describing the current context and the target context.","pos":[3546,3610]},{"pos":[3619,3632],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"pos":[3752,3760],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute&gt;</ph>","pos":[3764,3820],"source":"<xref:System.Runtime.InteropServices.MarshalAsAttribute> "},{"content":"<bpt id=\"p1\">[</bpt>Diagnosing Errors with Managed Debugging Assistants<ept id=\"p1\">](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)</ept><ph id=\"ph1\"> </ph>","pos":[3825,3979],"source":"[Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md) "},{"content":"<bpt id=\"p1\">[</bpt>Interop Marshaling<ept id=\"p1\">](../../../docs/framework/interop/interop-marshaling.md)</ept>","pos":[3983,4058],"source":"[Interop Marshaling](../../../docs/framework/interop/interop-marshaling.md)"}]}