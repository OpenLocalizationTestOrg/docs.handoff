{"content":"---\ntitle: \"DynamicActivity Creation | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: d8ebe82f-98c8-4452-aed7-2c60a512b097\ncaps.latest.revision: 14\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# DynamicActivity Creation\nThis sample demonstrates two different ways to create an activity at runtime using the <xref:System.Activities.DynamicActivity> activity.  \n  \n In this sample, an activity is created at runtime with a body that contains a <xref:System.Activities.Statements.Sequence> activity that contains <xref:System.Activities.Statements.ForEach%601> and <xref:System.Activities.Statements.Assign%601> activities. An input list of integers is passed into the activity and set as a property. The <xref:System.Activities.Statements.ForEach%601> activity then iterates over the list of values and accumulates it. In the <xref:System.Activities.Statements.Assign%601> activity, the average value is calculated by dividing the accumulator by the number of elements in the list and assign it to the average.  \n  \n The sample demonstrates the usage of a <xref:System.Activities.DynamicActivity> activity that flows in variables as input arguments and returning values as output arguments. The activity has one input argument named `Numbers` that is a list of integers. The <xref:System.Activities.Statements.ForEach%601> activity iterates over the list of values and accumulates it. In the <xref:System.Activities.Statements.Assign%601> activity, the average value is calculated by dividing the accumulator by the number of elements in the list and assigning it to the average. The average is returned as an output argument named `Average`.  \n  \n When the dynamic activity is created programmatically, the input and output are declared as shown in the following code example.  \n  \n```csharp  \nDynamicActivity act = new DynamicActivity()  \n{  \n    DisplayName = \"Find average\",  \n    Properties =   \n    {  \n        // Input argument  \n        new DynamicActivityProperty  \n        {  \n            Name = \"Numbers\",  \n            Type = typeof(InArgument<List<int>>),  \n            Value = numbers  \n        },  \n        // Output argument  \n        new DynamicActivityProperty  \n        {  \n            Name = \"Average\",  \n            Type = typeof(OutArgument<double>),  \n            Value = average  \n        }  \n    },  \n};  \n  \n```  \n  \n The following code example shows the complete definition of the `DynamicActivity` that computes the average of the values in a list.  \n  \n```  \nDynamicActivity act = new DynamicActivity()  \n{  \n    DisplayName = \"Find average\",  \n    Properties =   \n    {  \n        // Input argument  \n        new DynamicActivityProperty  \n        {  \n            Name = \"Numbers\",  \n            Type = typeof(InArgument<List<int>>),  \n            Value = numbers  \n        },  \n        // Output argument  \n        new DynamicActivityProperty  \n        {  \n            Name = \"Average\",  \n            Type = typeof(OutArgument<double>),  \n            Value = average  \n        }  \n    },  \n    Implementation = () =>  \n        new Sequence  \n        {  \n            Variables = { result, accumulator },  \n            Activities =  \n            {  \n                new ForEach<int>  \n                {  \n                    Values =  new ArgumentValue<IEnumerable<int>> { ArgumentName = \"Numbers\" },                                  \n                    Body = new ActivityAction<int>  \n                    {  \n                        Argument = iterationVariable,  \n                        Handler = new Assign<int>  \n                        {  \n                            To = accumulator,  \n                            Value = new InArgument<int>(env => iterationVariable.Get(env) +  accumulator.Get(env))  \n                        }  \n                    }  \n                },  \n  \n                // Calculate the average and assign to the output argument.  \n                new Assign<double>  \n                {  \n                    To = new ArgumentReference<double> { ArgumentName = \"Average\" },  \n                    Value = new InArgument<double>(env => accumulator.Get(env) / numbers.Get(env).Count<int>())  \n                },  \n            }  \n        }  \n};  \n```  \n  \n When created in XAML, the input and output are declared as shown in the following example.  \n  \n```  \n<Activity x:Class=\"Microsoft.Samples.DynamicActivityCreation.FindAverage\"  \n          xmlns=\"http://schemas.microsoft.com/netfx/2009/xaml/activities\"  \n          xmlns:scg=\"clr-namespace:System.Collections.Generic;assembly=mscorlib\"  \n          xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\">  \n  <x:Members>  \n    <x:Property Name=\"Numbers\" Type=\"InArgument(scg:List(x:Int32))\" />  \n    <x:Property Name=\"Average\" Type=\"OutArgument(x:Double)\" />  \n  </x:Members>  \n    ...  \n    ...  \n</Activity>  \n```  \n  \n The XAML can be created visually using the [!INCLUDE[wfd1](../../../../includes/wfd1-md.md)]. If it is included in a Visual Studio project, be sure to set its \"Build Action\" to \"None\" to prevent it from being compiled. The XAML can then be loaded dynamically using the following call.  \n  \n```  \nActivity act2 = ActivityXamlServices.Load(@\"FindAverage.xaml\");  \n  \n```  \n  \n The <xref:System.Activities.DynamicActivity> instance created programmatically or through loading a XAML workflow can be used as shown in the following code example. Please note that \"act\" passed to the `WorkflowInvoker.Invoke` is the \"act\" <xref:System.Activities.Activity> defined in the first code example.  \n  \n```  \nIDictionary<string, object> results = WorkflowInvoker.Invoke(act, new Dictionary<string, object> { { \"Numbers\", numbers } });  \n  \nConsole.WriteLine(\"The average calculated using the code activity is = \" + results[\"Average\"]);  \n  \n```  \n  \n#### To use this sample  \n  \n1.  Using [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)], open the DynamicActivityCreation.sln solution file.  \n  \n2.  To build the solution, press CTRL+SHIFT+B.  \n  \n3.  To run the solution, press CTRL+F5.  \n  \n## Command line arguments  \n This sample accepts command line arguments. Users can provide a list of numbers for the activity to calculate their average. The list of numbers to be used is passed as a list of numbers separated by a space. For example, to calculate the average of 5, 10, and 32 invoke the sample using the following command line.  \n  \n **DynamicActivityCreation 5 10 32**   \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Basic\\Built-InActivities\\DynamicActivity\\DynamicActivityCreation`  \n  \n## See Also","nodes":[{"pos":[12,53],"content":"DynamicActivity Creation | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"DynamicActivity Creation | Microsoft Docs","pos":[0,41]}]},{"pos":[319,343],"content":"DynamicActivity Creation","linkify":"DynamicActivity Creation","nodes":[{"content":"DynamicActivity Creation","pos":[0,24]}]},{"content":"This sample demonstrates two different ways to create an activity at runtime using the <ph id=\"ph1\">&lt;xref:System.Activities.DynamicActivity&gt;</ph> activity.","pos":[344,481],"source":"This sample demonstrates two different ways to create an activity at runtime using the <xref:System.Activities.DynamicActivity> activity."},{"content":"In this sample, an activity is created at runtime with a body that contains a <ph id=\"ph1\">&lt;xref:System.Activities.Statements.Sequence&gt;</ph> activity that contains <ph id=\"ph2\">&lt;xref:System.Activities.Statements.ForEach%601&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.Activities.Statements.Assign%601&gt;</ph> activities.","pos":[488,744],"source":"In this sample, an activity is created at runtime with a body that contains a <xref:System.Activities.Statements.Sequence> activity that contains <xref:System.Activities.Statements.ForEach%601> and <xref:System.Activities.Statements.Assign%601> activities."},{"content":"An input list of integers is passed into the activity and set as a property.","pos":[745,821]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Activities.Statements.ForEach%601&gt;</ph> activity then iterates over the list of values and accumulates it.","pos":[822,940],"source":" The <xref:System.Activities.Statements.ForEach%601> activity then iterates over the list of values and accumulates it."},{"content":"In the <ph id=\"ph1\">&lt;xref:System.Activities.Statements.Assign%601&gt;</ph> activity, the average value is calculated by dividing the accumulator by the number of elements in the list and assign it to the average.","pos":[941,1132],"source":" In the <xref:System.Activities.Statements.Assign%601> activity, the average value is calculated by dividing the accumulator by the number of elements in the list and assign it to the average."},{"content":"The sample demonstrates the usage of a <ph id=\"ph1\">&lt;xref:System.Activities.DynamicActivity&gt;</ph> activity that flows in variables as input arguments and returning values as output arguments.","pos":[1139,1312],"source":"The sample demonstrates the usage of a <xref:System.Activities.DynamicActivity> activity that flows in variables as input arguments and returning values as output arguments."},{"content":"The activity has one input argument named <ph id=\"ph1\">`Numbers`</ph> that is a list of integers.","pos":[1313,1392],"source":" The activity has one input argument named `Numbers` that is a list of integers."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Activities.Statements.ForEach%601&gt;</ph> activity iterates over the list of values and accumulates it.","pos":[1393,1506],"source":" The <xref:System.Activities.Statements.ForEach%601> activity iterates over the list of values and accumulates it."},{"content":"In the <ph id=\"ph1\">&lt;xref:System.Activities.Statements.Assign%601&gt;</ph> activity, the average value is calculated by dividing the accumulator by the number of elements in the list and assigning it to the average.","pos":[1507,1701],"source":" In the <xref:System.Activities.Statements.Assign%601> activity, the average value is calculated by dividing the accumulator by the number of elements in the list and assigning it to the average."},{"content":"The average is returned as an output argument named <ph id=\"ph1\">`Average`</ph>.","pos":[1702,1764],"source":" The average is returned as an output argument named `Average`."},{"content":"When the dynamic activity is created programmatically, the input and output are declared as shown in the following code example.","pos":[1771,1899]},{"pos":[2466,2598],"content":"The following code example shows the complete definition of the <ph id=\"ph1\">`DynamicActivity`</ph> that computes the average of the values in a list.","source":"The following code example shows the complete definition of the `DynamicActivity` that computes the average of the values in a list."},{"content":"When created in XAML, the input and output are declared as shown in the following example.","pos":[4338,4428]},{"content":"The XAML can be created visually using the <ph id=\"ph1\">[!INCLUDE[wfd1](../../../../includes/wfd1-md.md)]</ph>.","pos":[4958,5051],"source":"The XAML can be created visually using the [!INCLUDE[wfd1](../../../../includes/wfd1-md.md)]."},{"content":"If it is included in a Visual Studio project, be sure to set its \"Build Action\" to \"None\" to prevent it from being compiled.","pos":[5052,5176]},{"content":"The XAML can then be loaded dynamically using the following call.","pos":[5177,5242]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Activities.DynamicActivity&gt;</ph> instance created programmatically or through loading a XAML workflow can be used as shown in the following code example.","pos":[5333,5498],"source":"The <xref:System.Activities.DynamicActivity> instance created programmatically or through loading a XAML workflow can be used as shown in the following code example."},{"content":"Please note that \"act\" passed to the <ph id=\"ph1\">`WorkflowInvoker.Invoke`</ph> is the \"act\" <ph id=\"ph2\">&lt;xref:System.Activities.Activity&gt;</ph> defined in the first code example.","pos":[5499,5642],"source":" Please note that \"act\" passed to the `WorkflowInvoker.Invoke` is the \"act\" <xref:System.Activities.Activity> defined in the first code example."},{"pos":[5900,5918],"content":"To use this sample","linkify":"To use this sample","nodes":[{"content":"To use this sample","pos":[0,18]}]},{"pos":[5928,6040],"content":"Using <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph>, open the DynamicActivityCreation.sln solution file.","source":"Using [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)], open the DynamicActivityCreation.sln solution file."},{"content":"To build the solution, press CTRL+SHIFT+B.","pos":[6050,6092]},{"content":"To run the solution, press CTRL+F5.","pos":[6102,6137]},{"pos":[6146,6168],"content":"Command line arguments","linkify":"Command line arguments","nodes":[{"content":"Command line arguments","pos":[0,22]}]},{"content":"This sample accepts command line arguments.","pos":[6172,6215]},{"content":"Users can provide a list of numbers for the activity to calculate their average.","pos":[6216,6296]},{"content":"The list of numbers to be used is passed as a list of numbers separated by a space.","pos":[6297,6380]},{"content":"For example, to calculate the average of 5, 10, and 32 invoke the sample using the following command line.","pos":[6381,6487]},{"pos":[6494,6529],"content":"<bpt id=\"p1\">**</bpt>DynamicActivityCreation 5 10 32<ept id=\"p1\">**</ept>","source":"**DynamicActivityCreation 5 10 32**"},{"pos":[6535,6667],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[6721,7047],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[7048,7098]},{"pos":[7218,7226],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]}]}