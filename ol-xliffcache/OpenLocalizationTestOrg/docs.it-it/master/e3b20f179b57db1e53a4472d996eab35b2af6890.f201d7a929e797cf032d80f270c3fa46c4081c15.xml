{"content":"---\ntitle: \"Transfer | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: dfcfa36c-d3bb-44b4-aa15-1c922c6f73e6\ncaps.latest.revision: 7\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Transfer\nThis topic describes transfer in the [!INCLUDE[indigo1](../../../../../includes/indigo1-md.md)] activity tracing model.  \n  \n## Transfer Definition  \n Transfers between activities represent causal relationships between events in the related activities within endpoints. Two activities are related with transfers when control flows between these activities, for example, a method call crossing activity boundaries. In [!INCLUDE[indigo2](../../../../../includes/indigo2-md.md)], when bytes are incoming on the service, the Listen At activity is transferred to the Receive Bytes activity where the message object is created. For a list of end-to-end tracing scenarios, and their respective activity and tracing design, see [End-To-End Tracing Scenarios](../../../../../docs/framework/wcf/diagnostics/tracing/end-to-end-tracing-scenarios.md).  \n  \n To emit transfer traces, use the `ActivityTracing` setting on the trace source as demonstrated by the following configuration code.  \n  \n```  \n<source name=\"System.ServiceModel\" switchValue=\"Verbose,ActivityTracing\">  \n```  \n  \n## Using Transfer to Correlate Activities Within Endpoints  \n Activities and transfers permit the user to probabilistically locate the root cause of an error. For example, if we transfer back and forth between activities M and N respectively in components M and N, and a crash happens in N right after the transfer back to M, we can draw the conclusion that it is likely due to N’s passing data back to M.  \n  \n A transfer trace is emitted from activity M to activity N when there is a flow of control between M and N. For example, N performs some work for M because of a method call crossing the activities’ boundaries. N may already exist or has been created. N is spawned by M when N is a new activity that performs some work for M.  \n  \n A transfer from M to N may not be followed by a transfer back from N to M. This is because M can spawn some work in N and do not track when N completes that work. In fact, M can terminate before N completes its task. This happens in the \"Open ServiceHost\" activity (M) that spawns Listener activities (N) and then terminates. A transfer back from N to M means that N completed the work related to M.  \n  \n N can continue performing other processing unrelated to M, for example, an existing authenticator activity (N) that keeps receiving login requests (M) from different login activities.  \n  \n A nesting relationship does not necessarily exist between activities M and N. This can happen due to two reasons. First, when activity M does not monitor the actual processing performed in N although M initiated N. Second, when N already exists.  \n  \n## Example of Transfers  \n The following lists two transfer examples.  \n  \n-   When you create a service host, the constructor gains control from the calling code, or the calling code transfers to the constructor. When the constructor has finished executing, it returns control to the calling code, or the constructor transfers back to the calling code. This is the case of a nested relationship.  \n  \n-   When a listener starts processing transport data, it creates a new thread and hands to the Receive Bytes activity the appropriate context for processing, passing control and data. When that thread has finished processing the request, the Receive Bytes activity passes nothing back to the listener. In this case, we have a transfer in but no transfer out of the new thread activity. The two activities are related but not nested.  \n  \n## Activity Transfer Sequence  \n A well-formed activity transfer sequence includes the following steps.  \n  \n1.  Begin a new activity, which consists of selecting a new gAId.  \n  \n2.  Emit a transfer trace to that new gAId from the current activity ID  \n  \n3.  Set the new ID in TLS  \n  \n4.  Emit a start trace to indicate the beginning of the new activity by.  \n  \n5.  Return to the original activity consists of the following:  \n  \n6.  Emit a transfer trace to the original gAId  \n  \n7.  Emit a Stop trace to indicate the end of the new activity  \n  \n8.  Set TLS to the old gAId.  \n  \n The following code example demonstrates how to do this. This sample assumes a blocking call is made when transferring to the new activity, and includes suspend/resume traces.  \n  \n```  \n// 0. Create a trace source  \nTraceSource ts = new TraceSource(\"myTS\");  \n// 1. remember existing (\"ambient\") activity for clean up  \nGuid oldGuid = Trace.CorrelationManager.ActivityId;  \n// this will be our new activity  \nGuid newGuid = Guid.NewGuid();   \n// 2. call transfer, indicating that we are switching to the new AID  \nts.TraceTransfer(667, \"Transferring.\", newGuid);  \n// 3. Suspend the current activity.  \nts.TraceEvent(TraceEventType.Suspend, 667, \"Suspend: Activity \" + i-1);  \n// 4. set the new AID in TLS  \nTrace.CorrelationManager.ActivityId = newGuid;  \n// 5. Emit the start trace  \nts.TraceEvent(TraceEventType.Start, 667, \"Boundary: Activity \" + i);  \n// trace something  \nts.TraceEvent(TraceEventType.Information, 667, \"Hello from activity \" + i);  \n// Perform Work  \n// some work.  \n// Return  \nts.TraceEvent(TraceEventType.Information, 667, \"Work complete on activity \" + i);   \n// 6. Emit the transfer returning to the original activity  \nts.TraceTransfer(667, \"Transferring Back.\", oldGuid);  \n// 7. Emit the End trace  \nts.TraceEvent(TraceEventType.Stop, 667, \"Boundary: Activity \" + i);  \n// 8. Change the tls variable to the original AID  \nTrace.CorrelationManager.ActivityId = oldGuid;    \n// 9. Resume the old activity  \nts.TraceEvent(TraceEventType.Resume, 667, \"Resume: Activity \" + i-1);  \n```  \n  \n## See Also  \n [Configuring Tracing](../../../../../docs/framework/wcf/diagnostics/tracing/configuring-tracing.md)   \n [Using Service Trace Viewer for Viewing Correlated Traces and Troubleshooting](../../../../../docs/framework/wcf/diagnostics/tracing/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting.md)   \n [End-To-End Tracing Scenarios](../../../../../docs/framework/wcf/diagnostics/tracing/end-to-end-tracing-scenarios.md)   \n [Service Trace Viewer Tool (SvcTraceViewer.exe)](../../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md)","nodes":[{"pos":[4,328],"nodes":[{"content":"Transfer | Microsoft Docs","nodes":[{"pos":[0,25],"content":"Transfer | Microsoft Docs","nodes":[{"content":"Transfer | Microsoft Docs","pos":[0,25]}]}],"pos":[6,34],"yaml":true}],"content":"title: \"Transfer | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: dfcfa36c-d3bb-44b4-aa15-1c922c6f73e6\ncaps.latest.revision: 7\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"","yamlblock":true},{"pos":[335,343],"content":"Transfer","linkify":"Transfer","nodes":[{"content":"Transfer","pos":[0,8]}]},{"pos":[344,463],"content":"This topic describes transfer in the <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../../includes/indigo1-md.md)]</ph> activity tracing model.","source":"This topic describes transfer in the [!INCLUDE[indigo1](../../../../../includes/indigo1-md.md)] activity tracing model."},{"pos":[472,491],"content":"Transfer Definition","linkify":"Transfer Definition","nodes":[{"content":"Transfer Definition","pos":[0,19]}]},{"content":"Transfers between activities represent causal relationships between events in the related activities within endpoints.","pos":[495,613]},{"content":"Two activities are related with transfers when control flows between these activities, for example, a method call crossing activity boundaries.","pos":[614,757]},{"content":"In <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../../includes/indigo2-md.md)]</ph>, when bytes are incoming on the service, the Listen At activity is transferred to the Receive Bytes activity where the message object is created.","pos":[758,965],"source":" In [!INCLUDE[indigo2](../../../../../includes/indigo2-md.md)], when bytes are incoming on the service, the Listen At activity is transferred to the Receive Bytes activity where the message object is created."},{"content":"For a list of end-to-end tracing scenarios, and their respective activity and tracing design, see <bpt id=\"p1\">[</bpt>End-To-End Tracing Scenarios<ept id=\"p1\">](../../../../../docs/framework/wcf/diagnostics/tracing/end-to-end-tracing-scenarios.md)</ept>.","pos":[966,1182],"source":" For a list of end-to-end tracing scenarios, and their respective activity and tracing design, see [End-To-End Tracing Scenarios](../../../../../docs/framework/wcf/diagnostics/tracing/end-to-end-tracing-scenarios.md)."},{"pos":[1189,1320],"content":"To emit transfer traces, use the <ph id=\"ph1\">`ActivityTracing`</ph> setting on the trace source as demonstrated by the following configuration code.","source":"To emit transfer traces, use the `ActivityTracing` setting on the trace source as demonstrated by the following configuration code."},{"pos":[1420,1475],"content":"Using Transfer to Correlate Activities Within Endpoints","linkify":"Using Transfer to Correlate Activities Within Endpoints","nodes":[{"content":"Using Transfer to Correlate Activities Within Endpoints","pos":[0,55]}]},{"content":"Activities and transfers permit the user to probabilistically locate the root cause of an error.","pos":[1479,1575]},{"content":"For example, if we transfer back and forth between activities M and N respectively in components M and N, and a crash happens in N right after the transfer back to M, we can draw the conclusion that it is likely due to N’s passing data back to M.","pos":[1576,1822]},{"content":"A transfer trace is emitted from activity M to activity N when there is a flow of control between M and N. For example, N performs some work for M because of a method call crossing the activities’ boundaries.","pos":[1829,2037]},{"content":"N may already exist or has been created.","pos":[2038,2078]},{"content":"N is spawned by M when N is a new activity that performs some work for M.","pos":[2079,2152]},{"content":"A transfer from M to N may not be followed by a transfer back from N to M. This is because M can spawn some work in N and do not track when N completes that work.","pos":[2159,2321]},{"content":"In fact, M can terminate before N completes its task.","pos":[2322,2375]},{"content":"This happens in the \"Open ServiceHost\" activity (M) that spawns Listener activities (N) and then terminates.","pos":[2376,2484]},{"content":"A transfer back from N to M means that N completed the work related to M.","pos":[2485,2558]},{"content":"N can continue performing other processing unrelated to M, for example, an existing authenticator activity (N) that keeps receiving login requests (M) from different login activities.","pos":[2565,2748]},{"content":"A nesting relationship does not necessarily exist between activities M and N. This can happen due to two reasons.","pos":[2755,2868]},{"content":"First, when activity M does not monitor the actual processing performed in N although M initiated N. Second, when N already exists.","pos":[2869,3000]},{"pos":[3009,3029],"content":"Example of Transfers","linkify":"Example of Transfers","nodes":[{"content":"Example of Transfers","pos":[0,20]}]},{"content":"The following lists two transfer examples.","pos":[3033,3075]},{"content":"When you create a service host, the constructor gains control from the calling code, or the calling code transfers to the constructor.","pos":[3085,3219]},{"content":"When the constructor has finished executing, it returns control to the calling code, or the constructor transfers back to the calling code.","pos":[3220,3359]},{"content":"This is the case of a nested relationship.","pos":[3360,3402]},{"content":"When a listener starts processing transport data, it creates a new thread and hands to the Receive Bytes activity the appropriate context for processing, passing control and data.","pos":[3412,3591]},{"content":"When that thread has finished processing the request, the Receive Bytes activity passes nothing back to the listener.","pos":[3592,3709]},{"content":"In this case, we have a transfer in but no transfer out of the new thread activity.","pos":[3710,3793]},{"content":"The two activities are related but not nested.","pos":[3794,3840]},{"pos":[3849,3875],"content":"Activity Transfer Sequence","linkify":"Activity Transfer Sequence","nodes":[{"content":"Activity Transfer Sequence","pos":[0,26]}]},{"content":"A well-formed activity transfer sequence includes the following steps.","pos":[3879,3949]},{"content":"Begin a new activity, which consists of selecting a new gAId.","pos":[3959,4020]},{"content":"Emit a transfer trace to that new gAId from the current activity ID","pos":[4030,4097]},{"content":"Set the new ID in TLS","pos":[4107,4128]},{"content":"Emit a start trace to indicate the beginning of the new activity by.","pos":[4138,4206]},{"content":"Return to the original activity consists of the following:","pos":[4216,4274]},{"content":"Emit a transfer trace to the original gAId","pos":[4284,4326]},{"content":"Emit a Stop trace to indicate the end of the new activity","pos":[4336,4393]},{"content":"Set TLS to the old gAId.","pos":[4403,4427]},{"content":"The following code example demonstrates how to do this.","pos":[4434,4489]},{"content":"This sample assumes a blocking call is made when transferring to the new activity, and includes suspend/resume traces.","pos":[4490,4608]},{"pos":[5954,5962],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Configuring Tracing<ept id=\"p1\">](../../../../../docs/framework/wcf/diagnostics/tracing/configuring-tracing.md)</ept><ph id=\"ph1\"> </ph>","pos":[5966,6066],"source":"[Configuring Tracing](../../../../../docs/framework/wcf/diagnostics/tracing/configuring-tracing.md) "},{"content":"<bpt id=\"p1\">[</bpt>Using Service Trace Viewer for Viewing Correlated Traces and Troubleshooting<ept id=\"p1\">](../../../../../docs/framework/wcf/diagnostics/tracing/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting.md)</ept><ph id=\"ph1\"> </ph>","pos":[6070,6284],"source":"[Using Service Trace Viewer for Viewing Correlated Traces and Troubleshooting](../../../../../docs/framework/wcf/diagnostics/tracing/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting.md) "},{"content":"<bpt id=\"p1\">[</bpt>End-To-End Tracing Scenarios<ept id=\"p1\">](../../../../../docs/framework/wcf/diagnostics/tracing/end-to-end-tracing-scenarios.md)</ept><ph id=\"ph1\"> </ph>","pos":[6288,6406],"source":"[End-To-End Tracing Scenarios](../../../../../docs/framework/wcf/diagnostics/tracing/end-to-end-tracing-scenarios.md) "},{"content":"<bpt id=\"p1\">[</bpt>Service Trace Viewer Tool (SvcTraceViewer.exe)<ept id=\"p1\">](../../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md)</ept>","pos":[6410,6541],"source":"[Service Trace Viewer Tool (SvcTraceViewer.exe)](../../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md)"}]}