{"content":"---\ntitle: \"Multiple Endpoints at a Single ListenUri\"\nms.date: \"03/30/2017\"\nms.assetid: 911ffad4-4d47-4430-b7c2-79192ce6bcbd\n---\n# Multiple Endpoints at a Single ListenUri\nThis sample demonstrates a service that hosts multiple endpoints at a single `ListenUri`. This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) that implements a calculator service.  \n  \n> [!NOTE]\n>  The setup procedure and build instructions for this sample are located at the end of this topic.  \n  \n As demonstrated in the [Multiple Endpoints](../../../../docs/framework/wcf/samples/multiple-endpoints.md) sample, a service can host multiple endpoints, each with different addresses and possibly also different bindings. This sample shows that it is possible to host multiple endpoints at the same address. This sample also demonstrates the differences between the two kinds of addresses that a service endpoint has: `EndpointAddress` and `ListenUri`.  \n  \n The `EndpointAddress` is the logical address of a service. It is the address that SOAP messages are addressed to. The `ListenUri` is the physical address of the service. It has the port and address information where the service endpoint actually listens for messages on the current machine. In most cases, there is no need for these addresses to differ; when a `ListenUri` is not explicitly specified, it defaults to the URI of the `EndpointAddress` of the endpoint. In a few cases, it is useful to distinguish them, such as when configuring a router, which might accept messages addressed to a number of different services.  \n  \n## Service  \n The service in this sample has two contracts, `ICalculator` and `IEcho`. In addition to the customary `IMetadataExchange` endpoint, there are three application endpoints, as shown in the following code.  \n  \n```xml  \n<endpoint address=\"urn:Stuff\"  \n        binding=\"wsHttpBinding\"  \n        contract=\"Microsoft.ServiceModel.Samples.ICalculator\"   \n        listenUri=\"http://localhost/servicemodelsamples/service.svc\" />  \n<endpoint address=\"urn:Stuff\"  \n        binding=\"wsHttpBinding\"  \n        contract=\"Microsoft.ServiceModel.Samples.IEcho\"   \n        listenUri=\"http://localhost/servicemodelsamples/service.svc\" />  \n<endpoint address=\"urn:OtherEcho\"  \n        binding=\"wsHttpBinding\"  \n        contract=\"Microsoft.ServiceModel.Samples.IEcho\"   \n        listenUri=\"http://localhost/servicemodelsamples/service.svc\" />  \n```  \n  \n All three endpoints are hosted at the same `ListenUri` and use the same `binding` - endpoints at the same `ListenUri` must have the same binding, because they are sharing a single channel stack that listens for messages at that physical address on the machine. The `address` of each endpoint is a URN; though typically addresses represent physical locations, in fact the address can be any kind of URI, because the address is used for matching and filtering purposes as is demonstrated in this sample.  \n  \n Because all three endpoints share the same `ListenUri`, when a message arrives there, Windows Communication Foundation (WCF) must decide which endpoint the message is destined for. Each endpoint has a message filter that is comprised of two parts: the address filter and the contract filter. The address filter matches the `To` of the SOAP message to the address of the service endpoint. For example, only messages addressed `To \"Urn:OtherEcho\"` are candidates for the third endpoint of this service. The contract filter matches the Actions associated with the operations of a particular contract. For example, messages with the action of `IEcho`. `Echo` matches the contract filters of both the second and third endpoints of this service, because both of those endpoints host the `IEcho` contract.  \n  \n Thus the combination of address filter and contract filter makes it possible to route each message that arrives at this service's `ListenUri` to the correct endpoint. The third endpoint is differentiated from the other two because it accepts messages sent to a different address from the other endpoints. The first and second endpoints are differentiated from each other based on their contracts (the Action of the incoming message).  \n  \n## Client  \n Just as endpoints on the server have two different addresses, client endpoints also have two addresses. On both server and client, the logical address is called the `EndpointAddress`. But whereas the physical address is called the `ListenUri` on the server, on the client, the physical address is called the `Via`.  \n  \n As on the server, by default, these two addresses are the same. To specify a `Via` on the client that is different from the endpoint's address, `ClientViaBehavior` is used:  \n  \n```csharp  \nUri via = new Uri(\"http://localhost/ServiceModelSamples/service.svc\");  \nCalculatorClient calcClient = new CalculatorClient();  \ncalcClient.ChannelFactory.Endpoint.Behaviors.Add(  \n        new ClientViaBehavior(via));  \n```  \n  \n As usual, the address comes from the client configuration file, which was generated by Svcutil.exe. The `Via` (which corresponds to the `ListenUri` of the service) does not appear in the service's metadata and so this information must be communicated to the client out-of-band (just like the service's metadata address).  \n  \n The client in this sample sends messages to each of the server's three application endpoints, to demonstrate that it can communicate with (and differentiate) all three endpoints, even though they all have the same `Via`.  \n  \n#### To set up, build, and run the sample  \n  \n1.  Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).  \n  \n2.  To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).  \n  \n3.  To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).  \n  \n    > [!NOTE]\n    >  For cross-machine, you must replace localhost in the Client.cs file with the name of the service machine.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Services\\MultipleEndpointsSingleUri`  \n","nodes":[{"pos":[4,124],"embed":true,"restype":"x-metadata","content":"title: \"Multiple Endpoints at a Single ListenUri\"\nms.date: \"03/30/2017\"\nms.assetid: 911ffad4-4d47-4430-b7c2-79192ce6bcbd","nodes":[{"content":"Multiple Endpoints at a Single ListenUri","nodes":[{"pos":[0,40],"content":"Multiple Endpoints at a Single ListenUri","nodes":[{"content":"Multiple Endpoints at a Single ListenUri","pos":[0,40]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[131,171],"content":"Multiple Endpoints at a Single ListenUri","linkify":"Multiple Endpoints at a Single ListenUri","nodes":[{"content":"Multiple Endpoints at a Single ListenUri","pos":[0,40]}]},{"content":"This sample demonstrates a service that hosts multiple endpoints at a single <ph id=\"ph1\">`ListenUri`</ph>.","pos":[172,261],"source":"This sample demonstrates a service that hosts multiple endpoints at a single `ListenUri`."},{"content":"This sample is based on the <bpt id=\"p1\">[</bpt>Getting Started<ept id=\"p1\">](../../../../docs/framework/wcf/samples/getting-started-sample.md)</ept> that implements a calculator service.","pos":[262,411],"source":" This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) that implements a calculator service."},{"pos":[419,526],"content":"[!NOTE]\n The setup procedure and build instructions for this sample are located at the end of this topic.","leadings":["","> "],"nodes":[{"content":"The setup procedure and build instructions for this sample are located at the end of this topic.","pos":[9,105]}]},{"content":"As demonstrated in the <bpt id=\"p1\">[</bpt>Multiple Endpoints<ept id=\"p1\">](../../../../docs/framework/wcf/samples/multiple-endpoints.md)</ept> sample, a service can host multiple endpoints, each with different addresses and possibly also different bindings.","pos":[533,753],"source":"As demonstrated in the [Multiple Endpoints](../../../../docs/framework/wcf/samples/multiple-endpoints.md) sample, a service can host multiple endpoints, each with different addresses and possibly also different bindings."},{"content":"This sample shows that it is possible to host multiple endpoints at the same address.","pos":[754,839]},{"content":"This sample also demonstrates the differences between the two kinds of addresses that a service endpoint has: <ph id=\"ph1\">`EndpointAddress`</ph> and <ph id=\"ph2\">`ListenUri`</ph>.","pos":[840,984],"source":" This sample also demonstrates the differences between the two kinds of addresses that a service endpoint has: `EndpointAddress` and `ListenUri`."},{"content":"The <ph id=\"ph1\">`EndpointAddress`</ph> is the logical address of a service.","pos":[991,1049],"source":"The `EndpointAddress` is the logical address of a service."},{"content":"It is the address that SOAP messages are addressed to.","pos":[1050,1104]},{"content":"The <ph id=\"ph1\">`ListenUri`</ph> is the physical address of the service.","pos":[1105,1160],"source":" The `ListenUri` is the physical address of the service."},{"content":"It has the port and address information where the service endpoint actually listens for messages on the current machine.","pos":[1161,1281]},{"content":"In most cases, there is no need for these addresses to differ; when a <ph id=\"ph1\">`ListenUri`</ph> is not explicitly specified, it defaults to the URI of the <ph id=\"ph2\">`EndpointAddress`</ph> of the endpoint.","pos":[1282,1457],"source":" In most cases, there is no need for these addresses to differ; when a `ListenUri` is not explicitly specified, it defaults to the URI of the `EndpointAddress` of the endpoint."},{"content":"In a few cases, it is useful to distinguish them, such as when configuring a router, which might accept messages addressed to a number of different services.","pos":[1458,1615]},{"pos":[1624,1631],"content":"Service","linkify":"Service","nodes":[{"content":"Service","pos":[0,7]}]},{"content":"The service in this sample has two contracts, <ph id=\"ph1\">`ICalculator`</ph> and <ph id=\"ph2\">`IEcho`</ph>.","pos":[1635,1707],"source":"The service in this sample has two contracts, `ICalculator` and `IEcho`."},{"content":"In addition to the customary <ph id=\"ph1\">`IMetadataExchange`</ph> endpoint, there are three application endpoints, as shown in the following code.","pos":[1708,1837],"source":" In addition to the customary `IMetadataExchange` endpoint, there are three application endpoints, as shown in the following code."},{"content":"All three endpoints are hosted at the same <ph id=\"ph1\">`ListenUri`</ph> and use the same <ph id=\"ph2\">`binding`</ph> - endpoints at the same <ph id=\"ph3\">`ListenUri`</ph> must have the same binding, because they are sharing a single channel stack that listens for messages at that physical address on the machine.","pos":[2469,2729],"source":"All three endpoints are hosted at the same `ListenUri` and use the same `binding` - endpoints at the same `ListenUri` must have the same binding, because they are sharing a single channel stack that listens for messages at that physical address on the machine."},{"content":"The <ph id=\"ph1\">`address`</ph> of each endpoint is a URN; though typically addresses represent physical locations, in fact the address can be any kind of URI, because the address is used for matching and filtering purposes as is demonstrated in this sample.","pos":[2730,2970],"source":" The `address` of each endpoint is a URN; though typically addresses represent physical locations, in fact the address can be any kind of URI, because the address is used for matching and filtering purposes as is demonstrated in this sample."},{"content":"Because all three endpoints share the same <ph id=\"ph1\">`ListenUri`</ph>, when a message arrives there, Windows Communication Foundation (WCF) must decide which endpoint the message is destined for.","pos":[2977,3157],"source":"Because all three endpoints share the same `ListenUri`, when a message arrives there, Windows Communication Foundation (WCF) must decide which endpoint the message is destined for."},{"content":"Each endpoint has a message filter that is comprised of two parts: the address filter and the contract filter.","pos":[3158,3268]},{"content":"The address filter matches the <ph id=\"ph1\">`To`</ph> of the SOAP message to the address of the service endpoint.","pos":[3269,3364],"source":" The address filter matches the `To` of the SOAP message to the address of the service endpoint."},{"content":"For example, only messages addressed <ph id=\"ph1\">`To \"Urn:OtherEcho\"`</ph> are candidates for the third endpoint of this service.","pos":[3365,3477],"source":" For example, only messages addressed `To \"Urn:OtherEcho\"` are candidates for the third endpoint of this service."},{"content":"The contract filter matches the Actions associated with the operations of a particular contract.","pos":[3478,3574]},{"content":"For example, messages with the action of <ph id=\"ph1\">`IEcho`</ph>.","pos":[3575,3624],"source":" For example, messages with the action of `IEcho`."},{"content":"<ph id=\"ph1\">`Echo`</ph> matches the contract filters of both the second and third endpoints of this service, because both of those endpoints host the <ph id=\"ph2\">`IEcho`</ph> contract.","pos":[3625,3775],"source":"`Echo` matches the contract filters of both the second and third endpoints of this service, because both of those endpoints host the `IEcho` contract."},{"content":"Thus the combination of address filter and contract filter makes it possible to route each message that arrives at this service's <ph id=\"ph1\">`ListenUri`</ph> to the correct endpoint.","pos":[3782,3948],"source":"Thus the combination of address filter and contract filter makes it possible to route each message that arrives at this service's `ListenUri` to the correct endpoint."},{"content":"The third endpoint is differentiated from the other two because it accepts messages sent to a different address from the other endpoints.","pos":[3949,4086]},{"content":"The first and second endpoints are differentiated from each other based on their contracts (the Action of the incoming message).","pos":[4087,4215]},{"pos":[4224,4230],"content":"Client","linkify":"Client","nodes":[{"content":"Client","pos":[0,6]}]},{"content":"Just as endpoints on the server have two different addresses, client endpoints also have two addresses.","pos":[4234,4337]},{"content":"On both server and client, the logical address is called the <ph id=\"ph1\">`EndpointAddress`</ph>.","pos":[4338,4417],"source":" On both server and client, the logical address is called the `EndpointAddress`."},{"content":"But whereas the physical address is called the <ph id=\"ph1\">`ListenUri`</ph> on the server, on the client, the physical address is called the <ph id=\"ph2\">`Via`</ph>.","pos":[4418,4548],"source":" But whereas the physical address is called the `ListenUri` on the server, on the client, the physical address is called the `Via`."},{"content":"As on the server, by default, these two addresses are the same.","pos":[4555,4618]},{"content":"To specify a <ph id=\"ph1\">`Via`</ph> on the client that is different from the endpoint's address, <ph id=\"ph2\">`ClientViaBehavior`</ph> is used:","pos":[4619,4727],"source":" To specify a `Via` on the client that is different from the endpoint's address, `ClientViaBehavior` is used:"},{"content":"As usual, the address comes from the client configuration file, which was generated by Svcutil.exe.","pos":[4975,5074]},{"content":"The <ph id=\"ph1\">`Via`</ph> (which corresponds to the <ph id=\"ph2\">`ListenUri`</ph> of the service) does not appear in the service's metadata and so this information must be communicated to the client out-of-band (just like the service's metadata address).","pos":[5075,5295],"source":" The `Via` (which corresponds to the `ListenUri` of the service) does not appear in the service's metadata and so this information must be communicated to the client out-of-band (just like the service's metadata address)."},{"pos":[5302,5522],"content":"The client in this sample sends messages to each of the server's three application endpoints, to demonstrate that it can communicate with (and differentiate) all three endpoints, even though they all have the same <ph id=\"ph1\">`Via`</ph>.","source":"The client in this sample sends messages to each of the server's three application endpoints, to demonstrate that it can communicate with (and differentiate) all three endpoints, even though they all have the same `Via`."},{"pos":[5533,5569],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[5579,5778],"content":"Ensure that you have performed the <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"pos":[5788,5997],"content":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"pos":[6007,6215],"content":"To run the sample in a single- or cross-machine configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"pos":[6227,6347],"content":"[!NOTE]\nFor cross-machine, you must replace localhost in the Client.cs file with the name of the service machine.","leadings":["","    >  "],"nodes":[{"content":"For cross-machine, you must replace localhost in the Client.cs file with the name of the service machine.","pos":[8,113]}]},{"pos":[6355,6487],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[14,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[0,53]},{"content":"Check for the following (default) directory before continuing.","pos":[54,116]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[6541,6851],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[6852,6902]}]}