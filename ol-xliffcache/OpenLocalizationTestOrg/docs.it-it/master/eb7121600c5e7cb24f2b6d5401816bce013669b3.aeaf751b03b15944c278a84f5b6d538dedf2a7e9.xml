{"content":"---\ntitle: \"Accessing OperationContext | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 4e92efe8-7e79-41f3-b50e-bdc38b9f41f8\ncaps.latest.revision: 5\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Accessing OperationContext\nThis sample demonstrates how the messaging activities (<xref:System.ServiceModel.Activities.Receive>and <xref:System.ServiceModel.Activities.Send>) can be used with a custom scope activity to access <xref:System.ServiceModel.OperationContext.Current%2A> and attach or retrieve a custom message header within an outgoing or incoming message.  \n  \n## Demonstrates  \n Messaging Activities, <xref:System.ServiceModel.Activities.ISendMessageCallback>, <xref:System.ServiceModel.Activities.IReceiveMessageCallback>.  \n  \n## Discussion  \n This sample shows how to use extensibility points (<xref:System.ServiceModel.Activities.ISendMessageCallback>) <xref:System.ServiceModel.Activities.IReceiveMessageCallback>) in the messaging activities to access <xref:System.ServiceModel.OperationContext.Current%2A>. The callbacks are registered within the workflow runtime as an implementation of <xref:System.Activities.IExecutionProperty> that is picked up by the messaging activities upon execution. Any messaging activity in the same scope as that <xref:System.Activities.IExecutionProperty> implementation is affected. In particular, this sample uses a custom scope activity to enforce the callback behavior. The <xref:System.ServiceModel.Activities.ISendMessageCallback> is used in the client workflow to include the workflow’s <xref:System.Activities.WorkflowApplication.Id%2A> as an outgoing <xref:System.ServiceModel.Channels.MessageHeader>. This header is then picked up in the service using the <xref:System.ServiceModel.Activities.IReceiveMessageCallback> and the value of the header is printed out to the console.  \n  \n#### To set up, build, and run the sample  \n  \n1.  This sample exposes a workflow service using HTTP endpoints. To run this sample, proper URL ACLs must be added (see [Configuring HTTP and HTTPS](http://go.microsoft.com/fwlink/?LinkId=70353) for details), either by running Visual Studio as Administrator or by executing the following command at an elevated prompt to add the appropriate ACLs. Ensure that your Domain and Username are substituted.  \n  \n    ```  \n    netsh http add urlacl url=http://+:8000/ user=%DOMAIN%\\%UserName%  \n    ```  \n  \n2.  Once the URL ACLs are added, use the following steps.  \n  \n    1.  Build the solution.  \n  \n    2.  Set multiple start-up projects by right-clicking the solution and selecting **Set Startup Projects**.  \n  \n    3.  Add **Service** and **Client** (in that order) as multiple start-up projects.  \n  \n    4.  Run the application. The client console shows a workflow running twice and the Service window shows the instance ID of those workflows.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Scenario\\Services\\Accessing Operation Context`","nodes":[{"pos":[12,55],"content":"Accessing OperationContext | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Accessing OperationContext | Microsoft Docs","pos":[0,43]}]},{"pos":[320,346],"content":"Accessing OperationContext","linkify":"Accessing OperationContext","nodes":[{"content":"Accessing OperationContext","pos":[0,26]}]},{"content":"This sample demonstrates how the messaging activities (<ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph>and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph>) can be used with a custom scope activity to access <ph id=\"ph3\">&lt;xref:System.ServiceModel.OperationContext.Current%2A&gt;</ph> and attach or retrieve a custom message header within an outgoing or incoming message.","pos":[347,687],"source":"This sample demonstrates how the messaging activities (<xref:System.ServiceModel.Activities.Receive>and <xref:System.ServiceModel.Activities.Send>) can be used with a custom scope activity to access <xref:System.ServiceModel.OperationContext.Current%2A> and attach or retrieve a custom message header within an outgoing or incoming message."},{"pos":[696,708],"content":"Demonstrates","linkify":"Demonstrates","nodes":[{"content":"Demonstrates","pos":[0,12]}]},{"content":"Messaging Activities, <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.ISendMessageCallback&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.IReceiveMessageCallback&gt;</ph>.","pos":[712,856],"source":"Messaging Activities, <xref:System.ServiceModel.Activities.ISendMessageCallback>, <xref:System.ServiceModel.Activities.IReceiveMessageCallback>."},{"pos":[865,875],"content":"Discussion","linkify":"Discussion","nodes":[{"content":"Discussion","pos":[0,10]}]},{"content":"This sample shows how to use extensibility points (<ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.ISendMessageCallback&gt;</ph>) <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.IReceiveMessageCallback&gt;</ph>) in the messaging activities to access <ph id=\"ph3\">&lt;xref:System.ServiceModel.OperationContext.Current%2A&gt;</ph>.","pos":[879,1146],"source":"This sample shows how to use extensibility points (<xref:System.ServiceModel.Activities.ISendMessageCallback>) <xref:System.ServiceModel.Activities.IReceiveMessageCallback>) in the messaging activities to access <xref:System.ServiceModel.OperationContext.Current%2A>."},{"content":"The callbacks are registered within the workflow runtime as an implementation of <ph id=\"ph1\">&lt;xref:System.Activities.IExecutionProperty&gt;</ph> that is picked up by the messaging activities upon execution.","pos":[1147,1333],"source":" The callbacks are registered within the workflow runtime as an implementation of <xref:System.Activities.IExecutionProperty> that is picked up by the messaging activities upon execution."},{"content":"Any messaging activity in the same scope as that <ph id=\"ph1\">&lt;xref:System.Activities.IExecutionProperty&gt;</ph> implementation is affected.","pos":[1334,1454],"source":" Any messaging activity in the same scope as that <xref:System.Activities.IExecutionProperty> implementation is affected."},{"content":"In particular, this sample uses a custom scope activity to enforce the callback behavior.","pos":[1455,1544]},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.ISendMessageCallback&gt;</ph> is used in the client workflow to include the workflow’s <ph id=\"ph2\">&lt;xref:System.Activities.WorkflowApplication.Id%2A&gt;</ph> as an outgoing <ph id=\"ph3\">&lt;xref:System.ServiceModel.Channels.MessageHeader&gt;</ph>.","pos":[1545,1781],"source":" The <xref:System.ServiceModel.Activities.ISendMessageCallback> is used in the client workflow to include the workflow’s <xref:System.Activities.WorkflowApplication.Id%2A> as an outgoing <xref:System.ServiceModel.Channels.MessageHeader>."},{"content":"This header is then picked up in the service using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.IReceiveMessageCallback&gt;</ph> and the value of the header is printed out to the console.","pos":[1782,1957],"source":" This header is then picked up in the service using the <xref:System.ServiceModel.Activities.IReceiveMessageCallback> and the value of the header is printed out to the console."},{"pos":[1968,2004],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"content":"This sample exposes a workflow service using HTTP endpoints.","pos":[2014,2074]},{"content":"To run this sample, proper URL ACLs must be added (see <bpt id=\"p1\">[</bpt>Configuring HTTP and HTTPS<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=70353)</ept> for details), either by running Visual Studio as Administrator or by executing the following command at an elevated prompt to add the appropriate ACLs.","pos":[2075,2356],"source":" To run this sample, proper URL ACLs must be added (see [Configuring HTTP and HTTPS](http://go.microsoft.com/fwlink/?LinkId=70353) for details), either by running Visual Studio as Administrator or by executing the following command at an elevated prompt to add the appropriate ACLs."},{"content":"Ensure that your Domain and Username are substituted.","pos":[2357,2410]},{"content":"Once the URL ACLs are added, use the following steps.","pos":[2515,2568]},{"content":"Build the solution.","pos":[2582,2601]},{"pos":[2615,2716],"content":"Set multiple start-up projects by right-clicking the solution and selecting <bpt id=\"p1\">**</bpt>Set Startup Projects<ept id=\"p1\">**</ept>.","source":"Set multiple start-up projects by right-clicking the solution and selecting **Set Startup Projects**."},{"pos":[2730,2807],"content":"Add <bpt id=\"p1\">**</bpt>Service<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Client<ept id=\"p2\">**</ept> (in that order) as multiple start-up projects.","source":"Add **Service** and **Client** (in that order) as multiple start-up projects."},{"content":"Run the application.","pos":[2821,2841]},{"content":"The client console shows a workflow running twice and the Service window shows the instance ID of those workflows.","pos":[2842,2956]},{"pos":[2964,3096],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[3150,3476],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[3477,3527]}]}