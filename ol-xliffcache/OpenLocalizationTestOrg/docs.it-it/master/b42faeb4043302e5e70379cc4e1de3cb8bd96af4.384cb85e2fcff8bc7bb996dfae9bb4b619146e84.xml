{"content":"---\ntitle: \"Information Disclosure\"\nms.date: \"03/30/2017\"\nms.assetid: 4064c89f-afa6-444a-aa7e-807ef072131c\n---\n# Information Disclosure\nInformation disclosure enables an attacker to gain valuable information about a system. Therefore, always consider what information you are revealing and whether it can be used by a malicious user. The following lists possible information disclosure attacks and provides mitigations for each.  \n  \n## Message Security and HTTP  \n If you are using message-level security over an HTTP transport layer, be aware that message-level security does not protect HTTP headers. The only way to protect HTTP headers is to use HTTPS transport instead of HTTP. HTTPS transport causes the entire message, including the HTTP headers, to be encrypted using the Secure Sockets Layer (SSL) protocol.  \n  \n## Policy Information  \n Keeping policy secure is important, especially in federation scenarios where sensitive issued-token requirements or token-issuer information is exposed in policy. In these cases, the recommendation is to secure the federated service's policy endpoint to prevent attackers from obtaining information about the service, such as the type of claims to put in the issued token, or redirecting clients to malicious token issuers. For example, an attacker could discover user name/password pairs by reconfiguring the federated trust chain to terminate in an issuer that executed a man-in-the-middle attack. It is also recommended that federated clients who obtain their bindings through policy retrieval verify that they trust the issuers in the obtained federated trust chain. For more information about federation scenarios, see [Federation](../../../../docs/framework/wcf/feature-details/federation.md).  \n  \n## Memory Dumps Can Reveal Claim Information  \n When an application fails, log files, such as those produced by Dr. Watson, can contain the claim information. This information should not be exported to other entities, such as support teams; otherwise, the claim information that contains private data is also exported. You can mitigate this by not sending the log files to unknown entities. For more information, see [Windows Server 2003](https://go.microsoft.com/fwlink/?LinkId=89160).  \n  \n## Endpoint Addresses  \n An endpoint address contains the information needed to communicate with an endpoint. SOAP security must include the address in full in the security negotiation messages that are exchanged in order to negotiate a symmetric key between a client and a server. Because security negotiation is a bootstrap process, the address headers cannot be encrypted during this process. Therefore, the address should not contain any confidential data; otherwise, it leads to information disclosure attacks.  \n  \n## Certificates Transferred Unencrypted  \n When you use an X.509 certificate to authenticate a client, the certificate is transferred in the clear, inside the SOAP header. Be aware of this as a potential personally identifiable information (PII) disclosure. This is not an issue for `TransportWithMessageCredential` mode, where the entire message is encrypted with transport-level security.  \n  \n## Service References  \n A service reference is a reference to another service. For example, a service may pass a service reference to a client in the course of an operation. The service reference is also used with a *trust identity verifier*, an internal component that ensures the identity of the target principal before disclosing information such as application data or credentials to the target. If the remote trust identity cannot be verified or is incorrect, the sender should ensure that no data was disclosed that could compromise itself, the application, or the user.  \n  \n Mitigations include the following:  \n  \n-   Service references are assumed to be trustworthy. Take care whenever transferring service reference instances to ensure that they have not been tampered with.  \n  \n-   Some applications can present a user experience that allows interactive establishment of trust based on data in the service reference and trust data proven by the remote host. WCF provides extensibility points for such a facility, but the user must implemented them.  \n  \n## NTLM  \n By default, in the Windows domain environment, Windows authentication uses the Kerberos protocol to authenticate and authorize users. If the Kerberos protocol cannot be used for some reason, NT LAN Manager (NTLM) is used as a fallback. You can disable this behavior by setting the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property to `false`. Issues to be aware of when allowing NTLM include:  \n  \n-   NTLM exposes the client user name. If the user name needs to be kept confidential, then set the `AllowNTLM` property on the binding to `false`.  \n  \n-   NTLM does not provide server authentication. Therefore, the client cannot ensure that it is communicating with the right service when you use NTLM as an authentication protocol.  \n  \n### Specifying Client Credentials or Invalid Identity Forces NTLM Usage  \n When creating a client, specifying client credentials without a domain name, or specifying an invalid server identity, causes NTLM to be used instead of the Kerberos protocol (if the `AlllowNtlm` property is set to `true`). Because  NTLM does not do server authentication, information can potentially be disclosed.  \n  \n For example, it is possible to specify Windows client credentials without a domain name, as shown in the following Visual C# code.  \n  \n```  \nMyChannelFactory.Credentials.Windows.ClientCredential = new System.Net.NetworkCredential(\"username\", \"password\");  \n```  \n  \n The code does not specify a domain name, and therefore NTLM will be used.  \n  \n If the domain is specified, but an invalid service principal name is specified using the endpoint identity feature, then NTLM is used. For more information about how endpoint identity is specified, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).  \n  \n## See also\n\n- [Security Considerations](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)\n- [Elevation of Privilege](../../../../docs/framework/wcf/feature-details/elevation-of-privilege.md)\n- [Denial of Service](../../../../docs/framework/wcf/feature-details/denial-of-service.md)\n- [Tampering](../../../../docs/framework/wcf/feature-details/tampering.md)\n- [Unsupported Scenarios](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)\n- [Replay Attacks](../../../../docs/framework/wcf/feature-details/replay-attacks.md)\n","nodes":[{"pos":[4,106],"embed":true,"restype":"x-metadata","content":"title: \"Information Disclosure\"\nms.date: \"03/30/2017\"\nms.assetid: 4064c89f-afa6-444a-aa7e-807ef072131c","nodes":[{"content":"Information Disclosure","nodes":[{"pos":[0,22],"content":"Information Disclosure","nodes":[{"content":"Information Disclosure","pos":[0,22]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[113,135],"content":"Information Disclosure","linkify":"Information Disclosure","nodes":[{"content":"Information Disclosure","pos":[0,22]}]},{"content":"Information disclosure enables an attacker to gain valuable information about a system.","pos":[136,223]},{"content":"Therefore, always consider what information you are revealing and whether it can be used by a malicious user.","pos":[224,333]},{"content":"The following lists possible information disclosure attacks and provides mitigations for each.","pos":[334,428]},{"pos":[437,462],"content":"Message Security and HTTP","linkify":"Message Security and HTTP","nodes":[{"content":"Message Security and HTTP","pos":[0,25]}]},{"content":"If you are using message-level security over an HTTP transport layer, be aware that message-level security does not protect HTTP headers.","pos":[466,603]},{"content":"The only way to protect HTTP headers is to use HTTPS transport instead of HTTP.","pos":[604,683]},{"content":"HTTPS transport causes the entire message, including the HTTP headers, to be encrypted using the Secure Sockets Layer (SSL) protocol.","pos":[684,817]},{"pos":[826,844],"content":"Policy Information","linkify":"Policy Information","nodes":[{"content":"Policy Information","pos":[0,18]}]},{"content":"Keeping policy secure is important, especially in federation scenarios where sensitive issued-token requirements or token-issuer information is exposed in policy.","pos":[848,1010]},{"content":"In these cases, the recommendation is to secure the federated service's policy endpoint to prevent attackers from obtaining information about the service, such as the type of claims to put in the issued token, or redirecting clients to malicious token issuers.","pos":[1011,1271]},{"content":"For example, an attacker could discover user name/password pairs by reconfiguring the federated trust chain to terminate in an issuer that executed a man-in-the-middle attack.","pos":[1272,1447]},{"content":"It is also recommended that federated clients who obtain their bindings through policy retrieval verify that they trust the issuers in the obtained federated trust chain.","pos":[1448,1618]},{"content":"For more information about federation scenarios, see <bpt id=\"p1\">[</bpt>Federation<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/federation.md)</ept>.","pos":[1619,1747],"source":" For more information about federation scenarios, see [Federation](../../../../docs/framework/wcf/feature-details/federation.md)."},{"pos":[1756,1797],"content":"Memory Dumps Can Reveal Claim Information","linkify":"Memory Dumps Can Reveal Claim Information","nodes":[{"content":"Memory Dumps Can Reveal Claim Information","pos":[0,41]}]},{"content":"When an application fails, log files, such as those produced by Dr. Watson, can contain the claim information.","pos":[1801,1911]},{"content":"This information should not be exported to other entities, such as support teams; otherwise, the claim information that contains private data is also exported.","pos":[1912,2071]},{"content":"You can mitigate this by not sending the log files to unknown entities.","pos":[2072,2143]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Windows Server 2003<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=89160)</ept>.","pos":[2144,2239],"source":" For more information, see [Windows Server 2003](https://go.microsoft.com/fwlink/?LinkId=89160)."},{"pos":[2248,2266],"content":"Endpoint Addresses","linkify":"Endpoint Addresses","nodes":[{"content":"Endpoint Addresses","pos":[0,18]}]},{"content":"An endpoint address contains the information needed to communicate with an endpoint.","pos":[2270,2354]},{"content":"SOAP security must include the address in full in the security negotiation messages that are exchanged in order to negotiate a symmetric key between a client and a server.","pos":[2355,2526]},{"content":"Because security negotiation is a bootstrap process, the address headers cannot be encrypted during this process.","pos":[2527,2640]},{"content":"Therefore, the address should not contain any confidential data; otherwise, it leads to information disclosure attacks.","pos":[2641,2760]},{"pos":[2769,2805],"content":"Certificates Transferred Unencrypted","linkify":"Certificates Transferred Unencrypted","nodes":[{"content":"Certificates Transferred Unencrypted","pos":[0,36]}]},{"content":"When you use an X.509 certificate to authenticate a client, the certificate is transferred in the clear, inside the SOAP header.","pos":[2809,2937]},{"content":"Be aware of this as a potential personally identifiable information (PII) disclosure.","pos":[2938,3023]},{"content":"This is not an issue for <ph id=\"ph1\">`TransportWithMessageCredential`</ph> mode, where the entire message is encrypted with transport-level security.","pos":[3024,3156],"source":" This is not an issue for `TransportWithMessageCredential` mode, where the entire message is encrypted with transport-level security."},{"pos":[3165,3183],"content":"Service References","linkify":"Service References","nodes":[{"content":"Service References","pos":[0,18]}]},{"content":"A service reference is a reference to another service.","pos":[3187,3241]},{"content":"For example, a service may pass a service reference to a client in the course of an operation.","pos":[3242,3336]},{"content":"The service reference is also used with a <bpt id=\"p1\">*</bpt>trust identity verifier<ept id=\"p1\">*</ept>, an internal component that ensures the identity of the target principal before disclosing information such as application data or credentials to the target.","pos":[3337,3562],"source":" The service reference is also used with a *trust identity verifier*, an internal component that ensures the identity of the target principal before disclosing information such as application data or credentials to the target."},{"content":"If the remote trust identity cannot be verified or is incorrect, the sender should ensure that no data was disclosed that could compromise itself, the application, or the user.","pos":[3563,3739]},{"content":"Mitigations include the following:","pos":[3746,3780]},{"content":"Service references are assumed to be trustworthy.","pos":[3790,3839]},{"content":"Take care whenever transferring service reference instances to ensure that they have not been tampered with.","pos":[3840,3948]},{"content":"Some applications can present a user experience that allows interactive establishment of trust based on data in the service reference and trust data proven by the remote host.","pos":[3958,4133]},{"content":"WCF provides extensibility points for such a facility, but the user must implemented them.","pos":[4134,4224]},{"pos":[4233,4237],"content":"NTLM","linkify":"NTLM","nodes":[{"content":"NTLM","pos":[0,4]}]},{"content":"By default, in the Windows domain environment, Windows authentication uses the Kerberos protocol to authenticate and authorize users.","pos":[4241,4374]},{"content":"If the Kerberos protocol cannot be used for some reason, NT LAN Manager (NTLM) is used as a fallback.","pos":[4375,4476]},{"content":"You can disable this behavior by setting the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A&gt;</ph> property to <ph id=\"ph2\">`false`</ph>.","pos":[4477,4615],"source":" You can disable this behavior by setting the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property to `false`."},{"content":"Issues to be aware of when allowing NTLM include:","pos":[4616,4665]},{"content":"NTLM exposes the client user name.","pos":[4675,4709]},{"content":"If the user name needs to be kept confidential, then set the <ph id=\"ph1\">`AllowNTLM`</ph> property on the binding to <ph id=\"ph2\">`false`</ph>.","pos":[4710,4818],"source":" If the user name needs to be kept confidential, then set the `AllowNTLM` property on the binding to `false`."},{"content":"NTLM does not provide server authentication.","pos":[4828,4872]},{"content":"Therefore, the client cannot ensure that it is communicating with the right service when you use NTLM as an authentication protocol.","pos":[4873,5005]},{"pos":[5015,5082],"content":"Specifying Client Credentials or Invalid Identity Forces NTLM Usage","linkify":"Specifying Client Credentials or Invalid Identity Forces NTLM Usage","nodes":[{"content":"Specifying Client Credentials or Invalid Identity Forces NTLM Usage","pos":[0,67]}]},{"content":"When creating a client, specifying client credentials without a domain name, or specifying an invalid server identity, causes NTLM to be used instead of the Kerberos protocol (if the <ph id=\"ph1\">`AlllowNtlm`</ph> property is set to <ph id=\"ph2\">`true`</ph>).","pos":[5086,5309],"source":"When creating a client, specifying client credentials without a domain name, or specifying an invalid server identity, causes NTLM to be used instead of the Kerberos protocol (if the `AlllowNtlm` property is set to `true`)."},{"content":"Because  NTLM does not do server authentication, information can potentially be disclosed.","pos":[5310,5400]},{"content":"For example, it is possible to specify Windows client credentials without a domain name, as shown in the following Visual C# code.","pos":[5407,5537]},{"content":"The code does not specify a domain name, and therefore NTLM will be used.","pos":[5675,5748]},{"content":"If the domain is specified, but an invalid service principal name is specified using the endpoint identity feature, then NTLM is used.","pos":[5755,5889]},{"content":"For more information about how endpoint identity is specified, see <bpt id=\"p1\">[</bpt>Service Identity and Authentication<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)</ept>.","pos":[5890,6082],"source":" For more information about how endpoint identity is specified, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)."},{"pos":[6091,6099],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6103,6210],"content":"<bpt id=\"p1\">[</bpt>Security Considerations<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)</ept>","source":"[Security Considerations](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)"},{"pos":[6213,6311],"content":"<bpt id=\"p1\">[</bpt>Elevation of Privilege<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/elevation-of-privilege.md)</ept>","source":"[Elevation of Privilege](../../../../docs/framework/wcf/feature-details/elevation-of-privilege.md)"},{"pos":[6314,6402],"content":"<bpt id=\"p1\">[</bpt>Denial of Service<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/denial-of-service.md)</ept>","source":"[Denial of Service](../../../../docs/framework/wcf/feature-details/denial-of-service.md)"},{"pos":[6405,6477],"content":"<bpt id=\"p1\">[</bpt>Tampering<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/tampering.md)</ept>","source":"[Tampering](../../../../docs/framework/wcf/feature-details/tampering.md)"},{"pos":[6480,6576],"content":"<bpt id=\"p1\">[</bpt>Unsupported Scenarios<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)</ept>","source":"[Unsupported Scenarios](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)"},{"pos":[6579,6661],"content":"<bpt id=\"p1\">[</bpt>Replay Attacks<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/replay-attacks.md)</ept>","source":"[Replay Attacks](../../../../docs/framework/wcf/feature-details/replay-attacks.md)"}]}