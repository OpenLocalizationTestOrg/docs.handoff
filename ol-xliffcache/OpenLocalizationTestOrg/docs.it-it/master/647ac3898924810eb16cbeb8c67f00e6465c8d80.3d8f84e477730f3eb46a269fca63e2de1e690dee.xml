{"content":"---\ntitle: \"How to: Decrypt XML Elements with Asymmetric Keys\"\nms.date: \"03/30/2017\"\nms.technology: dotnet-standard\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"System.Security.Cryptography.RSACryptoServiceProvider class\"\n  - \"asymmetric keys\"\n  - \"System.Security.Cryptography.EncryptedXml class\"\n  - \"XML encryption\"\n  - \"decryption\"\nms.assetid: dd5de491-dafe-4b94-966d-99714b2e754a\nauthor: \"mairaw\"\nms.author: \"mairaw\"\n---\n# How to: Decrypt XML Elements with Asymmetric Keys\nYou can use the classes in the <xref:System.Security.Cryptography.Xml> namespace to encrypt and decrypt an element within an XML document.  XML Encryption is a standard way to exchange or store encrypted XML data, without worrying about the data being easily read.  For more information about the XML Encryption standard, see the World Wide Web Consortium (W3C) recommendation [XML Signature Syntax and Processing](https://www.w3.org/TR/xmldsig-core/).  \n  \n The example in this procedure decrypts an XML element that was encrypted using the methods described in [How to: Encrypt XML Elements with Asymmetric Keys](../../../docs/standard/security/how-to-encrypt-xml-elements-with-asymmetric-keys.md).  It finds an <`EncryptedData`> element, decrypts the element, and then replaces the element with the original plaintext XML element.  \n  \n This example decrypts an XML element using two keys.  It retrieves a previously generated RSA private key from a key container, and then uses the RSA key to decrypt a session key stored in the <`EncryptedKey`> element of the <`EncryptedData`> element.  The example then uses the session key to decrypt the XML element.  \n  \n This example is appropriate for situations where multiple applications have to share encrypted data or where an application has to save encrypted data between the times that it runs.  \n  \n### To decrypt an XML element with an asymmetric key  \n  \n1.  Create a <xref:System.Security.Cryptography.CspParameters> object and specify the name of the key container.  \n  \n     [!code-csharp[HowToDecryptXMLElementAsymmetric#2](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/cs/sample.cs#2)]\n     [!code-vb[HowToDecryptXMLElementAsymmetric#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/vb/sample.vb#2)]  \n  \n2.  Retrieve a previously generated asymmetric key from the container using the <xref:System.Security.Cryptography.RSACryptoServiceProvider> object.  The key is automatically retrieved from the key container when you pass the <xref:System.Security.Cryptography.CspParameters> object to the <xref:System.Security.Cryptography.RSACryptoServiceProvider> constructor.  \n  \n     [!code-csharp[HowToDecryptXMLElementAsymmetric#3](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/cs/sample.cs#3)]\n     [!code-vb[HowToDecryptXMLElementAsymmetric#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/vb/sample.vb#3)]  \n  \n3.  Create a new <xref:System.Security.Cryptography.Xml.EncryptedXml> object to decrypt the document.  \n  \n     [!code-csharp[HowToDecryptXMLElementAsymmetric#5](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/cs/sample.cs#5)]\n     [!code-vb[HowToDecryptXMLElementAsymmetric#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/vb/sample.vb#5)]  \n  \n4.  Add a key/name mapping to associate the RSA key with the element within the document that should be decrypted.  You must use the same name for the key that you used when you encrypted the document.  Note that this name is separate from the name used to identify the key in the key container specified in step 1.  \n  \n     [!code-csharp[HowToDecryptXMLElementAsymmetric#6](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/cs/sample.cs#6)]\n     [!code-vb[HowToDecryptXMLElementAsymmetric#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/vb/sample.vb#6)]  \n  \n5.  Call the <xref:System.Security.Cryptography.Xml.EncryptedXml.DecryptDocument%2A> method to decrypt the <`EncryptedData`> element.  This method uses the RSA key to decrypt the session key and automatically uses the session key to decrypt the XML element.  It also automatically replaces the <`EncryptedData`> element with the original plaintext.  \n  \n     [!code-csharp[HowToDecryptXMLElementAsymmetric#7](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/cs/sample.cs#7)]\n     [!code-vb[HowToDecryptXMLElementAsymmetric#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/vb/sample.vb#7)]  \n  \n6.  Save the XML document.  \n  \n     [!code-csharp[HowToDecryptXMLElementAsymmetric#8](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/cs/sample.cs#8)]\n     [!code-vb[HowToDecryptXMLElementAsymmetric#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/vb/sample.vb#8)]  \n  \n## Example  \n This example assumes that a file named `test.xml` exists in the same directory as the compiled program.  It also assumes that `test.xml` contains an XML element that was encrypted using the techniques described in [How to: Encrypt XML Elements with Asymmetric Keys](../../../docs/standard/security/how-to-encrypt-xml-elements-with-asymmetric-keys.md).  \n  \n [!code-csharp[HowToDecryptXMLElementAsymmetric#1](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/cs/sample.cs#1)]\n [!code-vb[HowToDecryptXMLElementAsymmetric#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/vb/sample.vb#1)]  \n  \n## Compiling the Code  \n  \n-   To compile this example, you need to include a reference to `System.Security.dll`.  \n  \n-   Include the following namespaces: <xref:System.Xml>, <xref:System.Security.Cryptography>, and <xref:System.Security.Cryptography.Xml>.  \n  \n## .NET Framework Security  \n Never store a symmetric cryptographic key in plaintext or transfer a symmetric key between machines in plaintext.  Additionally, never store or transfer the private key of an asymmetric key pair in plaintext.  For more information about symmetric and asymmetric cryptographic keys, see [Generating Keys for Encryption and Decryption](../../../docs/standard/security/generating-keys-for-encryption-and-decryption.md).  \n  \n Never embed a key directly into your source code.  Embedded keys can be easily read from an assembly by using [Ildasm.exe (IL Disassembler)](../../../docs/framework/tools/ildasm-exe-il-disassembler.md) or by opening the assembly in a text editor such as Notepad.  \n  \n When you are done using a cryptographic key, clear it from memory by setting each byte to zero or by calling the <xref:System.Security.Cryptography.SymmetricAlgorithm.Clear%2A> method of the managed cryptography class.  Cryptographic keys can sometimes be read from memory by a debugger or read from a hard drive if the memory location is paged to disk.  \n  \n## See also\n\n- <xref:System.Security.Cryptography.Xml>\n- [How to: Encrypt XML Elements with Asymmetric Keys](../../../docs/standard/security/how-to-encrypt-xml-elements-with-asymmetric-keys.md)\n","nodes":[{"pos":[4,437],"embed":true,"restype":"x-metadata","content":"title: \"How to: Decrypt XML Elements with Asymmetric Keys\"\nms.date: \"03/30/2017\"\nms.technology: dotnet-standard\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"System.Security.Cryptography.RSACryptoServiceProvider class\"\n  - \"asymmetric keys\"\n  - \"System.Security.Cryptography.EncryptedXml class\"\n  - \"XML encryption\"\n  - \"decryption\"\nms.assetid: dd5de491-dafe-4b94-966d-99714b2e754a\nauthor: \"mairaw\"\nms.author: \"mairaw\"","nodes":[{"content":"How to: Decrypt XML Elements with Asymmetric Keys","nodes":[{"pos":[0,49],"content":"How to: Decrypt XML Elements with Asymmetric Keys","nodes":[{"content":"How to: Decrypt XML Elements with Asymmetric Keys","pos":[0,49]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[444,493],"content":"How to: Decrypt XML Elements with Asymmetric Keys","linkify":"How to: Decrypt XML Elements with Asymmetric Keys","nodes":[{"content":"How to: Decrypt XML Elements with Asymmetric Keys","pos":[0,49]}]},{"content":"You can use the classes in the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.Xml&gt;</ph> namespace to encrypt and decrypt an element within an XML document.","pos":[494,632],"source":"You can use the classes in the <xref:System.Security.Cryptography.Xml> namespace to encrypt and decrypt an element within an XML document."},{"content":"XML Encryption is a standard way to exchange or store encrypted XML data, without worrying about the data being easily read.","pos":[634,758]},{"content":"For more information about the XML Encryption standard, see the World Wide Web Consortium (W3C) recommendation <bpt id=\"p1\">[</bpt>XML Signature Syntax and Processing<ept id=\"p1\">](https://www.w3.org/TR/xmldsig-core/)</ept>.","pos":[760,946],"source":"  For more information about the XML Encryption standard, see the World Wide Web Consortium (W3C) recommendation [XML Signature Syntax and Processing](https://www.w3.org/TR/xmldsig-core/)."},{"content":"The example in this procedure decrypts an XML element that was encrypted using the methods described in <bpt id=\"p1\">[</bpt>How to: Encrypt XML Elements with Asymmetric Keys<ept id=\"p1\">](../../../docs/standard/security/how-to-encrypt-xml-elements-with-asymmetric-keys.md)</ept>.","pos":[953,1194],"source":"The example in this procedure decrypts an XML element that was encrypted using the methods described in [How to: Encrypt XML Elements with Asymmetric Keys](../../../docs/standard/security/how-to-encrypt-xml-elements-with-asymmetric-keys.md)."},{"content":"It finds an &lt;<ph id=\"ph1\">`EncryptedData`</ph>&gt; element, decrypts the element, and then replaces the element with the original plaintext XML element.","pos":[1196,1327],"source":"  It finds an <`EncryptedData`> element, decrypts the element, and then replaces the element with the original plaintext XML element."},{"content":"This example decrypts an XML element using two keys.","pos":[1334,1386]},{"content":"It retrieves a previously generated RSA private key from a key container, and then uses the RSA key to decrypt a session key stored in the &lt;<ph id=\"ph1\">`EncryptedKey`</ph>&gt; element of the &lt;<ph id=\"ph2\">`EncryptedData`</ph>&gt; element.","pos":[1388,1585],"source":"  It retrieves a previously generated RSA private key from a key container, and then uses the RSA key to decrypt a session key stored in the <`EncryptedKey`> element of the <`EncryptedData`> element."},{"content":"The example then uses the session key to decrypt the XML element.","pos":[1587,1652]},{"content":"This example is appropriate for situations where multiple applications have to share encrypted data or where an application has to save encrypted data between the times that it runs.","pos":[1659,1841]},{"pos":[1851,1899],"content":"To decrypt an XML element with an asymmetric key","linkify":"To decrypt an XML element with an asymmetric key","nodes":[{"content":"To decrypt an XML element with an asymmetric key","pos":[0,48]}]},{"pos":[1909,2017],"content":"Create a <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.CspParameters&gt;</ph> object and specify the name of the key container.","source":"Create a <xref:System.Security.Cryptography.CspParameters> object and specify the name of the key container."},{"pos":[2028,2331],"content":"[!code-csharp[HowToDecryptXMLElementAsymmetric#2](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/cs/sample.cs#2)]\n [!code-vb[HowToDecryptXMLElementAsymmetric#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/vb/sample.vb#2)]","leadings":["","    "],"nodes":[]},{"content":"Retrieve a previously generated asymmetric key from the container using the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.RSACryptoServiceProvider&gt;</ph> object.","pos":[2341,2485],"source":"Retrieve a previously generated asymmetric key from the container using the <xref:System.Security.Cryptography.RSACryptoServiceProvider> object."},{"content":"The key is automatically retrieved from the key container when you pass the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.CspParameters&gt;</ph> object to the <ph id=\"ph2\">&lt;xref:System.Security.Cryptography.RSACryptoServiceProvider&gt;</ph> constructor.","pos":[2487,2700],"source":"  The key is automatically retrieved from the key container when you pass the <xref:System.Security.Cryptography.CspParameters> object to the <xref:System.Security.Cryptography.RSACryptoServiceProvider> constructor."},{"pos":[2711,3014],"content":"[!code-csharp[HowToDecryptXMLElementAsymmetric#3](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/cs/sample.cs#3)]\n [!code-vb[HowToDecryptXMLElementAsymmetric#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/vb/sample.vb#3)]","leadings":["","    "],"nodes":[]},{"pos":[3024,3121],"content":"Create a new <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.Xml.EncryptedXml&gt;</ph> object to decrypt the document.","source":"Create a new <xref:System.Security.Cryptography.Xml.EncryptedXml> object to decrypt the document."},{"pos":[3132,3435],"content":"[!code-csharp[HowToDecryptXMLElementAsymmetric#5](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/cs/sample.cs#5)]\n [!code-vb[HowToDecryptXMLElementAsymmetric#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/vb/sample.vb#5)]","leadings":["","    "],"nodes":[]},{"content":"Add a key/name mapping to associate the RSA key with the element within the document that should be decrypted.","pos":[3445,3555]},{"content":"You must use the same name for the key that you used when you encrypted the document.","pos":[3557,3642]},{"content":"Note that this name is separate from the name used to identify the key in the key container specified in step 1.","pos":[3644,3756]},{"pos":[3767,4070],"content":"[!code-csharp[HowToDecryptXMLElementAsymmetric#6](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/cs/sample.cs#6)]\n [!code-vb[HowToDecryptXMLElementAsymmetric#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/vb/sample.vb#6)]","leadings":["","    "],"nodes":[]},{"content":"Call the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.Xml.EncryptedXml.DecryptDocument%2A&gt;</ph> method to decrypt the &lt;<ph id=\"ph2\">`EncryptedData`</ph>&gt; element.","pos":[4080,4209],"source":"Call the <xref:System.Security.Cryptography.Xml.EncryptedXml.DecryptDocument%2A> method to decrypt the <`EncryptedData`> element."},{"content":"This method uses the RSA key to decrypt the session key and automatically uses the session key to decrypt the XML element.","pos":[4211,4333]},{"content":"It also automatically replaces the &lt;<ph id=\"ph1\">`EncryptedData`</ph>&gt; element with the original plaintext.","pos":[4335,4424],"source":"  It also automatically replaces the <`EncryptedData`> element with the original plaintext."},{"pos":[4435,4738],"content":"[!code-csharp[HowToDecryptXMLElementAsymmetric#7](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/cs/sample.cs#7)]\n [!code-vb[HowToDecryptXMLElementAsymmetric#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/vb/sample.vb#7)]","leadings":["","    "],"nodes":[]},{"content":"Save the XML document.","pos":[4748,4770]},{"pos":[4781,5084],"content":"[!code-csharp[HowToDecryptXMLElementAsymmetric#8](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/cs/sample.cs#8)]\n [!code-vb[HowToDecryptXMLElementAsymmetric#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToDecryptXMLElementAsymmetric/vb/sample.vb#8)]","leadings":["","    "],"nodes":[]},{"pos":[5093,5100],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"This example assumes that a file named <ph id=\"ph1\">`test.xml`</ph> exists in the same directory as the compiled program.","pos":[5104,5207],"source":"This example assumes that a file named `test.xml` exists in the same directory as the compiled program."},{"content":"It also assumes that <ph id=\"ph1\">`test.xml`</ph> contains an XML element that was encrypted using the techniques described in <bpt id=\"p1\">[</bpt>How to: Encrypt XML Elements with Asymmetric Keys<ept id=\"p1\">](../../../docs/standard/security/how-to-encrypt-xml-elements-with-asymmetric-keys.md)</ept>.","pos":[5209,5455],"source":"  It also assumes that `test.xml` contains an XML element that was encrypted using the techniques described in [How to: Encrypt XML Elements with Asymmetric Keys](../../../docs/standard/security/how-to-encrypt-xml-elements-with-asymmetric-keys.md)."},{"pos":[5770,5788],"content":"Compiling the Code","linkify":"Compiling the Code","nodes":[{"content":"Compiling the Code","pos":[0,18]}]},{"pos":[5798,5880],"content":"To compile this example, you need to include a reference to <ph id=\"ph1\">`System.Security.dll`</ph>.","source":"To compile this example, you need to include a reference to `System.Security.dll`."},{"pos":[5890,6024],"content":"Include the following namespaces: <ph id=\"ph1\">&lt;xref:System.Xml&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.Security.Cryptography&gt;</ph>, and <ph id=\"ph3\">&lt;xref:System.Security.Cryptography.Xml&gt;</ph>.","source":"Include the following namespaces: <xref:System.Xml>, <xref:System.Security.Cryptography>, and <xref:System.Security.Cryptography.Xml>."},{"pos":[6033,6056],"content":".NET Framework Security","linkify":".NET Framework Security","nodes":[{"content":".NET Framework Security","pos":[0,23]}]},{"content":"Never store a symmetric cryptographic key in plaintext or transfer a symmetric key between machines in plaintext.","pos":[6060,6173]},{"content":"Additionally, never store or transfer the private key of an asymmetric key pair in plaintext.","pos":[6175,6268]},{"content":"For more information about symmetric and asymmetric cryptographic keys, see <bpt id=\"p1\">[</bpt>Generating Keys for Encryption and Decryption<ept id=\"p1\">](../../../docs/standard/security/generating-keys-for-encryption-and-decryption.md)</ept>.","pos":[6270,6476],"source":"  For more information about symmetric and asymmetric cryptographic keys, see [Generating Keys for Encryption and Decryption](../../../docs/standard/security/generating-keys-for-encryption-and-decryption.md)."},{"content":"Never embed a key directly into your source code.","pos":[6483,6532]},{"content":"Embedded keys can be easily read from an assembly by using <bpt id=\"p1\">[</bpt>Ildasm.exe (IL Disassembler)<ept id=\"p1\">](../../../docs/framework/tools/ildasm-exe-il-disassembler.md)</ept> or by opening the assembly in a text editor such as Notepad.","pos":[6534,6745],"source":"  Embedded keys can be easily read from an assembly by using [Ildasm.exe (IL Disassembler)](../../../docs/framework/tools/ildasm-exe-il-disassembler.md) or by opening the assembly in a text editor such as Notepad."},{"content":"When you are done using a cryptographic key, clear it from memory by setting each byte to zero or by calling the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.SymmetricAlgorithm.Clear%2A&gt;</ph> method of the managed cryptography class.","pos":[6752,6970],"source":"When you are done using a cryptographic key, clear it from memory by setting each byte to zero or by calling the <xref:System.Security.Cryptography.SymmetricAlgorithm.Clear%2A> method of the managed cryptography class."},{"content":"Cryptographic keys can sometimes be read from memory by a debugger or read from a hard drive if the memory location is paged to disk.","pos":[6972,7105]},{"pos":[7114,7122],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[7168,7304],"content":"<bpt id=\"p1\">[</bpt>How to: Encrypt XML Elements with Asymmetric Keys<ept id=\"p1\">](../../../docs/standard/security/how-to-encrypt-xml-elements-with-asymmetric-keys.md)</ept>","source":"[How to: Encrypt XML Elements with Asymmetric Keys](../../../docs/standard/security/how-to-encrypt-xml-elements-with-asymmetric-keys.md)"}]}