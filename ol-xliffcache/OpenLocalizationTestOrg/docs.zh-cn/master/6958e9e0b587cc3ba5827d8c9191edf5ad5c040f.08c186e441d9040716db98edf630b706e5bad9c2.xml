{"content":"---\ntitle: \"Confirmation | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 8637aeaf-ac9e-49b8-93f4-da15dee45277\ncaps.latest.revision: 7\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Confirmation\nThis sample shows four common scenarios surrounding the use of <xref:System.Activities.Statements.CompensableActivity> and confirmation. The sample runs four workflows to show confirmation. This sample is available in declarative and imperative versions.  \n  \n## Confirm a Compensable Activity  \n The first workflow demonstrates how to confirm a compensable activity and consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity> instances. After the completion of the second <xref:System.Activities.Statements.CompensableActivity> a confirm activity confirms the first activity. When the workflow successfully completes, all <xref:System.Activities.Statements.CompensableActivity> instances that have not been confirmed or compensated are automatically confirmed using the default order. Without the confirm, the second <xref:System.Activities.Statements.CompensableActivity> would have been confirmed first.  \n  \n## Explicit Compensation  \n The second scenario shows the affect on default confirmation when a <xref:System.Activities.Statements.CompensableActivity> is explicitly compensated. The workflow consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity> activities, after the second completes the first is explicitly compensated. As a result when the workflow, completes only the second <xref:System.Activities.Statements.CompensableActivity> is confirmed.  \n  \n## Controlling the Order of Confirmation for Nested CompensableActivity Activities  \n The third scenario shows how to control the order of confirmation for nested <xref:System.Activities.Statements.CompensableActivity>. The scenario consists of a <xref:System.Activities.Statements.CompensableActivity> as the root of the workflow. The body of the root <xref:System.Activities.Statements.CompensableActivity> is a sequence of three <xref:System.Activities.Statements.CompensableActivity>. The <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> for the root <xref:System.Activities.Statements.CompensableActivity> is a sequence that specifies to confirm the first then the second nested <xref:System.Activities.Statements.CompensableActivity>. When the workflow completes it confirms the root <xref:System.Activities.Statements.CompensableActivity>, which then confirms the first, second and third nested <xref:System.Activities.Statements.CompensableActivity>, in that order. As a result, the default confirmation order is essentially reversed. Because the third <xref:System.Activities.Statements.CompensableActivity> was not explicitly confirmed as part of the root <xref:System.Activities.Statements.CompensableActivity> by the <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A>, it is confirmed according to the default order. However, because it is the only unconfirmed <xref:System.Activities.Statements.CompensableActivity> this just means it is confirmed.  \n  \n## Scoping of Variables  \n The fourth scenario shows how the lifetime of variables defined for a <xref:System.Activities.Statements.CompensableActivity> or one of their parents are still in scope when the <xref:System.Activities.Statements.CompensableActivity.CompensationHandler%2A>, <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> or <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> handlers are executed even if the activity has completed or the workflow has completed. The workflow consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity>. In the body of the first, the variable `mySum` is set to the sum of 5 and 10 and the result printed. In the body of the second <xref:System.Activities.Statements.CompensableActivity>, the sum is set to the sum of the existing sum and 7 and the result printed. A custom confirmation handler is defined for the first <xref:System.Activities.Statements.CompensableActivity>, which prints the sum, subtracts 7 and prints the sum again. It is clear by inspecting the printed sums that the variable is in scope not only for the bodies of both <xref:System.Activities.Statements.CompensableActivity> but the <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> as well.  \n  \n#### To run the sample  \n  \n1.  Load the solution in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].  \n  \n2.  Run the ConfirmationSample.exe application.  \n  \n3.  Observe the following output:  \n  \n **Explicit confirmation:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: Confirmation HandlerEnd of workflowCompensableActivity2: Confirmation HandlerExplicit compensation:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: Compensation HandlerEnd of workflowCompensableActivity2: Confirmation HandlerCustom confirmation handler:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity3: BodyEnd of workflowCompensableActivity1: Confirmation HandlerCompensableActivity2: Confirmation HandlerCompensableActivity3: Confirmation HandlerVariable access in a confirmation handler:Start of workflowCompensableActivity1: BodyCompensableActivity1: The sum is: 15CompensableActivity2: BodyCompensableActivity2: Adding 7 to the sumCompensableActivity2: The sum is now: 22End of workflowCompensableActivity2: Confirmation HandlerCompensableActivity1: Confirmation HandlerCompensableActivity2: The sum is: 22CompensableActivity2: After subtracting 12 the sum is now: 10Press ENTER to exit.**  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Basic\\Compensation\\Confirmation`  \n  \n## See Also","nodes":[{"pos":[12,41],"content":"Confirmation | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Confirmation | Microsoft Docs","pos":[0,29]}]},{"pos":[306,318],"content":"Confirmation","linkify":"Confirmation","nodes":[{"content":"Confirmation","pos":[0,12]}]},{"content":"This sample shows four common scenarios surrounding the use of <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph> and confirmation.","pos":[319,455],"source":"This sample shows four common scenarios surrounding the use of <xref:System.Activities.Statements.CompensableActivity> and confirmation."},{"content":"The sample runs four workflows to show confirmation.","pos":[456,508]},{"content":"This sample is available in declarative and imperative versions.","pos":[509,573]},{"pos":[582,612],"content":"Confirm a Compensable Activity","linkify":"Confirm a Compensable Activity","nodes":[{"content":"Confirm a Compensable Activity","pos":[0,30]}]},{"content":"The first workflow demonstrates how to confirm a compensable activity and consists of a sequence of two <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph> instances.","pos":[616,786],"source":"The first workflow demonstrates how to confirm a compensable activity and consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity> instances."},{"content":"After the completion of the second <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph> a confirm activity confirms the first activity.","pos":[787,925],"source":" After the completion of the second <xref:System.Activities.Statements.CompensableActivity> a confirm activity confirms the first activity."},{"content":"When the workflow successfully completes, all <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph> instances that have not been confirmed or compensated are automatically confirmed using the default order.","pos":[926,1134],"source":" When the workflow successfully completes, all <xref:System.Activities.Statements.CompensableActivity> instances that have not been confirmed or compensated are automatically confirmed using the default order."},{"content":"Without the confirm, the second <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph> would have been confirmed first.","pos":[1135,1255],"source":" Without the confirm, the second <xref:System.Activities.Statements.CompensableActivity> would have been confirmed first."},{"pos":[1264,1285],"content":"Explicit Compensation","linkify":"Explicit Compensation","nodes":[{"content":"Explicit Compensation","pos":[0,21]}]},{"content":"The second scenario shows the affect on default confirmation when a <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph> is explicitly compensated.","pos":[1289,1439],"source":"The second scenario shows the affect on default confirmation when a <xref:System.Activities.Statements.CompensableActivity> is explicitly compensated."},{"content":"The workflow consists of a sequence of two <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph> activities, after the second completes the first is explicitly compensated.","pos":[1440,1614],"source":" The workflow consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity> activities, after the second completes the first is explicitly compensated."},{"content":"As a result when the workflow, completes only the second <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph> is confirmed.","pos":[1615,1741],"source":" As a result when the workflow, completes only the second <xref:System.Activities.Statements.CompensableActivity> is confirmed."},{"pos":[1750,1829],"content":"Controlling the Order of Confirmation for Nested CompensableActivity Activities","linkify":"Controlling the Order of Confirmation for Nested CompensableActivity Activities","nodes":[{"content":"Controlling the Order of Confirmation for Nested CompensableActivity Activities","pos":[0,79]}]},{"content":"The third scenario shows how to control the order of confirmation for nested <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph>.","pos":[1833,1966],"source":"The third scenario shows how to control the order of confirmation for nested <xref:System.Activities.Statements.CompensableActivity>."},{"content":"The scenario consists of a <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph> as the root of the workflow.","pos":[1967,2078],"source":" The scenario consists of a <xref:System.Activities.Statements.CompensableActivity> as the root of the workflow."},{"content":"The body of the root <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph> is a sequence of three <ph id=\"ph2\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph>.","pos":[2079,2235],"source":" The body of the root <xref:System.Activities.Statements.CompensableActivity> is a sequence of three <xref:System.Activities.Statements.CompensableActivity>."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A&gt;</ph> for the root <ph id=\"ph2\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph> is a sequence that specifies to confirm the first then the second nested <ph id=\"ph3\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph>.","pos":[2236,2517],"source":" The <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> for the root <xref:System.Activities.Statements.CompensableActivity> is a sequence that specifies to confirm the first then the second nested <xref:System.Activities.Statements.CompensableActivity>."},{"content":"When the workflow completes it confirms the root <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph>, which then confirms the first, second and third nested <ph id=\"ph2\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph>, in that order.","pos":[2518,2750],"source":" When the workflow completes it confirms the root <xref:System.Activities.Statements.CompensableActivity>, which then confirms the first, second and third nested <xref:System.Activities.Statements.CompensableActivity>, in that order."},{"content":"As a result, the default confirmation order is essentially reversed.","pos":[2751,2819]},{"content":"Because the third <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph> was not explicitly confirmed as part of the root <ph id=\"ph2\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph> by the <ph id=\"ph3\">&lt;xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A&gt;</ph>, it is confirmed according to the default order.","pos":[2820,3133],"source":" Because the third <xref:System.Activities.Statements.CompensableActivity> was not explicitly confirmed as part of the root <xref:System.Activities.Statements.CompensableActivity> by the <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A>, it is confirmed according to the default order."},{"content":"However, because it is the only unconfirmed <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph> this just means it is confirmed.","pos":[3134,3266],"source":" However, because it is the only unconfirmed <xref:System.Activities.Statements.CompensableActivity> this just means it is confirmed."},{"pos":[3275,3295],"content":"Scoping of Variables","linkify":"Scoping of Variables","nodes":[{"content":"Scoping of Variables","pos":[0,20]}]},{"content":"The fourth scenario shows how the lifetime of variables defined for a <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph> or one of their parents are still in scope when the <ph id=\"ph2\">&lt;xref:System.Activities.Statements.CompensableActivity.CompensationHandler%2A&gt;</ph>, <ph id=\"ph3\">&lt;xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A&gt;</ph> or <ph id=\"ph4\">&lt;xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A&gt;</ph> handlers are executed even if the activity has completed or the workflow has completed.","pos":[3299,3805],"source":"The fourth scenario shows how the lifetime of variables defined for a <xref:System.Activities.Statements.CompensableActivity> or one of their parents are still in scope when the <xref:System.Activities.Statements.CompensableActivity.CompensationHandler%2A>, <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> or <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> handlers are executed even if the activity has completed or the workflow has completed."},{"content":"The workflow consists of a sequence of two <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph>.","pos":[3806,3905],"source":" The workflow consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity>."},{"content":"In the body of the first, the variable <ph id=\"ph1\">`mySum`</ph> is set to the sum of 5 and 10 and the result printed.","pos":[3906,4006],"source":" In the body of the first, the variable `mySum` is set to the sum of 5 and 10 and the result printed."},{"content":"In the body of the second <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph>, the sum is set to the sum of the existing sum and 7 and the result printed.","pos":[4007,4165],"source":" In the body of the second <xref:System.Activities.Statements.CompensableActivity>, the sum is set to the sum of the existing sum and 7 and the result printed."},{"content":"A custom confirmation handler is defined for the first <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph>, which prints the sum, subtracts 7 and prints the sum again.","pos":[4166,4337],"source":" A custom confirmation handler is defined for the first <xref:System.Activities.Statements.CompensableActivity>, which prints the sum, subtracts 7 and prints the sum again."},{"content":"It is clear by inspecting the printed sums that the variable is in scope not only for the bodies of both <ph id=\"ph1\">&lt;xref:System.Activities.Statements.CompensableActivity&gt;</ph> but the <ph id=\"ph2\">&lt;xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A&gt;</ph> as well.","pos":[4338,4594],"source":" It is clear by inspecting the printed sums that the variable is in scope not only for the bodies of both <xref:System.Activities.Statements.CompensableActivity> but the <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> as well."},{"pos":[4605,4622],"content":"To run the sample","linkify":"To run the sample","nodes":[{"content":"To run the sample","pos":[0,17]}]},{"pos":[4632,4707],"content":"Load the solution in <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph>.","source":"Load the solution in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]."},{"content":"Run the ConfirmationSample.exe application.","pos":[4717,4760]},{"content":"Observe the following output:","pos":[4770,4799]},{"pos":[4806,5898],"content":"<bpt id=\"p1\">**</bpt>Explicit confirmation:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: Confirmation HandlerEnd of workflowCompensableActivity2: Confirmation HandlerExplicit compensation:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: Compensation HandlerEnd of workflowCompensableActivity2: Confirmation HandlerCustom confirmation handler:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity3: BodyEnd of workflowCompensableActivity1: Confirmation HandlerCompensableActivity2: Confirmation HandlerCompensableActivity3: Confirmation HandlerVariable access in a confirmation handler:Start of workflowCompensableActivity1: BodyCompensableActivity1: The sum is: 15CompensableActivity2: BodyCompensableActivity2: Adding 7 to the sumCompensableActivity2: The sum is now: 22End of workflowCompensableActivity2: Confirmation HandlerCompensableActivity1: Confirmation HandlerCompensableActivity2: The sum is: 22CompensableActivity2: After subtracting 12 the sum is now: 10Press ENTER to exit.<ept id=\"p1\">**</ept>","source":"**Explicit confirmation:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: Confirmation HandlerEnd of workflowCompensableActivity2: Confirmation HandlerExplicit compensation:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: Compensation HandlerEnd of workflowCompensableActivity2: Confirmation HandlerCustom confirmation handler:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity3: BodyEnd of workflowCompensableActivity1: Confirmation HandlerCompensableActivity2: Confirmation HandlerCompensableActivity3: Confirmation HandlerVariable access in a confirmation handler:Start of workflowCompensableActivity1: BodyCompensableActivity1: The sum is: 15CompensableActivity2: BodyCompensableActivity2: Adding 7 to the sumCompensableActivity2: The sum is now: 22End of workflowCompensableActivity2: Confirmation HandlerCompensableActivity1: Confirmation HandlerCompensableActivity2: The sum is: 22CompensableActivity2: After subtracting 12 the sum is now: 10Press ENTER to exit.**"},{"pos":[5906,6038],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[6092,6418],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[6419,6469]},{"pos":[6556,6564],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]}]}