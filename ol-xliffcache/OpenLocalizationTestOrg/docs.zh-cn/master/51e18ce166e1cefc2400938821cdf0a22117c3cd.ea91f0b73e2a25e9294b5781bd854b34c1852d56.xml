{"content":"---\ntitle: \"Securing Workflow Services | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 53f84ad5-1ed1-4114-8d0d-b12e8a021c6e\ncaps.latest.revision: 10\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Securing Workflow Services\nThe Secured Workflow Service sample shows the following procedures:  \n  \n-   Creating a basic workflow service using the <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.SendReply> activities.  \n  \n-   Using [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] configuration to define secure endpoints for use by the workflow service.  \n  \n-   Creating claims inside a custom policy and using the <xref:System.ServiceModel.ServiceAuthorizationManager> to validate claims.  \n  \n## Demonstrates  \n Using WCF security to secure communication between client and Workflow service, Claims based authorization  \n  \n## Discussion  \n This sample demonstrates the use of [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] security infrastructure to secure a workflow service just like you would with a normal [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service. Specifically, it uses a custom claim for authorization. In this case, it uses <xref:System.ServiceModel.WSHttpBinding> and message mode security with Windows credentials.  \n  \n The custom <xref:System.IdentityModel.Policy.IAuthorizationPolicy> (`CustomNameCheckerPolicy`) checks the client's Windows username and for a specific character. If that character is present, it creates and adds the claim to the <xref:System.IdentityModel.Policy.EvaluationContext>. By doing this, the custom policy is making the statement that the client has this character in the username. This claim can be queried throughout the lifetime of the call. You can find that character in `Constants.cs`.  \n  \n The authorization policy looks for the claim inside the `SecureWorkFlowAuthZManager`. If it finds it, it returns `true` and allow the workflow to proceed. Otherwise, it returns `false`, which causes an 'Access Denied' message to be returned to the client. Other claims are present in the context and can be examined as well inside the `SecureWorkFlowAuthZManager`.  \n  \n#### To run this sample  \n  \n1.  Run [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] with administrator privileges.  \n  \n2.  Load SecuringWorkflowServices.sln in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].  \n  \n3.  Press CTRL+SHIFT+B to compile the solution.  \n  \n4.  Set the Service project as the start-up project for the solution.  \n  \n5.  Press CTRL+F5 to start the service without debugging.  \n  \n6.  Set the Client project as the start-up project for the solution.  \n  \n7.  Press CTRL+F5 to start the client without debugging.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Scenario\\Services\\SecuringWorkflowServices`","nodes":[{"pos":[12,55],"content":"Securing Workflow Services | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Securing Workflow Services | Microsoft Docs","pos":[0,43]}]},{"pos":[321,347],"content":"Securing Workflow Services","linkify":"Securing Workflow Services","nodes":[{"content":"Securing Workflow Services","pos":[0,26]}]},{"content":"The Secured Workflow Service sample shows the following procedures:","pos":[348,415]},{"content":"Creating a basic workflow service using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph> activities.","pos":[425,578],"source":"Creating a basic workflow service using the <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.SendReply> activities."},{"pos":[588,723],"content":"Using <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> configuration to define secure endpoints for use by the workflow service.","source":"Using [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] configuration to define secure endpoints for use by the workflow service."},{"content":"Creating claims inside a custom policy and using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceAuthorizationManager&gt;</ph> to validate claims.","pos":[733,860],"source":"Creating claims inside a custom policy and using the <xref:System.ServiceModel.ServiceAuthorizationManager> to validate claims."},{"pos":[869,881],"content":"Demonstrates","linkify":"Demonstrates","nodes":[{"content":"Demonstrates","pos":[0,12]}]},{"content":"Using WCF security to secure communication between client and Workflow service, Claims based authorization","pos":[885,991]},{"pos":[1000,1010],"content":"Discussion","linkify":"Discussion","nodes":[{"content":"Discussion","pos":[0,10]}]},{"content":"This sample demonstrates the use of <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> security infrastructure to secure a workflow service just like you would with a normal <ph id=\"ph2\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> service.","pos":[1014,1257],"source":"This sample demonstrates the use of [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] security infrastructure to secure a workflow service just like you would with a normal [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service."},{"content":"Specifically, it uses a custom claim for authorization.","pos":[1258,1313]},{"content":"In this case, it uses <ph id=\"ph1\">&lt;xref:System.ServiceModel.WSHttpBinding&gt;</ph> and message mode security with Windows credentials.","pos":[1314,1428],"source":" In this case, it uses <xref:System.ServiceModel.WSHttpBinding> and message mode security with Windows credentials."},{"content":"The custom <ph id=\"ph1\">&lt;xref:System.IdentityModel.Policy.IAuthorizationPolicy&gt;</ph> (<ph id=\"ph2\">`CustomNameCheckerPolicy`</ph>) checks the client's Windows username and for a specific character.","pos":[1435,1596],"source":"The custom <xref:System.IdentityModel.Policy.IAuthorizationPolicy> (`CustomNameCheckerPolicy`) checks the client's Windows username and for a specific character."},{"content":"If that character is present, it creates and adds the claim to the <ph id=\"ph1\">&lt;xref:System.IdentityModel.Policy.EvaluationContext&gt;</ph>.","pos":[1597,1717],"source":" If that character is present, it creates and adds the claim to the <xref:System.IdentityModel.Policy.EvaluationContext>."},{"content":"By doing this, the custom policy is making the statement that the client has this character in the username.","pos":[1718,1826]},{"content":"This claim can be queried throughout the lifetime of the call.","pos":[1827,1889]},{"content":"You can find that character in <ph id=\"ph1\">`Constants.cs`</ph>.","pos":[1890,1936],"source":" You can find that character in `Constants.cs`."},{"content":"The authorization policy looks for the claim inside the <ph id=\"ph1\">`SecureWorkFlowAuthZManager`</ph>.","pos":[1943,2028],"source":"The authorization policy looks for the claim inside the `SecureWorkFlowAuthZManager`."},{"content":"If it finds it, it returns <ph id=\"ph1\">`true`</ph> and allow the workflow to proceed.","pos":[2029,2097],"source":" If it finds it, it returns `true` and allow the workflow to proceed."},{"content":"Otherwise, it returns <ph id=\"ph1\">`false`</ph>, which causes an 'Access Denied' message to be returned to the client.","pos":[2098,2198],"source":" Otherwise, it returns `false`, which causes an 'Access Denied' message to be returned to the client."},{"content":"Other claims are present in the context and can be examined as well inside the <ph id=\"ph1\">`SecureWorkFlowAuthZManager`</ph>.","pos":[2199,2307],"source":" Other claims are present in the context and can be examined as well inside the `SecureWorkFlowAuthZManager`."},{"pos":[2318,2336],"content":"To run this sample","linkify":"To run this sample","nodes":[{"content":"To run this sample","pos":[0,18]}]},{"pos":[2346,2434],"content":"Run <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph> with administrator privileges.","source":"Run [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] with administrator privileges."},{"pos":[2444,2535],"content":"Load SecuringWorkflowServices.sln in <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph>.","source":"Load SecuringWorkflowServices.sln in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]."},{"content":"Press CTRL+SHIFT+B to compile the solution.","pos":[2545,2588]},{"content":"Set the Service project as the start-up project for the solution.","pos":[2598,2663]},{"content":"Press CTRL+F5 to start the service without debugging.","pos":[2673,2726]},{"content":"Set the Client project as the start-up project for the solution.","pos":[2736,2800]},{"content":"Press CTRL+F5 to start the client without debugging.","pos":[2810,2862]},{"pos":[2870,3002],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[3056,3382],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[3383,3433]}]}