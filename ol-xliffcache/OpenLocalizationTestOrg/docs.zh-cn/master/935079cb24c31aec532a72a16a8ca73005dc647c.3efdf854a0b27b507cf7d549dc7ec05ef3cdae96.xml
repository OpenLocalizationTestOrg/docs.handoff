{"content":"---\ntitle: \"Conditional Get and Put | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 3d22067f-57b8-4e0f-a571-a694512187ae\ncaps.latest.revision: 8\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Conditional Get and Put\nThis sample demonstrates how to use the new conditional retrieve and update APIs for the WCF REST programming model. Because conditional retrieve and update are most appropriate for resource-oriented and REST services, this sample extends the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample. This sample focuses on adding support for conditional retrieve and update to the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample using the new APIs introduced in [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)].  \n  \n## Demonstrates  \n Conditional Retrieve and Update  \n  \n## Discussion  \n The WCF service in this sample exposes a collection of customers in a resource-oriented and REST manner. For a detailed description of the service implementation, please see the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.  \n  \n This sample adds conditional retrieve and update capabilities to the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample. Conditional retrieve and update use HTTP entity tags and the HTTP If-None-Match and If-Match headers to validate that clients either have or do not have the most current entity for a given resource. However, implementing the code to correctly parse the HTTP If-None-Match and If-Match headers can be tedious and error-prone. Therefore, the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> and <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> methods have been added to the <xref:System.ServiceModel.Web.IncomingWebRequestContext>, which can be accessed using the current instance of the <xref:System.ServiceModel.Web.WebOperationContext>. In addition, the `SetETag` method has been added to the <xref:System.ServiceModel.Web.OutgoingWebRequestContext>, making it easier to return valid entity tags.  \n  \n The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method is intended to be used with [WebGet] operations. It takes the current entity tag for the given resource as the `entityTag` parameter, which can be a `string`, `int`, `long` or `Guid`. The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method checks the entity tag against the HTTP If-None-Match header of the request. If the entity tag is present in the HTTP If-None-Match header, then a <xref:System.ServiceModel.Web.WebFaultException> with a status code of Not Modified (304) is thrown; otherwise the method returns. The conditional retrieve mechanism allows the client to tell the server that it has this entity and to only send the current entity if the client does not already have it. Example usage of the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method can be seen in the `GetCustomer` and `GetCustomers` operations of the service. It is important to note that calls to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> may not return. Developers should implement the operation so that the request is already known to be successful before the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> is executed, such that if the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> was not present, the service would send a response with a successful status code.  \n  \n The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method is similar to the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method. It also takes the current entity tag for the given resource. However, it is intended to be used with [WebInvoke] operations in which the method is set to \"PUT\" or \"DELETE\". The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method checks the entity tag against the HTTP If-Match header of the request. If the entity tag is not present in the HTTP If-Match header, then a <xref:System.ServiceModel.Web.WebFaultException> with a status code of Precondition Failed (412) is thrown. The conditional update mechanism allows the client to tell the server that it has this entity for the resource and to only allow the client to alter the resource; if the entity it has is current. Example usage of the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method can be seen in the `UpdateCustomer` and `DeleteCustomer` operations of the service. Just as with <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>, it is important to note that calls to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> may not return. Developers should implement the operation such that the request is already known to be successful before the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> is executed, such that if the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> was not present, the service would respond with a successful status code.  \n  \n The sample consists of a self-hosted service and a client that runs within a console application. As the console application runs, the client makes requests to the service and writes the pertinent information from the responses to the console window.  \n  \n#### To run the sample  \n  \n1.  Open the solution for the Conditional Get and Put sample. When launching [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], you must run as an administrator to execute the sample successfully. Do this by right-clicking the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icon and choosing **Run as Administrator** from the context menu.  \n  \n2.  Press CTRL+SHIFT+B to build the solution and then press CTRL+F5 to run the console application project. If running this project with debugging enabled (by pressing F5 instead of CTRL+F5), the debugger stops when an exception is thrown by the conditional GET and PUT checking. When this happens, press F5 to continue executing the sample.  \n  \n3.  The console window appear sand provides the URI of the running service and the URI of the HTML help page for the running service.  \n  \n4.  As the sample runs, the client sends requests to the service and writes the responses to the console window.  \n  \n5.  Press any key to terminate the sample.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Web\\ConditionalGetAndPut`","nodes":[{"pos":[12,52],"content":"Conditional Get and Put | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Conditional Get and Put | Microsoft Docs","pos":[0,40]}]},{"pos":[350,373],"content":"Conditional Get and Put","linkify":"Conditional Get and Put","nodes":[{"content":"Conditional Get and Put","pos":[0,23]}]},{"content":"This sample demonstrates how to use the new conditional retrieve and update APIs for the WCF REST programming model.","pos":[374,490]},{"content":"Because conditional retrieve and update are most appropriate for resource-oriented and REST services, this sample extends the <bpt id=\"p1\">[</bpt>Basic Resource Service<ept id=\"p1\">](../../../../docs/framework/wcf/samples/basic-resource-service.md)</ept> sample.","pos":[491,715],"source":" Because conditional retrieve and update are most appropriate for resource-oriented and REST services, this sample extends the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample."},{"content":"This sample focuses on adding support for conditional retrieve and update to the <bpt id=\"p1\">[</bpt>Basic Resource Service<ept id=\"p1\">](../../../../docs/framework/wcf/samples/basic-resource-service.md)</ept> sample using the new APIs introduced in <ph id=\"ph1\">[!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)]</ph>.","pos":[716,994],"source":" This sample focuses on adding support for conditional retrieve and update to the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample using the new APIs introduced in [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)]."},{"pos":[1003,1015],"content":"Demonstrates","linkify":"Demonstrates","nodes":[{"content":"Demonstrates","pos":[0,12]}]},{"content":"Conditional Retrieve and Update","pos":[1019,1050]},{"pos":[1059,1069],"content":"Discussion","linkify":"Discussion","nodes":[{"content":"Discussion","pos":[0,10]}]},{"content":"The WCF service in this sample exposes a collection of customers in a resource-oriented and REST manner.","pos":[1073,1177]},{"content":"For a detailed description of the service implementation, please see the <bpt id=\"p1\">[</bpt>Basic Resource Service<ept id=\"p1\">](../../../../docs/framework/wcf/samples/basic-resource-service.md)</ept> sample.","pos":[1178,1349],"source":" For a detailed description of the service implementation, please see the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample."},{"content":"This sample adds conditional retrieve and update capabilities to the <bpt id=\"p1\">[</bpt>Basic Resource Service<ept id=\"p1\">](../../../../docs/framework/wcf/samples/basic-resource-service.md)</ept> sample.","pos":[1356,1523],"source":"This sample adds conditional retrieve and update capabilities to the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample."},{"content":"Conditional retrieve and update use HTTP entity tags and the HTTP If-None-Match and If-Match headers to validate that clients either have or do not have the most current entity for a given resource.","pos":[1524,1722]},{"content":"However, implementing the code to correctly parse the HTTP If-None-Match and If-Match headers can be tedious and error-prone.","pos":[1723,1848]},{"content":"Therefore, the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A&gt;</ph> methods have been added to the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext&gt;</ph>, which can be accessed using the current instance of the <ph id=\"ph4\">&lt;xref:System.ServiceModel.Web.WebOperationContext&gt;</ph>.","pos":[1849,2232],"source":" Therefore, the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> and <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> methods have been added to the <xref:System.ServiceModel.Web.IncomingWebRequestContext>, which can be accessed using the current instance of the <xref:System.ServiceModel.Web.WebOperationContext>."},{"content":"In addition, the <ph id=\"ph1\">`SetETag`</ph> method has been added to the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Web.OutgoingWebRequestContext&gt;</ph>, making it easier to return valid entity tags.","pos":[2233,2392],"source":" In addition, the `SetETag` method has been added to the <xref:System.ServiceModel.Web.OutgoingWebRequestContext>, making it easier to return valid entity tags."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A&gt;</ph> method is intended to be used with [WebGet] operations.","pos":[2399,2543],"source":"The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method is intended to be used with [WebGet] operations."},{"content":"It takes the current entity tag for the given resource as the <ph id=\"ph1\">`entityTag`</ph> parameter, which can be a <ph id=\"ph2\">`string`</ph>, <ph id=\"ph3\">`int`</ph>, <ph id=\"ph4\">`long`</ph> or <ph id=\"ph5\">`Guid`</ph>.","pos":[2544,2678],"source":" It takes the current entity tag for the given resource as the `entityTag` parameter, which can be a `string`, `int`, `long` or `Guid`."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A&gt;</ph> method checks the entity tag against the HTTP If-None-Match header of the request.","pos":[2679,2850],"source":" The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method checks the entity tag against the HTTP If-None-Match header of the request."},{"content":"If the entity tag is present in the HTTP If-None-Match header, then a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.WebFaultException&gt;</ph> with a status code of Not Modified (304) is thrown; otherwise the method returns.","pos":[2851,3051],"source":" If the entity tag is present in the HTTP If-None-Match header, then a <xref:System.ServiceModel.Web.WebFaultException> with a status code of Not Modified (304) is thrown; otherwise the method returns."},{"content":"The conditional retrieve mechanism allows the client to tell the server that it has this entity and to only send the current entity if the client does not already have it.","pos":[3052,3223]},{"content":"Example usage of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A&gt;</ph> method can be seen in the <ph id=\"ph2\">`GetCustomer`</ph> and <ph id=\"ph3\">`GetCustomers`</ph> operations of the service.","pos":[3224,3415],"source":" Example usage of the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method can be seen in the `GetCustomer` and `GetCustomers` operations of the service."},{"content":"It is important to note that calls to <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A&gt;</ph> may not return.","pos":[3416,3554],"source":" It is important to note that calls to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> may not return."},{"content":"Developers should implement the operation so that the request is already known to be successful before the call to <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A&gt;</ph> is executed, such that if the call to <ph id=\"ph2\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A&gt;</ph> was not present, the service would send a response with a successful status code.","pos":[3555,3959],"source":" Developers should implement the operation so that the request is already known to be successful before the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> is executed, such that if the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> was not present, the service would send a response with a successful status code."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A&gt;</ph> method is similar to the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A&gt;</ph> method.","pos":[3966,4170],"source":"The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method is similar to the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method."},{"content":"It also takes the current entity tag for the given resource.","pos":[4171,4231]},{"content":"However, it is intended to be used with [WebInvoke] operations in which the method is set to \"PUT\" or \"DELETE\".","pos":[4232,4343]},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A&gt;</ph> method checks the entity tag against the HTTP If-Match header of the request.","pos":[4344,4508],"source":" The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method checks the entity tag against the HTTP If-Match header of the request."},{"content":"If the entity tag is not present in the HTTP If-Match header, then a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.WebFaultException&gt;</ph> with a status code of Precondition Failed (412) is thrown.","pos":[4509,4685],"source":" If the entity tag is not present in the HTTP If-Match header, then a <xref:System.ServiceModel.Web.WebFaultException> with a status code of Precondition Failed (412) is thrown."},{"content":"The conditional update mechanism allows the client to tell the server that it has this entity for the resource and to only allow the client to alter the resource; if the entity it has is current.","pos":[4686,4881]},{"content":"Example usage of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A&gt;</ph> method can be seen in the <ph id=\"ph2\">`UpdateCustomer`</ph> and <ph id=\"ph3\">`DeleteCustomer`</ph> operations of the service.","pos":[4882,5076],"source":" Example usage of the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method can be seen in the `UpdateCustomer` and `DeleteCustomer` operations of the service."},{"content":"Just as with <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A&gt;</ph>, it is important to note that calls to <ph id=\"ph2\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A&gt;</ph> may not return.","pos":[5077,5312],"source":" Just as with <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>, it is important to note that calls to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> may not return."},{"content":"Developers should implement the operation such that the request is already known to be successful before the call to <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A&gt;</ph> is executed, such that if the call to <ph id=\"ph2\">&lt;xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A&gt;</ph> was not present, the service would respond with a successful status code.","pos":[5313,5707],"source":" Developers should implement the operation such that the request is already known to be successful before the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> is executed, such that if the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> was not present, the service would respond with a successful status code."},{"content":"The sample consists of a self-hosted service and a client that runs within a console application.","pos":[5714,5811]},{"content":"As the console application runs, the client makes requests to the service and writes the pertinent information from the responses to the console window.","pos":[5812,5964]},{"pos":[5975,5992],"content":"To run the sample","linkify":"To run the sample","nodes":[{"content":"To run the sample","pos":[0,17]}]},{"content":"Open the solution for the Conditional Get and Put sample.","pos":[6002,6059]},{"content":"When launching <ph id=\"ph1\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph>, you must run as an administrator to execute the sample successfully.","pos":[6060,6216],"source":" When launching [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], you must run as an administrator to execute the sample successfully."},{"content":"Do this by right-clicking the <ph id=\"ph1\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph> icon and choosing <bpt id=\"p1\">**</bpt>Run as Administrator<ept id=\"p1\">**</ept> from the context menu.","pos":[6217,6384],"source":" Do this by right-clicking the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icon and choosing **Run as Administrator** from the context menu."},{"content":"Press CTRL+SHIFT+B to build the solution and then press CTRL+F5 to run the console application project.","pos":[6394,6497]},{"content":"If running this project with debugging enabled (by pressing F5 instead of CTRL+F5), the debugger stops when an exception is thrown by the conditional GET and PUT checking.","pos":[6498,6669]},{"content":"When this happens, press F5 to continue executing the sample.","pos":[6670,6731]},{"content":"The console window appear sand provides the URI of the running service and the URI of the HTML help page for the running service.","pos":[6741,6870]},{"content":"As the sample runs, the client sends requests to the service and writes the responses to the console window.","pos":[6880,6988]},{"content":"Press any key to terminate the sample.","pos":[6998,7036]},{"pos":[7044,7176],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[7230,7556],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[7557,7607]}]}