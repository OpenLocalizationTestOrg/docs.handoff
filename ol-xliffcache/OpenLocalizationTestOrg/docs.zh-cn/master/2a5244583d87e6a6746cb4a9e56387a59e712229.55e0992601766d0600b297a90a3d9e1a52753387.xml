{"content":"---\ntitle: \"Walkthrough: Enabling Drag and Drop on a User Control | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-wpf\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"walkthrough [WPF], drag-and-drop\"\n  - \"drag-and-drop [WPF], walkthrough\"\nms.assetid: cc844419-1a77-4906-95d9-060d79107fc7\ncaps.latest.revision: 7\nauthor: dotnet-bot\nms.author: dotnetcontent\nmanager: \"wpickett\"\n---\n# Walkthrough: Enabling Drag and Drop on a User Control\nThis walkthrough demonstrates how to create a custom user control that can participate in drag-and-drop data transfer in [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)].  \n  \n In this walkthrough, you will create a custom WPF <xref:System.Windows.Controls.UserControl> that represents a circle shape. You will implement functionality on the control to enable data transfer through drag-and-drop. For example, if you drag from one Circle control to another, the Fill color data is copied from the source Circle to the target. If you drag from a Circle control to a <xref:System.Windows.Controls.TextBox>, the string representation of the Fill color is copied to the <xref:System.Windows.Controls.TextBox>. You will also create a small application that contains two panel controls and a <xref:System.Windows.Controls.TextBox> to test the drag-and-drop functionality. You will write code that enables the panels to process dropped Circle data, which will enable you to move or copy Circles from the Children collection of one panel to the other.  \n  \n This walkthrough illustrates the following tasks:  \n  \n-   Create a custom user control.  \n  \n-   Enable the user control to be a drag source.  \n  \n-   Enable the user control to be a drop target.  \n  \n-   Enable a panel to receive data dropped from the user control.  \n  \n## Prerequisites  \n You need the following components to complete this walkthrough:  \n  \n-   Visual Studio 2010  \n  \n## Creating the Application Project  \n In this section, you will create the application infrastructure, which includes a main page with two panels and a <xref:System.Windows.Controls.TextBox>.  \n  \n### To create the project  \n  \n1.  Create a new WPF Application project in Visual Basic or Visual C# named `DragDropExample`. For more information, see [How to: Create a New WPF Application Project](http://msdn.microsoft.com/en-us/1f6aea7a-33e1-4d3f-8555-1daa42e95d82).  \n  \n2.  Open MainWindow.xaml.  \n  \n3.  Add the following markup between the opening and closing <xref:System.Windows.Controls.Grid> tags.  \n  \n     This markup creates the user interface for the test application.  \n  \n     [!code-xml[DragDropWalkthrough#PanelsStep1XAML](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/SnippetWindow.xaml#panelsstep1xaml)]  \n  \n## Adding a New User Control to the Project  \n In this section, you will add a new user control to the project.  \n  \n### To add a new user control  \n  \n1.  On the Project menu, select **Add User Control**.  \n  \n2.  In the Add New Item dialog box, change the name to `Circle.xaml`, and click **Add**.  \n  \n     Circle.xaml and its code-behind is added to the project.  \n  \n3.  Open Circle.xaml.  \n  \n     This file will contain the user interface elements of the user control.  \n  \n4.  Add the following markup to the root <xref:System.Windows.Controls.Grid> to create a simple user control that has a blue circle as its UI.  \n  \n     [!code-xml[DragDropWalkthrough#EllipseXAML](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml#ellipsexaml)]  \n  \n5.  Open Circle.xaml.cs or Circle.xaml.vb.  \n  \n6.  In C#, add the following code after the default constructor to create a copy constructor. In Visual Basic, add the following code to create both a default constructor and a copy constructor.  \n  \n     In order to allow the user control to be copied, you add a copy constructor method in the code-behind file. In the simplified Circle user control, you will only copy the Fill and the size of the of the user control.  \n  \n     [!code-csharp[DragDropWalkthrough#CopyCtor](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#copyctor)]\n     [!code-vb[DragDropWalkthrough#CopyCtor](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#copyctor)]  \n  \n### To add the user control to the main window  \n  \n1.  Open MainWindow.xaml.  \n  \n2.  Add the following XAML to the opening <xref:System.Windows.Window> tag to create an XML namespace reference to the current application.  \n  \n    ```  \n    xmlns:local=\"clr-namespace:DragDropExample\"  \n    ```  \n  \n3.  In the first <xref:System.Windows.Controls.StackPanel>, add the following XAML to create two instances of the Circle user control in the first panel.  \n  \n     [!code-xml[DragDropWalkthrough#CirclesXAML](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/SnippetWindow.xaml#circlesxaml)]  \n  \n     The full XAML for the panel looks like the following.  \n  \n     [!code-xml[DragDropWalkthrough#PanelsStep2XAML](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/SnippetWindow.xaml#panelsstep2xaml)]  \n  \n## Implementing Drag Source Events in the User Control  \n In this section, you will override the <xref:System.Windows.UIElement.OnMouseMove%2A> method and initiate the drag-and-drop operation.  \n  \n If a drag is started (a mouse button is pressed and the mouse is moved), you will package the data to be transferred into a <xref:System.Windows.DataObject>. In this case, the Circle control will package three data items; a string representation of its Fill color, a double representation of its height, and a copy of itself.  \n  \n### To initiate a drag-and-drop operation  \n  \n1.  Open Circle.xaml.cs or Circle.xaml.vb.  \n  \n2.  Add the following <xref:System.Windows.UIElement.OnMouseMove%2A> override to provide class handling for the <xref:System.Windows.UIElement.MouseMove> event.  \n  \n     [!code-csharp[DragDropWalkthrough#OnMouseMove](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#onmousemove)]\n     [!code-vb[DragDropWalkthrough#OnMouseMove](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#onmousemove)]  \n  \n     This <xref:System.Windows.UIElement.OnMouseMove%2A> override performs the following tasks:  \n  \n    -   Checks whether the left mouse button is pressed while the mouse is moving.  \n  \n    -   Packages the Circle data into a <xref:System.Windows.DataObject>. In this case, the Circle control packages three data items; a string representation of its Fill color, a double representation of its height, and a copy of itself.  \n  \n    -   Calls the static <xref:System.Windows.DragDrop.DoDragDrop%2A?displayProperty=fullName> method to initiate the drag-and-drop operation. You pass the following three parameters to the <xref:System.Windows.DragDrop.DoDragDrop%2A> method:  \n  \n        -   `dragSource` – A reference to this control.  \n  \n        -   `data` – The <xref:System.Windows.DataObject> created in the previous code.  \n  \n        -   `allowedEffects` – The allowed drag-and-drop operations, which are <xref:System.Windows.DragDropEffects> or <xref:System.Windows.DragDropEffects>.  \n  \n3.  Press F5 to build and run the application.  \n  \n4.  Click one of the Circle controls and drag it over the panels, the other Circle, and the <xref:System.Windows.Controls.TextBox>. When dragging over the <xref:System.Windows.Controls.TextBox>, the cursor changes to indicate a move.  \n  \n5.  While dragging a Circle over the <xref:System.Windows.Controls.TextBox>, press the CTRL key. Notice how the cursor changes to indicate a copy.  \n  \n6.  Drag and drop a Circle onto the <xref:System.Windows.Controls.TextBox>. The string representation of the Circle’s fill color is appended to the <xref:System.Windows.Controls.TextBox>.  \n  \n     ![String representation of Circle's fill color](../../../../docs/framework/wpf/advanced/media/dragdrop-colorstring.png \"DragDrop_ColorString\")  \n  \n By default, the cursor will change during a drag-and-drop operation to indicate what effect dropping the data will have. You can customize the feedback given to the user by handling the <xref:System.Windows.UIElement.GiveFeedback> event and setting a different cursor.  \n  \n### To give feedback to the user  \n  \n1.  Open Circle.xaml.cs or Circle.xaml.vb.  \n  \n2.  Add the following <xref:System.Windows.UIElement.OnGiveFeedback%2A> override to provide class handling for the <xref:System.Windows.UIElement.GiveFeedback> event.  \n  \n     [!code-csharp[DragDropWalkthrough#OnGiveFeedback](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#ongivefeedback)]\n     [!code-vb[DragDropWalkthrough#OnGiveFeedback](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#ongivefeedback)]  \n  \n     This <xref:System.Windows.UIElement.OnGiveFeedback%2A> override performs the following tasks:  \n  \n    -   Checks the <xref:System.Windows.GiveFeedbackEventArgs.Effects%2A> values that are set in the drop target's <xref:System.Windows.UIElement.DragOver> event handler.  \n  \n    -   Sets a custom cursor based on the <xref:System.Windows.GiveFeedbackEventArgs.Effects%2A> value. The cursor is intended to give visual feedback to the user about what effect dropping the data will have.  \n  \n3.  Press F5 to build and run the application.  \n  \n4.  Drag one of the Circle controls over the panels, the other Circle, and the <xref:System.Windows.Controls.TextBox>. Notice that the cursors are now the custom cursors that you specified in the <xref:System.Windows.UIElement.OnGiveFeedback%2A> override.  \n  \n     ![Drag and drop with custom cursors](../../../../docs/framework/wpf/advanced/media/dragdrop-customcursor.png \"DragDrop_CustomCursor\")  \n  \n5.  Select the text `green` from the <xref:System.Windows.Controls.TextBox>.  \n  \n6.  Drag the `green` text to a Circle control. Notice that the default cursors are shown to indicate the effects of the drag-and-drop operation. The feedback cursor is always set by the drag source.  \n  \n## Implementing Drop Target Events in the User Control  \n In this section, you will specify that the user control is a drop target, override the methods that enable the user control to be a drop target, and process the data that is dropped on it.  \n  \n### To enable the user control to be a drop target  \n  \n1.  Open Circle.xaml.  \n  \n2.  In the opening <xref:System.Windows.Controls.UserControl> tag, add the <xref:System.Windows.UIElement.AllowDrop%2A> property and set it to `true`.  \n  \n     [!code-xml[DragDropWalkthrough#UCTagXAML](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml#uctagxaml)]  \n  \n The <xref:System.Windows.UIElement.OnDrop%2A> method is called when the <xref:System.Windows.UIElement.AllowDrop%2A> property is set to `true` and data from the drag source is dropped on the Circle user control. In this method, you will process the data that was dropped and apply the data to the Circle.  \n  \n### To process the dropped data  \n  \n1.  Open Circle.xaml.cs or Circle.xaml.vb.  \n  \n2.  Add the following <xref:System.Windows.UIElement.OnDrop%2A> override to provide class handling for the <xref:System.Windows.UIElement.Drop> event.  \n  \n     [!code-csharp[DragDropWalkthrough#OnDrop](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#ondrop)]\n     [!code-vb[DragDropWalkthrough#OnDrop](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#ondrop)]  \n  \n     This <xref:System.Windows.UIElement.OnDrop%2A> override performs the following tasks:  \n  \n    -   Uses the <xref:System.Windows.DataObject.GetDataPresent%2A> method to check if the dragged data contains a string object.  \n  \n    -   Uses the <xref:System.Windows.DataObject.GetData%2A> method to extract the string data if it is present.  \n  \n    -   Uses a <xref:System.Windows.Media.BrushConverter> to try to convert the string to a <xref:System.Windows.Media.Brush>.  \n  \n    -   If the conversion is successful, applies the brush to the <xref:System.Windows.Shapes.Shape.Fill%2A> of the <xref:System.Windows.Shapes.Ellipse> that provides the UI of the Circle control.  \n  \n    -   Marks the <xref:System.Windows.UIElement.Drop> event as handled. You should mark the drop event as handled so that other elements that receive this event know that the Circle user control handled it.  \n  \n3.  Press F5 to build and run the application.  \n  \n4.  Select the text `green` in the <xref:System.Windows.Controls.TextBox>.  \n  \n5.  Drag the text to a Circle control and drop it. The Circle changes from blue to green.  \n  \n     ![Convert a string to a brush](../../../../docs/framework/wpf/advanced/media/dragdrop-dropgreentext.png \"DragDrop_DropGreenText\")  \n  \n6.  Type the text `green` in the <xref:System.Windows.Controls.TextBox>.  \n  \n7.  Select the text `gre` in the <xref:System.Windows.Controls.TextBox>.  \n  \n8.  Drag it to a Circle control and drop it. Notice that the cursor changes to indicate that the drop is allowed, but the color of the Circle does not change because `gre` is not a valid color.  \n  \n9. Drag from the green Circle control and drop on the blue Circle control. The Circle changes from blue to green. Notice that which cursor is shown depends on whether the <xref:System.Windows.Controls.TextBox> or the Circle is the drag source.  \n  \n Setting the <xref:System.Windows.UIElement.AllowDrop%2A> property to `true` and processing the dropped data is all that is required to enable an element to be a drop target. However, to provide a better user experience, you should also handle the <xref:System.Windows.UIElement.DragEnter>, <xref:System.Windows.UIElement.DragLeave>, and <xref:System.Windows.UIElement.DragOver> events. In these events, you can perform checks and provide additional feedback to the user before the data is dropped.  \n  \n When data is dragged over the Circle user control, the control should notify the drag source whether it can process the data that is being dragged. If the control does not know how to process the data, it should refuse the drop. To do this, you will handle the <xref:System.Windows.UIElement.DragOver> event and set the <xref:System.Windows.DragEventArgs.Effects%2A> property.  \n  \n### To verify that the data drop is allowed  \n  \n1.  Open Circle.xaml.cs or Circle.xaml.vb.  \n  \n2.  Add the following <xref:System.Windows.UIElement.OnDragOver%2A> override to provide class handling for the <xref:System.Windows.UIElement.DragOver> event.  \n  \n     [!code-csharp[DragDropWalkthrough#OnDragOver](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#ondragover)]\n     [!code-vb[DragDropWalkthrough#OnDragOver](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#ondragover)]  \n  \n     This <xref:System.Windows.UIElement.OnDragOver%2A> override performs the following tasks:  \n  \n    -   Sets the <xref:System.Windows.DragEventArgs.Effects%2A> property to <xref:System.Windows.DragDropEffects>.  \n  \n    -   Performs the same checks that are performed in the <xref:System.Windows.UIElement.OnDrop%2A> method to determine whether the Circle user control can process the dragged data.  \n  \n    -   If the user control can process the data, sets the <xref:System.Windows.DragEventArgs.Effects%2A> property to <xref:System.Windows.DragDropEffects> or <xref:System.Windows.DragDropEffects>.  \n  \n3.  Press F5 to build and run the application.  \n  \n4.  Select the text `gre` in the <xref:System.Windows.Controls.TextBox>.  \n  \n5.  Drag the text to a Circle control. Notice that the cursor now changes to indicate that the drop is not allowed because `gre` is not a valid color.  \n  \n You can further enhance the user experience by applying a preview of the drop operation. For the Circle user control, you will override the <xref:System.Windows.UIElement.OnDragEnter%2A> and <xref:System.Windows.UIElement.OnDragLeave%2A> methods. When the data is dragged over the control, the current background <xref:System.Windows.Shapes.Shape.Fill%2A> is saved in a placeholder variable. The string is then converted to a brush and applied to the <xref:System.Windows.Shapes.Ellipse> that provides the Circle's UI. If the data is dragged out of the Circle without being dropped, the original <xref:System.Windows.Shapes.Shape.Fill%2A> value is re-applied to the Circle.  \n  \n### To preview the effects of the drag-and-drop operation  \n  \n1.  Open Circle.xaml.cs or Circle.xaml.vb.  \n  \n2.  In the Circle class, declare a private <xref:System.Windows.Media.Brush> variable named `_previousFill` and initialize it to `null`.  \n  \n     [!code-csharp[DragDropWalkthrough#Brush](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#brush)]\n     [!code-vb[DragDropWalkthrough#Brush](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#brush)]  \n  \n3.  Add the following <xref:System.Windows.UIElement.OnDragEnter%2A> override to provide class handling for the <xref:System.Windows.UIElement.DragEnter> event.  \n  \n     [!code-csharp[DragDropWalkthrough#OnDragEnter](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#ondragenter)]\n     [!code-vb[DragDropWalkthrough#OnDragEnter](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#ondragenter)]  \n  \n     This <xref:System.Windows.UIElement.OnDragEnter%2A> override performs the following tasks:  \n  \n    -   Saves the <xref:System.Windows.Shapes.Shape.Fill%2A> property of the <xref:System.Windows.Shapes.Ellipse> in the `_previousFill` variable.  \n  \n    -   Performs the same checks that are performed in the <xref:System.Windows.UIElement.OnDrop%2A> method to determine whether the data can be converted to a <xref:System.Windows.Media.Brush>.  \n  \n    -   If the data is converted to a valid <xref:System.Windows.Media.Brush>, applies it to the <xref:System.Windows.Shapes.Shape.Fill%2A> of the <xref:System.Windows.Shapes.Ellipse>.  \n  \n4.  Add the following <xref:System.Windows.UIElement.OnDragLeave%2A> override to provide class handling for the <xref:System.Windows.UIElement.DragLeave> event.  \n  \n     [!code-csharp[DragDropWalkthrough#OnDragLeave](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#ondragleave)]\n     [!code-vb[DragDropWalkthrough#OnDragLeave](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#ondragleave)]  \n  \n     This <xref:System.Windows.UIElement.OnDragLeave%2A> override performs the following tasks:  \n  \n    -   Applies the <xref:System.Windows.Media.Brush> saved in the `_previousFill` variable to the <xref:System.Windows.Shapes.Shape.Fill%2A> of the <xref:System.Windows.Shapes.Ellipse> that provides the UI of the Circle user control.  \n  \n5.  Press F5 to build and run the application.  \n  \n6.  Select the text `green` in the <xref:System.Windows.Controls.TextBox>.  \n  \n7.  Drag the text over a Circle control without dropping it. The Circle changes from blue to green.  \n  \n     ![Preview the effects of a drag&#45;and&#45;drop operation](../../../../docs/framework/wpf/advanced/media/dragdrop-previeweffects.png \"DragDrop_PreviewEffects\")  \n  \n8.  Drag the text away from the Circle control. The Circle changes from green back to blue.  \n  \n## Enabling a Panel to Receive Dropped Data  \n In this section, you will enable the panels that host the Circle user controls to act as drop targets for dragged Circle data. You will implement code that enables you to move a Circle from one panel to another, or to make a copy of a Circle control by holding down the CTRL key while dragging and dropping a Circle.  \n  \n### To enable the panel to be a drop target  \n  \n1.  Open MainWindow.xaml.  \n  \n2.  As shown in the following XAML, in each of the <xref:System.Windows.Controls.StackPanel> controls, add handlers for the <xref:System.Windows.UIElement.DragOver> and <xref:System.Windows.UIElement.Drop> events. Name the <xref:System.Windows.UIElement.DragOver> event handler, `panel_DragOver`, and name the <xref:System.Windows.UIElement.Drop> event handler, `panel_Drop`.  \n  \n     [!code-xml[DragDropWalkthrough#PanelsXAML](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/MainWindow.xaml#panelsxaml)]  \n  \n3.  Open MainWindows.xaml.cs or MainWindow.xaml.vb.  \n  \n4.  Add the following code for the <xref:System.Windows.UIElement.DragOver> event handler.  \n  \n     [!code-csharp[DragDropWalkthrough#PanelDragOver](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/MainWindow.xaml.cs#paneldragover)]\n     [!code-vb[DragDropWalkthrough#PanelDragOver](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/MainWindow.xaml.vb#paneldragover)]  \n  \n     This <xref:System.Windows.UIElement.DragOver> event handler performs the following tasks:  \n  \n    -   Checks that the dragged data contains the \"Object\" data that was packaged in the <xref:System.Windows.DataObject> by the Circle user control and passed in the call to <xref:System.Windows.DragDrop.DoDragDrop%2A>.  \n  \n    -   If the \"Object\" data is present, checks whether the CTRL key is pressed.  \n  \n    -   If the CTRL key is pressed, sets the <xref:System.Windows.DragEventArgs.Effects%2A> property to <xref:System.Windows.DragDropEffects>. Otherwise, set the <xref:System.Windows.DragEventArgs.Effects%2A> property to <xref:System.Windows.DragDropEffects>.  \n  \n5.  Add the following code for the <xref:System.Windows.UIElement.Drop> event handler.  \n  \n     [!code-csharp[DragDropWalkthrough#PanelDrop](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/MainWindow.xaml.cs#paneldrop)]\n     [!code-vb[DragDropWalkthrough#PanelDrop](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/MainWindow.xaml.vb#paneldrop)]  \n  \n     This <xref:System.Windows.UIElement.Drop> event handler performs the following tasks:  \n  \n    -   Checks whether the <xref:System.Windows.UIElement.Drop> event has already been handled. For instance, if a Circle is dropped on another Circle which handles the <xref:System.Windows.UIElement.Drop> event, you do not want the panel that contains the Circle to also handle it.  \n  \n    -   If the <xref:System.Windows.UIElement.Drop> event is not handled, checks whether the CTRL key is pressed.  \n  \n    -   If the CTRL key is pressed when the <xref:System.Windows.UIElement.Drop> happens, makes a copy of the Circle control and add it to the <xref:System.Windows.Controls.Panel.Children%2A> collection of the <xref:System.Windows.Controls.StackPanel>.  \n  \n    -   If the CTRL key is not pressed, moves the Circle from the <xref:System.Windows.Controls.Panel.Children%2A> collection of its parent panel to the <xref:System.Windows.Controls.Panel.Children%2A> collection of the panel that it was dropped on.  \n  \n    -   Sets the <xref:System.Windows.DragEventArgs.Effects%2A> property to notify the <xref:System.Windows.DragDrop.DoDragDrop%2A> method whether a move or copy operation was performed.  \n  \n6.  Press F5 to build and run the application.  \n  \n7.  Select the text `green` from the <xref:System.Windows.Controls.TextBox>.  \n  \n8.  Drag the text over a Circle control and drop it.  \n  \n9. Drag a Circle control from the left panel to the right panel and drop it. The Circle is removed from the <xref:System.Windows.Controls.Panel.Children%2A> collection of the left panel and added to the Children collection of the right panel.  \n  \n10. Drag a Circle control from the panel it is in to the other panel and drop it while pressing the CTRL key. The Circle is copied and the copy is added to the <xref:System.Windows.Controls.Panel.Children%2A> collection of the receiving panel.  \n  \n     ![Dragging a Circle while pressing the CTRL key](../../../../docs/framework/wpf/advanced/media/dragdrop-paneldrop.png \"DragDrop_PanelDrop\")  \n  \n## See Also  \n [Drag and Drop Overview](../../../../docs/framework/wpf/advanced/drag-and-drop-overview.md)","nodes":[{"pos":[12,82],"content":"Walkthrough: Enabling Drag and Drop on a User Control | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Walkthrough: Enabling Drag and Drop on a User Control | Microsoft Docs","pos":[0,70]}]},{"pos":[489,542],"content":"Walkthrough: Enabling Drag and Drop on a User Control","linkify":"Walkthrough: Enabling Drag and Drop on a User Control","nodes":[{"content":"Walkthrough: Enabling Drag and Drop on a User Control","pos":[0,53]}]},{"pos":[543,744],"content":"This walkthrough demonstrates how to create a custom user control that can participate in drag-and-drop data transfer in <ph id=\"ph1\">[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]</ph>.","source":"This walkthrough demonstrates how to create a custom user control that can participate in drag-and-drop data transfer in [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]."},{"content":"In this walkthrough, you will create a custom WPF <ph id=\"ph1\">&lt;xref:System.Windows.Controls.UserControl&gt;</ph> that represents a circle shape.","pos":[751,875],"source":"In this walkthrough, you will create a custom WPF <xref:System.Windows.Controls.UserControl> that represents a circle shape."},{"content":"You will implement functionality on the control to enable data transfer through drag-and-drop.","pos":[876,970]},{"content":"For example, if you drag from one Circle control to another, the Fill color data is copied from the source Circle to the target.","pos":[971,1099]},{"content":"If you drag from a Circle control to a <ph id=\"ph1\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph>, the string representation of the Fill color is copied to the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph>.","pos":[1100,1279],"source":" If you drag from a Circle control to a <xref:System.Windows.Controls.TextBox>, the string representation of the Fill color is copied to the <xref:System.Windows.Controls.TextBox>."},{"content":"You will also create a small application that contains two panel controls and a <ph id=\"ph1\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph> to test the drag-and-drop functionality.","pos":[1280,1439],"source":" You will also create a small application that contains two panel controls and a <xref:System.Windows.Controls.TextBox> to test the drag-and-drop functionality."},{"content":"You will write code that enables the panels to process dropped Circle data, which will enable you to move or copy Circles from the Children collection of one panel to the other.","pos":[1440,1617]},{"content":"This walkthrough illustrates the following tasks:","pos":[1624,1673]},{"content":"Create a custom user control.","pos":[1683,1712]},{"content":"Enable the user control to be a drag source.","pos":[1722,1766]},{"content":"Enable the user control to be a drop target.","pos":[1776,1820]},{"content":"Enable a panel to receive data dropped from the user control.","pos":[1830,1891]},{"pos":[1900,1913],"content":"Prerequisites","linkify":"Prerequisites","nodes":[{"content":"Prerequisites","pos":[0,13]}]},{"content":"You need the following components to complete this walkthrough:","pos":[1917,1980]},{"content":"Visual Studio 2010","pos":[1990,2008]},{"pos":[2017,2049],"content":"Creating the Application Project","linkify":"Creating the Application Project","nodes":[{"content":"Creating the Application Project","pos":[0,32]}]},{"content":"In this section, you will create the application infrastructure, which includes a main page with two panels and a <ph id=\"ph1\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph>.","pos":[2053,2206],"source":"In this section, you will create the application infrastructure, which includes a main page with two panels and a <xref:System.Windows.Controls.TextBox>."},{"pos":[2216,2237],"content":"To create the project","linkify":"To create the project","nodes":[{"content":"To create the project","pos":[0,21]}]},{"content":"Create a new WPF Application project in Visual Basic or Visual C# named <ph id=\"ph1\">`DragDropExample`</ph>.","pos":[2247,2337],"source":"Create a new WPF Application project in Visual Basic or Visual C# named `DragDropExample`."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>How to: Create a New WPF Application Project<ept id=\"p1\">](http://msdn.microsoft.com/en-us/1f6aea7a-33e1-4d3f-8555-1daa42e95d82)</ept>.","pos":[2338,2481],"source":" For more information, see [How to: Create a New WPF Application Project](http://msdn.microsoft.com/en-us/1f6aea7a-33e1-4d3f-8555-1daa42e95d82)."},{"content":"Open MainWindow.xaml.","pos":[2491,2512]},{"content":"Add the following markup between the opening and closing <ph id=\"ph1\">&lt;xref:System.Windows.Controls.Grid&gt;</ph> tags.","pos":[2522,2620],"source":"Add the following markup between the opening and closing <xref:System.Windows.Controls.Grid> tags."},{"content":"This markup creates the user interface for the test application.","pos":[2631,2695]},{"pos":[2706,2865],"content":"<bpt id=\"p1\">[!code-xml</bpt><bpt id=\"p2\">[</bpt>DragDropWalkthrough#PanelsStep1XAML<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/SnippetWindow.xaml#panelsstep1xaml)</ept><ept id=\"p1\">]</ept>","source":"[!code-xml[DragDropWalkthrough#PanelsStep1XAML](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/SnippetWindow.xaml#panelsstep1xaml)]"},{"pos":[2874,2914],"content":"Adding a New User Control to the Project","linkify":"Adding a New User Control to the Project","nodes":[{"content":"Adding a New User Control to the Project","pos":[0,40]}]},{"content":"In this section, you will add a new user control to the project.","pos":[2918,2982]},{"pos":[2992,3017],"content":"To add a new user control","linkify":"To add a new user control","nodes":[{"content":"To add a new user control","pos":[0,25]}]},{"pos":[3027,3076],"content":"On the Project menu, select <bpt id=\"p1\">**</bpt>Add User Control<ept id=\"p1\">**</ept>.","source":"On the Project menu, select **Add User Control**."},{"pos":[3086,3170],"content":"In the Add New Item dialog box, change the name to <ph id=\"ph1\">`Circle.xaml`</ph>, and click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept>.","source":"In the Add New Item dialog box, change the name to `Circle.xaml`, and click **Add**."},{"content":"Circle.xaml and its code-behind is added to the project.","pos":[3181,3237]},{"content":"Open Circle.xaml.","pos":[3247,3264]},{"content":"This file will contain the user interface elements of the user control.","pos":[3275,3346]},{"content":"Add the following markup to the root <ph id=\"ph1\">&lt;xref:System.Windows.Controls.Grid&gt;</ph> to create a simple user control that has a blue circle as its UI.","pos":[3356,3494],"source":"Add the following markup to the root <xref:System.Windows.Controls.Grid> to create a simple user control that has a blue circle as its UI."},{"pos":[3505,3649],"content":"<bpt id=\"p1\">[!code-xml</bpt><bpt id=\"p2\">[</bpt>DragDropWalkthrough#EllipseXAML<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml#ellipsexaml)</ept><ept id=\"p1\">]</ept>","source":"[!code-xml[DragDropWalkthrough#EllipseXAML](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml#ellipsexaml)]"},{"content":"Open Circle.xaml.cs or Circle.xaml.vb.","pos":[3659,3697]},{"content":"In C#, add the following code after the default constructor to create a copy constructor.","pos":[3707,3796]},{"content":"In Visual Basic, add the following code to create both a default constructor and a copy constructor.","pos":[3797,3897]},{"content":"In order to allow the user control to be copied, you add a copy constructor method in the code-behind file.","pos":[3908,4015]},{"content":"In the simplified Circle user control, you will only copy the Fill and the size of the of the user control.","pos":[4016,4123]},{"pos":[4134,4429],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>DragDropWalkthrough#CopyCtor<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#copyctor)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>DragDropWalkthrough#CopyCtor<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#copyctor)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[DragDropWalkthrough#CopyCtor](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#copyctor)]\n [!code-vb[DragDropWalkthrough#CopyCtor](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#copyctor)]"},{"pos":[4439,4481],"content":"To add the user control to the main window","linkify":"To add the user control to the main window","nodes":[{"content":"To add the user control to the main window","pos":[0,42]}]},{"content":"Open MainWindow.xaml.","pos":[4491,4512]},{"content":"Add the following XAML to the opening <ph id=\"ph1\">&lt;xref:System.Windows.Window&gt;</ph> tag to create an XML namespace reference to the current application.","pos":[4522,4657],"source":"Add the following XAML to the opening <xref:System.Windows.Window> tag to create an XML namespace reference to the current application."},{"content":"In the first <ph id=\"ph1\">&lt;xref:System.Windows.Controls.StackPanel&gt;</ph>, add the following XAML to create two instances of the Circle user control in the first panel.","pos":[4740,4889],"source":"In the first <xref:System.Windows.Controls.StackPanel>, add the following XAML to create two instances of the Circle user control in the first panel."},{"pos":[4900,5051],"content":"<bpt id=\"p1\">[!code-xml</bpt><bpt id=\"p2\">[</bpt>DragDropWalkthrough#CirclesXAML<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/SnippetWindow.xaml#circlesxaml)</ept><ept id=\"p1\">]</ept>","source":"[!code-xml[DragDropWalkthrough#CirclesXAML](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/SnippetWindow.xaml#circlesxaml)]"},{"content":"The full XAML for the panel looks like the following.","pos":[5062,5115]},{"pos":[5126,5285],"content":"<bpt id=\"p1\">[!code-xml</bpt><bpt id=\"p2\">[</bpt>DragDropWalkthrough#PanelsStep2XAML<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/SnippetWindow.xaml#panelsstep2xaml)</ept><ept id=\"p1\">]</ept>","source":"[!code-xml[DragDropWalkthrough#PanelsStep2XAML](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/SnippetWindow.xaml#panelsstep2xaml)]"},{"pos":[5294,5345],"content":"Implementing Drag Source Events in the User Control","linkify":"Implementing Drag Source Events in the User Control","nodes":[{"content":"Implementing Drag Source Events in the User Control","pos":[0,51]}]},{"content":"In this section, you will override the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnMouseMove%2A&gt;</ph> method and initiate the drag-and-drop operation.","pos":[5349,5483],"source":"In this section, you will override the <xref:System.Windows.UIElement.OnMouseMove%2A> method and initiate the drag-and-drop operation."},{"content":"If a drag is started (a mouse button is pressed and the mouse is moved), you will package the data to be transferred into a <ph id=\"ph1\">&lt;xref:System.Windows.DataObject&gt;</ph>.","pos":[5490,5647],"source":"If a drag is started (a mouse button is pressed and the mouse is moved), you will package the data to be transferred into a <xref:System.Windows.DataObject>."},{"content":"In this case, the Circle control will package three data items; a string representation of its Fill color, a double representation of its height, and a copy of itself.","pos":[5648,5815]},{"pos":[5825,5862],"content":"To initiate a drag-and-drop operation","linkify":"To initiate a drag-and-drop operation","nodes":[{"content":"To initiate a drag-and-drop operation","pos":[0,37]}]},{"content":"Open Circle.xaml.cs or Circle.xaml.vb.","pos":[5872,5910]},{"content":"Add the following <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnMouseMove%2A&gt;</ph> override to provide class handling for the <ph id=\"ph2\">&lt;xref:System.Windows.UIElement.MouseMove&gt;</ph> event.","pos":[5920,6076],"source":"Add the following <xref:System.Windows.UIElement.OnMouseMove%2A> override to provide class handling for the <xref:System.Windows.UIElement.MouseMove> event."},{"pos":[6087,6394],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>DragDropWalkthrough#OnMouseMove<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#onmousemove)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>DragDropWalkthrough#OnMouseMove<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#onmousemove)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[DragDropWalkthrough#OnMouseMove](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#onmousemove)]\n [!code-vb[DragDropWalkthrough#OnMouseMove](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#onmousemove)]"},{"content":"This <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnMouseMove%2A&gt;</ph> override performs the following tasks:","pos":[6405,6495],"source":"This <xref:System.Windows.UIElement.OnMouseMove%2A> override performs the following tasks:"},{"content":"Checks whether the left mouse button is pressed while the mouse is moving.","pos":[6509,6583]},{"content":"Packages the Circle data into a <ph id=\"ph1\">&lt;xref:System.Windows.DataObject&gt;</ph>.","pos":[6597,6662],"source":"Packages the Circle data into a <xref:System.Windows.DataObject>."},{"content":"In this case, the Circle control packages three data items; a string representation of its Fill color, a double representation of its height, and a copy of itself.","pos":[6663,6826]},{"content":"Calls the static <ph id=\"ph1\">&lt;xref:System.Windows.DragDrop.DoDragDrop%2A?displayProperty=fullName&gt;</ph> method to initiate the drag-and-drop operation.","pos":[6840,6974],"source":"Calls the static <xref:System.Windows.DragDrop.DoDragDrop%2A?displayProperty=fullName> method to initiate the drag-and-drop operation."},{"content":"You pass the following three parameters to the <ph id=\"ph1\">&lt;xref:System.Windows.DragDrop.DoDragDrop%2A&gt;</ph> method:","pos":[6975,7074],"source":" You pass the following three parameters to the <xref:System.Windows.DragDrop.DoDragDrop%2A> method:"},{"pos":[7092,7135],"content":"<ph id=\"ph1\">`dragSource`</ph> – A reference to this control.","source":"`dragSource` – A reference to this control."},{"pos":[7153,7228],"content":"<ph id=\"ph1\">`data`</ph> – The <ph id=\"ph2\">&lt;xref:System.Windows.DataObject&gt;</ph> created in the previous code.","source":"`data` – The <xref:System.Windows.DataObject> created in the previous code."},{"pos":[7246,7392],"content":"<ph id=\"ph1\">`allowedEffects`</ph> – The allowed drag-and-drop operations, which are <ph id=\"ph2\">&lt;xref:System.Windows.DragDropEffects&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.Windows.DragDropEffects&gt;</ph>.","source":"`allowedEffects` – The allowed drag-and-drop operations, which are <xref:System.Windows.DragDropEffects> or <xref:System.Windows.DragDropEffects>."},{"content":"Press F5 to build and run the application.","pos":[7402,7444]},{"content":"Click one of the Circle controls and drag it over the panels, the other Circle, and the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph>.","pos":[7454,7581],"source":"Click one of the Circle controls and drag it over the panels, the other Circle, and the <xref:System.Windows.Controls.TextBox>."},{"content":"When dragging over the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph>, the cursor changes to indicate a move.","pos":[7582,7683],"source":" When dragging over the <xref:System.Windows.Controls.TextBox>, the cursor changes to indicate a move."},{"content":"While dragging a Circle over the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph>, press the CTRL key.","pos":[7693,7785],"source":"While dragging a Circle over the <xref:System.Windows.Controls.TextBox>, press the CTRL key."},{"content":"Notice how the cursor changes to indicate a copy.","pos":[7786,7835]},{"content":"Drag and drop a Circle onto the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph>.","pos":[7845,7916],"source":"Drag and drop a Circle onto the <xref:System.Windows.Controls.TextBox>."},{"content":"The string representation of the Circle’s fill color is appended to the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph>.","pos":[7917,8028],"source":" The string representation of the Circle’s fill color is appended to the <xref:System.Windows.Controls.TextBox>."},{"pos":[8039,8181],"content":"<bpt id=\"p1\">![</bpt>String representation of Circle's fill color<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wpf/advanced/media/dragdrop-colorstring.png \"</bpt>DragDrop_ColorString<ept id=\"p2\">\")</ept>","source":"![String representation of Circle's fill color](../../../../docs/framework/wpf/advanced/media/dragdrop-colorstring.png \"DragDrop_ColorString\")"},{"content":"By default, the cursor will change during a drag-and-drop operation to indicate what effect dropping the data will have.","pos":[8188,8308]},{"content":"You can customize the feedback given to the user by handling the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.GiveFeedback&gt;</ph> event and setting a different cursor.","pos":[8309,8456],"source":" You can customize the feedback given to the user by handling the <xref:System.Windows.UIElement.GiveFeedback> event and setting a different cursor."},{"pos":[8466,8494],"content":"To give feedback to the user","linkify":"To give feedback to the user","nodes":[{"content":"To give feedback to the user","pos":[0,28]}]},{"content":"Open Circle.xaml.cs or Circle.xaml.vb.","pos":[8504,8542]},{"content":"Add the following <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnGiveFeedback%2A&gt;</ph> override to provide class handling for the <ph id=\"ph2\">&lt;xref:System.Windows.UIElement.GiveFeedback&gt;</ph> event.","pos":[8552,8714],"source":"Add the following <xref:System.Windows.UIElement.OnGiveFeedback%2A> override to provide class handling for the <xref:System.Windows.UIElement.GiveFeedback> event."},{"pos":[8725,9044],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>DragDropWalkthrough#OnGiveFeedback<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#ongivefeedback)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>DragDropWalkthrough#OnGiveFeedback<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#ongivefeedback)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[DragDropWalkthrough#OnGiveFeedback](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#ongivefeedback)]\n [!code-vb[DragDropWalkthrough#OnGiveFeedback](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#ongivefeedback)]"},{"content":"This <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnGiveFeedback%2A&gt;</ph> override performs the following tasks:","pos":[9055,9148],"source":"This <xref:System.Windows.UIElement.OnGiveFeedback%2A> override performs the following tasks:"},{"content":"Checks the <ph id=\"ph1\">&lt;xref:System.Windows.GiveFeedbackEventArgs.Effects%2A&gt;</ph> values that are set in the drop target's <ph id=\"ph2\">&lt;xref:System.Windows.UIElement.DragOver&gt;</ph> event handler.","pos":[9162,9324],"source":"Checks the <xref:System.Windows.GiveFeedbackEventArgs.Effects%2A> values that are set in the drop target's <xref:System.Windows.UIElement.DragOver> event handler."},{"content":"Sets a custom cursor based on the <ph id=\"ph1\">&lt;xref:System.Windows.GiveFeedbackEventArgs.Effects%2A&gt;</ph> value.","pos":[9338,9433],"source":"Sets a custom cursor based on the <xref:System.Windows.GiveFeedbackEventArgs.Effects%2A> value."},{"content":"The cursor is intended to give visual feedback to the user about what effect dropping the data will have.","pos":[9434,9539]},{"content":"Press F5 to build and run the application.","pos":[9549,9591]},{"content":"Drag one of the Circle controls over the panels, the other Circle, and the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph>.","pos":[9601,9715],"source":"Drag one of the Circle controls over the panels, the other Circle, and the <xref:System.Windows.Controls.TextBox>."},{"content":"Notice that the cursors are now the custom cursors that you specified in the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnGiveFeedback%2A&gt;</ph> override.","pos":[9716,9852],"source":" Notice that the cursors are now the custom cursors that you specified in the <xref:System.Windows.UIElement.OnGiveFeedback%2A> override."},{"pos":[9863,9996],"content":"<bpt id=\"p1\">![</bpt>Drag and drop with custom cursors<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wpf/advanced/media/dragdrop-customcursor.png \"</bpt>DragDrop_CustomCursor<ept id=\"p2\">\")</ept>","source":"![Drag and drop with custom cursors](../../../../docs/framework/wpf/advanced/media/dragdrop-customcursor.png \"DragDrop_CustomCursor\")"},{"pos":[10006,10078],"content":"Select the text <ph id=\"ph1\">`green`</ph> from the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph>.","source":"Select the text `green` from the <xref:System.Windows.Controls.TextBox>."},{"content":"Drag the <ph id=\"ph1\">`green`</ph> text to a Circle control.","pos":[10088,10130],"source":"Drag the `green` text to a Circle control."},{"content":"Notice that the default cursors are shown to indicate the effects of the drag-and-drop operation.","pos":[10131,10228]},{"content":"The feedback cursor is always set by the drag source.","pos":[10229,10282]},{"pos":[10291,10342],"content":"Implementing Drop Target Events in the User Control","linkify":"Implementing Drop Target Events in the User Control","nodes":[{"content":"Implementing Drop Target Events in the User Control","pos":[0,51]}]},{"content":"In this section, you will specify that the user control is a drop target, override the methods that enable the user control to be a drop target, and process the data that is dropped on it.","pos":[10346,10534]},{"pos":[10544,10590],"content":"To enable the user control to be a drop target","linkify":"To enable the user control to be a drop target","nodes":[{"content":"To enable the user control to be a drop target","pos":[0,46]}]},{"content":"Open Circle.xaml.","pos":[10600,10617]},{"pos":[10627,10773],"content":"In the opening <ph id=\"ph1\">&lt;xref:System.Windows.Controls.UserControl&gt;</ph> tag, add the <ph id=\"ph2\">&lt;xref:System.Windows.UIElement.AllowDrop%2A&gt;</ph> property and set it to <ph id=\"ph3\">`true`</ph>.","source":"In the opening <xref:System.Windows.Controls.UserControl> tag, add the <xref:System.Windows.UIElement.AllowDrop%2A> property and set it to `true`."},{"pos":[10784,10924],"content":"<bpt id=\"p1\">[!code-xml</bpt><bpt id=\"p2\">[</bpt>DragDropWalkthrough#UCTagXAML<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml#uctagxaml)</ept><ept id=\"p1\">]</ept>","source":"[!code-xml[DragDropWalkthrough#UCTagXAML](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml#uctagxaml)]"},{"content":"The <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnDrop%2A&gt;</ph> method is called when the <ph id=\"ph2\">&lt;xref:System.Windows.UIElement.AllowDrop%2A&gt;</ph> property is set to <ph id=\"ph3\">`true`</ph> and data from the drag source is dropped on the Circle user control.","pos":[10931,11142],"source":"The <xref:System.Windows.UIElement.OnDrop%2A> method is called when the <xref:System.Windows.UIElement.AllowDrop%2A> property is set to `true` and data from the drag source is dropped on the Circle user control."},{"content":"In this method, you will process the data that was dropped and apply the data to the Circle.","pos":[11143,11235]},{"pos":[11245,11272],"content":"To process the dropped data","linkify":"To process the dropped data","nodes":[{"content":"To process the dropped data","pos":[0,27]}]},{"content":"Open Circle.xaml.cs or Circle.xaml.vb.","pos":[11282,11320]},{"content":"Add the following <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnDrop%2A&gt;</ph> override to provide class handling for the <ph id=\"ph2\">&lt;xref:System.Windows.UIElement.Drop&gt;</ph> event.","pos":[11330,11476],"source":"Add the following <xref:System.Windows.UIElement.OnDrop%2A> override to provide class handling for the <xref:System.Windows.UIElement.Drop> event."},{"pos":[11487,11774],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>DragDropWalkthrough#OnDrop<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#ondrop)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>DragDropWalkthrough#OnDrop<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#ondrop)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[DragDropWalkthrough#OnDrop](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#ondrop)]\n [!code-vb[DragDropWalkthrough#OnDrop](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#ondrop)]"},{"content":"This <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnDrop%2A&gt;</ph> override performs the following tasks:","pos":[11785,11870],"source":"This <xref:System.Windows.UIElement.OnDrop%2A> override performs the following tasks:"},{"content":"Uses the <ph id=\"ph1\">&lt;xref:System.Windows.DataObject.GetDataPresent%2A&gt;</ph> method to check if the dragged data contains a string object.","pos":[11884,12005],"source":"Uses the <xref:System.Windows.DataObject.GetDataPresent%2A> method to check if the dragged data contains a string object."},{"content":"Uses the <ph id=\"ph1\">&lt;xref:System.Windows.DataObject.GetData%2A&gt;</ph> method to extract the string data if it is present.","pos":[12019,12123],"source":"Uses the <xref:System.Windows.DataObject.GetData%2A> method to extract the string data if it is present."},{"content":"Uses a <ph id=\"ph1\">&lt;xref:System.Windows.Media.BrushConverter&gt;</ph> to try to convert the string to a <ph id=\"ph2\">&lt;xref:System.Windows.Media.Brush&gt;</ph>.","pos":[12137,12255],"source":"Uses a <xref:System.Windows.Media.BrushConverter> to try to convert the string to a <xref:System.Windows.Media.Brush>."},{"content":"If the conversion is successful, applies the brush to the <ph id=\"ph1\">&lt;xref:System.Windows.Shapes.Shape.Fill%2A&gt;</ph> of the <ph id=\"ph2\">&lt;xref:System.Windows.Shapes.Ellipse&gt;</ph> that provides the UI of the Circle control.","pos":[12269,12457],"source":"If the conversion is successful, applies the brush to the <xref:System.Windows.Shapes.Shape.Fill%2A> of the <xref:System.Windows.Shapes.Ellipse> that provides the UI of the Circle control."},{"content":"Marks the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.Drop&gt;</ph> event as handled.","pos":[12471,12535],"source":"Marks the <xref:System.Windows.UIElement.Drop> event as handled."},{"content":"You should mark the drop event as handled so that other elements that receive this event know that the Circle user control handled it.","pos":[12536,12670]},{"content":"Press F5 to build and run the application.","pos":[12680,12722]},{"pos":[12732,12802],"content":"Select the text <ph id=\"ph1\">`green`</ph> in the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph>.","source":"Select the text `green` in the <xref:System.Windows.Controls.TextBox>."},{"content":"Drag the text to a Circle control and drop it.","pos":[12812,12858]},{"content":"The Circle changes from blue to green.","pos":[12859,12897]},{"pos":[12908,13037],"content":"<bpt id=\"p1\">![</bpt>Convert a string to a brush<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wpf/advanced/media/dragdrop-dropgreentext.png \"</bpt>DragDrop_DropGreenText<ept id=\"p2\">\")</ept>","source":"![Convert a string to a brush](../../../../docs/framework/wpf/advanced/media/dragdrop-dropgreentext.png \"DragDrop_DropGreenText\")"},{"pos":[13047,13115],"content":"Type the text <ph id=\"ph1\">`green`</ph> in the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph>.","source":"Type the text `green` in the <xref:System.Windows.Controls.TextBox>."},{"pos":[13125,13193],"content":"Select the text <ph id=\"ph1\">`gre`</ph> in the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph>.","source":"Select the text `gre` in the <xref:System.Windows.Controls.TextBox>."},{"content":"Drag it to a Circle control and drop it.","pos":[13203,13243]},{"content":"Notice that the cursor changes to indicate that the drop is allowed, but the color of the Circle does not change because <ph id=\"ph1\">`gre`</ph> is not a valid color.","pos":[13244,13392],"source":" Notice that the cursor changes to indicate that the drop is allowed, but the color of the Circle does not change because `gre` is not a valid color."},{"content":"Drag from the green Circle control and drop on the blue Circle control.","pos":[13401,13472]},{"content":"The Circle changes from blue to green.","pos":[13473,13511]},{"content":"Notice that which cursor is shown depends on whether the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph> or the Circle is the drag source.","pos":[13512,13641],"source":" Notice that which cursor is shown depends on whether the <xref:System.Windows.Controls.TextBox> or the Circle is the drag source."},{"content":"Setting the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.AllowDrop%2A&gt;</ph> property to <ph id=\"ph2\">`true`</ph> and processing the dropped data is all that is required to enable an element to be a drop target.","pos":[13648,13821],"source":"Setting the <xref:System.Windows.UIElement.AllowDrop%2A> property to `true` and processing the dropped data is all that is required to enable an element to be a drop target."},{"content":"However, to provide a better user experience, you should also handle the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.DragEnter&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.Windows.UIElement.DragLeave&gt;</ph>, and <ph id=\"ph3\">&lt;xref:System.Windows.UIElement.DragOver&gt;</ph> events.","pos":[13822,14033],"source":" However, to provide a better user experience, you should also handle the <xref:System.Windows.UIElement.DragEnter>, <xref:System.Windows.UIElement.DragLeave>, and <xref:System.Windows.UIElement.DragOver> events."},{"content":"In these events, you can perform checks and provide additional feedback to the user before the data is dropped.","pos":[14034,14145]},{"content":"When data is dragged over the Circle user control, the control should notify the drag source whether it can process the data that is being dragged.","pos":[14152,14299]},{"content":"If the control does not know how to process the data, it should refuse the drop.","pos":[14300,14380]},{"content":"To do this, you will handle the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.DragOver&gt;</ph> event and set the <ph id=\"ph2\">&lt;xref:System.Windows.DragEventArgs.Effects%2A&gt;</ph> property.","pos":[14381,14528],"source":" To do this, you will handle the <xref:System.Windows.UIElement.DragOver> event and set the <xref:System.Windows.DragEventArgs.Effects%2A> property."},{"pos":[14538,14577],"content":"To verify that the data drop is allowed","linkify":"To verify that the data drop is allowed","nodes":[{"content":"To verify that the data drop is allowed","pos":[0,39]}]},{"content":"Open Circle.xaml.cs or Circle.xaml.vb.","pos":[14587,14625]},{"content":"Add the following <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnDragOver%2A&gt;</ph> override to provide class handling for the <ph id=\"ph2\">&lt;xref:System.Windows.UIElement.DragOver&gt;</ph> event.","pos":[14635,14789],"source":"Add the following <xref:System.Windows.UIElement.OnDragOver%2A> override to provide class handling for the <xref:System.Windows.UIElement.DragOver> event."},{"pos":[14800,15103],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>DragDropWalkthrough#OnDragOver<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#ondragover)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>DragDropWalkthrough#OnDragOver<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#ondragover)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[DragDropWalkthrough#OnDragOver](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#ondragover)]\n [!code-vb[DragDropWalkthrough#OnDragOver](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#ondragover)]"},{"content":"This <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnDragOver%2A&gt;</ph> override performs the following tasks:","pos":[15114,15203],"source":"This <xref:System.Windows.UIElement.OnDragOver%2A> override performs the following tasks:"},{"content":"Sets the <ph id=\"ph1\">&lt;xref:System.Windows.DragEventArgs.Effects%2A&gt;</ph> property to <ph id=\"ph2\">&lt;xref:System.Windows.DragDropEffects&gt;</ph>.","pos":[15217,15323],"source":"Sets the <xref:System.Windows.DragEventArgs.Effects%2A> property to <xref:System.Windows.DragDropEffects>."},{"content":"Performs the same checks that are performed in the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnDrop%2A&gt;</ph> method to determine whether the Circle user control can process the dragged data.","pos":[15337,15511],"source":"Performs the same checks that are performed in the <xref:System.Windows.UIElement.OnDrop%2A> method to determine whether the Circle user control can process the dragged data."},{"content":"If the user control can process the data, sets the <ph id=\"ph1\">&lt;xref:System.Windows.DragEventArgs.Effects%2A&gt;</ph> property to <ph id=\"ph2\">&lt;xref:System.Windows.DragDropEffects&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.Windows.DragDropEffects&gt;</ph>.","pos":[15525,15714],"source":"If the user control can process the data, sets the <xref:System.Windows.DragEventArgs.Effects%2A> property to <xref:System.Windows.DragDropEffects> or <xref:System.Windows.DragDropEffects>."},{"content":"Press F5 to build and run the application.","pos":[15724,15766]},{"pos":[15776,15844],"content":"Select the text <ph id=\"ph1\">`gre`</ph> in the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph>.","source":"Select the text `gre` in the <xref:System.Windows.Controls.TextBox>."},{"content":"Drag the text to a Circle control.","pos":[15854,15888]},{"content":"Notice that the cursor now changes to indicate that the drop is not allowed because <ph id=\"ph1\">`gre`</ph> is not a valid color.","pos":[15889,16000],"source":" Notice that the cursor now changes to indicate that the drop is not allowed because `gre` is not a valid color."},{"content":"You can further enhance the user experience by applying a preview of the drop operation.","pos":[16007,16095]},{"content":"For the Circle user control, you will override the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnDragEnter%2A&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Windows.UIElement.OnDragLeave%2A&gt;</ph> methods.","pos":[16096,16253],"source":" For the Circle user control, you will override the <xref:System.Windows.UIElement.OnDragEnter%2A> and <xref:System.Windows.UIElement.OnDragLeave%2A> methods."},{"content":"When the data is dragged over the control, the current background <ph id=\"ph1\">&lt;xref:System.Windows.Shapes.Shape.Fill%2A&gt;</ph> is saved in a placeholder variable.","pos":[16254,16398],"source":" When the data is dragged over the control, the current background <xref:System.Windows.Shapes.Shape.Fill%2A> is saved in a placeholder variable."},{"content":"The string is then converted to a brush and applied to the <ph id=\"ph1\">&lt;xref:System.Windows.Shapes.Ellipse&gt;</ph> that provides the Circle's UI.","pos":[16399,16525],"source":" The string is then converted to a brush and applied to the <xref:System.Windows.Shapes.Ellipse> that provides the Circle's UI."},{"content":"If the data is dragged out of the Circle without being dropped, the original <ph id=\"ph1\">&lt;xref:System.Windows.Shapes.Shape.Fill%2A&gt;</ph> value is re-applied to the Circle.","pos":[16526,16680],"source":" If the data is dragged out of the Circle without being dropped, the original <xref:System.Windows.Shapes.Shape.Fill%2A> value is re-applied to the Circle."},{"pos":[16690,16743],"content":"To preview the effects of the drag-and-drop operation","linkify":"To preview the effects of the drag-and-drop operation","nodes":[{"content":"To preview the effects of the drag-and-drop operation","pos":[0,53]}]},{"content":"Open Circle.xaml.cs or Circle.xaml.vb.","pos":[16753,16791]},{"pos":[16801,16933],"content":"In the Circle class, declare a private <ph id=\"ph1\">&lt;xref:System.Windows.Media.Brush&gt;</ph> variable named <ph id=\"ph2\">`_previousFill`</ph> and initialize it to <ph id=\"ph3\">`null`</ph>.","source":"In the Circle class, declare a private <xref:System.Windows.Media.Brush> variable named `_previousFill` and initialize it to `null`."},{"pos":[16944,17227],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>DragDropWalkthrough#Brush<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#brush)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>DragDropWalkthrough#Brush<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#brush)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[DragDropWalkthrough#Brush](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#brush)]\n [!code-vb[DragDropWalkthrough#Brush](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#brush)]"},{"content":"Add the following <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnDragEnter%2A&gt;</ph> override to provide class handling for the <ph id=\"ph2\">&lt;xref:System.Windows.UIElement.DragEnter&gt;</ph> event.","pos":[17237,17393],"source":"Add the following <xref:System.Windows.UIElement.OnDragEnter%2A> override to provide class handling for the <xref:System.Windows.UIElement.DragEnter> event."},{"pos":[17404,17711],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>DragDropWalkthrough#OnDragEnter<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#ondragenter)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>DragDropWalkthrough#OnDragEnter<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#ondragenter)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[DragDropWalkthrough#OnDragEnter](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#ondragenter)]\n [!code-vb[DragDropWalkthrough#OnDragEnter](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#ondragenter)]"},{"content":"This <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnDragEnter%2A&gt;</ph> override performs the following tasks:","pos":[17722,17812],"source":"This <xref:System.Windows.UIElement.OnDragEnter%2A> override performs the following tasks:"},{"pos":[17826,17964],"content":"Saves the <ph id=\"ph1\">&lt;xref:System.Windows.Shapes.Shape.Fill%2A&gt;</ph> property of the <ph id=\"ph2\">&lt;xref:System.Windows.Shapes.Ellipse&gt;</ph> in the <ph id=\"ph3\">`_previousFill`</ph> variable.","source":"Saves the <xref:System.Windows.Shapes.Shape.Fill%2A> property of the <xref:System.Windows.Shapes.Ellipse> in the `_previousFill` variable."},{"content":"Performs the same checks that are performed in the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnDrop%2A&gt;</ph> method to determine whether the data can be converted to a <ph id=\"ph2\">&lt;xref:System.Windows.Media.Brush&gt;</ph>.","pos":[17978,18164],"source":"Performs the same checks that are performed in the <xref:System.Windows.UIElement.OnDrop%2A> method to determine whether the data can be converted to a <xref:System.Windows.Media.Brush>."},{"content":"If the data is converted to a valid <ph id=\"ph1\">&lt;xref:System.Windows.Media.Brush&gt;</ph>, applies it to the <ph id=\"ph2\">&lt;xref:System.Windows.Shapes.Shape.Fill%2A&gt;</ph> of the <ph id=\"ph3\">&lt;xref:System.Windows.Shapes.Ellipse&gt;</ph>.","pos":[18178,18354],"source":"If the data is converted to a valid <xref:System.Windows.Media.Brush>, applies it to the <xref:System.Windows.Shapes.Shape.Fill%2A> of the <xref:System.Windows.Shapes.Ellipse>."},{"content":"Add the following <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnDragLeave%2A&gt;</ph> override to provide class handling for the <ph id=\"ph2\">&lt;xref:System.Windows.UIElement.DragLeave&gt;</ph> event.","pos":[18364,18520],"source":"Add the following <xref:System.Windows.UIElement.OnDragLeave%2A> override to provide class handling for the <xref:System.Windows.UIElement.DragLeave> event."},{"pos":[18531,18838],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>DragDropWalkthrough#OnDragLeave<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#ondragleave)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>DragDropWalkthrough#OnDragLeave<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#ondragleave)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[DragDropWalkthrough#OnDragLeave](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/Circle.xaml.cs#ondragleave)]\n [!code-vb[DragDropWalkthrough#OnDragLeave](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/Circle.xaml.vb#ondragleave)]"},{"content":"This <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.OnDragLeave%2A&gt;</ph> override performs the following tasks:","pos":[18849,18939],"source":"This <xref:System.Windows.UIElement.OnDragLeave%2A> override performs the following tasks:"},{"pos":[18953,19179],"content":"Applies the <ph id=\"ph1\">&lt;xref:System.Windows.Media.Brush&gt;</ph> saved in the <ph id=\"ph2\">`_previousFill`</ph> variable to the <ph id=\"ph3\">&lt;xref:System.Windows.Shapes.Shape.Fill%2A&gt;</ph> of the <ph id=\"ph4\">&lt;xref:System.Windows.Shapes.Ellipse&gt;</ph> that provides the UI of the Circle user control.","source":"Applies the <xref:System.Windows.Media.Brush> saved in the `_previousFill` variable to the <xref:System.Windows.Shapes.Shape.Fill%2A> of the <xref:System.Windows.Shapes.Ellipse> that provides the UI of the Circle user control."},{"content":"Press F5 to build and run the application.","pos":[19189,19231]},{"pos":[19241,19311],"content":"Select the text <ph id=\"ph1\">`green`</ph> in the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph>.","source":"Select the text `green` in the <xref:System.Windows.Controls.TextBox>."},{"content":"Drag the text over a Circle control without dropping it.","pos":[19321,19377]},{"content":"The Circle changes from blue to green.","pos":[19378,19416]},{"pos":[19427,19587],"content":"<bpt id=\"p1\">![</bpt>Preview the effects of a drag&amp;#45;and&amp;#45;drop operation<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wpf/advanced/media/dragdrop-previeweffects.png \"</bpt>DragDrop_PreviewEffects<ept id=\"p2\">\")</ept>","source":"![Preview the effects of a drag&#45;and&#45;drop operation](../../../../docs/framework/wpf/advanced/media/dragdrop-previeweffects.png \"DragDrop_PreviewEffects\")"},{"content":"Drag the text away from the Circle control.","pos":[19597,19640]},{"content":"The Circle changes from green back to blue.","pos":[19641,19684]},{"pos":[19693,19733],"content":"Enabling a Panel to Receive Dropped Data","linkify":"Enabling a Panel to Receive Dropped Data","nodes":[{"content":"Enabling a Panel to Receive Dropped Data","pos":[0,40]}]},{"content":"In this section, you will enable the panels that host the Circle user controls to act as drop targets for dragged Circle data.","pos":[19737,19863]},{"content":"You will implement code that enables you to move a Circle from one panel to another, or to make a copy of a Circle control by holding down the CTRL key while dragging and dropping a Circle.","pos":[19864,20053]},{"pos":[20063,20102],"content":"To enable the panel to be a drop target","linkify":"To enable the panel to be a drop target","nodes":[{"content":"To enable the panel to be a drop target","pos":[0,39]}]},{"content":"Open MainWindow.xaml.","pos":[20112,20133]},{"content":"As shown in the following XAML, in each of the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.StackPanel&gt;</ph> controls, add handlers for the <ph id=\"ph2\">&lt;xref:System.Windows.UIElement.DragOver&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.Windows.UIElement.Drop&gt;</ph> events.","pos":[20143,20352],"source":"As shown in the following XAML, in each of the <xref:System.Windows.Controls.StackPanel> controls, add handlers for the <xref:System.Windows.UIElement.DragOver> and <xref:System.Windows.UIElement.Drop> events."},{"content":"Name the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.DragOver&gt;</ph> event handler, <ph id=\"ph2\">`panel_DragOver`</ph>, and name the <ph id=\"ph3\">&lt;xref:System.Windows.UIElement.Drop&gt;</ph> event handler, <ph id=\"ph4\">`panel_Drop`</ph>.","pos":[20353,20514],"source":" Name the <xref:System.Windows.UIElement.DragOver> event handler, `panel_DragOver`, and name the <xref:System.Windows.UIElement.Drop> event handler, `panel_Drop`."},{"pos":[20525,20671],"content":"<bpt id=\"p1\">[!code-xml</bpt><bpt id=\"p2\">[</bpt>DragDropWalkthrough#PanelsXAML<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/MainWindow.xaml#panelsxaml)</ept><ept id=\"p1\">]</ept>","source":"[!code-xml[DragDropWalkthrough#PanelsXAML](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/MainWindow.xaml#panelsxaml)]"},{"content":"Open MainWindows.xaml.cs or MainWindow.xaml.vb.","pos":[20681,20728]},{"content":"Add the following code for the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.DragOver&gt;</ph> event handler.","pos":[20738,20824],"source":"Add the following code for the <xref:System.Windows.UIElement.DragOver> event handler."},{"pos":[20835,21158],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>DragDropWalkthrough#PanelDragOver<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/MainWindow.xaml.cs#paneldragover)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>DragDropWalkthrough#PanelDragOver<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/MainWindow.xaml.vb#paneldragover)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[DragDropWalkthrough#PanelDragOver](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/MainWindow.xaml.cs#paneldragover)]\n [!code-vb[DragDropWalkthrough#PanelDragOver](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/MainWindow.xaml.vb#paneldragover)]"},{"content":"This <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.DragOver&gt;</ph> event handler performs the following tasks:","pos":[21169,21258],"source":"This <xref:System.Windows.UIElement.DragOver> event handler performs the following tasks:"},{"content":"Checks that the dragged data contains the \"Object\" data that was packaged in the <ph id=\"ph1\">&lt;xref:System.Windows.DataObject&gt;</ph> by the Circle user control and passed in the call to <ph id=\"ph2\">&lt;xref:System.Windows.DragDrop.DoDragDrop%2A&gt;</ph>.","pos":[21272,21484],"source":"Checks that the dragged data contains the \"Object\" data that was packaged in the <xref:System.Windows.DataObject> by the Circle user control and passed in the call to <xref:System.Windows.DragDrop.DoDragDrop%2A>."},{"content":"If the \"Object\" data is present, checks whether the CTRL key is pressed.","pos":[21498,21570]},{"content":"If the CTRL key is pressed, sets the <ph id=\"ph1\">&lt;xref:System.Windows.DragEventArgs.Effects%2A&gt;</ph> property to <ph id=\"ph2\">&lt;xref:System.Windows.DragDropEffects&gt;</ph>.","pos":[21584,21718],"source":"If the CTRL key is pressed, sets the <xref:System.Windows.DragEventArgs.Effects%2A> property to <xref:System.Windows.DragDropEffects>."},{"content":"Otherwise, set the <ph id=\"ph1\">&lt;xref:System.Windows.DragEventArgs.Effects%2A&gt;</ph> property to <ph id=\"ph2\">&lt;xref:System.Windows.DragDropEffects&gt;</ph>.","pos":[21719,21835],"source":" Otherwise, set the <xref:System.Windows.DragEventArgs.Effects%2A> property to <xref:System.Windows.DragDropEffects>."},{"content":"Add the following code for the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.Drop&gt;</ph> event handler.","pos":[21845,21927],"source":"Add the following code for the <xref:System.Windows.UIElement.Drop> event handler."},{"pos":[21938,22245],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>DragDropWalkthrough#PanelDrop<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/MainWindow.xaml.cs#paneldrop)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>DragDropWalkthrough#PanelDrop<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/MainWindow.xaml.vb#paneldrop)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[DragDropWalkthrough#PanelDrop](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DragDropWalkthrough/CS/MainWindow.xaml.cs#paneldrop)]\n [!code-vb[DragDropWalkthrough#PanelDrop](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DragDropWalkthrough/VB/MainWindow.xaml.vb#paneldrop)]"},{"content":"This <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.Drop&gt;</ph> event handler performs the following tasks:","pos":[22256,22341],"source":"This <xref:System.Windows.UIElement.Drop> event handler performs the following tasks:"},{"content":"Checks whether the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.Drop&gt;</ph> event has already been handled.","pos":[22355,22442],"source":"Checks whether the <xref:System.Windows.UIElement.Drop> event has already been handled."},{"content":"For instance, if a Circle is dropped on another Circle which handles the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.Drop&gt;</ph> event, you do not want the panel that contains the Circle to also handle it.","pos":[22443,22629],"source":" For instance, if a Circle is dropped on another Circle which handles the <xref:System.Windows.UIElement.Drop> event, you do not want the panel that contains the Circle to also handle it."},{"content":"If the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.Drop&gt;</ph> event is not handled, checks whether the CTRL key is pressed.","pos":[22643,22748],"source":"If the <xref:System.Windows.UIElement.Drop> event is not handled, checks whether the CTRL key is pressed."},{"content":"If the CTRL key is pressed when the <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.Drop&gt;</ph> happens, makes a copy of the Circle control and add it to the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.Panel.Children%2A&gt;</ph> collection of the <ph id=\"ph3\">&lt;xref:System.Windows.Controls.StackPanel&gt;</ph>.","pos":[22762,23006],"source":"If the CTRL key is pressed when the <xref:System.Windows.UIElement.Drop> happens, makes a copy of the Circle control and add it to the <xref:System.Windows.Controls.Panel.Children%2A> collection of the <xref:System.Windows.Controls.StackPanel>."},{"content":"If the CTRL key is not pressed, moves the Circle from the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.Panel.Children%2A&gt;</ph> collection of its parent panel to the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.Panel.Children%2A&gt;</ph> collection of the panel that it was dropped on.","pos":[23020,23261],"source":"If the CTRL key is not pressed, moves the Circle from the <xref:System.Windows.Controls.Panel.Children%2A> collection of its parent panel to the <xref:System.Windows.Controls.Panel.Children%2A> collection of the panel that it was dropped on."},{"content":"Sets the <ph id=\"ph1\">&lt;xref:System.Windows.DragEventArgs.Effects%2A&gt;</ph> property to notify the <ph id=\"ph2\">&lt;xref:System.Windows.DragDrop.DoDragDrop%2A&gt;</ph> method whether a move or copy operation was performed.","pos":[23275,23453],"source":"Sets the <xref:System.Windows.DragEventArgs.Effects%2A> property to notify the <xref:System.Windows.DragDrop.DoDragDrop%2A> method whether a move or copy operation was performed."},{"content":"Press F5 to build and run the application.","pos":[23463,23505]},{"pos":[23515,23587],"content":"Select the text <ph id=\"ph1\">`green`</ph> from the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.TextBox&gt;</ph>.","source":"Select the text `green` from the <xref:System.Windows.Controls.TextBox>."},{"content":"Drag the text over a Circle control and drop it.","pos":[23597,23645]},{"content":"Drag a Circle control from the left panel to the right panel and drop it.","pos":[23654,23727]},{"content":"The Circle is removed from the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.Panel.Children%2A&gt;</ph> collection of the left panel and added to the Children collection of the right panel.","pos":[23728,23893],"source":" The Circle is removed from the <xref:System.Windows.Controls.Panel.Children%2A> collection of the left panel and added to the Children collection of the right panel."},{"content":"Drag a Circle control from the panel it is in to the other panel and drop it while pressing the CTRL key.","pos":[23903,24008]},{"content":"The Circle is copied and the copy is added to the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.Panel.Children%2A&gt;</ph> collection of the receiving panel.","pos":[24009,24142],"source":" The Circle is copied and the copy is added to the <xref:System.Windows.Controls.Panel.Children%2A> collection of the receiving panel."},{"pos":[24153,24292],"content":"<bpt id=\"p1\">![</bpt>Dragging a Circle while pressing the CTRL key<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wpf/advanced/media/dragdrop-paneldrop.png \"</bpt>DragDrop_PanelDrop<ept id=\"p2\">\")</ept>","source":"![Dragging a Circle while pressing the CTRL key](../../../../docs/framework/wpf/advanced/media/dragdrop-paneldrop.png \"DragDrop_PanelDrop\")"},{"pos":[24301,24309],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[24313,24404],"content":"<bpt id=\"p1\">[</bpt>Drag and Drop Overview<ept id=\"p1\">](../../../../docs/framework/wpf/advanced/drag-and-drop-overview.md)</ept>","source":"[Drag and Drop Overview](../../../../docs/framework/wpf/advanced/drag-and-drop-overview.md)"}]}