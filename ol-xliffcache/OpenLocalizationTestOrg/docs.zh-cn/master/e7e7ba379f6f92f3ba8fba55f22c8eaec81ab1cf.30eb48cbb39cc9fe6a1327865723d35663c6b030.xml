{"content":"---\ntitle: \"Performance Counters in ADO.NET\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 0b121b71-78f8-4ae2-9aa1-0b2e15778e57\n---\n# Performance Counters in ADO.NET\nADO.NET 2.0 introduced expanded support for performance counters that includes support for both <xref:System.Data.SqlClient> and <xref:System.Data.OracleClient>. The <xref:System.Data.SqlClient> performance counters available in previous versions of ADO.NET have been deprecated and replaced with the new performance counters discussed in this topic. You can use ADO.NET performance counters to monitor the status of your application and the connection resources that it uses. Performance counters can be monitored by using Windows Performance Monitor or can be accessed programmatically using the <xref:System.Diagnostics.PerformanceCounter> class in the <xref:System.Diagnostics> namespace.  \n  \n## Available Performance Counters  \n Currently there are 14 different performance counters available for <xref:System.Data.SqlClient> and <xref:System.Data.OracleClient> as described in the following table. Note that the names for the individual counters are not localized across regional versions of the Microsoft .NET Framework.  \n  \n|Performance counter|Description|  \n|-------------------------|-----------------|  \n|`HardConnectsPerSecond`|The number of connections per second that are being made to a database server.|  \n|`HardDisconnectsPerSecond`|The number of disconnects per second that are being made to a database server.|  \n|`NumberOfActiveConnectionPoolGroups`|The number of unique connection pool groups that are active. This counter is controlled by the number of unique connection strings that are found in the AppDomain.|  \n|`NumberOfActiveConnectionPools`|The total number of connection pools.|  \n|`NumberOfActiveConnections`|The number of active connections that are currently in use. **Note:**  This performance counter is not enabled by default. To enable this performance counter, see [Activating Off-By-Default Counters](#ActivatingOffByDefault).|  \n|`NumberOfFreeConnections`|The number of connections available for use in the connection pools. **Note:**  This performance counter is not enabled by default. To enable this performance counter, see [Activating Off-By-Default Counters](#ActivatingOffByDefault).|  \n|`NumberOfInactiveConnectionPoolGroups`|The number of unique connection pool groups that are marked for pruning. This counter is controlled by the number of unique connection strings that are found in the AppDomain.|  \n|`NumberOfInactiveConnectionPools`|The number of inactive connection pools that have not had any recent activity and are waiting to be disposed.|  \n|`NumberOfNonPooledConnections`|The number of active connections that are not pooled.|  \n|`NumberOfPooledConnections`|The number of active connections that are being managed by the connection pooling infrastructure.|  \n|`NumberOfReclaimedConnections`|The number of connections that have been reclaimed through garbage collection where `Close` or `Dispose` was not called by the application. Not explicitly closing or disposing connections hurts performance.|  \n|`NumberOfStasisConnections`|The number of connections currently awaiting completion of an action and which are therefore unavailable for use by your application.|  \n|`SoftConnectsPerSecond`|The number of active connections being pulled from the connection pool. **Note:**  This performance counter is not enabled by default. To enable this performance counter, see [Activating Off-By-Default Counters](#ActivatingOffByDefault).|  \n|`SoftDisconnectsPerSecond`|The number of active connections that are being returned to the connection pool. **Note:**  This performance counter is not enabled by default. To enable this performance counter, see [Activating Off-By-Default Counters](#ActivatingOffByDefault).|  \n  \n### Connection Pool Groups and Connection Pools  \n When using Windows Authentication (integrated security), you must monitor both the `NumberOfActiveConnectionPoolGroups` and `NumberOfActiveConnectionPools` performance counters. The reason is that connection pool groups map to unique connection strings. When integrated security is used, connection pools map to connection strings and additionally create separate pools for individual Windows identities. For example, if Fred and Julie, each within the same AppDomain, both use the connection string `\"Data Source=MySqlServer;Integrated Security=true\"`, a connection pool group is created for the connection string, and two additional pools are created, one for Fred and one for Julie. If John and Martha use a connection string with an identical SQL Server login, `\"Data Source=MySqlServer;User Id=lowPrivUser;Password=Strong?Password\"`, then only a single pool is created for the **lowPrivUser** identity.  \n  \n<a name=\"ActivatingOffByDefault\"></a>   \n### Activating Off-By-Default Counters  \n The performance counters `NumberOfFreeConnections`, `NumberOfActiveConnections`, `SoftDisconnectsPerSecond`, and `SoftConnectsPerSecond` are off by default. Add the following information to the application's configuration file to enable them:  \n  \n```xml  \n<system.diagnostics>  \n  <switches>  \n    <add name=\"ConnectionPoolPerformanceCounterDetail\"  \n         value=\"4\"/>  \n  </switches>  \n</system.diagnostics>  \n```  \n  \n## Retrieving Performance Counter Values  \n The following console application shows how to retrieve performance counter values in your application. Connections must be open and active for information to be returned for all of the ADO.NET performance counters.  \n  \n> [!NOTE]\n>  This example uses the sample **AdventureWorks** database included with SQL Server. The connection strings provided in the sample code assume that the database is installed and available on the local computer with an instance name of SqlExpress, and that you have created SQL Server logins that match those supplied in the connection strings. You may need to enable SQL Server logins if your server is configured using the default security settings which allow only Windows Authentication. Modify the connection strings as necessary to suit your environment.  \n  \n### Example  \n  \n```vb  \nOption Explicit On  \nOption Strict On  \n  \nImports System.Data.SqlClient  \nImports System.Diagnostics  \nImports System.Runtime.InteropServices  \n  \nClass Program  \n  \n    Private PerfCounters(9) As PerformanceCounter  \n    Private connection As SqlConnection = New SqlConnection  \n  \n    Public Shared Sub Main()  \n        Dim prog As Program = New Program  \n        ' Open a connection and create the performance counters.   \n        prog.connection.ConnectionString = _  \n           GetIntegratedSecurityConnectionString()  \n        prog.SetUpPerformanceCounters()  \n        Console.WriteLine(\"Available Performance Counters:\")  \n  \n        ' Create the connections and display the results.  \n        prog.CreateConnections()  \n        Console.WriteLine(\"Press Enter to finish.\")  \n        Console.ReadLine()  \n    End Sub  \n  \n    Private Sub CreateConnections()  \n        ' List the Performance counters.  \n        WritePerformanceCounters()  \n  \n        ' Create 4 connections and display counter information.  \n        Dim connection1 As SqlConnection = New SqlConnection( _  \n           GetIntegratedSecurityConnectionString)  \n        connection1.Open()  \n        Console.WriteLine(\"Opened the 1st Connection:\")  \n        WritePerformanceCounters()  \n  \n        Dim connection2 As SqlConnection = New SqlConnection( _  \n           GetSqlConnectionStringDifferent)  \n        connection2.Open()  \n        Console.WriteLine(\"Opened the 2nd Connection:\")  \n        WritePerformanceCounters()  \n  \n        Console.WriteLine(\"Opened the 3rd Connection:\")  \n        Dim connection3 As SqlConnection = New SqlConnection( _  \n           GetSqlConnectionString)  \n        connection3.Open()  \n        WritePerformanceCounters()  \n  \n        Dim connection4 As SqlConnection = New SqlConnection( _  \n           GetSqlConnectionString)  \n        connection4.Open()  \n        Console.WriteLine(\"Opened the 4th Connection:\")  \n        WritePerformanceCounters()  \n  \n        connection1.Close()  \n        Console.WriteLine(\"Closed the 1st Connection:\")  \n        WritePerformanceCounters()  \n  \n        connection2.Close()  \n        Console.WriteLine(\"Closed the 2nd Connection:\")  \n        WritePerformanceCounters()  \n  \n        connection3.Close()  \n        Console.WriteLine(\"Closed the 3rd Connection:\")  \n        WritePerformanceCounters()  \n  \n        connection4.Close()  \n        Console.WriteLine(\"Closed the 4th Connection:\")  \n        WritePerformanceCounters()  \n    End Sub  \n  \n    Private Enum ADO_Net_Performance_Counters  \n        NumberOfActiveConnectionPools  \n        NumberOfReclaimedConnections  \n        HardConnectsPerSecond  \n        HardDisconnectsPerSecond  \n        NumberOfActiveConnectionPoolGroups  \n        NumberOfInactiveConnectionPoolGroups  \n        NumberOfInactiveConnectionPools  \n        NumberOfNonPooledConnections  \n        NumberOfPooledConnections  \n        NumberOfStasisConnections  \n        ' The following performance counters are more expensive to track.  \n        ' Enable ConnectionPoolPerformanceCounterDetail in your config file.  \n        '     SoftConnectsPerSecond  \n        '     SoftDisconnectsPerSecond  \n        '     NumberOfActiveConnections  \n        '     NumberOfFreeConnections  \n    End Enum  \n  \n    Private Sub SetUpPerformanceCounters()  \n        connection.Close()  \n        Me.PerfCounters(9) = New PerformanceCounter()  \n  \n        Dim instanceName As String = GetInstanceName()  \n        Dim apc As Type = GetType(ADO_Net_Performance_Counters)  \n        Dim i As Integer = 0  \n        Dim s As String = \"\"  \n        For Each s In [Enum].GetNames(apc)  \n            Me.PerfCounters(i) = New PerformanceCounter()  \n            Me.PerfCounters(i).CategoryName = \".NET Data Provider for SqlServer\"  \n            Me.PerfCounters(i).CounterName = s  \n            Me.PerfCounters(i).InstanceName = instanceName  \n            i = (i + 1)  \n        Next  \n    End Sub  \n  \n    Private Declare Function GetCurrentProcessId Lib \"kernel32.dll\" () As Integer  \n  \n    Private Function GetInstanceName() As String  \n        'This works for Winforms apps.   \n        Dim instanceName As String = _  \n           System.Reflection.Assembly.GetEntryAssembly.GetName.Name  \n  \n        ' Must replace special characters like (, ), #, /, \\\\   \n        Dim instanceName2 As String = _  \n           AppDomain.CurrentDomain.FriendlyName.ToString.Replace(\"(\", \"[\") _  \n           .Replace(\")\", \"]\").Replace(\"#\", \"_\").Replace(\"/\", \"_\").Replace(\"\\\\\", \"_\")  \n  \n        'For ASP.NET applications your instanceName will be your CurrentDomain's   \n        'FriendlyName. Replace the line above that sets the instanceName with this:   \n        'instanceName = AppDomain.CurrentDomain.FriendlyName.ToString.Replace(\"(\", \"[\") _  \n        '    .Replace(\")\", \"]\").Replace(\"#\", \"_\").Replace(\"/\", \"_\").Replace(\"\\\\\", \"_\")  \n  \n        Dim pid As String = GetCurrentProcessId.ToString  \n        instanceName = (instanceName + (\"[\" & (pid & \"]\")))  \n        Console.WriteLine(\"Instance Name: {0}\", instanceName)  \n        Console.WriteLine(\"---------------------------\")  \n        Return instanceName  \n    End Function  \n  \n    Private Sub WritePerformanceCounters()  \n        Console.WriteLine(\"---------------------------\")  \n        For Each p As PerformanceCounter In Me.PerfCounters  \n            Console.WriteLine(\"{0} = {1}\", p.CounterName, p.NextValue)  \n        Next  \n        Console.WriteLine(\"---------------------------\")  \n    End Sub  \n  \n    Private Shared Function GetIntegratedSecurityConnectionString() As String  \n        ' To avoid storing the connection string in your code,   \n        ' you can retrieve it from a configuration file.   \n        Return (\"Data Source=.\\SqlExpress;Integrated Security=True;\" &   \n          \"Initial Catalog=AdventureWorks\")  \n    End Function  \n  \n    Private Shared Function GetSqlConnectionString() As String  \n        ' To avoid storing the connection string in your code,   \n        ' you can retrieve it from a configuration file.   \n        Return (\"Data Source=.\\SqlExpress;User Id=LowPriv;Password=Data!05;\" &   \n          \"Initial Catalog=AdventureWorks\")  \n    End Function  \n  \n    Private Shared Function GetSqlConnectionStringDifferent() As String  \n        ' To avoid storing the connection string in your code,   \n        ' you can retrieve it from a configuration file.   \n        Return (\"Initial Catalog=AdventureWorks;Data Source=.\\SqlExpress;\" & _  \n          \"User Id=LowPriv;Password=Data!05;\")  \n    End Function  \nEnd Class  \n```  \n\n```csharp  \nusing System;  \nusing System.Data.SqlClient;  \nusing System.Diagnostics;  \nusing System.Runtime.InteropServices;  \n  \nclass Program  \n{  \n    PerformanceCounter[] PerfCounters = new PerformanceCounter[10];  \n    SqlConnection connection = new SqlConnection();  \n  \n    static void Main()  \n    {  \n        Program prog = new Program();  \n        // Open a connection and create the performance counters.  \n        prog.connection.ConnectionString =  \n           GetIntegratedSecurityConnectionString();  \n        prog.SetUpPerformanceCounters();  \n        Console.WriteLine(\"Available Performance Counters:\");  \n  \n        // Create the connections and display the results.  \n        prog.CreateConnections();  \n        Console.WriteLine(\"Press Enter to finish.\");  \n        Console.ReadLine();  \n    }  \n  \n    private void CreateConnections()  \n    {  \n        // List the Performance counters.  \n        WritePerformanceCounters();  \n  \n        // Create 4 connections and display counter information.  \n        SqlConnection connection1 = new SqlConnection(  \n              GetIntegratedSecurityConnectionString());  \n        connection1.Open();  \n        Console.WriteLine(\"Opened the 1st Connection:\");  \n        WritePerformanceCounters();  \n  \n        SqlConnection connection2 = new SqlConnection(  \n              GetSqlConnectionStringDifferent());  \n        connection2.Open();  \n        Console.WriteLine(\"Opened the 2nd Connection:\");  \n        WritePerformanceCounters();  \n  \n        SqlConnection connection3 = new SqlConnection(  \n              GetSqlConnectionString());  \n        connection3.Open();  \n        Console.WriteLine(\"Opened the 3rd Connection:\");  \n        WritePerformanceCounters();  \n  \n        SqlConnection connection4 = new SqlConnection(  \n              GetSqlConnectionString());  \n        connection4.Open();  \n        Console.WriteLine(\"Opened the 4th Connection:\");  \n        WritePerformanceCounters();  \n  \n        connection1.Close();  \n        Console.WriteLine(\"Closed the 1st Connection:\");  \n        WritePerformanceCounters();  \n  \n        connection2.Close();  \n        Console.WriteLine(\"Closed the 2nd Connection:\");  \n        WritePerformanceCounters();  \n  \n        connection3.Close();  \n        Console.WriteLine(\"Closed the 3rd Connection:\");  \n        WritePerformanceCounters();  \n  \n        connection4.Close();  \n        Console.WriteLine(\"Closed the 4th Connection:\");  \n        WritePerformanceCounters();  \n    }  \n  \n    private enum ADO_Net_Performance_Counters  \n    {  \n        NumberOfActiveConnectionPools,  \n        NumberOfReclaimedConnections,  \n        HardConnectsPerSecond,  \n        HardDisconnectsPerSecond,  \n        NumberOfActiveConnectionPoolGroups,  \n        NumberOfInactiveConnectionPoolGroups,  \n        NumberOfInactiveConnectionPools,  \n        NumberOfNonPooledConnections,  \n        NumberOfPooledConnections,  \n        NumberOfStasisConnections  \n        // The following performance counters are more expensive to track.  \n        // Enable ConnectionPoolPerformanceCounterDetail in your config file.  \n        //     SoftConnectsPerSecond  \n        //     SoftDisconnectsPerSecond  \n        //     NumberOfActiveConnections  \n        //     NumberOfFreeConnections  \n    }  \n  \n    private void SetUpPerformanceCounters()  \n    {  \n        connection.Close();  \n        this.PerfCounters = new PerformanceCounter[10];  \n        string instanceName = GetInstanceName();  \n        Type apc = typeof(ADO_Net_Performance_Counters);  \n        int i = 0;  \n        foreach (string s in Enum.GetNames(apc))  \n        {  \n            this.PerfCounters[i] = new PerformanceCounter();  \n            this.PerfCounters[i].CategoryName = \".NET Data Provider for SqlServer\";  \n            this.PerfCounters[i].CounterName = s;  \n            this.PerfCounters[i].InstanceName = instanceName;  \n            i++;  \n        }  \n    }  \n  \n    [DllImport(\"kernel32.dll\", SetLastError = true)]  \n    static extern int GetCurrentProcessId();  \n  \n    private string GetInstanceName()  \n    {  \n        //This works for Winforms apps.  \n        string instanceName =  \n            System.Reflection.Assembly.GetEntryAssembly().GetName().Name;  \n  \n        // Must replace special characters like (, ), #, /, \\\\  \n        string instanceName2 =  \n            AppDomain.CurrentDomain.FriendlyName.ToString().Replace('(', '[')  \n            .Replace(')', ']').Replace('#', '_').Replace('/', '_').Replace('\\\\', '_');  \n  \n        // For ASP.NET applications your instanceName will be your CurrentDomain's   \n        // FriendlyName. Replace the line above that sets the instanceName with this:  \n        // instanceName = AppDomain.CurrentDomain.FriendlyName.ToString().Replace('(','[')  \n        // .Replace(')',']').Replace('#','_').Replace('/','_').Replace('\\\\','_');  \n  \n        string pid = GetCurrentProcessId().ToString();  \n        instanceName = instanceName + \"[\" + pid + \"]\";  \n        Console.WriteLine(\"Instance Name: {0}\", instanceName);  \n        Console.WriteLine(\"---------------------------\");  \n        return instanceName;  \n    }  \n  \n    private void WritePerformanceCounters()  \n    {  \n        Console.WriteLine(\"---------------------------\");  \n        foreach (PerformanceCounter p in this.PerfCounters)  \n        {  \n            Console.WriteLine(\"{0} = {1}\", p.CounterName, p.NextValue());  \n        }  \n        Console.WriteLine(\"---------------------------\");  \n    }  \n  \n    private static string GetIntegratedSecurityConnectionString()  \n    {  \n        // To avoid storing the connection string in your code,  \n        // you can retrieve it from a configuration file.  \n        return @\"Data Source=.\\SqlExpress;Integrated Security=True;\" +  \n          \"Initial Catalog=AdventureWorks\";  \n    }  \n    private static string GetSqlConnectionString()  \n    {  \n        // To avoid storing the connection string in your code,  \n        // you can retrieve it from a configuration file.  \n        return @\"Data Source=.\\SqlExpress;User Id=LowPriv;Password=Data!05;\" +  \n          \"Initial Catalog=AdventureWorks\";  \n    }  \n  \n    private static string GetSqlConnectionStringDifferent()  \n    {  \n        // To avoid storing the connection string in your code,  \n        // you can retrieve it from a configuration file.  \n        return @\"Initial Catalog=AdventureWorks;Data Source=.\\SqlExpress;\" +  \n          \"User Id=LowPriv;Password=Data!05;\";  \n    }  \n}  \n```  \n\n## See also\n\n- [Connecting to a Data Source](../../../../docs/framework/data/adonet/connecting-to-a-data-source.md)\n- [OLE DB, ODBC, and Oracle Connection Pooling](../../../../docs/framework/data/adonet/ole-db-odbc-and-oracle-connection-pooling.md)\n- [Performance Counters for ASP.NET](https://docs.microsoft.com/previous-versions/aspnet/fxk122b4(v=vs.100))\n- [Runtime Profiling](../../../../docs/framework/debug-trace-profile/runtime-profiling.md)\n- [Introduction to Monitoring Performance Thresholds](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2008/bd20x32d(v=vs.90))\n- [ADO.NET Overview](ado-net-overview.md)\n","nodes":[{"pos":[4,149],"embed":true,"restype":"x-metadata","content":"title: \"Performance Counters in ADO.NET\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 0b121b71-78f8-4ae2-9aa1-0b2e15778e57","nodes":[{"content":"Performance Counters in ADO.NET","nodes":[{"pos":[0,31],"content":"Performance Counters in ADO.NET","nodes":[{"content":"Performance Counters in ADO.NET","pos":[0,31]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[156,187],"content":"Performance Counters in ADO.NET","linkify":"Performance Counters in ADO.NET","nodes":[{"content":"Performance Counters in ADO.NET","pos":[0,31]}]},{"content":"ADO.NET 2.0 introduced expanded support for performance counters that includes support for both <ph id=\"ph1\">&lt;xref:System.Data.SqlClient&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Data.OracleClient&gt;</ph>.","pos":[188,349],"source":"ADO.NET 2.0 introduced expanded support for performance counters that includes support for both <xref:System.Data.SqlClient> and <xref:System.Data.OracleClient>."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Data.SqlClient&gt;</ph> performance counters available in previous versions of ADO.NET have been deprecated and replaced with the new performance counters discussed in this topic.","pos":[350,538],"source":" The <xref:System.Data.SqlClient> performance counters available in previous versions of ADO.NET have been deprecated and replaced with the new performance counters discussed in this topic."},{"content":"You can use ADO.NET performance counters to monitor the status of your application and the connection resources that it uses.","pos":[539,664]},{"content":"Performance counters can be monitored by using Windows Performance Monitor or can be accessed programmatically using the <ph id=\"ph1\">&lt;xref:System.Diagnostics.PerformanceCounter&gt;</ph> class in the <ph id=\"ph2\">&lt;xref:System.Diagnostics&gt;</ph> namespace.","pos":[665,880],"source":" Performance counters can be monitored by using Windows Performance Monitor or can be accessed programmatically using the <xref:System.Diagnostics.PerformanceCounter> class in the <xref:System.Diagnostics> namespace."},{"pos":[889,919],"content":"Available Performance Counters","linkify":"Available Performance Counters","nodes":[{"content":"Available Performance Counters","pos":[0,30]}]},{"content":"Currently there are 14 different performance counters available for <ph id=\"ph1\">&lt;xref:System.Data.SqlClient&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Data.OracleClient&gt;</ph> as described in the following table.","pos":[923,1092],"source":"Currently there are 14 different performance counters available for <xref:System.Data.SqlClient> and <xref:System.Data.OracleClient> as described in the following table."},{"content":"Note that the names for the individual counters are not localized across regional versions of the Microsoft .NET Framework.","pos":[1093,1216]},{"content":"Performance counter","pos":[1223,1242]},{"content":"Description","pos":[1243,1254]},{"content":"The number of connections per second that are being made to a database server.","pos":[1331,1409]},{"content":"The number of disconnects per second that are being made to a database server.","pos":[1441,1519]},{"content":"The number of unique connection pool groups that are active.","pos":[1561,1621]},{"content":"This counter is controlled by the number of unique connection strings that are found in the AppDomain.","pos":[1622,1724]},{"content":"The total number of connection pools.","pos":[1761,1798]},{"content":"The number of active connections that are currently in use.","pos":[1831,1890]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  This performance counter is not enabled by default.","pos":[1891,1953],"source":"**Note:**  This performance counter is not enabled by default."},{"content":"To enable this performance counter, see <bpt id=\"p1\">[</bpt>Activating Off-By-Default Counters<ept id=\"p1\">](#ActivatingOffByDefault)</ept>.","pos":[1954,2056],"source":" To enable this performance counter, see [Activating Off-By-Default Counters](#ActivatingOffByDefault)."},{"content":"The number of connections available for use in the connection pools.","pos":[2087,2155]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  This performance counter is not enabled by default.","pos":[2156,2218],"source":"**Note:**  This performance counter is not enabled by default."},{"content":"To enable this performance counter, see <bpt id=\"p1\">[</bpt>Activating Off-By-Default Counters<ept id=\"p1\">](#ActivatingOffByDefault)</ept>.","pos":[2219,2321],"source":" To enable this performance counter, see [Activating Off-By-Default Counters](#ActivatingOffByDefault)."},{"content":"The number of unique connection pool groups that are marked for pruning.","pos":[2365,2437]},{"content":"This counter is controlled by the number of unique connection strings that are found in the AppDomain.","pos":[2438,2540]},{"content":"The number of inactive connection pools that have not had any recent activity and are waiting to be disposed.","pos":[2579,2688]},{"content":"The number of active connections that are not pooled.","pos":[2724,2777]},{"content":"The number of active connections that are being managed by the connection pooling infrastructure.","pos":[2810,2907]},{"content":"The number of connections that have been reclaimed through garbage collection where <ph id=\"ph1\">`Close`</ph> or <ph id=\"ph2\">`Dispose`</ph> was not called by the application.","pos":[2943,3082],"source":"The number of connections that have been reclaimed through garbage collection where `Close` or `Dispose` was not called by the application."},{"content":"Not explicitly closing or disposing connections hurts performance.","pos":[3083,3149]},{"content":"The number of connections currently awaiting completion of an action and which are therefore unavailable for use by your application.","pos":[3182,3315]},{"content":"The number of active connections being pulled from the connection pool.","pos":[3344,3415]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  This performance counter is not enabled by default.","pos":[3416,3478],"source":"**Note:**  This performance counter is not enabled by default."},{"content":"To enable this performance counter, see <bpt id=\"p1\">[</bpt>Activating Off-By-Default Counters<ept id=\"p1\">](#ActivatingOffByDefault)</ept>.","pos":[3479,3581],"source":" To enable this performance counter, see [Activating Off-By-Default Counters](#ActivatingOffByDefault)."},{"content":"The number of active connections that are being returned to the connection pool.","pos":[3613,3693]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  This performance counter is not enabled by default.","pos":[3694,3756],"source":"**Note:**  This performance counter is not enabled by default."},{"content":"To enable this performance counter, see <bpt id=\"p1\">[</bpt>Activating Off-By-Default Counters<ept id=\"p1\">](#ActivatingOffByDefault)</ept>.","pos":[3757,3859],"source":" To enable this performance counter, see [Activating Off-By-Default Counters](#ActivatingOffByDefault)."},{"pos":[3870,3913],"content":"Connection Pool Groups and Connection Pools","linkify":"Connection Pool Groups and Connection Pools","nodes":[{"content":"Connection Pool Groups and Connection Pools","pos":[0,43]}]},{"content":"When using Windows Authentication (integrated security), you must monitor both the <ph id=\"ph1\">`NumberOfActiveConnectionPoolGroups`</ph> and <ph id=\"ph2\">`NumberOfActiveConnectionPools`</ph> performance counters.","pos":[3917,4094],"source":"When using Windows Authentication (integrated security), you must monitor both the `NumberOfActiveConnectionPoolGroups` and `NumberOfActiveConnectionPools` performance counters."},{"content":"The reason is that connection pool groups map to unique connection strings.","pos":[4095,4170]},{"content":"When integrated security is used, connection pools map to connection strings and additionally create separate pools for individual Windows identities.","pos":[4171,4321]},{"content":"For example, if Fred and Julie, each within the same AppDomain, both use the connection string <ph id=\"ph1\">`\"Data Source=MySqlServer;Integrated Security=true\"`</ph>, a connection pool group is created for the connection string, and two additional pools are created, one for Fred and one for Julie.","pos":[4322,4602],"source":" For example, if Fred and Julie, each within the same AppDomain, both use the connection string `\"Data Source=MySqlServer;Integrated Security=true\"`, a connection pool group is created for the connection string, and two additional pools are created, one for Fred and one for Julie."},{"content":"If John and Martha use a connection string with an identical SQL Server login, <ph id=\"ph1\">`\"Data Source=MySqlServer;User Id=lowPrivUser;Password=Strong?Password\"`</ph>, then only a single pool is created for the <bpt id=\"p1\">**</bpt>lowPrivUser<ept id=\"p1\">**</ept> identity.","pos":[4603,4824],"source":" If John and Martha use a connection string with an identical SQL Server login, `\"Data Source=MySqlServer;User Id=lowPrivUser;Password=Strong?Password\"`, then only a single pool is created for the **lowPrivUser** identity."},{"pos":[4875,4909],"content":"Activating Off-By-Default Counters","linkify":"Activating Off-By-Default Counters","nodes":[{"content":"Activating Off-By-Default Counters","pos":[0,34]}]},{"content":"The performance counters <ph id=\"ph1\">`NumberOfFreeConnections`</ph>, <ph id=\"ph2\">`NumberOfActiveConnections`</ph>, <ph id=\"ph3\">`SoftDisconnectsPerSecond`</ph>, and <ph id=\"ph4\">`SoftConnectsPerSecond`</ph> are off by default.","pos":[4913,5069],"source":"The performance counters `NumberOfFreeConnections`, `NumberOfActiveConnections`, `SoftDisconnectsPerSecond`, and `SoftConnectsPerSecond` are off by default."},{"content":"Add the following information to the application's configuration file to enable them:","pos":[5070,5155]},{"pos":[5340,5377],"content":"Retrieving Performance Counter Values","linkify":"Retrieving Performance Counter Values","nodes":[{"content":"Retrieving Performance Counter Values","pos":[0,37]}]},{"content":"The following console application shows how to retrieve performance counter values in your application.","pos":[5381,5484]},{"content":"Connections must be open and active for information to be returned for all of the ADO.NET performance counters.","pos":[5485,5596]},{"pos":[5604,6172],"content":"[!NOTE]\n This example uses the sample **AdventureWorks** database included with SQL Server. The connection strings provided in the sample code assume that the database is installed and available on the local computer with an instance name of SqlExpress, and that you have created SQL Server logins that match those supplied in the connection strings. You may need to enable SQL Server logins if your server is configured using the default security settings which allow only Windows Authentication. Modify the connection strings as necessary to suit your environment.","leadings":["","> "],"nodes":[{"content":"This example uses the sample **AdventureWorks** database included with SQL Server. The connection strings provided in the sample code assume that the database is installed and available on the local computer with an instance name of SqlExpress, and that you have created SQL Server logins that match those supplied in the connection strings. You may need to enable SQL Server logins if your server is configured using the default security settings which allow only Windows Authentication. Modify the connection strings as necessary to suit your environment.","pos":[9,566],"nodes":[{"content":"This example uses the sample <bpt id=\"p1\">**</bpt>AdventureWorks<ept id=\"p1\">**</ept> database included with SQL Server.","pos":[0,82],"source":"This example uses the sample **AdventureWorks** database included with SQL Server."},{"content":"The connection strings provided in the sample code assume that the database is installed and available on the local computer with an instance name of SqlExpress, and that you have created SQL Server logins that match those supplied in the connection strings.","pos":[83,341]},{"content":"You may need to enable SQL Server logins if your server is configured using the default security settings which allow only Windows Authentication.","pos":[342,488]},{"content":"Modify the connection strings as necessary to suit your environment.","pos":[489,557]}]}]},{"pos":[6182,6189],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"pos":[19229,19237],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[19241,19341],"content":"<bpt id=\"p1\">[</bpt>Connecting to a Data Source<ept id=\"p1\">](../../../../docs/framework/data/adonet/connecting-to-a-data-source.md)</ept>","source":"[Connecting to a Data Source](../../../../docs/framework/data/adonet/connecting-to-a-data-source.md)"},{"pos":[19344,19474],"content":"<bpt id=\"p1\">[</bpt>OLE DB, ODBC, and Oracle Connection Pooling<ept id=\"p1\">](../../../../docs/framework/data/adonet/ole-db-odbc-and-oracle-connection-pooling.md)</ept>","source":"[OLE DB, ODBC, and Oracle Connection Pooling](../../../../docs/framework/data/adonet/ole-db-odbc-and-oracle-connection-pooling.md)"},{"pos":[19477,19583],"content":"<bpt id=\"p1\">[</bpt>Performance Counters for ASP.NET<ept id=\"p1\">](https://docs.microsoft.com/previous-versions/aspnet/fxk122b4(v=vs.100))</ept>","source":"[Performance Counters for ASP.NET](https://docs.microsoft.com/previous-versions/aspnet/fxk122b4(v=vs.100))"},{"pos":[19586,19674],"content":"<bpt id=\"p1\">[</bpt>Runtime Profiling<ept id=\"p1\">](../../../../docs/framework/debug-trace-profile/runtime-profiling.md)</ept>","source":"[Runtime Profiling](../../../../docs/framework/debug-trace-profile/runtime-profiling.md)"},{"pos":[19677,19824],"content":"<bpt id=\"p1\">[</bpt>Introduction to Monitoring Performance Thresholds<ept id=\"p1\">](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2008/bd20x32d(v=vs.90))</ept>","source":"[Introduction to Monitoring Performance Thresholds](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2008/bd20x32d(v=vs.90))"},{"pos":[19827,19866],"content":"<bpt id=\"p1\">[</bpt>ADO.NET Overview<ept id=\"p1\">](ado-net-overview.md)</ept>","source":"[ADO.NET Overview](ado-net-overview.md)"}]}