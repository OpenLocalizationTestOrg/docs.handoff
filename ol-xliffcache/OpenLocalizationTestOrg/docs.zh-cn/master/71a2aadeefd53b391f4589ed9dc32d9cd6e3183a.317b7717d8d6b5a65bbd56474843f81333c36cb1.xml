{"content":"---\ntitle: \"Removing the view state the designer adds to an XAML file - WF\"\nms.date: \"03/30/2017\"\nms.assetid: a801ce22-8699-483c-a392-7bb3834aae4f\n---\n# Removing the view state the designer adds to an XAML file\n\nThis sample demonstrates how to create a class that derives from <xref:System.Xaml.XamlWriter> and removes view state from a XAML file. [!INCLUDE[wfd1](../../../../includes/wfd1-md.md)] writes information into the XAML document, which is known as view state. View state refers to the information that is required at design time, such as layout positioning, that is not required at runtime. [!INCLUDE[wfd2](../../../../includes/wfd2-md.md)] inserts this information into the XAML document as it is edited. [!INCLUDE[wfd2](../../../../includes/wfd2-md.md)] writes the view state into the XAML file with the `mc:Ignorable` attribute, so this information is not loaded when the runtime loads the XAML file. This sample demonstrates how to create a class that removes that view state information while processing XAML nodes.\n\n## Discussion\n\nThis sample demonstrates how to create a custom writer.\n\nTo build a custom XAML writer, create a class that inherits from <xref:System.Xaml.XamlWriter>. As XAML writers are often nested, it is typical to keep track of an \"inner\" XAML writer. These \"inner’ writers can be thought of as the reference to the remaining stack of XAML writers, allowing you to have multiple entry points to do work and then delegate processing to the remainder of the stack.\n\nIn this sample, there are a few items of interest. One is the check to see whether the item being written is from a designer namespace. Note that this also strips out the use of other types from the designer namespace in a workflow.\n\n```csharp\nstatic Boolean IsDesignerAttachedProperty(XamlMember xamlMember)\n{\n    return xamlMember.IsAttachable &&\n        xamlMember.PreferredXamlNamespace.Equals(c_sapNamespaceURI, StringComparison.OrdinalIgnoreCase);\n}\n\nconst String c_sapNamespaceURI = \"http://schemas.microsoft.com/netfx/2009/xaml/activities/presentation\";\n\n// The next item of interest is the constructor, where the utilization of the inner XAML writer is seen.\npublic ViewStateCleaningWriter(XamlWriter innerWriter)\n{\n    this.InnerWriter = innerWriter;\n    this.MemberStack = new Stack<XamlMember>();\n}\n\nXamlWriter InnerWriter {get; set; }\nStack<XamlMember> MemberStack {get; set; }\n```\n\nThis also creates a stack of XAML members that are used while traversing the node stream. The remaining work of this sample is largely contained in the `WriteStartMember` method.\n\n```csharp\npublic override void WriteStartMember(XamlMember xamlMember)\n{\n    MemberStack.Push(xamlMember);\n\n    if (IsDesignerAttachedProperty(xamlMember))\n    {\n        m_attachedPropertyDepth++;\n    }\n\n    if (m_attachedPropertyDepth > 0)\n    {\n        return;\n    }\n\n    InnerWriter.WriteStartMember(xamlMember);\n}\n```\n\nSubsequent methods then check to see whether they are still contained in a view state container, and if so, return, and do not pass the node down the writer stack.\n\n```csharp\npublic override void WriteValue(Object value)\n{\n    if (m_attachedPropertyDepth > 0)\n    {\n        return;\n    }\n\n    InnerWriter.WriteValue(value);\n}\n```\n\nTo use a custom XAML writer, you must chain it together in a stack of XAML writers. The following code shows how this can be used.\n\n```csharp\nXmlWriterSettings writerSettings = new XmlWriterSettings {  Indent = true };\nXmlWriter xmlWriter = XmlWriter.Create(File.OpenWrite(args[1]), writerSettings);\nXamlXmlWriter xamlWriter = new XamlXmlWriter(xmlWriter, new XamlSchemaContext());\nXamlServices.Save(new ViewStateCleaningWriter(ActivityXamlServices.CreateBuilderWriter(xamlWriter)), ab);\n```\n\n## To use this sample\n\n1. Using Visual Studio 2010, open the ViewStateCleaningWriter.sln solution file.\n\n2. Open a command prompt and navigate to the directory where the ViewStageCleaningWriter.exe is built.\n\n3. Run ViewStateCleaningWriter.exe on the Workflow1.xaml file.\n\n   The syntax for the executable is shown in the following example.\n\n   ```console\n   ViewStateCleaningWriter.exe [input file] [output file]\n   ```\n\n   This outputs a XAML file to \\[outfile], which has all its view state information removed.\n\n> [!NOTE]\n> For a <xref:System.Activities.Statements.Sequence> workflow, a number of virtualization hints are removed. This causes the designer to recalculate layout the next time it is loaded. When you use this sample for a <xref:System.Activities.Statements.Flowchart>, all positioning and line routing information are removed and on subsequent loading into the designer, all activities are stacked on the left side of the screen.\n\n## To create a sample XAML file for use with this sample\n\n1. Open Visual Studio 2010.\n\n2. Create a new Workflow Console Application.\n\n3. Drag and drop a few activities onto the canvas\n\n4. Save the workflow XAML file.\n\n5. Inspect the XAML file to see the view state attached properties.\n\n> [!IMPORTANT]\n> The samples may already be installed on your machine. Check for the following (default) directory before continuing.\n>\n> `<InstallDrive>:\\WF_WCF_Samples`\n>\n> If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.\n>\n> `<InstallDrive>:\\WF_WCF_Samples\\WF\\Basic\\Designer\\ViewStateCleaningWriter`","nodes":[{"pos":[4,146],"embed":true,"restype":"x-metadata","content":"title: \"Removing the view state the designer adds to an XAML file - WF\"\nms.date: \"03/30/2017\"\nms.assetid: a801ce22-8699-483c-a392-7bb3834aae4f","nodes":[{"content":"Removing the view state the designer adds to an XAML file - WF","nodes":[{"pos":[0,62],"content":"Removing the view state the designer adds to an XAML file - WF","nodes":[{"content":"Removing the view state the designer adds to an XAML file - WF","pos":[0,62]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[153,210],"content":"Removing the view state the designer adds to an XAML file","linkify":"Removing the view state the designer adds to an XAML file","nodes":[{"content":"Removing the view state the designer adds to an XAML file","pos":[0,57]}]},{"content":"This sample demonstrates how to create a class that derives from <ph id=\"ph1\">&lt;xref:System.Xaml.XamlWriter&gt;</ph> and removes view state from a XAML file.","pos":[212,347],"source":"This sample demonstrates how to create a class that derives from <xref:System.Xaml.XamlWriter> and removes view state from a XAML file."},{"content":"<ph id=\"ph1\">[!INCLUDE[wfd1](../../../../includes/wfd1-md.md)]</ph> writes information into the XAML document, which is known as view state.","pos":[348,470],"source":"[!INCLUDE[wfd1](../../../../includes/wfd1-md.md)] writes information into the XAML document, which is known as view state."},{"content":"View state refers to the information that is required at design time, such as layout positioning, that is not required at runtime.","pos":[471,601]},{"content":"<ph id=\"ph1\">[!INCLUDE[wfd2](../../../../includes/wfd2-md.md)]</ph> inserts this information into the XAML document as it is edited.","pos":[602,716],"source":"[!INCLUDE[wfd2](../../../../includes/wfd2-md.md)] inserts this information into the XAML document as it is edited."},{"content":"<ph id=\"ph1\">[!INCLUDE[wfd2](../../../../includes/wfd2-md.md)]</ph> writes the view state into the XAML file with the <ph id=\"ph2\">`mc:Ignorable`</ph> attribute, so this information is not loaded when the runtime loads the XAML file.","pos":[717,914],"source":"[!INCLUDE[wfd2](../../../../includes/wfd2-md.md)] writes the view state into the XAML file with the `mc:Ignorable` attribute, so this information is not loaded when the runtime loads the XAML file."},{"content":"This sample demonstrates how to create a class that removes that view state information while processing XAML nodes.","pos":[915,1031]},{"pos":[1036,1046],"content":"Discussion","linkify":"Discussion","nodes":[{"content":"Discussion","pos":[0,10]}]},{"content":"This sample demonstrates how to create a custom writer.","pos":[1048,1103]},{"content":"To build a custom XAML writer, create a class that inherits from <ph id=\"ph1\">&lt;xref:System.Xaml.XamlWriter&gt;</ph>.","pos":[1105,1200],"source":"To build a custom XAML writer, create a class that inherits from <xref:System.Xaml.XamlWriter>."},{"content":"As XAML writers are often nested, it is typical to keep track of an \"inner\" XAML writer.","pos":[1201,1289]},{"content":"These \"inner’ writers can be thought of as the reference to the remaining stack of XAML writers, allowing you to have multiple entry points to do work and then delegate processing to the remainder of the stack.","pos":[1290,1500]},{"content":"In this sample, there are a few items of interest.","pos":[1502,1552]},{"content":"One is the check to see whether the item being written is from a designer namespace.","pos":[1553,1637]},{"content":"Note that this also strips out the use of other types from the designer namespace in a workflow.","pos":[1638,1734]},{"content":"This also creates a stack of XAML members that are used while traversing the node stream.","pos":[2398,2487]},{"content":"The remaining work of this sample is largely contained in the <ph id=\"ph1\">`WriteStartMember`</ph> method.","pos":[2488,2576],"source":" The remaining work of this sample is largely contained in the `WriteStartMember` method."},{"content":"Subsequent methods then check to see whether they are still contained in a view state container, and if so, return, and do not pass the node down the writer stack.","pos":[2901,3064]},{"content":"To use a custom XAML writer, you must chain it together in a stack of XAML writers.","pos":[3232,3315]},{"content":"The following code shows how this can be used.","pos":[3316,3362]},{"pos":[3728,3746],"content":"To use this sample","linkify":"To use this sample","nodes":[{"content":"To use this sample","pos":[0,18]}]},{"content":"Using Visual Studio 2010, open the ViewStateCleaningWriter.sln solution file.","pos":[3751,3828]},{"content":"Open a command prompt and navigate to the directory where the ViewStageCleaningWriter.exe is built.","pos":[3833,3932]},{"content":"Run ViewStateCleaningWriter.exe on the Workflow1.xaml file.","pos":[3937,3996]},{"content":"The syntax for the executable is shown in the following example.","pos":[4001,4065]},{"content":"This outputs a XAML file to <ph id=\"ph1\">\\[</ph>outfile], which has all its view state information removed.","pos":[4150,4239],"source":"This outputs a XAML file to \\[outfile], which has all its view state information removed."},{"pos":[4243,4673],"content":"[!NOTE]\nFor a <xref:System.Activities.Statements.Sequence> workflow, a number of virtualization hints are removed. This causes the designer to recalculate layout the next time it is loaded. When you use this sample for a <xref:System.Activities.Statements.Flowchart>, all positioning and line routing information are removed and on subsequent loading into the designer, all activities are stacked on the left side of the screen.","leadings":["","> "],"nodes":[{"content":"For a <xref:System.Activities.Statements.Sequence> workflow, a number of virtualization hints are removed. This causes the designer to recalculate layout the next time it is loaded. When you use this sample for a <xref:System.Activities.Statements.Flowchart>, all positioning and line routing information are removed and on subsequent loading into the designer, all activities are stacked on the left side of the screen.","pos":[8,428],"nodes":[{"content":"For a <ph id=\"ph1\">&lt;xref:System.Activities.Statements.Sequence&gt;</ph> workflow, a number of virtualization hints are removed.","pos":[0,106],"source":"For a <xref:System.Activities.Statements.Sequence> workflow, a number of virtualization hints are removed."},{"content":"This causes the designer to recalculate layout the next time it is loaded.","pos":[107,181]},{"content":"When you use this sample for a <ph id=\"ph1\">&lt;xref:System.Activities.Statements.Flowchart&gt;</ph>, all positioning and line routing information are removed and on subsequent loading into the designer, all activities are stacked on the left side of the screen.","pos":[182,420],"source":" When you use this sample for a <xref:System.Activities.Statements.Flowchart>, all positioning and line routing information are removed and on subsequent loading into the designer, all activities are stacked on the left side of the screen."}]}]},{"pos":[4678,4731],"content":"To create a sample XAML file for use with this sample","linkify":"To create a sample XAML file for use with this sample","nodes":[{"content":"To create a sample XAML file for use with this sample","pos":[0,53]}]},{"content":"Open Visual Studio 2010.","pos":[4736,4760]},{"content":"Create a new Workflow Console Application.","pos":[4765,4807]},{"content":"Drag and drop a few activities onto the canvas","pos":[4812,4858]},{"content":"Save the workflow XAML file.","pos":[4863,4891]},{"content":"Inspect the XAML file to see the view state attached properties.","pos":[4896,4960]},{"pos":[4964,5095],"content":"[!IMPORTANT]\nThe samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,129],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[0,53]},{"content":"Check for the following (default) directory before continuing.","pos":[54,116]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[5137,5447],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[5448,5498]}]}