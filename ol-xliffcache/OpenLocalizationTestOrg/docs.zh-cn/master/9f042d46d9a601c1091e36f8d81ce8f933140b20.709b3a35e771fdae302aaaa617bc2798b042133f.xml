{"content":"---\ntitle: \"Query Plan Caching (Entity SQL)\"\nms.date: \"03/30/2017\"\nms.assetid: 90b0c685-5ef2-461b-98b4-c3c0a2b253c7\n---\n# Query Plan Caching (Entity SQL)\nWhenever an attempt to execute a query is made, the query pipeline looks up its query plan cache to see whether the exact query is already compiled and available. If so, it reuses the cached plan rather than building a new one. If a match is not found in the query plan cache, the query is compiled and cached. A query is identified by its [!INCLUDE[esql](../../../../../../includes/esql-md.md)] text and parameter collection (names and types). All text comparisons are case-sensitive.  \n  \n## Configuration  \n Query plan caching is configurable through the <xref:System.Data.EntityClient.EntityCommand>.  \n  \n To enable or disable query plan caching through <xref:System.Data.EntityClient.EntityCommand.EnablePlanCaching%2A?displayProperty=nameWithType>, set this property to `true` or `false`. Disabling plan caching for individual dynamic queries that are unlikely to be used more then once improves performance.  \n  \n You can enable query plan caching through <xref:System.Data.Objects.ObjectQuery.EnablePlanCaching%2A>.  \n  \n## Recommended Practice  \n Dynamic queries should be avoided, in general. The following dynamic query example is vulnerable to SQL injection attacks, because it takes user input directly without any validation.  \n  \n `\"SELECT sp.SalesYTD FROM AdventureWorksEntities.SalesPerson as sp WHERE sp.EmployeeID = \" + employeeTextBox.Text;`  \n  \n If you do use dynamically generated queries, consider disabling query plan caching to avoid unnecessary memory consumption for cache entries that are unlikely to be reused.  \n  \n Query plan caching on static queries and parameterized queries can provide performance benefits. The following is an example of a static query:  \n  \n```  \n\"SELECT sp.SalesYTD FROM AdventureWorksEntities.SalesPerson as sp\";  \n```  \n  \n For queries to be matched properly by the query plan cache, they should comply with the following requirements:  \n  \n-   Query text should be a constant pattern, preferably a constant string or a resource.  \n  \n-   <xref:System.Data.EntityClient.EntityParameter> or <xref:System.Data.Objects.ObjectParameter> should be used wherever a user-supplied value must be passed.  \n  \n You should avoid the following query patterns, which unnecessarily consume slots in the query plan cache:  \n  \n-   Changes to letter case in the text.  \n  \n-   Changes to white space.  \n  \n-   Changes to literal values.  \n  \n-   Changes to text inside comments.  \n  \n## See also\n\n- [Entity SQL Overview](../../../../../../docs/framework/data/adonet/ef/language-reference/entity-sql-overview.md)\n","nodes":[{"pos":[4,115],"embed":true,"restype":"x-metadata","content":"title: \"Query Plan Caching (Entity SQL)\"\nms.date: \"03/30/2017\"\nms.assetid: 90b0c685-5ef2-461b-98b4-c3c0a2b253c7","nodes":[{"content":"Query Plan Caching (Entity SQL)","nodes":[{"pos":[0,31],"content":"Query Plan Caching (Entity SQL)","nodes":[{"content":"Query Plan Caching (Entity SQL)","pos":[0,31]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[122,153],"content":"Query Plan Caching (Entity SQL)","linkify":"Query Plan Caching (Entity SQL)","nodes":[{"content":"Query Plan Caching (Entity SQL)","pos":[0,31]}]},{"content":"Whenever an attempt to execute a query is made, the query pipeline looks up its query plan cache to see whether the exact query is already compiled and available.","pos":[154,316]},{"content":"If so, it reuses the cached plan rather than building a new one.","pos":[317,381]},{"content":"If a match is not found in the query plan cache, the query is compiled and cached.","pos":[382,464]},{"content":"A query is identified by its <ph id=\"ph1\">[!INCLUDE[esql](../../../../../../includes/esql-md.md)]</ph> text and parameter collection (names and types).","pos":[465,598],"source":" A query is identified by its [!INCLUDE[esql](../../../../../../includes/esql-md.md)] text and parameter collection (names and types)."},{"content":"All text comparisons are case-sensitive.","pos":[599,639]},{"pos":[648,661],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"pos":[665,758],"content":"Query plan caching is configurable through the <ph id=\"ph1\">&lt;xref:System.Data.EntityClient.EntityCommand&gt;</ph>.","source":"Query plan caching is configurable through the <xref:System.Data.EntityClient.EntityCommand>."},{"content":"To enable or disable query plan caching through <ph id=\"ph1\">&lt;xref:System.Data.EntityClient.EntityCommand.EnablePlanCaching%2A?displayProperty=nameWithType&gt;</ph>, set this property to <ph id=\"ph2\">`true`</ph> or <ph id=\"ph3\">`false`</ph>.","pos":[765,949],"source":"To enable or disable query plan caching through <xref:System.Data.EntityClient.EntityCommand.EnablePlanCaching%2A?displayProperty=nameWithType>, set this property to `true` or `false`."},{"content":"Disabling plan caching for individual dynamic queries that are unlikely to be used more then once improves performance.","pos":[950,1069]},{"pos":[1076,1178],"content":"You can enable query plan caching through <ph id=\"ph1\">&lt;xref:System.Data.Objects.ObjectQuery.EnablePlanCaching%2A&gt;</ph>.","source":"You can enable query plan caching through <xref:System.Data.Objects.ObjectQuery.EnablePlanCaching%2A>."},{"pos":[1187,1207],"content":"Recommended Practice","linkify":"Recommended Practice","nodes":[{"content":"Recommended Practice","pos":[0,20]}]},{"content":"Dynamic queries should be avoided, in general.","pos":[1211,1257]},{"content":"The following dynamic query example is vulnerable to SQL injection attacks, because it takes user input directly without any validation.","pos":[1258,1394]},{"content":"If you do use dynamically generated queries, consider disabling query plan caching to avoid unnecessary memory consumption for cache entries that are unlikely to be reused.","pos":[1523,1695]},{"content":"Query plan caching on static queries and parameterized queries can provide performance benefits.","pos":[1702,1798]},{"content":"The following is an example of a static query:","pos":[1799,1845]},{"content":"For queries to be matched properly by the query plan cache, they should comply with the following requirements:","pos":[1937,2048]},{"content":"Query text should be a constant pattern, preferably a constant string or a resource.","pos":[2058,2142]},{"pos":[2152,2307],"content":"<ph id=\"ph1\">&lt;xref:System.Data.EntityClient.EntityParameter&gt;</ph> or <ph id=\"ph2\">&lt;xref:System.Data.Objects.ObjectParameter&gt;</ph> should be used wherever a user-supplied value must be passed.","source":"<xref:System.Data.EntityClient.EntityParameter> or <xref:System.Data.Objects.ObjectParameter> should be used wherever a user-supplied value must be passed."},{"content":"You should avoid the following query patterns, which unnecessarily consume slots in the query plan cache:","pos":[2314,2419]},{"content":"Changes to letter case in the text.","pos":[2429,2464]},{"content":"Changes to white space.","pos":[2474,2497]},{"content":"Changes to literal values.","pos":[2507,2533]},{"content":"Changes to text inside comments.","pos":[2543,2575]},{"pos":[2584,2592],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[2596,2708],"content":"<bpt id=\"p1\">[</bpt>Entity SQL Overview<ept id=\"p1\">](../../../../../../docs/framework/data/adonet/ef/language-reference/entity-sql-overview.md)</ept>","source":"[Entity SQL Overview](../../../../../../docs/framework/data/adonet/ef/language-reference/entity-sql-overview.md)"}]}