{"content":"---\ntitle: \"WS Transaction Flow | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\n  - \"CSharp\"\nhelpviewer_keywords: \n  - \"Transactions\"\nms.assetid: f8eecbcf-990a-4dbb-b29b-c3f9e3b396bd\ncaps.latest.revision: 43\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# WS Transaction Flow\nThis sample demonstrates the use of a client-coordinated transaction and the client and server options for transaction flow using either the WS-Atomic Transaction or OleTransactions protocol. This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) that implements a calculator service but the operations are attributed to demonstrate the use of the `TransactionFlowAttribute` with the **TransactionFlowOption** enumeration to determine to what degree transaction flow is enabled. Within the scope of the flowed transaction, a log of the requested operations is written to a database and persists until the client coordinated transaction has completed - if the client transaction does not complete, the Web service transaction ensures that the appropriate updates to the database are not committed.  \n  \n> [!NOTE]\n>  The setup procedure and build instructions for this sample are located at the end of this topic.  \n  \n After initiating a connection to the service and a transaction, the client accesses several service operations. The contract for the service is defined as follows with each of the operations demonstrating a different setting for the `TransactionFlowOption`.  \n  \n```  \n[ServiceContract(Namespace = \"http://Microsoft.ServiceModel.Samples\")]  \npublic interface ICalculator  \n{  \n    [OperationContract]  \n    [TransactionFlow(TransactionFlowOption.Mandatory)]  \n    double Add(double n1, double n2);  \n    [OperationContract]  \n    [TransactionFlow(TransactionFlowOption.Allowed)]  \n    double Subtract(double n1, double n2);  \n    [OperationContract]  \n    [TransactionFlow(TransactionFlowOption.NotAllowed)]  \n    double Multiply(double n1, double n2);  \n    [OperationContract]  \n    double Divide(double n1, double n2);   \n}  \n  \n```  \n  \n This defines the operations in the order they are to be processed:  \n  \n-   An `Add` operation request must include a flowed transaction.  \n  \n-   A `Subtract` operation request may include a flowed transaction.  \n  \n-   A `Multiply` operation request must not include a flowed transaction through the explicit NotAllowed setting.  \n  \n-   A `Divide` operation request must not include a flowed transaction through the omission of a `TransactionFlow` attribute.  \n  \n To enable transaction flow, bindings with the [\\<transactionFlow>](../../../../docs/framework/configure-apps/file-schema/wcf/transactionflow.md) property enabled must be used in addition to the appropriate operation attributes. In this sample, the service's configuration exposes a TCP endpoint and an HTTP endpoint in addition to a Metadata Exchange endpoint. The TCP endpoint and the HTTP endpoint use the following bindings, both of which have the [\\<transactionFlow>](../../../../docs/framework/configure-apps/file-schema/wcf/transactionflow.md) property enabled.  \n  \n```  \n<bindings>  \n  <netTcpBinding>  \n    <binding name=\"transactionalOleTransactionsTcpBinding\"  \n             transactionFlow=\"true\"  \n             transactionProtocol=\"OleTransactions\"/>  \n  </netTcpBinding>  \n  <wsHttpBinding>  \n    <binding name=\"transactionalWsatHttpBinding\"  \n             transactionFlow=\"true\" />  \n  </wsHttpBinding>  \n</bindings>  \n```  \n  \n> [!NOTE]\n>  The system-provided netTcpBinding allows specification of the transactionProtocol whereas the system-provided wsHttpBinding uses only the more interoperable WSAtomicTransactionOctober2004 protocol. The OleTransactions protocol is only available for use by [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] clients.  \n  \n For the class that implements the `ICalculator` interface, all of the methods are attributed with <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> property set to `true`. This setting declares that all actions taken within the method occur within the scope of a transaction. In this case, the actions taken include recording to the log database. If the operation request includes a flowed transaction then the actions occur within the scope of the incoming transaction or a new transaction scope is automatically generated.  \n  \n> [!NOTE]\n>  The <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> property defines behavior local to the service method implementations and does not define the client's ability to or requirement for flowing a transaction.  \n  \n```  \n// Service class that implements the service contract.  \n[ServiceBehavior(TransactionIsolationLevel = System.Transactions.IsolationLevel.Serializable)]  \npublic class CalculatorService : ICalculator  \n{  \n    [OperationBehavior(TransactionScopeRequired = true)]  \n    public double Add(double n1, double n2)  \n    {  \n        RecordToLog(String.Format(CultureInfo.CurrentCulture, \"Adding {0} to {1}\", n1, n2));  \n        return n1 + n2;  \n    }  \n  \n    [OperationBehavior(TransactionScopeRequired = true)]  \n    public double Subtract(double n1, double n2)  \n    {  \n        RecordToLog(String.Format(CultureInfo.CurrentCulture, \"Subtracting {0} from {1}\", n2, n1));  \n        return n1 - n2;  \n    }  \n  \n    [OperationBehavior(TransactionScopeRequired = true)]  \n    public double Multiply(double n1, double n2)  \n    {  \n        RecordToLog(String.Format(CultureInfo.CurrentCulture, \"Multiplying {0} by {1}\", n1, n2));  \n        return n1 * n2;  \n    }  \n  \n    [OperationBehavior(TransactionScopeRequired = true)]  \n    public double Divide(double n1, double n2)  \n    {  \n        RecordToLog(String.Format(CultureInfo.CurrentCulture, \"Dividing {0} by {1}\", n1, n2));  \n        return n1 / n2;  \n    }  \n  \n    // Logging method omitted for brevity  \n}  \n```  \n  \n On the client, the service's `TransactionFlowOption` settings on the operations are reflected in the client's generated definition of the `ICalculator` interface. Also, the service's `transactionFlow` property settings are reflected in the client's application configuration. The client can select the transport and protocol by selecting the appropriate `endpointConfigurationName`.  \n  \n```  \n// Create a client using either wsat or oletx endpoint configurations  \nCalculatorClient client = new CalculatorClient(\"WSAtomicTransaction_endpoint\");  \n// CalculatorClient client = new CalculatorClient(\"OleTransactions_endpoint\");  \n  \n```  \n  \n> [!NOTE]\n>  The observed behavior of this sample is the same no matter which protocol or transport is chosen.  \n  \n Having initiated the connection to the service, the client creates a new `TransactionScope` around the calls to the service operations.  \n  \n```  \n// Start a transaction scope  \nusing (TransactionScope tx =  \n            new TransactionScope(TransactionScopeOption.RequiresNew))  \n{  \n    Console.WriteLine(\"Starting transaction\");  \n  \n    // Call the Add service operation  \n    //  - generatedClient will flow the required active transaction  \n    double value1 = 100.00D;  \n    double value2 = 15.99D;  \n    double result = client.Add(value1, value2);  \n    Console.WriteLine(\"  Add({0},{1}) = {2}\", value1, value2, result);  \n  \n    // Call the Subtract service operation  \n    //  - generatedClient will flow the allowed active transaction  \n    value1 = 145.00D;  \n    value2 = 76.54D;  \n    result = client.Subtract(value1, value2);  \n    Console.WriteLine(\"  Subtract({0},{1}) = {2}\", value1, value2, result);  \n  \n    // Start a transaction scope that suppresses the current transaction  \n    using (TransactionScope txSuppress =  \n                new TransactionScope(TransactionScopeOption.Suppress))  \n    {  \n        // Call the Subtract service operation  \n        //  - the active transaction is suppressed from the generatedClient  \n        //    and no transaction will flow  \n        value1 = 21.05D;  \n        value2 = 42.16D;  \n        result = client.Subtract(value1, value2);  \n        Console.WriteLine(\"  Subtract({0},{1}) = {2}\", value1, value2, result);  \n  \n        // Complete the suppressed scope  \n        txSuppress.Complete();  \n    }  \n  \n    // Call the Multiply service operation  \n    // - generatedClient will not flow the active transaction  \n    value1 = 9.00D;  \n    value2 = 81.25D;  \n    result = client.Multiply(value1, value2);  \n    Console.WriteLine(\"  Multiply({0},{1}) = {2}\", value1, value2, result);  \n  \n    // Call the Divide service operation.  \n    // - generatedClient will not flow the active transaction  \n    value1 = 22.00D;  \n    value2 = 7.00D;  \n    result = client.Divide(value1, value2);  \n    Console.WriteLine(\"  Divide({0},{1}) = {2}\", value1, value2, result);  \n  \n    // Complete the transaction scope  \n    Console.WriteLine(\"  Completing transaction\");  \n    tx.Complete();  \n}  \n  \nConsole.WriteLine(\"Transaction committed\");  \n  \n```  \n  \n The calls to the operations are as follows:  \n  \n-   The `Add` request flows the required transaction to the service and the service's actions occur within the scope of the client's transaction.  \n  \n-   The first `Subtract` request also flows the allowed transaction to the service and again the service's actions occur within the scope of the client's transaction.  \n  \n-   The second `Subtract` request is performed within a new transaction scope declared with the `TransactionScopeOption.Suppress` option. This suppresses the client's initial outer transaction and the request does not flow a transaction to the service. This approach allows a client to explicitly opt-out of and protect against flowing a transaction to a service when that is not required. The service's actions occur within the scope of a new and unconnected transaction.  \n  \n-   The `Multiply` request does not flow a transaction to the service because the client's generated definition of the `ICalculator` interface includes a <xref:System.ServiceModel.TransactionFlowAttribute> set to <xref:System.ServiceModel.TransactionFlowOption>`NotAllowed`.  \n  \n-   The `Divide` request does not flow a transaction to the service because again the client's generated definition of the `ICalculator` interface does not include a `TransactionFlowAttribute`. The service's actions again occur within the scope of another new and unconnected transaction.  \n  \n When you run the sample, the operation requests and responses are displayed in the client console window. Press ENTER in the client window to shut down the client.  \n  \n```  \nStarting transaction  \n  Add(100,15.99) = 115.99  \n  Subtract(145,76.54) = 68.46  \n  Subtract(21.05,42.16) = -21.11  \n  Multiply(9,81.25) = 731.25  \n  Divide(22,7) = 3.14285714285714  \n  Completing transaction  \nTransaction committed  \nPress <ENTER> to terminate client.  \n```  \n  \n The logging of the service operation requests are displayed in the service's console window. Press ENTER in the client window to shut down the client.  \n  \n```  \nPress <ENTER> to terminate the service.  \n  Writing row to database: Adding 100 to 15.99  \n  Writing row to database: Subtracting 76.54 from 145  \n  Writing row to database: Subtracting 42.16 from 21.05  \n  Writing row to database: Multiplying 9 by 81.25  \n  Writing row to database: Dividing 22 by 7  \n```  \n  \n After a successful execution, the client's transaction scope completes and all actions taken within that scope are committed. Specifically, the noted 5 records are persisted in the service's database. The first 2 of these have occurred within the scope of the client's transaction.  \n  \n If an exception occurred anywhere within the client's `TransactionScope` then the transaction cannot complete. This causes the records logged within that scope to not be committed to the database. This effect can be observed by repeating the sample run after commenting out the call to complete the outer `TransactionScope`. On such a run, only the last 3 actions (from the second `Subtract`, the `Multiply` and the `Divide` requests) are logged because the client transaction did not flow to those.  \n  \n### To set up, build, and run the sample  \n  \n1.  To build the C# or Visual Basic .NET version of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)  \n  \n2.  Ensure that you have installed SQL Server Express Edition or SQL Server, and that the connection string has been correctly set in the service’s application configuration file. To run the sample without using a database, set the `usingSql` value in the service’s application configuration file to `false`  \n  \n3.  To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).  \n  \n    > [!NOTE]\n    >  For cross-machine configuration, enable the Distributed Transaction Coordinator using the instructions below, and use the WsatConfig.exe tool from the Windows SDK to enable WCF Transactions network support. See [Configuring WS-Atomic Transaction Support](http://go.microsoft.com/fwlink/?LinkId=190370) for information on setting up WsatConfig.exe.  \n  \n Whether you run the sample on the same computer or on different computers, you must configure the Microsoft Distributed Transaction Coordinator (MSDTC) to enable network transaction flow and use the WsatConfig.exe tool to enable [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] transactions network support.  \n  \n### To configure the Microsoft Distributed Transaction Coordinator (MSDTC) to support running the sample  \n  \n1.  On a service machine running Windows Server 2003 or Windows XP, configure MSDTC to allow incoming network transactions by following these instructions.  \n  \n    1.  From the **Start** menu, navigate to **Control Panel**, then **Administrative Tools**, and then **Component Services**.  \n  \n    2.  Expand **Component Services**. Open the **Computers** folder.  \n  \n    3.  Right-click **My Computer** and select **Properties**.  \n  \n    4.  On the **MSDTC** tab, click **Security Configuration**.  \n  \n    5.  Check **Network DTC Access** and **Allow Inbound**.  \n  \n    6.  Click **OK**, then click **Yes** to restart the MSDTC service.  \n  \n    7.  Click **OK** to close the dialog box.  \n  \n2.  On a service machine running Windows Server 2008 or Windows Vista, configure MSDTC to allow incoming network transactions by following these instructions.  \n  \n    1.  From the **Start** menu, navigate to **Control Panel**, then **Administrative Tools**, and then **Component Services**.  \n  \n    2.  Expand **Component Services**. Open the **Computers** folder. Select **Distributed Transaction Coordinator**.  \n  \n    3.  Right-click **DTC Coordinator** and select **Properties**.  \n  \n    4.  On the **Security** tab, check **Network DTC Access** and **Allow Inbound**.  \n  \n    5.  Click **OK**, then click **Yes** to restart the MSDTC service.  \n  \n    6.  Click **OK** to close the dialog box.  \n  \n3.  On the client machine, configure MSDTC to allow outgoing network transactions:  \n  \n    1.  From the **Start** menu, navigate to `Control Panel`, then **Administrative Tools**, and then **Component Services**.  \n  \n    2.  Right-click **My Computer** and select **Properties**.  \n  \n    3.  On the **MSDTC** tab, click **Security Configuration**.  \n  \n    4.  Check **Network DTC Access** and **Allow Outbound**.  \n  \n    5.  Click **OK**, then click **Yes** to restart the MSDTC service.  \n  \n    6.  Click **OK** to close the dialog box.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Binding\\WS\\TransactionFlow`","nodes":[{"pos":[12,48],"content":"WS Transaction Flow | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"WS Transaction Flow | Microsoft Docs","pos":[0,36]}]},{"pos":[422,441],"content":"WS Transaction Flow","linkify":"WS Transaction Flow","nodes":[{"content":"WS Transaction Flow","pos":[0,19]}]},{"content":"This sample demonstrates the use of a client-coordinated transaction and the client and server options for transaction flow using either the WS-Atomic Transaction or OleTransactions protocol.","pos":[442,633]},{"content":"This sample is based on the <bpt id=\"p1\">[</bpt>Getting Started<ept id=\"p1\">](../../../../docs/framework/wcf/samples/getting-started-sample.md)</ept> that implements a calculator service but the operations are attributed to demonstrate the use of the <ph id=\"ph1\">`TransactionFlowAttribute`</ph> with the <bpt id=\"p2\">**</bpt>TransactionFlowOption<ept id=\"p2\">**</ept> enumeration to determine to what degree transaction flow is enabled.","pos":[634,977],"source":" This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) that implements a calculator service but the operations are attributed to demonstrate the use of the `TransactionFlowAttribute` with the **TransactionFlowOption** enumeration to determine to what degree transaction flow is enabled."},{"content":"Within the scope of the flowed transaction, a log of the requested operations is written to a database and persists until the client coordinated transaction has completed - if the client transaction does not complete, the Web service transaction ensures that the appropriate updates to the database are not committed.","pos":[978,1295]},{"pos":[1303,1410],"content":"[!NOTE]\n The setup procedure and build instructions for this sample are located at the end of this topic.","leadings":["","> "],"nodes":[{"content":"The setup procedure and build instructions for this sample are located at the end of this topic.","pos":[9,105]}]},{"content":"After initiating a connection to the service and a transaction, the client accesses several service operations.","pos":[1417,1528]},{"content":"The contract for the service is defined as follows with each of the operations demonstrating a different setting for the <ph id=\"ph1\">`TransactionFlowOption`</ph>.","pos":[1529,1674],"source":" The contract for the service is defined as follows with each of the operations demonstrating a different setting for the `TransactionFlowOption`."},{"content":"This defines the operations in the order they are to be processed:","pos":[2259,2325]},{"pos":[2335,2396],"content":"An <ph id=\"ph1\">`Add`</ph> operation request must include a flowed transaction.","source":"An `Add` operation request must include a flowed transaction."},{"pos":[2406,2470],"content":"A <ph id=\"ph1\">`Subtract`</ph> operation request may include a flowed transaction.","source":"A `Subtract` operation request may include a flowed transaction."},{"pos":[2480,2589],"content":"A <ph id=\"ph1\">`Multiply`</ph> operation request must not include a flowed transaction through the explicit NotAllowed setting.","source":"A `Multiply` operation request must not include a flowed transaction through the explicit NotAllowed setting."},{"pos":[2599,2720],"content":"A <ph id=\"ph1\">`Divide`</ph> operation request must not include a flowed transaction through the omission of a <ph id=\"ph2\">`TransactionFlow`</ph> attribute.","source":"A `Divide` operation request must not include a flowed transaction through the omission of a `TransactionFlow` attribute."},{"content":"To enable transaction flow, bindings with the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>transactionFlow&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/transactionflow.md)</ept> property enabled must be used in addition to the appropriate operation attributes.","pos":[2727,2954],"source":"To enable transaction flow, bindings with the [\\<transactionFlow>](../../../../docs/framework/configure-apps/file-schema/wcf/transactionflow.md) property enabled must be used in addition to the appropriate operation attributes."},{"content":"In this sample, the service's configuration exposes a TCP endpoint and an HTTP endpoint in addition to a Metadata Exchange endpoint.","pos":[2955,3087]},{"content":"The TCP endpoint and the HTTP endpoint use the following bindings, both of which have the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>transactionFlow&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/transactionflow.md)</ept> property enabled.","pos":[3088,3294],"source":" The TCP endpoint and the HTTP endpoint use the following bindings, both of which have the [\\<transactionFlow>](../../../../docs/framework/configure-apps/file-schema/wcf/transactionflow.md) property enabled."},{"pos":[3672,4003],"content":"[!NOTE]\n The system-provided netTcpBinding allows specification of the transactionProtocol whereas the system-provided wsHttpBinding uses only the more interoperable WSAtomicTransactionOctober2004 protocol. The OleTransactions protocol is only available for use by [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] clients.","leadings":["","> "],"nodes":[{"content":" The system-provided netTcpBinding allows specification of the transactionProtocol whereas the system-provided wsHttpBinding uses only the more interoperable WSAtomicTransactionOctober2004 protocol. The OleTransactions protocol is only available for use by [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] clients.","pos":[8,329],"nodes":[{"content":"The system-provided netTcpBinding allows specification of the transactionProtocol whereas the system-provided wsHttpBinding uses only the more interoperable WSAtomicTransactionOctober2004 protocol.","pos":[1,198]},{"content":"The OleTransactions protocol is only available for use by <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> clients.","pos":[199,321],"source":" The OleTransactions protocol is only available for use by [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] clients."}]}]},{"content":"For the class that implements the <ph id=\"ph1\">`ICalculator`</ph> interface, all of the methods are attributed with <ph id=\"ph2\">&lt;xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A&gt;</ph> property set to <ph id=\"ph3\">`true`</ph>.","pos":[4010,4213],"source":"For the class that implements the `ICalculator` interface, all of the methods are attributed with <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> property set to `true`."},{"content":"This setting declares that all actions taken within the method occur within the scope of a transaction.","pos":[4214,4317]},{"content":"In this case, the actions taken include recording to the log database.","pos":[4318,4388]},{"content":"If the operation request includes a flowed transaction then the actions occur within the scope of the incoming transaction or a new transaction scope is automatically generated.","pos":[4389,4566]},{"pos":[4574,4826],"content":"[!NOTE]\n The <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> property defines behavior local to the service method implementations and does not define the client's ability to or requirement for flowing a transaction.","leadings":["","> "],"nodes":[{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A&gt;</ph> property defines behavior local to the service method implementations and does not define the client's ability to or requirement for flowing a transaction.","pos":[9,250],"source":" The <xref:System.ServiceModel.OperationBehaviorAttribute.TransactionScopeRequired%2A> property defines behavior local to the service method implementations and does not define the client's ability to or requirement for flowing a transaction."}]},{"content":"On the client, the service's <ph id=\"ph1\">`TransactionFlowOption`</ph> settings on the operations are reflected in the client's generated definition of the <ph id=\"ph2\">`ICalculator`</ph> interface.","pos":[6108,6270],"source":"On the client, the service's `TransactionFlowOption` settings on the operations are reflected in the client's generated definition of the `ICalculator` interface."},{"content":"Also, the service's <ph id=\"ph1\">`transactionFlow`</ph> property settings are reflected in the client's application configuration.","pos":[6271,6383],"source":" Also, the service's `transactionFlow` property settings are reflected in the client's application configuration."},{"content":"The client can select the transport and protocol by selecting the appropriate <ph id=\"ph1\">`endpointConfigurationName`</ph>.","pos":[6384,6490],"source":" The client can select the transport and protocol by selecting the appropriate `endpointConfigurationName`."},{"pos":[6751,6859],"content":"[!NOTE]\n The observed behavior of this sample is the same no matter which protocol or transport is chosen.","leadings":["","> "],"nodes":[{"content":"The observed behavior of this sample is the same no matter which protocol or transport is chosen.","pos":[9,106]}]},{"pos":[6866,7001],"content":"Having initiated the connection to the service, the client creates a new <ph id=\"ph1\">`TransactionScope`</ph> around the calls to the service operations.","source":"Having initiated the connection to the service, the client creates a new `TransactionScope` around the calls to the service operations."},{"content":"The calls to the operations are as follows:","pos":[9180,9223]},{"pos":[9233,9374],"content":"The <ph id=\"ph1\">`Add`</ph> request flows the required transaction to the service and the service's actions occur within the scope of the client's transaction.","source":"The `Add` request flows the required transaction to the service and the service's actions occur within the scope of the client's transaction."},{"pos":[9384,9546],"content":"The first <ph id=\"ph1\">`Subtract`</ph> request also flows the allowed transaction to the service and again the service's actions occur within the scope of the client's transaction.","source":"The first `Subtract` request also flows the allowed transaction to the service and again the service's actions occur within the scope of the client's transaction."},{"content":"The second <ph id=\"ph1\">`Subtract`</ph> request is performed within a new transaction scope declared with the <ph id=\"ph2\">`TransactionScopeOption.Suppress`</ph> option.","pos":[9556,9689],"source":"The second `Subtract` request is performed within a new transaction scope declared with the `TransactionScopeOption.Suppress` option."},{"content":"This suppresses the client's initial outer transaction and the request does not flow a transaction to the service.","pos":[9690,9804]},{"content":"This approach allows a client to explicitly opt-out of and protect against flowing a transaction to a service when that is not required.","pos":[9805,9941]},{"content":"The service's actions occur within the scope of a new and unconnected transaction.","pos":[9942,10024]},{"pos":[10034,10304],"content":"The <ph id=\"ph1\">`Multiply`</ph> request does not flow a transaction to the service because the client's generated definition of the <ph id=\"ph2\">`ICalculator`</ph> interface includes a <ph id=\"ph3\">&lt;xref:System.ServiceModel.TransactionFlowAttribute&gt;</ph> set to <ph id=\"ph4\">&lt;xref:System.ServiceModel.TransactionFlowOption&gt;</ph><ph id=\"ph5\">`NotAllowed`</ph>.","source":"The `Multiply` request does not flow a transaction to the service because the client's generated definition of the `ICalculator` interface includes a <xref:System.ServiceModel.TransactionFlowAttribute> set to <xref:System.ServiceModel.TransactionFlowOption>`NotAllowed`."},{"content":"The <ph id=\"ph1\">`Divide`</ph> request does not flow a transaction to the service because again the client's generated definition of the <ph id=\"ph2\">`ICalculator`</ph> interface does not include a <ph id=\"ph3\">`TransactionFlowAttribute`</ph>.","pos":[10314,10503],"source":"The `Divide` request does not flow a transaction to the service because again the client's generated definition of the `ICalculator` interface does not include a `TransactionFlowAttribute`."},{"content":"The service's actions again occur within the scope of another new and unconnected transaction.","pos":[10504,10598]},{"content":"When you run the sample, the operation requests and responses are displayed in the client console window.","pos":[10605,10710]},{"content":"Press ENTER in the client window to shut down the client.","pos":[10711,10768]},{"content":"The logging of the service operation requests are displayed in the service's console window.","pos":[11063,11155]},{"content":"Press ENTER in the client window to shut down the client.","pos":[11156,11213]},{"content":"After a successful execution, the client's transaction scope completes and all actions taken within that scope are committed.","pos":[11538,11663]},{"content":"Specifically, the noted 5 records are persisted in the service's database.","pos":[11664,11738]},{"content":"The first 2 of these have occurred within the scope of the client's transaction.","pos":[11739,11819]},{"content":"If an exception occurred anywhere within the client's <ph id=\"ph1\">`TransactionScope`</ph> then the transaction cannot complete.","pos":[11826,11936],"source":"If an exception occurred anywhere within the client's `TransactionScope` then the transaction cannot complete."},{"content":"This causes the records logged within that scope to not be committed to the database.","pos":[11937,12022]},{"content":"This effect can be observed by repeating the sample run after commenting out the call to complete the outer <ph id=\"ph1\">`TransactionScope`</ph>.","pos":[12023,12150],"source":" This effect can be observed by repeating the sample run after commenting out the call to complete the outer `TransactionScope`."},{"content":"On such a run, only the last 3 actions (from the second <ph id=\"ph1\">`Subtract`</ph>, the <ph id=\"ph2\">`Multiply`</ph> and the <ph id=\"ph3\">`Divide`</ph> requests) are logged because the client transaction did not flow to those.","pos":[12151,12325],"source":" On such a run, only the last 3 actions (from the second `Subtract`, the `Multiply` and the `Divide` requests) are logged because the client transaction did not flow to those."},{"pos":[12335,12371],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[12381,12589],"content":"To build the C# or Visual Basic .NET version of the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>","source":"To build the C# or Visual Basic .NET version of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)"},{"content":"Ensure that you have installed SQL Server Express Edition or SQL Server, and that the connection string has been correctly set in the service’s application configuration file.","pos":[12599,12774]},{"content":"To run the sample without using a database, set the <ph id=\"ph1\">`usingSql`</ph> value in the service’s application configuration file to <ph id=\"ph2\">`false`</ph>","pos":[12775,12902],"source":" To run the sample without using a database, set the `usingSql` value in the service’s application configuration file to `false`"},{"pos":[12912,13120],"content":"To run the sample in a single- or cross-machine configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"pos":[13132,13494],"content":"[!NOTE]\nFor cross-machine configuration, enable the Distributed Transaction Coordinator using the instructions below, and use the WsatConfig.exe tool from the Windows SDK to enable WCF Transactions network support. See [Configuring WS-Atomic Transaction Support](http://go.microsoft.com/fwlink/?LinkId=190370) for information on setting up WsatConfig.exe.","leadings":["","    >  "],"nodes":[{"content":"For cross-machine configuration, enable the Distributed Transaction Coordinator using the instructions below, and use the WsatConfig.exe tool from the Windows SDK to enable WCF Transactions network support. See [Configuring WS-Atomic Transaction Support](http://go.microsoft.com/fwlink/?LinkId=190370) for information on setting up WsatConfig.exe.","pos":[8,355],"nodes":[{"content":"For cross-machine configuration, enable the Distributed Transaction Coordinator using the instructions below, and use the WsatConfig.exe tool from the Windows SDK to enable WCF Transactions network support.","pos":[0,206]},{"content":"See <bpt id=\"p1\">[</bpt>Configuring WS-Atomic Transaction Support<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=190370)</ept> for information on setting up WsatConfig.exe.","pos":[207,347],"source":" See [Configuring WS-Atomic Transaction Support](http://go.microsoft.com/fwlink/?LinkId=190370) for information on setting up WsatConfig.exe."}]}]},{"pos":[13501,13815],"content":"Whether you run the sample on the same computer or on different computers, you must configure the Microsoft Distributed Transaction Coordinator (MSDTC) to enable network transaction flow and use the WsatConfig.exe tool to enable <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> transactions network support.","source":"Whether you run the sample on the same computer or on different computers, you must configure the Microsoft Distributed Transaction Coordinator (MSDTC) to enable network transaction flow and use the WsatConfig.exe tool to enable [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] transactions network support."},{"pos":[13825,13925],"content":"To configure the Microsoft Distributed Transaction Coordinator (MSDTC) to support running the sample","linkify":"To configure the Microsoft Distributed Transaction Coordinator (MSDTC) to support running the sample","nodes":[{"content":"To configure the Microsoft Distributed Transaction Coordinator (MSDTC) to support running the sample","pos":[0,100]}]},{"content":"On a service machine running Windows Server 2003 or Windows XP, configure MSDTC to allow incoming network transactions by following these instructions.","pos":[13935,14086]},{"pos":[14100,14219],"content":"From the <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept> menu, navigate to <bpt id=\"p2\">**</bpt>Control Panel<ept id=\"p2\">**</ept>, then <bpt id=\"p3\">**</bpt>Administrative Tools<ept id=\"p3\">**</ept>, and then <bpt id=\"p4\">**</bpt>Component Services<ept id=\"p4\">**</ept>.","source":"From the **Start** menu, navigate to **Control Panel**, then **Administrative Tools**, and then **Component Services**."},{"content":"Expand <bpt id=\"p1\">**</bpt>Component Services<ept id=\"p1\">**</ept>.","pos":[14233,14263],"source":"Expand **Component Services**."},{"content":"Open the <bpt id=\"p1\">**</bpt>Computers<ept id=\"p1\">**</ept> folder.","pos":[14264,14294],"source":" Open the **Computers** folder."},{"pos":[14308,14362],"content":"Right-click <bpt id=\"p1\">**</bpt>My Computer<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>.","source":"Right-click **My Computer** and select **Properties**."},{"pos":[14376,14431],"content":"On the <bpt id=\"p1\">**</bpt>MSDTC<ept id=\"p1\">**</ept> tab, click <bpt id=\"p2\">**</bpt>Security Configuration<ept id=\"p2\">**</ept>.","source":"On the **MSDTC** tab, click **Security Configuration**."},{"pos":[14445,14496],"content":"Check <bpt id=\"p1\">**</bpt>Network DTC Access<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Allow Inbound<ept id=\"p2\">**</ept>.","source":"Check **Network DTC Access** and **Allow Inbound**."},{"pos":[14510,14572],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>, then click <bpt id=\"p2\">**</bpt>Yes<ept id=\"p2\">**</ept> to restart the MSDTC service.","source":"Click **OK**, then click **Yes** to restart the MSDTC service."},{"pos":[14586,14623],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to close the dialog box.","source":"Click **OK** to close the dialog box."},{"content":"On a service machine running Windows Server 2008 or Windows Vista, configure MSDTC to allow incoming network transactions by following these instructions.","pos":[14633,14787]},{"pos":[14801,14920],"content":"From the <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept> menu, navigate to <bpt id=\"p2\">**</bpt>Control Panel<ept id=\"p2\">**</ept>, then <bpt id=\"p3\">**</bpt>Administrative Tools<ept id=\"p3\">**</ept>, and then <bpt id=\"p4\">**</bpt>Component Services<ept id=\"p4\">**</ept>.","source":"From the **Start** menu, navigate to **Control Panel**, then **Administrative Tools**, and then **Component Services**."},{"content":"Expand <bpt id=\"p1\">**</bpt>Component Services<ept id=\"p1\">**</ept>.","pos":[14934,14964],"source":"Expand **Component Services**."},{"content":"Open the <bpt id=\"p1\">**</bpt>Computers<ept id=\"p1\">**</ept> folder.","pos":[14965,14995],"source":" Open the **Computers** folder."},{"content":"Select <bpt id=\"p1\">**</bpt>Distributed Transaction Coordinator<ept id=\"p1\">**</ept>.","pos":[14996,15043],"source":" Select **Distributed Transaction Coordinator**."},{"pos":[15057,15115],"content":"Right-click <bpt id=\"p1\">**</bpt>DTC Coordinator<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>.","source":"Right-click **DTC Coordinator** and select **Properties**."},{"pos":[15129,15205],"content":"On the <bpt id=\"p1\">**</bpt>Security<ept id=\"p1\">**</ept> tab, check <bpt id=\"p2\">**</bpt>Network DTC Access<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>Allow Inbound<ept id=\"p3\">**</ept>.","source":"On the **Security** tab, check **Network DTC Access** and **Allow Inbound**."},{"pos":[15219,15281],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>, then click <bpt id=\"p2\">**</bpt>Yes<ept id=\"p2\">**</ept> to restart the MSDTC service.","source":"Click **OK**, then click **Yes** to restart the MSDTC service."},{"pos":[15295,15332],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to close the dialog box.","source":"Click **OK** to close the dialog box."},{"content":"On the client machine, configure MSDTC to allow outgoing network transactions:","pos":[15342,15420]},{"pos":[15434,15551],"content":"From the <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept> menu, navigate to <ph id=\"ph1\">`Control Panel`</ph>, then <bpt id=\"p2\">**</bpt>Administrative Tools<ept id=\"p2\">**</ept>, and then <bpt id=\"p3\">**</bpt>Component Services<ept id=\"p3\">**</ept>.","source":"From the **Start** menu, navigate to `Control Panel`, then **Administrative Tools**, and then **Component Services**."},{"pos":[15565,15619],"content":"Right-click <bpt id=\"p1\">**</bpt>My Computer<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>.","source":"Right-click **My Computer** and select **Properties**."},{"pos":[15633,15688],"content":"On the <bpt id=\"p1\">**</bpt>MSDTC<ept id=\"p1\">**</ept> tab, click <bpt id=\"p2\">**</bpt>Security Configuration<ept id=\"p2\">**</ept>.","source":"On the **MSDTC** tab, click **Security Configuration**."},{"pos":[15702,15754],"content":"Check <bpt id=\"p1\">**</bpt>Network DTC Access<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Allow Outbound<ept id=\"p2\">**</ept>.","source":"Check **Network DTC Access** and **Allow Outbound**."},{"pos":[15768,15830],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>, then click <bpt id=\"p2\">**</bpt>Yes<ept id=\"p2\">**</ept> to restart the MSDTC service.","source":"Click **OK**, then click **Yes** to restart the MSDTC service."},{"pos":[15844,15881],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to close the dialog box.","source":"Click **OK** to close the dialog box."},{"pos":[15889,16021],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[16075,16401],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[16402,16452]}]}