{"content":"---\ntitle: \"Content Based Correlation | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: f46a2b68-8d24-4122-bbee-9573fc3f9fb4\ncaps.latest.revision: 17\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Content Based Correlation\nWhen workflow services communicate with clients and other services, often there is some data in the exchanged messages that uniquely relates a message to a particular instance. Content-based correlation uses this data in the message, such as a customer number or order ID, to route messages to the proper workflow instance. This topic explains how to use content-based correlation in workflows.  \n  \n## Using Content-Based Correlation  \n Content-based correlation is used when a workflow service has multiple methods that are accessed by a single client and a piece of data in the exchanged messages identifies the desired instance.  \n  \n> [!NOTE]\n>  Content-based correlation is useful when context correlation cannot be used because the binding is not one of the supported context exchange bindings. [!INCLUDE[crabout](../../../../includes/crabout-md.md)]context correlation, see [Context Exchange](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md).  \n  \n Each messaging activity used in these communications must specify the location of the data in the message that uniquely identifies the instance. This is done by providing a <xref:System.ServiceModel.MessageQuerySet>, using either a <xref:System.ServiceModel.Activities.QueryCorrelationInitializer> or <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>, that queries the message for the piece or pieces of data that uniquely identify the instance.  \n  \n> [!WARNING]\n>  The data that is used to identify the instance is hashed into a correlation key. Care must be taken to ensure that the data used for correlation is unique or else collisions in the hashed key could occur and cause messages to be misrouted. For example, a correlation based solely on a customer name may cause a collision because there may be multiple customers with the same name. The colon (`:`) should not be used as part of the data used to correlate the message because it is already used to delimit the message queryâ€™s key and value to form the string that is subsequently hashed.  \n  \n In the following example, the initial <xref:System.ServiceModel.Activities.Receive>/<xref:System.ServiceModel.Activities.SendReply> in a workflow service returns an `OrderId`, which is then passed back by the client on the call to the following <xref:System.ServiceModel.Activities.Receive> activity in the workflow service.  \n  \n [!code-csharp[CFX_ContentCorrelation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#1)]  \n  \n The previous example shows a content-based correlation that is initialized by the <xref:System.ServiceModel.Activities.SendReply>. The <xref:System.ServiceModel.MessageQuerySet> specifies that the data used to identify subsequent messages to this service is the `OrderId`.  \n  \n [!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]  \n  \n The <xref:System.ServiceModel.Activities.Receive> activity that follows the <xref:System.ServiceModel.Activities.SendReply> in the workflow follows the correlation that was initialized by the <xref:System.ServiceModel.Activities.SendReply>. Both activities share the same <xref:System.ServiceModel.Activities.CorrelationHandle>, but each one has its own <xref:System.ServiceModel.MessageQuerySet> and <xref:System.ServiceModel.XPathMessageQuery> that specifies where the identifying data is in that particular message. On the activity that initializes the correlation, this <xref:System.ServiceModel.MessageQuerySet> is specified in the <xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A> property, and for any following <xref:System.ServiceModel.Activities.Receive> activities, it is specified using the <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A> property.  \n  \n [!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]  \n  \n A content-based correlation can be initialized by any messaging activity (<xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.Receive>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.ReceiveReply>) when the data flows as part of a message. If the particular piece of data does not flow as part of a message, then it can be initialized explicitly by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity. If multiple pieces of data are required to uniquely identify the message, then multiple queries can be added to the <xref:System.ServiceModel.MessageQuerySet>. In these examples, a <xref:System.ServiceModel.Activities.CorrelationHandle> was explicitly provided to each of the activities using the `CorrelatesWith` or `CorrelationHandle` properties, but if there is only one correlation required for the entire workflow, such as in this example where everything correlates on `OrderId`, the implicit correlation handle management provided by <xref:System.ServiceModel.Activities.WorkflowServiceHost> is sufficient.  \n  \n## Using the InitializeCorrelation Activity  \n In the previous example, the `OrderId` flowed to the caller through the <xref:System.ServiceModel.Activities.SendReply> activity and this is where the correlation was initialized. The same behavior can be accomplished by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity. The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity takes the <xref:System.ServiceModel.Activities.CorrelationHandle> and a dictionary of items that represent the data used to map the message to the correct instance. To use the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity in the preceding sample, remove the <xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A> from the <xref:System.ServiceModel.Activities.SendReply> activity and initialize the correlation using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.  \n  \n [!code-csharp[CFX_ContentCorrelation#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#4)]  \n  \n The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity is then used in the workflow, after the variables that hold the data are populated but before the <xref:System.ServiceModel.Activities.Receive> activity that correlates with the initialized <xref:System.ServiceModel.Activities.CorrelationHandle>.  \n  \n [!code-csharp[CFX_ContentCorrelation#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#5)]  \n  \n## Configuring XPath Queries Using the Workflow Designer  \n In the previous examples, the activities and the XPath queries used in the message queries were specified in code. The workflow designer in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] also provides the ability to generate XPaths from `DataContract` types for content-based correlation. The first XPath configured in the previous example was configured for the <xref:System.ServiceModel.Activities.SendReply>.  \n  \n [!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]  \n  \n To configure the XPath for a messaging activity in the workflow designer, select the activity in the workflow designer. If the activity is initializing the correlation, as in the previous example, click the ellipsis button for the **CorrelationInitializers** property in the **Properties** window. This displays the **Add Correlation Initializers** dialog window. From this dialog you can specify the correlation type and select the content that is used for the correlation. The <xref:System.ServiceModel.Activities.CorrelationHandle> variable is specified in the **Add initializer** box, and the correlation type and data used for the correlation is selected from the **XPath Queries** section of the dialog box.  \n  \n ![CorrelationInitializer Dialog](../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg \"CorrelationInitializerDlg\")  \n  \n The second XPath query in the previous example was configured in the <xref:System.ServiceModel.Activities.Receive> activity.  \n  \n [!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]  \n  \n To configure the XPath query for a messaging activity that does not initialize the correlation, select the activity in the workflow designer and then click the ellipsis button for the **CorrelatesOn** property in the **Properties** window. This displays the **CorrelatesOn Definition** dialog window.  \n  \n ![CorrelatesOn Definition](../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg \"CorrelatesOnDialog\")  \n  \n From this dialog you specify the <xref:System.ServiceModel.Activities.CorrelationHandle> and choose items in the **XPath Queries** list to build the XPath query.","nodes":[{"pos":[12,54],"content":"Content Based Correlation | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Content Based Correlation | Microsoft Docs","pos":[0,42]}]},{"pos":[353,378],"content":"Content Based Correlation","linkify":"Content Based Correlation","nodes":[{"content":"Content Based Correlation","pos":[0,25]}]},{"content":"When workflow services communicate with clients and other services, often there is some data in the exchanged messages that uniquely relates a message to a particular instance.","pos":[379,555]},{"content":"Content-based correlation uses this data in the message, such as a customer number or order ID, to route messages to the proper workflow instance.","pos":[556,702]},{"content":"This topic explains how to use content-based correlation in workflows.","pos":[703,773]},{"pos":[782,813],"content":"Using Content-Based Correlation","linkify":"Using Content-Based Correlation","nodes":[{"content":"Using Content-Based Correlation","pos":[0,31]}]},{"content":"Content-based correlation is used when a workflow service has multiple methods that are accessed by a single client and a piece of data in the exchanged messages identifies the desired instance.","pos":[817,1011]},{"pos":[1019,1360],"content":"[!NOTE]\n Content-based correlation is useful when context correlation cannot be used because the binding is not one of the supported context exchange bindings. [!INCLUDE[crabout](../../../../includes/crabout-md.md)]context correlation, see [Context Exchange](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md).","leadings":["","> "],"nodes":[{"content":" Content-based correlation is useful when context correlation cannot be used because the binding is not one of the supported context exchange bindings. [!INCLUDE[crabout](../../../../includes/crabout-md.md)]context correlation, see [Context Exchange](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md).","pos":[8,339],"nodes":[{"content":"Content-based correlation is useful when context correlation cannot be used because the binding is not one of the supported context exchange bindings.","pos":[1,151]},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph>context correlation, see <bpt id=\"p1\">[</bpt>Context Exchange<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md)</ept>.","pos":[152,331],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)]context correlation, see [Context Exchange](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md)."}]}]},{"content":"Each messaging activity used in these communications must specify the location of the data in the message that uniquely identifies the instance.","pos":[1367,1511]},{"content":"This is done by providing a <ph id=\"ph1\">&lt;xref:System.ServiceModel.MessageQuerySet&gt;</ph>, using either a <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.QueryCorrelationInitializer&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A&gt;</ph>, that queries the message for the piece or pieces of data that uniquely identify the instance.","pos":[1512,1824],"source":" This is done by providing a <xref:System.ServiceModel.MessageQuerySet>, using either a <xref:System.ServiceModel.Activities.QueryCorrelationInitializer> or <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>, that queries the message for the piece or pieces of data that uniquely identify the instance."},{"pos":[1832,2431],"content":"[!WARNING]\n The data that is used to identify the instance is hashed into a correlation key. Care must be taken to ensure that the data used for correlation is unique or else collisions in the hashed key could occur and cause messages to be misrouted. For example, a correlation based solely on a customer name may cause a collision because there may be multiple customers with the same name. The colon (`:`) should not be used as part of the data used to correlate the message because it is already used to delimit the message queryâ€™s key and value to form the string that is subsequently hashed.","leadings":["","> "],"nodes":[{"content":" The data that is used to identify the instance is hashed into a correlation key. Care must be taken to ensure that the data used for correlation is unique or else collisions in the hashed key could occur and cause messages to be misrouted. For example, a correlation based solely on a customer name may cause a collision because there may be multiple customers with the same name. The colon (`:`) should not be used as part of the data used to correlate the message because it is already used to delimit the message queryâ€™s key and value to form the string that is subsequently hashed.","pos":[11,597],"nodes":[{"content":"The data that is used to identify the instance is hashed into a correlation key.","pos":[1,81]},{"content":"Care must be taken to ensure that the data used for correlation is unique or else collisions in the hashed key could occur and cause messages to be misrouted.","pos":[82,240]},{"content":"For example, a correlation based solely on a customer name may cause a collision because there may be multiple customers with the same name.","pos":[241,381]},{"content":"The colon (<ph id=\"ph1\">`:`</ph>) should not be used as part of the data used to correlate the message because it is already used to delimit the message queryâ€™s key and value to form the string that is subsequently hashed.","pos":[382,586],"source":" The colon (`:`) should not be used as part of the data used to correlate the message because it is already used to delimit the message queryâ€™s key and value to form the string that is subsequently hashed."}]}]},{"pos":[2438,2762],"content":"In the following example, the initial <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph><ph id=\"ph2\">/</ph><ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph> in a workflow service returns an <ph id=\"ph4\">`OrderId`</ph>, which is then passed back by the client on the call to the following <ph id=\"ph5\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activity in the workflow service.","source":"In the following example, the initial <xref:System.ServiceModel.Activities.Receive>/<xref:System.ServiceModel.Activities.SendReply> in a workflow service returns an `OrderId`, which is then passed back by the client on the call to the following <xref:System.ServiceModel.Activities.Receive> activity in the workflow service."},{"pos":[2769,2901],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>CFX_ContentCorrelation#1<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#1)</ept><ept id=\"p1\">]</ept>","source":"[!code-csharp[CFX_ContentCorrelation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#1)]"},{"content":"The previous example shows a content-based correlation that is initialized by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph>.","pos":[2908,3038],"source":"The previous example shows a content-based correlation that is initialized by the <xref:System.ServiceModel.Activities.SendReply>."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.MessageQuerySet&gt;</ph> specifies that the data used to identify subsequent messages to this service is the <ph id=\"ph2\">`OrderId`</ph>.","pos":[3039,3180],"source":" The <xref:System.ServiceModel.MessageQuerySet> specifies that the data used to identify subsequent messages to this service is the `OrderId`."},{"pos":[3187,3319],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>CFX_ContentCorrelation#2<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)</ept><ept id=\"p1\">]</ept>","source":"[!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]"},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activity that follows the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph> in the workflow follows the correlation that was initialized by the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph>.","pos":[3326,3566],"source":"The <xref:System.ServiceModel.Activities.Receive> activity that follows the <xref:System.ServiceModel.Activities.SendReply> in the workflow follows the correlation that was initialized by the <xref:System.ServiceModel.Activities.SendReply>."},{"content":"Both activities share the same <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.CorrelationHandle&gt;</ph>, but each one has its own <ph id=\"ph2\">&lt;xref:System.ServiceModel.MessageQuerySet&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.ServiceModel.XPathMessageQuery&gt;</ph> that specifies where the identifying data is in that particular message.","pos":[3567,3844],"source":" Both activities share the same <xref:System.ServiceModel.Activities.CorrelationHandle>, but each one has its own <xref:System.ServiceModel.MessageQuerySet> and <xref:System.ServiceModel.XPathMessageQuery> that specifies where the identifying data is in that particular message."},{"content":"On the activity that initializes the correlation, this <ph id=\"ph1\">&lt;xref:System.ServiceModel.MessageQuerySet&gt;</ph> is specified in the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A&gt;</ph> property, and for any following <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activities, it is specified using the <ph id=\"ph4\">&lt;xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A&gt;</ph> property.","pos":[3845,4223],"source":" On the activity that initializes the correlation, this <xref:System.ServiceModel.MessageQuerySet> is specified in the <xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A> property, and for any following <xref:System.ServiceModel.Activities.Receive> activities, it is specified using the <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A> property."},{"pos":[4230,4362],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>CFX_ContentCorrelation#3<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)</ept><ept id=\"p1\">]</ept>","source":"[!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]"},{"content":"A content-based correlation can be initialized by any messaging activity (<ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph>, <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph>, <ph id=\"ph4\">&lt;xref:System.ServiceModel.Activities.ReceiveReply&gt;</ph>) when the data flows as part of a message.","pos":[4369,4676],"source":"A content-based correlation can be initialized by any messaging activity (<xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.Receive>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.ReceiveReply>) when the data flows as part of a message."},{"content":"If the particular piece of data does not flow as part of a message, then it can be initialized explicitly by using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.InitializeCorrelation&gt;</ph> activity.","pos":[4677,4865],"source":" If the particular piece of data does not flow as part of a message, then it can be initialized explicitly by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity."},{"content":"If multiple pieces of data are required to uniquely identify the message, then multiple queries can be added to the <ph id=\"ph1\">&lt;xref:System.ServiceModel.MessageQuerySet&gt;</ph>.","pos":[4866,5025],"source":" If multiple pieces of data are required to uniquely identify the message, then multiple queries can be added to the <xref:System.ServiceModel.MessageQuerySet>."},{"content":"In these examples, a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.CorrelationHandle&gt;</ph> was explicitly provided to each of the activities using the <ph id=\"ph2\">`CorrelatesWith`</ph> or <ph id=\"ph3\">`CorrelationHandle`</ph> properties, but if there is only one correlation required for the entire workflow, such as in this example where everything correlates on <ph id=\"ph4\">`OrderId`</ph>, the implicit correlation handle management provided by <ph id=\"ph5\">&lt;xref:System.ServiceModel.Activities.WorkflowServiceHost&gt;</ph> is sufficient.","pos":[5026,5479],"source":" In these examples, a <xref:System.ServiceModel.Activities.CorrelationHandle> was explicitly provided to each of the activities using the `CorrelatesWith` or `CorrelationHandle` properties, but if there is only one correlation required for the entire workflow, such as in this example where everything correlates on `OrderId`, the implicit correlation handle management provided by <xref:System.ServiceModel.Activities.WorkflowServiceHost> is sufficient."},{"pos":[5488,5528],"content":"Using the InitializeCorrelation Activity","linkify":"Using the InitializeCorrelation Activity","nodes":[{"content":"Using the InitializeCorrelation Activity","pos":[0,40]}]},{"content":"In the previous example, the <ph id=\"ph1\">`OrderId`</ph> flowed to the caller through the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph> activity and this is where the correlation was initialized.","pos":[5532,5711],"source":"In the previous example, the `OrderId` flowed to the caller through the <xref:System.ServiceModel.Activities.SendReply> activity and this is where the correlation was initialized."},{"content":"The same behavior can be accomplished by using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.InitializeCorrelation&gt;</ph> activity.","pos":[5712,5832],"source":" The same behavior can be accomplished by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.InitializeCorrelation&gt;</ph> activity takes the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.CorrelationHandle&gt;</ph> and a dictionary of items that represent the data used to map the message to the correct instance.","pos":[5833,6070],"source":" The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity takes the <xref:System.ServiceModel.Activities.CorrelationHandle> and a dictionary of items that represent the data used to map the message to the correct instance."},{"content":"To use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.InitializeCorrelation&gt;</ph> activity in the preceding sample, remove the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A&gt;</ph> from the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph> activity and initialize the correlation using the <ph id=\"ph4\">&lt;xref:System.ServiceModel.Activities.InitializeCorrelation&gt;</ph> activity.","pos":[6071,6438],"source":" To use the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity in the preceding sample, remove the <xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A> from the <xref:System.ServiceModel.Activities.SendReply> activity and initialize the correlation using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity."},{"pos":[6445,6577],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>CFX_ContentCorrelation#4<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#4)</ept><ept id=\"p1\">]</ept>","source":"[!code-csharp[CFX_ContentCorrelation#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#4)]"},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.InitializeCorrelation&gt;</ph> activity is then used in the workflow, after the variables that hold the data are populated but before the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activity that correlates with the initialized <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.CorrelationHandle&gt;</ph>.","pos":[6584,6903],"source":"The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity is then used in the workflow, after the variables that hold the data are populated but before the <xref:System.ServiceModel.Activities.Receive> activity that correlates with the initialized <xref:System.ServiceModel.Activities.CorrelationHandle>."},{"pos":[6910,7042],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>CFX_ContentCorrelation#5<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#5)</ept><ept id=\"p1\">]</ept>","source":"[!code-csharp[CFX_ContentCorrelation#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#5)]"},{"pos":[7051,7104],"content":"Configuring XPath Queries Using the Workflow Designer","linkify":"Configuring XPath Queries Using the Workflow Designer","nodes":[{"content":"Configuring XPath Queries Using the Workflow Designer","pos":[0,53]}]},{"content":"In the previous examples, the activities and the XPath queries used in the message queries were specified in code.","pos":[7108,7222]},{"content":"The workflow designer in <ph id=\"ph1\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph> also provides the ability to generate XPaths from <ph id=\"ph2\">`DataContract`</ph> types for content-based correlation.","pos":[7223,7421],"source":" The workflow designer in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] also provides the ability to generate XPaths from `DataContract` types for content-based correlation."},{"content":"The first XPath configured in the previous example was configured for the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph>.","pos":[7422,7544],"source":" The first XPath configured in the previous example was configured for the <xref:System.ServiceModel.Activities.SendReply>."},{"pos":[7551,7683],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>CFX_ContentCorrelation#2<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)</ept><ept id=\"p1\">]</ept>","source":"[!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]"},{"content":"To configure the XPath for a messaging activity in the workflow designer, select the activity in the workflow designer.","pos":[7690,7809]},{"content":"If the activity is initializing the correlation, as in the previous example, click the ellipsis button for the <bpt id=\"p1\">**</bpt>CorrelationInitializers<ept id=\"p1\">**</ept> property in the <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept> window.","pos":[7810,7987],"source":" If the activity is initializing the correlation, as in the previous example, click the ellipsis button for the **CorrelationInitializers** property in the **Properties** window."},{"content":"This displays the <bpt id=\"p1\">**</bpt>Add Correlation Initializers<ept id=\"p1\">**</ept> dialog window.","pos":[7988,8053],"source":" This displays the **Add Correlation Initializers** dialog window."},{"content":"From this dialog you can specify the correlation type and select the content that is used for the correlation.","pos":[8054,8164]},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.CorrelationHandle&gt;</ph> variable is specified in the <bpt id=\"p1\">**</bpt>Add initializer<ept id=\"p1\">**</ept> box, and the correlation type and data used for the correlation is selected from the <bpt id=\"p2\">**</bpt>XPath Queries<ept id=\"p2\">**</ept> section of the dialog box.","pos":[8165,8403],"source":" The <xref:System.ServiceModel.Activities.CorrelationHandle> variable is specified in the **Add initializer** box, and the correlation type and data used for the correlation is selected from the **XPath Queries** section of the dialog box."},{"pos":[8410,8554],"content":"<bpt id=\"p1\">![</bpt>CorrelationInitializer Dialog<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg \"</bpt>CorrelationInitializerDlg<ept id=\"p2\">\")</ept>","source":"![CorrelationInitializer Dialog](../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg \"CorrelationInitializerDlg\")"},{"content":"The second XPath query in the previous example was configured in the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activity.","pos":[8561,8685],"source":"The second XPath query in the previous example was configured in the <xref:System.ServiceModel.Activities.Receive> activity."},{"pos":[8692,8824],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>CFX_ContentCorrelation#3<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)</ept><ept id=\"p1\">]</ept>","source":"[!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]"},{"content":"To configure the XPath query for a messaging activity that does not initialize the correlation, select the activity in the workflow designer and then click the ellipsis button for the <bpt id=\"p1\">**</bpt>CorrelatesOn<ept id=\"p1\">**</ept> property in the <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept> window.","pos":[8831,9070],"source":"To configure the XPath query for a messaging activity that does not initialize the correlation, select the activity in the workflow designer and then click the ellipsis button for the **CorrelatesOn** property in the **Properties** window."},{"content":"This displays the <bpt id=\"p1\">**</bpt>CorrelatesOn Definition<ept id=\"p1\">**</ept> dialog window.","pos":[9071,9131],"source":" This displays the **CorrelatesOn Definition** dialog window."},{"pos":[9138,9262],"content":"<bpt id=\"p1\">![</bpt>CorrelatesOn Definition<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg \"</bpt>CorrelatesOnDialog<ept id=\"p2\">\")</ept>","source":"![CorrelatesOn Definition](../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg \"CorrelatesOnDialog\")"},{"pos":[9269,9430],"content":"From this dialog you specify the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.CorrelationHandle&gt;</ph> and choose items in the <bpt id=\"p1\">**</bpt>XPath Queries<ept id=\"p1\">**</ept> list to build the XPath query.","source":"From this dialog you specify the <xref:System.ServiceModel.Activities.CorrelationHandle> and choose items in the **XPath Queries** list to build the XPath query."}]}