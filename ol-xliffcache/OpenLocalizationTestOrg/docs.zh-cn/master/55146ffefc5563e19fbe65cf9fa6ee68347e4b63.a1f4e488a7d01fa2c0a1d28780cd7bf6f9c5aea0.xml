{"content":"---\ntitle: \"Attached and Detached Child Tasks | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"tasks, child tasks\"\nms.assetid: c95788bf-90a6-4e96-b7bc-58e36a228cc5\ncaps.latest.revision: 21\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# Attached and Detached Child Tasks\nA *child task* (or *nested task*) is a <xref:System.Threading.Tasks.Task?displayProperty=fullName> instance that is created in the user delegate of another task, which is known as the *parent task*. A child task can be either detached or attached. A *detached child task* is a task that executes independently of its parent. An *attached child task* is a nested task that is created with the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName> option whose parent does not explicitly or by default prohibit it from being attached. A task may create any number of attached and detached child tasks, limited only by system resources.  \n  \n The following table lists the basic differences between the two kinds of child tasks.  \n  \n|Category|Detached child tasks|Attached child tasks|  \n|--------------|--------------------------|--------------------------|  \n|Parent waits for child tasks to complete.|No|Yes|  \n|Parent propagates exceptions thrown by child tasks.|No|Yes|  \n|Status of parent depends on status of child.|No|Yes|  \n  \n In most scenarios, we recommend that you use detached child tasks, because their relationships with other tasks are less complex. That is why tasks created inside parent tasks are detached by default, and you must explicitly specify the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName> option to create an attached child task.  \n  \n## Detached child tasks  \n Although a child task is created by a parent task, by default it is independent of the parent task. In the following example, a parent task creates one simple child task. If you run the example code multiple times, you may notice that the output from the example differs from that shown, and also that the output may change each time you run the code. This occurs because the parent task and child tasks execute independently of each other; the child is a detached task. The example waits only for the parent task to complete, and the child task may not execute or complete before the console app terminates.  \n  \n [!code-csharp[TPL_ChildTasks#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/nested1.cs#1)]\n [!code-vb[TPL_ChildTasks#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/nested1.vb#1)]  \n  \n If the child task is represented by a <xref:System.Threading.Tasks.Task%601> object rather than a <xref:System.Threading.Tasks.Task> object, you can ensure that the parent task will wait for the child to complete by accessing the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=fullName> property of the child even if it is a detached child task. The <xref:System.Threading.Tasks.Task%601.Result%2A> property blocks until its task completes, as the following example shows.  \n  \n [!code-csharp[TPL_ChildTasks#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/childtasks.cs#4)]\n [!code-vb[TPL_ChildTasks#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/tpl_childtasks.vb#4)]  \n  \n## Attached child tasks  \n Unlike detached child tasks, attached child tasks are closely synchronized with the parent. You can change the detached child task in the previous example to an attached child task by using the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName> option in the task creation statement, as shown in the following example. In this code, the attached child task completes before its parent. As a result, the output from the example is the same each time you run the code.  \n  \n [!code-csharp[TPL_ChildTasks#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/child1.cs#2)]\n [!code-vb[TPL_ChildTasks#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/child1.vb#2)]  \n  \n You can use attached child tasks to create tightly synchronized graphs of asynchronous operations.  \n  \n However, a child task can attach to its parent only if its parent does not prohibit attached child tasks. Parent tasks can explicitly prevent child tasks from attaching to them by specifying the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName> option in the parent task's class constructor or the <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=fullName> method. Parent tasks implicitly prevent child tasks from attaching to them if they are created by calling the <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=fullName> method. The following example illustrates this. It is identical to the previous example, except that the parent task is created by calling the <xref:System.Threading.Tasks.Task.Run%28System.Action%29?displayProperty=fullName> method rather than the <xref:System.Threading.Tasks.TaskFactory.StartNew%28System.Action%29?displayProperty=fullName> method. Because the child task is not able to attach to its parent, the output from the example is unpredictable. Because the default task creation options for the <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=fullName> overloads include <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName>, this example is functionally equivalent to the first example in the \"Detached child tasks\" section.  \n  \n [!code-csharp[TPL_ChildTasks#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/child1a.cs#3)]\n [!code-vb[TPL_ChildTasks#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/child1a.vb#3)]  \n  \n## Exceptions in child tasks  \n If a detached child task throws an exception, that exception must be observed or handled directly in the parent task just as with any non-nested task. If an attached child task throws an exception, the exception is automatically propagated to the parent task and back to the thread that waits or tries to access the task's <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=fullName> property. Therefore, by using attached child tasks, you can handle all exceptions at just one point in the call to <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=fullName> on the calling thread. For more information, see [Exception Handling](../../../docs/standard/parallel-programming/exception-handling-task-parallel-library.md).  \n  \n## Cancellation and child tasks  \n Task cancellation is cooperative. That is, to be cancelable, every attached or detached child task must monitor the status of the cancellation token. If you want to cancel a parent and all its children by using one cancellation request, you pass the same token as an argument to all tasks and provide in each task the logic to respond to the request in each task. For more information, see [Task Cancellation](../../../docs/standard/parallel-programming/task-cancellation.md) and [How to: Cancel a Task and Its Children](../../../docs/standard/parallel-programming/how-to-cancel-a-task-and-its-children.md).  \n  \n### When the parent cancels  \n If a parent cancels itself before its child task is started, the child never starts. If a parent cancels itself after its child task has already started, the child runs to completion unless it has its own cancellation logic. For more information, see [Task Cancellation](../../../docs/standard/parallel-programming/task-cancellation.md).  \n  \n### When a detached child task cancels  \n If a detached child task cancels itself by using the same token that was passed to the parent, and the parent does not wait for the child task, no exception is propagated, because the exception is treated as benign cooperation cancellation. This behavior is the same as that of any top-level task.  \n  \n### When an attached child task cancels  \n When an attached child task cancels itself by using the same token that was passed to its parent task, a <xref:System.Threading.Tasks.TaskCanceledException> is propagated to the joining thread inside an <xref:System.AggregateException>. You must wait for the parent task so that you can handle all benign exceptions in addition to all faulting exceptions that are propagated up through a graph of attached child tasks.  \n  \n For more information, see [Exception Handling](../../../docs/standard/parallel-programming/exception-handling-task-parallel-library.md).  \n  \n## Preventing a child task from attaching to its parent  \n An unhandled exception that is thrown by a child task is propagated to the parent task. You can use this behavior to observe all child task exceptions from one root task instead of traversing a tree of tasks. However, exception propagation can be problematic when a parent task does not expect attachment from other code. For example, consider an app that calls a third-party library component from a <xref:System.Threading.Tasks.Task> object. If the third-party library component also creates a <xref:System.Threading.Tasks.Task> object and specifies <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName> to attach it to the parent task, any unhandled exceptions that occur in the child task propagate to the parent. This could lead to unexpected behavior in the main app.  \n  \n To prevent a child task from attaching to its parent task, specify the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName> option when you create the parent <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> object. When a task tries to attach to its parent and the parent specifies the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName> option, the child task will not be able to attach to a parent and will execute just as if the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName> option was not specified.  \n  \n You might also want to prevent a child task from attaching to its parent when the child task does not finish in a timely manner. Because a parent task does not finish until all child tasks finish, a long-running child task can cause the overall app to perform poorly. For an example that shows how to improve app performance by preventing a task from attaching to its parent task, see [How to: Prevent a Child Task from Attaching to its Parent](../../../docs/standard/parallel-programming/how-to-prevent-a-child-task-from-attaching-to-its-parent.md).  \n  \n## See Also  \n [Parallel Programming](../../../docs/standard/parallel-programming/index.md)   \n [Data Parallelism](../../../docs/standard/parallel-programming/data-parallelism-task-parallel-library.md)","nodes":[{"pos":[4,394],"embed":true,"restype":"x-metadata","content":"title: \"Attached and Detached Child Tasks | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"tasks, child tasks\"\nms.assetid: c95788bf-90a6-4e96-b7bc-58e36a228cc5\ncaps.latest.revision: 21\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"","nodes":[{"content":"Attached and Detached Child Tasks | Microsoft Docs","nodes":[{"pos":[0,50],"content":"Attached and Detached Child Tasks | Microsoft Docs","nodes":[{"content":"Attached and Detached Child Tasks | Microsoft Docs","pos":[0,50]}]}],"path":["title"]}],"yml":true},{"pos":[401,434],"content":"Attached and Detached Child Tasks","linkify":"Attached and Detached Child Tasks","nodes":[{"content":"Attached and Detached Child Tasks","pos":[0,33]}]},{"content":"A <bpt id=\"p1\">*</bpt>child task<ept id=\"p1\">*</ept> (or <bpt id=\"p2\">*</bpt>nested task<ept id=\"p2\">*</ept>) is a <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Task?displayProperty=fullName&gt;</ph> instance that is created in the user delegate of another task, which is known as the <bpt id=\"p3\">*</bpt>parent task<ept id=\"p3\">*</ept>.","pos":[435,633],"source":"A *child task* (or *nested task*) is a <xref:System.Threading.Tasks.Task?displayProperty=fullName> instance that is created in the user delegate of another task, which is known as the *parent task*."},{"content":"A child task can be either detached or attached.","pos":[634,682]},{"content":"A <bpt id=\"p1\">*</bpt>detached child task<ept id=\"p1\">*</ept> is a task that executes independently of its parent.","pos":[683,759],"source":" A *detached child task* is a task that executes independently of its parent."},{"content":"An <bpt id=\"p1\">*</bpt>attached child task<ept id=\"p1\">*</ept> is a nested task that is created with the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName&gt;</ph> option whose parent does not explicitly or by default prohibit it from being attached.","pos":[760,988],"source":" An *attached child task* is a nested task that is created with the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName> option whose parent does not explicitly or by default prohibit it from being attached."},{"content":"A task may create any number of attached and detached child tasks, limited only by system resources.","pos":[989,1089]},{"content":"The following table lists the basic differences between the two kinds of child tasks.","pos":[1096,1181]},{"content":"Category","pos":[1188,1196]},{"content":"Detached child tasks","pos":[1197,1217]},{"content":"Attached child tasks","pos":[1218,1238]},{"content":"Parent waits for child tasks to complete.","pos":[1316,1357]},{"content":"No","pos":[1358,1360]},{"content":"Yes","pos":[1361,1364]},{"content":"Parent propagates exceptions thrown by child tasks.","pos":[1369,1420]},{"content":"No","pos":[1421,1423]},{"content":"Yes","pos":[1424,1427]},{"content":"Status of parent depends on status of child.","pos":[1432,1476]},{"content":"No","pos":[1477,1479]},{"content":"Yes","pos":[1480,1483]},{"content":"In most scenarios, we recommend that you use detached child tasks, because their relationships with other tasks are less complex.","pos":[1491,1620]},{"content":"That is why tasks created inside parent tasks are detached by default, and you must explicitly specify the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName&gt;</ph> option to create an attached child task.","pos":[1621,1843],"source":" That is why tasks created inside parent tasks are detached by default, and you must explicitly specify the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName> option to create an attached child task."},{"pos":[1852,1872],"content":"Detached child tasks","linkify":"Detached child tasks","nodes":[{"content":"Detached child tasks","pos":[0,20]}]},{"content":"Although a child task is created by a parent task, by default it is independent of the parent task.","pos":[1876,1975]},{"content":"In the following example, a parent task creates one simple child task.","pos":[1976,2046]},{"content":"If you run the example code multiple times, you may notice that the output from the example differs from that shown, and also that the output may change each time you run the code.","pos":[2047,2227]},{"content":"This occurs because the parent task and child tasks execute independently of each other; the child is a detached task.","pos":[2228,2346]},{"content":"The example waits only for the parent task to complete, and the child task may not execute or complete before the console app terminates.","pos":[2347,2484]},{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPL_ChildTasks#1<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/nested1.cs#1)</ept><ept id=\"p1\">]</ept>","pos":[2491,2605],"source":"[!code-csharp[TPL_ChildTasks#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/nested1.cs#1)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>TPL_ChildTasks#1<ept id=\"p2\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/nested1.vb#1)</ept><ept id=\"p1\">]</ept>","pos":[2607,2722],"source":"[!code-vb[TPL_ChildTasks#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/nested1.vb#1)]"},{"content":"If the child task is represented by a <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Task%601&gt;</ph> object rather than a <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Task&gt;</ph> object, you can ensure that the parent task will wait for the child to complete by accessing the <ph id=\"ph3\">&lt;xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=fullName&gt;</ph> property of the child even if it is a detached child task.","pos":[2729,3091],"source":"If the child task is represented by a <xref:System.Threading.Tasks.Task%601> object rather than a <xref:System.Threading.Tasks.Task> object, you can ensure that the parent task will wait for the child to complete by accessing the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=fullName> property of the child even if it is a detached child task."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Task%601.Result%2A&gt;</ph> property blocks until its task completes, as the following example shows.","pos":[3092,3218],"source":" The <xref:System.Threading.Tasks.Task%601.Result%2A> property blocks until its task completes, as the following example shows."},{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPL_ChildTasks#4<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/childtasks.cs#4)</ept><ept id=\"p1\">]</ept>","pos":[3225,3342],"source":"[!code-csharp[TPL_ChildTasks#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/childtasks.cs#4)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>TPL_ChildTasks#4<ept id=\"p2\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/tpl_childtasks.vb#4)</ept><ept id=\"p1\">]</ept>","pos":[3344,3466],"source":"[!code-vb[TPL_ChildTasks#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/tpl_childtasks.vb#4)]"},{"pos":[3475,3495],"content":"Attached child tasks","linkify":"Attached child tasks","nodes":[{"content":"Attached child tasks","pos":[0,20]}]},{"content":"Unlike detached child tasks, attached child tasks are closely synchronized with the parent.","pos":[3499,3590]},{"content":"You can change the detached child task in the previous example to an attached child task by using the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName&gt;</ph> option in the task creation statement, as shown in the following example.","pos":[3591,3841],"source":" You can change the detached child task in the previous example to an attached child task by using the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName> option in the task creation statement, as shown in the following example."},{"content":"In this code, the attached child task completes before its parent.","pos":[3842,3908]},{"content":"As a result, the output from the example is the same each time you run the code.","pos":[3909,3989]},{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPL_ChildTasks#2<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/child1.cs#2)</ept><ept id=\"p1\">]</ept>","pos":[3996,4109],"source":"[!code-csharp[TPL_ChildTasks#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/child1.cs#2)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>TPL_ChildTasks#2<ept id=\"p2\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/child1.vb#2)</ept><ept id=\"p1\">]</ept>","pos":[4111,4225],"source":"[!code-vb[TPL_ChildTasks#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/child1.vb#2)]"},{"content":"You can use attached child tasks to create tightly synchronized graphs of asynchronous operations.","pos":[4232,4330]},{"content":"However, a child task can attach to its parent only if its parent does not prohibit attached child tasks.","pos":[4337,4442]},{"content":"Parent tasks can explicitly prevent child tasks from attaching to them by specifying the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName&gt;</ph> option in the parent task's class constructor or the <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=fullName&gt;</ph> method.","pos":[4443,4746],"source":" Parent tasks can explicitly prevent child tasks from attaching to them by specifying the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName> option in the parent task's class constructor or the <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=fullName> method."},{"content":"Parent tasks implicitly prevent child tasks from attaching to them if they are created by calling the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Task.Run%2A?displayProperty=fullName&gt;</ph> method.","pos":[4747,4923],"source":" Parent tasks implicitly prevent child tasks from attaching to them if they are created by calling the <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=fullName> method."},{"content":"The following example illustrates this.","pos":[4924,4963]},{"content":"It is identical to the previous example, except that the parent task is created by calling the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Task.Run%28System.Action%29?displayProperty=fullName&gt;</ph> method rather than the <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.TaskFactory.StartNew%28System.Action%29?displayProperty=fullName&gt;</ph> method.","pos":[4964,5267],"source":" It is identical to the previous example, except that the parent task is created by calling the <xref:System.Threading.Tasks.Task.Run%28System.Action%29?displayProperty=fullName> method rather than the <xref:System.Threading.Tasks.TaskFactory.StartNew%28System.Action%29?displayProperty=fullName> method."},{"content":"Because the child task is not able to attach to its parent, the output from the example is unpredictable.","pos":[5268,5373]},{"content":"Because the default task creation options for the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Task.Run%2A?displayProperty=fullName&gt;</ph> overloads include <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName&gt;</ph>, this example is functionally equivalent to the first example in the \"Detached child tasks\" section.","pos":[5374,5684],"source":" Because the default task creation options for the <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=fullName> overloads include <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName>, this example is functionally equivalent to the first example in the \"Detached child tasks\" section."},{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPL_ChildTasks#3<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/child1a.cs#3)</ept><ept id=\"p1\">]</ept>","pos":[5691,5805],"source":"[!code-csharp[TPL_ChildTasks#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_childtasks/cs/child1a.cs#3)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>TPL_ChildTasks#3<ept id=\"p2\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/child1a.vb#3)</ept><ept id=\"p1\">]</ept>","pos":[5807,5922],"source":"[!code-vb[TPL_ChildTasks#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_childtasks/vb/child1a.vb#3)]"},{"pos":[5931,5956],"content":"Exceptions in child tasks","linkify":"Exceptions in child tasks","nodes":[{"content":"Exceptions in child tasks","pos":[0,25]}]},{"content":"If a detached child task throws an exception, that exception must be observed or handled directly in the parent task just as with any non-nested task.","pos":[5960,6110]},{"content":"If an attached child task throws an exception, the exception is automatically propagated to the parent task and back to the thread that waits or tries to access the task's <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=fullName&gt;</ph> property.","pos":[6111,6366],"source":" If an attached child task throws an exception, the exception is automatically propagated to the parent task and back to the thread that waits or tries to access the task's <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=fullName> property."},{"content":"Therefore, by using attached child tasks, you can handle all exceptions at just one point in the call to <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=fullName&gt;</ph> on the calling thread.","pos":[6367,6562],"source":" Therefore, by using attached child tasks, you can handle all exceptions at just one point in the call to <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=fullName> on the calling thread."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Exception Handling<ept id=\"p1\">](../../../docs/standard/parallel-programming/exception-handling-task-parallel-library.md)</ept>.","pos":[6563,6699],"source":" For more information, see [Exception Handling](../../../docs/standard/parallel-programming/exception-handling-task-parallel-library.md)."},{"pos":[6708,6736],"content":"Cancellation and child tasks","linkify":"Cancellation and child tasks","nodes":[{"content":"Cancellation and child tasks","pos":[0,28]}]},{"content":"Task cancellation is cooperative.","pos":[6740,6773]},{"content":"That is, to be cancelable, every attached or detached child task must monitor the status of the cancellation token.","pos":[6774,6889]},{"content":"If you want to cancel a parent and all its children by using one cancellation request, you pass the same token as an argument to all tasks and provide in each task the logic to respond to the request in each task.","pos":[6890,7103]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Task Cancellation<ept id=\"p1\">](../../../docs/standard/parallel-programming/task-cancellation.md)</ept> and <bpt id=\"p2\">[</bpt>How to: Cancel a Task and Its Children<ept id=\"p2\">](../../../docs/standard/parallel-programming/how-to-cancel-a-task-and-its-children.md)</ept>.","pos":[7104,7347],"source":" For more information, see [Task Cancellation](../../../docs/standard/parallel-programming/task-cancellation.md) and [How to: Cancel a Task and Its Children](../../../docs/standard/parallel-programming/how-to-cancel-a-task-and-its-children.md)."},{"pos":[7357,7380],"content":"When the parent cancels","linkify":"When the parent cancels","nodes":[{"content":"When the parent cancels","pos":[0,23]}]},{"content":"If a parent cancels itself before its child task is started, the child never starts.","pos":[7384,7468]},{"content":"If a parent cancels itself after its child task has already started, the child runs to completion unless it has its own cancellation logic.","pos":[7469,7608]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Task Cancellation<ept id=\"p1\">](../../../docs/standard/parallel-programming/task-cancellation.md)</ept>.","pos":[7609,7721],"source":" For more information, see [Task Cancellation](../../../docs/standard/parallel-programming/task-cancellation.md)."},{"pos":[7731,7765],"content":"When a detached child task cancels","linkify":"When a detached child task cancels","nodes":[{"content":"When a detached child task cancels","pos":[0,34]}]},{"content":"If a detached child task cancels itself by using the same token that was passed to the parent, and the parent does not wait for the child task, no exception is propagated, because the exception is treated as benign cooperation cancellation.","pos":[7769,8009]},{"content":"This behavior is the same as that of any top-level task.","pos":[8010,8066]},{"pos":[8076,8111],"content":"When an attached child task cancels","linkify":"When an attached child task cancels","nodes":[{"content":"When an attached child task cancels","pos":[0,35]}]},{"content":"When an attached child task cancels itself by using the same token that was passed to its parent task, a <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.TaskCanceledException&gt;</ph> is propagated to the joining thread inside an <ph id=\"ph2\">&lt;xref:System.AggregateException&gt;</ph>.","pos":[8115,8351],"source":"When an attached child task cancels itself by using the same token that was passed to its parent task, a <xref:System.Threading.Tasks.TaskCanceledException> is propagated to the joining thread inside an <xref:System.AggregateException>."},{"content":"You must wait for the parent task so that you can handle all benign exceptions in addition to all faulting exceptions that are propagated up through a graph of attached child tasks.","pos":[8352,8533]},{"pos":[8540,8676],"content":"For more information, see <bpt id=\"p1\">[</bpt>Exception Handling<ept id=\"p1\">](../../../docs/standard/parallel-programming/exception-handling-task-parallel-library.md)</ept>.","source":"For more information, see [Exception Handling](../../../docs/standard/parallel-programming/exception-handling-task-parallel-library.md)."},{"pos":[8685,8737],"content":"Preventing a child task from attaching to its parent","linkify":"Preventing a child task from attaching to its parent","nodes":[{"content":"Preventing a child task from attaching to its parent","pos":[0,52]}]},{"content":"An unhandled exception that is thrown by a child task is propagated to the parent task.","pos":[8741,8828]},{"content":"You can use this behavior to observe all child task exceptions from one root task instead of traversing a tree of tasks.","pos":[8829,8949]},{"content":"However, exception propagation can be problematic when a parent task does not expect attachment from other code.","pos":[8950,9062]},{"content":"For example, consider an app that calls a third-party library component from a <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Task&gt;</ph> object.","pos":[9063,9184],"source":" For example, consider an app that calls a third-party library component from a <xref:System.Threading.Tasks.Task> object."},{"content":"If the third-party library component also creates a <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Task&gt;</ph> object and specifies <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName&gt;</ph> to attach it to the parent task, any unhandled exceptions that occur in the child task propagate to the parent.","pos":[9185,9479],"source":" If the third-party library component also creates a <xref:System.Threading.Tasks.Task> object and specifies <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName> to attach it to the parent task, any unhandled exceptions that occur in the child task propagate to the parent."},{"content":"This could lead to unexpected behavior in the main app.","pos":[9480,9535]},{"content":"To prevent a child task from attaching to its parent task, specify the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName&gt;</ph> option when you create the parent <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Task&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.Threading.Tasks.Task%601&gt;</ph> object.","pos":[9542,9806],"source":"To prevent a child task from attaching to its parent task, specify the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName> option when you create the parent <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> object."},{"content":"When a task tries to attach to its parent and the parent specifies the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName&gt;</ph> option, the child task will not be able to attach to a parent and will execute just as if the <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName&gt;</ph> option was not specified.","pos":[9807,10147],"source":" When a task tries to attach to its parent and the parent specifies the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName> option, the child task will not be able to attach to a parent and will execute just as if the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=fullName> option was not specified."},{"content":"You might also want to prevent a child task from attaching to its parent when the child task does not finish in a timely manner.","pos":[10154,10282]},{"content":"Because a parent task does not finish until all child tasks finish, a long-running child task can cause the overall app to perform poorly.","pos":[10283,10421]},{"content":"For an example that shows how to improve app performance by preventing a task from attaching to its parent task, see <bpt id=\"p1\">[</bpt>How to: Prevent a Child Task from Attaching to its Parent<ept id=\"p1\">](../../../docs/standard/parallel-programming/how-to-prevent-a-child-task-from-attaching-to-its-parent.md)</ept>.","pos":[10422,10704],"source":" For an example that shows how to improve app performance by preventing a task from attaching to its parent task, see [How to: Prevent a Child Task from Attaching to its Parent](../../../docs/standard/parallel-programming/how-to-prevent-a-child-task-from-attaching-to-its-parent.md)."},{"pos":[10713,10721],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Parallel Programming<ept id=\"p1\">](../../../docs/standard/parallel-programming/index.md)</ept><ph id=\"ph1\"> </ph>","pos":[10725,10802],"source":"[Parallel Programming](../../../docs/standard/parallel-programming/index.md) "},{"content":"<bpt id=\"p1\">[</bpt>Data Parallelism<ept id=\"p1\">](../../../docs/standard/parallel-programming/data-parallelism-task-parallel-library.md)</ept>","pos":[10806,10911],"source":"[Data Parallelism](../../../docs/standard/parallel-programming/data-parallelism-task-parallel-library.md)"}]}