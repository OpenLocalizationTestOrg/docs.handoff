{"content":"---\ntitle: \"Discovery Announcements and Announcement Client\"\nms.date: \"03/30/2017\"\nms.assetid: 426c6437-f8d2-4968-b23a-18afd671aa4b\n---\n# Discovery Announcements and Announcement Client\nThe WCF discovery feature enables components to announce their availability. If configured to do so, a service sends Hello and Bye announcements. Clients or other components can listen for such announcement messages and act on them. This provides an alternative method for clients to be aware of services. Announcement functionality has several uses, for example, if the services enter and leave a network frequently, announcements may be a better alternative than searching for services. With this approach, the network traffic is reduced and the client can learn about the presence or departure of the service as soon as announcements are received.  \n  \n## Discovery Announcements  \n When a service configured for announcements joins a network and becomes discoverable, it sends a Hello message announcing its availability to listening clients. The message contains discovery related information about the service, such as its contract, endpoint address and associated scopes. You can specify where the announcement message is sent with the <xref:System.ServiceModel.Discovery.AnnouncementEndpoint> class. If the announcement endpoint is a <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> then the Hello and Bye are multicast appropriately, or if the announcement endpoint is unicast, the messages are sent directly to the specified endpoint.  \n  \n> [!NOTE]\n>  Announcements are sent when the service host opens and closes. If these calls do not finish properly the announcement message may not be sent out. For example if the service faults, then the Bye announcement message is not sent.  \n  \n> [!TIP]\n>  You can customize the announcement functionality, allowing you to send announcements whenever you choose.  \n  \n [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] defines the <xref:System.ServiceModel.Discovery.AnnouncementEndpoint> and <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> as standard endpoints to allow services and clients to easily send Hello and Bye announcements.  \n  \n### Announcements on the Service  \n To configure the service to send announcements, add a <xref:System.ServiceModel.Discovery.ServiceDiscoveryBehavior> with an announcement endpoint. The following example shows how to programmatically add this behavior to the service host. This example uses the `UdpAnnouncementEndpoint`, which implies that the announcements are multicast to a location specified by that standard endpoint.  \n  \n```  \nServiceDiscoveryBehavior serviceDiscoveryBehavior = new ServiceDiscoveryBehavior();\nserviceDiscoveryBehavior.AnnouncementEndpoints.Add(new UdpAnnouncementEndpoint());\nserviceHost.Description.Behaviors.Add(serviceDiscoveryBehavior);\n```  \n  \n The behavior can be configured in the configuration file as well, as shown in the following example.  \n  \n```xml  \n<services>\n  <service behaviorConfiguration=\"CalculatorBehavior\" name=\"Microsoft.Samples.Discovery.CalculatorService\">\n    <!--Add Discovery Endpoint-->\n    <endpoint name=\"udpDiscoveryEpt\" kind=\"udpDiscoveryEndpoint\" />\n  </service>\n</services>\n<behaviors>\n  <serviceBehaviors>\n    <behavior name=\"CalculatorBehavior\">\n      <!--Add Discovery behavior-->\n      <serviceDiscovery>\n        <announcementEndpoints>\n          <endpoint kind=\"udpAnnouncementEndpoint\" />\n        </announcementEndpoints>\n      </serviceDiscovery>\n    </behavior>\n  </serviceBehaviors>\n</behaviors>  \n```  \n  \n The preceding examples configure a service to automatically send announcement messages. You can also send announcement messages explicitly by using the <xref:System.ServiceModel.Discovery.AnnouncementClient> class.  \n  \n### Announcements on the Client  \n A client application must host an announcement service to respond to the Hello and Bye messages and subscribe to the <xref:System.ServiceModel.Discovery.AnnouncementService.OnlineAnnouncementReceived> and <xref:System.ServiceModel.Discovery.AnnouncementService.OfflineAnnouncementReceived> events. The following example shows how to do this.  \n  \n```  \n// Create an AnnouncementService instance\nAnnouncementService announcementService = new AnnouncementService();\n  \n// Subscribe the announcement events\nannouncementService.OnlineAnnouncementReceived += OnOnlineEvent;\nannouncementService.OfflineAnnouncementReceived += OnOfflineEvent;\n  \n// Create ServiceHost for the AnnouncementService\nusing (ServiceHost announcementServiceHost = new ServiceHost(announcementService))\n{  \n    // Listen for the announcements sent over UDP multicast\n    announcementServiceHost.AddServiceEndpoint(new UdpAnnouncementEndpoint());\n    announcementServiceHost.Open();\n  \n    Console.WriteLine(\"Press <ENTER> to terminate.\");\n    Console.ReadLine();\n}  \n```  \n  \n When a Hello or Bye message is received, you can access the endpoint discovery metadata through <xref:System.ServiceModel.Discovery.AnnouncementEventArgs> as shown in the following example.  \n  \n```  \nstatic void OnOnlineEvent(object sender, AnnouncementEventArgs e)\n{\n    Console.WriteLine(\"Received an online announcement from {0}\", \ne.EndpointDiscoveryMetadata.Address);\n}\n\nstatic void OnOfflineEvent(object sender, AnnouncementEventArgs e)\n{\n    Console.WriteLine(\"Received an offline announcement from {0}\", \ne.EndpointDiscoveryMetadata.Address);\n}\n```\n","nodes":[{"pos":[4,131],"embed":true,"restype":"x-metadata","content":"title: \"Discovery Announcements and Announcement Client\"\nms.date: \"03/30/2017\"\nms.assetid: 426c6437-f8d2-4968-b23a-18afd671aa4b","nodes":[{"content":"Discovery Announcements and Announcement Client","nodes":[{"pos":[0,47],"content":"Discovery Announcements and Announcement Client","nodes":[{"content":"Discovery Announcements and Announcement Client","pos":[0,47]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[138,185],"content":"Discovery Announcements and Announcement Client","linkify":"Discovery Announcements and Announcement Client","nodes":[{"content":"Discovery Announcements and Announcement Client","pos":[0,47]}]},{"content":"The WCF discovery feature enables components to announce their availability.","pos":[186,262]},{"content":"If configured to do so, a service sends Hello and Bye announcements.","pos":[263,331]},{"content":"Clients or other components can listen for such announcement messages and act on them.","pos":[332,418]},{"content":"This provides an alternative method for clients to be aware of services.","pos":[419,491]},{"content":"Announcement functionality has several uses, for example, if the services enter and leave a network frequently, announcements may be a better alternative than searching for services.","pos":[492,674]},{"content":"With this approach, the network traffic is reduced and the client can learn about the presence or departure of the service as soon as announcements are received.","pos":[675,836]},{"pos":[845,868],"content":"Discovery Announcements","linkify":"Discovery Announcements","nodes":[{"content":"Discovery Announcements","pos":[0,23]}]},{"content":"When a service configured for announcements joins a network and becomes discoverable, it sends a Hello message announcing its availability to listening clients.","pos":[872,1032]},{"content":"The message contains discovery related information about the service, such as its contract, endpoint address and associated scopes.","pos":[1033,1164]},{"content":"You can specify where the announcement message is sent with the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.AnnouncementEndpoint&gt;</ph> class.","pos":[1165,1293],"source":" You can specify where the announcement message is sent with the <xref:System.ServiceModel.Discovery.AnnouncementEndpoint> class."},{"content":"If the announcement endpoint is a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint&gt;</ph> then the Hello and Bye are multicast appropriately, or if the announcement endpoint is unicast, the messages are sent directly to the specified endpoint.","pos":[1294,1542],"source":" If the announcement endpoint is a <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> then the Hello and Bye are multicast appropriately, or if the announcement endpoint is unicast, the messages are sent directly to the specified endpoint."},{"pos":[1550,1789],"content":"[!NOTE]\n Announcements are sent when the service host opens and closes. If these calls do not finish properly the announcement message may not be sent out. For example if the service faults, then the Bye announcement message is not sent.","leadings":["","> "],"nodes":[{"content":"Announcements are sent when the service host opens and closes. If these calls do not finish properly the announcement message may not be sent out. For example if the service faults, then the Bye announcement message is not sent.","pos":[9,237],"nodes":[{"content":"Announcements are sent when the service host opens and closes.","pos":[0,62]},{"content":"If these calls do not finish properly the announcement message may not be sent out. For example if the service faults, then the Bye announcement message is not sent.","pos":[63,228]}]}]},{"pos":[1797,1912],"content":"[!TIP]\n You can customize the announcement functionality, allowing you to send announcements whenever you choose.","leadings":["","> "],"nodes":[{"content":"You can customize the announcement functionality, allowing you to send announcements whenever you choose.","pos":[8,113]}]},{"pos":[1919,2227],"content":"<ph id=\"ph1\">[!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)]</ph> defines the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Discovery.AnnouncementEndpoint&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint&gt;</ph> as standard endpoints to allow services and clients to easily send Hello and Bye announcements.","source":"[!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] defines the <xref:System.ServiceModel.Discovery.AnnouncementEndpoint> and <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> as standard endpoints to allow services and clients to easily send Hello and Bye announcements."},{"pos":[2237,2265],"content":"Announcements on the Service","linkify":"Announcements on the Service","nodes":[{"content":"Announcements on the Service","pos":[0,28]}]},{"content":"To configure the service to send announcements, add a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.ServiceDiscoveryBehavior&gt;</ph> with an announcement endpoint.","pos":[2269,2415],"source":"To configure the service to send announcements, add a <xref:System.ServiceModel.Discovery.ServiceDiscoveryBehavior> with an announcement endpoint."},{"content":"The following example shows how to programmatically add this behavior to the service host.","pos":[2416,2506]},{"content":"This example uses the <ph id=\"ph1\">`UdpAnnouncementEndpoint`</ph>, which implies that the announcements are multicast to a location specified by that standard endpoint.","pos":[2507,2657],"source":" This example uses the `UdpAnnouncementEndpoint`, which implies that the announcements are multicast to a location specified by that standard endpoint."},{"content":"The behavior can be configured in the configuration file as well, as shown in the following example.","pos":[2911,3011]},{"content":"The preceding examples configure a service to automatically send announcement messages.","pos":[3615,3702]},{"content":"You can also send announcement messages explicitly by using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.AnnouncementClient&gt;</ph> class.","pos":[3703,3829],"source":" You can also send announcement messages explicitly by using the <xref:System.ServiceModel.Discovery.AnnouncementClient> class."},{"pos":[3839,3866],"content":"Announcements on the Client","linkify":"Announcements on the Client","nodes":[{"content":"Announcements on the Client","pos":[0,27]}]},{"content":"A client application must host an announcement service to respond to the Hello and Bye messages and subscribe to the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.AnnouncementService.OnlineAnnouncementReceived&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Discovery.AnnouncementService.OfflineAnnouncementReceived&gt;</ph> events.","pos":[3870,4167],"source":"A client application must host an announcement service to respond to the Hello and Bye messages and subscribe to the <xref:System.ServiceModel.Discovery.AnnouncementService.OnlineAnnouncementReceived> and <xref:System.ServiceModel.Discovery.AnnouncementService.OfflineAnnouncementReceived> events."},{"content":"The following example shows how to do this.","pos":[4168,4211]},{"pos":[4916,5105],"content":"When a Hello or Bye message is received, you can access the endpoint discovery metadata through <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.AnnouncementEventArgs&gt;</ph> as shown in the following example.","source":"When a Hello or Bye message is received, you can access the endpoint discovery metadata through <xref:System.ServiceModel.Discovery.AnnouncementEventArgs> as shown in the following example."}]}