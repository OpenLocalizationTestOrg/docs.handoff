{"content":"---\ntitle: \"How to: Combine LINQ Queries with Regular Expressions (Visual Basic) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"2015-07-20\"\nms.prod: .net\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-visual-basic\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\nms.assetid: 3da1bd10-b0d8-4d5b-a637-966891c13592\ncaps.latest.revision: 3\nauthor: dotnet-bot\nms.author: dotnetcontent\n\ntranslation.priority.mt: \n  - \"cs-cz\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"tr-tr\"\n---\n# How to: Combine LINQ Queries with Regular Expressions (Visual Basic)\nThis example shows how to use the <xref:System.Text.RegularExpressions.Regex> class to create a regular expression for more complex matching in text strings. The LINQ query makes it easy to filter on exactly the files that you want to search with the regular expression, and to shape the results.  \n  \n## Example  \n  \n```vb  \nClass LinqRegExVB  \n  \n    Shared Sub Main()  \n  \n        ' Root folder to query, along with all subfolders.  \n        ' Modify this path as necessary so that it accesses your Visual Studio folder.  \n        Dim startFolder As String = \"C:\\program files\\Microsoft Visual Studio 9.0\\\"  \n        ' One of the following paths may be more appropriate on your computer.  \n        'string startFolder = @\"c:\\program files (x86)\\Microsoft Visual Studio 9.0\\\";  \n        'string startFolder = @\"c:\\program files\\Microsoft Visual Studio 10.0\\\";  \n        'string startFolder = @\"c:\\program files (x86)\\Microsoft Visual Studio 10.0\\\";  \n  \n        ' Take a snapshot of the file system.  \n        Dim fileList As IEnumerable(Of System.IO.FileInfo) = GetFiles(startFolder)  \n  \n        ' Create a regular expression to find all things \"Visual\".  \n        Dim searchTerm As System.Text.RegularExpressions.Regex =   \n            New System.Text.RegularExpressions.Regex(\"Visual (Basic|C#|C\\+\\+|J#|SourceSafe|Studio)\")  \n  \n        ' Search the contents of each .htm file.  \n        ' Remove the where clause to find even more matches!  \n        ' This query produces a list of files where a match  \n        ' was found, and a list of the matches in that file.  \n        ' Note: Explicit typing of \"Match\" in select clause.  \n        ' This is required because MatchCollection is not a   \n        ' generic IEnumerable collection.  \n        Dim queryMatchingFiles = From afile In fileList  \n                                Where afile.Extension = \".htm\"  \n                                Let fileText = System.IO.File.ReadAllText(afile.FullName)  \n                                Let matches = searchTerm.Matches(fileText)  \n                                Where (matches.Count > 0)  \n                                Select Name = afile.FullName,  \n                                       Matches = From match As System.Text.RegularExpressions.Match In matches  \n                                                 Select match.Value  \n  \n        ' Execute the query.  \n        Console.WriteLine(\"The term \" & searchTerm.ToString() & \" was found in:\")  \n  \n        For Each fileMatches In queryMatchingFiles  \n            ' Trim the path a bit, then write   \n            ' the file name in which a match was found.  \n            Dim s = fileMatches.Name.Substring(startFolder.Length - 1)  \n            Console.WriteLine(s)  \n  \n            ' For this file, write out all the matching strings  \n            For Each match In fileMatches.Matches  \n                Console.WriteLine(\"  \" + match)  \n            Next  \n        Next  \n  \n        ' Keep the console window open in debug mode  \n        Console.WriteLine(\"Press any key to exit\")  \n        Console.ReadKey()  \n    End Sub  \n  \n    ' Function to retrieve a list of files. Note that this is a copy  \n    ' of the file information.  \n    Shared Function GetFiles(ByVal root As String) As IEnumerable(Of System.IO.FileInfo)  \n        Return From file In My.Computer.FileSystem.GetFiles(  \n                   root, FileIO.SearchOption.SearchAllSubDirectories, \"*.*\")   \n               Select New System.IO.FileInfo(file)  \n    End Function  \n  \nEnd Class  \n```  \n  \n Note that you can also query the <xref:System.Text.RegularExpressions.MatchCollection> object that is returned by a `RegEx` search. In this example only the value of each match is produced in the results. However, it is also possible to use LINQ to perform all kinds of filtering, sorting, and grouping on that collection. Because <xref:System.Text.RegularExpressions.MatchCollection> is a non-generic <xref:System.Collections.IEnumerable> collection, you have to explicitly state the type of the range variable in the query.  \n  \n## Compiling the Code  \n Create a project that targets the .NET Framework version 3.5 or higher with a reference to System.Core.dll and a `Imports` statement for the System.Linq namespace.  \n  \n## See Also  \n [LINQ and Strings (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/linq-and-strings.md)   \n [LINQ and File Directories (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/linq-and-file-directories.md)","nodes":[{"pos":[12,97],"content":"How to: Combine LINQ Queries with Regular Expressions (Visual Basic) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"How to: Combine LINQ Queries with Regular Expressions (Visual Basic) | Microsoft Docs","pos":[0,85]}]},{"pos":[478,546],"content":"How to: Combine LINQ Queries with Regular Expressions (Visual Basic)","linkify":"How to: Combine LINQ Queries with Regular Expressions (Visual Basic)","nodes":[{"content":"How to: Combine LINQ Queries with Regular Expressions (Visual Basic)","pos":[0,68]}]},{"content":"This example shows how to use the <ph id=\"ph1\">&lt;xref:System.Text.RegularExpressions.Regex&gt;</ph> class to create a regular expression for more complex matching in text strings.","pos":[547,704],"source":"This example shows how to use the <xref:System.Text.RegularExpressions.Regex> class to create a regular expression for more complex matching in text strings."},{"content":"The LINQ query makes it easy to filter on exactly the files that you want to search with the regular expression, and to shape the results.","pos":[705,843]},{"pos":[852,859],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"Note that you can also query the <ph id=\"ph1\">&lt;xref:System.Text.RegularExpressions.MatchCollection&gt;</ph> object that is returned by a <ph id=\"ph2\">`RegEx`</ph> search.","pos":[4075,4206],"source":"Note that you can also query the <xref:System.Text.RegularExpressions.MatchCollection> object that is returned by a `RegEx` search."},{"content":"In this example only the value of each match is produced in the results.","pos":[4207,4279]},{"content":"However, it is also possible to use LINQ to perform all kinds of filtering, sorting, and grouping on that collection.","pos":[4280,4397]},{"content":"Because <ph id=\"ph1\">&lt;xref:System.Text.RegularExpressions.MatchCollection&gt;</ph> is a non-generic <ph id=\"ph2\">&lt;xref:System.Collections.IEnumerable&gt;</ph> collection, you have to explicitly state the type of the range variable in the query.","pos":[4398,4600],"source":" Because <xref:System.Text.RegularExpressions.MatchCollection> is a non-generic <xref:System.Collections.IEnumerable> collection, you have to explicitly state the type of the range variable in the query."},{"pos":[4609,4627],"content":"Compiling the Code","linkify":"Compiling the Code","nodes":[{"content":"Compiling the Code","pos":[0,18]}]},{"pos":[4631,4794],"content":"Create a project that targets the .NET Framework version 3.5 or higher with a reference to System.Core.dll and a <ph id=\"ph1\">`Imports`</ph> statement for the System.Linq namespace.","source":"Create a project that targets the .NET Framework version 3.5 or higher with a reference to System.Core.dll and a `Imports` statement for the System.Linq namespace."},{"pos":[4803,4811],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>LINQ and Strings (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/linq/linq-and-strings.md)</ept><ph id=\"ph1\"> </ph>","pos":[4815,4927],"source":"[LINQ and Strings (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/linq-and-strings.md) "},{"content":"<bpt id=\"p1\"> [</bpt>LINQ and File Directories (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/linq/linq-and-file-directories.md)</ept>","pos":[4930,5060],"source":" [LINQ and File Directories (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/linq-and-file-directories.md)"}]}