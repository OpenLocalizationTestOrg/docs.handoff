{"content":"---\ntitle: \"Advanced Policy | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 75a22c88-5e54-4ae8-84cb-fbb22a612f0a\ncaps.latest.revision: 9\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Advanced Policy\nThis sample extends the Simple Policy sample. In addition to the residential discount and business discount rules from the Simple Policy example, several new rules have been added.  \n  \n A high-value rule is added, which provides a bigger discount for high-value orders. It is given a priority value less than the previous two rules so that it will overwrite the discount field and take precedence over both the residential and business discount rules.  \n  \n A calculate total rule is also added, which computes the total based on the discount level. It shows how to reference a method defined on the workflow activity, as well as how to use else actions. This rule also demonstrates chaining behavior since it will be evaluated anytime the discount field changes. Furthermore, method attributing is shown with the RuleWriteAttribute on the CalculateTotal method. This causes impacted rules (ErrorTotalRule) to be re-evaluated whenever the method gets executed.  \n  \n The last rule added is one that detects errors (in this case, Total less than 0). If this occurs, the policy execution is halted.  \n  \n Finally, `Console.Writeline` calls are added as actions to each rule to provide more visibility into rule execution, while also showing that it is possible to access static methods on referenced types. You could also use tracking to get visibility into the rules that are executed.  \n  \n The rules used in this sample are:  \n  \n **ResidentialDiscountRule:**  \n  \n IF OrderValue > 500 AND CustomerType = Residential  \n  \n THEN Discount = 5%  \n  \n **BusinessDiscountRule:**  \n  \n IF OrderValue > 10000 AND CustomerType = Business  \n  \n THEN Discount = 10%  \n  \n **HighValueDiscountRule:**  \n  \n IF OrderValue > 20000  \n  \n THEN Discount = 15%  \n  \n **TotalRule:**  \n  \n IF Discount > 0  \n  \n THEN CalculateTotal(OrderValue, Discount)  \n  \n ELSE Total = OrderValue  \n  \n **ErrorTotalRule:**  \n  \n IF Total \\< 0  \n  \n THEN Error = \"Fired ErrorTotalRule\"; Halt  \n  \n Rule evaluation and execution can also be seen through tracing and tracking.  \n  \n### To build the sample  \n  \n1.  Open the solution in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].  \n  \n2.  Build the solution by pressing CTRL+SHIFT+B.  \n  \n3.  Run the solution without debugging by pressing CTRL+F5.  \n  \n### To run the sample  \n  \n-   In the SDK Command Prompt window, run the .exe file in the AdvancedPolicy\\bin\\debug folder (or the AdvancedPolicy \\bin folder for the Visual Basic version of the sample), which is located below the main folder for the sample.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your computer. Check for the following (default) directory before continuing:  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory:  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Basic\\Rules\\Policy\\AdvancedPolicy`  \n  \n## See Also  \n <xref:System.Workflow.Activities.Rules.RuleSet>   \n <xref:System.Workflow.Activities.PolicyActivity>   \n [Simple Policy](../../../../docs/framework/windows-workflow-foundation/samples/simple-policy.md)","nodes":[{"pos":[12,44],"content":"Advanced Policy | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Advanced Policy | Microsoft Docs","pos":[0,32]}]},{"pos":[309,324],"content":"Advanced Policy","linkify":"Advanced Policy","nodes":[{"content":"Advanced Policy","pos":[0,15]}]},{"content":"This sample extends the Simple Policy sample.","pos":[325,370]},{"content":"In addition to the residential discount and business discount rules from the Simple Policy example, several new rules have been added.","pos":[371,505]},{"content":"A high-value rule is added, which provides a bigger discount for high-value orders.","pos":[512,595]},{"content":"It is given a priority value less than the previous two rules so that it will overwrite the discount field and take precedence over both the residential and business discount rules.","pos":[596,777]},{"content":"A calculate total rule is also added, which computes the total based on the discount level.","pos":[784,875]},{"content":"It shows how to reference a method defined on the workflow activity, as well as how to use else actions.","pos":[876,980]},{"content":"This rule also demonstrates chaining behavior since it will be evaluated anytime the discount field changes.","pos":[981,1089]},{"content":"Furthermore, method attributing is shown with the RuleWriteAttribute on the CalculateTotal method.","pos":[1090,1188]},{"content":"This causes impacted rules (ErrorTotalRule) to be re-evaluated whenever the method gets executed.","pos":[1189,1286]},{"content":"The last rule added is one that detects errors (in this case, Total less than 0).","pos":[1293,1374]},{"content":"If this occurs, the policy execution is halted.","pos":[1375,1422]},{"content":"Finally, <ph id=\"ph1\">`Console.Writeline`</ph> calls are added as actions to each rule to provide more visibility into rule execution, while also showing that it is possible to access static methods on referenced types.","pos":[1429,1630],"source":"Finally, `Console.Writeline` calls are added as actions to each rule to provide more visibility into rule execution, while also showing that it is possible to access static methods on referenced types."},{"content":"You could also use tracking to get visibility into the rules that are executed.","pos":[1631,1710]},{"content":"The rules used in this sample are:","pos":[1717,1751]},{"pos":[1758,1786],"content":"<bpt id=\"p1\">**</bpt>ResidentialDiscountRule:<ept id=\"p1\">**</ept>","source":"**ResidentialDiscountRule:**"},{"content":"IF OrderValue &gt; 500 AND CustomerType = Residential","pos":[1793,1843],"source":"IF OrderValue > 500 AND CustomerType = Residential"},{"content":"THEN Discount = 5%","pos":[1850,1868]},{"pos":[1875,1900],"content":"<bpt id=\"p1\">**</bpt>BusinessDiscountRule:<ept id=\"p1\">**</ept>","source":"**BusinessDiscountRule:**"},{"content":"IF OrderValue &gt; 10000 AND CustomerType = Business","pos":[1907,1956],"source":"IF OrderValue > 10000 AND CustomerType = Business"},{"content":"THEN Discount = 10%","pos":[1963,1982]},{"pos":[1989,2015],"content":"<bpt id=\"p1\">**</bpt>HighValueDiscountRule:<ept id=\"p1\">**</ept>","source":"**HighValueDiscountRule:**"},{"content":"IF OrderValue &gt; 20000","pos":[2022,2043],"source":"IF OrderValue > 20000"},{"content":"THEN Discount = 15%","pos":[2050,2069]},{"pos":[2076,2090],"content":"<bpt id=\"p1\">**</bpt>TotalRule:<ept id=\"p1\">**</ept>","source":"**TotalRule:**"},{"content":"IF Discount &gt; 0","pos":[2097,2112],"source":"IF Discount > 0"},{"content":"THEN CalculateTotal(OrderValue, Discount)","pos":[2119,2160]},{"content":"ELSE Total = OrderValue","pos":[2167,2190]},{"pos":[2197,2216],"content":"<bpt id=\"p1\">**</bpt>ErrorTotalRule:<ept id=\"p1\">**</ept>","source":"**ErrorTotalRule:**"},{"content":"IF Total <ph id=\"ph1\">\\&lt;</ph> 0","pos":[2223,2236],"source":"IF Total \\< 0"},{"content":"THEN Error = \"Fired ErrorTotalRule\"; Halt","pos":[2243,2284]},{"content":"Rule evaluation and execution can also be seen through tracing and tracking.","pos":[2291,2367]},{"pos":[2377,2396],"content":"To build the sample","linkify":"To build the sample","nodes":[{"content":"To build the sample","pos":[0,19]}]},{"pos":[2406,2481],"content":"Open the solution in <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph>.","source":"Open the solution in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]."},{"content":"Build the solution by pressing CTRL+SHIFT+B.","pos":[2491,2535]},{"content":"Run the solution without debugging by pressing CTRL+F5.","pos":[2545,2600]},{"pos":[2610,2627],"content":"To run the sample","linkify":"To run the sample","nodes":[{"content":"To run the sample","pos":[0,17]}]},{"content":"In the SDK Command Prompt window, run the .exe file in the AdvancedPolicy\\bin\\debug folder (or the AdvancedPolicy \\bin folder for the Visual Basic version of the sample), which is located below the main folder for the sample.","pos":[2637,2862]},{"pos":[2870,3003],"content":"[!IMPORTANT]\n The samples may already be installed on your computer. Check for the following (default) directory before continuing:","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your computer. Check for the following (default) directory before continuing:","pos":[13,131],"nodes":[{"content":"The samples may already be installed on your computer.","pos":[1,55]},{"content":"Check for the following (default) directory before continuing:","pos":[56,118]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[3057,3383],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory:","pos":[3384,3434]},{"pos":[3523,3531],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.Workflow.Activities.Rules.RuleSet&gt;</ph>","pos":[3535,3582],"source":"<xref:System.Workflow.Activities.Rules.RuleSet> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Workflow.Activities.PolicyActivity&gt;</ph>","pos":[3587,3635],"source":" <xref:System.Workflow.Activities.PolicyActivity> "},{"content":"<bpt id=\"p1\"> [</bpt>Simple Policy<ept id=\"p1\">](../../../../docs/framework/windows-workflow-foundation/samples/simple-policy.md)</ept>","pos":[3639,3736],"source":" [Simple Policy](../../../../docs/framework/windows-workflow-foundation/samples/simple-policy.md)"}]}