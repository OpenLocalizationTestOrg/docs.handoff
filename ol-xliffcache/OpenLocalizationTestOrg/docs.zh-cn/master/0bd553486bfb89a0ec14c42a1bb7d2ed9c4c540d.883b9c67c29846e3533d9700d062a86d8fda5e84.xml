{"content":"---\ntitle: \"Best Practices: Intermediaries\"\nms.date: \"03/30/2017\"\nms.assetid: 2d41b337-8132-4ac2-bea2-6e9ae2f00f8d\n---\n# Best Practices: Intermediaries\nCare must be taken to handle faults correctly when calling intermediaries to make sure service side channels on the intermediary are closed properly.  \n  \n Consider the following scenario. A client makes a call to an intermediary which then calls a back-end service.  The back-end service defines no fault contract, so any fault thrown from that service will be treated as an un-typed fault.  The back-end service throws an <xref:System.ApplicationException> and WCF correctly aborts the service-side channel. The <xref:System.ApplicationException> then surfaces as a <xref:System.ServiceModel.FaultException> that is thrown to the intermediary. The intermediary re-throws the <xref:System.ApplicationException>. WCF interprets this as an un-typed fault from the intermediary and forwards it on to the client. Upon receiving the fault, both the intermediary and the client fault their client-side channels. The intermediary’s service-side channel however remains open because WCF doesn’t know the fault is fatal.  \n  \n The best practice in this scenario is to detect if the fault coming from the service is fatal and if so the intermediary should fault its service-side channel as shown in the following code snippet.  \n  \n```csharp  \ncatch (Exception e)  \n{  \n    bool faulted = service.State == CommunicationState.Faulted;  \n    service.Abort();  \n    if (faulted)  \n    {  \n        throw new ApplicationException(e.Message);  \n    }  \n    else  \n    {  \n        throw;  \n    }  \n}  \n```  \n  \n## See also\n\n- [WCF Error Handling](../../../docs/framework/wcf/wcf-error-handling.md)\n- [Specifying and Handling Faults in Contracts and Services](../../../docs/framework/wcf/specifying-and-handling-faults-in-contracts-and-services.md)\n","nodes":[{"pos":[4,114],"embed":true,"restype":"x-metadata","content":"title: \"Best Practices: Intermediaries\"\nms.date: \"03/30/2017\"\nms.assetid: 2d41b337-8132-4ac2-bea2-6e9ae2f00f8d","nodes":[{"content":"Best Practices: Intermediaries","nodes":[{"pos":[0,30],"content":"Best Practices: Intermediaries","nodes":[{"content":"Best Practices: Intermediaries","pos":[0,30]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[121,151],"content":"Best Practices: Intermediaries","linkify":"Best Practices: Intermediaries","nodes":[{"content":"Best Practices: Intermediaries","pos":[0,30]}]},{"content":"Care must be taken to handle faults correctly when calling intermediaries to make sure service side channels on the intermediary are closed properly.","pos":[152,301]},{"content":"Consider the following scenario.","pos":[308,340]},{"content":"A client makes a call to an intermediary which then calls a back-end service.","pos":[341,418]},{"content":"The back-end service defines no fault contract, so any fault thrown from that service will be treated as an un-typed fault.","pos":[420,543]},{"content":"The back-end service throws an <ph id=\"ph1\">&lt;xref:System.ApplicationException&gt;</ph> and WCF correctly aborts the service-side channel.","pos":[545,661],"source":"  The back-end service throws an <xref:System.ApplicationException> and WCF correctly aborts the service-side channel."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ApplicationException&gt;</ph> then surfaces as a <ph id=\"ph2\">&lt;xref:System.ServiceModel.FaultException&gt;</ph> that is thrown to the intermediary.","pos":[662,797],"source":" The <xref:System.ApplicationException> then surfaces as a <xref:System.ServiceModel.FaultException> that is thrown to the intermediary."},{"content":"The intermediary re-throws the <ph id=\"ph1\">&lt;xref:System.ApplicationException&gt;</ph>.","pos":[798,864],"source":" The intermediary re-throws the <xref:System.ApplicationException>."},{"content":"WCF interprets this as an un-typed fault from the intermediary and forwards it on to the client.","pos":[865,961]},{"content":"Upon receiving the fault, both the intermediary and the client fault their client-side channels.","pos":[962,1058]},{"content":"The intermediary’s service-side channel however remains open because WCF doesn’t know the fault is fatal.","pos":[1059,1164]},{"content":"The best practice in this scenario is to detect if the fault coming from the service is fatal and if so the intermediary should fault its service-side channel as shown in the following code snippet.","pos":[1171,1369]},{"pos":[1650,1658],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[1662,1733],"content":"<bpt id=\"p1\">[</bpt>WCF Error Handling<ept id=\"p1\">](../../../docs/framework/wcf/wcf-error-handling.md)</ept>","source":"[WCF Error Handling](../../../docs/framework/wcf/wcf-error-handling.md)"},{"pos":[1736,1883],"content":"<bpt id=\"p1\">[</bpt>Specifying and Handling Faults in Contracts and Services<ept id=\"p1\">](../../../docs/framework/wcf/specifying-and-handling-faults-in-contracts-and-services.md)</ept>","source":"[Specifying and Handling Faults in Contracts and Services](../../../docs/framework/wcf/specifying-and-handling-faults-in-contracts-and-services.md)"}]}