{"content":"---\ntitle: \"&lt;NetFx40_PInvokeStackResilience&gt; Element | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\n  - \"CSharp\"\n  - \"C++\"\n  - \"jsharp\"\nhelpviewer_keywords: \n  - \"<NetFx40_PInvokeStackResilience> element\"\n  - \"NetFx40_PInvokeStackResilience element\"\nms.assetid: 39fb1588-72a4-4479-af74-0605233b68bd\ncaps.latest.revision: 8\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# &lt;NetFx40_PInvokeStackResilience&gt; Element\nSpecifies whether the runtime automatically fixes incorrect platform invoke declarations at run time, at the cost of slower transitions between managed and unmanaged code.  \n  \n \\<configuration>  \n\\<runtime>  \n<NetFx40_PInvokeStackResilience>  \n  \n## Syntax  \n  \n```  \n<NetFx40_PInvokeStackResilience  enabled=\"1|0\"/>  \n```  \n  \n## Attributes and Elements  \n The following sections describe attributes, child elements, and parent elements.  \n  \n### Attributes  \n  \n|Attribute|Description|  \n|---------------|-----------------|  \n|`enabled`|Required attribute.<br /><br /> Specifies whether the runtime detects incorrect platform invoke declarations and automatically fixes the stack at run time on 32-bit platforms.|  \n  \n## enabled Attribute  \n  \n|Value|Description|  \n|-----------|-----------------|  \n|`0`|The runtime uses the faster interop marshaling architecture introduced in the [!INCLUDE[net_v40_long](../../../../../includes/net-v40-long-md.md)], which does not detect and fix incorrect platform invoke declarations. This is the default.|  \n|`1`|The runtime uses slower transitions that detect and fix incorrect platform invoke declarations.|  \n  \n### Child Elements  \n None.  \n  \n### Parent Elements  \n  \n|Element|Description|  \n|-------------|-----------------|  \n|`configuration`|The root element in every configuration file used by the common language runtime and .NET Framework applications.|  \n|`runtime`|Contains information about runtime initialization options.|  \n  \n## Remarks  \n This element enables you to trade faster interop marshaling for run-time resilience against incorrect platform invoke declarations.  \n  \n Starting with the [!INCLUDE[net_v40_short](../../../../../includes/net-v40-short-md.md)], a streamlined interop marshaling architecture provides a significant performance improvement for transitions from managed code to unmanaged code. In earlier versions of the .NET Framework, the marshaling layer detected incorrect platform invoke declarations on 32-bit platforms and automatically fixed the stack. The new marshaling architecture eliminates this step. As a result, transitions are very fast, but an incorrect platform invoke declaration can cause a program failure.  \n  \n To make it easy to detect incorrect declarations during development, the Visual Studio debugging experience has been improved. The [pInvokeStackImbalance](../../../../../docs/framework/debug-trace-profile/pinvokestackimbalance-mda.md) managed debugging assistant (MDA) notifies you of incorrect platform invoke declarations when your application is running with the debugger attached.  \n  \n To address scenarios where your application uses components that you cannot recompile, and that have incorrect platform invoke declarations, you can use the `NetFx40_PInvokeStackResilience` element. Adding this element to your application configuration file with `enabled=\"1\"` opts into a compatibility mode with the behavior of earlier versions of the .NET Framework, at the cost of slower transitions. Assemblies that have been compiled against earlier versions of the .NET Framework are automatically opted into this compatibility mode, and do not need this element.  \n  \n## Configuration File  \n This element can be used only in the application configuration file.  \n  \n## Example  \n The following example shows how to opt into increased resilience against incorrect platform invoke declarations for an application, at the cost of slower transitions between managed and unmanaged code.  \n  \n```  \n<configuration>  \n   <runtime>  \n      <NetFx40_PInvokeStackResilience enabled=\"1\"/>  \n   </runtime>  \n</configuration>  \n```  \n  \n## See Also  \n [Runtime Settings Schema](../../../../../docs/framework/configure-apps/file-schema/runtime/index.md)   \n [Configuration File Schema](../../../../../docs/framework/configure-apps/file-schema/index.md)   \n [pInvokeStackImbalance](../../../../../docs/framework/debug-trace-profile/pinvokestackimbalance-mda.md)","nodes":[{"pos":[4,542],"nodes":[{"content":"&lt;NetFx40_PInvokeStackResilience&gt; Element | Microsoft Docs","nodes":[{"pos":[0,63],"content":"&lt;NetFx40_PInvokeStackResilience&gt; Element | Microsoft Docs","nodes":[{"content":"<ph id=\"ph1\">&amp;lt;</ph>NetFx40_PInvokeStackResilience<ph id=\"ph2\">&amp;gt;</ph> Element | Microsoft Docs","pos":[0,63],"source":"&lt;NetFx40_PInvokeStackResilience&gt; Element | Microsoft Docs"}]}],"pos":[6,72],"yaml":true}],"content":"title: \"&lt;NetFx40_PInvokeStackResilience&gt; Element | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\n  - \"CSharp\"\n  - \"C++\"\n  - \"jsharp\"\nhelpviewer_keywords: \n  - \"<NetFx40_PInvokeStackResilience> element\"\n  - \"NetFx40_PInvokeStackResilience element\"\nms.assetid: 39fb1588-72a4-4479-af74-0605233b68bd\ncaps.latest.revision: 8\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"","yamlblock":true},{"pos":[549,595],"content":"&lt;NetFx40_PInvokeStackResilience&gt; Element","linkify":"&lt;NetFx40_PInvokeStackResilience&gt; Element","nodes":[{"content":"<ph id=\"ph1\">&amp;lt;</ph>NetFx40_PInvokeStackResilience<ph id=\"ph2\">&amp;gt;</ph> Element","pos":[0,46],"source":"&lt;NetFx40_PInvokeStackResilience&gt; Element"}]},{"content":"Specifies whether the runtime automatically fixes incorrect platform invoke declarations at run time, at the cost of slower transitions between managed and unmanaged code.","pos":[596,767]},{"content":"<ph id=\"ph1\">\\&lt;</ph>configuration&gt;","pos":[774,790],"source":"\\<configuration>"},{"content":"<ph id=\"ph1\">\\&lt;</ph>runtime&gt;","pos":[793,803],"source":"\\<runtime>"},{"content":"&lt;NetFx40_PInvokeStackResilience&gt;","pos":[806,838],"source":"<NetFx40_PInvokeStackResilience>"},{"pos":[847,853],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[928,951],"content":"Attributes and Elements","linkify":"Attributes and Elements","nodes":[{"content":"Attributes and Elements","pos":[0,23]}]},{"content":"The following sections describe attributes, child elements, and parent elements.","pos":[955,1035]},{"pos":[1045,1055],"content":"Attributes","linkify":"Attributes","nodes":[{"content":"Attributes","pos":[0,10]}]},{"content":"Attribute","pos":[1062,1071]},{"content":"Description","pos":[1072,1083]},{"content":"Required attribute.","pos":[1136,1155]},{"content":"Specifies whether the runtime detects incorrect platform invoke declarations and automatically fixes the stack at run time on 32-bit platforms.","pos":[1168,1311]},{"pos":[1321,1338],"content":"enabled Attribute","linkify":"enabled Attribute","nodes":[{"content":"enabled Attribute","pos":[0,17]}]},{"content":"Value","pos":[1345,1350]},{"content":"Description","pos":[1351,1362]},{"content":"The runtime uses the faster interop marshaling architecture introduced in the <ph id=\"ph1\">[!INCLUDE[net_v40_long](../../../../../includes/net-v40-long-md.md)]</ph>, which does not detect and fix incorrect platform invoke declarations.","pos":[1405,1622],"source":"The runtime uses the faster interop marshaling architecture introduced in the [!INCLUDE[net_v40_long](../../../../../includes/net-v40-long-md.md)], which does not detect and fix incorrect platform invoke declarations."},{"content":"This is the default.","pos":[1623,1643]},{"content":"The runtime uses slower transitions that detect and fix incorrect platform invoke declarations.","pos":[1652,1747]},{"pos":[1758,1772],"content":"Child Elements","linkify":"Child Elements","nodes":[{"content":"Child Elements","pos":[0,14]}]},{"content":"None.","pos":[1776,1781]},{"pos":[1791,1806],"content":"Parent Elements","linkify":"Parent Elements","nodes":[{"content":"Parent Elements","pos":[0,15]}]},{"content":"Element","pos":[1813,1820]},{"content":"Description","pos":[1821,1832]},{"content":"The root element in every configuration file used by the common language runtime and .NET Framework applications.","pos":[1889,2002]},{"content":"Contains information about runtime initialization options.","pos":[2017,2075]},{"pos":[2085,2092],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"This element enables you to trade faster interop marshaling for run-time resilience against incorrect platform invoke declarations.","pos":[2096,2227]},{"content":"Starting with the <ph id=\"ph1\">[!INCLUDE[net_v40_short](../../../../../includes/net-v40-short-md.md)]</ph>, a streamlined interop marshaling architecture provides a significant performance improvement for transitions from managed code to unmanaged code.","pos":[2234,2469],"source":"Starting with the [!INCLUDE[net_v40_short](../../../../../includes/net-v40-short-md.md)], a streamlined interop marshaling architecture provides a significant performance improvement for transitions from managed code to unmanaged code."},{"content":"In earlier versions of the .NET Framework, the marshaling layer detected incorrect platform invoke declarations on 32-bit platforms and automatically fixed the stack.","pos":[2470,2636]},{"content":"The new marshaling architecture eliminates this step.","pos":[2637,2690]},{"content":"As a result, transitions are very fast, but an incorrect platform invoke declaration can cause a program failure.","pos":[2691,2804]},{"content":"To make it easy to detect incorrect declarations during development, the Visual Studio debugging experience has been improved.","pos":[2811,2937]},{"content":"The <bpt id=\"p1\">[</bpt>pInvokeStackImbalance<ept id=\"p1\">](../../../../../docs/framework/debug-trace-profile/pinvokestackimbalance-mda.md)</ept> managed debugging assistant (MDA) notifies you of incorrect platform invoke declarations when your application is running with the debugger attached.","pos":[2938,3195],"source":" The [pInvokeStackImbalance](../../../../../docs/framework/debug-trace-profile/pinvokestackimbalance-mda.md) managed debugging assistant (MDA) notifies you of incorrect platform invoke declarations when your application is running with the debugger attached."},{"content":"To address scenarios where your application uses components that you cannot recompile, and that have incorrect platform invoke declarations, you can use the <ph id=\"ph1\">`NetFx40_PInvokeStackResilience`</ph> element.","pos":[3202,3400],"source":"To address scenarios where your application uses components that you cannot recompile, and that have incorrect platform invoke declarations, you can use the `NetFx40_PInvokeStackResilience` element."},{"content":"Adding this element to your application configuration file with <ph id=\"ph1\">`enabled=\"1\"`</ph> opts into a compatibility mode with the behavior of earlier versions of the .NET Framework, at the cost of slower transitions.","pos":[3401,3605],"source":" Adding this element to your application configuration file with `enabled=\"1\"` opts into a compatibility mode with the behavior of earlier versions of the .NET Framework, at the cost of slower transitions."},{"content":"Assemblies that have been compiled against earlier versions of the .NET Framework are automatically opted into this compatibility mode, and do not need this element.","pos":[3606,3771]},{"pos":[3780,3798],"content":"Configuration File","linkify":"Configuration File","nodes":[{"content":"Configuration File","pos":[0,18]}]},{"content":"This element can be used only in the application configuration file.","pos":[3802,3870]},{"pos":[3879,3886],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following example shows how to opt into increased resilience against incorrect platform invoke declarations for an application, at the cost of slower transitions between managed and unmanaged code.","pos":[3890,4091]},{"pos":[4237,4245],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Runtime Settings Schema<ept id=\"p1\">](../../../../../docs/framework/configure-apps/file-schema/runtime/index.md)</ept><ph id=\"ph1\"> </ph>","pos":[4249,4350],"source":"[Runtime Settings Schema](../../../../../docs/framework/configure-apps/file-schema/runtime/index.md) "},{"content":"<bpt id=\"p1\">[</bpt>Configuration File Schema<ept id=\"p1\">](../../../../../docs/framework/configure-apps/file-schema/index.md)</ept><ph id=\"ph1\"> </ph>","pos":[4354,4449],"source":"[Configuration File Schema](../../../../../docs/framework/configure-apps/file-schema/index.md) "},{"content":"<bpt id=\"p1\">[</bpt>pInvokeStackImbalance<ept id=\"p1\">](../../../../../docs/framework/debug-trace-profile/pinvokestackimbalance-mda.md)</ept>","pos":[4453,4556],"source":"[pInvokeStackImbalance](../../../../../docs/framework/debug-trace-profile/pinvokestackimbalance-mda.md)"}]}