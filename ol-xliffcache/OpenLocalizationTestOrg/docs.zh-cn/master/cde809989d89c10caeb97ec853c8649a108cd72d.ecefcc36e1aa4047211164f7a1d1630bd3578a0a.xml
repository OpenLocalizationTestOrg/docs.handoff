{"content":"---\ntitle: \"Mitigation: EventSource.WriteEvent Method Calls | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 327a9fdb-ba8e-40f7-89e5-4c89b46e594f\ncaps.latest.revision: 6\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# Mitigation: EventSource.WriteEvent Method Calls\nThe [!INCLUDE[net_v451](../../../includes/net-v451-md.md)] enforces a contract between an ETW event method in a class that is derived from <xref:System.Diagnostics.Tracing.EventSource?displayProperty=fullName> and  the <xref:System.Diagnostics.Tracing.EventSource.WriteEvent%2A> method of its base class. The ETW event method must pass the <xref:System.Diagnostics.Tracing.EventSource.WriteEvent%2A> method the event ID followed by the same arguments that were passed to the event method.  \n  \n## Impact  \n An ETW event method defined in the following way breaks the contract:  \n  \n```  \n  \n[Event(2, Level = EventLevel.Informational)]  \npublic void Info2(string message)  \n{  \n   base.WriteEvent(2, message, \"-\");  \n}  \n  \n```  \n  \n When this contract is violated, an <xref:System.IndexOutOfRangeException> exception is thrown at run time if an <xref:System.Diagnostics.Tracing.EventListener> object reads <xref:System.Diagnostics.Tracing.EventSource> data in process.  \n  \n The definition for this ETW event method should follow this pattern:  \n  \n```  \n  \n[Event(2, Level = EventLevel.Informational)]  \npublic void Info2(string message)  \n{  \n   base.WriteEvent(2, message);  \n}  \n  \n```  \n  \n## Mitigation  \n You must modify existing code to conform to the required pattern.  \n  \n You can minimize the amount of code that you have to change by defining two methods for calling the <xref:System.Diagnostics.Tracing.EventSource.WriteEvent%2A> method, as follows:  \n  \n```  \n  \n[NonEvent]  \npublic void Info2(string message)  \n{  \n   Info2Internal(message, \"-\");  \n}  \n  \npublic void Info2Internal(string message, string prefix)  \n{  \n   WriteEvent(2, message, prefix);  \n}  \n  \n```  \n  \n## See Also  \n [Runtime Changes](../../../docs/framework/migration-guide/runtime-changes-in-the-net-framework-4-5-1.md)","nodes":[{"pos":[12,76],"content":"Mitigation: EventSource.WriteEvent Method Calls | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Mitigation: EventSource.WriteEvent Method Calls | Microsoft Docs","pos":[0,64]}]},{"pos":[379,426],"content":"Mitigation: EventSource.WriteEvent Method Calls","linkify":"Mitigation: EventSource.WriteEvent Method Calls","nodes":[{"content":"Mitigation: EventSource.WriteEvent Method Calls","pos":[0,47]}]},{"content":"The <ph id=\"ph1\">[!INCLUDE[net_v451](../../../includes/net-v451-md.md)]</ph> enforces a contract between an ETW event method in a class that is derived from <ph id=\"ph2\">&lt;xref:System.Diagnostics.Tracing.EventSource?displayProperty=fullName&gt;</ph> and  the <ph id=\"ph3\">&lt;xref:System.Diagnostics.Tracing.EventSource.WriteEvent%2A&gt;</ph> method of its base class.","pos":[427,731],"source":"The [!INCLUDE[net_v451](../../../includes/net-v451-md.md)] enforces a contract between an ETW event method in a class that is derived from <xref:System.Diagnostics.Tracing.EventSource?displayProperty=fullName> and  the <xref:System.Diagnostics.Tracing.EventSource.WriteEvent%2A> method of its base class."},{"content":"The ETW event method must pass the <ph id=\"ph1\">&lt;xref:System.Diagnostics.Tracing.EventSource.WriteEvent%2A&gt;</ph> method the event ID followed by the same arguments that were passed to the event method.","pos":[732,915],"source":" The ETW event method must pass the <xref:System.Diagnostics.Tracing.EventSource.WriteEvent%2A> method the event ID followed by the same arguments that were passed to the event method."},{"pos":[924,930],"content":"Impact","linkify":"Impact","nodes":[{"content":"Impact","pos":[0,6]}]},{"content":"An ETW event method defined in the following way breaks the contract:","pos":[934,1003]},{"content":"When this contract is violated, an <ph id=\"ph1\">&lt;xref:System.IndexOutOfRangeException&gt;</ph> exception is thrown at run time if an <ph id=\"ph2\">&lt;xref:System.Diagnostics.Tracing.EventListener&gt;</ph> object reads <ph id=\"ph3\">&lt;xref:System.Diagnostics.Tracing.EventSource&gt;</ph> data in process.","pos":[1161,1396],"source":"When this contract is violated, an <xref:System.IndexOutOfRangeException> exception is thrown at run time if an <xref:System.Diagnostics.Tracing.EventListener> object reads <xref:System.Diagnostics.Tracing.EventSource> data in process."},{"content":"The definition for this ETW event method should follow this pattern:","pos":[1403,1471]},{"pos":[1626,1636],"content":"Mitigation","linkify":"Mitigation","nodes":[{"content":"Mitigation","pos":[0,10]}]},{"content":"You must modify existing code to conform to the required pattern.","pos":[1640,1705]},{"content":"You can minimize the amount of code that you have to change by defining two methods for calling the <ph id=\"ph1\">&lt;xref:System.Diagnostics.Tracing.EventSource.WriteEvent%2A&gt;</ph> method, as follows:","pos":[1712,1891],"source":"You can minimize the amount of code that you have to change by defining two methods for calling the <xref:System.Diagnostics.Tracing.EventSource.WriteEvent%2A> method, as follows:"},{"pos":[2119,2127],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[2131,2235],"content":"<bpt id=\"p1\">[</bpt>Runtime Changes<ept id=\"p1\">](../../../docs/framework/migration-guide/runtime-changes-in-the-net-framework-4-5-1.md)</ept>","source":"[Runtime Changes](../../../docs/framework/migration-guide/runtime-changes-in-the-net-framework-4-5-1.md)"}]}