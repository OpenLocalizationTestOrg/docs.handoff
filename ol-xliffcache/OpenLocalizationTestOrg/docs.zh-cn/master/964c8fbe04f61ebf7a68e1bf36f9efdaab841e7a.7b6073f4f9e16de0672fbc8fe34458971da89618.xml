{"content":"---\ntitle: \"ETW Tracing\"\nms.date: \"03/30/2017\"\nms.assetid: ac99a063-e2d2-40cc-b659-d23c2f783f92\n---\n# ETW Tracing\nThis sample demonstrates how to implement End-to-End (E2E) tracing using Event Tracing for Windows (ETW) and the `ETWTraceListener` that is provided with this sample. The sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) and includes ETW tracing.  \n  \n> [!NOTE]\n>  The set-up procedure and build instructions for this sample are located at the end of this topic.  \n  \n This sample assumes that you are familiar with [Tracing and Message Logging](../../../../docs/framework/wcf/samples/tracing-and-message-logging.md).  \n  \n Each trace source in the <xref:System.Diagnostics> tracing model can have multiple trace listeners that determine where and how the data is traced. The type of listener defines the format in which trace data is logged. The following code sample shows how to add the listener to configuration.  \n  \n```xml  \n<system.diagnostics>  \n    <sources>  \n        <source name=\"System.ServiceModel\"   \n             switchValue=\"Verbose,ActivityTracing\"  \n             propagateActivity=\"true\">  \n            <listeners>  \n                <add type=  \n                   \"System.Diagnostics.DefaultTraceListener\"  \n                   name=\"Default\">  \n                   <filter type=\"\" />  \n                </add>  \n                <add name=\"ETW\">  \n                    <filter type=\"\" />  \n                </add>  \n            </listeners>  \n        </source>  \n    </sources>  \n    <sharedListeners>  \n        <add type=  \n            \"Microsoft.ServiceModel.Samples.EtwTraceListener, ETWTraceListener\"  \n            name=\"ETW\" traceOutputOptions=\"Timestamp\">  \n            <filter type=\"\" />  \n       </add>  \n    </sharedListeners>  \n</system.diagnostics>  \n```  \n  \n Before using this listener, an ETW Trace Session must be started. This session can be started by using Logman.exe or Tracelog.exe. A SetupETW.bat file is included with this sample so that you can set up the ETW Trace Session along with a CleanupETW.bat file for closing the session and completing the log file.  \n  \n> [!NOTE]\n>  The setup procedure and build instructions for this sample are located at the end of this topic. For more information about these tools, see [https://go.microsoft.com/fwlink/?LinkId=56580](https://go.microsoft.com/fwlink/?LinkId=56580)  \n  \n When using the ETWTraceListener, traces are logged in binary .etl files. With ServiceModel tracing turned on, all generated traces appear in the same file. Use [Service Trace Viewer Tool (SvcTraceViewer.exe)](../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md) for viewing .etl and .svclog log files. The viewer creates an end-to-end view of the system that makes it possible to trace a message from its source to its destination and point of consumption.  \n  \n The ETW Trace Listener supports circular logging. To enable this feature, go to **Start**, **Run** and type `cmd` to start a command console. In the following command, replace the `<logfilename>` parameter with the name of your log file.  \n  \n```  \nlogman create trace Wcf -o <logfilename> -p \"{411a0819-c24b-428c-83e2-26b41091702e}\" -f bincirc -max 1000  \n```  \n  \n The `-f` and `-max` switches are optional. They specify the binary circular format and max log size of 1000MB respectively. The `-p` switch is used to specify the trace provider. In our example, `\"{411a0819-c24b-428c-83e2-26b41091702e}\"` is the GUID for \"XML ETW Sample Provider\".  \n  \n To start the session, type in the following command.  \n  \n```  \nLogman start Wcf  \n```  \n  \n After you have finished logging, you can stop the session with the following command.  \n  \n```  \nLogman stop Wcf  \n```  \n  \n This process generates binary circular logs that you can process with your tool of choice, including [Service Trace Viewer Tool (SvcTraceViewer.exe)](../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md) or Tracerpt.  \n  \n You can also review the [Circular Tracing](../../../../docs/framework/wcf/samples/circular-tracing.md) sample for more information on an alternative listener to perform circular logging.  \n  \n### To set up, build, and run the sample  \n  \n1.  Be sure you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).  \n  \n2.  To build the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).  \n  \n    > [!NOTE]\n    >  To use the RegisterProvider.bat, SetupETW.bat and CleanupETW.bat commands, you must run under a local administrator account. If you are using [!INCLUDE[wv](../../../../includes/wv-md.md)] or later, you must also run the command prompt with elevated privileges. To do so, right-click the command prompt icon, then click **Run as administrator**.  \n  \n3.  Before running the sample, run RegisterProvider.bat on the client and server. This sets up the resulting ETWTracingSampleLog.etl file to generate traces that can be read by the Service Trace Viewer. This file can be found in the C:\\logs folder. If this folder does not exist, it must be created or no traces are generated. Then, run SetupETW.bat on the client and server computers to begin the ETW Trace Session. The SetupETW.bat file can be found under the CS\\Client folder.  \n  \n4.  To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).  \n  \n5.  When the sample is completed, run CleanupETW.bat to complete the creation of the ETWTracingSampleLog.etl file.  \n  \n6.  Open the ETWTracingSampleLog.etl file from within the Service Trace Viewer. You will be prompted to save the binary formatted file as a .svclog file.  \n  \n7.  Open the newly created .svclog file from within the Service Trace Viewer to view the ETW and ServiceModel traces.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your computer. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Management\\AnalyticTrace`  \n  \n## See also\n\n- [AppFabric Monitoring Samples](https://go.microsoft.com/fwlink/?LinkId=193959)\n","nodes":[{"pos":[4,95],"embed":true,"restype":"x-metadata","content":"title: \"ETW Tracing\"\nms.date: \"03/30/2017\"\nms.assetid: ac99a063-e2d2-40cc-b659-d23c2f783f92","nodes":[{"content":"ETW Tracing","nodes":[{"pos":[0,11],"content":"ETW Tracing","nodes":[{"content":"ETW Tracing","pos":[0,11]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[102,113],"content":"ETW Tracing","linkify":"ETW Tracing","nodes":[{"content":"ETW Tracing","pos":[0,11]}]},{"content":"This sample demonstrates how to implement End-to-End (E2E) tracing using Event Tracing for Windows (ETW) and the <ph id=\"ph1\">`ETWTraceListener`</ph> that is provided with this sample.","pos":[114,280],"source":"This sample demonstrates how to implement End-to-End (E2E) tracing using Event Tracing for Windows (ETW) and the `ETWTraceListener` that is provided with this sample."},{"content":"The sample is based on the <bpt id=\"p1\">[</bpt>Getting Started<ept id=\"p1\">](../../../../docs/framework/wcf/samples/getting-started-sample.md)</ept> and includes ETW tracing.","pos":[281,417],"source":" The sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) and includes ETW tracing."},{"pos":[425,533],"content":"[!NOTE]\n The set-up procedure and build instructions for this sample are located at the end of this topic.","leadings":["","> "],"nodes":[{"content":"The set-up procedure and build instructions for this sample are located at the end of this topic.","pos":[9,106]}]},{"pos":[540,688],"content":"This sample assumes that you are familiar with <bpt id=\"p1\">[</bpt>Tracing and Message Logging<ept id=\"p1\">](../../../../docs/framework/wcf/samples/tracing-and-message-logging.md)</ept>.","source":"This sample assumes that you are familiar with [Tracing and Message Logging](../../../../docs/framework/wcf/samples/tracing-and-message-logging.md)."},{"content":"Each trace source in the <ph id=\"ph1\">&lt;xref:System.Diagnostics&gt;</ph> tracing model can have multiple trace listeners that determine where and how the data is traced.","pos":[695,842],"source":"Each trace source in the <xref:System.Diagnostics> tracing model can have multiple trace listeners that determine where and how the data is traced."},{"content":"The type of listener defines the format in which trace data is logged.","pos":[843,913]},{"content":"The following code sample shows how to add the listener to configuration.","pos":[914,987]},{"content":"Before using this listener, an ETW Trace Session must be started.","pos":[1858,1923]},{"content":"This session can be started by using Logman.exe or Tracelog.exe.","pos":[1924,1988]},{"content":"A SetupETW.bat file is included with this sample so that you can set up the ETW Trace Session along with a CleanupETW.bat file for closing the session and completing the log file.","pos":[1989,2168]},{"pos":[2176,2422],"content":"[!NOTE]\n The setup procedure and build instructions for this sample are located at the end of this topic. For more information about these tools, see [https://go.microsoft.com/fwlink/?LinkId=56580](https://go.microsoft.com/fwlink/?LinkId=56580)","leadings":["","> "],"nodes":[{"content":"The setup procedure and build instructions for this sample are located at the end of this topic. For more information about these tools, see [https://go.microsoft.com/fwlink/?LinkId=56580](https://go.microsoft.com/fwlink/?LinkId=56580)","pos":[9,244],"nodes":[{"content":"The setup procedure and build instructions for this sample are located at the end of this topic.","pos":[0,96]},{"content":"For more information about these tools, see <bpt id=\"p1\">[</bpt><ph id=\"ph1\">https://go.microsoft.com/fwlink/?LinkId=56580</ph><ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=56580)</ept>","pos":[97,235],"source":" For more information about these tools, see [https://go.microsoft.com/fwlink/?LinkId=56580](https://go.microsoft.com/fwlink/?LinkId=56580)"}]}]},{"content":"When using the ETWTraceListener, traces are logged in binary .etl files.","pos":[2429,2501]},{"content":"With ServiceModel tracing turned on, all generated traces appear in the same file.","pos":[2502,2584]},{"content":"Use <bpt id=\"p1\">[</bpt>Service Trace Viewer Tool (SvcTraceViewer.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md)</ept> for viewing .etl and .svclog log files.","pos":[2585,2757],"source":" Use [Service Trace Viewer Tool (SvcTraceViewer.exe)](../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md) for viewing .etl and .svclog log files."},{"content":"The viewer creates an end-to-end view of the system that makes it possible to trace a message from its source to its destination and point of consumption.","pos":[2758,2912]},{"content":"The ETW Trace Listener supports circular logging.","pos":[2919,2968]},{"content":"To enable this feature, go to <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Run<ept id=\"p2\">**</ept> and type <ph id=\"ph1\">`cmd`</ph> to start a command console.","pos":[2969,3060],"source":" To enable this feature, go to **Start**, **Run** and type `cmd` to start a command console."},{"content":"In the following command, replace the <ph id=\"ph1\">`&lt;logfilename&gt;`</ph> parameter with the name of your log file.","pos":[3061,3156],"source":" In the following command, replace the `<logfilename>` parameter with the name of your log file."},{"content":"The <ph id=\"ph1\">`-f`</ph> and <ph id=\"ph2\">`-max`</ph> switches are optional.","pos":[3286,3328],"source":"The `-f` and `-max` switches are optional."},{"content":"They specify the binary circular format and max log size of 1000MB respectively.","pos":[3329,3409]},{"content":"The <ph id=\"ph1\">`-p`</ph> switch is used to specify the trace provider.","pos":[3410,3464],"source":" The `-p` switch is used to specify the trace provider."},{"content":"In our example, <ph id=\"ph1\">`\"{411a0819-c24b-428c-83e2-26b41091702e}\"`</ph> is the GUID for \"XML ETW Sample Provider\".","pos":[3465,3566],"source":" In our example, `\"{411a0819-c24b-428c-83e2-26b41091702e}\"` is the GUID for \"XML ETW Sample Provider\"."},{"content":"To start the session, type in the following command.","pos":[3573,3625]},{"content":"After you have finished logging, you can stop the session with the following command.","pos":[3666,3751]},{"pos":[3791,4033],"content":"This process generates binary circular logs that you can process with your tool of choice, including <bpt id=\"p1\">[</bpt>Service Trace Viewer Tool (SvcTraceViewer.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md)</ept> or Tracerpt.","source":"This process generates binary circular logs that you can process with your tool of choice, including [Service Trace Viewer Tool (SvcTraceViewer.exe)](../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md) or Tracerpt."},{"pos":[4040,4226],"content":"You can also review the <bpt id=\"p1\">[</bpt>Circular Tracing<ept id=\"p1\">](../../../../docs/framework/wcf/samples/circular-tracing.md)</ept> sample for more information on an alternative listener to perform circular logging.","source":"You can also review the [Circular Tracing](../../../../docs/framework/wcf/samples/circular-tracing.md) sample for more information on an alternative listener to perform circular logging."},{"pos":[4236,4272],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[4282,4477],"content":"Be sure you have performed the <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Be sure you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"pos":[4487,4657],"content":"To build the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"pos":[4669,5028],"content":"[!NOTE]\nTo use the RegisterProvider.bat, SetupETW.bat and CleanupETW.bat commands, you must run under a local administrator account. If you are using [!INCLUDE[wv](../../../../includes/wv-md.md)] or later, you must also run the command prompt with elevated privileges. To do so, right-click the command prompt icon, then click **Run as administrator**.","leadings":["","    >  "],"nodes":[{"content":"To use the RegisterProvider.bat, SetupETW.bat and CleanupETW.bat commands, you must run under a local administrator account. If you are using [!INCLUDE[wv](../../../../includes/wv-md.md)] or later, you must also run the command prompt with elevated privileges. To do so, right-click the command prompt icon, then click **Run as administrator**.","pos":[8,352],"nodes":[{"content":"To use the RegisterProvider.bat, SetupETW.bat and CleanupETW.bat commands, you must run under a local administrator account.","pos":[0,124]},{"content":"If you are using <ph id=\"ph1\">[!INCLUDE[wv](../../../../includes/wv-md.md)]</ph> or later, you must also run the command prompt with elevated privileges.","pos":[125,260],"source":" If you are using [!INCLUDE[wv](../../../../includes/wv-md.md)] or later, you must also run the command prompt with elevated privileges."},{"content":"To do so, right-click the command prompt icon, then click <bpt id=\"p1\">**</bpt>Run as administrator<ept id=\"p1\">**</ept>.","pos":[261,344],"source":" To do so, right-click the command prompt icon, then click **Run as administrator**."}]}]},{"content":"Before running the sample, run RegisterProvider.bat on the client and server.","pos":[5038,5115]},{"content":"This sets up the resulting ETWTracingSampleLog.etl file to generate traces that can be read by the Service Trace Viewer.","pos":[5116,5236]},{"content":"This file can be found in the C:\\logs folder.","pos":[5237,5282]},{"content":"If this folder does not exist, it must be created or no traces are generated.","pos":[5283,5360]},{"content":"Then, run SetupETW.bat on the client and server computers to begin the ETW Trace Session.","pos":[5361,5450]},{"content":"The SetupETW.bat file can be found under the CS\\Client folder.","pos":[5451,5513]},{"pos":[5523,5732],"content":"To run the sample in a single- or cross-computer configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"content":"When the sample is completed, run CleanupETW.bat to complete the creation of the ETWTracingSampleLog.etl file.","pos":[5742,5852]},{"content":"Open the ETWTracingSampleLog.etl file from within the Service Trace Viewer.","pos":[5862,5937]},{"content":"You will be prompted to save the binary formatted file as a .svclog file.","pos":[5938,6011]},{"content":"Open the newly created .svclog file from within the Service Trace Viewer to view the ETW and ServiceModel traces.","pos":[6021,6134]},{"pos":[6142,6275],"content":"[!IMPORTANT]\n The samples may already be installed on your computer. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your computer. Check for the following (default) directory before continuing.","pos":[14,131],"nodes":[{"content":"The samples may already be installed on your computer.","pos":[0,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[6329,6639],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[6640,6690]},{"pos":[6777,6785],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6789,6867],"content":"<bpt id=\"p1\">[</bpt>AppFabric Monitoring Samples<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=193959)</ept>","source":"[AppFabric Monitoring Samples](https://go.microsoft.com/fwlink/?LinkId=193959)"}]}