{"content":"---\ntitle: \"How to: Import Custom Policy Assertions\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 1f41d787-accb-4a10-bfc6-a807671d1581\n---\n# How to: Import Custom Policy Assertions\nPolicy assertions describe the capabilities and requirements of a service endpoint.  Client applications can use policy assertions in service metadata to configure the client binding or to customize the service contract for a service endpoint.  \n  \n Custom policy assertions are imported by implementing the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface and passing that object to the metadata system or by registering the implementation type in your application configuration file.  Implementations of the <xref:System.ServiceModel.Description.IPolicyImportExtension> interface must provide a default constructor.  \n  \n### To import custom policy assertions  \n  \n1.  Implement the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface on a class. See the following procedures.  \n  \n2.  Insert the custom policy importer either by:  \n  \n3.  Using a configuration file. See the following procedures.  \n  \n4.  Using a configuration file with [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md). See the following procedures.  \n  \n5.  Programmatically inserting the policy importer. See the following procedures.  \n  \n### To implement the System.ServiceModel.Description.IPolicyImportExtension interface on any class  \n  \n1.  In the <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType> method, for each policy subject that you are interested in, find the policy assertions that you want to import by calling the appropriate method (depending upon the scope of the assertion that you want) on the <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> object passed to the method. The following code example shows how to use the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step. If you use the remove method to locate and remove the assertion, you do not have to perform step 4.  \n  \n     [!code-csharp[CustomPolicySample#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/policyimporter.cs#9)]\n     [!code-vb[CustomPolicySample#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/policyimporter.vb#9)]  \n  \n2.  Process the policy assertions. Note that the policy system does not normalize nested policies and `wsp:optional`. You must process these constructs in your policy import extension implementation.  \n  \n3.  Perform the customization to the binding or contract that supports the capability or requirement specified by the policy assertion. Typically assertions indicate that a binding requires a particular configuration or a specific binding element. Make these modifications by accessing the <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType> property. Other assertions require that you modify the contract.  You can access and modify the contract using the <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType> property.  Note that your policy importer may get called multiple times for the same binding and contract, but different policy alternatives if importing a policy alternative fails. Your code should be resilient to this behavior.  \n  \n4.  Remove the custom policy assertion from the assertion collection. If you do not remove the assertion Windows Communication Foundation (WCF) assumes that the policy import was unsuccessful and does not import the associated binding. If you used the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step you do not have to perform this step.  \n  \n### To insert the custom policy importer into the metadata System using a configuration file  \n  \n1.  Add the importer type to the `<extensions>` element inside the [\\<policyImporters>](../../../../docs/framework/configure-apps/file-schema/wcf/policyimporters.md) element in the client configuration file.  \n  \n     [!code-xml[CustomPolicySample#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.exe.config#7)]   \n  \n2.  In the client application, use the <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> to resolve the metadata and the importer is invoked automatically.  \n  \n     [!code-csharp[CustomPolicySample#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.cs#10)]\n     [!code-vb[CustomPolicySample#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/client.vb#10)]  \n  \n### To insert the custom policy importer into the metadata system using Svcutil.exe  \n  \n1.  Add the importer type to the `<extensions>` element inside the [\\<policyImporters>](../../../../docs/framework/configure-apps/file-schema/wcf/policyimporters.md) element in the Svcutil.exe.config configuration file. You can also point Svcutil.exe to load policy importer types registered in a different configuration file by using the `/svcutilConfig` option.  \n  \n2.  Use [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to import the metadata and the importer is invoked automatically.  \n  \n### To insert the custom policy importer into the metadata system programmatically  \n  \n1.  Add the importer to the <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> property (for example, if you are using the <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>) prior to importing the metadata.  \n  \n## See also\n\n- <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>\n- <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>\n- <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>\n- [Extending the Metadata System](../../../../docs/framework/wcf/extending/extending-the-metadata-system.md)\n","nodes":[{"pos":[4,157],"embed":true,"restype":"x-metadata","content":"title: \"How to: Import Custom Policy Assertions\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 1f41d787-accb-4a10-bfc6-a807671d1581","nodes":[{"content":"How to: Import Custom Policy Assertions","nodes":[{"pos":[0,39],"content":"How to: Import Custom Policy Assertions","nodes":[{"content":"How to: Import Custom Policy Assertions","pos":[0,39]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[164,203],"content":"How to: Import Custom Policy Assertions","linkify":"How to: Import Custom Policy Assertions","nodes":[{"content":"How to: Import Custom Policy Assertions","pos":[0,39]}]},{"content":"Policy assertions describe the capabilities and requirements of a service endpoint.","pos":[204,287]},{"content":"Client applications can use policy assertions in service metadata to configure the client binding or to customize the service contract for a service endpoint.","pos":[289,447]},{"content":"Custom policy assertions are imported by implementing the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType&gt;</ph> interface and passing that object to the metadata system or by registering the implementation type in your application configuration file.","pos":[454,741],"source":"Custom policy assertions are imported by implementing the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface and passing that object to the metadata system or by registering the implementation type in your application configuration file."},{"content":"Implementations of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.IPolicyImportExtension&gt;</ph> interface must provide a default constructor.","pos":[743,873],"source":"  Implementations of the <xref:System.ServiceModel.Description.IPolicyImportExtension> interface must provide a default constructor."},{"pos":[883,917],"content":"To import custom policy assertions","linkify":"To import custom policy assertions","nodes":[{"content":"To import custom policy assertions","pos":[0,34]}]},{"content":"Implement the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType&gt;</ph> interface on a class.","pos":[927,1053],"source":"Implement the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface on a class."},{"content":"See the following procedures.","pos":[1054,1083]},{"content":"Insert the custom policy importer either by:","pos":[1093,1137]},{"content":"Using a configuration file.","pos":[1147,1174]},{"content":"See the following procedures.","pos":[1175,1204]},{"content":"Using a configuration file with <bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept>.","pos":[1214,1379],"source":"Using a configuration file with [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)."},{"content":"See the following procedures.","pos":[1380,1409]},{"content":"Programmatically inserting the policy importer.","pos":[1419,1466]},{"content":"See the following procedures.","pos":[1467,1496]},{"pos":[1506,1600],"content":"To implement the System.ServiceModel.Description.IPolicyImportExtension interface on any class","linkify":"To implement the System.ServiceModel.Description.IPolicyImportExtension interface on any class","nodes":[{"content":"To implement the System.ServiceModel.Description.IPolicyImportExtension interface on any class","pos":[0,94]}]},{"content":"In the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType&gt;</ph> method, for each policy subject that you are interested in, find the policy assertions that you want to import by calling the appropriate method (depending upon the scope of the assertion that you want) on the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType&gt;</ph> object passed to the method.","pos":[1610,2054],"source":"In the <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType> method, for each policy subject that you are interested in, find the policy assertions that you want to import by calling the appropriate method (depending upon the scope of the assertion that you want) on the <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> object passed to the method."},{"content":"The following code example shows how to use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType&gt;</ph> method to locate the custom policy assertion and remove it from the collection in one step.","pos":[2055,2298],"source":" The following code example shows how to use the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step."},{"content":"If you use the remove method to locate and remove the assertion, you do not have to perform step 4.","pos":[2299,2398]},{"pos":[2409,2678],"content":"[!code-csharp[CustomPolicySample#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/policyimporter.cs#9)]\n [!code-vb[CustomPolicySample#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/policyimporter.vb#9)]","leadings":["","    "],"nodes":[]},{"content":"Process the policy assertions.","pos":[2688,2718]},{"content":"Note that the policy system does not normalize nested policies and <ph id=\"ph1\">`wsp:optional`</ph>.","pos":[2719,2801],"source":" Note that the policy system does not normalize nested policies and `wsp:optional`."},{"content":"You must process these constructs in your policy import extension implementation.","pos":[2802,2883]},{"content":"Perform the customization to the binding or contract that supports the capability or requirement specified by the policy assertion.","pos":[2893,3024]},{"content":"Typically assertions indicate that a binding requires a particular configuration or a specific binding element.","pos":[3025,3136]},{"content":"Make these modifications by accessing the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType&gt;</ph> property.","pos":[3137,3299],"source":" Make these modifications by accessing the <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType> property."},{"content":"Other assertions require that you modify the contract.","pos":[3300,3354]},{"content":"You can access and modify the contract using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType&gt;</ph> property.","pos":[3356,3518],"source":"  You can access and modify the contract using the <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType> property."},{"content":"Note that your policy importer may get called multiple times for the same binding and contract, but different policy alternatives if importing a policy alternative fails.","pos":[3520,3690]},{"content":"Your code should be resilient to this behavior.","pos":[3691,3738]},{"content":"Remove the custom policy assertion from the assertion collection.","pos":[3748,3813]},{"content":"If you do not remove the assertion Windows Communication Foundation (WCF) assumes that the policy import was unsuccessful and does not import the associated binding.","pos":[3814,3979]},{"content":"If you used the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType&gt;</ph> method to locate the custom policy assertion and remove it from the collection in one step you do not have to perform this step.","pos":[3980,4228],"source":" If you used the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step you do not have to perform this step."},{"pos":[4238,4326],"content":"To insert the custom policy importer into the metadata System using a configuration file","linkify":"To insert the custom policy importer into the metadata System using a configuration file","nodes":[{"content":"To insert the custom policy importer into the metadata System using a configuration file","pos":[0,88]}]},{"pos":[4336,4539],"content":"Add the importer type to the <ph id=\"ph1\">`&lt;extensions&gt;`</ph> element inside the <bpt id=\"p1\">[</bpt><ph id=\"ph2\">\\&lt;</ph>policyImporters&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/policyimporters.md)</ept> element in the client configuration file.","source":"Add the importer type to the `<extensions>` element inside the [\\<policyImporters>](../../../../docs/framework/configure-apps/file-schema/wcf/policyimporters.md) element in the client configuration file."},{"pos":[4689,4959],"content":"In the client application, use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType&gt;</ph> or <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType&gt;</ph> to resolve the metadata and the importer is invoked automatically.","source":"In the client application, use the <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> to resolve the metadata and the importer is invoked automatically."},{"pos":[4970,5227],"content":"[!code-csharp[CustomPolicySample#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.cs#10)]\n [!code-vb[CustomPolicySample#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/client.vb#10)]","leadings":["","    "],"nodes":[]},{"pos":[5237,5316],"content":"To insert the custom policy importer into the metadata system using Svcutil.exe","linkify":"To insert the custom policy importer into the metadata system using Svcutil.exe","nodes":[{"content":"To insert the custom policy importer into the metadata system using Svcutil.exe","pos":[0,79]}]},{"content":"Add the importer type to the <ph id=\"ph1\">`&lt;extensions&gt;`</ph> element inside the <bpt id=\"p1\">[</bpt><ph id=\"ph2\">\\&lt;</ph>policyImporters&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/policyimporters.md)</ept> element in the Svcutil.exe.config configuration file.","pos":[5326,5541],"source":"Add the importer type to the `<extensions>` element inside the [\\<policyImporters>](../../../../docs/framework/configure-apps/file-schema/wcf/policyimporters.md) element in the Svcutil.exe.config configuration file."},{"content":"You can also point Svcutil.exe to load policy importer types registered in a different configuration file by using the <ph id=\"ph1\">`/svcutilConfig`</ph> option.","pos":[5542,5685],"source":" You can also point Svcutil.exe to load policy importer types registered in a different configuration file by using the `/svcutilConfig` option."},{"pos":[5695,5897],"content":"Use <bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept> to import the metadata and the importer is invoked automatically.","source":"Use [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to import the metadata and the importer is invoked automatically."},{"pos":[5907,5985],"content":"To insert the custom policy importer into the metadata system programmatically","linkify":"To insert the custom policy importer into the metadata system programmatically","nodes":[{"content":"To insert the custom policy importer into the metadata system programmatically","pos":[0,78]}]},{"pos":[5995,6288],"content":"Add the importer to the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType&gt;</ph> property (for example, if you are using the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType&gt;</ph>) prior to importing the metadata.","source":"Add the importer to the <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> property (for example, if you are using the <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>) prior to importing the metadata."},{"pos":[6297,6305],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6566,6672],"content":"<bpt id=\"p1\">[</bpt>Extending the Metadata System<ept id=\"p1\">](../../../../docs/framework/wcf/extending/extending-the-metadata-system.md)</ept>","source":"[Extending the Metadata System](../../../../docs/framework/wcf/extending/extending-the-metadata-system.md)"}]}