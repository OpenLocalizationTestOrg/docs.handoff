{"content":"---\ntitle: \"How to: Write a LINQ to XML Axis Method (Visual Basic)\"\nms.date: 07/20/2015\nms.assetid: b676f025-a24c-4076-8713-aa809b2b8ce0\n---\n# How to: Write a LINQ to XML Axis Method (Visual Basic)\nYou can write your own axis methods to retrieve collections from an XML tree. One of the best ways to do this is to write an extension method that returns a collection of elements or attributes. You can write your extension method to return specific subsets of elements or attributes, based on the requirements of your application.  \n  \n## Example  \n The following example uses two extension methods. The first extension method, `GetXPath`, operates on <xref:System.Xml.Linq.XObject>, and returns an XPath expression that when evaluated will return the node or attribute. The second extension method, `Find`, operates on <xref:System.Xml.Linq.XElement>. It returns a collection of <xref:System.Xml.Linq.XAttribute> objects and <xref:System.Xml.Linq.XElement> objects that contain some specified text.  \n  \n This example uses the following XML document: [Sample XML File: Multiple Purchase Orders (LINQ to XML)](../../../../visual-basic/programming-guide/concepts/linq/sample-xml-file-multiple-purchase-orders-linq-to-xml.md).  \n  \n```vb  \nImports System.Runtime.CompilerServices  \nImports System.Text  \n  \nModule Module1  \n    Sub Main()  \n        Dim purchaseOrders = XElement.Load(\"..\\..\\PurchaseOrders.xml\")  \n  \n        Dim subset = From xobj In purchaseOrders.Find(\"1999\")  \n  \n        For Each obj In subset  \n            Console.WriteLine(obj.GetXPath())  \n            If obj.GetType() = GetType(XElement) Then  \n                Console.WriteLine(CType(obj, XElement).Value)  \n            ElseIf obj.GetType() = GetType(XAttribute) Then  \n                Console.WriteLine(CType(obj, XAttribute).Value)  \n            End If  \n        Next  \n    End Sub  \nEnd Module  \n  \nPublic Module MyExtensions  \n  \n    Private Function GetQName(ByVal xe As XElement) As String  \n        Dim prefix = xe.GetPrefixOfNamespace(xe.Name.Namespace)  \n        If xe.Name.Namespace = XNamespace.None OrElse prefix Is Nothing Then  \n            Return xe.Name.LocalName  \n        Else  \n            Return prefix & \":\" & xe.Name.LocalName  \n        End If  \n    End Function  \n  \n    Private Function GetQName(ByVal xa As XAttribute) As String  \n        Dim prefix = xa.Parent.GetPrefixOfNamespace(xa.Name.Namespace)  \n        If xa.Name.Namespace = XNamespace.None OrElse prefix Is Nothing Then  \n            Return xa.Name.LocalName  \n        Else  \n            Return prefix & \":\" & xa.Name.LocalName  \n        End If  \n    End Function  \n  \n    Private Function NameWithPredicate(ByVal el As XElement) As String  \n        If el.Parent IsNot Nothing AndAlso  \n           el.Parent.Elements(el.Name).Count() <> 1 Then  \n            Return GetQName(el) & \"[\" &  \n                (el.ElementsBeforeSelf(el.Name).Count() + 1) & \"]\"  \n        Else  \n            Return GetQName(el)  \n        End If  \n    End Function  \n  \n    <Extension()>  \n    Public Function StrCat(Of T)(ByVal source As IEnumerable(Of T),  \n                                 ByVal separator As String) As String  \n        Return source.Aggregate(New StringBuilder,  \n                                Function(sb, i) sb.  \n                                    Append(i.ToString()).  \n                                    Append(separator),  \n                                    Function(s) s.ToString())  \n    End Function  \n  \n    <Extension()>  \n    Public Function GetXPath(ByVal xobj As XObject) As String  \n  \n        If xobj.Parent Is Nothing Then  \n            Dim doc = TryCast(xobj, XDocument)  \n            If doc IsNot Nothing Then Return \".\"  \n  \n            Dim el = TryCast(xobj, XElement)  \n            If el IsNot Nothing Then Return \"/\" + NameWithPredicate(el)  \n  \n            ' the XPath data model does not include white space text nodes  \n            ' that are children of a document, so this method returns null.  \n  \n            Dim xt = TryCast(xobj, XText)  \n            If xt IsNot Nothing Then Return Nothing  \n  \n            Dim com = TryCast(xobj, XComment)  \n            If com IsNot Nothing Then  \n                Return \"/\" &  \n                    If(com.Document.Nodes().OfType(Of XComment)().Count() <> 1,  \n                       \"comment()[\" & (com.NodesBeforeSelf().OfType(Of XComment)().Count() + 1) & \"]\",  \n                       \"comment()\")  \n            End If  \n  \n            Dim pi = TryCast(xobj, XProcessingInstruction)  \n            If pi IsNot Nothing Then  \n                Return \"/\" &  \n                    If(pi.Document.Nodes().OfType(Of XProcessingInstruction)().Count() <> 1,  \n                       \"processing-instruction()[\" &  \n                           (pi.NodesBeforeSelf().OfType(Of XProcessingInstruction)().Count() + 1) & \"]\",  \n                       \"processing-instruction()\")  \n            End If  \n            Return Nothing  \n        Else  \n            Dim el = TryCast(xobj, XElement)  \n            If el IsNot Nothing Then  \n                Return \"/\" &  \n                    el.Ancestors().  \n                    InDocumentOrder().  \n                    Select(Function(e) NameWithPredicate(e)).StrCat(\"/\") & NameWithPredicate(el)  \n            End If  \n            Dim at = TryCast(xobj, XAttribute)  \n            If at IsNot Nothing Then  \n                Return \"/\" &  \n                    at.Parent.  \n                    AncestorsAndSelf().  \n                    InDocumentOrder().  \n                    Select(Function(e) NameWithPredicate(e)).StrCat(\"/\") & \"@\" & GetQName(at)  \n            End If  \n            Dim com = TryCast(xobj, XComment)  \n            If com IsNot Nothing Then  \n                Return \"/\" &  \n                    com.Parent.  \n                    AncestorsAndSelf().  \n                    InDocumentOrder().  \n                    Select(Function(e) NameWithPredicate(e)).StrCat(\"/\") &  \n                        If(com.Parent.Nodes().OfType(Of XComment)().Count() <> 1,  \n                           \"comment()[\" & (com.NodesBeforeSelf().OfType(Of XComment)().Count() + 1) & \"]\",  \n                           \"comment()\")  \n            End If  \n  \n            Dim cd = TryCast(xobj, XCData)  \n            If cd IsNot Nothing Then  \n                Return \"/\" &  \n                    cd.Parent.  \n                    AncestorsAndSelf().  \n                    InDocumentOrder().  \n                    Select(Function(e) NameWithPredicate(e)).StrCat(\"/\") &  \n                        If(cd.Parent.Nodes().OfType(Of XText)().Count() <> 1,  \n                           \"text()[\" & (cd.NodesBeforeSelf().OfType(Of XText)().Count() + 1) & \"]\",  \n                           \"text()\")  \n            End If  \n            Dim tx = TryCast(xobj, XText)  \n            If tx IsNot Nothing Then  \n                Return \"/\" &  \n                    tx.Parent.  \n                    AncestorsAndSelf().  \n                    InDocumentOrder().  \n                    Select(Function(e) NameWithPredicate(e)).StrCat(\"/\") &  \n                        If(tx.Parent.Nodes().OfType(Of XText)().Count() <> 1,  \n                           \"text()[\" & (tx.NodesBeforeSelf().OfType(Of XText)().Count() + 1) & \"]\",  \n                           \"text()\")  \n            End If  \n            Dim pi As XProcessingInstruction = TryCast(xobj, XProcessingInstruction)  \n            If pi IsNot Nothing Then  \n                Return \"/\" &  \n                    pi.Parent.  \n                    AncestorsAndSelf().  \n                    InDocumentOrder().  \n                    Select(Function(e) NameWithPredicate(e)).StrCat(\"/\") &  \n                        If(pi.Parent.Nodes().OfType(Of XProcessingInstruction)().Count() <> 1,  \n                           \"processing-instruction()[\" &  \n                               (pi.NodesBeforeSelf().OfType(Of XProcessingInstruction)().Count() + 1) & \"]\",  \n                           \"processing-instruction()\")  \n            End If  \n            Return Nothing  \n        End If  \n    End Function  \n  \n    <Extension()>  \n    Public Function Find(ByVal source As XElement, ByVal value As String) As IEnumerable(Of XObject)  \n        Dim results = From att In source.Attributes()  \n                      Where att.Value.Contains(value)  \n                      Let a As XObject = att  \n                      Select a  \n  \n        If source.Elements().Any Then  \n            For Each result In From child In source.Elements() Select Find(child, value)  \n                results = If(results Is Nothing, result, results.Union(result))  \n            Next  \n        Else  \n            If source.Value.Contains(value) Then  \n                results = If(results Is Nothing,  \n                             New List(Of XObject) From {source},  \n                             results.Union(New List(Of XObject) From {source}))  \n            End If  \n        End If  \n  \n        Return results  \n    End Function  \n  \nEnd Module  \n```  \n  \n This code produces the following output:  \n  \n```  \n/PurchaseOrders/PurchaseOrder[1]/@OrderDate  \n1999-10-20  \n/PurchaseOrders/PurchaseOrder[1]/Items/Item[2]/ShipDate  \n1999-05-21  \n/PurchaseOrders/PurchaseOrder[2]/@OrderDate  \n1999-10-22  \n/PurchaseOrders/PurchaseOrder[3]/@OrderDate  \n1999-10-22  \n```  \n  \n## See also\n\n- [Advanced Query Techniques (LINQ to XML) (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/advanced-query-techniques-linq-to-xml.md)\n","nodes":[{"pos":[4,136],"embed":true,"restype":"x-metadata","content":"title: \"How to: Write a LINQ to XML Axis Method (Visual Basic)\"\nms.date: 07/20/2015\nms.assetid: b676f025-a24c-4076-8713-aa809b2b8ce0","nodes":[{"content":"How to: Write a LINQ to XML Axis Method (Visual Basic)","nodes":[{"pos":[0,54],"content":"How to: Write a LINQ to XML Axis Method (Visual Basic)","nodes":[{"content":"How to: Write a LINQ to XML Axis Method (Visual Basic)","pos":[0,54]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[143,197],"content":"How to: Write a LINQ to XML Axis Method (Visual Basic)","linkify":"How to: Write a LINQ to XML Axis Method (Visual Basic)","nodes":[{"content":"How to: Write a LINQ to XML Axis Method (Visual Basic)","pos":[0,54]}]},{"content":"You can write your own axis methods to retrieve collections from an XML tree.","pos":[198,275]},{"content":"One of the best ways to do this is to write an extension method that returns a collection of elements or attributes.","pos":[276,392]},{"content":"You can write your extension method to return specific subsets of elements or attributes, based on the requirements of your application.","pos":[393,529]},{"pos":[538,545],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following example uses two extension methods.","pos":[549,598]},{"content":"The first extension method, <ph id=\"ph1\">`GetXPath`</ph>, operates on <ph id=\"ph2\">&lt;xref:System.Xml.Linq.XObject&gt;</ph>, and returns an XPath expression that when evaluated will return the node or attribute.","pos":[599,769],"source":" The first extension method, `GetXPath`, operates on <xref:System.Xml.Linq.XObject>, and returns an XPath expression that when evaluated will return the node or attribute."},{"content":"The second extension method, <ph id=\"ph1\">`Find`</ph>, operates on <ph id=\"ph2\">&lt;xref:System.Xml.Linq.XElement&gt;</ph>.","pos":[770,851],"source":" The second extension method, `Find`, operates on <xref:System.Xml.Linq.XElement>."},{"content":"It returns a collection of <ph id=\"ph1\">&lt;xref:System.Xml.Linq.XAttribute&gt;</ph> objects and <ph id=\"ph2\">&lt;xref:System.Xml.Linq.XElement&gt;</ph> objects that contain some specified text.","pos":[852,998],"source":" It returns a collection of <xref:System.Xml.Linq.XAttribute> objects and <xref:System.Xml.Linq.XElement> objects that contain some specified text."},{"pos":[1005,1223],"content":"This example uses the following XML document: <bpt id=\"p1\">[</bpt>Sample XML File: Multiple Purchase Orders (LINQ to XML)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/linq/sample-xml-file-multiple-purchase-orders-linq-to-xml.md)</ept>.","source":"This example uses the following XML document: [Sample XML File: Multiple Purchase Orders (LINQ to XML)](../../../../visual-basic/programming-guide/concepts/linq/sample-xml-file-multiple-purchase-orders-linq-to-xml.md)."},{"content":"This code produces the following output:","pos":[8994,9034]},{"pos":[9306,9314],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[9318,9473],"content":"<bpt id=\"p1\">[</bpt>Advanced Query Techniques (LINQ to XML) (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/linq/advanced-query-techniques-linq-to-xml.md)</ept>","source":"[Advanced Query Techniques (LINQ to XML) (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/advanced-query-techniques-linq-to-xml.md)"}]}