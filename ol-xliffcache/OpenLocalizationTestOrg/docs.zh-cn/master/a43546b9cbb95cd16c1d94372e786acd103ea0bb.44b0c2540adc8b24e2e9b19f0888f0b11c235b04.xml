{"content":"---\ntitle: \"Load Balancing\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"load balancing [WCF]\"\nms.assetid: 148e0168-c08d-4886-8769-776d0953b80f\n---\n# Load Balancing\nOne way to increase the capacity of Windows Communication Foundation (WCF) applications is to scale them out by deploying them into a load-balanced server farm. WCF applications can be load balanced using standard load balancing techniques, including software load balancers such as Windows Network Load Balancing as well as hardware-based load balancing appliances.  \n  \n The following sections discuss considerations for load balancing WCF applications built using various system-provided bindings.  \n  \n## Load Balancing with the Basic HTTP Binding  \n From the perspective of load balancing, WCF applications that communicate using the <xref:System.ServiceModel.BasicHttpBinding> are no different than other common types of HTTP network traffic (static HTML content, ASP.NET pages, or ASMX Web Services). WCF channels that use this binding are inherently stateless, and terminate their connections when the channel closes. As such, the <xref:System.ServiceModel.BasicHttpBinding> works well with existing HTTP load balancing techniques.  \n  \n By default, the <xref:System.ServiceModel.BasicHttpBinding> sends a connection HTTP header in messages with a `Keep-Alive` value, which enables clients to establish persistent connections to the services that support them. This configuration offers enhanced throughput because previously established connections can be reused to send subsequent messages to the same server. However, connection reuse may cause clients to become strongly associated to a specific server within the load-balanced farm, which reduces the effectiveness of round-robin load balancing. If this behavior is undesirable, HTTP `Keep-Alive` can be disabled on the server using the <xref:System.ServiceModel.Channels.HttpTransportBindingElement.KeepAliveEnabled%2A> property with a <xref:System.ServiceModel.Channels.CustomBinding> or user-defined <xref:System.ServiceModel.Channels.Binding>. The following example shows how to do this using configuration.  \n  \n```xml  \n<?xml version=\"1.0\" encoding=\"utf-8\" ?>  \n<configuration>  \n  \n <system.serviceModel>  \n  <services>  \n   <service   \n     name=\"Microsoft.ServiceModel.Samples.CalculatorService\"  \n     behaviorConfiguration=\"CalculatorServiceBehavior\">  \n     <host>  \n      <baseAddresses>  \n       <add baseAddress=\"http://localhost:8000/servicemodelsamples/service\"/>  \n      </baseAddresses>  \n     </host>  \n    <!-- configure http endpoint, use base address provided by host  \n         And the customBinding -->  \n     <endpoint address=\"\"  \n           binding=\"customBinding\"  \n           bindingConfiguration=\"HttpBinding\"   \n           contract=\"Microsoft.ServiceModel.Samples.ICalculator\" />  \n   </service>  \n  </services>  \n  \n  <bindings>  \n    <customBinding>  \n  \n    <!-- Configure a CustomBinding that disables keepAliveEnabled-->  \n      <binding name=\"HttpBinding\" keepAliveEnabled=\"False\"/>  \n  \n    </customBinding>  \n  </bindings>  \n </system.serviceModel>  \n</configuration>  \n```  \n  \n Using the simplified configuration introduced in [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)], the same behavior can be accomplished using the following simplified configuration.  \n  \n```xml  \n<?xml version=\"1.0\" encoding=\"utf-8\" ?>  \n<configuration>  \n <system.serviceModel>  \n    <protocolMapping>  \n      <add scheme=\"http\" binding=\"customBinding\" />  \n    </protocolMapping>  \n    <bindings>  \n      <customBinding>  \n  \n      <!-- Configure a CustomBinding that disables keepAliveEnabled-->  \n        <binding keepAliveEnabled=\"False\"/>  \n  \n      </customBinding>  \n    </bindings>  \n </system.serviceModel>  \n</configuration>  \n```  \n  \n For more information about default endpoints, bindings, and behaviors, see [Simplified Configuration](../../../docs/framework/wcf/simplified-configuration.md) and [Simplified Configuration for WCF Services](../../../docs/framework/wcf/samples/simplified-configuration-for-wcf-services.md).  \n  \n## Load Balancing with the WSHttp Binding and the WSDualHttp Binding  \n Both the <xref:System.ServiceModel.WSHttpBinding> and the <xref:System.ServiceModel.WSDualHttpBinding> can be load balanced using HTTP load balancing techniques provided several modifications are made to the default binding configuration.  \n  \n-   Turn off Security Context Establishment: this can be accomplished by the setting the <xref:System.ServiceModel.NonDualMessageSecurityOverHttp.EstablishSecurityContext%2A> property on the <xref:System.ServiceModel.WSHttpBinding> to `false`. Alternatively, if security sessions are required, it is possible to use stateful security sessions as described in the [Secure Sessions](../../../docs/framework/wcf/feature-details/secure-sessions.md) topic. Stateful security sessions enable the service to remain stateless as all of the state for the security session is transmitted with each request as a part of the protection security token. Note that to enable a stateful security session, it is necessary to use a <xref:System.ServiceModel.Channels.CustomBinding> or user-defined <xref:System.ServiceModel.Channels.Binding> as the necessary configuration settings are not exposed on <xref:System.ServiceModel.WSHttpBinding> and <xref:System.ServiceModel.WSDualHttpBinding> that are provided by the system.  \n  \n-   Do not use reliable sessions. This feature is off by default.  \n  \n## Load Balancing the Net.TCP Binding  \n The <xref:System.ServiceModel.NetTcpBinding> can be load balanced using IP-layer load balancing techniques. However, the <xref:System.ServiceModel.NetTcpBinding> pools TCP connections by default to reduce connection latency. This is an optimization that interferes with the basic mechanism of load balancing. The primary configuration value for optimizing the <xref:System.ServiceModel.NetTcpBinding> is the lease timeout, which is part of the Connection Pool Settings. Connection pooling causes client connections to become associated to specific servers within the farm. As the lifetime of those connections increase (a factor controlled by the lease timeout setting), the load distribution across various servers in the farm becomes unbalanced. As a result the average call time increases. So when using the <xref:System.ServiceModel.NetTcpBinding> in load-balanced scenarios, consider reducing the default lease timeout used by the binding. A 30-second lease timeout is a reasonable starting point for load-balanced scenarios, although the optimal value is application-dependent. For more information about the channel lease timeout and other transport quotas, see [Transport Quotas](../../../docs/framework/wcf/feature-details/transport-quotas.md).  \n  \n For best performance in load-balanced scenarios, consider using <xref:System.ServiceModel.NetTcpSecurity> (either <xref:System.ServiceModel.SecurityMode.Transport> or <xref:System.ServiceModel.SecurityMode.TransportWithMessageCredential>).  \n  \n## See also\n\n- [Internet Information Services Hosting Best Practices](../../../docs/framework/wcf/feature-details/internet-information-services-hosting-best-practices.md)\n","nodes":[{"pos":[4,147],"embed":true,"restype":"x-metadata","content":"title: \"Load Balancing\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"load balancing [WCF]\"\nms.assetid: 148e0168-c08d-4886-8769-776d0953b80f","nodes":[{"content":"Load Balancing","nodes":[{"pos":[0,14],"content":"Load Balancing","nodes":[{"content":"Load Balancing","pos":[0,14]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[154,168],"content":"Load Balancing","linkify":"Load Balancing","nodes":[{"content":"Load Balancing","pos":[0,14]}]},{"content":"One way to increase the capacity of Windows Communication Foundation (WCF) applications is to scale them out by deploying them into a load-balanced server farm.","pos":[169,329]},{"content":"WCF applications can be load balanced using standard load balancing techniques, including software load balancers such as Windows Network Load Balancing as well as hardware-based load balancing appliances.","pos":[330,535]},{"content":"The following sections discuss considerations for load balancing WCF applications built using various system-provided bindings.","pos":[542,669]},{"pos":[678,720],"content":"Load Balancing with the Basic HTTP Binding","linkify":"Load Balancing with the Basic HTTP Binding","nodes":[{"content":"Load Balancing with the Basic HTTP Binding","pos":[0,42]}]},{"content":"From the perspective of load balancing, WCF applications that communicate using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.BasicHttpBinding&gt;</ph> are no different than other common types of HTTP network traffic (static HTML content, ASP.NET pages, or ASMX Web Services).","pos":[724,976],"source":"From the perspective of load balancing, WCF applications that communicate using the <xref:System.ServiceModel.BasicHttpBinding> are no different than other common types of HTTP network traffic (static HTML content, ASP.NET pages, or ASMX Web Services)."},{"content":"WCF channels that use this binding are inherently stateless, and terminate their connections when the channel closes.","pos":[977,1094]},{"content":"As such, the <ph id=\"ph1\">&lt;xref:System.ServiceModel.BasicHttpBinding&gt;</ph> works well with existing HTTP load balancing techniques.","pos":[1095,1208],"source":" As such, the <xref:System.ServiceModel.BasicHttpBinding> works well with existing HTTP load balancing techniques."},{"content":"By default, the <ph id=\"ph1\">&lt;xref:System.ServiceModel.BasicHttpBinding&gt;</ph> sends a connection HTTP header in messages with a <ph id=\"ph2\">`Keep-Alive`</ph> value, which enables clients to establish persistent connections to the services that support them.","pos":[1215,1437],"source":"By default, the <xref:System.ServiceModel.BasicHttpBinding> sends a connection HTTP header in messages with a `Keep-Alive` value, which enables clients to establish persistent connections to the services that support them."},{"content":"This configuration offers enhanced throughput because previously established connections can be reused to send subsequent messages to the same server.","pos":[1438,1588]},{"content":"However, connection reuse may cause clients to become strongly associated to a specific server within the load-balanced farm, which reduces the effectiveness of round-robin load balancing.","pos":[1589,1777]},{"content":"If this behavior is undesirable, HTTP <ph id=\"ph1\">`Keep-Alive`</ph> can be disabled on the server using the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.HttpTransportBindingElement.KeepAliveEnabled%2A&gt;</ph> property with a <ph id=\"ph3\">&lt;xref:System.ServiceModel.Channels.CustomBinding&gt;</ph> or user-defined <ph id=\"ph4\">&lt;xref:System.ServiceModel.Channels.Binding&gt;</ph>.","pos":[1778,2079],"source":" If this behavior is undesirable, HTTP `Keep-Alive` can be disabled on the server using the <xref:System.ServiceModel.Channels.HttpTransportBindingElement.KeepAliveEnabled%2A> property with a <xref:System.ServiceModel.Channels.CustomBinding> or user-defined <xref:System.ServiceModel.Channels.Binding>."},{"content":"The following example shows how to do this using configuration.","pos":[2080,2143]},{"pos":[3152,3350],"content":"Using the simplified configuration introduced in <ph id=\"ph1\">[!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)]</ph>, the same behavior can be accomplished using the following simplified configuration.","source":"Using the simplified configuration introduced in [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)], the same behavior can be accomplished using the following simplified configuration."},{"pos":[3817,4106],"content":"For more information about default endpoints, bindings, and behaviors, see <bpt id=\"p1\">[</bpt>Simplified Configuration<ept id=\"p1\">](../../../docs/framework/wcf/simplified-configuration.md)</ept> and <bpt id=\"p2\">[</bpt>Simplified Configuration for WCF Services<ept id=\"p2\">](../../../docs/framework/wcf/samples/simplified-configuration-for-wcf-services.md)</ept>.","source":"For more information about default endpoints, bindings, and behaviors, see [Simplified Configuration](../../../docs/framework/wcf/simplified-configuration.md) and [Simplified Configuration for WCF Services](../../../docs/framework/wcf/samples/simplified-configuration-for-wcf-services.md)."},{"pos":[4115,4180],"content":"Load Balancing with the WSHttp Binding and the WSDualHttp Binding","linkify":"Load Balancing with the WSHttp Binding and the WSDualHttp Binding","nodes":[{"content":"Load Balancing with the WSHttp Binding and the WSDualHttp Binding","pos":[0,65]}]},{"pos":[4184,4422],"content":"Both the <ph id=\"ph1\">&lt;xref:System.ServiceModel.WSHttpBinding&gt;</ph> and the <ph id=\"ph2\">&lt;xref:System.ServiceModel.WSDualHttpBinding&gt;</ph> can be load balanced using HTTP load balancing techniques provided several modifications are made to the default binding configuration.","source":"Both the <xref:System.ServiceModel.WSHttpBinding> and the <xref:System.ServiceModel.WSDualHttpBinding> can be load balanced using HTTP load balancing techniques provided several modifications are made to the default binding configuration."},{"content":"Turn off Security Context Establishment: this can be accomplished by the setting the <ph id=\"ph1\">&lt;xref:System.ServiceModel.NonDualMessageSecurityOverHttp.EstablishSecurityContext%2A&gt;</ph> property on the <ph id=\"ph2\">&lt;xref:System.ServiceModel.WSHttpBinding&gt;</ph> to <ph id=\"ph3\">`false`</ph>.","pos":[4432,4671],"source":"Turn off Security Context Establishment: this can be accomplished by the setting the <xref:System.ServiceModel.NonDualMessageSecurityOverHttp.EstablishSecurityContext%2A> property on the <xref:System.ServiceModel.WSHttpBinding> to `false`."},{"content":"Alternatively, if security sessions are required, it is possible to use stateful security sessions as described in the <bpt id=\"p1\">[</bpt>Secure Sessions<ept id=\"p1\">](../../../docs/framework/wcf/feature-details/secure-sessions.md)</ept> topic.","pos":[4672,4879],"source":" Alternatively, if security sessions are required, it is possible to use stateful security sessions as described in the [Secure Sessions](../../../docs/framework/wcf/feature-details/secure-sessions.md) topic."},{"content":"Stateful security sessions enable the service to remain stateless as all of the state for the security session is transmitted with each request as a part of the protection security token.","pos":[4880,5067]},{"content":"Note that to enable a stateful security session, it is necessary to use a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.CustomBinding&gt;</ph> or user-defined <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.Binding&gt;</ph> as the necessary configuration settings are not exposed on <ph id=\"ph3\">&lt;xref:System.ServiceModel.WSHttpBinding&gt;</ph> and <ph id=\"ph4\">&lt;xref:System.ServiceModel.WSDualHttpBinding&gt;</ph> that are provided by the system.","pos":[5068,5433],"source":" Note that to enable a stateful security session, it is necessary to use a <xref:System.ServiceModel.Channels.CustomBinding> or user-defined <xref:System.ServiceModel.Channels.Binding> as the necessary configuration settings are not exposed on <xref:System.ServiceModel.WSHttpBinding> and <xref:System.ServiceModel.WSDualHttpBinding> that are provided by the system."},{"content":"Do not use reliable sessions.","pos":[5443,5472]},{"content":"This feature is off by default.","pos":[5473,5504]},{"pos":[5513,5547],"content":"Load Balancing the Net.TCP Binding","linkify":"Load Balancing the Net.TCP Binding","nodes":[{"content":"Load Balancing the Net.TCP Binding","pos":[0,34]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.NetTcpBinding&gt;</ph> can be load balanced using IP-layer load balancing techniques.","pos":[5551,5658],"source":"The <xref:System.ServiceModel.NetTcpBinding> can be load balanced using IP-layer load balancing techniques."},{"content":"However, the <ph id=\"ph1\">&lt;xref:System.ServiceModel.NetTcpBinding&gt;</ph> pools TCP connections by default to reduce connection latency.","pos":[5659,5775],"source":" However, the <xref:System.ServiceModel.NetTcpBinding> pools TCP connections by default to reduce connection latency."},{"content":"This is an optimization that interferes with the basic mechanism of load balancing.","pos":[5776,5859]},{"content":"The primary configuration value for optimizing the <ph id=\"ph1\">&lt;xref:System.ServiceModel.NetTcpBinding&gt;</ph> is the lease timeout, which is part of the Connection Pool Settings.","pos":[5860,6020],"source":" The primary configuration value for optimizing the <xref:System.ServiceModel.NetTcpBinding> is the lease timeout, which is part of the Connection Pool Settings."},{"content":"Connection pooling causes client connections to become associated to specific servers within the farm.","pos":[6021,6123]},{"content":"As the lifetime of those connections increase (a factor controlled by the lease timeout setting), the load distribution across various servers in the farm becomes unbalanced.","pos":[6124,6298]},{"content":"As a result the average call time increases.","pos":[6299,6343]},{"content":"So when using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.NetTcpBinding&gt;</ph> in load-balanced scenarios, consider reducing the default lease timeout used by the binding.","pos":[6344,6495],"source":" So when using the <xref:System.ServiceModel.NetTcpBinding> in load-balanced scenarios, consider reducing the default lease timeout used by the binding."},{"content":"A 30-second lease timeout is a reasonable starting point for load-balanced scenarios, although the optimal value is application-dependent.","pos":[6496,6634]},{"content":"For more information about the channel lease timeout and other transport quotas, see <bpt id=\"p1\">[</bpt>Transport Quotas<ept id=\"p1\">](../../../docs/framework/wcf/feature-details/transport-quotas.md)</ept>.","pos":[6635,6804],"source":" For more information about the channel lease timeout and other transport quotas, see [Transport Quotas](../../../docs/framework/wcf/feature-details/transport-quotas.md)."},{"pos":[6811,7050],"content":"For best performance in load-balanced scenarios, consider using <ph id=\"ph1\">&lt;xref:System.ServiceModel.NetTcpSecurity&gt;</ph> (either <ph id=\"ph2\">&lt;xref:System.ServiceModel.SecurityMode.Transport&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.ServiceModel.SecurityMode.TransportWithMessageCredential&gt;</ph>).","source":"For best performance in load-balanced scenarios, consider using <xref:System.ServiceModel.NetTcpSecurity> (either <xref:System.ServiceModel.SecurityMode.Transport> or <xref:System.ServiceModel.SecurityMode.TransportWithMessageCredential>)."},{"pos":[7059,7067],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[7071,7226],"content":"<bpt id=\"p1\">[</bpt>Internet Information Services Hosting Best Practices<ept id=\"p1\">](../../../docs/framework/wcf/feature-details/internet-information-services-hosting-best-practices.md)</ept>","source":"[Internet Information Services Hosting Best Practices](../../../docs/framework/wcf/feature-details/internet-information-services-hosting-best-practices.md)"}]}