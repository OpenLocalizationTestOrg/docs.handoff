{"content":"---\ntitle: \"Creating a Control That Has a Customizable Appearance | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-wpf\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"controls [WPF], customizing\"\n  - \"VisualStateManager [WPF], managing the state of a control\"\n  - \"ControlTemplate [WPF], customizing appearance\"\n  - \"controls [WPF], defining the visual structure and behavior of\"\n  - \"customizing appearance [WPF], ControlTemplate\"\n  - \"managing control states [WPF], VisualStateManager\"\n  - \"VisualStateManager [WPF], best practice\"\nms.assetid: 9e356d3d-a3d0-4b01-a25f-2d43e4d53fe5\ncaps.latest.revision: 10\nauthor: dotnet-bot\nms.author: dotnetcontent\nmanager: \"wpickett\"\n---\n# Creating a Control That Has a Customizable Appearance\n<a name=\"introduction\"></a> [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] gives you the ability to create a control whose appearance can be customized. For example, you can change the appearance of a <xref:System.Windows.Controls.CheckBox> beyond what setting properties will do by creating a new <xref:System.Windows.Controls.ControlTemplate>. The following illustration shows a <xref:System.Windows.Controls.CheckBox> that uses a default <xref:System.Windows.Controls.ControlTemplate> and a <xref:System.Windows.Controls.CheckBox> that uses a custom <xref:System.Windows.Controls.ControlTemplate>.  \n  \n ![A checkbox with the default control template.](../../../../docs/framework/wpf/controls/media/ndp-checkboxdefault.png \"NDP_CheckBoxDefault\")  \nA CheckBox that uses the default control template  \n  \n ![A checkbox with a custom control template.](../../../../docs/framework/wpf/controls/media/ndp-checkboxcustom.png \"NDP_CheckBoxCustom\")  \nA CheckBox that uses a custom control template  \n  \n If you follow the parts and states model when you create a control, your control's appearance will be customizable. Designer tools such as Microsoft Expression Blend support the parts and states model, so when you follow this model your control will be customizable in those types of applications.  This topic discusses the parts and states model and how to follow it when you create your own control. This topic uses an example of a custom control, `NumericUpDown`, to illustrate the philosophy of this model.  The `NumericUpDown` control displays a numeric value, which a user can increase or decrease by clicking on the control's buttons.  The following illustration shows the `NumericUpDown` control that is discussed in this topic.  \n  \n ![NumericUpDown custom control.](../../../../docs/framework/wpf/controls/media/ndp-numericupdown.png \"NDP_NumericUPDown\")  \nA custom NumericUpDown control  \n  \n This topic contains the following sections:  \n  \n-   [Prerequisites](#prerequisites)  \n  \n-   [Parts and States Model](#parts_and_states_model)  \n  \n-   [Defining the Visual Structure and Visual Behavior of a Control in a ControlTemplate](#defining_the_visual_structure_and_visual_behavior_of_a_control_in_a_controltemplate)  \n  \n-   [Using Parts of the ControlTemplate in Code](#using_parts_of_the_controltemplate_in_code)  \n  \n-   [Providing the Control Contract](#providing_the_control_contract)  \n  \n-   [Complete Example](#complete_example)  \n  \n<a name=\"prerequisites\"></a>   \n## Prerequisites  \n This topic assumes that you know how to create a new <xref:System.Windows.Controls.ControlTemplate> for an existing control, are familiar with what the elements on a control contract are, and understand the concepts discussed in [Customizing the Appearance of an Existing Control by Creating a ControlTemplate](../../../../docs/framework/wpf/controls/customizing-the-appearance-of-an-existing-control.md).  \n  \n> [!NOTE]\n>  To create a control that can have its appearance customized, you must create a control that inherits from the <xref:System.Windows.Controls.Control> class or one of its subclasses other than <xref:System.Windows.Controls.UserControl>.  A control that inherits from <xref:System.Windows.Controls.UserControl> is a control that can be quickly created, but it does not use a <xref:System.Windows.Controls.ControlTemplate> and you cannot customize its appearance.  \n  \n<a name=\"parts_and_states_model\"></a>   \n## Parts and States Model  \n The parts and states model specifies how to define the visual structure and visual behavior of a control. To follow the parts and states model, you should do the following:  \n  \n-   Define the visual structure and visual behavior in the <xref:System.Windows.Controls.ControlTemplate> of a control.  \n  \n-   Follow certain best practices when your control's logic interacts with parts of the control template.  \n  \n-   Provide a control contract to specify what should be included in the <xref:System.Windows.Controls.ControlTemplate>.  \n  \n When you define the visual structure and visual behavior in the <xref:System.Windows.Controls.ControlTemplate> of a control, application authors can change the visual structure and visual behavior of your control by creating a new <xref:System.Windows.Controls.ControlTemplate> instead of writing code.   You must provide a control contract that tells application authors which <xref:System.Windows.FrameworkElement> objects and states should be defined in the <xref:System.Windows.Controls.ControlTemplate>. You should follow some best practices when you interact with the parts in the <xref:System.Windows.Controls.ControlTemplate> so that your control properly handles an incomplete <xref:System.Windows.Controls.ControlTemplate>.  If you follow these three principles, application authors will be able to create a <xref:System.Windows.Controls.ControlTemplate> for your control just as easily as they can for the controls that ship with [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].  The following section explains each of these recommendations in detail.  \n  \n<a name=\"defining_the_visual_structure_and_visual_behavior_of_a_control_in_a_controltemplate\"></a>   \n## Defining the Visual Structure and Visual Behavior of a Control in a ControlTemplate  \n When you create your custom control by using the parts and states model, you define the control's visual structure and visual behavior in its <xref:System.Windows.Controls.ControlTemplate> instead of in its logic.  The visual structure of a control is the composite of <xref:System.Windows.FrameworkElement> objects that make up the control.  The visual behavior is the way the control appears when it is in a certain state.   For more information about creating a <xref:System.Windows.Controls.ControlTemplate> that specifies the visual structure and visual behavior of a control, see [Customizing the Appearance of an Existing Control by Creating a ControlTemplate](../../../../docs/framework/wpf/controls/customizing-the-appearance-of-an-existing-control.md).  \n  \n In the example of the `NumericUpDown` control, the visual structure includes two <xref:System.Windows.Controls.Primitives.RepeatButton> controls and a <xref:System.Windows.Controls.TextBlock>.  If you add these controls in the code of the `NumericUpDown` control--in its constructor, for example--the positions of those controls would be unalterable.  Instead of defining the control's visual structure and visual behavior in its code, you should define it in the <xref:System.Windows.Controls.ControlTemplate>.  Then an application developer to customize the position of the buttons and <xref:System.Windows.Controls.TextBlock> and specify what behavior occurs when `Value` is negative because the <xref:System.Windows.Controls.ControlTemplate> can be replaced.  \n  \n The following example shows the visual structure of the `NumericUpDown` control, which includes a <xref:System.Windows.Controls.Primitives.RepeatButton> to increase `Value`, a <xref:System.Windows.Controls.Primitives.RepeatButton> to decrease `Value`, and a <xref:System.Windows.Controls.TextBlock> to display `Value`.  \n  \n [!code-xml[VSMCustomControl#VisualStructure](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/window1.xaml#visualstructure)]  \n  \n A visual behavior of the `NumericUpDown` control is that the value is in a red font if it is negative.  If you change the <xref:System.Windows.Controls.TextBlock.Foreground%2A> of the <xref:System.Windows.Controls.TextBlock> in code when the `Value` is negative, the `NumericUpDown` will always show a red negative value. You specify the visual behavior of the control in the <xref:System.Windows.Controls.ControlTemplate> by adding <xref:System.Windows.VisualState> objects to the <xref:System.Windows.Controls.ControlTemplate>.  The following example shows the <xref:System.Windows.VisualState> objects for the `Positive` and `Negative` states.  `Positive` and `Negative` are mutually exclusive (the control is always in exactly one of the two), so the example puts the <xref:System.Windows.VisualState> objects into a single <xref:System.Windows.VisualStateGroup>.  When the control goes into the `Negative` state, the <xref:System.Windows.Controls.TextBlock.Foreground%2A> of the <xref:System.Windows.Controls.TextBlock> turns red.  When the control is in the `Positive` state, the <xref:System.Windows.Controls.TextBlock.Foreground%2A> returns to it original value.  Defining <xref:System.Windows.VisualState> objects in a <xref:System.Windows.Controls.ControlTemplate> is further discussed in [Customizing the Appearance of an Existing Control by Creating a ControlTemplate](../../../../docs/framework/wpf/controls/customizing-the-appearance-of-an-existing-control.md).  \n  \n> [!NOTE]\n>  Be sure to set the <xref:System.Windows.VisualStateManager.VisualStateGroups%2A?displayProperty=fullName> attached property on the root <xref:System.Windows.FrameworkElement> of the <xref:System.Windows.Controls.ControlTemplate>.  \n  \n [!code-xml[VSMCustomControl#ValueStates](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/window1.xaml#valuestates)]  \n  \n<a name=\"using_parts_of_the_controltemplate_in_code\"></a>   \n## Using Parts of the ControlTemplate in Code  \n A <xref:System.Windows.Controls.ControlTemplate> author might omit <xref:System.Windows.FrameworkElement> or <xref:System.Windows.VisualState> objects, either purposefully or by mistake, but your control's logic might need those parts to function properly. The parts and states model specifies that your control should be resilient to a <xref:System.Windows.Controls.ControlTemplate> that is missing <xref:System.Windows.FrameworkElement> or <xref:System.Windows.VisualState> objects.  Your control should not throw an exception or report an error if a <xref:System.Windows.FrameworkElement>, <xref:System.Windows.VisualState>, or <xref:System.Windows.VisualStateGroup> is missing from the <xref:System.Windows.Controls.ControlTemplate>. This section describes the recommended practices for interacting with <xref:System.Windows.FrameworkElement> objects and managing states.  \n  \n### Anticipate Missing FrameworkElement Objects  \n When you define <xref:System.Windows.FrameworkElement> objects in the <xref:System.Windows.Controls.ControlTemplate>, your control's logic might need to interact with some of them.  For example, the `NumericUpDown` control subscribes to the buttons' <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event to increase or decrease `Value` and sets the <xref:System.Windows.Controls.TextBlock.Text%2A> property of the <xref:System.Windows.Controls.TextBlock> to `Value`. If a custom <xref:System.Windows.Controls.ControlTemplate> omits the <xref:System.Windows.Controls.TextBlock> or buttons, it is acceptable that the control loses some of its functionality, but you should be sure that your control does not cause an error. For example, if a <xref:System.Windows.Controls.ControlTemplate> does not contain the buttons to change `Value`, the `NumericUpDown` loses that functionality, but an application that uses the <xref:System.Windows.Controls.ControlTemplate> will continue to run.  \n  \n The following practices will ensure that your control responds properly to missing <xref:System.Windows.FrameworkElement> objects:  \n  \n1.  Set the `x:Name` attribute for each <xref:System.Windows.FrameworkElement> that you need to reference in code.  \n  \n2.  Define private properties for each <xref:System.Windows.FrameworkElement> that you need to interact with.  \n  \n3.  Subscribe to and unsubscribe from any events that your control handles in the <xref:System.Windows.FrameworkElement> property's set accessor.  \n  \n4.  Set the <xref:System.Windows.FrameworkElement> properties that you defined in step 2 in the <xref:System.Windows.FrameworkElement.OnApplyTemplate%2A> method. This is the earliest that the <xref:System.Windows.FrameworkElement> in the <xref:System.Windows.Controls.ControlTemplate> is available to the control. Use the `x:Name` of the <xref:System.Windows.FrameworkElement> to get it from the <xref:System.Windows.Controls.ControlTemplate>.  \n  \n5.  Check that the <xref:System.Windows.FrameworkElement> is not `null` before accessing its members.  If it is `null`, do not report an error.  \n  \n The following examples show how the `NumericUpDown` control interacts with <xref:System.Windows.FrameworkElement> objects in accordance with the recommendations in the preceding list.  \n  \n In the example that defines the visual structure of the `NumericUpDown` control in the <xref:System.Windows.Controls.ControlTemplate>, the <xref:System.Windows.Controls.Primitives.RepeatButton> that increases `Value` has its `x:Name` attribute set to `UpButton`.  The following example declares a property called `UpButtonElement` that represents the <xref:System.Windows.Controls.Primitives.RepeatButton> that is declared in the <xref:System.Windows.Controls.ControlTemplate>. The `set` accessor first unsubscribes to the button's <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event if `UpDownElement` is not `null`, then it sets the property, and then it subscribes to the <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event. There is also a property defined, but not shown here, for the other <xref:System.Windows.Controls.Primitives.RepeatButton>, called `DownButtonElement`.  \n  \n [!code-csharp[VSMCustomControl#UpButtonProperty](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#upbuttonproperty)]\n [!code-vb[VSMCustomControl#UpButtonProperty](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#upbuttonproperty)]  \n  \n The following example shows the <xref:System.Windows.FrameworkElement.OnApplyTemplate%2A> for the `NumericUpDown` control.  The example uses the <xref:System.Windows.FrameworkElement.GetTemplateChild%2A> method to get the <xref:System.Windows.FrameworkElement> objects from the <xref:System.Windows.Controls.ControlTemplate>.  Notice that the example guards against cases where <xref:System.Windows.FrameworkElement.GetTemplateChild%2A> finds a <xref:System.Windows.FrameworkElement> with the specified name that is not of the expected type. It is also a best practice to ignore elements that have the specified `x:Name` but are of the wrong type.  \n  \n [!code-csharp[VSMCustomControl#ApplyTemplate](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#applytemplate)]\n [!code-vb[VSMCustomControl#ApplyTemplate](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#applytemplate)]  \n  \n By following the practices that are shown in the previous examples, you ensure that your control will continue to run when the <xref:System.Windows.Controls.ControlTemplate> is missing a <xref:System.Windows.FrameworkElement>.  \n  \n### Use the VisualStateManager to Manage States  \n The<xref:System.Windows.VisualStateManager> keeps track of the states of a control and performs the logic necessary to transition between states. When you add <xref:System.Windows.VisualState> objects to the <xref:System.Windows.Controls.ControlTemplate>, you add them to a <xref:System.Windows.VisualStateGroup> and add the <xref:System.Windows.VisualStateGroup> to the <xref:System.Windows.VisualStateManager.VisualStateGroups%2A?displayProperty=fullName> attached property so that the <xref:System.Windows.VisualStateManager> has access to them.  \n  \n The following example repeats the previous example that shows the <xref:System.Windows.VisualState> objects that corresponds to the `Positive` and `Negative` states of the control. The <xref:System.Windows.Media.Animation.Storyboard> in the `Negative`<xref:System.Windows.VisualState> turns the <xref:System.Windows.Controls.TextBlock.Foreground%2A> of the <xref:System.Windows.Controls.TextBlock> red.   When the `NumericUpDown` control is in the `Negative` state, the storyboard in the `Negative` state begins.  Then the <xref:System.Windows.Media.Animation.Storyboard> in the `Negative` state stops when the control returns to the `Positive` state.  The `Positive`<xref:System.Windows.VisualState> does not need to contain a <xref:System.Windows.Media.Animation.Storyboard> because when the <xref:System.Windows.Media.Animation.Storyboard> for the `Negative` stops, the <xref:System.Windows.Controls.TextBlock.Foreground%2A> returns to its original color.  \n  \n [!code-xml[VSMCustomControl#ValueStates](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/window1.xaml#valuestates)]  \n  \n Note that the <xref:System.Windows.Controls.TextBlock> is given a name, but the <xref:System.Windows.Controls.TextBlock> is not in the control contract for `NumericUpDown` because the control's logic never references the <xref:System.Windows.Controls.TextBlock>.  Elements that are referenced in the <xref:System.Windows.Controls.ControlTemplate> have names, but do not need to be part of the control contract because a new <xref:System.Windows.Controls.ControlTemplate> for the control might not need to reference that element.  For example, someone who creates a new <xref:System.Windows.Controls.ControlTemplate> for `NumericUpDown` might decide to not indicate that `Value` is negative by changing the <xref:System.Windows.Controls.Control.Foreground%2A>.  In that case, neither the code nor the <xref:System.Windows.Controls.ControlTemplate> references the <xref:System.Windows.Controls.TextBlock> by name.  \n  \n The control's logic is responsible for changing the control's state. The following example shows that the `NumericUpDown` control calls the <xref:System.Windows.VisualStateManager.GoToState%2A> method to go into the `Positive` state when `Value` is 0 or greater, and the `Negative` state when `Value` is less than 0.  \n  \n [!code-csharp[VSMCustomControl#ValueStateChange](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#valuestatechange)]\n [!code-vb[VSMCustomControl#ValueStateChange](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#valuestatechange)]  \n  \n The <xref:System.Windows.VisualStateManager.GoToState%2A> method performs the logic necessary to start and stop the storyboards appropriately. When a control calls <xref:System.Windows.VisualStateManager.GoToState%2A> to change its state, the <xref:System.Windows.VisualStateManager> does the following:  \n  \n-   If the <xref:System.Windows.VisualState> that the control is going to has a <xref:System.Windows.Media.Animation.Storyboard>, the storyboard begins. Then, if the <xref:System.Windows.VisualState> that the control is coming from has a <xref:System.Windows.Media.Animation.Storyboard>, the storyboard ends.  \n  \n-   If the control is already in the state that is specified, <xref:System.Windows.VisualStateManager.GoToState%2A> takes no action and returns `true`.  \n  \n-   If state that is specified doesn't exist in the <xref:System.Windows.Controls.ControlTemplate> of `control`, <xref:System.Windows.VisualStateManager.GoToState%2A> takes no action and returns `false`.  \n  \n#### Best Practices for Working with the VisualStateManager  \n It is recommended that you do the following to maintain your control's states:  \n  \n-   Use properties to track its state.  \n  \n-   Create a helper method to transition between states.  \n  \n The `NumericUpDown` control uses its `Value` property to track whether it is in the `Positive` or `Negative` state.  The `NumericUpDown` control also defines the `Focused` and `UnFocused` states, which tracks the <xref:System.Windows.UIElement.IsFocused%2A> property. If you use states that do not naturally correspond to a property of the control, you can define a private property to track the state.  \n  \n A single method that updates all the states centralizes calls to the <xref:System.Windows.VisualStateManager> and keeps your code manageable. The following example shows the `NumericUpDown` control's helper method, `UpdateStates`. When `Value` is greater than or equal to 0, the <xref:System.Windows.Controls.Control> is in the `Positive` state.  When `Value` is less than 0, the control is in the `Negative` state.  When <xref:System.Windows.UIElement.IsFocused%2A> is `true`, the control is in the `Focused` state; otherwise, it is in the `Unfocused` state.  The control can call `UpdateStates` whenever it needs to change its state, regardless of what state changes.  \n  \n [!code-csharp[VSMCustomControl#UpdateStates](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#updatestates)]\n [!code-vb[VSMCustomControl#UpdateStates](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#updatestates)]  \n  \n If you pass a state name to <xref:System.Windows.VisualStateManager.GoToState%2A> when the control is already in that state, <xref:System.Windows.VisualStateManager.GoToState%2A> does nothing, so you don't need to check for the control's current state.  For example, if `Value` changes from one negative number to another negative number, the storyboard for the `Negative` state is not interrupted and the user will not see a change in the control.  \n  \n The <xref:System.Windows.VisualStateManager> uses <xref:System.Windows.VisualStateGroup> objects to determine which state to exit when you call <xref:System.Windows.VisualStateManager.GoToState%2A>. The control is always in one state for each <xref:System.Windows.VisualStateGroup> that is defined in its <xref:System.Windows.Controls.ControlTemplate> and only leaves a state when it goes into another state from the same <xref:System.Windows.VisualStateGroup>. For example, the <xref:System.Windows.Controls.ControlTemplate> of the `NumericUpDown` control defines the `Positive` and `Negative`<xref:System.Windows.VisualState> objects in one <xref:System.Windows.VisualStateGroup> and the `Focused` and `Unfocused`<xref:System.Windows.VisualState> objects in another. (You can see the `Focused` and `Unfocused`<xref:System.Windows.VisualState> defined in the [Complete Example](#complete_example) section in this topic When the control goes from the `Positive` state to the `Negative` state, or vice versa, the control remains in either the `Focused` or `Unfocused` state.  \n  \n There are three typical places where the state of a control might change:  \n  \n-   When the <xref:System.Windows.Controls.ControlTemplate> is applied to the <xref:System.Windows.Controls.Control>.  \n  \n-   When a property changes.  \n  \n-   When an event occurs.  \n  \n The following examples demonstrate updating the state of the `NumericUpDown` control in these cases.  \n  \n You should update the state of the control in the <xref:System.Windows.FrameworkElement.OnApplyTemplate%2A> method so that the control appears in the correct state when the <xref:System.Windows.Controls.ControlTemplate> is applied. The following example calls `UpdateStates` in <xref:System.Windows.FrameworkElement.OnApplyTemplate%2A> to ensure that the control is in the appropriate states.  For example, suppose that you create a `NumericUpDown` control, and then set its <xref:System.Windows.Controls.Control.Foreground%2A> to green and `Value` to -5.  If you do not call `UpdateStates` when the <xref:System.Windows.Controls.ControlTemplate> is applied to the `NumericUpDown` control, the control is not in the `Negative` state and the value is green instead of red.  You must call `UpdateStates` to put the control in the `Negative` state.  \n  \n [!code-csharp[VSMCustomControl#ApplyTemplate](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#applytemplate)]\n [!code-vb[VSMCustomControl#ApplyTemplate](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#applytemplate)]  \n  \n You often need to update the states of a control when a property changes. The following example shows the entire `ValueChangedCallback` method. Because `ValueChangedCallback` is called when `Value` changes, the method calls `UpdateStates` in case `Value` changed from positive to negative or vice versa. It is acceptable to call `UpdateStates` when `Value` changes but remains positive or negative because in that case, the control will not change states.  \n  \n [!code-csharp[VSMCustomControl#EntireValueChangedCallback](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#entirevaluechangedcallback)]\n [!code-vb[VSMCustomControl#EntireValueChangedCallback](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#entirevaluechangedcallback)]  \n  \n You might also need to update states when an event occurs. The following example shows that the `NumericUpDown` calls `UpdateStates` on the <xref:System.Windows.Controls.Control> to handle the <xref:System.Windows.UIElement.GotFocus> event.  \n  \n [!code-csharp[VSMCustomControl#OnGotFocus](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#ongotfocus)]\n [!code-vb[VSMCustomControl#OnGotFocus](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#ongotfocus)]  \n  \n The <xref:System.Windows.VisualStateManager> helps you manage your control's states. By using the <xref:System.Windows.VisualStateManager>, you ensure that your control correctly transitions between states.  If you follow the recommendations described in this section for working with the <xref:System.Windows.VisualStateManager>, your control's code will remain readable and maintainable.  \n  \n<a name=\"providing_the_control_contract\"></a>   \n## Providing the Control Contract  \n You provide a control contract so that <xref:System.Windows.Controls.ControlTemplate> authors will know what to put in the template. A control contract has three elements:  \n  \n-   The visual elements that the control's logic uses.  \n  \n-   The states of the control and the group each state belongs to.  \n  \n-   The public properties that visually affect the control.  \n  \n Someone that creates a new <xref:System.Windows.Controls.ControlTemplate> needs to know what <xref:System.Windows.FrameworkElement> objects the control's logic uses, what type each object is, and what its name is. A <xref:System.Windows.Controls.ControlTemplate> author also needs to know the name of each possible state the control can be in, and which <xref:System.Windows.VisualStateGroup> the state is in.  \n  \n Returning to the `NumericUpDown` example, the control expects the <xref:System.Windows.Controls.ControlTemplate> to have the following <xref:System.Windows.FrameworkElement> objects:  \n  \n-   A <xref:System.Windows.Controls.Primitives.RepeatButton> called `UpButton`.  \n  \n-   A <xref:System.Windows.Controls.Primitives.RepeatButton> called `DownButton.`  \n  \n The control can be in the following states:  \n  \n-   In the `ValueStates`<xref:System.Windows.VisualStateGroup>  \n  \n    -   `Positive`  \n  \n    -   `Negative`  \n  \n-   In the `FocusStates`<xref:System.Windows.VisualStateGroup>  \n  \n    -   `Focused`  \n  \n    -   `Unfocused`  \n  \n To specify what <xref:System.Windows.FrameworkElement> objects the control expects, you use the <xref:System.Windows.TemplatePartAttribute>, which specifies the name and type of the expected elements.  To specify the possible states of a control, you use the <xref:System.Windows.TemplateVisualStateAttribute>, which specifies the state's name and which <xref:System.Windows.VisualStateGroup> it belongs to.  Put the <xref:System.Windows.TemplatePartAttribute> and <xref:System.Windows.TemplateVisualStateAttribute> on the class definition of the control.  \n  \n Any public property that affects the appearance of your control is also a part of the control contract.  \n  \n The following example specifies the <xref:System.Windows.FrameworkElement> object and states for the `NumericUpDown` control.  \n  \n [!code-csharp[VSMCustomControl#ControlContract](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#controlcontract)]\n [!code-vb[VSMCustomControl#ControlContract](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#controlcontract)]  \n  \n<a name=\"complete_example\"></a>   \n## Complete Example  \n The following example is the entire <xref:System.Windows.Controls.ControlTemplate> for the `NumericUpDown` control.  \n  \n [!code-xml[VSMCustomControl#NUDTemplate](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/themes/generic.xaml#nudtemplate)]  \n  \n The following example shows the logic for the `NumericUpDown`.  \n  \n [!code-csharp[VSMCustomControl#ControlLogic](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#controllogic)]\n [!code-vb[VSMCustomControl#ControlLogic](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#controllogic)]  \n  \n## See Also  \n [Customizing the Appearance of an Existing Control by Creating a ControlTemplate](../../../../docs/framework/wpf/controls/customizing-the-appearance-of-an-existing-control.md)   \n [Control Customization](../../../../docs/framework/wpf/controls/control-customization.md)","nodes":[{"pos":[12,82],"content":"Creating a Control That Has a Customizable Appearance | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Creating a Control That Has a Customizable Appearance | Microsoft Docs","pos":[0,70]}]},{"pos":[784,837],"content":"Creating a Control That Has a Customizable Appearance","linkify":"Creating a Control That Has a Customizable Appearance","nodes":[{"content":"Creating a Control That Has a Customizable Appearance","pos":[0,53]}]},{"content":"<bpt id=\"p1\">&lt;a name=\"introduction\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> <ph id=\"ph1\">[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]</ph> gives you the ability to create a control whose appearance can be customized.","pos":[838,1023],"source":"<a name=\"introduction\"></a> [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] gives you the ability to create a control whose appearance can be customized."},{"content":"For example, you can change the appearance of a <ph id=\"ph1\">&lt;xref:System.Windows.Controls.CheckBox&gt;</ph> beyond what setting properties will do by creating a new <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph>.","pos":[1024,1216],"source":" For example, you can change the appearance of a <xref:System.Windows.Controls.CheckBox> beyond what setting properties will do by creating a new <xref:System.Windows.Controls.ControlTemplate>."},{"content":"The following illustration shows a <ph id=\"ph1\">&lt;xref:System.Windows.Controls.CheckBox&gt;</ph> that uses a default <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> and a <ph id=\"ph3\">&lt;xref:System.Windows.Controls.CheckBox&gt;</ph> that uses a custom <ph id=\"ph4\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph>.","pos":[1217,1471],"source":" The following illustration shows a <xref:System.Windows.Controls.CheckBox> that uses a default <xref:System.Windows.Controls.ControlTemplate> and a <xref:System.Windows.Controls.CheckBox> that uses a custom <xref:System.Windows.Controls.ControlTemplate>."},{"content":"<bpt id=\"p1\">![</bpt>A checkbox with the default control template.<ept id=\"p1\">](../../../../docs/framework/wpf/controls/media/ndp-checkboxdefault.png \"NDP_CheckBoxDefault\")</ept>","pos":[1478,1619],"source":"![A checkbox with the default control template.](../../../../docs/framework/wpf/controls/media/ndp-checkboxdefault.png \"NDP_CheckBoxDefault\")"},{"content":"A CheckBox that uses the default control template","pos":[1622,1671]},{"content":"<bpt id=\"p1\">![</bpt>A checkbox with a custom control template.<ept id=\"p1\">](../../../../docs/framework/wpf/controls/media/ndp-checkboxcustom.png \"NDP_CheckBoxCustom\")</ept>","pos":[1678,1814],"source":"![A checkbox with a custom control template.](../../../../docs/framework/wpf/controls/media/ndp-checkboxcustom.png \"NDP_CheckBoxCustom\")"},{"content":"A CheckBox that uses a custom control template","pos":[1817,1863]},{"content":"If you follow the parts and states model when you create a control, your control's appearance will be customizable.","pos":[1870,1985]},{"content":"Designer tools such as Microsoft Expression Blend support the parts and states model, so when you follow this model your control will be customizable in those types of applications.","pos":[1986,2167]},{"content":"This topic discusses the parts and states model and how to follow it when you create your own control.","pos":[2169,2271]},{"content":"This topic uses an example of a custom control, <ph id=\"ph1\">`NumericUpDown`</ph>, to illustrate the philosophy of this model.","pos":[2272,2380],"source":" This topic uses an example of a custom control, `NumericUpDown`, to illustrate the philosophy of this model."},{"content":"The <ph id=\"ph1\">`NumericUpDown`</ph> control displays a numeric value, which a user can increase or decrease by clicking on the control's buttons.","pos":[2382,2511],"source":"  The `NumericUpDown` control displays a numeric value, which a user can increase or decrease by clicking on the control's buttons."},{"content":"The following illustration shows the <ph id=\"ph1\">`NumericUpDown`</ph> control that is discussed in this topic.","pos":[2513,2606],"source":"  The following illustration shows the `NumericUpDown` control that is discussed in this topic."},{"content":"<bpt id=\"p1\">![</bpt>NumericUpDown custom control.<ept id=\"p1\">](../../../../docs/framework/wpf/controls/media/ndp-numericupdown.png \"NDP_NumericUPDown\")</ept>","pos":[2613,2734],"source":"![NumericUpDown custom control.](../../../../docs/framework/wpf/controls/media/ndp-numericupdown.png \"NDP_NumericUPDown\")"},{"content":"A custom NumericUpDown control","pos":[2737,2767]},{"content":"This topic contains the following sections:","pos":[2774,2817]},{"pos":[2827,2858],"content":"<bpt id=\"p1\">[</bpt>Prerequisites<ept id=\"p1\">](#prerequisites)</ept>","source":"[Prerequisites](#prerequisites)"},{"pos":[2868,2917],"content":"<bpt id=\"p1\">[</bpt>Parts and States Model<ept id=\"p1\">](#parts_and_states_model)</ept>","source":"[Parts and States Model](#parts_and_states_model)"},{"pos":[2927,3098],"content":"<bpt id=\"p1\">[</bpt>Defining the Visual Structure and Visual Behavior of a Control in a ControlTemplate<ept id=\"p1\">](#defining_the_visual_structure_and_visual_behavior_of_a_control_in_a_controltemplate)</ept>","source":"[Defining the Visual Structure and Visual Behavior of a Control in a ControlTemplate](#defining_the_visual_structure_and_visual_behavior_of_a_control_in_a_controltemplate)"},{"pos":[3108,3197],"content":"<bpt id=\"p1\">[</bpt>Using Parts of the ControlTemplate in Code<ept id=\"p1\">](#using_parts_of_the_controltemplate_in_code)</ept>","source":"[Using Parts of the ControlTemplate in Code](#using_parts_of_the_controltemplate_in_code)"},{"pos":[3207,3272],"content":"<bpt id=\"p1\">[</bpt>Providing the Control Contract<ept id=\"p1\">](#providing_the_control_contract)</ept>","source":"[Providing the Control Contract](#providing_the_control_contract)"},{"pos":[3282,3319],"content":"<bpt id=\"p1\">[</bpt>Complete Example<ept id=\"p1\">](#complete_example)</ept>","source":"[Complete Example](#complete_example)"},{"pos":[3360,3373],"content":"Prerequisites","linkify":"Prerequisites","nodes":[{"content":"Prerequisites","pos":[0,13]}]},{"pos":[3377,3782],"content":"This topic assumes that you know how to create a new <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> for an existing control, are familiar with what the elements on a control contract are, and understand the concepts discussed in <bpt id=\"p1\">[</bpt>Customizing the Appearance of an Existing Control by Creating a ControlTemplate<ept id=\"p1\">](../../../../docs/framework/wpf/controls/customizing-the-appearance-of-an-existing-control.md)</ept>.","source":"This topic assumes that you know how to create a new <xref:System.Windows.Controls.ControlTemplate> for an existing control, are familiar with what the elements on a control contract are, and understand the concepts discussed in [Customizing the Appearance of an Existing Control by Creating a ControlTemplate](../../../../docs/framework/wpf/controls/customizing-the-appearance-of-an-existing-control.md)."},{"pos":[3790,4260],"content":"[!NOTE]\n To create a control that can have its appearance customized, you must create a control that inherits from the <xref:System.Windows.Controls.Control> class or one of its subclasses other than <xref:System.Windows.Controls.UserControl>.  A control that inherits from <xref:System.Windows.Controls.UserControl> is a control that can be quickly created, but it does not use a <xref:System.Windows.Controls.ControlTemplate> and you cannot customize its appearance.","leadings":["","> "],"nodes":[{"content":" To create a control that can have its appearance customized, you must create a control that inherits from the <xref:System.Windows.Controls.Control> class or one of its subclasses other than <xref:System.Windows.Controls.UserControl>.  A control that inherits from <xref:System.Windows.Controls.UserControl> is a control that can be quickly created, but it does not use a <xref:System.Windows.Controls.ControlTemplate> and you cannot customize its appearance.","pos":[8,468],"nodes":[{"content":"To create a control that can have its appearance customized, you must create a control that inherits from the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.Control&gt;</ph> class or one of its subclasses other than <ph id=\"ph2\">&lt;xref:System.Windows.Controls.UserControl&gt;</ph>.","pos":[1,235],"source":" To create a control that can have its appearance customized, you must create a control that inherits from the <xref:System.Windows.Controls.Control> class or one of its subclasses other than <xref:System.Windows.Controls.UserControl>."},{"content":"A control that inherits from <ph id=\"ph1\">&lt;xref:System.Windows.Controls.UserControl&gt;</ph> is a control that can be quickly created, but it does not use a <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> and you cannot customize its appearance.","pos":[237,460],"source":"  A control that inherits from <xref:System.Windows.Controls.UserControl> is a control that can be quickly created, but it does not use a <xref:System.Windows.Controls.ControlTemplate> and you cannot customize its appearance."}]}]},{"pos":[4310,4332],"content":"Parts and States Model","linkify":"Parts and States Model","nodes":[{"content":"Parts and States Model","pos":[0,22]}]},{"content":"The parts and states model specifies how to define the visual structure and visual behavior of a control.","pos":[4336,4441]},{"content":"To follow the parts and states model, you should do the following:","pos":[4442,4508]},{"content":"Define the visual structure and visual behavior in the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> of a control.","pos":[4518,4633],"source":"Define the visual structure and visual behavior in the <xref:System.Windows.Controls.ControlTemplate> of a control."},{"content":"Follow certain best practices when your control's logic interacts with parts of the control template.","pos":[4643,4744]},{"content":"Provide a control contract to specify what should be included in the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph>.","pos":[4754,4870],"source":"Provide a control contract to specify what should be included in the <xref:System.Windows.Controls.ControlTemplate>."},{"content":"When you define the visual structure and visual behavior in the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> of a control, application authors can change the visual structure and visual behavior of your control by creating a new <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> instead of writing code.","pos":[4877,5179],"source":"When you define the visual structure and visual behavior in the <xref:System.Windows.Controls.ControlTemplate> of a control, application authors can change the visual structure and visual behavior of your control by creating a new <xref:System.Windows.Controls.ControlTemplate> instead of writing code."},{"content":"You must provide a control contract that tells application authors which <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> objects and states should be defined in the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph>.","pos":[5182,5385],"source":"   You must provide a control contract that tells application authors which <xref:System.Windows.FrameworkElement> objects and states should be defined in the <xref:System.Windows.Controls.ControlTemplate>."},{"content":"You should follow some best practices when you interact with the parts in the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> so that your control properly handles an incomplete <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph>.","pos":[5386,5610],"source":" You should follow some best practices when you interact with the parts in the <xref:System.Windows.Controls.ControlTemplate> so that your control properly handles an incomplete <xref:System.Windows.Controls.ControlTemplate>."},{"content":"If you follow these three principles, application authors will be able to create a <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> for your control just as easily as they can for the controls that ship with <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph>.","pos":[5612,5900],"source":"  If you follow these three principles, application authors will be able to create a <xref:System.Windows.Controls.ControlTemplate> for your control just as easily as they can for the controls that ship with [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]."},{"content":"The following section explains each of these recommendations in detail.","pos":[5902,5973]},{"pos":[6084,6167],"content":"Defining the Visual Structure and Visual Behavior of a Control in a ControlTemplate","linkify":"Defining the Visual Structure and Visual Behavior of a Control in a ControlTemplate","nodes":[{"content":"Defining the Visual Structure and Visual Behavior of a Control in a ControlTemplate","pos":[0,83]}]},{"content":"When you create your custom control by using the parts and states model, you define the control's visual structure and visual behavior in its <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> instead of in its logic.","pos":[6171,6384],"source":"When you create your custom control by using the parts and states model, you define the control's visual structure and visual behavior in its <xref:System.Windows.Controls.ControlTemplate> instead of in its logic."},{"content":"The visual structure of a control is the composite of <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> objects that make up the control.","pos":[6386,6512],"source":"  The visual structure of a control is the composite of <xref:System.Windows.FrameworkElement> objects that make up the control."},{"content":"The visual behavior is the way the control appears when it is in a certain state.","pos":[6514,6595]},{"content":"For more information about creating a <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> that specifies the visual structure and visual behavior of a control, see <bpt id=\"p1\">[</bpt>Customizing the Appearance of an Existing Control by Creating a ControlTemplate<ept id=\"p1\">](../../../../docs/framework/wpf/controls/customizing-the-appearance-of-an-existing-control.md)</ept>.","pos":[6598,6933],"source":"   For more information about creating a <xref:System.Windows.Controls.ControlTemplate> that specifies the visual structure and visual behavior of a control, see [Customizing the Appearance of an Existing Control by Creating a ControlTemplate](../../../../docs/framework/wpf/controls/customizing-the-appearance-of-an-existing-control.md)."},{"content":"In the example of the <ph id=\"ph1\">`NumericUpDown`</ph> control, the visual structure includes two <ph id=\"ph2\">&lt;xref:System.Windows.Controls.Primitives.RepeatButton&gt;</ph> controls and a <ph id=\"ph3\">&lt;xref:System.Windows.Controls.TextBlock&gt;</ph>.","pos":[6940,7132],"source":"In the example of the `NumericUpDown` control, the visual structure includes two <xref:System.Windows.Controls.Primitives.RepeatButton> controls and a <xref:System.Windows.Controls.TextBlock>."},{"content":"If you add these controls in the code of the <ph id=\"ph1\">`NumericUpDown`</ph> control--in its constructor, for example--the positions of those controls would be unalterable.","pos":[7134,7290],"source":"  If you add these controls in the code of the `NumericUpDown` control--in its constructor, for example--the positions of those controls would be unalterable."},{"content":"Instead of defining the control's visual structure and visual behavior in its code, you should define it in the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph>.","pos":[7292,7451],"source":"  Instead of defining the control's visual structure and visual behavior in its code, you should define it in the <xref:System.Windows.Controls.ControlTemplate>."},{"content":"Then an application developer to customize the position of the buttons and <ph id=\"ph1\">&lt;xref:System.Windows.Controls.TextBlock&gt;</ph> and specify what behavior occurs when <ph id=\"ph2\">`Value`</ph> is negative because the <ph id=\"ph3\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> can be replaced.","pos":[7453,7702],"source":"  Then an application developer to customize the position of the buttons and <xref:System.Windows.Controls.TextBlock> and specify what behavior occurs when `Value` is negative because the <xref:System.Windows.Controls.ControlTemplate> can be replaced."},{"pos":[7709,8027],"content":"The following example shows the visual structure of the <ph id=\"ph1\">`NumericUpDown`</ph> control, which includes a <ph id=\"ph2\">&lt;xref:System.Windows.Controls.Primitives.RepeatButton&gt;</ph> to increase <ph id=\"ph3\">`Value`</ph>, a <ph id=\"ph4\">&lt;xref:System.Windows.Controls.Primitives.RepeatButton&gt;</ph> to decrease <ph id=\"ph5\">`Value`</ph>, and a <ph id=\"ph6\">&lt;xref:System.Windows.Controls.TextBlock&gt;</ph> to display <ph id=\"ph7\">`Value`</ph>.","source":"The following example shows the visual structure of the `NumericUpDown` control, which includes a <xref:System.Windows.Controls.Primitives.RepeatButton> to increase `Value`, a <xref:System.Windows.Controls.Primitives.RepeatButton> to decrease `Value`, and a <xref:System.Windows.Controls.TextBlock> to display `Value`."},{"pos":[8034,8185],"content":"<bpt id=\"p1\">[!code-xml</bpt><bpt id=\"p2\">[</bpt>VSMCustomControl#VisualStructure<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/window1.xaml#visualstructure)</ept><ept id=\"p1\">]</ept>","source":"[!code-xml[VSMCustomControl#VisualStructure](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/window1.xaml#visualstructure)]"},{"content":"A visual behavior of the <ph id=\"ph1\">`NumericUpDown`</ph> control is that the value is in a red font if it is negative.","pos":[8192,8294],"source":"A visual behavior of the `NumericUpDown` control is that the value is in a red font if it is negative."},{"content":"If you change the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.TextBlock.Foreground%2A&gt;</ph> of the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.TextBlock&gt;</ph> in code when the <ph id=\"ph3\">`Value`</ph> is negative, the <ph id=\"ph4\">`NumericUpDown`</ph> will always show a red negative value.","pos":[8296,8513],"source":"  If you change the <xref:System.Windows.Controls.TextBlock.Foreground%2A> of the <xref:System.Windows.Controls.TextBlock> in code when the `Value` is negative, the `NumericUpDown` will always show a red negative value."},{"content":"You specify the visual behavior of the control in the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> by adding <ph id=\"ph2\">&lt;xref:System.Windows.VisualState&gt;</ph> objects to the <ph id=\"ph3\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph>.","pos":[8514,8721],"source":" You specify the visual behavior of the control in the <xref:System.Windows.Controls.ControlTemplate> by adding <xref:System.Windows.VisualState> objects to the <xref:System.Windows.Controls.ControlTemplate>."},{"content":"The following example shows the <ph id=\"ph1\">&lt;xref:System.Windows.VisualState&gt;</ph> objects for the <ph id=\"ph2\">`Positive`</ph> and <ph id=\"ph3\">`Negative`</ph> states.","pos":[8723,8838],"source":"  The following example shows the <xref:System.Windows.VisualState> objects for the `Positive` and `Negative` states."},{"content":"<ph id=\"ph1\">`Positive`</ph> and <ph id=\"ph2\">`Negative`</ph> are mutually exclusive (the control is always in exactly one of the two), so the example puts the <ph id=\"ph3\">&lt;xref:System.Windows.VisualState&gt;</ph> objects into a single <ph id=\"ph4\">&lt;xref:System.Windows.VisualStateGroup&gt;</ph>.","pos":[8840,9059],"source":"`Positive` and `Negative` are mutually exclusive (the control is always in exactly one of the two), so the example puts the <xref:System.Windows.VisualState> objects into a single <xref:System.Windows.VisualStateGroup>."},{"content":"When the control goes into the <ph id=\"ph1\">`Negative`</ph> state, the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.TextBlock.Foreground%2A&gt;</ph> of the <ph id=\"ph3\">&lt;xref:System.Windows.Controls.TextBlock&gt;</ph> turns red.","pos":[9061,9227],"source":"  When the control goes into the `Negative` state, the <xref:System.Windows.Controls.TextBlock.Foreground%2A> of the <xref:System.Windows.Controls.TextBlock> turns red."},{"content":"When the control is in the <ph id=\"ph1\">`Positive`</ph> state, the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.TextBlock.Foreground%2A&gt;</ph> returns to it original value.","pos":[9229,9362],"source":"  When the control is in the `Positive` state, the <xref:System.Windows.Controls.TextBlock.Foreground%2A> returns to it original value."},{"content":"Defining <ph id=\"ph1\">&lt;xref:System.Windows.VisualState&gt;</ph> objects in a <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> is further discussed in <bpt id=\"p1\">[</bpt>Customizing the Appearance of an Existing Control by Creating a ControlTemplate<ept id=\"p1\">](../../../../docs/framework/wpf/controls/customizing-the-appearance-of-an-existing-control.md)</ept>.","pos":[9364,9667],"source":"  Defining <xref:System.Windows.VisualState> objects in a <xref:System.Windows.Controls.ControlTemplate> is further discussed in [Customizing the Appearance of an Existing Control by Creating a ControlTemplate](../../../../docs/framework/wpf/controls/customizing-the-appearance-of-an-existing-control.md)."},{"pos":[9675,9915],"content":"[!NOTE]\n Be sure to set the <xref:System.Windows.VisualStateManager.VisualStateGroups%2A?displayProperty=fullName> attached property on the root <xref:System.Windows.FrameworkElement> of the <xref:System.Windows.Controls.ControlTemplate>.","leadings":["","> "],"nodes":[{"content":"Be sure to set the <ph id=\"ph1\">&lt;xref:System.Windows.VisualStateManager.VisualStateGroups%2A?displayProperty=fullName&gt;</ph> attached property on the root <ph id=\"ph2\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> of the <ph id=\"ph3\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph>.","pos":[9,238],"source":" Be sure to set the <xref:System.Windows.VisualStateManager.VisualStateGroups%2A?displayProperty=fullName> attached property on the root <xref:System.Windows.FrameworkElement> of the <xref:System.Windows.Controls.ControlTemplate>."}]},{"pos":[9922,10065],"content":"<bpt id=\"p1\">[!code-xml</bpt><bpt id=\"p2\">[</bpt>VSMCustomControl#ValueStates<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/window1.xaml#valuestates)</ept><ept id=\"p1\">]</ept>","source":"[!code-xml[VSMCustomControl#ValueStates](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/window1.xaml#valuestates)]"},{"pos":[10135,10177],"content":"Using Parts of the ControlTemplate in Code","linkify":"Using Parts of the ControlTemplate in Code","nodes":[{"content":"Using Parts of the ControlTemplate in Code","pos":[0,42]}]},{"content":"A <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> author might omit <ph id=\"ph2\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.Windows.VisualState&gt;</ph> objects, either purposefully or by mistake, but your control's logic might need those parts to function properly.","pos":[10181,10437],"source":"A <xref:System.Windows.Controls.ControlTemplate> author might omit <xref:System.Windows.FrameworkElement> or <xref:System.Windows.VisualState> objects, either purposefully or by mistake, but your control's logic might need those parts to function properly."},{"content":"The parts and states model specifies that your control should be resilient to a <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> that is missing <ph id=\"ph2\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.Windows.VisualState&gt;</ph> objects.","pos":[10438,10665],"source":" The parts and states model specifies that your control should be resilient to a <xref:System.Windows.Controls.ControlTemplate> that is missing <xref:System.Windows.FrameworkElement> or <xref:System.Windows.VisualState> objects."},{"content":"Your control should not throw an exception or report an error if a <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.Windows.VisualState&gt;</ph>, or <ph id=\"ph3\">&lt;xref:System.Windows.VisualStateGroup&gt;</ph> is missing from the <ph id=\"ph4\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph>.","pos":[10667,10918],"source":"  Your control should not throw an exception or report an error if a <xref:System.Windows.FrameworkElement>, <xref:System.Windows.VisualState>, or <xref:System.Windows.VisualStateGroup> is missing from the <xref:System.Windows.Controls.ControlTemplate>."},{"content":"This section describes the recommended practices for interacting with <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> objects and managing states.","pos":[10919,11056],"source":" This section describes the recommended practices for interacting with <xref:System.Windows.FrameworkElement> objects and managing states."},{"pos":[11066,11109],"content":"Anticipate Missing FrameworkElement Objects","linkify":"Anticipate Missing FrameworkElement Objects","nodes":[{"content":"Anticipate Missing FrameworkElement Objects","pos":[0,43]}]},{"content":"When you define <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> objects in the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph>, your control's logic might need to interact with some of them.","pos":[11113,11293],"source":"When you define <xref:System.Windows.FrameworkElement> objects in the <xref:System.Windows.Controls.ControlTemplate>, your control's logic might need to interact with some of them."},{"content":"For example, the <ph id=\"ph1\">`NumericUpDown`</ph> control subscribes to the buttons' <ph id=\"ph2\">&lt;xref:System.Windows.Controls.Primitives.ButtonBase.Click&gt;</ph> event to increase or decrease <ph id=\"ph3\">`Value`</ph> and sets the <ph id=\"ph4\">&lt;xref:System.Windows.Controls.TextBlock.Text%2A&gt;</ph> property of the <ph id=\"ph5\">&lt;xref:System.Windows.Controls.TextBlock&gt;</ph> to <ph id=\"ph6\">`Value`</ph>.","pos":[11295,11590],"source":"  For example, the `NumericUpDown` control subscribes to the buttons' <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event to increase or decrease `Value` and sets the <xref:System.Windows.Controls.TextBlock.Text%2A> property of the <xref:System.Windows.Controls.TextBlock> to `Value`."},{"content":"If a custom <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> omits the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.TextBlock&gt;</ph> or buttons, it is acceptable that the control loses some of its functionality, but you should be sure that your control does not cause an error.","pos":[11591,11845],"source":" If a custom <xref:System.Windows.Controls.ControlTemplate> omits the <xref:System.Windows.Controls.TextBlock> or buttons, it is acceptable that the control loses some of its functionality, but you should be sure that your control does not cause an error."},{"content":"For example, if a <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> does not contain the buttons to change <ph id=\"ph2\">`Value`</ph>, the <ph id=\"ph3\">`NumericUpDown`</ph> loses that functionality, but an application that uses the <ph id=\"ph4\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> will continue to run.","pos":[11846,12106],"source":" For example, if a <xref:System.Windows.Controls.ControlTemplate> does not contain the buttons to change `Value`, the `NumericUpDown` loses that functionality, but an application that uses the <xref:System.Windows.Controls.ControlTemplate> will continue to run."},{"content":"The following practices will ensure that your control responds properly to missing <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> objects:","pos":[12113,12243],"source":"The following practices will ensure that your control responds properly to missing <xref:System.Windows.FrameworkElement> objects:"},{"pos":[12253,12363],"content":"Set the <ph id=\"ph1\">`x:Name`</ph> attribute for each <ph id=\"ph2\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> that you need to reference in code.","source":"Set the `x:Name` attribute for each <xref:System.Windows.FrameworkElement> that you need to reference in code."},{"content":"Define private properties for each <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> that you need to interact with.","pos":[12373,12478],"source":"Define private properties for each <xref:System.Windows.FrameworkElement> that you need to interact with."},{"content":"Subscribe to and unsubscribe from any events that your control handles in the <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> property's set accessor.","pos":[12488,12629],"source":"Subscribe to and unsubscribe from any events that your control handles in the <xref:System.Windows.FrameworkElement> property's set accessor."},{"content":"Set the <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> properties that you defined in step 2 in the <ph id=\"ph2\">&lt;xref:System.Windows.FrameworkElement.OnApplyTemplate%2A&gt;</ph> method.","pos":[12639,12796],"source":"Set the <xref:System.Windows.FrameworkElement> properties that you defined in step 2 in the <xref:System.Windows.FrameworkElement.OnApplyTemplate%2A> method."},{"content":"This is the earliest that the <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> in the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> is available to the control.","pos":[12797,12948],"source":" This is the earliest that the <xref:System.Windows.FrameworkElement> in the <xref:System.Windows.Controls.ControlTemplate> is available to the control."},{"content":"Use the <ph id=\"ph1\">`x:Name`</ph> of the <ph id=\"ph2\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> to get it from the <ph id=\"ph3\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph>.","pos":[12949,13078],"source":" Use the `x:Name` of the <xref:System.Windows.FrameworkElement> to get it from the <xref:System.Windows.Controls.ControlTemplate>."},{"content":"Check that the <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> is not <ph id=\"ph2\">`null`</ph> before accessing its members.","pos":[13088,13185],"source":"Check that the <xref:System.Windows.FrameworkElement> is not `null` before accessing its members."},{"content":"If it is <ph id=\"ph1\">`null`</ph>, do not report an error.","pos":[13187,13227],"source":"  If it is `null`, do not report an error."},{"pos":[13234,13417],"content":"The following examples show how the <ph id=\"ph1\">`NumericUpDown`</ph> control interacts with <ph id=\"ph2\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> objects in accordance with the recommendations in the preceding list.","source":"The following examples show how the `NumericUpDown` control interacts with <xref:System.Windows.FrameworkElement> objects in accordance with the recommendations in the preceding list."},{"content":"In the example that defines the visual structure of the <ph id=\"ph1\">`NumericUpDown`</ph> control in the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph>, the <ph id=\"ph3\">&lt;xref:System.Windows.Controls.Primitives.RepeatButton&gt;</ph> that increases <ph id=\"ph4\">`Value`</ph> has its <ph id=\"ph5\">`x:Name`</ph> attribute set to <ph id=\"ph6\">`UpButton`</ph>.","pos":[13424,13686],"source":"In the example that defines the visual structure of the `NumericUpDown` control in the <xref:System.Windows.Controls.ControlTemplate>, the <xref:System.Windows.Controls.Primitives.RepeatButton> that increases `Value` has its `x:Name` attribute set to `UpButton`."},{"content":"The following example declares a property called <ph id=\"ph1\">`UpButtonElement`</ph> that represents the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.Primitives.RepeatButton&gt;</ph> that is declared in the <ph id=\"ph3\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph>.","pos":[13688,13901],"source":"  The following example declares a property called `UpButtonElement` that represents the <xref:System.Windows.Controls.Primitives.RepeatButton> that is declared in the <xref:System.Windows.Controls.ControlTemplate>."},{"content":"The <ph id=\"ph1\">`set`</ph> accessor first unsubscribes to the button's <ph id=\"ph2\">&lt;xref:System.Windows.Controls.Primitives.ButtonBase.Click&gt;</ph> event if <ph id=\"ph3\">`UpDownElement`</ph> is not <ph id=\"ph4\">`null`</ph>, then it sets the property, and then it subscribes to the <ph id=\"ph5\">&lt;xref:System.Windows.Controls.Primitives.ButtonBase.Click&gt;</ph> event.","pos":[13902,14177],"source":" The `set` accessor first unsubscribes to the button's <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event if `UpDownElement` is not `null`, then it sets the property, and then it subscribes to the <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event."},{"content":"There is also a property defined, but not shown here, for the other <ph id=\"ph1\">&lt;xref:System.Windows.Controls.Primitives.RepeatButton&gt;</ph>, called <ph id=\"ph2\">`DownButtonElement`</ph>.","pos":[14178,14329],"source":" There is also a property defined, but not shown here, for the other <xref:System.Windows.Controls.Primitives.RepeatButton>, called `DownButtonElement`."},{"pos":[14336,14664],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>VSMCustomControl#UpButtonProperty<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#upbuttonproperty)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>VSMCustomControl#UpButtonProperty<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#upbuttonproperty)</ept><ept id=\"p3\">]</ept>","leadings":[""," "],"source":"[!code-csharp[VSMCustomControl#UpButtonProperty](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#upbuttonproperty)]\n[!code-vb[VSMCustomControl#UpButtonProperty](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#upbuttonproperty)]"},{"content":"The following example shows the <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement.OnApplyTemplate%2A&gt;</ph> for the <ph id=\"ph2\">`NumericUpDown`</ph> control.","pos":[14671,14793],"source":"The following example shows the <xref:System.Windows.FrameworkElement.OnApplyTemplate%2A> for the `NumericUpDown` control."},{"content":"The example uses the <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement.GetTemplateChild%2A&gt;</ph> method to get the <ph id=\"ph2\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> objects from the <ph id=\"ph3\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph>.","pos":[14795,14996],"source":"  The example uses the <xref:System.Windows.FrameworkElement.GetTemplateChild%2A> method to get the <xref:System.Windows.FrameworkElement> objects from the <xref:System.Windows.Controls.ControlTemplate>."},{"content":"Notice that the example guards against cases where <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement.GetTemplateChild%2A&gt;</ph> finds a <ph id=\"ph2\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> with the specified name that is not of the expected type.","pos":[14998,15212],"source":"  Notice that the example guards against cases where <xref:System.Windows.FrameworkElement.GetTemplateChild%2A> finds a <xref:System.Windows.FrameworkElement> with the specified name that is not of the expected type."},{"content":"It is also a best practice to ignore elements that have the specified <ph id=\"ph1\">`x:Name`</ph> but are of the wrong type.","pos":[15213,15318],"source":" It is also a best practice to ignore elements that have the specified `x:Name` but are of the wrong type."},{"pos":[15325,15641],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>VSMCustomControl#ApplyTemplate<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#applytemplate)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>VSMCustomControl#ApplyTemplate<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#applytemplate)</ept><ept id=\"p3\">]</ept>","leadings":[""," "],"source":"[!code-csharp[VSMCustomControl#ApplyTemplate](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#applytemplate)]\n[!code-vb[VSMCustomControl#ApplyTemplate](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#applytemplate)]"},{"content":"By following the practices that are shown in the previous examples, you ensure that your control will continue to run when the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> is missing a <ph id=\"ph2\">&lt;xref:System.Windows.FrameworkElement&gt;</ph>.","pos":[15648,15874],"source":"By following the practices that are shown in the previous examples, you ensure that your control will continue to run when the <xref:System.Windows.Controls.ControlTemplate> is missing a <xref:System.Windows.FrameworkElement>."},{"pos":[15884,15927],"content":"Use the VisualStateManager to Manage States","linkify":"Use the VisualStateManager to Manage States","nodes":[{"content":"Use the VisualStateManager to Manage States","pos":[0,43]}]},{"content":"The<ph id=\"ph1\">&lt;xref:System.Windows.VisualStateManager&gt;</ph> keeps track of the states of a control and performs the logic necessary to transition between states.","pos":[15931,16076],"source":"The<xref:System.Windows.VisualStateManager> keeps track of the states of a control and performs the logic necessary to transition between states."},{"content":"When you add <ph id=\"ph1\">&lt;xref:System.Windows.VisualState&gt;</ph> objects to the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph>, you add them to a <ph id=\"ph3\">&lt;xref:System.Windows.VisualStateGroup&gt;</ph> and add the <ph id=\"ph4\">&lt;xref:System.Windows.VisualStateGroup&gt;</ph> to the <ph id=\"ph5\">&lt;xref:System.Windows.VisualStateManager.VisualStateGroups%2A?displayProperty=fullName&gt;</ph> attached property so that the <ph id=\"ph6\">&lt;xref:System.Windows.VisualStateManager&gt;</ph> has access to them.","pos":[16077,16479],"source":" When you add <xref:System.Windows.VisualState> objects to the <xref:System.Windows.Controls.ControlTemplate>, you add them to a <xref:System.Windows.VisualStateGroup> and add the <xref:System.Windows.VisualStateGroup> to the <xref:System.Windows.VisualStateManager.VisualStateGroups%2A?displayProperty=fullName> attached property so that the <xref:System.Windows.VisualStateManager> has access to them."},{"content":"The following example repeats the previous example that shows the <ph id=\"ph1\">&lt;xref:System.Windows.VisualState&gt;</ph> objects that corresponds to the <ph id=\"ph2\">`Positive`</ph> and <ph id=\"ph3\">`Negative`</ph> states of the control.","pos":[16486,16666],"source":"The following example repeats the previous example that shows the <xref:System.Windows.VisualState> objects that corresponds to the `Positive` and `Negative` states of the control."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Windows.Media.Animation.Storyboard&gt;</ph> in the <ph id=\"ph2\">`Negative`</ph><ph id=\"ph3\">&lt;xref:System.Windows.VisualState&gt;</ph> turns the <ph id=\"ph4\">&lt;xref:System.Windows.Controls.TextBlock.Foreground%2A&gt;</ph> of the <ph id=\"ph5\">&lt;xref:System.Windows.Controls.TextBlock&gt;</ph> red.","pos":[16667,16888],"source":" The <xref:System.Windows.Media.Animation.Storyboard> in the `Negative`<xref:System.Windows.VisualState> turns the <xref:System.Windows.Controls.TextBlock.Foreground%2A> of the <xref:System.Windows.Controls.TextBlock> red."},{"content":"When the <ph id=\"ph1\">`NumericUpDown`</ph> control is in the <ph id=\"ph2\">`Negative`</ph> state, the storyboard in the <ph id=\"ph3\">`Negative`</ph> state begins.","pos":[16891,16998],"source":"   When the `NumericUpDown` control is in the `Negative` state, the storyboard in the `Negative` state begins."},{"content":"Then the <ph id=\"ph1\">&lt;xref:System.Windows.Media.Animation.Storyboard&gt;</ph> in the <ph id=\"ph2\">`Negative`</ph> state stops when the control returns to the <ph id=\"ph3\">`Positive`</ph> state.","pos":[17000,17137],"source":"  Then the <xref:System.Windows.Media.Animation.Storyboard> in the `Negative` state stops when the control returns to the `Positive` state."},{"content":"The <ph id=\"ph1\">`Positive`</ph><ph id=\"ph2\">&lt;xref:System.Windows.VisualState&gt;</ph> does not need to contain a <ph id=\"ph3\">&lt;xref:System.Windows.Media.Animation.Storyboard&gt;</ph> because when the <ph id=\"ph4\">&lt;xref:System.Windows.Media.Animation.Storyboard&gt;</ph> for the <ph id=\"ph5\">`Negative`</ph> stops, the <ph id=\"ph6\">&lt;xref:System.Windows.Controls.TextBlock.Foreground%2A&gt;</ph> returns to its original color.","pos":[17139,17444],"source":"  The `Positive`<xref:System.Windows.VisualState> does not need to contain a <xref:System.Windows.Media.Animation.Storyboard> because when the <xref:System.Windows.Media.Animation.Storyboard> for the `Negative` stops, the <xref:System.Windows.Controls.TextBlock.Foreground%2A> returns to its original color."},{"pos":[17451,17594],"content":"<bpt id=\"p1\">[!code-xml</bpt><bpt id=\"p2\">[</bpt>VSMCustomControl#ValueStates<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/window1.xaml#valuestates)</ept><ept id=\"p1\">]</ept>","source":"[!code-xml[VSMCustomControl#ValueStates](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/window1.xaml#valuestates)]"},{"content":"Note that the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.TextBlock&gt;</ph> is given a name, but the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.TextBlock&gt;</ph> is not in the control contract for <ph id=\"ph3\">`NumericUpDown`</ph> because the control's logic never references the <ph id=\"ph4\">&lt;xref:System.Windows.Controls.TextBlock&gt;</ph>.","pos":[17601,17863],"source":"Note that the <xref:System.Windows.Controls.TextBlock> is given a name, but the <xref:System.Windows.Controls.TextBlock> is not in the control contract for `NumericUpDown` because the control's logic never references the <xref:System.Windows.Controls.TextBlock>."},{"content":"Elements that are referenced in the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> have names, but do not need to be part of the control contract because a new <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> for the control might not need to reference that element.","pos":[17865,18129],"source":"  Elements that are referenced in the <xref:System.Windows.Controls.ControlTemplate> have names, but do not need to be part of the control contract because a new <xref:System.Windows.Controls.ControlTemplate> for the control might not need to reference that element."},{"content":"For example, someone who creates a new <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> for <ph id=\"ph2\">`NumericUpDown`</ph> might decide to not indicate that <ph id=\"ph3\">`Value`</ph> is negative by changing the <ph id=\"ph4\">&lt;xref:System.Windows.Controls.Control.Foreground%2A&gt;</ph>.","pos":[18131,18360],"source":"  For example, someone who creates a new <xref:System.Windows.Controls.ControlTemplate> for `NumericUpDown` might decide to not indicate that `Value` is negative by changing the <xref:System.Windows.Controls.Control.Foreground%2A>."},{"content":"In that case, neither the code nor the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> references the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.TextBlock&gt;</ph> by name.","pos":[18362,18512],"source":"  In that case, neither the code nor the <xref:System.Windows.Controls.ControlTemplate> references the <xref:System.Windows.Controls.TextBlock> by name."},{"content":"The control's logic is responsible for changing the control's state.","pos":[18519,18587]},{"content":"The following example shows that the <ph id=\"ph1\">`NumericUpDown`</ph> control calls the <ph id=\"ph2\">&lt;xref:System.Windows.VisualStateManager.GoToState%2A&gt;</ph> method to go into the <ph id=\"ph3\">`Positive`</ph> state when <ph id=\"ph4\">`Value`</ph> is 0 or greater, and the <ph id=\"ph5\">`Negative`</ph> state when <ph id=\"ph6\">`Value`</ph> is less than 0.","pos":[18588,18835],"source":" The following example shows that the `NumericUpDown` control calls the <xref:System.Windows.VisualStateManager.GoToState%2A> method to go into the `Positive` state when `Value` is 0 or greater, and the `Negative` state when `Value` is less than 0."},{"pos":[18842,19170],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>VSMCustomControl#ValueStateChange<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#valuestatechange)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>VSMCustomControl#ValueStateChange<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#valuestatechange)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[VSMCustomControl#ValueStateChange](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#valuestatechange)]\n [!code-vb[VSMCustomControl#ValueStateChange](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#valuestatechange)]"},{"content":"The <ph id=\"ph1\">&lt;xref:System.Windows.VisualStateManager.GoToState%2A&gt;</ph> method performs the logic necessary to start and stop the storyboards appropriately.","pos":[19177,19319],"source":"The <xref:System.Windows.VisualStateManager.GoToState%2A> method performs the logic necessary to start and stop the storyboards appropriately."},{"content":"When a control calls <ph id=\"ph1\">&lt;xref:System.Windows.VisualStateManager.GoToState%2A&gt;</ph> to change its state, the <ph id=\"ph2\">&lt;xref:System.Windows.VisualStateManager&gt;</ph> does the following:","pos":[19320,19480],"source":" When a control calls <xref:System.Windows.VisualStateManager.GoToState%2A> to change its state, the <xref:System.Windows.VisualStateManager> does the following:"},{"content":"If the <ph id=\"ph1\">&lt;xref:System.Windows.VisualState&gt;</ph> that the control is going to has a <ph id=\"ph2\">&lt;xref:System.Windows.Media.Animation.Storyboard&gt;</ph>, the storyboard begins.","pos":[19490,19638],"source":"If the <xref:System.Windows.VisualState> that the control is going to has a <xref:System.Windows.Media.Animation.Storyboard>, the storyboard begins."},{"content":"Then, if the <ph id=\"ph1\">&lt;xref:System.Windows.VisualState&gt;</ph> that the control is coming from has a <ph id=\"ph2\">&lt;xref:System.Windows.Media.Animation.Storyboard&gt;</ph>, the storyboard ends.","pos":[19639,19794],"source":" Then, if the <xref:System.Windows.VisualState> that the control is coming from has a <xref:System.Windows.Media.Animation.Storyboard>, the storyboard ends."},{"pos":[19804,19951],"content":"If the control is already in the state that is specified, <ph id=\"ph1\">&lt;xref:System.Windows.VisualStateManager.GoToState%2A&gt;</ph> takes no action and returns <ph id=\"ph2\">`true`</ph>.","source":"If the control is already in the state that is specified, <xref:System.Windows.VisualStateManager.GoToState%2A> takes no action and returns `true`."},{"pos":[19961,20160],"content":"If state that is specified doesn't exist in the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> of <ph id=\"ph2\">`control`</ph>, <ph id=\"ph3\">&lt;xref:System.Windows.VisualStateManager.GoToState%2A&gt;</ph> takes no action and returns <ph id=\"ph4\">`false`</ph>.","source":"If state that is specified doesn't exist in the <xref:System.Windows.Controls.ControlTemplate> of `control`, <xref:System.Windows.VisualStateManager.GoToState%2A> takes no action and returns `false`."},{"pos":[20171,20225],"content":"Best Practices for Working with the VisualStateManager","linkify":"Best Practices for Working with the VisualStateManager","nodes":[{"content":"Best Practices for Working with the VisualStateManager","pos":[0,54]}]},{"content":"It is recommended that you do the following to maintain your control's states:","pos":[20229,20307]},{"content":"Use properties to track its state.","pos":[20317,20351]},{"content":"Create a helper method to transition between states.","pos":[20361,20413]},{"content":"The <ph id=\"ph1\">`NumericUpDown`</ph> control uses its <ph id=\"ph2\">`Value`</ph> property to track whether it is in the <ph id=\"ph3\">`Positive`</ph> or <ph id=\"ph4\">`Negative`</ph> state.","pos":[20420,20535],"source":"The `NumericUpDown` control uses its `Value` property to track whether it is in the `Positive` or `Negative` state."},{"content":"The <ph id=\"ph1\">`NumericUpDown`</ph> control also defines the <ph id=\"ph2\">`Focused`</ph> and <ph id=\"ph3\">`UnFocused`</ph> states, which tracks the <ph id=\"ph4\">&lt;xref:System.Windows.UIElement.IsFocused%2A&gt;</ph> property.","pos":[20537,20687],"source":"  The `NumericUpDown` control also defines the `Focused` and `UnFocused` states, which tracks the <xref:System.Windows.UIElement.IsFocused%2A> property."},{"content":"If you use states that do not naturally correspond to a property of the control, you can define a private property to track the state.","pos":[20688,20822]},{"content":"A single method that updates all the states centralizes calls to the <ph id=\"ph1\">&lt;xref:System.Windows.VisualStateManager&gt;</ph> and keeps your code manageable.","pos":[20829,20970],"source":"A single method that updates all the states centralizes calls to the <xref:System.Windows.VisualStateManager> and keeps your code manageable."},{"content":"The following example shows the <ph id=\"ph1\">`NumericUpDown`</ph> control's helper method, <ph id=\"ph2\">`UpdateStates`</ph>.","pos":[20971,21059],"source":" The following example shows the `NumericUpDown` control's helper method, `UpdateStates`."},{"content":"When <ph id=\"ph1\">`Value`</ph> is greater than or equal to 0, the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.Control&gt;</ph> is in the <ph id=\"ph3\">`Positive`</ph> state.","pos":[21060,21174],"source":" When `Value` is greater than or equal to 0, the <xref:System.Windows.Controls.Control> is in the `Positive` state."},{"content":"When <ph id=\"ph1\">`Value`</ph> is less than 0, the control is in the <ph id=\"ph2\">`Negative`</ph> state.","pos":[21176,21244],"source":"  When `Value` is less than 0, the control is in the `Negative` state."},{"content":"When <ph id=\"ph1\">&lt;xref:System.Windows.UIElement.IsFocused%2A&gt;</ph> is <ph id=\"ph2\">`true`</ph>, the control is in the <ph id=\"ph3\">`Focused`</ph> state; otherwise, it is in the <ph id=\"ph4\">`Unfocused`</ph> state.","pos":[21246,21388],"source":"  When <xref:System.Windows.UIElement.IsFocused%2A> is `true`, the control is in the `Focused` state; otherwise, it is in the `Unfocused` state."},{"content":"The control can call <ph id=\"ph1\">`UpdateStates`</ph> whenever it needs to change its state, regardless of what state changes.","pos":[21390,21498],"source":"  The control can call `UpdateStates` whenever it needs to change its state, regardless of what state changes."},{"pos":[21505,21817],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>VSMCustomControl#UpdateStates<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#updatestates)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>VSMCustomControl#UpdateStates<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#updatestates)</ept><ept id=\"p3\">]</ept>","leadings":[""," "],"source":"[!code-csharp[VSMCustomControl#UpdateStates](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#updatestates)]\n[!code-vb[VSMCustomControl#UpdateStates](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#updatestates)]"},{"content":"If you pass a state name to <ph id=\"ph1\">&lt;xref:System.Windows.VisualStateManager.GoToState%2A&gt;</ph> when the control is already in that state, <ph id=\"ph2\">&lt;xref:System.Windows.VisualStateManager.GoToState%2A&gt;</ph> does nothing, so you don't need to check for the control's current state.","pos":[21824,22076],"source":"If you pass a state name to <xref:System.Windows.VisualStateManager.GoToState%2A> when the control is already in that state, <xref:System.Windows.VisualStateManager.GoToState%2A> does nothing, so you don't need to check for the control's current state."},{"content":"For example, if <ph id=\"ph1\">`Value`</ph> changes from one negative number to another negative number, the storyboard for the <ph id=\"ph2\">`Negative`</ph> state is not interrupted and the user will not see a change in the control.","pos":[22078,22272],"source":"  For example, if `Value` changes from one negative number to another negative number, the storyboard for the `Negative` state is not interrupted and the user will not see a change in the control."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Windows.VisualStateManager&gt;</ph> uses <ph id=\"ph2\">&lt;xref:System.Windows.VisualStateGroup&gt;</ph> objects to determine which state to exit when you call <ph id=\"ph3\">&lt;xref:System.Windows.VisualStateManager.GoToState%2A&gt;</ph>.","pos":[22279,22477],"source":"The <xref:System.Windows.VisualStateManager> uses <xref:System.Windows.VisualStateGroup> objects to determine which state to exit when you call <xref:System.Windows.VisualStateManager.GoToState%2A>."},{"content":"The control is always in one state for each <ph id=\"ph1\">&lt;xref:System.Windows.VisualStateGroup&gt;</ph> that is defined in its <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> and only leaves a state when it goes into another state from the same <ph id=\"ph3\">&lt;xref:System.Windows.VisualStateGroup&gt;</ph>.","pos":[22478,22740],"source":" The control is always in one state for each <xref:System.Windows.VisualStateGroup> that is defined in its <xref:System.Windows.Controls.ControlTemplate> and only leaves a state when it goes into another state from the same <xref:System.Windows.VisualStateGroup>."},{"content":"For example, the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> of the <ph id=\"ph2\">`NumericUpDown`</ph> control defines the <ph id=\"ph3\">`Positive`</ph> and <ph id=\"ph4\">`Negative`</ph><ph id=\"ph5\">&lt;xref:System.Windows.VisualState&gt;</ph> objects in one <ph id=\"ph6\">&lt;xref:System.Windows.VisualStateGroup&gt;</ph> and the <ph id=\"ph7\">`Focused`</ph> and <ph id=\"ph8\">`Unfocused`</ph><ph id=\"ph9\">&lt;xref:System.Windows.VisualState&gt;</ph> objects in another.","pos":[22741,23047],"source":" For example, the <xref:System.Windows.Controls.ControlTemplate> of the `NumericUpDown` control defines the `Positive` and `Negative`<xref:System.Windows.VisualState> objects in one <xref:System.Windows.VisualStateGroup> and the `Focused` and `Unfocused`<xref:System.Windows.VisualState> objects in another."},{"content":"(You can see the <ph id=\"ph1\">`Focused`</ph> and <ph id=\"ph2\">`Unfocused`</ph><ph id=\"ph3\">&lt;xref:System.Windows.VisualState&gt;</ph> defined in the <bpt id=\"p1\">[</bpt>Complete Example<ept id=\"p1\">](#complete_example)</ept> section in this topic When the control goes from the <ph id=\"ph4\">`Positive`</ph> state to the <ph id=\"ph5\">`Negative`</ph> state, or vice versa, the control remains in either the <ph id=\"ph6\">`Focused`</ph> or <ph id=\"ph7\">`Unfocused`</ph> state.","pos":[23048,23352],"source":" (You can see the `Focused` and `Unfocused`<xref:System.Windows.VisualState> defined in the [Complete Example](#complete_example) section in this topic When the control goes from the `Positive` state to the `Negative` state, or vice versa, the control remains in either the `Focused` or `Unfocused` state."},{"content":"There are three typical places where the state of a control might change:","pos":[23359,23432]},{"content":"When the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> is applied to the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.Control&gt;</ph>.","pos":[23442,23555],"source":"When the <xref:System.Windows.Controls.ControlTemplate> is applied to the <xref:System.Windows.Controls.Control>."},{"content":"When a property changes.","pos":[23565,23589]},{"content":"When an event occurs.","pos":[23599,23620]},{"pos":[23627,23727],"content":"The following examples demonstrate updating the state of the <ph id=\"ph1\">`NumericUpDown`</ph> control in these cases.","source":"The following examples demonstrate updating the state of the `NumericUpDown` control in these cases."},{"content":"You should update the state of the control in the <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement.OnApplyTemplate%2A&gt;</ph> method so that the control appears in the correct state when the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> is applied.","pos":[23734,23965],"source":"You should update the state of the control in the <xref:System.Windows.FrameworkElement.OnApplyTemplate%2A> method so that the control appears in the correct state when the <xref:System.Windows.Controls.ControlTemplate> is applied."},{"content":"The following example calls <ph id=\"ph1\">`UpdateStates`</ph> in <ph id=\"ph2\">&lt;xref:System.Windows.FrameworkElement.OnApplyTemplate%2A&gt;</ph> to ensure that the control is in the appropriate states.","pos":[23966,24126],"source":" The following example calls `UpdateStates` in <xref:System.Windows.FrameworkElement.OnApplyTemplate%2A> to ensure that the control is in the appropriate states."},{"content":"For example, suppose that you create a <ph id=\"ph1\">`NumericUpDown`</ph> control, and then set its <ph id=\"ph2\">&lt;xref:System.Windows.Controls.Control.Foreground%2A&gt;</ph> to green and <ph id=\"ph3\">`Value`</ph> to -5.","pos":[24128,24289],"source":"  For example, suppose that you create a `NumericUpDown` control, and then set its <xref:System.Windows.Controls.Control.Foreground%2A> to green and `Value` to -5."},{"content":"If you do not call <ph id=\"ph1\">`UpdateStates`</ph> when the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> is applied to the <ph id=\"ph3\">`NumericUpDown`</ph> control, the control is not in the <ph id=\"ph4\">`Negative`</ph> state and the value is green instead of red.","pos":[24291,24505],"source":"  If you do not call `UpdateStates` when the <xref:System.Windows.Controls.ControlTemplate> is applied to the `NumericUpDown` control, the control is not in the `Negative` state and the value is green instead of red."},{"content":"You must call <ph id=\"ph1\">`UpdateStates`</ph> to put the control in the <ph id=\"ph2\">`Negative`</ph> state.","pos":[24507,24579],"source":"  You must call `UpdateStates` to put the control in the `Negative` state."},{"pos":[24586,24902],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>VSMCustomControl#ApplyTemplate<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#applytemplate)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>VSMCustomControl#ApplyTemplate<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#applytemplate)</ept><ept id=\"p3\">]</ept>","leadings":[""," "],"source":"[!code-csharp[VSMCustomControl#ApplyTemplate](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#applytemplate)]\n[!code-vb[VSMCustomControl#ApplyTemplate](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#applytemplate)]"},{"content":"You often need to update the states of a control when a property changes.","pos":[24909,24982]},{"content":"The following example shows the entire <ph id=\"ph1\">`ValueChangedCallback`</ph> method.","pos":[24983,25052],"source":" The following example shows the entire `ValueChangedCallback` method."},{"content":"Because <ph id=\"ph1\">`ValueChangedCallback`</ph> is called when <ph id=\"ph2\">`Value`</ph> changes, the method calls <ph id=\"ph3\">`UpdateStates`</ph> in case <ph id=\"ph4\">`Value`</ph> changed from positive to negative or vice versa.","pos":[25053,25212],"source":" Because `ValueChangedCallback` is called when `Value` changes, the method calls `UpdateStates` in case `Value` changed from positive to negative or vice versa."},{"content":"It is acceptable to call <ph id=\"ph1\">`UpdateStates`</ph> when <ph id=\"ph2\">`Value`</ph> changes but remains positive or negative because in that case, the control will not change states.","pos":[25213,25364],"source":" It is acceptable to call `UpdateStates` when `Value` changes but remains positive or negative because in that case, the control will not change states."},{"pos":[25371,25739],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>VSMCustomControl#EntireValueChangedCallback<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#entirevaluechangedcallback)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>VSMCustomControl#EntireValueChangedCallback<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#entirevaluechangedcallback)</ept><ept id=\"p3\">]</ept>","leadings":[""," "],"source":"[!code-csharp[VSMCustomControl#EntireValueChangedCallback](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#entirevaluechangedcallback)]\n[!code-vb[VSMCustomControl#EntireValueChangedCallback](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#entirevaluechangedcallback)]"},{"content":"You might also need to update states when an event occurs.","pos":[25746,25804]},{"content":"The following example shows that the <ph id=\"ph1\">`NumericUpDown`</ph> calls <ph id=\"ph2\">`UpdateStates`</ph> on the <ph id=\"ph3\">&lt;xref:System.Windows.Controls.Control&gt;</ph> to handle the <ph id=\"ph4\">&lt;xref:System.Windows.UIElement.GotFocus&gt;</ph> event.","pos":[25805,25986],"source":" The following example shows that the `NumericUpDown` calls `UpdateStates` on the <xref:System.Windows.Controls.Control> to handle the <xref:System.Windows.UIElement.GotFocus> event."},{"pos":[25993,26297],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>VSMCustomControl#OnGotFocus<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#ongotfocus)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>VSMCustomControl#OnGotFocus<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#ongotfocus)</ept><ept id=\"p3\">]</ept>","leadings":[""," "],"source":"[!code-csharp[VSMCustomControl#OnGotFocus](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#ongotfocus)]\n[!code-vb[VSMCustomControl#OnGotFocus](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#ongotfocus)]"},{"content":"The <ph id=\"ph1\">&lt;xref:System.Windows.VisualStateManager&gt;</ph> helps you manage your control's states.","pos":[26304,26388],"source":"The <xref:System.Windows.VisualStateManager> helps you manage your control's states."},{"content":"By using the <ph id=\"ph1\">&lt;xref:System.Windows.VisualStateManager&gt;</ph>, you ensure that your control correctly transitions between states.","pos":[26389,26510],"source":" By using the <xref:System.Windows.VisualStateManager>, you ensure that your control correctly transitions between states."},{"content":"If you follow the recommendations described in this section for working with the <ph id=\"ph1\">&lt;xref:System.Windows.VisualStateManager&gt;</ph>, your control's code will remain readable and maintainable.","pos":[26512,26693],"source":"  If you follow the recommendations described in this section for working with the <xref:System.Windows.VisualStateManager>, your control's code will remain readable and maintainable."},{"pos":[26751,26781],"content":"Providing the Control Contract","linkify":"Providing the Control Contract","nodes":[{"content":"Providing the Control Contract","pos":[0,30]}]},{"content":"You provide a control contract so that <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> authors will know what to put in the template.","pos":[26785,26917],"source":"You provide a control contract so that <xref:System.Windows.Controls.ControlTemplate> authors will know what to put in the template."},{"content":"A control contract has three elements:","pos":[26918,26956]},{"content":"The visual elements that the control's logic uses.","pos":[26966,27016]},{"content":"The states of the control and the group each state belongs to.","pos":[27026,27088]},{"content":"The public properties that visually affect the control.","pos":[27098,27153]},{"content":"Someone that creates a new <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> needs to know what <ph id=\"ph2\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> objects the control's logic uses, what type each object is, and what its name is.","pos":[27160,27373],"source":"Someone that creates a new <xref:System.Windows.Controls.ControlTemplate> needs to know what <xref:System.Windows.FrameworkElement> objects the control's logic uses, what type each object is, and what its name is."},{"content":"A <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> author also needs to know the name of each possible state the control can be in, and which <ph id=\"ph2\">&lt;xref:System.Windows.VisualStateGroup&gt;</ph> the state is in.","pos":[27374,27569],"source":" A <xref:System.Windows.Controls.ControlTemplate> author also needs to know the name of each possible state the control can be in, and which <xref:System.Windows.VisualStateGroup> the state is in."},{"pos":[27576,27758],"content":"Returning to the <ph id=\"ph1\">`NumericUpDown`</ph> example, the control expects the <ph id=\"ph2\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> to have the following <ph id=\"ph3\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> objects:","source":"Returning to the `NumericUpDown` example, the control expects the <xref:System.Windows.Controls.ControlTemplate> to have the following <xref:System.Windows.FrameworkElement> objects:"},{"pos":[27768,27843],"content":"A <ph id=\"ph1\">&lt;xref:System.Windows.Controls.Primitives.RepeatButton&gt;</ph> called <ph id=\"ph2\">`UpButton`</ph>.","source":"A <xref:System.Windows.Controls.Primitives.RepeatButton> called `UpButton`."},{"pos":[27853,27930],"content":"A <ph id=\"ph1\">&lt;xref:System.Windows.Controls.Primitives.RepeatButton&gt;</ph> called <ph id=\"ph2\">`DownButton.`</ph>","source":"A <xref:System.Windows.Controls.Primitives.RepeatButton> called `DownButton.`"},{"content":"The control can be in the following states:","pos":[27937,27980]},{"pos":[27990,28048],"content":"In the <ph id=\"ph1\">`ValueStates`</ph><ph id=\"ph2\">&lt;xref:System.Windows.VisualStateGroup&gt;</ph>","source":"In the `ValueStates`<xref:System.Windows.VisualStateGroup>"},{"pos":[28106,28164],"content":"In the <ph id=\"ph1\">`FocusStates`</ph><ph id=\"ph2\">&lt;xref:System.Windows.VisualStateGroup&gt;</ph>","source":"In the `FocusStates`<xref:System.Windows.VisualStateGroup>"},{"content":"To specify what <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> objects the control expects, you use the <ph id=\"ph2\">&lt;xref:System.Windows.TemplatePartAttribute&gt;</ph>, which specifies the name and type of the expected elements.","pos":[28219,28419],"source":"To specify what <xref:System.Windows.FrameworkElement> objects the control expects, you use the <xref:System.Windows.TemplatePartAttribute>, which specifies the name and type of the expected elements."},{"content":"To specify the possible states of a control, you use the <ph id=\"ph1\">&lt;xref:System.Windows.TemplateVisualStateAttribute&gt;</ph>, which specifies the state's name and which <ph id=\"ph2\">&lt;xref:System.Windows.VisualStateGroup&gt;</ph> it belongs to.","pos":[28421,28626],"source":"  To specify the possible states of a control, you use the <xref:System.Windows.TemplateVisualStateAttribute>, which specifies the state's name and which <xref:System.Windows.VisualStateGroup> it belongs to."},{"content":"Put the <ph id=\"ph1\">&lt;xref:System.Windows.TemplatePartAttribute&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Windows.TemplateVisualStateAttribute&gt;</ph> on the class definition of the control.","pos":[28628,28774],"source":"  Put the <xref:System.Windows.TemplatePartAttribute> and <xref:System.Windows.TemplateVisualStateAttribute> on the class definition of the control."},{"content":"Any public property that affects the appearance of your control is also a part of the control contract.","pos":[28781,28884]},{"pos":[28891,29016],"content":"The following example specifies the <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement&gt;</ph> object and states for the <ph id=\"ph2\">`NumericUpDown`</ph> control.","source":"The following example specifies the <xref:System.Windows.FrameworkElement> object and states for the `NumericUpDown` control."},{"pos":[29023,29347],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>VSMCustomControl#ControlContract<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#controlcontract)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>VSMCustomControl#ControlContract<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#controlcontract)</ept><ept id=\"p3\">]</ept>","leadings":[""," "],"source":"[!code-csharp[VSMCustomControl#ControlContract](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#controlcontract)]\n[!code-vb[VSMCustomControl#ControlContract](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#controlcontract)]"},{"pos":[29391,29407],"content":"Complete Example","linkify":"Complete Example","nodes":[{"content":"Complete Example","pos":[0,16]}]},{"pos":[29411,29526],"content":"The following example is the entire <ph id=\"ph1\">&lt;xref:System.Windows.Controls.ControlTemplate&gt;</ph> for the <ph id=\"ph2\">`NumericUpDown`</ph> control.","source":"The following example is the entire <xref:System.Windows.Controls.ControlTemplate> for the `NumericUpDown` control."},{"pos":[29533,29683],"content":"<bpt id=\"p1\">[!code-xml</bpt><bpt id=\"p2\">[</bpt>VSMCustomControl#NUDTemplate<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/themes/generic.xaml#nudtemplate)</ept><ept id=\"p1\">]</ept>","source":"[!code-xml[VSMCustomControl#NUDTemplate](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/themes/generic.xaml#nudtemplate)]"},{"pos":[29690,29752],"content":"The following example shows the logic for the <ph id=\"ph1\">`NumericUpDown`</ph>.","source":"The following example shows the logic for the `NumericUpDown`."},{"pos":[29759,30071],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>VSMCustomControl#ControlLogic<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#controllogic)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>VSMCustomControl#ControlLogic<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#controllogic)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[VSMCustomControl#ControlLogic](../../../../samples/snippets/csharp/VS_Snippets_Wpf/vsmcustomcontrol/csharp/numericupdown.cs#controllogic)]\n [!code-vb[VSMCustomControl#ControlLogic](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/vsmcustomcontrol/visualbasic/numericupdown.vb#controllogic)]"},{"pos":[30080,30088],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Customizing the Appearance of an Existing Control by Creating a ControlTemplate<ept id=\"p1\">](../../../../docs/framework/wpf/controls/customizing-the-appearance-of-an-existing-control.md)</ept><ph id=\"ph1\"> </ph>","pos":[30092,30268],"source":"[Customizing the Appearance of an Existing Control by Creating a ControlTemplate](../../../../docs/framework/wpf/controls/customizing-the-appearance-of-an-existing-control.md) "},{"content":"<bpt id=\"p1\"> [</bpt>Control Customization<ept id=\"p1\">](../../../../docs/framework/wpf/controls/control-customization.md)</ept>","pos":[30271,30361],"source":" [Control Customization](../../../../docs/framework/wpf/controls/control-customization.md)"}]}