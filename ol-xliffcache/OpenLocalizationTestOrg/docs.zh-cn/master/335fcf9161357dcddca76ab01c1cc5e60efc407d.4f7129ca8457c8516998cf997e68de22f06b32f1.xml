{"content":"---\ntitle: \"Untyped Request-Reply | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 0bf0f9d9-7caf-4d3d-8c9e-2d468cca16a5\ncaps.latest.revision: 11\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Untyped Request/Reply\nThis sample demonstrates how to define operation contracts that use the Message class.  \n  \n> [!NOTE]\n>  The setup procedure and build instructions for this sample are located at the end of this topic.  \n  \n This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md). The service contract defines one operation that takes in a message type as an argument and returns a message. The operation collects all required data to compute the sum from the message body and then sends the sum as body in the return message.  \n  \n```  \n  \n[OperationContract(Action = CalculatorService.RequestAction, ReplyAction = CalculatorService.ReplyAction)]  \nMessage ComputeSum(Message request);  \n  \n```  \n  \n On the service, the operation retrieves the array of integers passed in the input message and then computes the sum. To send a response message, the sample creates a new message with the appropriate message version and Action and adds the computed sum as its body. The following sample code demonstrates this.  \n  \n```  \n  \npublic Message ComputeSum(Message request)  \n{  \n    //The body of the message contains a list of numbers which will be   \n    //read as a int[] using GetBody<T>  \n    int result = 0;  \n  \n    int[] inputs = request.GetBody<int[]>();  \n    foreach (int i in inputs)  \n    {  \n        result += i;  \n    }  \n  \n    Message response = Message.CreateMessage(request.Version,   \n                                      ReplyAction, result);  \n    return response;  \n}  \n  \n```  \n  \n The client uses code that is generated by [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to create a proxy to the remote service. To send a request message, the client must have the message version, which depends on the underlying channel. Thus, it creates a new <xref:System.ServiceModel.OperationContextScope> scoped to the proxy channel it created, which creates an <xref:System.ServiceModel.OperationContext> with the correct message version populated in its `OutgoingMessageHeaders.MessageVersion` property. The client passes an input array as the body to the request message and then invokes the `ComputeSum` on the proxy. The client then retrieves the sum of the inputs it passed by accessing the `GetBody<T>` method on the reply message. The following sample code demonstrates this.  \n  \n```  \n  \nusing (new OperationContextScope(client.InnerChannel))  \n{  \n    // Call the Sum service operation.  \n    int[] values = { 1, 2, 3, 4, 5 };  \n    Message request = Message.CreateMessage(  \n        OperationContext.Current.OutgoingMessageHeaders.MessageVersion,   \n        RequestAction, values);  \n    Message reply = client.ComputeSum(request);  \n    int response = reply.GetBody<int>();  \n  \n    Console.WriteLine(\"Sum of numbers passed (1,2,3,4,5) = {0}\",   \n                                                       response);  \n}  \n  \n```  \n  \n This sample is a Web-hosted sample and so only the client executable must be run. The following is the sample output on the client.  \n  \n```  \n  \nPrompt>Client.exe  \nSum of numbers passed (1,2,3,4,5) = 15  \n  \nPress <ENTER> to terminate client.  \n  \n```  \n  \n This sample is a Web-hosted sample and so check the link provided in step 3 to see how to build and run the sample.  \n  \n### To set up, build, and run the sample  \n  \n1.  Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).  \n  \n2.  To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).  \n  \n3.  To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Contract\\Message\\Untyped`  \n  \n## See Also","nodes":[{"pos":[12,50],"content":"Untyped Request-Reply | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Untyped Request-Reply | Microsoft Docs","pos":[0,38]}]},{"pos":[349,370],"content":"Untyped Request/Reply","linkify":"Untyped Request/Reply","nodes":[{"content":"Untyped Request/Reply","pos":[0,21]}]},{"content":"This sample demonstrates how to define operation contracts that use the Message class.","pos":[371,457]},{"pos":[465,572],"content":"[!NOTE]\n The setup procedure and build instructions for this sample are located at the end of this topic.","leadings":["","> "],"nodes":[{"content":"The setup procedure and build instructions for this sample are located at the end of this topic.","pos":[9,105]}]},{"content":"This sample is based on the <bpt id=\"p1\">[</bpt>Getting Started<ept id=\"p1\">](../../../../docs/framework/wcf/samples/getting-started-sample.md)</ept>.","pos":[579,691],"source":"This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md)."},{"content":"The service contract defines one operation that takes in a message type as an argument and returns a message.","pos":[692,801]},{"content":"The operation collects all required data to compute the sum from the message body and then sends the sum as body in the return message.","pos":[802,937]},{"content":"On the service, the operation retrieves the array of integers passed in the input message and then computes the sum.","pos":[1113,1229]},{"content":"To send a response message, the sample creates a new message with the appropriate message version and Action and adds the computed sum as its body.","pos":[1230,1377]},{"content":"The following sample code demonstrates this.","pos":[1378,1422]},{"content":"The client uses code that is generated by <bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept> to create a proxy to the remote service.","pos":[1914,2129],"source":"The client uses code that is generated by [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to create a proxy to the remote service."},{"content":"To send a request message, the client must have the message version, which depends on the underlying channel.","pos":[2130,2239]},{"content":"Thus, it creates a new <ph id=\"ph1\">&lt;xref:System.ServiceModel.OperationContextScope&gt;</ph> scoped to the proxy channel it created, which creates an <ph id=\"ph2\">&lt;xref:System.ServiceModel.OperationContext&gt;</ph> with the correct message version populated in its <ph id=\"ph3\">`OutgoingMessageHeaders.MessageVersion`</ph> property.","pos":[2240,2512],"source":" Thus, it creates a new <xref:System.ServiceModel.OperationContextScope> scoped to the proxy channel it created, which creates an <xref:System.ServiceModel.OperationContext> with the correct message version populated in its `OutgoingMessageHeaders.MessageVersion` property."},{"content":"The client passes an input array as the body to the request message and then invokes the <ph id=\"ph1\">`ComputeSum`</ph> on the proxy.","pos":[2513,2628],"source":" The client passes an input array as the body to the request message and then invokes the `ComputeSum` on the proxy."},{"content":"The client then retrieves the sum of the inputs it passed by accessing the <ph id=\"ph1\">`GetBody&lt;T&gt;`</ph> method on the reply message.","pos":[2629,2745],"source":" The client then retrieves the sum of the inputs it passed by accessing the `GetBody<T>` method on the reply message."},{"content":"The following sample code demonstrates this.","pos":[2746,2790]},{"content":"This sample is a Web-hosted sample and so only the client executable must be run.","pos":[3352,3433]},{"content":"The following is the sample output on the client.","pos":[3434,3483]},{"content":"This sample is a Web-hosted sample and so check the link provided in step 3 to see how to build and run the sample.","pos":[3612,3727]},{"pos":[3737,3773],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[3783,3982],"content":"Ensure that you have performed the <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"pos":[3992,4201],"content":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"pos":[4211,4419],"content":"To run the sample in a single- or cross-machine configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"pos":[4427,4559],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[4613,4939],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[4940,4990]},{"pos":[5077,5085],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]}]}