{"content":"---\ntitle: \"Troubleshooting Interoperability (Visual Basic) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"2015-07-20\"\nms.prod: .net\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-visual-basic\"\n\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\nhelpviewer_keywords: \n  - \"interop, deploying assemblies\"\n  - \"assemblies [Visual Basic]\"\n  - \"interop, installing assemblies that share components\"\n  - \"COM objects, troubleshooting\"\n  - \"interop, sharing components\"\n  - \"troubleshooting interoperability\"\n  - \"interoperability, troubleshooting\"\n  - \"COM interop, troubleshooting\"\n  - \"assemblies [Visual Basic], deploying\"\n  - \"troubleshooting Visual Basic, interoperability\"\n  - \"interop assemblies\"\n  - \"interoperability, sharing components\"\n  - \"shared components, using with assemblies\"\nms.assetid: b324cc1e-b03c-4f39-aea6-6a6d5bfd0e37\ncaps.latest.revision: 21\nauthor: dotnet-bot\nms.author: dotnetcontent\n\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Troubleshooting Interoperability (Visual Basic)\nWhen you interoperate between COM and the managed code of the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)], you may encounter one or more of the following common issues.  \n  \n##  <a name=\"vbconinteroperabilitymarshalinganchor1\"></a> Interop Marshaling  \n At times, you may have to use data types that are not part of the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)]. Interop assemblies handle most of the work for COM objects, but you may have to control the data types that are used when managed objects are exposed to COM. For example, structures in class libraries must specify the `BStr` unmanaged type on strings sent to COM objects created by Visual Basic 6.0 and earlier versions. In such cases, you can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute to cause managed types to be exposed as unmanaged types.  \n  \n##  <a name=\"vbconinteroperabilitymarshalinganchor2\"></a> Exporting Fixed-Length Strings to Unmanaged Code  \n In Visual Basic 6.0 and earlier versions, strings are exported to COM objects as sequences of bytes without a null termination character. For compatibility with other languages, [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] includes a termination character when exporting strings. The best way to address this incompatibility is to export strings that lack the termination character as arrays of `Byte` or `Char`.  \n  \n##  <a name=\"vbconinteroperabilitymarshalinganchor3\"></a> Exporting Inheritance Hierarchies  \n Managed class hierarchies flatten out when exposed as COM objects. For example, if you define a base class with a member, and then inherit the base class in a derived class that is exposed as a COM object, clients that use the derived class in the COM object will not be able to use the inherited members. Base class members can be accessed from COM objects only as instances of a base class, and then only if the base class is also created as a COM object.  \n  \n## Overloaded Methods  \n Although you can create overloaded methods with [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)], they are not supported by COM. When a class that contains overloaded methods is exposed as a COM object, new method names are generated for the overloaded methods.  \n  \n For example, consider a class that has two overloads of the `Synch` method. When the class is exposed as a COM object, the new generated method names could be `Synch` and `Synch_2`.  \n  \n The renaming can cause two problems for consumers of the COM object.  \n  \n1.  Clients might not expect the generated method names.  \n  \n2.  The generated method names in the class exposed as a COM object can change when new overloads are added to the class or its base class. This can cause versioning problems.  \n  \n To solve both problems, give each method a unique name, instead of using overloading, when you develop objects that will be exposed as COM objects.  \n  \n##  <a name=\"vbconinteroperabilitymarshalinganchor4\"></a> Use of COM Objects Through Interop Assemblies  \n You use interop assemblies almost as if they are managed code replacements for the COM objects they represent. However, because they are wrappers and not actual COM objects, there are some differences between using interop assemblies and standard assemblies. These areas of difference include the exposure of classes, and data types for parameters and return values.  \n  \n##  <a name=\"vbconinteroperabilitymarshalinganchor5\"></a> Classes Exposed as Both Interfaces and Classes  \n Unlike classes in standard assemblies, COM classes are exposed in interop assemblies as both an interface and a class that represents the COM class. The interface's name is identical to that of the COM class. The name of the interop class is the same as that of the original COM class, but with the word \"Class\" appended. For example, suppose you have a project with a reference to an interop assembly for a COM object. If the COM class is named `MyComClass`, IntelliSense and the Object Browser show an interface named `MyComClass` and a class named `MyComClassClass`.  \n  \n##  <a name=\"vbconinteroperabilitymarshalinganchor6\"></a> Creating Instances of a .NET Framework Class  \n Generally, you create an instance of a [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] class using the `New` statement with a class name. Having a COM class represented by an interop assembly is the one case in which you can use the `New` statement with an interface. Unless you are using the COM class with an `Inherits` statement, you can use the interface just as you would a class. The following code demonstrates how to create a `Command` object in a project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object:  \n  \n [!code-vb[VbVbalrInterop#20](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_1.vb)]  \n  \n However, if you are using the COM class as the base for a derived class, you must use the interop class that represents the COM class, as in the following code:  \n  \n [!code-vb[VbVbalrInterop#21](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_2.vb)]  \n  \n> [!NOTE]\n>  Interop assemblies implicitly implement interfaces that represent COM classes. You should not try to use the `Implements` statement to implement these interfaces or an error will result.  \n  \n##  <a name=\"vbconinteroperabilitymarshalinganchor7\"></a> Data Types for Parameters and Return Values  \n Unlike members of standard assemblies, interop assembly members may have data types that differ from those used in the  original object declaration. Although interop assemblies implicitly convert COM types to compatible common language runtime types, you should pay attention to the data types that are used by both sides to prevent runtime errors. For example, in COM objects created in Visual Basic 6.0 and earlier versions, values of type `Integer` assume the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] equivalent type, `Short`. It is recommended that you use the Object Browser to examine the characteristics of imported members before you use them.  \n  \n##  <a name=\"vbconinteroperabilitymarshalinganchor8\"></a> Module level COM methods  \n Most COM objects are used by creating an instance of a COM class using the `New` keyword and then calling methods of the object. One exception to this rule involves COM objects that contain `AppObj` or `GlobalMultiUse` COM classes. Such classes resemble module level methods in [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] classes. Visual Basic 6.0 and earlier versions implicitly create instances of such objects for you the first time that you call one of their methods. For example, in Visual Basic 6.0 you can add a reference to the Microsoft DAO 3.6 Object Library and call the `DBEngine` method without first creating an instance:  \n  \n```  \nDim db As DAO.Database  \n' Open the database.  \nSet db = DBEngine.OpenDatabase(\"C:\\nwind.mdb\")  \n' Use the database object.  \n```  \n  \n [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] requires that you always create instances of COM objects before you can use their methods. To use these methods in [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)], declare a variable of the desired class and use the new keyword to assign the object to the object variable. The `Shared` keyword can be used when you want to make sure that only one instance of the class is created.  \n  \n [!code-vb[VbVbalrInterop#23](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_3.vb)]  \n  \n##  <a name=\"vbconinteroperabilitymarshalinganchor9\"></a> Unhandled Errors in Event Handlers  \n One common interop problem involves errors in event handlers that handle events raised by COM objects. Such errors are ignored unless you specifically check for errors using `On Error` or `Try...Catch...Finally` statements. For example, the following example is from a [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object.  \n  \n [!code-vb[VbVbalrInterop#24](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_4.vb)]  \n  \n This example raises an error as expected. However, if you try the same example without the `Try...Catch...Finally` block, the error is ignored as if you used the `OnError Resume Next` statement. Without error handling, the division by zero silently fails. Because such errors never raise unhandled exception errors, it is important that you use some form of exception handling in event handlers that handle events from COM objects.  \n  \n### Understanding COM interop errors  \n Without error handling, interop calls often generate errors that provide little information. Whenever possible, use structured error handling to provide more information about problems when they occur. This can be especially helpful when you debug applications. For example:  \n  \n [!code-vb[VbVbalrInterop#25](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_5.vb)]  \n  \n You can find information such as the error description, HRESULT, and the source of COM errors by examining the contents of the exception object.  \n  \n##  <a name=\"vbconinteroperabilitymarshalinganchor10\"></a> ActiveX Control Issues  \n Most ActiveX controls that work with Visual Basic 6.0 work with [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] without trouble. The main exceptions are container controls, or controls that visually contain other controls. Some examples of older controls that do not work correctly with [!INCLUDE[vsprvs](../../../csharp/includes/vsprvs_md.md)] are as follows:  \n  \n-   Microsoft Forms 2.0 Frame control  \n  \n-   Up-Down control, also known as the spin control  \n  \n-   Sheridan Tab Control  \n  \n There are only a few workarounds for unsupported ActiveX control problems. You can migrate existing controls to [!INCLUDE[vsprvs](../../../csharp/includes/vsprvs_md.md)] if you own the original source code. Otherwise, you can check with software vendors for updated .NET-compatible versions of controls to replace unsupported ActiveX controls.  \n  \n##  <a name=\"vbconinteroperabilitymarshalinganchor11\"></a> Passing ReadOnly Properties of Controls ByRef  \n [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] sometimes raises COM errors such as \"Error 0x800A017F CTL_E_SETNOTSUPPORTED\" when you pass `ReadOnly` properties of some older ActiveX controls as `ByRef` parameters to other procedures. Similar procedure calls from Visual Basic 6.0 do not raise an error, and the parameters are treated as if you passed them by value. The error message you see in [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] is the COM object reporting that you are trying to change a property that does not have a property `Set` procedure.  \n  \n If you have access to the procedure being called, you can prevent this error by using the `ByVal` keyword to declare parameters that accept `ReadOnly` properties. For example:  \n  \n [!code-vb[VbVbalrInterop#26](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_6.vb)]  \n  \n If you do not have access to the source code for the procedure being called, you can force the property to be passed by value by adding an extra set of brackets around the calling procedure. For example, in a project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object, you can use:  \n  \n [!code-vb[VbVbalrInterop#27](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_7.vb)]  \n  \n##  <a name=\"vbconinteroperabilitymarshalinganchor12\"></a> Deploying Assemblies That Expose Interop  \n Deploying assemblies that expose COM interfaces presents some unique challenges. For example, a potential problem occurs when separate applications reference the same COM assembly. This situation is common when a new version of an assembly is installed and another application is still using the old version of the assembly. If you uninstall an assembly that shares a DLL, you can unintentionally make it unavailable to the other assemblies.  \n  \n To avoid this problem, you should install shared assemblies to the Global Assembly Cache (GAC) and use a MergeModule for the component. If you cannot install the application in the GAC, it should be installed to CommonFilesFolder in a version-specific subdirectory.  \n  \n Assemblies that are not shared should be located side by side in the directory with the calling application.  \n  \n## See Also  \n <xref:System.Runtime.InteropServices.MarshalAsAttribute>   \n [COM Interop](../../../visual-basic/programming-guide/com-interop/index.md)   \n [Tlbimp.exe (Type Library Importer)](http://msdn.microsoft.com/library/ec0a8d63-11b3-4acd-b398-da1e37e97382)   \n [Tlbexp.exe (Type Library Exporter)](http://msdn.microsoft.com/library/a487d61b-d166-467b-a7ca-d8b52fbff42d)   \n [Walkthrough: Implementing Inheritance with COM Objects](../../../visual-basic/programming-guide/com-interop/walkthrough-implementing-inheritance-with-com-objects.md)   \n [Inherits Statement](../../../visual-basic/language-reference/statements/inherits-statement.md)   \n [Global Assembly Cache](../../../framework/app-domains/gac.md)","nodes":[{"pos":[12,76],"content":"Troubleshooting Interoperability (Visual Basic) | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Troubleshooting Interoperability (Visual Basic) | Microsoft Docs","pos":[0,64]}]},{"pos":[1092,1139],"content":"Troubleshooting Interoperability (Visual Basic)","linkify":"Troubleshooting Interoperability (Visual Basic)","nodes":[{"content":"Troubleshooting Interoperability (Visual Basic)","pos":[0,47]}]},{"pos":[1140,1348],"content":"When you interoperate between COM and the managed code of the <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)]</ph>, you may encounter one or more of the following common issues.","source":"When you interoperate between COM and the managed code of the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)], you may encounter one or more of the following common issues."},{"pos":[1358,1430],"content":"<bpt id=\"p1\">&lt;a name=\"vbconinteroperabilitymarshalinganchor1\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Interop Marshaling","linkify":"<a name=\"vbconinteroperabilitymarshalinganchor1\"></a> Interop Marshaling","source":"<a name=\"vbconinteroperabilitymarshalinganchor1\"></a> Interop Marshaling"},{"content":"At times, you may have to use data types that are not part of the <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)]</ph>.","pos":[1434,1584],"source":"At times, you may have to use data types that are not part of the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)]."},{"content":"Interop assemblies handle most of the work for COM objects, but you may have to control the data types that are used when managed objects are exposed to COM.","pos":[1585,1742]},{"content":"For example, structures in class libraries must specify the <ph id=\"ph1\">`BStr`</ph> unmanaged type on strings sent to COM objects created by Visual Basic 6.0 and earlier versions.","pos":[1743,1905],"source":" For example, structures in class libraries must specify the `BStr` unmanaged type on strings sent to COM objects created by Visual Basic 6.0 and earlier versions."},{"content":"In such cases, you can use the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute&gt;</ph> attribute to cause managed types to be exposed as unmanaged types.","pos":[1906,2060],"source":" In such cases, you can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute to cause managed types to be exposed as unmanaged types."},{"pos":[2070,2172],"content":"<bpt id=\"p1\">&lt;a name=\"vbconinteroperabilitymarshalinganchor2\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Exporting Fixed-Length Strings to Unmanaged Code","linkify":"<a name=\"vbconinteroperabilitymarshalinganchor2\"></a> Exporting Fixed-Length Strings to Unmanaged Code","source":"<a name=\"vbconinteroperabilitymarshalinganchor2\"></a> Exporting Fixed-Length Strings to Unmanaged Code"},{"content":"In Visual Basic 6.0 and earlier versions, strings are exported to COM objects as sequences of bytes without a null termination character.","pos":[2176,2313]},{"content":"For compatibility with other languages, <ph id=\"ph1\">[!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)]</ph> includes a termination character when exporting strings.","pos":[2314,2523],"source":" For compatibility with other languages, [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] includes a termination character when exporting strings."},{"content":"The best way to address this incompatibility is to export strings that lack the termination character as arrays of <ph id=\"ph1\">`Byte`</ph> or <ph id=\"ph2\">`Char`</ph>.","pos":[2524,2656],"source":" The best way to address this incompatibility is to export strings that lack the termination character as arrays of `Byte` or `Char`."},{"pos":[2666,2753],"content":"<bpt id=\"p1\">&lt;a name=\"vbconinteroperabilitymarshalinganchor3\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Exporting Inheritance Hierarchies","linkify":"<a name=\"vbconinteroperabilitymarshalinganchor3\"></a> Exporting Inheritance Hierarchies","source":"<a name=\"vbconinteroperabilitymarshalinganchor3\"></a> Exporting Inheritance Hierarchies"},{"content":"Managed class hierarchies flatten out when exposed as COM objects.","pos":[2757,2823]},{"content":"For example, if you define a base class with a member, and then inherit the base class in a derived class that is exposed as a COM object, clients that use the derived class in the COM object will not be able to use the inherited members.","pos":[2824,3062]},{"content":"Base class members can be accessed from COM objects only as instances of a base class, and then only if the base class is also created as a COM object.","pos":[3063,3214]},{"pos":[3223,3241],"content":"Overloaded Methods","linkify":"Overloaded Methods","nodes":[{"content":"Overloaded Methods","pos":[0,18]}]},{"content":"Although you can create overloaded methods with <ph id=\"ph1\">[!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]</ph>, they are not supported by COM.","pos":[3245,3414],"source":"Although you can create overloaded methods with [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)], they are not supported by COM."},{"content":"When a class that contains overloaded methods is exposed as a COM object, new method names are generated for the overloaded methods.","pos":[3415,3547]},{"content":"For example, consider a class that has two overloads of the <ph id=\"ph1\">`Synch`</ph> method.","pos":[3554,3629],"source":"For example, consider a class that has two overloads of the `Synch` method."},{"content":"When the class is exposed as a COM object, the new generated method names could be <ph id=\"ph1\">`Synch`</ph> and <ph id=\"ph2\">`Synch_2`</ph>.","pos":[3630,3735],"source":" When the class is exposed as a COM object, the new generated method names could be `Synch` and `Synch_2`."},{"content":"The renaming can cause two problems for consumers of the COM object.","pos":[3742,3810]},{"content":"Clients might not expect the generated method names.","pos":[3820,3872]},{"content":"The generated method names in the class exposed as a COM object can change when new overloads are added to the class or its base class.","pos":[3882,4017]},{"content":"This can cause versioning problems.","pos":[4018,4053]},{"content":"To solve both problems, give each method a unique name, instead of using overloading, when you develop objects that will be exposed as COM objects.","pos":[4060,4207]},{"pos":[4217,4316],"content":"<bpt id=\"p1\">&lt;a name=\"vbconinteroperabilitymarshalinganchor4\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Use of COM Objects Through Interop Assemblies","linkify":"<a name=\"vbconinteroperabilitymarshalinganchor4\"></a> Use of COM Objects Through Interop Assemblies","source":"<a name=\"vbconinteroperabilitymarshalinganchor4\"></a> Use of COM Objects Through Interop Assemblies"},{"content":"You use interop assemblies almost as if they are managed code replacements for the COM objects they represent.","pos":[4320,4430]},{"content":"However, because they are wrappers and not actual COM objects, there are some differences between using interop assemblies and standard assemblies.","pos":[4431,4578]},{"content":"These areas of difference include the exposure of classes, and data types for parameters and return values.","pos":[4579,4686]},{"pos":[4696,4796],"content":"<bpt id=\"p1\">&lt;a name=\"vbconinteroperabilitymarshalinganchor5\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Classes Exposed as Both Interfaces and Classes","linkify":"<a name=\"vbconinteroperabilitymarshalinganchor5\"></a> Classes Exposed as Both Interfaces and Classes","source":"<a name=\"vbconinteroperabilitymarshalinganchor5\"></a> Classes Exposed as Both Interfaces and Classes"},{"content":"Unlike classes in standard assemblies, COM classes are exposed in interop assemblies as both an interface and a class that represents the COM class.","pos":[4800,4948]},{"content":"The interface's name is identical to that of the COM class.","pos":[4949,5008]},{"content":"The name of the interop class is the same as that of the original COM class, but with the word \"Class\" appended.","pos":[5009,5121]},{"content":"For example, suppose you have a project with a reference to an interop assembly for a COM object.","pos":[5122,5219]},{"content":"If the COM class is named <ph id=\"ph1\">`MyComClass`</ph>, IntelliSense and the Object Browser show an interface named <ph id=\"ph2\">`MyComClass`</ph> and a class named <ph id=\"ph3\">`MyComClassClass`</ph>.","pos":[5220,5369],"source":" If the COM class is named `MyComClass`, IntelliSense and the Object Browser show an interface named `MyComClass` and a class named `MyComClassClass`."},{"pos":[5379,5477],"content":"<bpt id=\"p1\">&lt;a name=\"vbconinteroperabilitymarshalinganchor6\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Creating Instances of a .NET Framework Class","linkify":"<a name=\"vbconinteroperabilitymarshalinganchor6\"></a> Creating Instances of a .NET Framework Class","source":"<a name=\"vbconinteroperabilitymarshalinganchor6\"></a> Creating Instances of a .NET Framework Class"},{"content":"Generally, you create an instance of a <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)]</ph> class using the <ph id=\"ph2\">`New`</ph> statement with a class name.","pos":[5481,5654],"source":"Generally, you create an instance of a [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] class using the `New` statement with a class name."},{"content":"Having a COM class represented by an interop assembly is the one case in which you can use the <ph id=\"ph1\">`New`</ph> statement with an interface.","pos":[5655,5784],"source":" Having a COM class represented by an interop assembly is the one case in which you can use the `New` statement with an interface."},{"content":"Unless you are using the COM class with an <ph id=\"ph1\">`Inherits`</ph> statement, you can use the interface just as you would a class.","pos":[5785,5902],"source":" Unless you are using the COM class with an `Inherits` statement, you can use the interface just as you would a class."},{"content":"The following code demonstrates how to create a <ph id=\"ph1\">`Command`</ph> object in a project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object:","pos":[5903,6063],"source":" The following code demonstrates how to create a `Command` object in a project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object:"},{"pos":[6070,6214],"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>VbVbalrInterop#20<ept id=\"p2\">](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_1.vb)</ept><ept id=\"p1\">]</ept>","source":"[!code-vb[VbVbalrInterop#20](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_1.vb)]"},{"content":"However, if you are using the COM class as the base for a derived class, you must use the interop class that represents the COM class, as in the following code:","pos":[6221,6381]},{"pos":[6388,6532],"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>VbVbalrInterop#21<ept id=\"p2\">](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_2.vb)</ept><ept id=\"p1\">]</ept>","source":"[!code-vb[VbVbalrInterop#21](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_2.vb)]"},{"pos":[6540,6737],"content":"[!NOTE]\n Interop assemblies implicitly implement interfaces that represent COM classes. You should not try to use the `Implements` statement to implement these interfaces or an error will result.","leadings":["","> "],"nodes":[{"content":" Interop assemblies implicitly implement interfaces that represent COM classes. You should not try to use the `Implements` statement to implement these interfaces or an error will result.","pos":[8,195],"nodes":[{"content":"Interop assemblies implicitly implement interfaces that represent COM classes.","pos":[1,79]},{"content":"You should not try to use the <ph id=\"ph1\">`Implements`</ph> statement to implement these interfaces or an error will result.","pos":[80,187],"source":" You should not try to use the `Implements` statement to implement these interfaces or an error will result."}]}]},{"pos":[6747,6844],"content":"<bpt id=\"p1\">&lt;a name=\"vbconinteroperabilitymarshalinganchor7\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Data Types for Parameters and Return Values","linkify":"<a name=\"vbconinteroperabilitymarshalinganchor7\"></a> Data Types for Parameters and Return Values","source":"<a name=\"vbconinteroperabilitymarshalinganchor7\"></a> Data Types for Parameters and Return Values"},{"content":"Unlike members of standard assemblies, interop assembly members may have data types that differ from those used in the  original object declaration.","pos":[6848,6996]},{"content":"Although interop assemblies implicitly convert COM types to compatible common language runtime types, you should pay attention to the data types that are used by both sides to prevent runtime errors.","pos":[6997,7196]},{"content":"For example, in COM objects created in Visual Basic 6.0 and earlier versions, values of type <ph id=\"ph1\">`Integer`</ph> assume the <ph id=\"ph2\">[!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)]</ph> equivalent type, <ph id=\"ph3\">`Short`</ph>.","pos":[7197,7420],"source":" For example, in COM objects created in Visual Basic 6.0 and earlier versions, values of type `Integer` assume the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] equivalent type, `Short`."},{"content":"It is recommended that you use the Object Browser to examine the characteristics of imported members before you use them.","pos":[7421,7542]},{"pos":[7552,7630],"content":"<bpt id=\"p1\">&lt;a name=\"vbconinteroperabilitymarshalinganchor8\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Module level COM methods","linkify":"<a name=\"vbconinteroperabilitymarshalinganchor8\"></a> Module level COM methods","source":"<a name=\"vbconinteroperabilitymarshalinganchor8\"></a> Module level COM methods"},{"content":"Most COM objects are used by creating an instance of a COM class using the <ph id=\"ph1\">`New`</ph> keyword and then calling methods of the object.","pos":[7634,7762],"source":"Most COM objects are used by creating an instance of a COM class using the `New` keyword and then calling methods of the object."},{"content":"One exception to this rule involves COM objects that contain <ph id=\"ph1\">`AppObj`</ph> or <ph id=\"ph2\">`GlobalMultiUse`</ph> COM classes.","pos":[7763,7865],"source":" One exception to this rule involves COM objects that contain `AppObj` or `GlobalMultiUse` COM classes."},{"content":"Such classes resemble module level methods in <ph id=\"ph1\">[!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)]</ph> classes.","pos":[7866,8033],"source":" Such classes resemble module level methods in [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] classes."},{"content":"Visual Basic 6.0 and earlier versions implicitly create instances of such objects for you the first time that you call one of their methods.","pos":[8034,8174]},{"content":"For example, in Visual Basic 6.0 you can add a reference to the Microsoft DAO 3.6 Object Library and call the <ph id=\"ph1\">`DBEngine`</ph> method without first creating an instance:","pos":[8175,8338],"source":" For example, in Visual Basic 6.0 you can add a reference to the Microsoft DAO 3.6 Object Library and call the `DBEngine` method without first creating an instance:"},{"content":"<ph id=\"ph1\">[!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)]</ph> requires that you always create instances of COM objects before you can use their methods.","pos":[8486,8689],"source":"[!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] requires that you always create instances of COM objects before you can use their methods."},{"content":"To use these methods in <ph id=\"ph1\">[!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)]</ph>, declare a variable of the desired class and use the new keyword to assign the object to the object variable.","pos":[8690,8936],"source":" To use these methods in [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)], declare a variable of the desired class and use the new keyword to assign the object to the object variable."},{"content":"The <ph id=\"ph1\">`Shared`</ph> keyword can be used when you want to make sure that only one instance of the class is created.","pos":[8937,9044],"source":" The `Shared` keyword can be used when you want to make sure that only one instance of the class is created."},{"pos":[9051,9195],"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>VbVbalrInterop#23<ept id=\"p2\">](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_3.vb)</ept><ept id=\"p1\">]</ept>","source":"[!code-vb[VbVbalrInterop#23](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_3.vb)]"},{"pos":[9205,9293],"content":"<bpt id=\"p1\">&lt;a name=\"vbconinteroperabilitymarshalinganchor9\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Unhandled Errors in Event Handlers","linkify":"<a name=\"vbconinteroperabilitymarshalinganchor9\"></a> Unhandled Errors in Event Handlers","source":"<a name=\"vbconinteroperabilitymarshalinganchor9\"></a> Unhandled Errors in Event Handlers"},{"content":"One common interop problem involves errors in event handlers that handle events raised by COM objects.","pos":[9297,9399]},{"content":"Such errors are ignored unless you specifically check for errors using <ph id=\"ph1\">`On Error`</ph> or <ph id=\"ph2\">`Try...Catch...Finally`</ph> statements.","pos":[9400,9520],"source":" Such errors are ignored unless you specifically check for errors using `On Error` or `Try...Catch...Finally` statements."},{"content":"For example, the following example is from a <ph id=\"ph1\">[!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)]</ph> project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object.","pos":[9521,9769],"source":" For example, the following example is from a [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object."},{"pos":[9776,9920],"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>VbVbalrInterop#24<ept id=\"p2\">](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_4.vb)</ept><ept id=\"p1\">]</ept>","source":"[!code-vb[VbVbalrInterop#24](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_4.vb)]"},{"content":"This example raises an error as expected.","pos":[9927,9968]},{"content":"However, if you try the same example without the <ph id=\"ph1\">`Try...Catch...Finally`</ph> block, the error is ignored as if you used the <ph id=\"ph2\">`OnError Resume Next`</ph> statement.","pos":[9969,10121],"source":" However, if you try the same example without the `Try...Catch...Finally` block, the error is ignored as if you used the `OnError Resume Next` statement."},{"content":"Without error handling, the division by zero silently fails.","pos":[10122,10182]},{"content":"Because such errors never raise unhandled exception errors, it is important that you use some form of exception handling in event handlers that handle events from COM objects.","pos":[10183,10358]},{"pos":[10368,10400],"content":"Understanding COM interop errors","linkify":"Understanding COM interop errors","nodes":[{"content":"Understanding COM interop errors","pos":[0,32]}]},{"content":"Without error handling, interop calls often generate errors that provide little information.","pos":[10404,10496]},{"content":"Whenever possible, use structured error handling to provide more information about problems when they occur.","pos":[10497,10605]},{"content":"This can be especially helpful when you debug applications.","pos":[10606,10665]},{"content":"For example:","pos":[10666,10678]},{"pos":[10685,10829],"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>VbVbalrInterop#25<ept id=\"p2\">](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_5.vb)</ept><ept id=\"p1\">]</ept>","source":"[!code-vb[VbVbalrInterop#25](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_5.vb)]"},{"content":"You can find information such as the error description, HRESULT, and the source of COM errors by examining the contents of the exception object.","pos":[10836,10980]},{"pos":[10990,11067],"content":"<bpt id=\"p1\">&lt;a name=\"vbconinteroperabilitymarshalinganchor10\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> ActiveX Control Issues","linkify":"<a name=\"vbconinteroperabilitymarshalinganchor10\"></a> ActiveX Control Issues","source":"<a name=\"vbconinteroperabilitymarshalinganchor10\"></a> ActiveX Control Issues"},{"content":"Most ActiveX controls that work with Visual Basic 6.0 work with <ph id=\"ph1\">[!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)]</ph> without trouble.","pos":[11071,11264],"source":"Most ActiveX controls that work with Visual Basic 6.0 work with [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] without trouble."},{"content":"The main exceptions are container controls, or controls that visually contain other controls.","pos":[11265,11358]},{"content":"Some examples of older controls that do not work correctly with <ph id=\"ph1\">[!INCLUDE[vsprvs](../../../csharp/includes/vsprvs_md.md)]</ph> are as follows:","pos":[11359,11496],"source":" Some examples of older controls that do not work correctly with [!INCLUDE[vsprvs](../../../csharp/includes/vsprvs_md.md)] are as follows:"},{"content":"Microsoft Forms 2.0 Frame control","pos":[11506,11539]},{"content":"Up-Down control, also known as the spin control","pos":[11549,11596]},{"content":"Sheridan Tab Control","pos":[11606,11626]},{"content":"There are only a few workarounds for unsupported ActiveX control problems.","pos":[11633,11707]},{"content":"You can migrate existing controls to <ph id=\"ph1\">[!INCLUDE[vsprvs](../../../csharp/includes/vsprvs_md.md)]</ph> if you own the original source code.","pos":[11708,11839],"source":" You can migrate existing controls to [!INCLUDE[vsprvs](../../../csharp/includes/vsprvs_md.md)] if you own the original source code."},{"content":"Otherwise, you can check with software vendors for updated .NET-compatible versions of controls to replace unsupported ActiveX controls.","pos":[11840,11976]},{"pos":[11986,12086],"content":"<bpt id=\"p1\">&lt;a name=\"vbconinteroperabilitymarshalinganchor11\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Passing ReadOnly Properties of Controls ByRef","linkify":"<a name=\"vbconinteroperabilitymarshalinganchor11\"></a> Passing ReadOnly Properties of Controls ByRef","source":"<a name=\"vbconinteroperabilitymarshalinganchor11\"></a> Passing ReadOnly Properties of Controls ByRef"},{"content":"<ph id=\"ph1\">[!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)]</ph> sometimes raises COM errors such as \"Error 0x800A017F CTL_E_SETNOTSUPPORTED\" when you pass <ph id=\"ph2\">`ReadOnly`</ph> properties of some older ActiveX controls as <ph id=\"ph3\">`ByRef`</ph> parameters to other procedures.","pos":[12090,12389],"source":"[!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] sometimes raises COM errors such as \"Error 0x800A017F CTL_E_SETNOTSUPPORTED\" when you pass `ReadOnly` properties of some older ActiveX controls as `ByRef` parameters to other procedures."},{"content":"Similar procedure calls from Visual Basic 6.0 do not raise an error, and the parameters are treated as if you passed them by value.","pos":[12390,12521]},{"content":"The error message you see in <ph id=\"ph1\">[!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)]</ph> is the COM object reporting that you are trying to change a property that does not have a property <ph id=\"ph2\">`Set`</ph> procedure.","pos":[12522,12779],"source":" The error message you see in [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)] is the COM object reporting that you are trying to change a property that does not have a property `Set` procedure."},{"content":"If you have access to the procedure being called, you can prevent this error by using the <ph id=\"ph1\">`ByVal`</ph> keyword to declare parameters that accept <ph id=\"ph2\">`ReadOnly`</ph> properties.","pos":[12786,12948],"source":"If you have access to the procedure being called, you can prevent this error by using the `ByVal` keyword to declare parameters that accept `ReadOnly` properties."},{"content":"For example:","pos":[12949,12961]},{"pos":[12968,13112],"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>VbVbalrInterop#26<ept id=\"p2\">](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_6.vb)</ept><ept id=\"p1\">]</ept>","source":"[!code-vb[VbVbalrInterop#26](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_6.vb)]"},{"content":"If you do not have access to the source code for the procedure being called, you can force the property to be passed by value by adding an extra set of brackets around the calling procedure.","pos":[13119,13309]},{"content":"For example, in a project that has a reference to the Microsoft ActiveX Data Objects 2.8 Library COM object, you can use:","pos":[13310,13431]},{"pos":[13438,13582],"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>VbVbalrInterop#27<ept id=\"p2\">](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_7.vb)</ept><ept id=\"p1\">]</ept>","source":"[!code-vb[VbVbalrInterop#27](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/troubleshooting-interoperability_7.vb)]"},{"pos":[13592,13687],"content":"<bpt id=\"p1\">&lt;a name=\"vbconinteroperabilitymarshalinganchor12\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Deploying Assemblies That Expose Interop","linkify":"<a name=\"vbconinteroperabilitymarshalinganchor12\"></a> Deploying Assemblies That Expose Interop","source":"<a name=\"vbconinteroperabilitymarshalinganchor12\"></a> Deploying Assemblies That Expose Interop"},{"content":"Deploying assemblies that expose COM interfaces presents some unique challenges.","pos":[13691,13771]},{"content":"For example, a potential problem occurs when separate applications reference the same COM assembly.","pos":[13772,13871]},{"content":"This situation is common when a new version of an assembly is installed and another application is still using the old version of the assembly.","pos":[13872,14015]},{"content":"If you uninstall an assembly that shares a DLL, you can unintentionally make it unavailable to the other assemblies.","pos":[14016,14132]},{"content":"To avoid this problem, you should install shared assemblies to the Global Assembly Cache (GAC) and use a MergeModule for the component.","pos":[14139,14274]},{"content":"If you cannot install the application in the GAC, it should be installed to CommonFilesFolder in a version-specific subdirectory.","pos":[14275,14404]},{"content":"Assemblies that are not shared should be located side by side in the directory with the calling application.","pos":[14411,14519]},{"pos":[14528,14536],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute&gt;</ph>","pos":[14540,14596],"source":"<xref:System.Runtime.InteropServices.MarshalAsAttribute> "},{"content":"<bpt id=\"p1\"> [</bpt>COM Interop<ept id=\"p1\">](../../../visual-basic/programming-guide/com-interop/index.md)</ept><ph id=\"ph1\"> </ph>","pos":[14600,14677],"source":" [COM Interop](../../../visual-basic/programming-guide/com-interop/index.md) "},{"content":"<bpt id=\"p1\"> [</bpt>Tlbimp.exe (Type Library Importer)<ept id=\"p1\">](http://msdn.microsoft.com/library/ec0a8d63-11b3-4acd-b398-da1e37e97382)</ept><ph id=\"ph1\"> </ph>","pos":[14680,14790],"source":" [Tlbimp.exe (Type Library Importer)](http://msdn.microsoft.com/library/ec0a8d63-11b3-4acd-b398-da1e37e97382) "},{"content":"<bpt id=\"p1\"> [</bpt>Tlbexp.exe (Type Library Exporter)<ept id=\"p1\">](http://msdn.microsoft.com/library/a487d61b-d166-467b-a7ca-d8b52fbff42d)</ept><ph id=\"ph1\"> </ph>","pos":[14793,14903],"source":" [Tlbexp.exe (Type Library Exporter)](http://msdn.microsoft.com/library/a487d61b-d166-467b-a7ca-d8b52fbff42d) "},{"content":"<bpt id=\"p1\"> [</bpt>Walkthrough: Implementing Inheritance with COM Objects<ept id=\"p1\">](../../../visual-basic/programming-guide/com-interop/walkthrough-implementing-inheritance-with-com-objects.md)</ept><ph id=\"ph1\"> </ph>","pos":[14906,15074],"source":" [Walkthrough: Implementing Inheritance with COM Objects](../../../visual-basic/programming-guide/com-interop/walkthrough-implementing-inheritance-with-com-objects.md) "},{"content":"<bpt id=\"p1\"> [</bpt>Inherits Statement<ept id=\"p1\">](../../../visual-basic/language-reference/statements/inherits-statement.md)</ept><ph id=\"ph1\"> </ph>","pos":[15077,15174],"source":" [Inherits Statement](../../../visual-basic/language-reference/statements/inherits-statement.md) "},{"content":"<bpt id=\"p1\"> [</bpt>Global Assembly Cache<ept id=\"p1\">](../../../framework/app-domains/gac.md)</ept>","pos":[15177,15240],"source":" [Global Assembly Cache](../../../framework/app-domains/gac.md)"}]}