{"content":"---\ntitle: \"How to: Secure a Service with an X.509 Certificate\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 2d06c2aa-d0d7-4e5e-ad7e-77416aa1c10b\n---\n# How to: Secure a Service with an X.509 Certificate\nSecuring a service with an X.509 certificate is a basic technique that most bindings in Windows Communication Foundation (WCF) use. This topic walks through the steps of configuring a self-hosted service with an X.509 certificate.  \n  \n A prerequisite is a valid certificate that can be used to authenticate the server. The certificate must be issued to the server by a trusted certificate authority. If the certificate is not valid, any client trying to use the service will not trust the service, and consequently no connection will be made. For more information about using certificates, see [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).  \n  \n### To configure a service with a certificate using code  \n  \n1.  Create the service contract and the implemented service. For more information, see [Designing and Implementing Services](../../../../docs/framework/wcf/designing-and-implementing-services.md).  \n  \n2.  Create an instance of the <xref:System.ServiceModel.WSHttpBinding> class and set its security mode to <xref:System.ServiceModel.SecurityMode.Message>, as shown in the following code.  \n  \n     [!code-csharp[C_SecureWithCertificate#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#1)]\n     [!code-vb[C_SecureWithCertificate#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#1)]  \n  \n3.  Create two <xref:System.Type> variables, one each for the contract type and the implemented contract, as shown in the following code.  \n  \n     [!code-csharp[C_SecureWithCertificate#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#2)]\n     [!code-vb[C_SecureWithCertificate#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#2)]  \n  \n4.  Create an instance of the <xref:System.Uri> class for the base address of the service. Because the `WSHttpBinding` uses the HTTP transport, the Uniform Resource Identifier (URI) must begin with that schema, or Windows Communication Foundation (WCF) will throw an exception when the service is opened.  \n  \n     [!code-csharp[C_SecureWithCertificate#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#3)]\n     [!code-vb[C_SecureWithCertificate#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#3)]  \n  \n5.  Create a new instance of the <xref:System.ServiceModel.ServiceHost> class with the implemented contract type variable and the URI.  \n  \n     [!code-csharp[C_SecureWithCertificate#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#4)]\n     [!code-vb[C_SecureWithCertificate#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#4)]  \n  \n6.  Add a <xref:System.ServiceModel.Description.ServiceEndpoint> to the service using the <xref:System.ServiceModel.ServiceHost.AddServiceEndpoint%2A> method. Pass the contract, binding, and an endpoint address to the constructor, as shown in the following code.  \n  \n     [!code-csharp[C_SecureWithCertificate#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#5)]\n     [!code-vb[C_SecureWithCertificate#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#5)]  \n  \n7.  Optional. To retrieve metadata from the service, create a new <xref:System.ServiceModel.Description.ServiceMetadataBehavior> object and set the <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpGetEnabled%2A> property to `true`.  \n  \n     [!code-csharp[C_SecureWithCertificate#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#6)]\n     [!code-vb[C_SecureWithCertificate#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#6)]  \n  \n8.  Use the <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A> method of the <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential> class to add the valid certificate to the service. The method can use one of several methods to find a certificate. This example uses the <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectName> enumeration. The enumeration specifies that the supplied value is the name of the entity that the certificate was issued to.  \n  \n     [!code-csharp[C_SecureWithCertificate#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#7)]\n     [!code-vb[C_SecureWithCertificate#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#7)]  \n  \n9. Call the <xref:System.ServiceModel.Channels.CommunicationObject.Open%2A> method to start the service listening. If you are creating a console application, call the <xref:System.Console.ReadLine%2A> method to keep the service in the listening state.  \n  \n     [!code-csharp[C_SecureWithCertificate#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#8)]\n     [!code-vb[C_SecureWithCertificate#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#8)]  \n  \n## Example  \n The following example uses the <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A> method to configure a service with an X.509 certificate.  \n  \n [!code-csharp[C_SecureWithCertificate#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#9)]\n [!code-vb[C_SecureWithCertificate#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#9)]  \n  \n## Compiling the Code  \n The following namespaces are required to compile the code:  \n  \n-   <xref:System>  \n  \n-   <xref:System.ServiceModel>  \n  \n-   <xref:System.ServiceModel.Channels>  \n  \n-   <xref:System.Web.Services.Description>  \n  \n-   <xref:System.Security.Cryptography.X509Certificates>  \n  \n-   <xref:System.Runtime.Serialization>  \n  \n## See also\n\n- [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)\n","nodes":[{"pos":[4,168],"embed":true,"restype":"x-metadata","content":"title: \"How to: Secure a Service with an X.509 Certificate\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 2d06c2aa-d0d7-4e5e-ad7e-77416aa1c10b","nodes":[{"content":"How to: Secure a Service with an X.509 Certificate","nodes":[{"pos":[0,50],"content":"How to: Secure a Service with an X.509 Certificate","nodes":[{"content":"How to: Secure a Service with an X.509 Certificate","pos":[0,50]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[175,225],"content":"How to: Secure a Service with an X.509 Certificate","linkify":"How to: Secure a Service with an X.509 Certificate","nodes":[{"content":"How to: Secure a Service with an X.509 Certificate","pos":[0,50]}]},{"content":"Securing a service with an X.509 certificate is a basic technique that most bindings in Windows Communication Foundation (WCF) use.","pos":[226,357]},{"content":"This topic walks through the steps of configuring a self-hosted service with an X.509 certificate.","pos":[358,456]},{"content":"A prerequisite is a valid certificate that can be used to authenticate the server.","pos":[463,545]},{"content":"The certificate must be issued to the server by a trusted certificate authority.","pos":[546,626]},{"content":"If the certificate is not valid, any client trying to use the service will not trust the service, and consequently no connection will be made.","pos":[627,769]},{"content":"For more information about using certificates, see <bpt id=\"p1\">[</bpt>Working with Certificates<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)</ept>.","pos":[770,926],"source":" For more information about using certificates, see [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)."},{"pos":[936,988],"content":"To configure a service with a certificate using code","linkify":"To configure a service with a certificate using code","nodes":[{"content":"To configure a service with a certificate using code","pos":[0,52]}]},{"content":"Create the service contract and the implemented service.","pos":[998,1054]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Designing and Implementing Services<ept id=\"p1\">](../../../../docs/framework/wcf/designing-and-implementing-services.md)</ept>.","pos":[1055,1190],"source":" For more information, see [Designing and Implementing Services](../../../../docs/framework/wcf/designing-and-implementing-services.md)."},{"pos":[1200,1382],"content":"Create an instance of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.WSHttpBinding&gt;</ph> class and set its security mode to <ph id=\"ph2\">&lt;xref:System.ServiceModel.SecurityMode.Message&gt;</ph>, as shown in the following code.","source":"Create an instance of the <xref:System.ServiceModel.WSHttpBinding> class and set its security mode to <xref:System.ServiceModel.SecurityMode.Message>, as shown in the following code."},{"pos":[1393,1666],"content":"[!code-csharp[C_SecureWithCertificate#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#1)]\n [!code-vb[C_SecureWithCertificate#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#1)]","leadings":["","    "],"nodes":[]},{"pos":[1676,1809],"content":"Create two <ph id=\"ph1\">&lt;xref:System.Type&gt;</ph> variables, one each for the contract type and the implemented contract, as shown in the following code.","source":"Create two <xref:System.Type> variables, one each for the contract type and the implemented contract, as shown in the following code."},{"pos":[1820,2093],"content":"[!code-csharp[C_SecureWithCertificate#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#2)]\n [!code-vb[C_SecureWithCertificate#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#2)]","leadings":["","    "],"nodes":[]},{"content":"Create an instance of the <ph id=\"ph1\">&lt;xref:System.Uri&gt;</ph> class for the base address of the service.","pos":[2103,2189],"source":"Create an instance of the <xref:System.Uri> class for the base address of the service."},{"content":"Because the <ph id=\"ph1\">`WSHttpBinding`</ph> uses the HTTP transport, the Uniform Resource Identifier (URI) must begin with that schema, or Windows Communication Foundation (WCF) will throw an exception when the service is opened.","pos":[2190,2403],"source":" Because the `WSHttpBinding` uses the HTTP transport, the Uniform Resource Identifier (URI) must begin with that schema, or Windows Communication Foundation (WCF) will throw an exception when the service is opened."},{"pos":[2414,2687],"content":"[!code-csharp[C_SecureWithCertificate#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#3)]\n [!code-vb[C_SecureWithCertificate#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#3)]","leadings":["","    "],"nodes":[]},{"pos":[2697,2827],"content":"Create a new instance of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> class with the implemented contract type variable and the URI.","source":"Create a new instance of the <xref:System.ServiceModel.ServiceHost> class with the implemented contract type variable and the URI."},{"pos":[2838,3111],"content":"[!code-csharp[C_SecureWithCertificate#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#4)]\n [!code-vb[C_SecureWithCertificate#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#4)]","leadings":["","    "],"nodes":[]},{"content":"Add a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceEndpoint&gt;</ph> to the service using the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceHost.AddServiceEndpoint%2A&gt;</ph> method.","pos":[3121,3275],"source":"Add a <xref:System.ServiceModel.Description.ServiceEndpoint> to the service using the <xref:System.ServiceModel.ServiceHost.AddServiceEndpoint%2A> method."},{"content":"Pass the contract, binding, and an endpoint address to the constructor, as shown in the following code.","pos":[3276,3379]},{"pos":[3390,3663],"content":"[!code-csharp[C_SecureWithCertificate#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#5)]\n [!code-vb[C_SecureWithCertificate#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#5)]","leadings":["","    "],"nodes":[]},{"content":"Optional.","pos":[3673,3682]},{"content":"To retrieve metadata from the service, create a new <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceMetadataBehavior&gt;</ph> object and set the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpGetEnabled%2A&gt;</ph> property to <ph id=\"ph3\">`true`</ph>.","pos":[3683,3917],"source":" To retrieve metadata from the service, create a new <xref:System.ServiceModel.Description.ServiceMetadataBehavior> object and set the <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpGetEnabled%2A> property to `true`."},{"pos":[3928,4201],"content":"[!code-csharp[C_SecureWithCertificate#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#6)]\n [!code-vb[C_SecureWithCertificate#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#6)]","leadings":["","    "],"nodes":[]},{"content":"Use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A&gt;</ph> method of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential&gt;</ph> class to add the valid certificate to the service.","pos":[4211,4457],"source":"Use the <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A> method of the <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential> class to add the valid certificate to the service."},{"content":"The method can use one of several methods to find a certificate.","pos":[4458,4522]},{"content":"This example uses the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectName&gt;</ph> enumeration.","pos":[4523,4641],"source":" This example uses the <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectName> enumeration."},{"content":"The enumeration specifies that the supplied value is the name of the entity that the certificate was issued to.","pos":[4642,4753]},{"pos":[4764,5037],"content":"[!code-csharp[C_SecureWithCertificate#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#7)]\n [!code-vb[C_SecureWithCertificate#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#7)]","leadings":["","    "],"nodes":[]},{"content":"Call the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.CommunicationObject.Open%2A&gt;</ph> method to start the service listening.","pos":[5046,5157],"source":"Call the <xref:System.ServiceModel.Channels.CommunicationObject.Open%2A> method to start the service listening."},{"content":"If you are creating a console application, call the <ph id=\"ph1\">&lt;xref:System.Console.ReadLine%2A&gt;</ph> method to keep the service in the listening state.","pos":[5158,5294],"source":" If you are creating a console application, call the <xref:System.Console.ReadLine%2A> method to keep the service in the listening state."},{"pos":[5305,5578],"content":"[!code-csharp[C_SecureWithCertificate#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#8)]\n  [!code-vb[C_SecureWithCertificate#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#8)]","leadings":["","   "],"nodes":[]},{"pos":[5587,5594],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"pos":[5598,5781],"content":"The following example uses the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A&gt;</ph> method to configure a service with an X.509 certificate.","source":"The following example uses the <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A> method to configure a service with an X.509 certificate."},{"pos":[6066,6084],"content":"Compiling the Code","linkify":"Compiling the Code","nodes":[{"content":"Compiling the Code","pos":[0,18]}]},{"content":"The following namespaces are required to compile the code:","pos":[6088,6146]},{"pos":[6414,6422],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6426,6530],"content":"<bpt id=\"p1\">[</bpt>Working with Certificates<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)</ept>","source":"[Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)"}]}