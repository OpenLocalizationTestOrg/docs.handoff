{"content":"---\ntitle: \"How to: Cancel a Task and Its Children | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"tasks, how to cancel\"\nms.assetid: 08574301-8331-4719-ad50-9cf7f6ff3048\ncaps.latest.revision: 16\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# How to: Cancel a Task and Its Children\nThese examples show how to perform the following tasks:  \n  \n1.  Create and start a cancelable task.  \n  \n2.  Pass a cancellation token to your user delegate and optionally to the task instance.  \n  \n3.  Notice and respond to the cancellation request in your user delegate.  \n  \n4.  Optionally notice on the calling thread that the task was canceled.  \n  \n The calling thread does not forcibly end the task; it only signals that cancellation is requested. If the task is already running, it is up to the user delegate to notice the request and respond appropriately. If cancellation is requested before the task runs, then the user delegate is never executed and the task object transitions into the Canceled state.  \n  \n## Example  \n This example shows how to terminate a <xref:System.Threading.Tasks.Task> and its children in response to a cancellation request. It also shows that when a user delegate terminates by throwing a <xref:System.Threading.Tasks.TaskCanceledException>, the calling thread can optionally use the <xref:System.Threading.Tasks.Task.Wait%2A> method or <xref:System.Threading.Tasks.Task.WaitAll%2A> method to wait for the tasks to finish. In this case, you must use a `try/catch` block to handle the exceptions on the calling thread.  \n  \n [!code-csharp[TPL_Cancellation#04](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_cancellation/cs/cancel1.cs#04)]\n [!code-vb[TPL_Cancellation#04](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_cancellation/vb/cancel1.vb#04)]  \n  \n The <xref:System.Threading.Tasks.Task?displayProperty=fullName> class is fully integrated with the cancellation model that is based on the <xref:System.Threading.CancellationTokenSource?displayProperty=fullName> and <xref:System.Threading.CancellationToken?displayProperty=fullName> types. For more information, see [Cancellation in Managed Threads](../../../docs/standard/threading/cancellation-in-managed-threads.md) and [Task Cancellation](../../../docs/standard/parallel-programming/task-cancellation.md).  \n  \n## See Also  \n <xref:System.Threading.CancellationTokenSource?displayProperty=fullName>   \n <xref:System.Threading.CancellationToken?displayProperty=fullName>   \n <xref:System.Threading.Tasks.Task?displayProperty=fullName>   \n <xref:System.Threading.Tasks.Task%601?displayProperty=fullName>   \n [Task-based Asynchronous Programming](../../../docs/standard/parallel-programming/task-based-asynchronous-programming.md)   \n [Attached and Detached Child Tasks](../../../docs/standard/parallel-programming/attached-and-detached-child-tasks.md)   \n [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md)","nodes":[{"pos":[4,401],"embed":true,"restype":"x-metadata","content":"title: \"How to: Cancel a Task and Its Children | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"tasks, how to cancel\"\nms.assetid: 08574301-8331-4719-ad50-9cf7f6ff3048\ncaps.latest.revision: 16\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"","nodes":[{"content":"How to: Cancel a Task and Its Children | Microsoft Docs","nodes":[{"pos":[0,55],"content":"How to: Cancel a Task and Its Children | Microsoft Docs","nodes":[{"content":"How to: Cancel a Task and Its Children | Microsoft Docs","pos":[0,55]}]}],"path":["title"]}],"yml":true},{"pos":[408,446],"content":"How to: Cancel a Task and Its Children","linkify":"How to: Cancel a Task and Its Children","nodes":[{"content":"How to: Cancel a Task and Its Children","pos":[0,38]}]},{"content":"These examples show how to perform the following tasks:","pos":[447,502]},{"content":"Create and start a cancelable task.","pos":[512,547]},{"content":"Pass a cancellation token to your user delegate and optionally to the task instance.","pos":[557,641]},{"content":"Notice and respond to the cancellation request in your user delegate.","pos":[651,720]},{"content":"Optionally notice on the calling thread that the task was canceled.","pos":[730,797]},{"content":"The calling thread does not forcibly end the task; it only signals that cancellation is requested.","pos":[804,902]},{"content":"If the task is already running, it is up to the user delegate to notice the request and respond appropriately.","pos":[903,1013]},{"content":"If cancellation is requested before the task runs, then the user delegate is never executed and the task object transitions into the Canceled state.","pos":[1014,1162]},{"pos":[1171,1178],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"This example shows how to terminate a <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Task&gt;</ph> and its children in response to a cancellation request.","pos":[1182,1310],"source":"This example shows how to terminate a <xref:System.Threading.Tasks.Task> and its children in response to a cancellation request."},{"content":"It also shows that when a user delegate terminates by throwing a <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.TaskCanceledException&gt;</ph>, the calling thread can optionally use the <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Task.Wait%2A&gt;</ph> method or <ph id=\"ph3\">&lt;xref:System.Threading.Tasks.Task.WaitAll%2A&gt;</ph> method to wait for the tasks to finish.","pos":[1311,1609],"source":" It also shows that when a user delegate terminates by throwing a <xref:System.Threading.Tasks.TaskCanceledException>, the calling thread can optionally use the <xref:System.Threading.Tasks.Task.Wait%2A> method or <xref:System.Threading.Tasks.Task.WaitAll%2A> method to wait for the tasks to finish."},{"content":"In this case, you must use a <ph id=\"ph1\">`try/catch`</ph> block to handle the exceptions on the calling thread.","pos":[1610,1704],"source":" In this case, you must use a `try/catch` block to handle the exceptions on the calling thread."},{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPL_Cancellation#04<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_cancellation/cs/cancel1.cs#04)</ept><ept id=\"p1\">]</ept>","pos":[1711,1831],"source":"[!code-csharp[TPL_Cancellation#04](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_cancellation/cs/cancel1.cs#04)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>TPL_Cancellation#04<ept id=\"p2\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_cancellation/vb/cancel1.vb#04)</ept><ept id=\"p1\">]</ept>","pos":[1833,1954],"source":"[!code-vb[TPL_Cancellation#04](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_cancellation/vb/cancel1.vb#04)]"},{"content":"The <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Task?displayProperty=fullName&gt;</ph> class is fully integrated with the cancellation model that is based on the <ph id=\"ph2\">&lt;xref:System.Threading.CancellationTokenSource?displayProperty=fullName&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.Threading.CancellationToken?displayProperty=fullName&gt;</ph> types.","pos":[1961,2250],"source":"The <xref:System.Threading.Tasks.Task?displayProperty=fullName> class is fully integrated with the cancellation model that is based on the <xref:System.Threading.CancellationTokenSource?displayProperty=fullName> and <xref:System.Threading.CancellationToken?displayProperty=fullName> types."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Cancellation in Managed Threads<ept id=\"p1\">](../../../docs/standard/threading/cancellation-in-managed-threads.md)</ept> and <bpt id=\"p2\">[</bpt>Task Cancellation<ept id=\"p2\">](../../../docs/standard/parallel-programming/task-cancellation.md)</ept>.","pos":[2251,2470],"source":" For more information, see [Cancellation in Managed Threads](../../../docs/standard/threading/cancellation-in-managed-threads.md) and [Task Cancellation](../../../docs/standard/parallel-programming/task-cancellation.md)."},{"pos":[2479,2487],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.CancellationTokenSource?displayProperty=fullName&gt;</ph>","pos":[2491,2563],"source":"<xref:System.Threading.CancellationTokenSource?displayProperty=fullName> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.CancellationToken?displayProperty=fullName&gt;</ph>","pos":[2568,2634],"source":"<xref:System.Threading.CancellationToken?displayProperty=fullName> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Task?displayProperty=fullName&gt;</ph>","pos":[2639,2698],"source":"<xref:System.Threading.Tasks.Task?displayProperty=fullName> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Task%601?displayProperty=fullName&gt;</ph>","pos":[2703,2766],"source":"<xref:System.Threading.Tasks.Task%601?displayProperty=fullName> "},{"content":"<bpt id=\"p1\">[</bpt>Task-based Asynchronous Programming<ept id=\"p1\">](../../../docs/standard/parallel-programming/task-based-asynchronous-programming.md)</ept><ph id=\"ph1\"> </ph>","pos":[2771,2893],"source":"[Task-based Asynchronous Programming](../../../docs/standard/parallel-programming/task-based-asynchronous-programming.md) "},{"content":"<bpt id=\"p1\">[</bpt>Attached and Detached Child Tasks<ept id=\"p1\">](../../../docs/standard/parallel-programming/attached-and-detached-child-tasks.md)</ept><ph id=\"ph1\"> </ph>","pos":[2897,3015],"source":"[Attached and Detached Child Tasks](../../../docs/standard/parallel-programming/attached-and-detached-child-tasks.md) "},{"content":"<bpt id=\"p1\">[</bpt>Lambda Expressions in PLINQ and TPL<ept id=\"p1\">](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md)</ept>","pos":[3019,3140],"source":"[Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md)"}]}