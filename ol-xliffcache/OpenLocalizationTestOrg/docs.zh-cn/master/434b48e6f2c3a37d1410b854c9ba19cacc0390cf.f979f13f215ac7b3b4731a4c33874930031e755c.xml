{"content":"---\ntitle: \"How to: Enable SQL Persistence for Workflows and Workflow Services | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: ca7bf77f-3e5d-4b23-b17a-d0b60f46411d\ncaps.latest.revision: 36\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# How to: Enable SQL Persistence for Workflows and Workflow Services\nThis topic describes how to configure the SQL Workflow Instance Store feature to enable persistence for your workflows and workflow services both programmatically and by using a configuration file.  \n  \n Windows Server App Fabric simplifies the process of configuring persistence. [!INCLUDE[crdefault](../../../includes/crdefault-md.md)][App Fabric Persistence Configuration](http://go.microsoft.com/fwlink/?LinkId=201204)  \n  \n Before using the SQL Workflow Instance Store feature, create a database that the feature uses to persist workflow instances. The [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] set-up program copies SQL script files associated with the SQL Workflow Instance Store feature to the %WINDIR%\\Microsoft.NET\\Framework\\v4.xxx\\SQL\\EN folder. Run these script files against a SQL Server 2005 or SQL Server 2008 database that you want the SQL Workflow Instance Store to use to persist workflow instances. Run the SqlWorkflowInstanceStoreSchema.sql file first and then run the SqlWorkflowInstanceStoreLogic.sql file.  \n  \n> [!NOTE]\n>  To clean up the persistence database to have a fresh database, run the scripts in %WINDIR%\\Microsoft.NET\\Framework\\v4.xxx\\SQL\\EN in the following order.  \n>   \n>  1.  SqlWorkflowInstanceStoreSchema.sql  \n> 2.  SqlWorkflowInstanceStoreLogic.sql  \n  \n> [!IMPORTANT]\n>  If you do not create a persistence database, the SQL Workflow Instance Store feature throws an exception similar to the following one when a host tries to persist workflows.  \n>   \n>  System.Data.SqlClient.SqlException: Could not find stored procedure 'System.Activities.DurableInstancing.CreateLockOwner'  \n  \n The following sections describe how to enable persistence for workflows and workflow services using the SQL Workflow Instance Store. [!INCLUDE[crabout](../../../includes/crabout-md.md)] properties of the SQL Workflow Instance Store, see [Properties of SQL Workflow Instance Store](../../../docs/framework/windows-workflow-foundation/properties-of-sql-workflow-instance-store.md).  \n  \n## Enabling Persistence for Self-Hosted Workflows that use WorkflowApplication  \n You can enable persistence for self-hosted workflows that use <xref:System.Activities.WorkflowApplication> programmatically by using the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> object model. The following procedure contains steps to do this.  \n  \n#### To enable persistence for self-hosted workflows  \n  \n1.  Add a reference to System.Activites.DurableInstancing.dll.  \n  \n2.  Add the following statement at the top of the source file after the existing \"using\" statements.  \n  \n    ```csharp  \n    using System.Activities.DurableInstancing;  \n    ```  \n  \n3.  Construct a <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> and assign it to the <xref:System.Activities.WorkflowApplication.InstanceStore%2A> of the <xref:System.Activities.WorkflowApplication> as shown in the following code example.  \n  \n    ```csharp  \n  \n    SqlWorkflowInstanceStore store =   \n        new SqlWorkflowInstanceStore(\"Server=.\\\\SQLEXPRESS;Initial Catalog=Persistence;Integrated Security=SSPI\");  \n  \n    WorkflowApplication wfApp =  \n        new WorkflowApplication(new Workflow1());  \n  \n    wfApp.InstanceStore = store;  \n  \n    ```  \n  \n    > [!NOTE]\n    >  Depending on your edition of SQL Server, the connection string server name may be different.  \n  \n4.  Invoke the <xref:System.Activities.WorkflowApplication.Persist%2A> method on the <xref:System.Activities.WorkflowApplication> object to persist a workflow, or <xref:System.Activities.WorkflowApplication.Unload%2A> method to persist and unload a workflow. You can also handle the <xref:System.Activities.WorkflowApplication.PersistableIdle%2A> event raised by the <xref:System.Activities.WorkflowApplication> object and return appropriate (<xref:System.Activities.PersistableIdleAction> or <xref:System.Activities.PersistableIdleAction>) member of <xref:System.Activities.PersistableIdleAction>.  \n  \n    ```csharp  \n    wfApp.PersistableIdle = delegate(WorkflowApplicationIdleEventArgs e)  \n    {  \n        return PersistableIdleAction.Persist;  \n    };  \n    ```  \n  \n> [!NOTE]\n>  See the [Persisting a Workflow Application](../../../docs/framework/windows-workflow-foundation/samples/persisting-a-workflow-application.md) sample at [Persistence](../../../docs/framework/windows-workflow-foundation/samples/persistence.md) for an example of enabling persistence for workflows using the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore>, and the [How to: Create and Run a Long Running Workflow](../../../docs/framework/windows-workflow-foundation/how-to-create-and-run-a-long-running-workflow.md) step of the [Getting Started Tutorial](../../../docs/framework/windows-workflow-foundation/getting-started-tutorial.md) for step by step instructions.  \n  \n## Enabling Persistence for Self-Hosted Workflow Services that use the WorkflowServiceHost  \n You can enable persistence for self-hosted workflow services that use <xref:System.ServiceModel.WorkflowServiceHost> programmatically by using the <xref:System.ServiceModel.Activities.Description.SqlWorkflowInstanceStoreBehavior> class or the <xref:System.ServiceModel.Activities.WorkflowServiceHost.DurableInstancingOptions%2A> class.  \n  \n### Using the SqlWorkflowInstanceStoreBehavior Class  \n The following procedure contains steps to use the <xref:System.ServiceModel.Activities.Description.SqlWorkflowInstanceStoreBehavior> class to enable persistence for self-hosted workflow services.  \n  \n##### To enable persistence using SqlWorkflowInstanceStoreBehavior  \n  \n1.  Add a reference to the System.ServiceModel.dll.  \n  \n2.  Add the following statement at the top of the source file after the existing \"using\" statements.  \n  \n    ```csharp  \n    using System.ServiceModel.Activities.Description;  \n    ```  \n  \n3.  Create an instance of the `WorkflowServiceHost` and add endpoints for the workflow service.  \n  \n    ```  \n  \n    WorkflowServiceHost host = new WorkflowServiceHost(new CountingWorkflow(), new Uri(hostBaseAddress));  \n    host.AddServiceEndpoint(\"ICountingWorkflow\", new BasicHttpBinding(), \"\");  \n  \n    ```  \n  \n4.  Construct a `SqlWorkflowInstanceStoreBehavior` object and to set properties of the behavior object.  \n  \n    ```csharp  \n  \n    SqlWorkflowInstanceStoreBehavior instanceStoreBehavior = new SqlWorkflowInstanceStoreBehavior(connectionString);  \n    instanceStoreBehavior.HostLockRenewalPeriod = new TimeSpan(0, 0, 5);  \n    instanceStoreBehavior.InstanceCompletionAction = InstanceCompletionAction.DeleteAll;  \n    instanceStoreBehavior.InstanceLockedExceptionAction = InstanceLockedExceptionAction.AggressiveRetry;  \n    instanceStoreBehavior.InstanceEncodingOption = InstanceEncodingOption.GZip;  \n    instanceStoreBehavior.RunnableInstancesDetectionPeriod = new TimeSpan(\"00:00:02\");  \n    host.Description.Behaviors.Add(instanceStoreBehavior);  \n  \n    ```  \n  \n5.  Open the workflow service host.  \n  \n    ```vb  \n  \n    host.Open();  \n  \n    ```  \n  \n> [!IMPORTANT]\n>  See the [Built-in Configuration](../../../docs/framework/windows-workflow-foundation/samples/built-in-configuration.md) sample at [Persistence](../../../docs/framework/windows-workflow-foundation/samples/persistence.md) for an example of enabling persistence for workflow services using the `SqlWorkflowInstanceStoreBehavior` class.  \n  \n### Using the DurableInstancingOptions Property  \n When the `SqlWorkflowInstanceStoreBehavior` is applied, the `DurableInstancingOptions.InstanceStore` on the `WorkflowServiceHost` is set to the `SqlWorkflowInstanceStore` object created using the configuration values. You can do the same programmatically to set the <xref:System.ServiceModel.Activities.WorkflowServiceHost.DurableInstancingOptions%2A> property of the `WorkflowServiceHost` without using the `SqlWorkflowInstanceStoreBehavior` class as shown in the following code example.  \n  \n```  \nworkflowServiceHost.DurableInstancingOptions.InstanceStore = sqlInstanceStoreObject;  \n```  \n  \n## Enabling Persistence for WAS-Hosted Workflow Services that use the WorkflowServiceHost using a Configuration File  \n You can enable persistence for self-hosted or Windows Process Activation Service (WAS)-hosted workflow services by using a configuration file. A WAS-hosted workflow service uses the WorkflowServiceHost as the self-hosted workflow services do.  \n  \n The `SqlWorkflowInstanceStoreBehavior`, a service behavior that allows you to conveniently change the [SQL Workflow Instance Store](../../../docs/framework/windows-workflow-foundation/sql-workflow-instance-store.md) properties through XML configuration. For WAS-hosted workflow services, use the Web.config file. The following configuration example shows how to configure the SQL Workflow Instance Store by using the `sqlWorkflowInstanceStore` behavior element in a configuration file.  \n  \n```  \n  \n<serviceBehaviors>  \n    <behavior name=\"\">  \n        <sqlWorkflowInstanceStore   \n                    connectionString=\"Data Source=(local);Initial Catalog=DefaultPersistenceProviderDb;Integrated Security=True;Async=true\"  \n                    instanceEncodingOption=\"GZip | None\"  \n                    instanceCompletionAction=\"DeleteAll | DeleteNothing\"  \n                    instanceLockedExceptionAction=\"NoRetry | BasicRetry |AggressiveRetry\"  \n                    hostLockRenewalPeriod=\"00:00:30\"   \n                    runnableInstancesDetectionPeriod=\"00:00:05\">  \n  \n        <sqlWorkflowInstanceStore/>  \n    </behavior>  \n</serviceBehaviors>  \n  \n```  \n  \n If you do not set values for the `connectionString` or the `connectionStringName` property, the SQL Workflow Instance Store uses the default named connection string `DefaultSqlWorkflowInstanceStoreConnectionString`.  \n  \n When the `SqlWorkflowInstanceStoreBehavior` is applied, the `DurableInstancingOptions.InstanceStore` on the `WorkflowServiceHost` is set to the `SqlWorkflowInstanceStore` object created using the configuration values. You can do the same programmatically to use the `SqlWorkflowInstanceStore` with `WorkflowServiceHost` without using the service behavior element.  \n  \n```  \nworkflowServiceHost.DurableInstancingOptions.InstanceStore = sqlInstanceStoreObject;  \n```  \n  \n> [!IMPORTANT]\n>  It is recommended that you do not store sensitive information such as user names and passwords in the Web.config file. If you do store sensitive information in the Web.config file, you should secure access to the Web.config file by using file system Access Control Lists (ACLs). In addition, you can also secure the configuration values within a configuration file as mentioned in [Encrypting Configuration Information Using Protected Configuration](http://go.microsoft.com/fwlink/?LinkId=178419).  \n  \n### Machine.config Elements Related to the SQL Workflow Instance Store Feature  \n The [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] installation adds the following elements related to the SQL Workflow Instance Store feature to the Machine.config file:  \n  \n-   Adds the following behavior extension element to the Machine.config file so that you can use the <`sqlWorkflowInstanceStore`> service behavior element in the configuration file to configure persistence for your services.  \n  \n    ```  \n  \n    <configuration>  \n        <system.serviceModel>  \n            <extensions>  \n                <behaviorExtensions>  \n                    <add name=\"sqlWorkflowInstanceStore\" type=\"System.Activities.DurableInstancing.SqlWorkflowInstanceStoreElement, System.Activities.DurableInstancing, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\" />  \n                </behaviorExtensions>  \n            </extensions>  \n        <system.serviceModel>  \n    <configuration>  \n  \n    ```","nodes":[{"pos":[12,95],"content":"How to: Enable SQL Persistence for Workflows and Workflow Services | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"How to: Enable SQL Persistence for Workflows and Workflow Services | Microsoft Docs","pos":[0,83]}]},{"pos":[361,427],"content":"How to: Enable SQL Persistence for Workflows and Workflow Services","linkify":"How to: Enable SQL Persistence for Workflows and Workflow Services","nodes":[{"content":"How to: Enable SQL Persistence for Workflows and Workflow Services","pos":[0,66]}]},{"content":"This topic describes how to configure the SQL Workflow Instance Store feature to enable persistence for your workflows and workflow services both programmatically and by using a configuration file.","pos":[428,625]},{"content":"Windows Server App Fabric simplifies the process of configuring persistence.","pos":[632,708]},{"content":"<ph id=\"ph1\">[!INCLUDE[crdefault](../../../includes/crdefault-md.md)]</ph><bpt id=\"p1\">[</bpt>App Fabric Persistence Configuration<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=201204)</ept>","pos":[709,850],"source":"[!INCLUDE[crdefault](../../../includes/crdefault-md.md)][App Fabric Persistence Configuration](http://go.microsoft.com/fwlink/?LinkId=201204)"},{"content":"Before using the SQL Workflow Instance Store feature, create a database that the feature uses to persist workflow instances.","pos":[857,981]},{"content":"The <ph id=\"ph1\">[!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)]</ph> set-up program copies SQL script files associated with the SQL Workflow Instance Store feature to the %WINDIR%\\Microsoft.NET\\Framework\\v4.xxx\\SQL\\EN folder.","pos":[982,1219],"source":" The [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] set-up program copies SQL script files associated with the SQL Workflow Instance Store feature to the %WINDIR%\\Microsoft.NET\\Framework\\v4.xxx\\SQL\\EN folder."},{"content":"Run these script files against a SQL Server 2005 or SQL Server 2008 database that you want the SQL Workflow Instance Store to use to persist workflow instances.","pos":[1220,1380]},{"content":"Run the SqlWorkflowInstanceStoreSchema.sql file first and then run the SqlWorkflowInstanceStoreLogic.sql file.","pos":[1381,1491]},{"pos":[1499,1662],"content":"[!NOTE]\n To clean up the persistence database to have a fresh database, run the scripts in %WINDIR%\\Microsoft.NET\\Framework\\v4.xxx\\SQL\\EN in the following order.","leadings":["","> "],"nodes":[{"content":"To clean up the persistence database to have a fresh database, run the scripts in %WINDIR%\\Microsoft.NET\\Framework\\v4.xxx\\SQL\\EN in the following order.","pos":[9,161]}]},{"content":"SqlWorkflowInstanceStoreSchema.sql","pos":[1677,1711]},{"content":"SqlWorkflowInstanceStoreLogic.sql","pos":[1720,1753]},{"pos":[1761,1950],"content":"[!IMPORTANT]\n If you do not create a persistence database, the SQL Workflow Instance Store feature throws an exception similar to the following one when a host tries to persist workflows.","leadings":["","> "],"nodes":[{"content":"If you do not create a persistence database, the SQL Workflow Instance Store feature throws an exception similar to the following one when a host tries to persist workflows.","pos":[14,187]}]},{"content":"System.Data.SqlClient.SqlException: Could not find stored procedure 'System.Activities.DurableInstancing.CreateLockOwner'","pos":[1961,2082]},{"content":"The following sections describe how to enable persistence for workflows and workflow services using the SQL Workflow Instance Store.","pos":[2089,2221]},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../includes/crabout-md.md)]</ph> properties of the SQL Workflow Instance Store, see <bpt id=\"p1\">[</bpt>Properties of SQL Workflow Instance Store<ept id=\"p1\">](../../../docs/framework/windows-workflow-foundation/properties-of-sql-workflow-instance-store.md)</ept>.","pos":[2222,2468],"source":"[!INCLUDE[crabout](../../../includes/crabout-md.md)] properties of the SQL Workflow Instance Store, see [Properties of SQL Workflow Instance Store](../../../docs/framework/windows-workflow-foundation/properties-of-sql-workflow-instance-store.md)."},{"pos":[2477,2552],"content":"Enabling Persistence for Self-Hosted Workflows that use WorkflowApplication","linkify":"Enabling Persistence for Self-Hosted Workflows that use WorkflowApplication","nodes":[{"content":"Enabling Persistence for Self-Hosted Workflows that use WorkflowApplication","pos":[0,75]}]},{"content":"You can enable persistence for self-hosted workflows that use <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowApplication&gt;</ph> programmatically by using the <ph id=\"ph2\">&lt;xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore&gt;</ph> object model.","pos":[2556,2774],"source":"You can enable persistence for self-hosted workflows that use <xref:System.Activities.WorkflowApplication> programmatically by using the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> object model."},{"content":"The following procedure contains steps to do this.","pos":[2775,2825]},{"pos":[2836,2883],"content":"To enable persistence for self-hosted workflows","linkify":"To enable persistence for self-hosted workflows","nodes":[{"content":"To enable persistence for self-hosted workflows","pos":[0,47]}]},{"content":"Add a reference to System.Activites.DurableInstancing.dll.","pos":[2893,2951]},{"content":"Add the following statement at the top of the source file after the existing \"using\" statements.","pos":[2961,3057]},{"content":"Construct a <ph id=\"ph1\">&lt;xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore&gt;</ph> and assign it to the <ph id=\"ph2\">&lt;xref:System.Activities.WorkflowApplication.InstanceStore%2A&gt;</ph> of the <ph id=\"ph3\">&lt;xref:System.Activities.WorkflowApplication&gt;</ph> as shown in the following code example.","pos":[3145,3399],"source":"Construct a <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> and assign it to the <xref:System.Activities.WorkflowApplication.InstanceStore%2A> of the <xref:System.Activities.WorkflowApplication> as shown in the following code example."},{"pos":[3730,3837],"content":"[!NOTE]\nDepending on your edition of SQL Server, the connection string server name may be different.","leadings":["","    >  "],"nodes":[{"content":"Depending on your edition of SQL Server, the connection string server name may be different.","pos":[8,100]}]},{"content":"Invoke the <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowApplication.Persist%2A&gt;</ph> method on the <ph id=\"ph2\">&lt;xref:System.Activities.WorkflowApplication&gt;</ph> object to persist a workflow, or <ph id=\"ph3\">&lt;xref:System.Activities.WorkflowApplication.Unload%2A&gt;</ph> method to persist and unload a workflow.","pos":[3847,4101],"source":"Invoke the <xref:System.Activities.WorkflowApplication.Persist%2A> method on the <xref:System.Activities.WorkflowApplication> object to persist a workflow, or <xref:System.Activities.WorkflowApplication.Unload%2A> method to persist and unload a workflow."},{"content":"You can also handle the <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowApplication.PersistableIdle%2A&gt;</ph> event raised by the <ph id=\"ph2\">&lt;xref:System.Activities.WorkflowApplication&gt;</ph> object and return appropriate (<ph id=\"ph3\">&lt;xref:System.Activities.PersistableIdleAction&gt;</ph> or <ph id=\"ph4\">&lt;xref:System.Activities.PersistableIdleAction&gt;</ph>) member of <ph id=\"ph5\">&lt;xref:System.Activities.PersistableIdleAction&gt;</ph>.","pos":[4102,4441],"source":" You can also handle the <xref:System.Activities.WorkflowApplication.PersistableIdle%2A> event raised by the <xref:System.Activities.WorkflowApplication> object and return appropriate (<xref:System.Activities.PersistableIdleAction> or <xref:System.Activities.PersistableIdleAction>) member of <xref:System.Activities.PersistableIdleAction>."},{"pos":[4618,5312],"content":"[!NOTE]\n See the [Persisting a Workflow Application](../../../docs/framework/windows-workflow-foundation/samples/persisting-a-workflow-application.md) sample at [Persistence](../../../docs/framework/windows-workflow-foundation/samples/persistence.md) for an example of enabling persistence for workflows using the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore>, and the [How to: Create and Run a Long Running Workflow](../../../docs/framework/windows-workflow-foundation/how-to-create-and-run-a-long-running-workflow.md) step of the [Getting Started Tutorial](../../../docs/framework/windows-workflow-foundation/getting-started-tutorial.md) for step by step instructions.","leadings":["","> "],"nodes":[{"content":"See the <bpt id=\"p1\">[</bpt>Persisting a Workflow Application<ept id=\"p1\">](../../../docs/framework/windows-workflow-foundation/samples/persisting-a-workflow-application.md)</ept> sample at <bpt id=\"p2\">[</bpt>Persistence<ept id=\"p2\">](../../../docs/framework/windows-workflow-foundation/samples/persistence.md)</ept> for an example of enabling persistence for workflows using the <ph id=\"ph1\">&lt;xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore&gt;</ph>, and the <bpt id=\"p3\">[</bpt>How to: Create and Run a Long Running Workflow<ept id=\"p3\">](../../../docs/framework/windows-workflow-foundation/how-to-create-and-run-a-long-running-workflow.md)</ept> step of the <bpt id=\"p4\">[</bpt>Getting Started Tutorial<ept id=\"p4\">](../../../docs/framework/windows-workflow-foundation/getting-started-tutorial.md)</ept> for step by step instructions.","pos":[9,692],"source":" See the [Persisting a Workflow Application](../../../docs/framework/windows-workflow-foundation/samples/persisting-a-workflow-application.md) sample at [Persistence](../../../docs/framework/windows-workflow-foundation/samples/persistence.md) for an example of enabling persistence for workflows using the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore>, and the [How to: Create and Run a Long Running Workflow](../../../docs/framework/windows-workflow-foundation/how-to-create-and-run-a-long-running-workflow.md) step of the [Getting Started Tutorial](../../../docs/framework/windows-workflow-foundation/getting-started-tutorial.md) for step by step instructions."}]},{"pos":[5321,5408],"content":"Enabling Persistence for Self-Hosted Workflow Services that use the WorkflowServiceHost","linkify":"Enabling Persistence for Self-Hosted Workflow Services that use the WorkflowServiceHost","nodes":[{"content":"Enabling Persistence for Self-Hosted Workflow Services that use the WorkflowServiceHost","pos":[0,87]}]},{"content":"You can enable persistence for self-hosted workflow services that use <ph id=\"ph1\">&lt;xref:System.ServiceModel.WorkflowServiceHost&gt;</ph> programmatically by using the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Description.SqlWorkflowInstanceStoreBehavior&gt;</ph> class or the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.WorkflowServiceHost.DurableInstancingOptions%2A&gt;</ph> class.","pos":[5412,5747],"source":"You can enable persistence for self-hosted workflow services that use <xref:System.ServiceModel.WorkflowServiceHost> programmatically by using the <xref:System.ServiceModel.Activities.Description.SqlWorkflowInstanceStoreBehavior> class or the <xref:System.ServiceModel.Activities.WorkflowServiceHost.DurableInstancingOptions%2A> class."},{"pos":[5757,5805],"content":"Using the SqlWorkflowInstanceStoreBehavior Class","linkify":"Using the SqlWorkflowInstanceStoreBehavior Class","nodes":[{"content":"Using the SqlWorkflowInstanceStoreBehavior Class","pos":[0,48]}]},{"content":"The following procedure contains steps to use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Description.SqlWorkflowInstanceStoreBehavior&gt;</ph> class to enable persistence for self-hosted workflow services.","pos":[5809,6004],"source":"The following procedure contains steps to use the <xref:System.ServiceModel.Activities.Description.SqlWorkflowInstanceStoreBehavior> class to enable persistence for self-hosted workflow services."},{"pos":[6016,6076],"content":"To enable persistence using SqlWorkflowInstanceStoreBehavior","linkify":"To enable persistence using SqlWorkflowInstanceStoreBehavior","nodes":[{"content":"To enable persistence using SqlWorkflowInstanceStoreBehavior","pos":[0,60]}]},{"content":"Add a reference to the System.ServiceModel.dll.","pos":[6086,6133]},{"content":"Add the following statement at the top of the source file after the existing \"using\" statements.","pos":[6143,6239]},{"pos":[6334,6425],"content":"Create an instance of the <ph id=\"ph1\">`WorkflowServiceHost`</ph> and add endpoints for the workflow service.","source":"Create an instance of the `WorkflowServiceHost` and add endpoints for the workflow service."},{"pos":[6652,6751],"content":"Construct a <ph id=\"ph1\">`SqlWorkflowInstanceStoreBehavior`</ph> object and to set properties of the behavior object.","source":"Construct a `SqlWorkflowInstanceStoreBehavior` object and to set properties of the behavior object."},{"content":"Open the workflow service host.","pos":[7420,7451]},{"pos":[7509,7857],"content":"[!IMPORTANT]\n See the [Built-in Configuration](../../../docs/framework/windows-workflow-foundation/samples/built-in-configuration.md) sample at [Persistence](../../../docs/framework/windows-workflow-foundation/samples/persistence.md) for an example of enabling persistence for workflow services using the `SqlWorkflowInstanceStoreBehavior` class.","leadings":["","> "],"nodes":[{"content":"See the <bpt id=\"p1\">[</bpt>Built-in Configuration<ept id=\"p1\">](../../../docs/framework/windows-workflow-foundation/samples/built-in-configuration.md)</ept> sample at <bpt id=\"p2\">[</bpt>Persistence<ept id=\"p2\">](../../../docs/framework/windows-workflow-foundation/samples/persistence.md)</ept> for an example of enabling persistence for workflow services using the <ph id=\"ph1\">`SqlWorkflowInstanceStoreBehavior`</ph> class.","pos":[14,346],"source":" See the [Built-in Configuration](../../../docs/framework/windows-workflow-foundation/samples/built-in-configuration.md) sample at [Persistence](../../../docs/framework/windows-workflow-foundation/samples/persistence.md) for an example of enabling persistence for workflow services using the `SqlWorkflowInstanceStoreBehavior` class."}]},{"pos":[7867,7910],"content":"Using the DurableInstancingOptions Property","linkify":"Using the DurableInstancingOptions Property","nodes":[{"content":"Using the DurableInstancingOptions Property","pos":[0,43]}]},{"content":"When the <ph id=\"ph1\">`SqlWorkflowInstanceStoreBehavior`</ph> is applied, the <ph id=\"ph2\">`DurableInstancingOptions.InstanceStore`</ph> on the <ph id=\"ph3\">`WorkflowServiceHost`</ph> is set to the <ph id=\"ph4\">`SqlWorkflowInstanceStore`</ph> object created using the configuration values.","pos":[7914,8131],"source":"When the `SqlWorkflowInstanceStoreBehavior` is applied, the `DurableInstancingOptions.InstanceStore` on the `WorkflowServiceHost` is set to the `SqlWorkflowInstanceStore` object created using the configuration values."},{"content":"You can do the same programmatically to set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.WorkflowServiceHost.DurableInstancingOptions%2A&gt;</ph> property of the <ph id=\"ph2\">`WorkflowServiceHost`</ph> without using the <ph id=\"ph3\">`SqlWorkflowInstanceStoreBehavior`</ph> class as shown in the following code example.","pos":[8132,8402],"source":" You can do the same programmatically to set the <xref:System.ServiceModel.Activities.WorkflowServiceHost.DurableInstancingOptions%2A> property of the `WorkflowServiceHost` without using the `SqlWorkflowInstanceStoreBehavior` class as shown in the following code example."},{"pos":[8513,8626],"content":"Enabling Persistence for WAS-Hosted Workflow Services that use the WorkflowServiceHost using a Configuration File","linkify":"Enabling Persistence for WAS-Hosted Workflow Services that use the WorkflowServiceHost using a Configuration File","nodes":[{"content":"Enabling Persistence for WAS-Hosted Workflow Services that use the WorkflowServiceHost using a Configuration File","pos":[0,113]}]},{"content":"You can enable persistence for self-hosted or Windows Process Activation Service (WAS)-hosted workflow services by using a configuration file.","pos":[8630,8772]},{"content":"A WAS-hosted workflow service uses the WorkflowServiceHost as the self-hosted workflow services do.","pos":[8773,8872]},{"content":"The <ph id=\"ph1\">`SqlWorkflowInstanceStoreBehavior`</ph>, a service behavior that allows you to conveniently change the <bpt id=\"p1\">[</bpt>SQL Workflow Instance Store<ept id=\"p1\">](../../../docs/framework/windows-workflow-foundation/sql-workflow-instance-store.md)</ept> properties through XML configuration.","pos":[8879,9132],"source":"The `SqlWorkflowInstanceStoreBehavior`, a service behavior that allows you to conveniently change the [SQL Workflow Instance Store](../../../docs/framework/windows-workflow-foundation/sql-workflow-instance-store.md) properties through XML configuration."},{"content":"For WAS-hosted workflow services, use the Web.config file.","pos":[9133,9191]},{"content":"The following configuration example shows how to configure the SQL Workflow Instance Store by using the <ph id=\"ph1\">`sqlWorkflowInstanceStore`</ph> behavior element in a configuration file.","pos":[9192,9364],"source":" The following configuration example shows how to configure the SQL Workflow Instance Store by using the `sqlWorkflowInstanceStore` behavior element in a configuration file."},{"pos":[10047,10262],"content":"If you do not set values for the <ph id=\"ph1\">`connectionString`</ph> or the <ph id=\"ph2\">`connectionStringName`</ph> property, the SQL Workflow Instance Store uses the default named connection string <ph id=\"ph3\">`DefaultSqlWorkflowInstanceStoreConnectionString`</ph>.","source":"If you do not set values for the `connectionString` or the `connectionStringName` property, the SQL Workflow Instance Store uses the default named connection string `DefaultSqlWorkflowInstanceStoreConnectionString`."},{"content":"When the <ph id=\"ph1\">`SqlWorkflowInstanceStoreBehavior`</ph> is applied, the <ph id=\"ph2\">`DurableInstancingOptions.InstanceStore`</ph> on the <ph id=\"ph3\">`WorkflowServiceHost`</ph> is set to the <ph id=\"ph4\">`SqlWorkflowInstanceStore`</ph> object created using the configuration values.","pos":[10269,10486],"source":"When the `SqlWorkflowInstanceStoreBehavior` is applied, the `DurableInstancingOptions.InstanceStore` on the `WorkflowServiceHost` is set to the `SqlWorkflowInstanceStore` object created using the configuration values."},{"content":"You can do the same programmatically to use the <ph id=\"ph1\">`SqlWorkflowInstanceStore`</ph> with <ph id=\"ph2\">`WorkflowServiceHost`</ph> without using the service behavior element.","pos":[10487,10632],"source":" You can do the same programmatically to use the `SqlWorkflowInstanceStore` with `WorkflowServiceHost` without using the service behavior element."},{"pos":[10742,11255],"content":"[!IMPORTANT]\n It is recommended that you do not store sensitive information such as user names and passwords in the Web.config file. If you do store sensitive information in the Web.config file, you should secure access to the Web.config file by using file system Access Control Lists (ACLs). In addition, you can also secure the configuration values within a configuration file as mentioned in [Encrypting Configuration Information Using Protected Configuration](http://go.microsoft.com/fwlink/?LinkId=178419).","leadings":["","> "],"nodes":[{"content":" It is recommended that you do not store sensitive information such as user names and passwords in the Web.config file. If you do store sensitive information in the Web.config file, you should secure access to the Web.config file by using file system Access Control Lists (ACLs). In addition, you can also secure the configuration values within a configuration file as mentioned in [Encrypting Configuration Information Using Protected Configuration](http://go.microsoft.com/fwlink/?LinkId=178419).","pos":[13,511],"nodes":[{"content":"It is recommended that you do not store sensitive information such as user names and passwords in the Web.config file.","pos":[1,119]},{"content":"If you do store sensitive information in the Web.config file, you should secure access to the Web.config file by using file system Access Control Lists (ACLs).","pos":[120,279]},{"content":"In addition, you can also secure the configuration values within a configuration file as mentioned in <bpt id=\"p1\">[</bpt>Encrypting Configuration Information Using Protected Configuration<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=178419)</ept>.","pos":[280,498],"source":" In addition, you can also secure the configuration values within a configuration file as mentioned in [Encrypting Configuration Information Using Protected Configuration](http://go.microsoft.com/fwlink/?LinkId=178419)."}]}]},{"pos":[11265,11339],"content":"Machine.config Elements Related to the SQL Workflow Instance Store Feature","linkify":"Machine.config Elements Related to the SQL Workflow Instance Store Feature","nodes":[{"content":"Machine.config Elements Related to the SQL Workflow Instance Store Feature","pos":[0,74]}]},{"pos":[11343,11543],"content":"The <ph id=\"ph1\">[!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)]</ph> installation adds the following elements related to the SQL Workflow Instance Store feature to the Machine.config file:","source":"The [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] installation adds the following elements related to the SQL Workflow Instance Store feature to the Machine.config file:"},{"pos":[11553,11773],"content":"Adds the following behavior extension element to the Machine.config file so that you can use the &lt;<ph id=\"ph1\">`sqlWorkflowInstanceStore`</ph>&gt; service behavior element in the configuration file to configure persistence for your services.","source":"Adds the following behavior extension element to the Machine.config file so that you can use the <`sqlWorkflowInstanceStore`> service behavior element in the configuration file to configure persistence for your services."}]}