{"content":"---\ntitle: \"How to: Secure Messages within Reliable Sessions | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: aee33e50-936f-4486-9ca8-c1520c19a62d\ncaps.latest.revision: 8\nauthor: \"BrucePerlerMS\"\nms.author: \"bruceper\"\nmanager: \"mbaldwin\"\n---\n# How to: Secure Messages within Reliable Sessions\nThis topic outlines the steps required to enable message-level security for messages exchanged within a reliable session using one of the system-provided bindings that support such a session, but not by default. You can enable a secure, reliable session either imperatively by using code or declaratively in the configuration file. This procedure uses the client and service configuration files to enable the secure, reliable session.  \n  \n This procedure consists of the following three key tasks:  \n  \n1.  Specify that the client and service exchange messages within a reliable session.  \n  \n2.  Require message-level security within the reliable session.  \n  \n3.  Specify the client credential type that the client must use to be authenticated with the service.  \n  \n It is important in the first task that the endpoint configuration element contain a `bindingConfiguration` attribute that references a binding configuration named (in this example) \"MessageSecurity.\" The [\\<binding>](../../../../docs/framework/misc/binding.md) configuration element can then reference this name to enable reliable sessions by setting the `enabled` attribute of the [reliableSession](http://msdn.microsoft.com/en-us/9c93818a-7dfa-43d5-b3a1-1aafccf3a00b) element to `true`. You can require that the ordered delivery assurances are available within a reliable session by setting the `ordered` attribute to `true`.  \n  \n For the source copy of the example on which this configuration procedure is based, see the [WS Reliable Session](../../../../docs/framework/wcf/samples/ws-reliable-session.md).  \n  \n The essential items of the second task are accomplished by setting the `mode` attribute of the <`security`> element contained in the <`binding`> element of the client and service to `Message`.  \n  \n The essential items of the third task are accomplished by setting the `clientCredentialType` attribute of the <`message`> element contained in the <`security`> element of the client and service to `Certificate`.  \n  \n> [!NOTE]\n>  When using message security with reliable sessions, if the client is not authenticated, Reliable Messaging attempts to authenticate the client until a timeout occurs instead of throwing an exception upon first failure.  \n  \n### To configure the service with a WSHttpBinding to use a reliable session  \n  \n1.  This procedure is described in [How to: Exchange Messages Within a Reliable Session](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-within-a-reliable-session.md).  \n  \n### To configure the client with a WSHttpBinding to use a reliable session  \n  \n1.  This procedure is described in [How to: Exchange Messages Within a Reliable Session](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-within-a-reliable-session.md).  \n  \n### To set the mode and ClientCredentialType in configuration  \n  \n1.  Add an appropriate binding element to the [\\<bindings>](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md) element of the configuration file. The following example adds a [\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) element.  \n  \n2.  Add a <`binding`> element and set its `name` attribute to an appropriate value.  \n  \n3.  Add a `<security>` element and set the `mode` attribute to `Message`.  \n  \n     The following example sets the mode to `Message`, and then sets the `clientCredentialType` attribute of the <`message`> element to `Certificate`.  \n  \n    ```  \n    <wsHttpBinding>  \n    <binding name=\"MessageSecurity\">  \n        <security mode=\"Message\" />  \n           <message clientCredentialType = \" Certificate\" />  \n        </security>  \n    </binding>  \n    </wsHttpBinding >  \n    ```","nodes":[{"pos":[12,77],"content":"How to: Secure Messages within Reliable Sessions | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"How to: Secure Messages within Reliable Sessions | Microsoft Docs","pos":[0,65]}]},{"pos":[386,434],"content":"How to: Secure Messages within Reliable Sessions","linkify":"How to: Secure Messages within Reliable Sessions","nodes":[{"content":"How to: Secure Messages within Reliable Sessions","pos":[0,48]}]},{"content":"This topic outlines the steps required to enable message-level security for messages exchanged within a reliable session using one of the system-provided bindings that support such a session, but not by default.","pos":[435,646]},{"content":"You can enable a secure, reliable session either imperatively by using code or declaratively in the configuration file.","pos":[647,766]},{"content":"This procedure uses the client and service configuration files to enable the secure, reliable session.","pos":[767,869]},{"content":"This procedure consists of the following three key tasks:","pos":[876,933]},{"content":"Specify that the client and service exchange messages within a reliable session.","pos":[943,1023]},{"content":"Require message-level security within the reliable session.","pos":[1033,1092]},{"content":"Specify the client credential type that the client must use to be authenticated with the service.","pos":[1102,1199]},{"content":"It is important in the first task that the endpoint configuration element contain a <ph id=\"ph1\">`bindingConfiguration`</ph> attribute that references a binding configuration named (in this example) \"MessageSecurity.\"","pos":[1206,1405],"source":"It is important in the first task that the endpoint configuration element contain a `bindingConfiguration` attribute that references a binding configuration named (in this example) \"MessageSecurity.\""},{"content":"The <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>binding&gt;<ept id=\"p1\">](../../../../docs/framework/misc/binding.md)</ept> configuration element can then reference this name to enable reliable sessions by setting the <ph id=\"ph2\">`enabled`</ph> attribute of the <bpt id=\"p2\">[</bpt>reliableSession<ept id=\"p2\">](http://msdn.microsoft.com/en-us/9c93818a-7dfa-43d5-b3a1-1aafccf3a00b)</ept> element to <ph id=\"ph3\">`true`</ph>.","pos":[1406,1694],"source":" The [\\<binding>](../../../../docs/framework/misc/binding.md) configuration element can then reference this name to enable reliable sessions by setting the `enabled` attribute of the [reliableSession](http://msdn.microsoft.com/en-us/9c93818a-7dfa-43d5-b3a1-1aafccf3a00b) element to `true`."},{"content":"You can require that the ordered delivery assurances are available within a reliable session by setting the <ph id=\"ph1\">`ordered`</ph> attribute to <ph id=\"ph2\">`true`</ph>.","pos":[1695,1833],"source":" You can require that the ordered delivery assurances are available within a reliable session by setting the `ordered` attribute to `true`."},{"pos":[1840,2016],"content":"For the source copy of the example on which this configuration procedure is based, see the <bpt id=\"p1\">[</bpt>WS Reliable Session<ept id=\"p1\">](../../../../docs/framework/wcf/samples/ws-reliable-session.md)</ept>.","source":"For the source copy of the example on which this configuration procedure is based, see the [WS Reliable Session](../../../../docs/framework/wcf/samples/ws-reliable-session.md)."},{"pos":[2023,2215],"content":"The essential items of the second task are accomplished by setting the <ph id=\"ph1\">`mode`</ph> attribute of the &lt;<ph id=\"ph2\">`security`</ph>&gt; element contained in the &lt;<ph id=\"ph3\">`binding`</ph>&gt; element of the client and service to <ph id=\"ph4\">`Message`</ph>.","source":"The essential items of the second task are accomplished by setting the `mode` attribute of the <`security`> element contained in the <`binding`> element of the client and service to `Message`."},{"pos":[2222,2433],"content":"The essential items of the third task are accomplished by setting the <ph id=\"ph1\">`clientCredentialType`</ph> attribute of the &lt;<ph id=\"ph2\">`message`</ph>&gt; element contained in the &lt;<ph id=\"ph3\">`security`</ph>&gt; element of the client and service to <ph id=\"ph4\">`Certificate`</ph>.","source":"The essential items of the third task are accomplished by setting the `clientCredentialType` attribute of the <`message`> element contained in the <`security`> element of the client and service to `Certificate`."},{"pos":[2441,2670],"content":"[!NOTE]\n When using message security with reliable sessions, if the client is not authenticated, Reliable Messaging attempts to authenticate the client until a timeout occurs instead of throwing an exception upon first failure.","leadings":["","> "],"nodes":[{"content":"When using message security with reliable sessions, if the client is not authenticated, Reliable Messaging attempts to authenticate the client until a timeout occurs instead of throwing an exception upon first failure.","pos":[9,227]}]},{"pos":[2680,2751],"content":"To configure the service with a WSHttpBinding to use a reliable session","linkify":"To configure the service with a WSHttpBinding to use a reliable session","nodes":[{"content":"To configure the service with a WSHttpBinding to use a reliable session","pos":[0,71]}]},{"pos":[2761,2948],"content":"This procedure is described in <bpt id=\"p1\">[</bpt>How to: Exchange Messages Within a Reliable Session<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-within-a-reliable-session.md)</ept>.","source":"This procedure is described in [How to: Exchange Messages Within a Reliable Session](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-within-a-reliable-session.md)."},{"pos":[2958,3028],"content":"To configure the client with a WSHttpBinding to use a reliable session","linkify":"To configure the client with a WSHttpBinding to use a reliable session","nodes":[{"content":"To configure the client with a WSHttpBinding to use a reliable session","pos":[0,70]}]},{"pos":[3038,3225],"content":"This procedure is described in <bpt id=\"p1\">[</bpt>How to: Exchange Messages Within a Reliable Session<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-within-a-reliable-session.md)</ept>.","source":"This procedure is described in [How to: Exchange Messages Within a Reliable Session](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-within-a-reliable-session.md)."},{"pos":[3235,3292],"content":"To set the mode and ClientCredentialType in configuration","linkify":"To set the mode and ClientCredentialType in configuration","nodes":[{"content":"To set the mode and ClientCredentialType in configuration","pos":[0,57]}]},{"content":"Add an appropriate binding element to the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>bindings&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md)</ept> element of the configuration file.","pos":[3302,3463],"source":"Add an appropriate binding element to the [\\<bindings>](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md) element of the configuration file."},{"content":"The following example adds a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>wsHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md)</ept> element.","pos":[3464,3596],"source":" The following example adds a [\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) element."},{"pos":[3606,3685],"content":"Add a &lt;<ph id=\"ph1\">`binding`</ph>&gt; element and set its <ph id=\"ph2\">`name`</ph> attribute to an appropriate value.","source":"Add a <`binding`> element and set its `name` attribute to an appropriate value."},{"pos":[3695,3764],"content":"Add a <ph id=\"ph1\">`&lt;security&gt;`</ph> element and set the <ph id=\"ph2\">`mode`</ph> attribute to <ph id=\"ph3\">`Message`</ph>.","source":"Add a `<security>` element and set the `mode` attribute to `Message`."},{"pos":[3775,3920],"content":"The following example sets the mode to <ph id=\"ph1\">`Message`</ph>, and then sets the <ph id=\"ph2\">`clientCredentialType`</ph> attribute of the &lt;<ph id=\"ph3\">`message`</ph>&gt; element to <ph id=\"ph4\">`Certificate`</ph>.","source":"The following example sets the mode to `Message`, and then sets the `clientCredentialType` attribute of the <`message`> element to `Certificate`."}]}