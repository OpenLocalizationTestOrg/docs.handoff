{"content":"---\ntitle: \"Walkthrough: Persisting an Object using C#\"\nms.date: 04/26/2018\n---\n# Walkthrough: persisting an object using C\\#\n\nYou can use serialization to persist an object's data between instances, which enables you to store values and retrieve them the next time that the object is instantiated.\n\nIn this walkthrough, you will create a basic `Loan` object and persist its data to a file. You will then retrieve the data from the file when you re-create the object.\n\n> [!IMPORTANT]\n> This example creates a new file if the file does not already exist. If an application must create a file, that application must have `Create` permission for the folder. Permissions are set by using access control lists. If the file already exists, the application needs only `Write` permission, a lesser permission. Where possible, it's more secure to create the file during deployment and only grant `Read` permissions to a single file (instead of Create permissions for a folder). Also, it's more secure to write data to user folders than to the root folder or the Program Files folder.\n\n> [!IMPORTANT]\n> This example stores data in a binary format file. These formats should not be used for sensitive data, such as passwords or credit-card information.\n\n## Prerequisites\n\n* To build and run, install the [.NET Core SDK](https://www.microsoft.com/net/core).\n\n* Install your favorite code editor, if you haven't already.\n\n> [!TIP]\n> Need to install a code editor? Try [Visual Studio](https://visualstudio.com/downloads)!\n\n* The example requires C# 7.3. See [Select the C# language version](../../../language-reference/configure-language-version.md) \n\nYou can examine the sample code online [at the .NET samples GitHub repository](https://github.com/dotnet/samples/tree/master/csharp/serialization).\n\n## Creating the loan object\n\nThe first step is to create a `Loan` class and a console application that uses the class:\n\n1. Create a new application. Type `dotnet new console -o serialization` to\ncreate a new console application in a subdirectory named `serialization`.\n1. Open the application in your editor, and add a new class named `Loan.cs`.\n1. Add the following code to your `Loan` class:\n\n[!code-csharp[Loan class definition](../../../../../samples/csharp/serialization/Loan.cs#1)]\n\nYou will also have to create an application that uses the `Loan` class.\n\n## Serialize the loan object\n\n1. Open `Program.cs`. Add the following code:\n\n[!code-csharp[Create a loan object](../../../../../samples/csharp/serialization/Program.cs#1)]\n\nAdd an event handler for the `PropertyChanged` event, and a few lines to modify the `Loan` object and display the changes. You can see the additions in the following code:\n\n[!code-csharp[Listening for the PropertyChanged event](../../../../../samples/csharp/serialization/Program.cs#2)]\n\nAt this point, you can run the code, and see the current output:\n\n```console\nNew customer value: Henry Clay\n7.5\n7.1\n```\n\nRunning this application repeatedly always writes the same values. A new Loan object is created every time you run the program. In the real world, interest rates change periodically, but not necessarily every time that the application is run. Serialization code means you preserve the most recent interest rate between instances of the application. In the next step, you will do just that by adding serialization to the Loan class.\n\n## Using Serialization to Persist the Object\n\nIn order to persist the values for the Loan class, you must first mark the class with the `Serializable` attribute. Add the following code above the Loan class definition:\n\n[!code-csharp[Loan class definition](../../../../../samples/csharp/serialization/Loan.cs#2)]\n\nThe <xref:System.SerializableAttribute> tells the compiler that everything in the class can be persisted to a file. Because the `PropertyChanged` event does not represent part of the object graph that should be stored, it should not be serialized. Doing so would serialize all objects that are attached to that event. You can add the <xref:System.NonSerializedAttribute> to the field declaration for the `PropertyChanged` event handler.\n\n[!code-csharp[Disable serialization for the event handler](../../../../../samples/csharp/serialization/Loan.cs#3)]\n\nBeginning with C# 7.3, you can attach attributes to the backing field of an auto-implemented property using the `field` target value. The following code adds a `TimeLastLoaded` property and marks it as not serializable:\n\n[!code-csharp[Disable serialization for an auto-implemented property](../../../../../samples/csharp/serialization/Loan.cs#4)]\n\nThe next step is to add the serialization code to the LoanApp application. In order to serialize the class and write it to a file, you use the <xref:System.IO> and <xref:System.Runtime.Serialization.Formatters.Binary> namespaces. To avoid typing the fully qualified names, you can add references to the necessary namespaces as shown in the following code:\n\n[!code-csharp[Adding namespaces for serialization](../../../../../samples/csharp/serialization/Program.cs#3)]\n\nThe next step is to add code to deserialize the object from the file when the object is created. Add a constant to the class for the serialized data's file name as shown in the following code:\n\n[!code-csharp[Define the name of the saved file](../../../../../samples/csharp/serialization/Program.cs#4)]\n\nNext, add the following code after the line that creates the `TestLoan` object:\n\n[!code-csharp[Read from a file if it exists](../../../../../samples/csharp/serialization/Program.cs#5)]\n\nYou first must check that the file exists. If it exists, create a <xref:System.IO.Stream> class to read the binary file and a <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> class to translate the file. You also need to convert from the stream type to the Loan object type.\n\nNext you must add code to serialize the class to a file. Add the following code after the existing code in the `Main` method:\n\n[!code-csharp[Save the existing Loan object](../../../../../samples/csharp/serialization/Program.cs#6)]\n\nAt this point, you can again build and run the application. The first time it runs, notice that the interest rates starts at 7.5, and then changes to 7.1. Close the application and then run it again. Now, the application prints the message that it has read the saved file, and the interest rate is 7.1 even before the code that changes it.\n\n## See also\n\n- [Serialization (C#)](index.md)\n- [C# Programming Guide](../..//index.md)\n","nodes":[{"pos":[4,75],"embed":true,"restype":"x-metadata","content":"title: \"Walkthrough: Persisting an Object using C#\"\nms.date: 04/26/2018","nodes":[{"content":"Walkthrough: Persisting an Object using C#","nodes":[{"pos":[0,42],"content":"Walkthrough: Persisting an Object using C#","nodes":[{"content":"Walkthrough: Persisting an Object using C#","pos":[0,42]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[82,125],"content":"Walkthrough: persisting an object using C\\#","linkify":"Walkthrough: persisting an object using C\\#","nodes":[{"content":"Walkthrough: persisting an object using C<ph id=\"ph1\">\\#</ph>","pos":[0,43],"source":"Walkthrough: persisting an object using C\\#"}]},{"content":"You can use serialization to persist an object's data between instances, which enables you to store values and retrieve them the next time that the object is instantiated.","pos":[127,298]},{"content":"In this walkthrough, you will create a basic <ph id=\"ph1\">`Loan`</ph> object and persist its data to a file.","pos":[300,390],"source":"In this walkthrough, you will create a basic `Loan` object and persist its data to a file."},{"content":"You will then retrieve the data from the file when you re-create the object.","pos":[391,467]},{"pos":[471,1074],"content":"[!IMPORTANT]\nThis example creates a new file if the file does not already exist. If an application must create a file, that application must have `Create` permission for the folder. Permissions are set by using access control lists. If the file already exists, the application needs only `Write` permission, a lesser permission. Where possible, it's more secure to create the file during deployment and only grant `Read` permissions to a single file (instead of Create permissions for a folder). Also, it's more secure to write data to user folders than to the root folder or the Program Files folder.","leadings":["","> "],"nodes":[{"content":"This example creates a new file if the file does not already exist. If an application must create a file, that application must have `Create` permission for the folder. Permissions are set by using access control lists. If the file already exists, the application needs only `Write` permission, a lesser permission. Where possible, it's more secure to create the file during deployment and only grant `Read` permissions to a single file (instead of Create permissions for a folder). Also, it's more secure to write data to user folders than to the root folder or the Program Files folder.","pos":[13,601],"nodes":[{"content":"This example creates a new file if the file does not already exist.","pos":[0,67]},{"content":"If an application must create a file, that application must have <ph id=\"ph1\">`Create`</ph> permission for the folder.","pos":[68,168],"source":" If an application must create a file, that application must have `Create` permission for the folder."},{"content":"Permissions are set by using access control lists.","pos":[169,219]},{"content":"If the file already exists, the application needs only <ph id=\"ph1\">`Write`</ph> permission, a lesser permission.","pos":[220,315],"source":" If the file already exists, the application needs only `Write` permission, a lesser permission."},{"content":"Where possible, it's more secure to create the file during deployment and only grant <ph id=\"ph1\">`Read`</ph> permissions to a single file (instead of Create permissions for a folder).","pos":[316,482],"source":" Where possible, it's more secure to create the file during deployment and only grant `Read` permissions to a single file (instead of Create permissions for a folder)."},{"content":"Also, it's more secure to write data to user folders than to the root folder or the Program Files folder.","pos":[483,588]}]}]},{"pos":[1078,1241],"content":"[!IMPORTANT]\nThis example stores data in a binary format file. These formats should not be used for sensitive data, such as passwords or credit-card information.","leadings":["","> "],"nodes":[{"content":"This example stores data in a binary format file. These formats should not be used for sensitive data, such as passwords or credit-card information.","pos":[13,161],"nodes":[{"content":"This example stores data in a binary format file.","pos":[0,49]},{"content":"These formats should not be used for sensitive data, such as passwords or credit-card information.","pos":[50,148]}]}]},{"pos":[1246,1259],"content":"Prerequisites","linkify":"Prerequisites","nodes":[{"content":"Prerequisites","pos":[0,13]}]},{"pos":[1263,1345],"content":"To build and run, install the <bpt id=\"p1\">[</bpt>.NET Core SDK<ept id=\"p1\">](https://www.microsoft.com/net/core)</ept>.","source":"To build and run, install the [.NET Core SDK](https://www.microsoft.com/net/core)."},{"content":"Install your favorite code editor, if you haven't already.","pos":[1349,1407]},{"pos":[1411,1507],"content":"[!TIP]\nNeed to install a code editor? Try [Visual Studio](https://visualstudio.com/downloads)!","leadings":["","> "],"nodes":[{"content":"Need to install a code editor? Try [Visual Studio](https://visualstudio.com/downloads)!","pos":[7,94],"nodes":[{"content":"Need to install a code editor?","pos":[0,30]},{"content":"Try <bpt id=\"p1\">[</bpt>Visual Studio<ept id=\"p1\">](https://visualstudio.com/downloads)</ept>!","pos":[31,87],"source":" Try [Visual Studio](https://visualstudio.com/downloads)!"}]}]},{"content":"The example requires C# 7.3.","pos":[1511,1539]},{"content":"See <bpt id=\"p1\">[</bpt>Select the C# language version<ept id=\"p1\">](../../../language-reference/configure-language-version.md)</ept>","pos":[1540,1635],"source":" See [Select the C# language version](../../../language-reference/configure-language-version.md)"},{"pos":[1638,1785],"content":"You can examine the sample code online <bpt id=\"p1\">[</bpt>at the .NET samples GitHub repository<ept id=\"p1\">](https://github.com/dotnet/samples/tree/master/csharp/serialization)</ept>.","source":"You can examine the sample code online [at the .NET samples GitHub repository](https://github.com/dotnet/samples/tree/master/csharp/serialization)."},{"pos":[1790,1814],"content":"Creating the loan object","linkify":"Creating the loan object","nodes":[{"content":"Creating the loan object","pos":[0,24]}]},{"pos":[1816,1905],"content":"The first step is to create a <ph id=\"ph1\">`Loan`</ph> class and a console application that uses the class:","source":"The first step is to create a `Loan` class and a console application that uses the class:"},{"content":"Create a new application.","pos":[1910,1935]},{"content":"Type <ph id=\"ph1\">`dotnet new console -o serialization`</ph> to create a new console application in a subdirectory named <ph id=\"ph2\">`serialization`</ph>.","pos":[1936,2055],"source":" Type `dotnet new console -o serialization` to\ncreate a new console application in a subdirectory named `serialization`."},{"pos":[2059,2132],"content":"Open the application in your editor, and add a new class named <ph id=\"ph1\">`Loan.cs`</ph>.","source":"Open the application in your editor, and add a new class named `Loan.cs`."},{"pos":[2136,2180],"content":"Add the following code to your <ph id=\"ph1\">`Loan`</ph> class:","source":"Add the following code to your `Loan` class:"},{"pos":[2276,2347],"content":"You will also have to create an application that uses the <ph id=\"ph1\">`Loan`</ph> class.","source":"You will also have to create an application that uses the `Loan` class."},{"pos":[2352,2377],"content":"Serialize the loan object","linkify":"Serialize the loan object","nodes":[{"content":"Serialize the loan object","pos":[0,25]}]},{"content":"Open <ph id=\"ph1\">`Program.cs`</ph>.","pos":[2382,2400],"source":"Open `Program.cs`."},{"content":"Add the following code:","pos":[2401,2424]},{"content":"Add an event handler for the <ph id=\"ph1\">`PropertyChanged`</ph> event, and a few lines to modify the <ph id=\"ph2\">`Loan`</ph> object and display the changes.","pos":[2522,2644],"source":"Add an event handler for the `PropertyChanged` event, and a few lines to modify the `Loan` object and display the changes."},{"content":"You can see the additions in the following code:","pos":[2645,2693]},{"content":"At this point, you can run the code, and see the current output:","pos":[2810,2874]},{"content":"Running this application repeatedly always writes the same values.","pos":[2931,2997]},{"content":"A new Loan object is created every time you run the program.","pos":[2998,3058]},{"content":"In the real world, interest rates change periodically, but not necessarily every time that the application is run.","pos":[3059,3173]},{"content":"Serialization code means you preserve the most recent interest rate between instances of the application.","pos":[3174,3279]},{"content":"In the next step, you will do just that by adding serialization to the Loan class.","pos":[3280,3362]},{"pos":[3367,3408],"content":"Using Serialization to Persist the Object","linkify":"Using Serialization to Persist the Object","nodes":[{"content":"Using Serialization to Persist the Object","pos":[0,41]}]},{"content":"In order to persist the values for the Loan class, you must first mark the class with the <ph id=\"ph1\">`Serializable`</ph> attribute.","pos":[3410,3525],"source":"In order to persist the values for the Loan class, you must first mark the class with the `Serializable` attribute."},{"content":"Add the following code above the Loan class definition:","pos":[3526,3581]},{"content":"The <ph id=\"ph1\">&lt;xref:System.SerializableAttribute&gt;</ph> tells the compiler that everything in the class can be persisted to a file.","pos":[3677,3792],"source":"The <xref:System.SerializableAttribute> tells the compiler that everything in the class can be persisted to a file."},{"content":"Because the <ph id=\"ph1\">`PropertyChanged`</ph> event does not represent part of the object graph that should be stored, it should not be serialized.","pos":[3793,3924],"source":" Because the `PropertyChanged` event does not represent part of the object graph that should be stored, it should not be serialized."},{"content":"Doing so would serialize all objects that are attached to that event.","pos":[3925,3994]},{"content":"You can add the <ph id=\"ph1\">&lt;xref:System.NonSerializedAttribute&gt;</ph> to the field declaration for the <ph id=\"ph2\">`PropertyChanged`</ph> event handler.","pos":[3995,4113],"source":" You can add the <xref:System.NonSerializedAttribute> to the field declaration for the `PropertyChanged` event handler."},{"content":"Beginning with C# 7.3, you can attach attributes to the backing field of an auto-implemented property using the <ph id=\"ph1\">`field`</ph> target value.","pos":[4231,4364],"source":"Beginning with C# 7.3, you can attach attributes to the backing field of an auto-implemented property using the `field` target value."},{"content":"The following code adds a <ph id=\"ph1\">`TimeLastLoaded`</ph> property and marks it as not serializable:","pos":[4365,4450],"source":" The following code adds a `TimeLastLoaded` property and marks it as not serializable:"},{"content":"The next step is to add the serialization code to the LoanApp application.","pos":[4579,4653]},{"content":"In order to serialize the class and write it to a file, you use the <ph id=\"ph1\">&lt;xref:System.IO&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.Formatters.Binary&gt;</ph> namespaces.","pos":[4654,4808],"source":" In order to serialize the class and write it to a file, you use the <xref:System.IO> and <xref:System.Runtime.Serialization.Formatters.Binary> namespaces."},{"content":"To avoid typing the fully qualified names, you can add references to the necessary namespaces as shown in the following code:","pos":[4809,4934]},{"content":"The next step is to add code to deserialize the object from the file when the object is created.","pos":[5047,5143]},{"content":"Add a constant to the class for the serialized data's file name as shown in the following code:","pos":[5144,5239]},{"pos":[5350,5429],"content":"Next, add the following code after the line that creates the <ph id=\"ph1\">`TestLoan`</ph> object:","source":"Next, add the following code after the line that creates the `TestLoan` object:"},{"content":"You first must check that the file exists.","pos":[5536,5578]},{"content":"If it exists, create a <ph id=\"ph1\">&lt;xref:System.IO.Stream&gt;</ph> class to read the binary file and a <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter&gt;</ph> class to translate the file.","pos":[5579,5760],"source":" If it exists, create a <xref:System.IO.Stream> class to read the binary file and a <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> class to translate the file."},{"content":"You also need to convert from the stream type to the Loan object type.","pos":[5761,5831]},{"content":"Next you must add code to serialize the class to a file.","pos":[5833,5889]},{"content":"Add the following code after the existing code in the <ph id=\"ph1\">`Main`</ph> method:","pos":[5890,5958],"source":" Add the following code after the existing code in the `Main` method:"},{"content":"At this point, you can again build and run the application.","pos":[6065,6124]},{"content":"The first time it runs, notice that the interest rates starts at 7.5, and then changes to 7.1.","pos":[6125,6219]},{"content":"Close the application and then run it again.","pos":[6220,6264]},{"content":"Now, the application prints the message that it has read the saved file, and the interest rate is 7.1 even before the code that changes it.","pos":[6265,6404]},{"pos":[6409,6417],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6421,6451],"content":"<bpt id=\"p1\">[</bpt>Serialization (C#)<ept id=\"p1\">](index.md)</ept>","source":"[Serialization (C#)](index.md)"},{"pos":[6454,6493],"content":"<bpt id=\"p1\">[</bpt>C# Programming Guide<ept id=\"p1\">](../..//index.md)</ept>","source":"[C# Programming Guide](../..//index.md)"}]}