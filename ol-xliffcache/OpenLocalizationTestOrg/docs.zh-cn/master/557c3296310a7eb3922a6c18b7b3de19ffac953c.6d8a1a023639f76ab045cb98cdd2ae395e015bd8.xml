{"content":"---\ntitle: \"More Secure File and Data Access in Windows Forms\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"security [Windows Forms], file access\"\n  - \"registry [Windows Forms]\"\n  - \"data access [Windows Forms]\"\n  - \"database access (Windows Forms security)\"\n  - \"data [Windows Forms], secure access\"\n  - \"file access [Windows Forms]\"\n  - \"security [Windows Forms], data access\"\nms.assetid: 3cd3e55b-2f5e-40dd-835d-f50f7ce08967\n---\n# More Secure File and Data Access in Windows Forms\nThe [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] uses permissions to help protect resources and data. Where your application can read or write data depends on the permissions granted to the application. When your application runs in a partial trust environment, you might not have access to your data or you might have to change the way you access the data.  \n  \n When you encounter a security restriction, you have two options: assert the permission (assuming it has been granted to your application), or use a version of the feature written to work in partial trust. The following sections discuss how to work with file, database, and registry access from applications that are running in a partial trust environment.  \n  \n> [!NOTE]\n>  By default, tools that generate [!INCLUDE[ndptecclick](../../../includes/ndptecclick-md.md)] deployments default these deployments to requesting Full Trust from the computers on which they run. If you decide you want the added security benefits of running in partial trust, you must change this default in either Visual Studio or one of the [!INCLUDE[winsdklong](../../../includes/winsdklong-md.md)] tools (Mage.exe or MageUI.exe). For more information about Windows Forms security, and on how to determine the appropriate trust level for your application, see [Security in Windows Forms Overview](security-in-windows-forms-overview.md).  \n  \n## File Access  \n The <xref:System.Security.Permissions.FileIOPermission> class controls file and folder access in the [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)]. By default, the security system does not grant the <xref:System.Security.Permissions.FileIOPermission> to partial trust environments such as the local intranet and Internet zones. However, an application that requires file access can still function in these environments if you modify the design of your application or use different methods to access files. By default, the local intranet zone is granted the right to have same site access and same directory access, to connect back to the site of its origin, and to read from its installation directory. By default, the Internet zone, is only granted the right to connect back to the site of its origin.  \n  \n### User-Specified Files  \n One way to deal with not having file access permission is to prompt the user to provide specific file information by using the <xref:System.Windows.Forms.OpenFileDialog> or <xref:System.Windows.Forms.SaveFileDialog> class. This user interaction helps provide some assurance that the application cannot maliciously load private files or overwrite important files. The <xref:System.Windows.Forms.OpenFileDialog.OpenFile%2A> and <xref:System.Windows.Forms.SaveFileDialog.OpenFile%2A> methods provide read and write file access by opening the file stream for the file that the user specified. The methods also help protect the user's file by obscuring the file's path.  \n  \n> [!NOTE]\n>  These permissions differ depending on whether your application is in the Internet zone or Intranet zone. Internet zone applications can only use the <xref:System.Windows.Forms.OpenFileDialog>, whereas Intranet applications have unrestricted file dialog permission.  \n  \n The <xref:System.Security.Permissions.FileDialogPermission> class specifies what type of file dialog box your application can use. The following table shows the value you must have to use each <xref:System.Windows.Forms.FileDialog> class.  \n  \n|Class|Required access value|  \n|-----------|---------------------------|  \n|<xref:System.Windows.Forms.OpenFileDialog>|<xref:System.Security.Permissions.FileDialogPermissionAccess.Open>|  \n|<xref:System.Windows.Forms.SaveFileDialog>|<xref:System.Security.Permissions.FileDialogPermissionAccess.Save>|  \n  \n> [!NOTE]\n>  The specific permission is not requested until the <xref:System.Windows.Forms.OpenFileDialog.OpenFile%2A> method is actually called.  \n  \n Permission to display a file dialog box does not grant your application full access to all members of the <xref:System.Windows.Forms.FileDialog>, <xref:System.Windows.Forms.OpenFileDialog>, and <xref:System.Windows.Forms.SaveFileDialog> classes. For the exact permissions that are required to call each method, see the reference topic for that method in the [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] class library documentation.  \n  \n The following code example uses the <xref:System.Windows.Forms.OpenFileDialog.OpenFile%2A> method to open a user-specified file into a <xref:System.Windows.Forms.RichTextBox> control. The example requires <xref:System.Security.Permissions.FileDialogPermission> and the associated <xref:System.Security.Permissions.FileDialogPermissionAttribute.Open%2A> enumeration value. The example demonstrates how to handle the <xref:System.Security.SecurityException> to determine whether the save feature should be disabled. This example requires that your <xref:System.Windows.Forms.Form> has a <xref:System.Windows.Forms.Button> control named `ButtonOpen`, and a <xref:System.Windows.Forms.RichTextBox> control named `RtfBoxMain`.  \n  \n> [!NOTE]\n>  The programming logic for the save feature is not shown in the example.  \n  \n```vb  \nPrivate Sub ButtonOpen_Click(ByVal sender As System.Object, _  \n    ByVal e As System.EventArgs) Handles ButtonOpen.Click   \n  \n    Dim editingFileName as String = \"\"  \n    Dim saveAllowed As Boolean = True  \n  \n    ' Displays the OpenFileDialog.  \n    If (OpenFileDialog1.ShowDialog() = DialogResult.OK) Then  \n        Dim userStream as System.IO.Stream  \n        Try   \n            ' Opens the file stream for the file selected by the user.  \n            userStream =OpenFileDialog1.OpenFile()   \n            Me.RtfBoxMain.LoadFile(userStream, _  \n                RichTextBoxStreamType.PlainText)  \n        Finally  \n            userStream.Close()  \n        End Try  \n  \n        ' Tries to get the file name selected by the user.  \n        ' Failure means that the application does not have  \n        ' unrestricted permission to the file.  \n        Try   \n            editingFileName = OpenFileDialog1.FileName  \n        Catch ex As Exception  \n            If TypeOf ex Is System.Security.SecurityException Then   \n                ' The application does not have unrestricted permission   \n                ' to the file so the save feature will be disabled.  \n                saveAllowed = False   \n            Else   \n                Throw ex  \n            End If  \n        End Try  \n    End If  \nEnd Sub  \n```  \n  \n```csharp  \nprivate void ButtonOpen_Click(object sender, System.EventArgs e)   \n{  \n    String editingFileName = \"\";  \n    Boolean saveAllowed = true;  \n  \n    // Displays the OpenFileDialog.  \n    if (openFileDialog1.ShowDialog() == DialogResult.OK)   \n    {  \n        // Opens the file stream for the file selected by the user.  \n        using (System.IO.Stream userStream = openFileDialog1.OpenFile())   \n        {  \n            this.RtfBoxMain.LoadFile(userStream,  \n                RichTextBoxStreamType.PlainText);  \n            userStream.Close();  \n        }  \n  \n        // Tries to get the file name selected by the user.  \n        // Failure means that the application does not have  \n        // unrestricted permission to the file.  \n        try   \n        {  \n            editingFileName = openFileDialog1.FileName;  \n        }   \n        catch (Exception ex)   \n        {  \n            if (ex is System.Security.SecurityException)   \n            {  \n                // The application does not have unrestricted permission   \n                // to the file so the save feature will be disabled.  \n                saveAllowed = false;   \n            }   \n            else   \n            {  \n                throw ex;  \n            }  \n        }  \n    }  \n}  \n```  \n  \n> [!NOTE]\n>  In Visual C#, ensure that you add code to enable the event handler. By using the code from the previous example, the following code shows how to enable the event handler.`this.ButtonOpen.Click += newSystem.Windows.Forms.EventHandler(this.ButtonOpen_Click);`  \n  \n### Other Files  \n Sometimes you will need to read or write to files that the user does not specify, such as when you must persist application settings. In the local intranet and Internet zones, your application will not have permission to store data in a local file. However, your application will be able to store data in isolated storage. Isolated storage is an abstract data compartment (not a specific storage location) that contains one or more isolated storage files, called stores, that contain the actual directory locations where data is stored. File access permissions like <xref:System.Security.Permissions.FileIOPermission> are not required; instead, the <xref:System.Security.Permissions.IsolatedStoragePermission> class controls the permissions for isolated storage. By default, applications that are running in the local intranet and Internet zones can store data using isolated storage; however, settings like disk quota can vary. For more information about isolated storage, see [Isolated Storage](../../standard/io/isolated-storage.md).  \n  \n The following example uses isolated storage to write data to a file located in a store. The example requires <xref:System.Security.Permissions.IsolatedStorageFilePermission> and the <xref:System.Security.Permissions.IsolatedStorageContainment.DomainIsolationByUser> enumeration value. The example demonstrates reading and writing certain property values of the <xref:System.Windows.Forms.Button> control to a file in isolated storage. The `Read` function would be called after the application starts and the `Write` function would be called before the application ends. The example requires that the `Read` and `Write` functions exist as members of a <xref:System.Windows.Forms.Form> that contains a <xref:System.Windows.Forms.Button> control named `MainButton`.  \n  \n```vb  \n' Reads the button options from the isolated storage. Uses Default values   \n' for the button if the options file does not exist.  \nPublic Sub Read()   \n    Dim isoStore As System.IO.IsolatedStorage.IsolatedStorageFile = _  \n        System.IO.IsolatedStorage.IsolatedStorageFile. _   \n        GetUserStoreForDomain()  \n  \n    Dim filename As String = \"options.txt\"  \n    Try  \n        ' Checks to see if the options.txt file exists.  \n        If (isoStore.GetFileNames(filename).GetLength(0) <> 0) Then  \n  \n            ' Opens the file because it exists.  \n            Dim isos As New System.IO.IsolatedStorage.IsolatedStorageFileStream _   \n                 (filename, IO.FileMode.Open,isoStore)  \n            Dim reader as System.IO.StreamReader  \n            Try   \n                reader = new System.IO.StreamReader(isos)  \n  \n                ' Reads the values stored.  \n                Dim converter As System.ComponentModel.TypeConverter  \n                converter = System.ComponentModel.TypeDescriptor.GetConverter _   \n                    (GetType(Color))  \n  \n                Me.MainButton.BackColor = _   \n                        CType(converter.ConvertFromString _   \n                         (reader.ReadLine()), Color)  \n                me.MainButton.ForeColor = _  \n                        CType(converter.ConvertFromString _   \n                         (reader.ReadLine()), Color)  \n  \n                converter = System.ComponentModel.TypeDescriptor.GetConverter _   \n                    (GetType(Font))  \n                me.MainButton.Font = _  \n                        CType(converter.ConvertFromString _   \n                         (reader.ReadLine()), Font)  \n  \n            Catch ex As Exception  \n                Debug.WriteLine(\"Cannot read options \" + _  \n                    ex.ToString())  \n            Finally  \n                reader.Close()  \n            End Try  \n        End If  \n  \n    Catch ex As Exception  \n        Debug.WriteLine(\"Cannot read options \" + ex.ToString())  \n    End Try  \nEnd Sub  \n  \n' Writes the button options to the isolated storage.  \nPublic Sub Write()   \n    Dim isoStore As System.IO.IsolatedStorage.IsolatedStorageFile = _  \n        System.IO.IsolatedStorage.IsolatedStorageFile. _   \n        GetUserStoreForDomain()  \n  \n    Dim filename As String = \"options.txt\"  \n    Try   \n        ' Checks if the file exists, and if it does, tries to delete it.  \n        If (isoStore.GetFileNames(filename).GetLength(0) <> 0) Then  \n            isoStore.DeleteFile(filename)  \n        End If  \n    Catch ex As Exception  \n        Debug.WriteLine(\"Cannot delete file \" + ex.ToString())  \n    End Try  \n  \n    ' Creates the options.txt file and writes the button options to it.  \n    Dim writer as System.IO.StreamWriter  \n    Try   \n        Dim isos As New System.IO.IsolatedStorage.IsolatedStorageFileStream _   \n             (filename, IO.FileMode.CreateNew, isoStore)  \n  \n        writer = New System.IO.StreamWriter(isos)  \n        Dim converter As System.ComponentModel.TypeConverter  \n  \n        converter = System.ComponentModel.TypeDescriptor.GetConverter _   \n           (GetType(Color))  \n        writer.WriteLine(converter.ConvertToString( _  \n            Me.MainButton.BackColor))  \n        writer.WriteLine(converter.ConvertToString( _  \n            Me.MainButton.ForeColor))  \n  \n        converter = System.ComponentModel TypeDescriptor.GetConverter _   \n           (GetType(Font))  \n        writer.WriteLine(converter.ConvertToString( _  \n            Me.MainButton.Font))  \n  \n    Catch ex as Exception  \n        Debug.WriteLine(\"Cannot write options \" + ex.ToString())  \n  \n    Finally  \n        writer.Close()  \n    End Try  \nEnd Sub  \n```  \n  \n```csharp  \n// Reads the button options from the isolated storage. Uses default values   \n// for the button if the options file does not exist.  \npublic void Read()   \n{  \n    System.IO.IsolatedStorage.IsolatedStorageFile isoStore =   \n        System.IO.IsolatedStorage.IsolatedStorageFile.  \n        GetUserStoreForDomain();  \n  \n    string filename = \"options.txt\";  \n    try  \n    {  \n        // Checks to see if the options.txt file exists.  \n        if (isoStore.GetFileNames(filename).GetLength(0) != 0)   \n        {  \n            // Opens the file because it exists.  \n            System.IO.IsolatedStorage.IsolatedStorageFileStream isos =   \n                new System.IO.IsolatedStorage.IsolatedStorageFileStream  \n                    (filename, System.IO.FileMode.Open,isoStore);  \n            System.IO.StreamReader reader = null;  \n            try   \n            {  \n                reader = new System.IO.StreamReader(isos);  \n  \n                // Reads the values stored.  \n                TypeConverter converter ;  \n                converter = TypeDescriptor.GetConverter(typeof(Color));  \n  \n                this.MainButton.BackColor =   \n                 (Color)(converter.ConvertFromString(reader.ReadLine()));  \n                this.MainButton.ForeColor =   \n                 (Color)(converter.ConvertFromString(reader.ReadLine()));  \n  \n                converter = TypeDescriptor.GetConverter(typeof(Font));  \n                this.MainButton.Font =   \n                  (Font)(converter.ConvertFromString(reader.ReadLine()));  \n            }  \n            catch (Exception ex)  \n            {   \n                System.Diagnostics.Debug.WriteLine  \n                     (\"Cannot read options \" + ex.ToString());  \n            }  \n            finally  \n            {  \n                reader.Close();  \n            }  \n        }  \n    }   \n    catch (Exception ex)   \n    {  \n        System.Diagnostics.Debug.WriteLine  \n            (\"Cannot read options \" + ex.ToString());  \n    }  \n}  \n  \n// Writes the button options to the isolated storage.  \npublic void Write()   \n{  \n    System.IO.IsolatedStorage.IsolatedStorageFile isoStore =   \n        System.IO.IsolatedStorage.IsolatedStorageFile.  \n        GetUserStoreForDomain();  \n  \n    string filename = \"options.txt\";  \n    try   \n    {  \n        // Checks if the file exists and, if it does, tries to delete it.  \n        if (isoStore.GetFileNames(filename).GetLength(0) != 0)   \n        {  \n            isoStore.DeleteFile(filename);  \n        }  \n    }  \n    catch (Exception ex)   \n    {  \n        System.Diagnostics.Debug.WriteLine  \n            (\"Cannot delete file \" + ex.ToString());  \n    }  \n  \n    // Creates the options file and writes the button options to it.  \n    System.IO.StreamWriter writer = null;  \n    try   \n    {  \n        System.IO.IsolatedStorage.IsolatedStorageFileStream isos = new   \n            System.IO.IsolatedStorage.IsolatedStorageFileStream(filename,   \n            System.IO.FileMode.CreateNew,isoStore);  \n  \n        writer = new System.IO.StreamWriter(isos);  \n        TypeConverter converter ;  \n  \n        converter = TypeDescriptor.GetConverter(typeof(Color));  \n        writer.WriteLine(converter.ConvertToString(  \n            this.MainButton.BackColor));  \n        writer.WriteLine(converter.ConvertToString(  \n            this.MainButton.ForeColor));  \n  \n        converter = TypeDescriptor.GetConverter(typeof(Font));  \n        writer.WriteLine(converter.ConvertToString(  \n            this.MainButton.Font));  \n  \n    }  \n    catch (Exception ex)  \n    {   \n        System.Diagnostics.Debug.WriteLine  \n           (\"Cannot write options \" + ex.ToString());  \n    }  \n    finally  \n    {  \n        writer.Close();  \n    }  \n}  \n```  \n  \n## Database Access  \n The permissions required to access a database vary based on the database provider; however, only applications that are running with the appropriate permissions can access a database through a data connection. For more information about the permissions that are required to access a database, see [Code Access Security and ADO.NET](../data/adonet/code-access-security.md).  \n  \n If you cannot directly access a database because you want your application to run in partial trust, you can use a Web service as an alternative means to access your data. A Web service is a piece of software that can be programmatically accessed over a network. With Web services, applications can share data across code group zones. By default, applications in the local intranet and Internet zones are granted the right to access their sites of origin, which enables them to call a Web service hosted on the same server. For more information see [Web Services in ASP.NET AJAX](https://docs.microsoft.com/previous-versions/aspnet/bb398785(v=vs.100)) or [Windows Communication Foundation](../wcf/index.md).  \n  \n## Registry Access  \n The <xref:System.Security.Permissions.RegistryPermission> class controls access to the operating system registry. By default, only applications that are running locally can access the registry.  <xref:System.Security.Permissions.RegistryPermission> only grants an application the right to try registry access; it does not guarantee access will succeed, because the operating system still enforces security on the registry.  \n  \n Because you cannot access the registry under partial trust, you may need to find other methods of storing your data. When you store application settings, use isolated storage instead of the registry. Isolated storage can also be used to store other application-specific files. You can also store global application information about the server or site of origin, because by default an application is granted the right to access the site of its origin.  \n  \n## See also\n\n- [More Secure Printing in Windows Forms](more-secure-printing-in-windows-forms.md)\n- [Additional Security Considerations in Windows Forms](additional-security-considerations-in-windows-forms.md)\n- [Security in Windows Forms Overview](security-in-windows-forms-overview.md)\n- [Windows Forms Security](windows-forms-security.md)\n- [Mage.exe (Manifest Generation and Editing Tool)](../tools/mage-exe-manifest-generation-and-editing-tool.md)\n- [MageUI.exe (Manifest Generation and Editing Tool, Graphical Client)](../tools/mageui-exe-manifest-generation-and-editing-tool-graphical-client.md)\n","nodes":[{"pos":[4,465],"embed":true,"restype":"x-metadata","content":"title: \"More Secure File and Data Access in Windows Forms\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"security [Windows Forms], file access\"\n  - \"registry [Windows Forms]\"\n  - \"data access [Windows Forms]\"\n  - \"database access (Windows Forms security)\"\n  - \"data [Windows Forms], secure access\"\n  - \"file access [Windows Forms]\"\n  - \"security [Windows Forms], data access\"\nms.assetid: 3cd3e55b-2f5e-40dd-835d-f50f7ce08967","nodes":[{"content":"More Secure File and Data Access in Windows Forms","nodes":[{"pos":[0,49],"content":"More Secure File and Data Access in Windows Forms","nodes":[{"content":"More Secure File and Data Access in Windows Forms","pos":[0,49]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[472,521],"content":"More Secure File and Data Access in Windows Forms","linkify":"More Secure File and Data Access in Windows Forms","nodes":[{"content":"More Secure File and Data Access in Windows Forms","pos":[0,49]}]},{"content":"The <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)]</ph> uses permissions to help protect resources and data.","pos":[522,639],"source":"The [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] uses permissions to help protect resources and data."},{"content":"Where your application can read or write data depends on the permissions granted to the application.","pos":[640,740]},{"content":"When your application runs in a partial trust environment, you might not have access to your data or you might have to change the way you access the data.","pos":[741,895]},{"content":"When you encounter a security restriction, you have two options: assert the permission (assuming it has been granted to your application), or use a version of the feature written to work in partial trust.","pos":[902,1106]},{"content":"The following sections discuss how to work with file, database, and registry access from applications that are running in a partial trust environment.","pos":[1107,1257]},{"pos":[1265,1913],"content":"[!NOTE]\n By default, tools that generate [!INCLUDE[ndptecclick](../../../includes/ndptecclick-md.md)] deployments default these deployments to requesting Full Trust from the computers on which they run. If you decide you want the added security benefits of running in partial trust, you must change this default in either Visual Studio or one of the [!INCLUDE[winsdklong](../../../includes/winsdklong-md.md)] tools (Mage.exe or MageUI.exe). For more information about Windows Forms security, and on how to determine the appropriate trust level for your application, see [Security in Windows Forms Overview](security-in-windows-forms-overview.md).","leadings":["","> "],"nodes":[{"content":"By default, tools that generate [!INCLUDE[ndptecclick](../../../includes/ndptecclick-md.md)] deployments default these deployments to requesting Full Trust from the computers on which they run. If you decide you want the added security benefits of running in partial trust, you must change this default in either Visual Studio or one of the [!INCLUDE[winsdklong](../../../includes/winsdklong-md.md)] tools (Mage.exe or MageUI.exe). For more information about Windows Forms security, and on how to determine the appropriate trust level for your application, see [Security in Windows Forms Overview](security-in-windows-forms-overview.md).","pos":[9,646],"nodes":[{"content":"By default, tools that generate <ph id=\"ph1\">[!INCLUDE[ndptecclick](../../../includes/ndptecclick-md.md)]</ph> deployments default these deployments to requesting Full Trust from the computers on which they run.","pos":[0,193],"source":"By default, tools that generate [!INCLUDE[ndptecclick](../../../includes/ndptecclick-md.md)] deployments default these deployments to requesting Full Trust from the computers on which they run."},{"content":"If you decide you want the added security benefits of running in partial trust, you must change this default in either Visual Studio or one of the <ph id=\"ph1\">[!INCLUDE[winsdklong](../../../includes/winsdklong-md.md)]</ph> tools (Mage.exe or MageUI.exe).","pos":[194,431],"source":" If you decide you want the added security benefits of running in partial trust, you must change this default in either Visual Studio or one of the [!INCLUDE[winsdklong](../../../includes/winsdklong-md.md)] tools (Mage.exe or MageUI.exe)."},{"content":"For more information about Windows Forms security, and on how to determine the appropriate trust level for your application, see <bpt id=\"p1\">[</bpt>Security in Windows Forms Overview<ept id=\"p1\">](security-in-windows-forms-overview.md)</ept>.","pos":[432,637],"source":" For more information about Windows Forms security, and on how to determine the appropriate trust level for your application, see [Security in Windows Forms Overview](security-in-windows-forms-overview.md)."}]}]},{"pos":[1922,1933],"content":"File Access","linkify":"File Access","nodes":[{"content":"File Access","pos":[0,11]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Security.Permissions.FileIOPermission&gt;</ph> class controls file and folder access in the <ph id=\"ph2\">[!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)]</ph>.","pos":[1937,2099],"source":"The <xref:System.Security.Permissions.FileIOPermission> class controls file and folder access in the [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)]."},{"content":"By default, the security system does not grant the <ph id=\"ph1\">&lt;xref:System.Security.Permissions.FileIOPermission&gt;</ph> to partial trust environments such as the local intranet and Internet zones.","pos":[2100,2279],"source":" By default, the security system does not grant the <xref:System.Security.Permissions.FileIOPermission> to partial trust environments such as the local intranet and Internet zones."},{"content":"However, an application that requires file access can still function in these environments if you modify the design of your application or use different methods to access files.","pos":[2280,2457]},{"content":"By default, the local intranet zone is granted the right to have same site access and same directory access, to connect back to the site of its origin, and to read from its installation directory.","pos":[2458,2654]},{"content":"By default, the Internet zone, is only granted the right to connect back to the site of its origin.","pos":[2655,2754]},{"pos":[2764,2784],"content":"User-Specified Files","linkify":"User-Specified Files","nodes":[{"content":"User-Specified Files","pos":[0,20]}]},{"content":"One way to deal with not having file access permission is to prompt the user to provide specific file information by using the <ph id=\"ph1\">&lt;xref:System.Windows.Forms.OpenFileDialog&gt;</ph> or <ph id=\"ph2\">&lt;xref:System.Windows.Forms.SaveFileDialog&gt;</ph> class.","pos":[2788,3010],"source":"One way to deal with not having file access permission is to prompt the user to provide specific file information by using the <xref:System.Windows.Forms.OpenFileDialog> or <xref:System.Windows.Forms.SaveFileDialog> class."},{"content":"This user interaction helps provide some assurance that the application cannot maliciously load private files or overwrite important files.","pos":[3011,3150]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Windows.Forms.OpenFileDialog.OpenFile%2A&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Windows.Forms.SaveFileDialog.OpenFile%2A&gt;</ph> methods provide read and write file access by opening the file stream for the file that the user specified.","pos":[3151,3376],"source":" The <xref:System.Windows.Forms.OpenFileDialog.OpenFile%2A> and <xref:System.Windows.Forms.SaveFileDialog.OpenFile%2A> methods provide read and write file access by opening the file stream for the file that the user specified."},{"content":"The methods also help protect the user's file by obscuring the file's path.","pos":[3377,3452]},{"pos":[3460,3735],"content":"[!NOTE]\n These permissions differ depending on whether your application is in the Internet zone or Intranet zone. Internet zone applications can only use the <xref:System.Windows.Forms.OpenFileDialog>, whereas Intranet applications have unrestricted file dialog permission.","leadings":["","> "],"nodes":[{"content":"These permissions differ depending on whether your application is in the Internet zone or Intranet zone. Internet zone applications can only use the <xref:System.Windows.Forms.OpenFileDialog>, whereas Intranet applications have unrestricted file dialog permission.","pos":[9,273],"nodes":[{"content":"These permissions differ depending on whether your application is in the Internet zone or Intranet zone.","pos":[0,104]},{"content":"Internet zone applications can only use the <ph id=\"ph1\">&lt;xref:System.Windows.Forms.OpenFileDialog&gt;</ph>, whereas Intranet applications have unrestricted file dialog permission.","pos":[105,264],"source":" Internet zone applications can only use the <xref:System.Windows.Forms.OpenFileDialog>, whereas Intranet applications have unrestricted file dialog permission."}]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Security.Permissions.FileDialogPermission&gt;</ph> class specifies what type of file dialog box your application can use.","pos":[3742,3872],"source":"The <xref:System.Security.Permissions.FileDialogPermission> class specifies what type of file dialog box your application can use."},{"content":"The following table shows the value you must have to use each <ph id=\"ph1\">&lt;xref:System.Windows.Forms.FileDialog&gt;</ph> class.","pos":[3873,3980],"source":" The following table shows the value you must have to use each <xref:System.Windows.Forms.FileDialog> class."},{"content":"Class","pos":[3987,3992]},{"content":"Required access value","pos":[3993,4014]},{"pos":[4295,4438],"content":"[!NOTE]\n The specific permission is not requested until the <xref:System.Windows.Forms.OpenFileDialog.OpenFile%2A> method is actually called.","leadings":["","> "],"nodes":[{"content":"The specific permission is not requested until the <ph id=\"ph1\">&lt;xref:System.Windows.Forms.OpenFileDialog.OpenFile%2A&gt;</ph> method is actually called.","pos":[9,141],"source":"The specific permission is not requested until the <xref:System.Windows.Forms.OpenFileDialog.OpenFile%2A> method is actually called."}]},{"content":"Permission to display a file dialog box does not grant your application full access to all members of the <ph id=\"ph1\">&lt;xref:System.Windows.Forms.FileDialog&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.Windows.Forms.OpenFileDialog&gt;</ph>, and <ph id=\"ph3\">&lt;xref:System.Windows.Forms.SaveFileDialog&gt;</ph> classes.","pos":[4445,4690],"source":"Permission to display a file dialog box does not grant your application full access to all members of the <xref:System.Windows.Forms.FileDialog>, <xref:System.Windows.Forms.OpenFileDialog>, and <xref:System.Windows.Forms.SaveFileDialog> classes."},{"content":"For the exact permissions that are required to call each method, see the reference topic for that method in the <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)]</ph> class library documentation.","pos":[4691,4892],"source":" For the exact permissions that are required to call each method, see the reference topic for that method in the [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] class library documentation."},{"content":"The following code example uses the <ph id=\"ph1\">&lt;xref:System.Windows.Forms.OpenFileDialog.OpenFile%2A&gt;</ph> method to open a user-specified file into a <ph id=\"ph2\">&lt;xref:System.Windows.Forms.RichTextBox&gt;</ph> control.","pos":[4899,5082],"source":"The following code example uses the <xref:System.Windows.Forms.OpenFileDialog.OpenFile%2A> method to open a user-specified file into a <xref:System.Windows.Forms.RichTextBox> control."},{"content":"The example requires <ph id=\"ph1\">&lt;xref:System.Security.Permissions.FileDialogPermission&gt;</ph> and the associated <ph id=\"ph2\">&lt;xref:System.Security.Permissions.FileDialogPermissionAttribute.Open%2A&gt;</ph> enumeration value.","pos":[5083,5270],"source":" The example requires <xref:System.Security.Permissions.FileDialogPermission> and the associated <xref:System.Security.Permissions.FileDialogPermissionAttribute.Open%2A> enumeration value."},{"content":"The example demonstrates how to handle the <ph id=\"ph1\">&lt;xref:System.Security.SecurityException&gt;</ph> to determine whether the save feature should be disabled.","pos":[5271,5412],"source":" The example demonstrates how to handle the <xref:System.Security.SecurityException> to determine whether the save feature should be disabled."},{"content":"This example requires that your <ph id=\"ph1\">&lt;xref:System.Windows.Forms.Form&gt;</ph> has a <ph id=\"ph2\">&lt;xref:System.Windows.Forms.Button&gt;</ph> control named <ph id=\"ph3\">`ButtonOpen`</ph>, and a <ph id=\"ph4\">&lt;xref:System.Windows.Forms.RichTextBox&gt;</ph> control named <ph id=\"ph5\">`RtfBoxMain`</ph>.","pos":[5413,5620],"source":" This example requires that your <xref:System.Windows.Forms.Form> has a <xref:System.Windows.Forms.Button> control named `ButtonOpen`, and a <xref:System.Windows.Forms.RichTextBox> control named `RtfBoxMain`."},{"pos":[5628,5710],"content":"[!NOTE]\n The programming logic for the save feature is not shown in the example.","leadings":["","> "],"nodes":[{"content":"The programming logic for the save feature is not shown in the example.","pos":[9,80]}]},{"pos":[8327,8595],"content":"[!NOTE]\n In Visual C#, ensure that you add code to enable the event handler. By using the code from the previous example, the following code shows how to enable the event handler.`this.ButtonOpen.Click += newSystem.Windows.Forms.EventHandler(this.ButtonOpen_Click);`","leadings":["","> "],"nodes":[{"content":"In Visual C#, ensure that you add code to enable the event handler. By using the code from the previous example, the following code shows how to enable the event handler.`this.ButtonOpen.Click += newSystem.Windows.Forms.EventHandler(this.ButtonOpen_Click);`","pos":[9,266],"nodes":[{"content":"In Visual C#, ensure that you add code to enable the event handler.","pos":[0,67]},{"content":"By using the code from the previous example, the following code shows how to enable the event handler.<ph id=\"ph1\">`this.ButtonOpen.Click += newSystem.Windows.Forms.EventHandler(this.ButtonOpen_Click);`</ph>","pos":[68,257],"source":" By using the code from the previous example, the following code shows how to enable the event handler.`this.ButtonOpen.Click += newSystem.Windows.Forms.EventHandler(this.ButtonOpen_Click);`"}]}]},{"pos":[8605,8616],"content":"Other Files","linkify":"Other Files","nodes":[{"content":"Other Files","pos":[0,11]}]},{"content":"Sometimes you will need to read or write to files that the user does not specify, such as when you must persist application settings.","pos":[8620,8753]},{"content":"In the local intranet and Internet zones, your application will not have permission to store data in a local file.","pos":[8754,8868]},{"content":"However, your application will be able to store data in isolated storage.","pos":[8869,8942]},{"content":"Isolated storage is an abstract data compartment (not a specific storage location) that contains one or more isolated storage files, called stores, that contain the actual directory locations where data is stored.","pos":[8943,9156]},{"content":"File access permissions like <ph id=\"ph1\">&lt;xref:System.Security.Permissions.FileIOPermission&gt;</ph> are not required; instead, the <ph id=\"ph2\">&lt;xref:System.Security.Permissions.IsolatedStoragePermission&gt;</ph> class controls the permissions for isolated storage.","pos":[9157,9382],"source":" File access permissions like <xref:System.Security.Permissions.FileIOPermission> are not required; instead, the <xref:System.Security.Permissions.IsolatedStoragePermission> class controls the permissions for isolated storage."},{"content":"By default, applications that are running in the local intranet and Internet zones can store data using isolated storage; however, settings like disk quota can vary.","pos":[9383,9548]},{"content":"For more information about isolated storage, see <bpt id=\"p1\">[</bpt>Isolated Storage<ept id=\"p1\">](../../standard/io/isolated-storage.md)</ept>.","pos":[9549,9656],"source":" For more information about isolated storage, see [Isolated Storage](../../standard/io/isolated-storage.md)."},{"content":"The following example uses isolated storage to write data to a file located in a store.","pos":[9663,9750]},{"content":"The example requires <ph id=\"ph1\">&lt;xref:System.Security.Permissions.IsolatedStorageFilePermission&gt;</ph> and the <ph id=\"ph2\">&lt;xref:System.Security.Permissions.IsolatedStorageContainment.DomainIsolationByUser&gt;</ph> enumeration value.","pos":[9751,9947],"source":" The example requires <xref:System.Security.Permissions.IsolatedStorageFilePermission> and the <xref:System.Security.Permissions.IsolatedStorageContainment.DomainIsolationByUser> enumeration value."},{"content":"The example demonstrates reading and writing certain property values of the <ph id=\"ph1\">&lt;xref:System.Windows.Forms.Button&gt;</ph> control to a file in isolated storage.","pos":[9948,10097],"source":" The example demonstrates reading and writing certain property values of the <xref:System.Windows.Forms.Button> control to a file in isolated storage."},{"content":"The <ph id=\"ph1\">`Read`</ph> function would be called after the application starts and the <ph id=\"ph2\">`Write`</ph> function would be called before the application ends.","pos":[10098,10232],"source":" The `Read` function would be called after the application starts and the `Write` function would be called before the application ends."},{"content":"The example requires that the <ph id=\"ph1\">`Read`</ph> and <ph id=\"ph2\">`Write`</ph> functions exist as members of a <ph id=\"ph3\">&lt;xref:System.Windows.Forms.Form&gt;</ph> that contains a <ph id=\"ph4\">&lt;xref:System.Windows.Forms.Button&gt;</ph> control named <ph id=\"ph5\">`MainButton`</ph>.","pos":[10233,10425],"source":" The example requires that the `Read` and `Write` functions exist as members of a <xref:System.Windows.Forms.Form> that contains a <xref:System.Windows.Forms.Button> control named `MainButton`."},{"pos":[17915,17930],"content":"Database Access","linkify":"Database Access","nodes":[{"content":"Database Access","pos":[0,15]}]},{"content":"The permissions required to access a database vary based on the database provider; however, only applications that are running with the appropriate permissions can access a database through a data connection.","pos":[17934,18142]},{"content":"For more information about the permissions that are required to access a database, see <bpt id=\"p1\">[</bpt>Code Access Security and ADO.NET<ept id=\"p1\">](../data/adonet/code-access-security.md)</ept>.","pos":[18143,18305],"source":" For more information about the permissions that are required to access a database, see [Code Access Security and ADO.NET](../data/adonet/code-access-security.md)."},{"content":"If you cannot directly access a database because you want your application to run in partial trust, you can use a Web service as an alternative means to access your data.","pos":[18312,18482]},{"content":"A Web service is a piece of software that can be programmatically accessed over a network.","pos":[18483,18573]},{"content":"With Web services, applications can share data across code group zones.","pos":[18574,18645]},{"content":"By default, applications in the local intranet and Internet zones are granted the right to access their sites of origin, which enables them to call a Web service hosted on the same server.","pos":[18646,18834]},{"content":"For more information see <bpt id=\"p1\">[</bpt>Web Services in ASP.NET AJAX<ept id=\"p1\">](https://docs.microsoft.com/previous-versions/aspnet/bb398785(v=vs.100))</ept> or <bpt id=\"p2\">[</bpt>Windows Communication Foundation<ept id=\"p2\">](../wcf/index.md)</ept>.","pos":[18835,19018],"source":" For more information see [Web Services in ASP.NET AJAX](https://docs.microsoft.com/previous-versions/aspnet/bb398785(v=vs.100)) or [Windows Communication Foundation](../wcf/index.md)."},{"pos":[19027,19042],"content":"Registry Access","linkify":"Registry Access","nodes":[{"content":"Registry Access","pos":[0,15]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Security.Permissions.RegistryPermission&gt;</ph> class controls access to the operating system registry.","pos":[19046,19159],"source":"The <xref:System.Security.Permissions.RegistryPermission> class controls access to the operating system registry."},{"content":"By default, only applications that are running locally can access the registry.","pos":[19160,19239]},{"content":"<ph id=\"ph1\">&lt;xref:System.Security.Permissions.RegistryPermission&gt;</ph> only grants an application the right to try registry access; it does not guarantee access will succeed, because the operating system still enforces security on the registry.","pos":[19241,19468],"source":"<xref:System.Security.Permissions.RegistryPermission> only grants an application the right to try registry access; it does not guarantee access will succeed, because the operating system still enforces security on the registry."},{"content":"Because you cannot access the registry under partial trust, you may need to find other methods of storing your data.","pos":[19475,19591]},{"content":"When you store application settings, use isolated storage instead of the registry.","pos":[19592,19674]},{"content":"Isolated storage can also be used to store other application-specific files.","pos":[19675,19751]},{"content":"You can also store global application information about the server or site of origin, because by default an application is granted the right to access the site of its origin.","pos":[19752,19926]},{"pos":[19935,19943],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[19947,20028],"content":"<bpt id=\"p1\">[</bpt>More Secure Printing in Windows Forms<ept id=\"p1\">](more-secure-printing-in-windows-forms.md)</ept>","source":"[More Secure Printing in Windows Forms](more-secure-printing-in-windows-forms.md)"},{"pos":[20031,20140],"content":"<bpt id=\"p1\">[</bpt>Additional Security Considerations in Windows Forms<ept id=\"p1\">](additional-security-considerations-in-windows-forms.md)</ept>","source":"[Additional Security Considerations in Windows Forms](additional-security-considerations-in-windows-forms.md)"},{"pos":[20143,20218],"content":"<bpt id=\"p1\">[</bpt>Security in Windows Forms Overview<ept id=\"p1\">](security-in-windows-forms-overview.md)</ept>","source":"[Security in Windows Forms Overview](security-in-windows-forms-overview.md)"},{"pos":[20221,20272],"content":"<bpt id=\"p1\">[</bpt>Windows Forms Security<ept id=\"p1\">](windows-forms-security.md)</ept>","source":"[Windows Forms Security](windows-forms-security.md)"},{"pos":[20275,20383],"content":"<bpt id=\"p1\">[</bpt>Mage.exe (Manifest Generation and Editing Tool)<ept id=\"p1\">](../tools/mage-exe-manifest-generation-and-editing-tool.md)</ept>","source":"[Mage.exe (Manifest Generation and Editing Tool)](../tools/mage-exe-manifest-generation-and-editing-tool.md)"},{"pos":[20386,20533],"content":"<bpt id=\"p1\">[</bpt>MageUI.exe (Manifest Generation and Editing Tool, Graphical Client)<ept id=\"p1\">](../tools/mageui-exe-manifest-generation-and-editing-tool-graphical-client.md)</ept>","source":"[MageUI.exe (Manifest Generation and Editing Tool, Graphical Client)](../tools/mageui-exe-manifest-generation-and-editing-tool-graphical-client.md)"}]}