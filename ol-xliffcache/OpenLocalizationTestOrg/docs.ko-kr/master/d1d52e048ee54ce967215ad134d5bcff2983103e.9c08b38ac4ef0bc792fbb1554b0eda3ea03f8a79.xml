{"content":"---\ntitle: \"Table-Valued Parameters\"\nms.date: \"10/12/2018\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 370c16d5-db7b-43e3-945b-ccaab35b739b\n---\n# Table-Valued Parameters\nTable-valued parameters provide an easy way to marshal multiple rows of data from a client application to SQL Server without requiring multiple round trips or special server-side logic for processing the data. You can use table-valued parameters to encapsulate rows of data in a client application and send the data to the server in a single parameterized command. The incoming data rows are stored in a table variable that can then be operated on by using [!INCLUDE[tsql](../../../../../includes/tsql-md.md)].  \n  \n Column values in table-valued parameters can be accessed using standard [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] SELECT statements. Table-valued parameters are strongly typed and their structure is automatically validated. The size of table-valued parameters is limited only by server memory.  \n  \n> [!NOTE]\n>  You cannot return data in a table-valued parameter. Table-valued parameters are input-only; the OUTPUT keyword is not supported.  \n  \n For more information about table-valued parameters, see the following resources.  \n  \n|Resource|Description|  \n|--------------|-----------------|  \n|[Table-Valued Parameters (Database Engine)](https://go.microsoft.com/fwlink/?LinkId=98363) in SQL Server Books Online|Describes how to create and use table-valued parameters.|  \n|[User-Defined Table Types](https://go.microsoft.com/fwlink/?LinkId=98364) in SQL Server Books Online|Describes user-defined table types that are used to declare table-valued parameters.|  \n  \n## Passing Multiple Rows in Previous Versions of SQL Server  \n Before table-valued parameters were introduced to SQL Server 2008, the options for passing multiple rows of data to a stored procedure or a parameterized SQL command were limited. A developer could choose from the following options for passing multiple rows to the server:  \n  \n-   Use a series of individual parameters to represent the values in multiple columns and rows of data. The amount of data that can be passed by using this method is limited by the number of parameters allowed. SQL Server procedures can have, at most, 2100 parameters. Server-side logic is required to assemble these individual values into a table variable or a temporary table for processing.  \n  \n-   Bundle multiple data values into delimited strings or XML documents and then pass those text values to a procedure or statement. This requires the procedure or statement to include the logic necessary for validating the data structures and unbundling the values.  \n  \n-   Create a series of individual SQL statements for data modifications that affect multiple rows, such as those created by calling the `Update` method of a <xref:System.Data.SqlClient.SqlDataAdapter>. Changes can be submitted to the server individually or batched into groups. However, even when submitted in batches that contain multiple statements, each statement is executed separately on the server.  \n  \n-   Use the `bcp` utility program or the <xref:System.Data.SqlClient.SqlBulkCopy> object to load many rows of data into a table. Although this technique is very efficient, it does not support server-side processing unless the data is loaded into a temporary table or table variable.  \n  \n## Creating Table-Valued Parameter Types  \n Table-valued parameters are based on strongly-typed table structures that are defined by using [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] CREATE TYPE statements. You have to create a table type and define the structure in SQL Server before you can use table-valued parameters in your client applications. For more information about creating table types, see [User-Defined Table Types](https://go.microsoft.com/fwlink/?LinkID=98364) in SQL Server Books Online.  \n  \n The following statement creates a table type named CategoryTableType that consists of CategoryID and CategoryName columns:  \n  \n```  \nCREATE TYPE dbo.CategoryTableType AS TABLE  \n    ( CategoryID int, CategoryName nvarchar(50) )  \n```  \n  \n After you create a table type, you can declare table-valued parameters based on that type. The following [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] fragment demonstrates how to declare a table-valued parameter in a stored procedure definition. Note that the READONLY keyword is required for declaring a table-valued parameter.  \n  \n```  \nCREATE PROCEDURE usp_UpdateCategories   \n    (@tvpNewCategories dbo.CategoryTableType READONLY)  \n```  \n  \n## Modifying Data with Table-Valued Parameters (Transact-SQL)  \n Table-valued parameters can be used in set-based data modifications that affect multiple rows by executing a single statement. For example, you can select all the rows in a table-valued parameter and insert them into a database table, or you can create an update statement by joining a table-valued parameter to the table you want to update.  \n  \n The following [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] UPDATE statement demonstrates how to use a table-valued parameter by joining it to the Categories table. When you use a table-valued parameter with a JOIN in a FROM clause, you must also alias it, as shown here, where the table-valued parameter is aliased as \"ec\":  \n  \n```  \nUPDATE dbo.Categories  \n    SET Categories.CategoryName = ec.CategoryName  \n    FROM dbo.Categories INNER JOIN @tvpEditedCategories AS ec  \n    ON dbo.Categories.CategoryID = ec.CategoryID;  \n```  \n  \n This [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] example demonstrates how to select rows from a table-valued parameter to perform an INSERT in a single set-based operation.  \n  \n```  \nINSERT INTO dbo.Categories (CategoryID, CategoryName)  \n    SELECT nc.CategoryID, nc.CategoryName FROM @tvpNewCategories AS nc;  \n```  \n  \n## Limitations of Table-Valued Parameters  \n There are several limitations to table-valued parameters:  \n  \n-   You cannot pass table-valued parameters to [CLR user-defined functions](/sql/relational-databases/clr-integration-database-objects-user-defined-functions/clr-user-defined-functions).  \n  \n-   Table-valued parameters can only be indexed to support UNIQUE or PRIMARY KEY constraints. SQL Server does not maintain statistics on table-valued parameters.  \n  \n-   Table-valued parameters are read-only in [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] code. You cannot update the column values in the rows of a table-valued parameter and you cannot insert or delete rows. To modify the data that is passed to a stored procedure or parameterized statement in table-valued parameter, you must insert the data into a temporary table or into a table variable.  \n  \n-   You cannot use ALTER TABLE statements to modify the design of table-valued parameters.  \n  \n## Configuring a SqlParameter Example  \n <xref:System.Data.SqlClient> supports populating table-valued parameters from <xref:System.Data.DataTable>, <xref:System.Data.Common.DbDataReader> or <xref:System.Collections.Generic.IEnumerable%601> \\ <xref:Microsoft.SqlServer.Server.SqlDataRecord> objects. You must specify a type name for the table-valued parameter by using the <xref:System.Data.SqlClient.SqlParameter.TypeName%2A> property of a <xref:System.Data.SqlClient.SqlParameter>. The `TypeName` must match the name of a compatible type previously created on the server. The following code fragment demonstrates how to configure <xref:System.Data.SqlClient.SqlParameter> to insert data.  \n \nIn the following example, the `addedCategories` variable contains a <xref:System.Data.DataTable>. To see how the variable is populated, see the examples in the next section, [Passing a Table-Valued Parameter to a Stored Procedure](#passing).\n\n```csharp  \n// Configure the command and parameter.  \nSqlCommand insertCommand = new SqlCommand(sqlInsert, connection);  \nSqlParameter tvpParam = insertCommand.Parameters.AddWithValue(\"@tvpNewCategories\", addedCategories);  \ntvpParam.SqlDbType = SqlDbType.Structured;  \ntvpParam.TypeName = \"dbo.CategoryTableType\";  \n```  \n  \n```vb  \n' Configure the command and parameter.  \nDim insertCommand As New SqlCommand(sqlInsert, connection)  \nDim tvpParam As SqlParameter = _  \n   insertCommand.Parameters.AddWithValue( _  \n  \"@tvpNewCategories\", addedCategories)  \ntvpParam.SqlDbType = SqlDbType.Structured  \ntvpParam.TypeName = \"dbo.CategoryTableType\"  \n```  \n  \n You can also use any object derived from <xref:System.Data.Common.DbDataReader> to stream rows of data to a table-valued parameter, as shown in this fragment:  \n  \n```csharp  \n// Configure the SqlCommand and table-valued parameter.  \nSqlCommand insertCommand = new SqlCommand(\"usp_InsertCategories\", connection);  \ninsertCommand.CommandType = CommandType.StoredProcedure;  \nSqlParameter tvpParam = insertCommand.Parameters.AddWithValue(\"@tvpNewCategories\", dataReader);  \ntvpParam.SqlDbType = SqlDbType.Structured;  \n```  \n  \n```vb  \n' Configure the SqlCommand and table-valued parameter.  \nDim insertCommand As New SqlCommand(\"usp_InsertCategories\", connection)  \ninsertCommand.CommandType = CommandType.StoredProcedure  \nDim tvpParam As SqlParameter = _  \n  insertCommand.Parameters.AddWithValue(\"@tvpNewCategories\", _  \n  dataReader)  \ntvpParam.SqlDbType = SqlDbType.Structured  \n```  \n  \n## <a name=\"passing\"></a> Passing a Table-Valued Parameter to a Stored Procedure  \n This example demonstrates how to pass table-valued parameter data to a stored procedure. The code extracts added rows into a new <xref:System.Data.DataTable> by using the <xref:System.Data.DataTable.GetChanges%2A> method. The code then defines a <xref:System.Data.SqlClient.SqlCommand>, setting the <xref:System.Data.SqlClient.SqlCommand.CommandType%2A> property to <xref:System.Data.CommandType.StoredProcedure>. The <xref:System.Data.SqlClient.SqlParameter> is populated by using the <xref:System.Data.SqlClient.SqlParameterCollection.AddWithValue%2A> method and the <xref:System.Data.SqlClient.SqlParameter.SqlDbType%2A> is set to `Structured`. The <xref:System.Data.SqlClient.SqlCommand> is then executed by using the <xref:System.Data.SqlClient.SqlCommand.ExecuteNonQuery%2A> method.  \n  \n```csharp  \n// Assumes connection is an open SqlConnection object.  \nusing (connection)  \n{  \n  // Create a DataTable with the modified rows.  \n  DataTable addedCategories = CategoriesDataTable.GetChanges(DataRowState.Added);  \n\n  // Configure the SqlCommand and SqlParameter.  \n  SqlCommand insertCommand = new SqlCommand(\"usp_InsertCategories\", connection);  \n  insertCommand.CommandType = CommandType.StoredProcedure;  \n  SqlParameter tvpParam = insertCommand.Parameters.AddWithValue(\"@tvpNewCategories\", addedCategories);  \n  tvpParam.SqlDbType = SqlDbType.Structured;  \n\n  // Execute the command.  \n  insertCommand.ExecuteNonQuery();  \n}  \n```  \n  \n```vb  \n' Assumes connection is an open SqlConnection object.  \nUsing connection  \n   '  Create a DataTable with the modified rows.  \n   Dim addedCategories As DataTable = _  \n     CategoriesDataTable.GetChanges(DataRowState.Added)  \n  \n  ' Configure the SqlCommand and SqlParameter.  \n   Dim insertCommand As New SqlCommand( _  \n     \"usp_InsertCategories\", connection)  \n   insertCommand.CommandType = CommandType.StoredProcedure  \n   Dim tvpParam As SqlParameter = _  \n     insertCommand.Parameters.AddWithValue( _  \n     \"@tvpNewCategories\", addedCategories)  \n   tvpParam.SqlDbType = SqlDbType.Structured  \n  \n   '  Execute the command.  \n   insertCommand.ExecuteNonQuery()  \nEnd Using  \n```  \n  \n### Passing a Table-Valued Parameter to a Parameterized SQL Statement  \n The following example demonstrates how to insert data into the dbo.Categories table by using an INSERT statement with a SELECT subquery that has a table-valued parameter as the data source. When passing a table-valued parameter to a parameterized SQL statement, you must specify a type name for the table-valued parameter by using the new <xref:System.Data.SqlClient.SqlParameter.TypeName%2A> property of a <xref:System.Data.SqlClient.SqlParameter>. This `TypeName` must match the name of a compatible type previously created on the server. The code in this example uses the `TypeName` property to reference the type structure defined in dbo.CategoryTableType.  \n  \n> [!NOTE]\n>  If you supply a value for an identity column in a table-valued parameter, you must issue the SET IDENTITY_INSERT statement for the session.  \n  \n```csharp  \n// Assumes connection is an open SqlConnection.  \nusing (connection)  \n{  \n  // Create a DataTable with the modified rows.  \n  DataTable addedCategories = CategoriesDataTable.GetChanges(DataRowState.Added);  \n\n  // Define the INSERT-SELECT statement.  \n  string sqlInsert =   \n      \"INSERT INTO dbo.Categories (CategoryID, CategoryName)\"  \n      + \" SELECT nc.CategoryID, nc.CategoryName\"  \n      + \" FROM @tvpNewCategories AS nc;\"  \n\n  // Configure the command and parameter.  \n  SqlCommand insertCommand = new SqlCommand(sqlInsert, connection);  \n  SqlParameter tvpParam = insertCommand.Parameters.AddWithValue(\"@tvpNewCategories\", addedCategories);  \n  tvpParam.SqlDbType = SqlDbType.Structured;  \n  tvpParam.TypeName = \"dbo.CategoryTableType\";  \n\n  // Execute the command.  \n  insertCommand.ExecuteNonQuery();  \n}  \n```  \n  \n```vb  \n' Assumes connection is an open SqlConnection.  \nUsing connection  \n  ' Create a DataTable with the modified rows.  \n  Dim addedCategories As DataTable = _  \n    CategoriesDataTable.GetChanges(DataRowState.Added)  \n  \n  ' Define the INSERT-SELECT statement.  \n  Dim sqlInsert As String = _  \n  \"INSERT INTO dbo.Categories (CategoryID, CategoryName)\" _  \n  & \" SELECT nc.CategoryID, nc.CategoryName\" _  \n  & \" FROM @tvpNewCategories AS nc;\"  \n  \n  ' Configure the command and parameter.  \n  Dim insertCommand As New SqlCommand(sqlInsert, connection)  \n  Dim tvpParam As SqlParameter = _  \n     insertCommand.Parameters.AddWithValue( _  \n    \"@tvpNewCategories\", addedCategories)  \n  tvpParam.SqlDbType = SqlDbType.Structured  \n  tvpParam.TypeName = \"dbo.CategoryTableType\"  \n  \n  ' Execute the query  \n  insertCommand.ExecuteNonQuery()  \nEnd Using  \n```  \n  \n## Streaming Rows with a DataReader  \n You can also use any object derived from <xref:System.Data.Common.DbDataReader> to stream rows of data to a table-valued parameter. The following code fragment demonstrates retrieving data from an Oracle database by using an <xref:System.Data.OracleClient.OracleCommand> and an <xref:System.Data.OracleClient.OracleDataReader>. The code then configures a <xref:System.Data.SqlClient.SqlCommand> to invoke a stored procedure with a single input parameter. The <xref:System.Data.SqlClient.SqlParameter.SqlDbType%2A> property of the <xref:System.Data.SqlClient.SqlParameter> is set to `Structured`. The <xref:System.Data.SqlClient.SqlParameterCollection.AddWithValue%2A> passes the `OracleDataReader` result set to the stored procedure as a table-valued parameter.  \n  \n```csharp  \n// Assumes connection is an open SqlConnection.  \n// Retrieve data from Oracle.  \nOracleCommand selectCommand = new OracleCommand(  \n   \"Select CategoryID, CategoryName FROM Categories;\",  \n   oracleConnection);  \nOracleDataReader oracleReader = selectCommand.ExecuteReader(  \n   CommandBehavior.CloseConnection);  \n  \n // Configure the SqlCommand and table-valued parameter.  \n SqlCommand insertCommand = new SqlCommand(  \n   \"usp_InsertCategories\", connection);  \n insertCommand.CommandType = CommandType.StoredProcedure;  \n SqlParameter tvpParam =  \n    insertCommand.Parameters.AddWithValue(  \n    \"@tvpNewCategories\", oracleReader);  \n tvpParam.SqlDbType = SqlDbType.Structured;  \n  \n // Execute the command.  \n insertCommand.ExecuteNonQuery();  \n```  \n  \n```vb  \n' Assumes connection is an open SqlConnection.  \n' Retrieve data from Oracle.  \nDim selectCommand As New OracleCommand( _  \n  \"Select CategoryID, CategoryName FROM Categories;\", _  \n  oracleConnection)  \nDim oracleReader As OracleDataReader = _  \n  selectCommand.ExecuteReader(CommandBehavior.CloseConnection)  \n  \n' Configure SqlCommand and table-valued parameter.  \nDim insertCommand As New SqlCommand(\"usp_InsertCategories\", connection)  \ninsertCommand.CommandType = CommandType.StoredProcedure  \nDim tvpParam As SqlParameter = _  \n  insertCommand.Parameters.AddWithValue(\"@tvpNewCategories\", _  \n  oracleReader)  \ntvpParam.SqlDbType = SqlDbType.Structured  \n  \n' Execute the command.  \ninsertCommand.ExecuteNonQuery()  \n```  \n  \n## See also\n\n- [Configuring Parameters and Parameter Data Types](../../../../../docs/framework/data/adonet/configuring-parameters-and-parameter-data-types.md)\n- [Commands and Parameters](../../../../../docs/framework/data/adonet/commands-and-parameters.md)\n- [DataAdapter Parameters](../../../../../docs/framework/data/adonet/dataadapter-parameters.md)\n- [SQL Server Data Operations in ADO.NET](../../../../../docs/framework/data/adonet/sql/sql-server-data-operations.md)\n- [ADO.NET Managed Providers and DataSet Developer Center](https://go.microsoft.com/fwlink/?LinkId=217917)\n","nodes":[{"pos":[4,141],"embed":true,"restype":"x-metadata","content":"title: \"Table-Valued Parameters\"\nms.date: \"10/12/2018\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 370c16d5-db7b-43e3-945b-ccaab35b739b","nodes":[{"content":"Table-Valued Parameters","nodes":[{"pos":[0,23],"content":"Table-Valued Parameters","nodes":[{"content":"Table-Valued Parameters","pos":[0,23]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[148,171],"content":"Table-Valued Parameters","linkify":"Table-Valued Parameters","nodes":[{"content":"Table-Valued Parameters","pos":[0,23]}]},{"content":"Table-valued parameters provide an easy way to marshal multiple rows of data from a client application to SQL Server without requiring multiple round trips or special server-side logic for processing the data.","pos":[172,381]},{"content":"You can use table-valued parameters to encapsulate rows of data in a client application and send the data to the server in a single parameterized command.","pos":[382,536]},{"content":"The incoming data rows are stored in a table variable that can then be operated on by using <ph id=\"ph1\">[!INCLUDE[tsql](../../../../../includes/tsql-md.md)]</ph>.","pos":[537,682],"source":" The incoming data rows are stored in a table variable that can then be operated on by using [!INCLUDE[tsql](../../../../../includes/tsql-md.md)]."},{"content":"Column values in table-valued parameters can be accessed using standard <ph id=\"ph1\">[!INCLUDE[tsql](../../../../../includes/tsql-md.md)]</ph> SELECT statements.","pos":[689,832],"source":"Column values in table-valued parameters can be accessed using standard [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] SELECT statements."},{"content":"Table-valued parameters are strongly typed and their structure is automatically validated.","pos":[833,923]},{"content":"The size of table-valued parameters is limited only by server memory.","pos":[924,993]},{"pos":[1001,1140],"content":"[!NOTE]\n You cannot return data in a table-valued parameter. Table-valued parameters are input-only; the OUTPUT keyword is not supported.","leadings":["","> "],"nodes":[{"content":"You cannot return data in a table-valued parameter. Table-valued parameters are input-only; the OUTPUT keyword is not supported.","pos":[9,137],"nodes":[{"content":"You cannot return data in a table-valued parameter.","pos":[0,51]},{"content":"Table-valued parameters are input-only; the OUTPUT keyword is not supported.","pos":[52,128]}]}]},{"content":"For more information about table-valued parameters, see the following resources.","pos":[1147,1227]},{"content":"Resource","pos":[1234,1242]},{"content":"Description","pos":[1243,1254]},{"pos":[1296,1413],"content":"<bpt id=\"p1\">[</bpt>Table-Valued Parameters (Database Engine)<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=98363)</ept> in SQL Server Books Online","source":"[Table-Valued Parameters (Database Engine)](https://go.microsoft.com/fwlink/?LinkId=98363) in SQL Server Books Online"},{"content":"Describes how to create and use table-valued parameters.","pos":[1414,1470]},{"pos":[1475,1575],"content":"<bpt id=\"p1\">[</bpt>User-Defined Table Types<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=98364)</ept> in SQL Server Books Online","source":"[User-Defined Table Types](https://go.microsoft.com/fwlink/?LinkId=98364) in SQL Server Books Online"},{"content":"Describes user-defined table types that are used to declare table-valued parameters.","pos":[1576,1660]},{"pos":[1670,1726],"content":"Passing Multiple Rows in Previous Versions of SQL Server","linkify":"Passing Multiple Rows in Previous Versions of SQL Server","nodes":[{"content":"Passing Multiple Rows in Previous Versions of SQL Server","pos":[0,56]}]},{"content":"Before table-valued parameters were introduced to SQL Server 2008, the options for passing multiple rows of data to a stored procedure or a parameterized SQL command were limited.","pos":[1730,1909]},{"content":"A developer could choose from the following options for passing multiple rows to the server:","pos":[1910,2002]},{"content":"Use a series of individual parameters to represent the values in multiple columns and rows of data.","pos":[2012,2111]},{"content":"The amount of data that can be passed by using this method is limited by the number of parameters allowed.","pos":[2112,2218]},{"content":"SQL Server procedures can have, at most, 2100 parameters.","pos":[2219,2276]},{"content":"Server-side logic is required to assemble these individual values into a table variable or a temporary table for processing.","pos":[2277,2401]},{"content":"Bundle multiple data values into delimited strings or XML documents and then pass those text values to a procedure or statement.","pos":[2411,2539]},{"content":"This requires the procedure or statement to include the logic necessary for validating the data structures and unbundling the values.","pos":[2540,2673]},{"content":"Create a series of individual SQL statements for data modifications that affect multiple rows, such as those created by calling the <ph id=\"ph1\">`Update`</ph> method of a <ph id=\"ph2\">&lt;xref:System.Data.SqlClient.SqlDataAdapter&gt;</ph>.","pos":[2683,2880],"source":"Create a series of individual SQL statements for data modifications that affect multiple rows, such as those created by calling the `Update` method of a <xref:System.Data.SqlClient.SqlDataAdapter>."},{"content":"Changes can be submitted to the server individually or batched into groups.","pos":[2881,2956]},{"content":"However, even when submitted in batches that contain multiple statements, each statement is executed separately on the server.","pos":[2957,3083]},{"content":"Use the <ph id=\"ph1\">`bcp`</ph> utility program or the <ph id=\"ph2\">&lt;xref:System.Data.SqlClient.SqlBulkCopy&gt;</ph> object to load many rows of data into a table.","pos":[3093,3217],"source":"Use the `bcp` utility program or the <xref:System.Data.SqlClient.SqlBulkCopy> object to load many rows of data into a table."},{"content":"Although this technique is very efficient, it does not support server-side processing unless the data is loaded into a temporary table or table variable.","pos":[3218,3371]},{"pos":[3380,3417],"content":"Creating Table-Valued Parameter Types","linkify":"Creating Table-Valued Parameter Types","nodes":[{"content":"Creating Table-Valued Parameter Types","pos":[0,37]}]},{"content":"Table-valued parameters are based on strongly-typed table structures that are defined by using <ph id=\"ph1\">[!INCLUDE[tsql](../../../../../includes/tsql-md.md)]</ph> CREATE TYPE statements.","pos":[3421,3592],"source":"Table-valued parameters are based on strongly-typed table structures that are defined by using [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] CREATE TYPE statements."},{"content":"You have to create a table type and define the structure in SQL Server before you can use table-valued parameters in your client applications.","pos":[3593,3735]},{"content":"For more information about creating table types, see <bpt id=\"p1\">[</bpt>User-Defined Table Types<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkID=98364)</ept> in SQL Server Books Online.","pos":[3736,3890],"source":" For more information about creating table types, see [User-Defined Table Types](https://go.microsoft.com/fwlink/?LinkID=98364) in SQL Server Books Online."},{"content":"The following statement creates a table type named CategoryTableType that consists of CategoryID and CategoryName columns:","pos":[3897,4019]},{"content":"After you create a table type, you can declare table-valued parameters based on that type.","pos":[4138,4228]},{"content":"The following <ph id=\"ph1\">[!INCLUDE[tsql](../../../../../includes/tsql-md.md)]</ph> fragment demonstrates how to declare a table-valued parameter in a stored procedure definition.","pos":[4229,4391],"source":" The following [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] fragment demonstrates how to declare a table-valued parameter in a stored procedure definition."},{"content":"Note that the READONLY keyword is required for declaring a table-valued parameter.","pos":[4392,4474]},{"pos":[4596,4654],"content":"Modifying Data with Table-Valued Parameters (Transact-SQL)","linkify":"Modifying Data with Table-Valued Parameters (Transact-SQL)","nodes":[{"content":"Modifying Data with Table-Valued Parameters (Transact-SQL)","pos":[0,58]}]},{"content":"Table-valued parameters can be used in set-based data modifications that affect multiple rows by executing a single statement.","pos":[4658,4784]},{"content":"For example, you can select all the rows in a table-valued parameter and insert them into a database table, or you can create an update statement by joining a table-valued parameter to the table you want to update.","pos":[4785,4999]},{"content":"The following <ph id=\"ph1\">[!INCLUDE[tsql](../../../../../includes/tsql-md.md)]</ph> UPDATE statement demonstrates how to use a table-valued parameter by joining it to the Categories table.","pos":[5006,5177],"source":"The following [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] UPDATE statement demonstrates how to use a table-valued parameter by joining it to the Categories table."},{"content":"When you use a table-valued parameter with a JOIN in a FROM clause, you must also alias it, as shown here, where the table-valued parameter is aliased as \"ec\":","pos":[5178,5337]},{"pos":[5551,5732],"content":"This <ph id=\"ph1\">[!INCLUDE[tsql](../../../../../includes/tsql-md.md)]</ph> example demonstrates how to select rows from a table-valued parameter to perform an INSERT in a single set-based operation.","source":"This [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] example demonstrates how to select rows from a table-valued parameter to perform an INSERT in a single set-based operation."},{"pos":[5886,5924],"content":"Limitations of Table-Valued Parameters","linkify":"Limitations of Table-Valued Parameters","nodes":[{"content":"Limitations of Table-Valued Parameters","pos":[0,38]}]},{"content":"There are several limitations to table-valued parameters:","pos":[5928,5985]},{"pos":[5995,6177],"content":"You cannot pass table-valued parameters to <bpt id=\"p1\">[</bpt>CLR user-defined functions<ept id=\"p1\">](/sql/relational-databases/clr-integration-database-objects-user-defined-functions/clr-user-defined-functions)</ept>.","source":"You cannot pass table-valued parameters to [CLR user-defined functions](/sql/relational-databases/clr-integration-database-objects-user-defined-functions/clr-user-defined-functions)."},{"content":"Table-valued parameters can only be indexed to support UNIQUE or PRIMARY KEY constraints.","pos":[6187,6276]},{"content":"SQL Server does not maintain statistics on table-valued parameters.","pos":[6277,6344]},{"content":"Table-valued parameters are read-only in <ph id=\"ph1\">[!INCLUDE[tsql](../../../../../includes/tsql-md.md)]</ph> code.","pos":[6354,6453],"source":"Table-valued parameters are read-only in [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] code."},{"content":"You cannot update the column values in the rows of a table-valued parameter and you cannot insert or delete rows.","pos":[6454,6567]},{"content":"To modify the data that is passed to a stored procedure or parameterized statement in table-valued parameter, you must insert the data into a temporary table or into a table variable.","pos":[6568,6751]},{"content":"You cannot use ALTER TABLE statements to modify the design of table-valued parameters.","pos":[6761,6847]},{"pos":[6856,6890],"content":"Configuring a SqlParameter Example","linkify":"Configuring a SqlParameter Example","nodes":[{"content":"Configuring a SqlParameter Example","pos":[0,34]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.Data.SqlClient&gt;</ph> supports populating table-valued parameters from <ph id=\"ph2\">&lt;xref:System.Data.DataTable&gt;</ph>, <ph id=\"ph3\">&lt;xref:System.Data.Common.DbDataReader&gt;</ph> or <ph id=\"ph4\">&lt;xref:System.Collections.Generic.IEnumerable%601&gt;</ph><ph id=\"ph5\"> \\ </ph><ph id=\"ph6\">&lt;xref:Microsoft.SqlServer.Server.SqlDataRecord&gt;</ph> objects.","pos":[6894,7152],"source":"<xref:System.Data.SqlClient> supports populating table-valued parameters from <xref:System.Data.DataTable>, <xref:System.Data.Common.DbDataReader> or <xref:System.Collections.Generic.IEnumerable%601> \\ <xref:Microsoft.SqlServer.Server.SqlDataRecord> objects."},{"content":"You must specify a type name for the table-valued parameter by using the <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlParameter.TypeName%2A&gt;</ph> property of a <ph id=\"ph2\">&lt;xref:System.Data.SqlClient.SqlParameter&gt;</ph>.","pos":[7153,7336],"source":" You must specify a type name for the table-valued parameter by using the <xref:System.Data.SqlClient.SqlParameter.TypeName%2A> property of a <xref:System.Data.SqlClient.SqlParameter>."},{"content":"The <ph id=\"ph1\">`TypeName`</ph> must match the name of a compatible type previously created on the server.","pos":[7337,7426],"source":" The `TypeName` must match the name of a compatible type previously created on the server."},{"content":"The following code fragment demonstrates how to configure <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlParameter&gt;</ph> to insert data.","pos":[7427,7542],"source":" The following code fragment demonstrates how to configure <xref:System.Data.SqlClient.SqlParameter> to insert data."},{"content":"In the following example, the <ph id=\"ph1\">`addedCategories`</ph> variable contains a <ph id=\"ph2\">&lt;xref:System.Data.DataTable&gt;</ph>.","pos":[7547,7644],"source":"In the following example, the `addedCategories` variable contains a <xref:System.Data.DataTable>."},{"content":"To see how the variable is populated, see the examples in the next section, <bpt id=\"p1\">[</bpt>Passing a Table-Valued Parameter to a Stored Procedure<ept id=\"p1\">](#passing)</ept>.","pos":[7645,7788],"source":" To see how the variable is populated, see the examples in the next section, [Passing a Table-Valued Parameter to a Stored Procedure](#passing)."},{"pos":[8449,8607],"content":"You can also use any object derived from <ph id=\"ph1\">&lt;xref:System.Data.Common.DbDataReader&gt;</ph> to stream rows of data to a table-valued parameter, as shown in this fragment:","source":"You can also use any object derived from <xref:System.Data.Common.DbDataReader> to stream rows of data to a table-valued parameter, as shown in this fragment:"},{"pos":[9344,9421],"content":"<bpt id=\"p1\">&lt;a name=\"passing\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Passing a Table-Valued Parameter to a Stored Procedure","linkify":"<a name=\"passing\"></a> Passing a Table-Valued Parameter to a Stored Procedure","source":"<a name=\"passing\"></a> Passing a Table-Valued Parameter to a Stored Procedure"},{"content":"This example demonstrates how to pass table-valued parameter data to a stored procedure.","pos":[9425,9513]},{"content":"The code extracts added rows into a new <ph id=\"ph1\">&lt;xref:System.Data.DataTable&gt;</ph> by using the <ph id=\"ph2\">&lt;xref:System.Data.DataTable.GetChanges%2A&gt;</ph> method.","pos":[9514,9646],"source":" The code extracts added rows into a new <xref:System.Data.DataTable> by using the <xref:System.Data.DataTable.GetChanges%2A> method."},{"content":"The code then defines a <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlCommand&gt;</ph>, setting the <ph id=\"ph2\">&lt;xref:System.Data.SqlClient.SqlCommand.CommandType%2A&gt;</ph> property to <ph id=\"ph3\">&lt;xref:System.Data.CommandType.StoredProcedure&gt;</ph>.","pos":[9647,9838],"source":" The code then defines a <xref:System.Data.SqlClient.SqlCommand>, setting the <xref:System.Data.SqlClient.SqlCommand.CommandType%2A> property to <xref:System.Data.CommandType.StoredProcedure>."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlParameter&gt;</ph> is populated by using the <ph id=\"ph2\">&lt;xref:System.Data.SqlClient.SqlParameterCollection.AddWithValue%2A&gt;</ph> method and the <ph id=\"ph3\">&lt;xref:System.Data.SqlClient.SqlParameter.SqlDbType%2A&gt;</ph> is set to <ph id=\"ph4\">`Structured`</ph>.","pos":[9839,10072],"source":" The <xref:System.Data.SqlClient.SqlParameter> is populated by using the <xref:System.Data.SqlClient.SqlParameterCollection.AddWithValue%2A> method and the <xref:System.Data.SqlClient.SqlParameter.SqlDbType%2A> is set to `Structured`."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlCommand&gt;</ph> is then executed by using the <ph id=\"ph2\">&lt;xref:System.Data.SqlClient.SqlCommand.ExecuteNonQuery%2A&gt;</ph> method.","pos":[10073,10213],"source":" The <xref:System.Data.SqlClient.SqlCommand> is then executed by using the <xref:System.Data.SqlClient.SqlCommand.ExecuteNonQuery%2A> method."},{"pos":[11579,11644],"content":"Passing a Table-Valued Parameter to a Parameterized SQL Statement","linkify":"Passing a Table-Valued Parameter to a Parameterized SQL Statement","nodes":[{"content":"Passing a Table-Valued Parameter to a Parameterized SQL Statement","pos":[0,65]}]},{"content":"The following example demonstrates how to insert data into the dbo.Categories table by using an INSERT statement with a SELECT subquery that has a table-valued parameter as the data source.","pos":[11648,11837]},{"content":"When passing a table-valued parameter to a parameterized SQL statement, you must specify a type name for the table-valued parameter by using the new <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlParameter.TypeName%2A&gt;</ph> property of a <ph id=\"ph2\">&lt;xref:System.Data.SqlClient.SqlParameter&gt;</ph>.","pos":[11838,12097],"source":" When passing a table-valued parameter to a parameterized SQL statement, you must specify a type name for the table-valued parameter by using the new <xref:System.Data.SqlClient.SqlParameter.TypeName%2A> property of a <xref:System.Data.SqlClient.SqlParameter>."},{"content":"This <ph id=\"ph1\">`TypeName`</ph> must match the name of a compatible type previously created on the server.","pos":[12098,12188],"source":" This `TypeName` must match the name of a compatible type previously created on the server."},{"content":"The code in this example uses the <ph id=\"ph1\">`TypeName`</ph> property to reference the type structure defined in dbo.CategoryTableType.","pos":[12189,12308],"source":" The code in this example uses the `TypeName` property to reference the type structure defined in dbo.CategoryTableType."},{"pos":[12316,12466],"content":"[!NOTE]\n If you supply a value for an identity column in a table-valued parameter, you must issue the SET IDENTITY_INSERT statement for the session.","leadings":["","> "],"nodes":[{"content":"If you supply a value for an identity column in a table-valued parameter, you must issue the SET IDENTITY_INSERT statement for the session.","pos":[9,148]}]},{"pos":[14183,14215],"content":"Streaming Rows with a DataReader","linkify":"Streaming Rows with a DataReader","nodes":[{"content":"Streaming Rows with a DataReader","pos":[0,32]}]},{"content":"You can also use any object derived from <ph id=\"ph1\">&lt;xref:System.Data.Common.DbDataReader&gt;</ph> to stream rows of data to a table-valued parameter.","pos":[14219,14350],"source":"You can also use any object derived from <xref:System.Data.Common.DbDataReader> to stream rows of data to a table-valued parameter."},{"content":"The following code fragment demonstrates retrieving data from an Oracle database by using an <ph id=\"ph1\">&lt;xref:System.Data.OracleClient.OracleCommand&gt;</ph> and an <ph id=\"ph2\">&lt;xref:System.Data.OracleClient.OracleDataReader&gt;</ph>.","pos":[14351,14546],"source":" The following code fragment demonstrates retrieving data from an Oracle database by using an <xref:System.Data.OracleClient.OracleCommand> and an <xref:System.Data.OracleClient.OracleDataReader>."},{"content":"The code then configures a <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlCommand&gt;</ph> to invoke a stored procedure with a single input parameter.","pos":[14547,14673],"source":" The code then configures a <xref:System.Data.SqlClient.SqlCommand> to invoke a stored procedure with a single input parameter."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlParameter.SqlDbType%2A&gt;</ph> property of the <ph id=\"ph2\">&lt;xref:System.Data.SqlClient.SqlParameter&gt;</ph> is set to <ph id=\"ph3\">`Structured`</ph>.","pos":[14674,14814],"source":" The <xref:System.Data.SqlClient.SqlParameter.SqlDbType%2A> property of the <xref:System.Data.SqlClient.SqlParameter> is set to `Structured`."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlParameterCollection.AddWithValue%2A&gt;</ph> passes the <ph id=\"ph2\">`OracleDataReader`</ph> result set to the stored procedure as a table-valued parameter.","pos":[14815,14980],"source":" The <xref:System.Data.SqlClient.SqlParameterCollection.AddWithValue%2A> passes the `OracleDataReader` result set to the stored procedure as a table-valued parameter."},{"pos":[16503,16511],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[16515,16658],"content":"<bpt id=\"p1\">[</bpt>Configuring Parameters and Parameter Data Types<ept id=\"p1\">](../../../../../docs/framework/data/adonet/configuring-parameters-and-parameter-data-types.md)</ept>","source":"[Configuring Parameters and Parameter Data Types](../../../../../docs/framework/data/adonet/configuring-parameters-and-parameter-data-types.md)"},{"pos":[16661,16756],"content":"<bpt id=\"p1\">[</bpt>Commands and Parameters<ept id=\"p1\">](../../../../../docs/framework/data/adonet/commands-and-parameters.md)</ept>","source":"[Commands and Parameters](../../../../../docs/framework/data/adonet/commands-and-parameters.md)"},{"pos":[16759,16852],"content":"<bpt id=\"p1\">[</bpt>DataAdapter Parameters<ept id=\"p1\">](../../../../../docs/framework/data/adonet/dataadapter-parameters.md)</ept>","source":"[DataAdapter Parameters](../../../../../docs/framework/data/adonet/dataadapter-parameters.md)"},{"pos":[16855,16971],"content":"<bpt id=\"p1\">[</bpt>SQL Server Data Operations in ADO.NET<ept id=\"p1\">](../../../../../docs/framework/data/adonet/sql/sql-server-data-operations.md)</ept>","source":"[SQL Server Data Operations in ADO.NET](../../../../../docs/framework/data/adonet/sql/sql-server-data-operations.md)"},{"pos":[16974,17078],"content":"<bpt id=\"p1\">[</bpt>ADO.NET Managed Providers and DataSet Developer Center<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=217917)</ept>","source":"[ADO.NET Managed Providers and DataSet Developer Center](https://go.microsoft.com/fwlink/?LinkId=217917)"}]}