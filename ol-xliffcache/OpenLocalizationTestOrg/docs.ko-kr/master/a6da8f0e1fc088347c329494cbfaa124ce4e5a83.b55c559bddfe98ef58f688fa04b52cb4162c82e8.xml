{"content":"---\ntitle: \"Message Security with a Certificate Client | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 99770573-c815-4428-a38c-e4335c8bd7ce\ncaps.latest.revision: 16\nauthor: \"BrucePerlerMS\"\nms.author: \"bruceper\"\nmanager: \"mbaldwin\"\n---\n# Message Security with a Certificate Client\nThe following scenario shows a [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] client and service secured using message security mode. Both the client and the service are authenticated with certificates. [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][Distributed Application Security](../../../../docs/framework/wcf/feature-details/distributed-application-security.md).  \n  \n For a sample application, see [Message Security Certificate](../../../../docs/framework/wcf/samples/message-security-certificate.md).  \n  \n ![Client with certificate](../../../../docs/framework/wcf/feature-details/media/clientwithcertificate.gif \"ClientWithCertificate\")  \n  \n|Characteristic|Description|  \n|--------------------|-----------------|  \n|Security Mode|Message|  \n|Interoperability|[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] only|  \n|Authentication (Server)|Using service certificate|  \n|Authentication (Client)|Using client certificate|  \n|Integrity|Yes|  \n|Confidentiality|Yes|  \n|Transport|HTTP|  \n|Binding|<xref:System.ServiceModel.WSHttpBinding>|  \n  \n## Service  \n The following code and configuration are meant to run independently. Do one of the following:  \n  \n-   Create a stand-alone service using the code with no configuration.  \n  \n-   Create a service using the supplied configuration, but do not define any endpoints.  \n  \n### Code  \n The following code shows how to create a service endpoint that uses message security to establish a secure context.  \n  \n [!code-csharp[C_SecurityScenarios#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#10)]\n [!code-vb[C_SecurityScenarios#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#10)]  \n  \n### Configuration  \n The following configuration can be used instead of the code.  \n  \n```  \n<?xml version=\"1.0\" encoding=\"utf-8\"?>  \n<configuration>  \n  <system.serviceModel>  \n    <behaviors>  \n      <serviceBehaviors>  \n        <behavior name=\"ServiceCredentialsBehavior\">  \n          <serviceCredentials>  \n            <serviceCertificate findValue=\"Contoso.com\"  \n                                x509FindType=\"FindBySubjectName\" />  \n          </serviceCredentials>  \n        </behavior>  \n      </serviceBehaviors>  \n    </behaviors>  \n    <services>  \n      <service behaviorConfiguration=\"ServiceCredentialsBehavior\"   \n               name=\"ServiceModel.Calculator\">  \n        <endpoint address=\"http://localhost/Calculator\"   \n                  binding=\"wsHttpBinding\"  \n                  bindingConfiguration=\"MessageAndCerficiateClient\"   \n                  name=\"SecuredByClientCertificate\"  \n                  contract=\"ServiceModel.ICalculator\" />  \n      </service>  \n    </services>  \n    <bindings>  \n      <wsHttpBinding>  \n        <binding name=\"WSHttpBinding_ICalculator\">  \n          <security mode=\"Message\">  \n            <message clientCredentialType=\"Certificate\" />  \n          </security>  \n        </binding>  \n      </wsHttpBinding>  \n    </bindings>  \n    <client />  \n  </system.serviceModel>  \n</configuration>  \n```  \n  \n## Client  \n The following code and configuration are meant to run independently. Do one of the following:  \n  \n-   Create a stand-alone client using the code (and client code).  \n  \n-   Create a client that does not define any endpoint addresses. Instead, use the client constructor that takes the configuration name as an argument. For example:  \n  \n     [!code-csharp[C_SecurityScenarios#0](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#0)]\n     [!code-vb[C_SecurityScenarios#0](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#0)]  \n  \n### Code  \n The following code creates the client. The binding is to message mode security, and the client credential type is set to `Certificate`.  \n  \n [!code-csharp[C_SecurityScenarios#17](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#17)]\n [!code-vb[C_SecurityScenarios#17](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#17)]  \n  \n### Configuration  \n The following configuration specifies the client certificate using an endpoint behavior. For more information about certificates, see [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md). The code also uses an <`identity`> element to specify a Domain Name System (DNS) of the expected server identity. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] identity, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).  \n  \n```  \n<?xml version=\"1.0\" encoding=\"utf-8\"?>  \n<configuration>  \n  <system.serviceModel>  \n    <behaviors>  \n      <endpointBehaviors>  \n        <behavior name=\"endpointCredentialsBehavior\">  \n          <clientCredentials>  \n            <clientCertificate findValue=\"Cohowinery.com\"   \n               storeLocation=\"LocalMachine\"  \n              x509FindType=\"FindBySubjectName\" />  \n          </clientCredentials>  \n        </behavior>  \n      </endpointBehaviors>  \n    </behaviors>  \n    <bindings>  \n      <wsHttpBinding>  \n        <binding name=\"WSHttpBinding_ICalculator\" >  \n          <security mode=\"Message\">  \n            <message clientCredentialType=\"Certificate\" />  \n          </security>  \n        </binding>  \n      </wsHttpBinding>  \n    </bindings>  \n    <client>  \n      <endpoint address=\"http://machineName/Calculator\"   \n                behaviorConfiguration=\"endpointCredentialsBehavior\"  \n                binding=\"wsHttpBinding\"  \n                bindingConfiguration=\"WSHttpBinding_ICalculator\"  \n                contract=\"ICalculator\"  \n                name=\"WSHttpBinding_ICalculator\">  \n        <identity>  \n          <dns value=\"Contoso.com\" />  \n        </identity>  \n      </endpoint>  \n    </client>  \n  </system.serviceModel>  \n</configuration>  \n```  \n  \n## See Also  \n [Security Overview](../../../../docs/framework/wcf/feature-details/security-overview.md)   \n [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)   \n [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)   \n [Security Model for Windows Server App Fabric](http://go.microsoft.com/fwlink/?LinkID=201279&clcid=0x409)","nodes":[{"pos":[4,374],"nodes":[{"content":"Message Security with a Certificate Client | Microsoft Docs","nodes":[{"pos":[0,59],"content":"Message Security with a Certificate Client | Microsoft Docs","nodes":[{"content":"Message Security with a Certificate Client | Microsoft Docs","pos":[0,59]}]}],"pos":[6,68],"yaml":true}],"content":"title: \"Message Security with a Certificate Client | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 99770573-c815-4428-a38c-e4335c8bd7ce\ncaps.latest.revision: 16\nauthor: \"BrucePerlerMS\"\nms.author: \"bruceper\"\nmanager: \"mbaldwin\"","yamlblock":true},{"pos":[381,423],"content":"Message Security with a Certificate Client","linkify":"Message Security with a Certificate Client","nodes":[{"content":"Message Security with a Certificate Client","pos":[0,42]}]},{"content":"The following scenario shows a <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> client and service secured using message security mode.","pos":[424,566],"source":"The following scenario shows a [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] client and service secured using message security mode."},{"content":"Both the client and the service are authenticated with certificates.","pos":[567,635]},{"content":"<ph id=\"ph1\">[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]</ph><bpt id=\"p1\">[</bpt>Distributed Application Security<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/distributed-application-security.md)</ept>.","pos":[636,814],"source":"[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][Distributed Application Security](../../../../docs/framework/wcf/feature-details/distributed-application-security.md)."},{"pos":[821,954],"content":"For a sample application, see <bpt id=\"p1\">[</bpt>Message Security Certificate<ept id=\"p1\">](../../../../docs/framework/wcf/samples/message-security-certificate.md)</ept>.","source":"For a sample application, see [Message Security Certificate](../../../../docs/framework/wcf/samples/message-security-certificate.md)."},{"pos":[961,1091],"content":"<bpt id=\"p1\">![</bpt>Client with certificate<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wcf/feature-details/media/clientwithcertificate.gif \"</bpt>ClientWithCertificate<ept id=\"p2\">\")</ept>","source":"![Client with certificate](../../../../docs/framework/wcf/feature-details/media/clientwithcertificate.gif \"ClientWithCertificate\")"},{"content":"Characteristic","pos":[1098,1112]},{"content":"Description","pos":[1113,1124]},{"content":"Security Mode","pos":[1172,1185]},{"content":"Message","pos":[1186,1193]},{"content":"Interoperability","pos":[1198,1214]},{"pos":[1215,1275],"content":"<ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> only","source":"[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] only"},{"content":"Authentication (Server)","pos":[1280,1303]},{"content":"Using service certificate","pos":[1304,1329]},{"content":"Authentication (Client)","pos":[1334,1357]},{"content":"Using client certificate","pos":[1358,1382]},{"content":"Integrity","pos":[1387,1396]},{"content":"Yes","pos":[1397,1400]},{"content":"Confidentiality","pos":[1405,1420]},{"content":"Yes","pos":[1421,1424]},{"content":"Transport","pos":[1429,1438]},{"content":"HTTP","pos":[1439,1443]},{"content":"Binding","pos":[1448,1455]},{"pos":[1506,1513],"content":"Service","linkify":"Service","nodes":[{"content":"Service","pos":[0,7]}]},{"content":"The following code and configuration are meant to run independently.","pos":[1517,1585]},{"content":"Do one of the following:","pos":[1586,1610]},{"content":"Create a stand-alone service using the code with no configuration.","pos":[1620,1686]},{"content":"Create a service using the supplied configuration, but do not define any endpoints.","pos":[1696,1779]},{"pos":[1789,1793],"content":"Code","linkify":"Code","nodes":[{"content":"Code","pos":[0,4]}]},{"content":"The following code shows how to create a service endpoint that uses message security to establish a secure context.","pos":[1797,1912]},{"pos":[1919,2176],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>C_SecurityScenarios#10<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#10)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>C_SecurityScenarios#10<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#10)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[C_SecurityScenarios#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#10)]\n [!code-vb[C_SecurityScenarios#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#10)]"},{"pos":[2186,2199],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"content":"The following configuration can be used instead of the code.","pos":[2203,2263]},{"pos":[3539,3545],"content":"Client","linkify":"Client","nodes":[{"content":"Client","pos":[0,6]}]},{"content":"The following code and configuration are meant to run independently.","pos":[3549,3617]},{"content":"Do one of the following:","pos":[3618,3642]},{"content":"Create a stand-alone client using the code (and client code).","pos":[3652,3713]},{"content":"Create a client that does not define any endpoint addresses.","pos":[3723,3783]},{"content":"Instead, use the client constructor that takes the configuration name as an argument.","pos":[3784,3869]},{"content":"For example:","pos":[3870,3882]},{"pos":[3893,4150],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>C_SecurityScenarios#0<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#0)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>C_SecurityScenarios#0<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#0)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[C_SecurityScenarios#0](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#0)]\n [!code-vb[C_SecurityScenarios#0](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#0)]"},{"pos":[4160,4164],"content":"Code","linkify":"Code","nodes":[{"content":"Code","pos":[0,4]}]},{"content":"The following code creates the client.","pos":[4168,4206]},{"content":"The binding is to message mode security, and the client credential type is set to <ph id=\"ph1\">`Certificate`</ph>.","pos":[4207,4303],"source":" The binding is to message mode security, and the client credential type is set to `Certificate`."},{"pos":[4310,4567],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>C_SecurityScenarios#17<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#17)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>C_SecurityScenarios#17<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#17)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[C_SecurityScenarios#17](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#17)]\n [!code-vb[C_SecurityScenarios#17](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#17)]"},{"pos":[4577,4590],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"content":"The following configuration specifies the client certificate using an endpoint behavior.","pos":[4594,4682]},{"content":"For more information about certificates, see <bpt id=\"p1\">[</bpt>Working with Certificates<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)</ept>.","pos":[4683,4833],"source":" For more information about certificates, see [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)."},{"content":"The code also uses an &lt;<ph id=\"ph1\">`identity`</ph>&gt; element to specify a Domain Name System (DNS) of the expected server identity.","pos":[4834,4947],"source":" The code also uses an <`identity`> element to specify a Domain Name System (DNS) of the expected server identity."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> identity, see <bpt id=\"p1\">[</bpt>Service Identity and Authentication<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)</ept>.","pos":[4948,5143],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] identity, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)."},{"pos":[6441,6449],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Security Overview<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/security-overview.md)</ept><ph id=\"ph1\"> </ph>","pos":[6453,6542],"source":"[Security Overview](../../../../docs/framework/wcf/feature-details/security-overview.md) "},{"content":"<bpt id=\"p1\">[</bpt>Service Identity and Authentication<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)</ept><ph id=\"ph1\"> </ph>","pos":[6546,6671],"source":"[Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md) "},{"content":"<bpt id=\"p1\">[</bpt>Working with Certificates<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)</ept><ph id=\"ph1\"> </ph>","pos":[6675,6780],"source":"[Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md) "},{"content":"<bpt id=\"p1\">[</bpt>Security Model for Windows Server App Fabric<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkID=201279&amp;clcid=0x409)</ept>","pos":[6784,6889],"source":"[Security Model for Windows Server App Fabric](http://go.microsoft.com/fwlink/?LinkID=201279&clcid=0x409)"}]}