{"content":"---\ntitle: \"How to: Combine LINQ Queries with Regular Expressions (C#)\"\nms.date: 07/20/2015\nms.assetid: 6b003b65-20a4-4ca2-929e-2ee3f215aecc\n---\n# How to: Combine LINQ Queries with Regular Expressions (C#)\nThis example shows how to use the <xref:System.Text.RegularExpressions.Regex> class to create a regular expression for more complex matching in text strings. The LINQ query makes it easy to filter on exactly the files that you want to search with the regular expression, and to shape the results.  \n  \n## Example  \n  \n```csharp  \nclass QueryWithRegEx  \n{  \n    public static void Main()  \n    {  \n        // Modify this path as necessary so that it accesses your version of Visual Studio.  \n        string startFolder = @\"C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\\";  \n        // One of the following paths may be more appropriate on your computer.  \n        //string startFolder = @\"C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\\";  \n  \n        // Take a snapshot of the file system.  \n        IEnumerable<System.IO.FileInfo> fileList = GetFiles(startFolder);  \n  \n        // Create the regular expression to find all things \"Visual\".  \n        System.Text.RegularExpressions.Regex searchTerm =  \n            new System.Text.RegularExpressions.Regex(@\"Visual (Basic|C#|C\\+\\+|Studio)\");  \n  \n        // Search the contents of each .htm file.  \n        // Remove the where clause to find even more matchedValues!  \n        // This query produces a list of files where a match  \n        // was found, and a list of the matchedValues in that file.  \n        // Note: Explicit typing of \"Match\" in select clause.  \n        // This is required because MatchCollection is not a   \n        // generic IEnumerable collection.  \n        var queryMatchingFiles =  \n            from file in fileList  \n            where file.Extension == \".htm\"  \n            let fileText = System.IO.File.ReadAllText(file.FullName)  \n            let matches = searchTerm.Matches(fileText)  \n            where matches.Count > 0  \n            select new  \n            {  \n                name = file.FullName,  \n                matchedValues = from System.Text.RegularExpressions.Match match in matches  \n                                select match.Value  \n            };  \n  \n        // Execute the query.  \n        Console.WriteLine(\"The term \\\"{0}\\\" was found in:\", searchTerm.ToString());  \n  \n        foreach (var v in queryMatchingFiles)  \n        {  \n            // Trim the path a bit, then write   \n            // the file name in which a match was found.  \n            string s = v.name.Substring(startFolder.Length - 1);  \n            Console.WriteLine(s);  \n  \n            // For this file, write out all the matching strings  \n            foreach (var v2 in v.matchedValues)  \n            {  \n                Console.WriteLine(\"  \" + v2);  \n            }  \n        }  \n  \n        // Keep the console window open in debug mode  \n        Console.WriteLine(\"Press any key to exit\");  \n        Console.ReadKey();  \n    }  \n  \n    // This method assumes that the application has discovery   \n    // permissions for all folders under the specified path.  \n    static IEnumerable<System.IO.FileInfo> GetFiles(string path)  \n    {  \n        if (!System.IO.Directory.Exists(path))  \n            throw new System.IO.DirectoryNotFoundException();  \n  \n        string[] fileNames = null;  \n        List<System.IO.FileInfo> files = new List<System.IO.FileInfo>();  \n  \n        fileNames = System.IO.Directory.GetFiles(path, \"*.*\", System.IO.SearchOption.AllDirectories);  \n        foreach (string name in fileNames)  \n        {  \n            files.Add(new System.IO.FileInfo(name));  \n        }  \n        return files;  \n    }  \n}  \n```  \n  \n Note that you can also query the <xref:System.Text.RegularExpressions.MatchCollection> object that is returned by a `RegEx` search. In this example only the value of each match is produced in the results. However, it is also possible to use LINQ to perform all kinds of filtering, sorting, and grouping on that collection. Because <xref:System.Text.RegularExpressions.MatchCollection> is a non-generic <xref:System.Collections.IEnumerable> collection, you have to explicitly state the type of the range variable in the query.  \n  \n## Compiling the Code  \n Create a project that targets the .NET Framework  version 3.5 or higher, with a reference to System.Core.dll and `using` directives for the System.Linq and System.IO namespaces.  \n  \n## See also\n\n- [LINQ and Strings (C#)](../../../../csharp/programming-guide/concepts/linq/linq-and-strings.md)\n- [LINQ and File Directories (C#)](../../../../csharp/programming-guide/concepts/linq/linq-and-file-directories.md)\n","nodes":[{"pos":[4,140],"embed":true,"restype":"x-metadata","content":"title: \"How to: Combine LINQ Queries with Regular Expressions (C#)\"\nms.date: 07/20/2015\nms.assetid: 6b003b65-20a4-4ca2-929e-2ee3f215aecc","nodes":[{"content":"How to: Combine LINQ Queries with Regular Expressions (C#)","nodes":[{"pos":[0,58],"content":"How to: Combine LINQ Queries with Regular Expressions (C#)","nodes":[{"content":"How to: Combine LINQ Queries with Regular Expressions (C#)","pos":[0,58]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[147,205],"content":"How to: Combine LINQ Queries with Regular Expressions (C#)","linkify":"How to: Combine LINQ Queries with Regular Expressions (C#)","nodes":[{"content":"How to: Combine LINQ Queries with Regular Expressions (C#)","pos":[0,58]}]},{"content":"This example shows how to use the <ph id=\"ph1\">&lt;xref:System.Text.RegularExpressions.Regex&gt;</ph> class to create a regular expression for more complex matching in text strings.","pos":[206,363],"source":"This example shows how to use the <xref:System.Text.RegularExpressions.Regex> class to create a regular expression for more complex matching in text strings."},{"content":"The LINQ query makes it easy to filter on exactly the files that you want to search with the regular expression, and to shape the results.","pos":[364,502]},{"pos":[511,518],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"Note that you can also query the <ph id=\"ph1\">&lt;xref:System.Text.RegularExpressions.MatchCollection&gt;</ph> object that is returned by a <ph id=\"ph2\">`RegEx`</ph> search.","pos":[3737,3868],"source":"Note that you can also query the <xref:System.Text.RegularExpressions.MatchCollection> object that is returned by a `RegEx` search."},{"content":"In this example only the value of each match is produced in the results.","pos":[3869,3941]},{"content":"However, it is also possible to use LINQ to perform all kinds of filtering, sorting, and grouping on that collection.","pos":[3942,4059]},{"content":"Because <ph id=\"ph1\">&lt;xref:System.Text.RegularExpressions.MatchCollection&gt;</ph> is a non-generic <ph id=\"ph2\">&lt;xref:System.Collections.IEnumerable&gt;</ph> collection, you have to explicitly state the type of the range variable in the query.","pos":[4060,4262],"source":" Because <xref:System.Text.RegularExpressions.MatchCollection> is a non-generic <xref:System.Collections.IEnumerable> collection, you have to explicitly state the type of the range variable in the query."},{"pos":[4271,4289],"content":"Compiling the Code","linkify":"Compiling the Code","nodes":[{"content":"Compiling the Code","pos":[0,18]}]},{"pos":[4293,4470],"content":"Create a project that targets the .NET Framework  version 3.5 or higher, with a reference to System.Core.dll and <ph id=\"ph1\">`using`</ph> directives for the System.Linq and System.IO namespaces.","source":"Create a project that targets the .NET Framework  version 3.5 or higher, with a reference to System.Core.dll and `using` directives for the System.Linq and System.IO namespaces."},{"pos":[4479,4487],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[4491,4586],"content":"<bpt id=\"p1\">[</bpt>LINQ and Strings (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/linq/linq-and-strings.md)</ept>","source":"[LINQ and Strings (C#)](../../../../csharp/programming-guide/concepts/linq/linq-and-strings.md)"},{"pos":[4589,4702],"content":"<bpt id=\"p1\">[</bpt>LINQ and File Directories (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/linq/linq-and-file-directories.md)</ept>","source":"[LINQ and File Directories (C#)](../../../../csharp/programming-guide/concepts/linq/linq-and-file-directories.md)"}]}