{"content":"---\ntitle: \"How to: Create an Object Pool by Using a ConcurrentBag | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"object pool, in .NET Framework\"\nms.assetid: 0480e7ff-b6f9-480e-a889-2ed4264d8372\ncaps.latest.revision: 5\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"\n---\n# How to: Create an Object Pool by Using a ConcurrentBag\nThis example shows how to use a concurrent bag to implement an object pool. Object pools can improve application performance in situations where you require multiple instances of a class and the class is expensive to create or destroy. When a client program requests a new object, the object pool first attempts to provide one that has already been created and returned to the pool. If none is available, only then is a new object created.  \n  \n <xref:System.Collections.Concurrent.ConcurrentBag%601> is used to store the objects because it supports fast insertion and removal, especially when the same thread is both adding and removing items. This example could be further augmented to be built around a <xref:System.Collections.Concurrent.IProducerConsumerCollection%601>, which the bag data structure implements, as do <xref:System.Collections.Concurrent.ConcurrentQueue%601> and <xref:System.Collections.Concurrent.ConcurrentStack%601>.  \n  \n## Example  \n [!code-csharp[CDS#04](../../../../samples/snippets/csharp/VS_Snippets_Misc/cds/cs/objectpool.cs#04)]\n [!code-vb[CDS#04](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds/vb/objectpool04.vb#04)]  \n  \n## See Also  \n [Thread-Safe Collections](../../../../docs/standard/collections/thread-safe/index.md)","nodes":[{"pos":[4,423],"embed":true,"restype":"x-metadata","content":"title: \"How to: Create an Object Pool by Using a ConcurrentBag | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"object pool, in .NET Framework\"\nms.assetid: 0480e7ff-b6f9-480e-a889-2ed4264d8372\ncaps.latest.revision: 5\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"","nodes":[{"content":"How to: Create an Object Pool by Using a ConcurrentBag | Microsoft Docs","nodes":[{"pos":[0,71],"content":"How to: Create an Object Pool by Using a ConcurrentBag | Microsoft Docs","nodes":[{"content":"How to: Create an Object Pool by Using a ConcurrentBag | Microsoft Docs","pos":[0,71]}]}],"path":["title"]}],"yml":true},{"pos":[430,484],"content":"How to: Create an Object Pool by Using a ConcurrentBag","linkify":"How to: Create an Object Pool by Using a ConcurrentBag","nodes":[{"content":"How to: Create an Object Pool by Using a ConcurrentBag","pos":[0,54]}]},{"content":"This example shows how to use a concurrent bag to implement an object pool.","pos":[485,560]},{"content":"Object pools can improve application performance in situations where you require multiple instances of a class and the class is expensive to create or destroy.","pos":[561,720]},{"content":"When a client program requests a new object, the object pool first attempts to provide one that has already been created and returned to the pool.","pos":[721,867]},{"content":"If none is available, only then is a new object created.","pos":[868,924]},{"content":"<ph id=\"ph1\">&lt;xref:System.Collections.Concurrent.ConcurrentBag%601&gt;</ph> is used to store the objects because it supports fast insertion and removal, especially when the same thread is both adding and removing items.","pos":[931,1129],"source":"<xref:System.Collections.Concurrent.ConcurrentBag%601> is used to store the objects because it supports fast insertion and removal, especially when the same thread is both adding and removing items."},{"content":"This example could be further augmented to be built around a <ph id=\"ph1\">&lt;xref:System.Collections.Concurrent.IProducerConsumerCollection%601&gt;</ph>, which the bag data structure implements, as do <ph id=\"ph2\">&lt;xref:System.Collections.Concurrent.ConcurrentQueue%601&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.Collections.Concurrent.ConcurrentStack%601&gt;</ph>.","pos":[1130,1426],"source":" This example could be further augmented to be built around a <xref:System.Collections.Concurrent.IProducerConsumerCollection%601>, which the bag data structure implements, as do <xref:System.Collections.Concurrent.ConcurrentQueue%601> and <xref:System.Collections.Concurrent.ConcurrentStack%601>."},{"pos":[1435,1442],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"pos":[1660,1668],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[1672,1757],"content":"<bpt id=\"p1\">[</bpt>Thread-Safe Collections<ept id=\"p1\">](../../../../docs/standard/collections/thread-safe/index.md)</ept>","source":"[Thread-Safe Collections](../../../../docs/standard/collections/thread-safe/index.md)"}]}