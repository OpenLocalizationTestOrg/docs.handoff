{"content":"---\ntitle: \"Connection String Builders\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 8434b608-c4d3-43d3-8ae3-6d8c6b726759\n---\n# Connection String Builders\nIn earlier versions of [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)], compile-time checking of connection strings with concatenated string values did not occur, so that at run time, an incorrect keyword generated an <xref:System.ArgumentException>. Each of the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] data providers supported different syntax for connection string keywords, which made constructing valid connection strings difficult if done manually. To address this problem, [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)] 2.0 introduced new connection string builders for each [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] data provider. Each data provider includes a strongly typed connection string builder class that inherits from <xref:System.Data.Common.DbConnectionStringBuilder>. The following table lists the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] data providers and their associated connection string builder classes.  \n  \n|Provider|ConnectionStringBuilder class|  \n|--------------|-----------------------------------|  \n|<xref:System.Data.SqlClient>|<xref:System.Data.SqlClient.SqlConnectionStringBuilder?displayProperty=nameWithType>|  \n|<xref:System.Data.OleDb>|<xref:System.Data.OleDb.OleDbConnectionStringBuilder?displayProperty=nameWithType>|  \n|<xref:System.Data.Odbc>|<xref:System.Data.Odbc.OdbcConnectionStringBuilder?displayProperty=nameWithType>|  \n|<xref:System.Data.OracleClient>|<xref:System.Data.OracleClient.OracleConnectionStringBuilder?displayProperty=nameWithType>|  \n  \n## Connection String Injection Attacks  \n A connection string injection attack can occur when dynamic string concatenation is used to build connection strings that are based on user input. If the string is not validated and malicious text or characters not escaped, an attacker can potentially access sensitive data or other resources on the server. For example, an attacker could mount an attack by supplying a semicolon and appending an additional value. The connection string is parsed by using a \"last one wins\" algorithm, and the hostile input is substituted for a legitimate value.  \n  \n The connection string builder classes are designed to eliminate guesswork and protect against syntax errors and security vulnerabilities. They provide methods and properties corresponding to the known key/value pairs permitted by each data provider. Each class maintains a fixed collection of synonyms and can translate from a synonym to the corresponding well-known key name. Checks are performed for valid key/value pairs and an invalid pair throws an exception. In addition, injected values are handled in a safe manner.  \n  \n The following example demonstrates how the <xref:System.Data.SqlClient.SqlConnectionStringBuilder> handles an inserted extra value for the `Initial Catalog` setting.  \n  \n```vb  \nDim builder As New System.Data.SqlClient.SqlConnectionStringBuilder  \nbuilder(\"Data Source\") = \"(local)\"  \nbuilder(\"Integrated Security\") = True  \nbuilder(\"Initial Catalog\") = \"AdventureWorks;NewValue=Bad\"  \nConsole.WriteLine(builder.ConnectionString)  \n```  \n  \n```csharp  \nSystem.Data.SqlClient.SqlConnectionStringBuilder builder =  \n  new System.Data.SqlClient.SqlConnectionStringBuilder();  \nbuilder[\"Data Source\"] = \"(local)\";  \nbuilder[\"integrated Security\"] = true;  \nbuilder[\"Initial Catalog\"] = \"AdventureWorks;NewValue=Bad\";  \nConsole.WriteLine(builder.ConnectionString);  \n```  \n  \n The output shows that the <xref:System.Data.SqlClient.SqlConnectionStringBuilder> handled this correctly by escaping the extra value in double quotation marks instead of appending it to the connection string as a new key/value pair.  \n  \n```  \ndata source=(local);Integrated Security=True;  \ninitial catalog=\"AdventureWorks;NewValue=Bad\"  \n```  \n  \n## Building Connection Strings from Configuration Files  \n If certain elements of a connection string are known beforehand, they can be stored in a configuration file and retrieved at run time to construct a complete connection string. For example, the name of the database might be known in advance, but not the name of the server. Or you might want a user to supply a name and password at run time without being able to inject other values into the connection string.  \n  \n One of the overloaded constructors for a connection string builder takes a <xref:System.String> as an argument, which enables you to supply a partial connection string that can then be completed from user input. The partial connection string can be stored in a configuration file and retrieved at run time.  \n  \n> [!NOTE]\n>  The <xref:System.Configuration> namespace allows programmatic access to configuration files that use the <xref:System.Web.Configuration.WebConfigurationManager> for Web applications and the <xref:System.Configuration.ConfigurationManager> for Windows applications. For more information about working with connection strings and configuration files, see [Connection Strings and Configuration Files](../../../../docs/framework/data/adonet/connection-strings-and-configuration-files.md).  \n  \n### Example  \n This example demonstrates retrieving a partial connection string from a configuration file and completing it by setting the <xref:System.Data.SqlClient.SqlConnectionStringBuilder.DataSource%2A>, <xref:System.Data.SqlClient.SqlConnectionStringBuilder.UserID%2A>, and <xref:System.Data.SqlClient.SqlConnectionStringBuilder.Password%2A> properties of the <xref:System.Data.SqlClient.SqlConnectionStringBuilder>. The configuration file is defined as follows.  \n  \n```xml  \n<connectionStrings>  \n  <clear/>  \n  <add name=\"partialConnectString\"   \n    connectionString=\"Initial Catalog=Northwind;\"  \n    providerName=\"System.Data.SqlClient\" />  \n</connectionStrings>  \n```  \n  \n> [!NOTE]\n>  You must set a reference to the `System.Configuration.dll` in your project for the code to run.  \n  \n [!code-csharp[DataWorks SqlConnectionStringBuilder.UserNamePwd#1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlConnectionStringBuilder.UserNamePwd/CS/source.cs#1)]\n [!code-vb[DataWorks SqlConnectionStringBuilder.UserNamePwd#1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlConnectionStringBuilder.UserNamePwd/VB/source.vb#1)]  \n  \n## See also\n\n- [Connection Strings](../../../../docs/framework/data/adonet/connection-strings.md)\n- [Privacy and Data Security](../../../../docs/framework/data/adonet/privacy-and-data-security.md)\n- [ADO.NET Managed Providers and DataSet Developer Center](https://go.microsoft.com/fwlink/?LinkId=217917)\n","nodes":[{"pos":[4,144],"embed":true,"restype":"x-metadata","content":"title: \"Connection String Builders\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 8434b608-c4d3-43d3-8ae3-6d8c6b726759","nodes":[{"content":"Connection String Builders","nodes":[{"pos":[0,26],"content":"Connection String Builders","nodes":[{"content":"Connection String Builders","pos":[0,26]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[151,177],"content":"Connection String Builders","linkify":"Connection String Builders","nodes":[{"content":"Connection String Builders","pos":[0,26]}]},{"content":"In earlier versions of <ph id=\"ph1\">[!INCLUDE[vstecado](../../../../includes/vstecado-md.md)]</ph>, compile-time checking of connection strings with concatenated string values did not occur, so that at run time, an incorrect keyword generated an <ph id=\"ph2\">&lt;xref:System.ArgumentException&gt;</ph>.","pos":[178,438],"source":"In earlier versions of [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)], compile-time checking of connection strings with concatenated string values did not occur, so that at run time, an incorrect keyword generated an <xref:System.ArgumentException>."},{"content":"Each of the <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> data providers supported different syntax for connection string keywords, which made constructing valid connection strings difficult if done manually.","pos":[439,665],"source":" Each of the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] data providers supported different syntax for connection string keywords, which made constructing valid connection strings difficult if done manually."},{"content":"To address this problem, <ph id=\"ph1\">[!INCLUDE[vstecado](../../../../includes/vstecado-md.md)]</ph> 2.0 introduced new connection string builders for each <ph id=\"ph2\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> data provider.","pos":[666,882],"source":" To address this problem, [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)] 2.0 introduced new connection string builders for each [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] data provider."},{"content":"Each data provider includes a strongly typed connection string builder class that inherits from <ph id=\"ph1\">&lt;xref:System.Data.Common.DbConnectionStringBuilder&gt;</ph>.","pos":[883,1031],"source":" Each data provider includes a strongly typed connection string builder class that inherits from <xref:System.Data.Common.DbConnectionStringBuilder>."},{"content":"The following table lists the <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> data providers and their associated connection string builder classes.","pos":[1032,1196],"source":" The following table lists the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] data providers and their associated connection string builder classes."},{"content":"Provider","pos":[1203,1211]},{"content":"ConnectionStringBuilder class","pos":[1212,1241]},{"pos":[1772,1807],"content":"Connection String Injection Attacks","linkify":"Connection String Injection Attacks","nodes":[{"content":"Connection String Injection Attacks","pos":[0,35]}]},{"content":"A connection string injection attack can occur when dynamic string concatenation is used to build connection strings that are based on user input.","pos":[1811,1957]},{"content":"If the string is not validated and malicious text or characters not escaped, an attacker can potentially access sensitive data or other resources on the server.","pos":[1958,2118]},{"content":"For example, an attacker could mount an attack by supplying a semicolon and appending an additional value.","pos":[2119,2225]},{"content":"The connection string is parsed by using a \"last one wins\" algorithm, and the hostile input is substituted for a legitimate value.","pos":[2226,2356]},{"content":"The connection string builder classes are designed to eliminate guesswork and protect against syntax errors and security vulnerabilities.","pos":[2363,2500]},{"content":"They provide methods and properties corresponding to the known key/value pairs permitted by each data provider.","pos":[2501,2612]},{"content":"Each class maintains a fixed collection of synonyms and can translate from a synonym to the corresponding well-known key name.","pos":[2613,2739]},{"content":"Checks are performed for valid key/value pairs and an invalid pair throws an exception.","pos":[2740,2827]},{"content":"In addition, injected values are handled in a safe manner.","pos":[2828,2886]},{"pos":[2893,3058],"content":"The following example demonstrates how the <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlConnectionStringBuilder&gt;</ph> handles an inserted extra value for the <ph id=\"ph2\">`Initial Catalog`</ph> setting.","source":"The following example demonstrates how the <xref:System.Data.SqlClient.SqlConnectionStringBuilder> handles an inserted extra value for the `Initial Catalog` setting."},{"pos":[3666,3898],"content":"The output shows that the <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlConnectionStringBuilder&gt;</ph> handled this correctly by escaping the extra value in double quotation marks instead of appending it to the connection string as a new key/value pair.","source":"The output shows that the <xref:System.Data.SqlClient.SqlConnectionStringBuilder> handled this correctly by escaping the extra value in double quotation marks instead of appending it to the connection string as a new key/value pair."},{"pos":[4018,4070],"content":"Building Connection Strings from Configuration Files","linkify":"Building Connection Strings from Configuration Files","nodes":[{"content":"Building Connection Strings from Configuration Files","pos":[0,52]}]},{"content":"If certain elements of a connection string are known beforehand, they can be stored in a configuration file and retrieved at run time to construct a complete connection string.","pos":[4074,4250]},{"content":"For example, the name of the database might be known in advance, but not the name of the server.","pos":[4251,4347]},{"content":"Or you might want a user to supply a name and password at run time without being able to inject other values into the connection string.","pos":[4348,4484]},{"content":"One of the overloaded constructors for a connection string builder takes a <ph id=\"ph1\">&lt;xref:System.String&gt;</ph> as an argument, which enables you to supply a partial connection string that can then be completed from user input.","pos":[4491,4702],"source":"One of the overloaded constructors for a connection string builder takes a <xref:System.String> as an argument, which enables you to supply a partial connection string that can then be completed from user input."},{"content":"The partial connection string can be stored in a configuration file and retrieved at run time.","pos":[4703,4797]},{"pos":[4805,5300],"content":"[!NOTE]\n The <xref:System.Configuration> namespace allows programmatic access to configuration files that use the <xref:System.Web.Configuration.WebConfigurationManager> for Web applications and the <xref:System.Configuration.ConfigurationManager> for Windows applications. For more information about working with connection strings and configuration files, see [Connection Strings and Configuration Files](../../../../docs/framework/data/adonet/connection-strings-and-configuration-files.md).","leadings":["","> "],"nodes":[{"content":"The <xref:System.Configuration> namespace allows programmatic access to configuration files that use the <xref:System.Web.Configuration.WebConfigurationManager> for Web applications and the <xref:System.Configuration.ConfigurationManager> for Windows applications. For more information about working with connection strings and configuration files, see [Connection Strings and Configuration Files](../../../../docs/framework/data/adonet/connection-strings-and-configuration-files.md).","pos":[9,493],"nodes":[{"content":"The <ph id=\"ph1\">&lt;xref:System.Configuration&gt;</ph> namespace allows programmatic access to configuration files that use the <ph id=\"ph2\">&lt;xref:System.Web.Configuration.WebConfigurationManager&gt;</ph> for Web applications and the <ph id=\"ph3\">&lt;xref:System.Configuration.ConfigurationManager&gt;</ph> for Windows applications.","pos":[0,264],"source":"The <xref:System.Configuration> namespace allows programmatic access to configuration files that use the <xref:System.Web.Configuration.WebConfigurationManager> for Web applications and the <xref:System.Configuration.ConfigurationManager> for Windows applications."},{"content":"For more information about working with connection strings and configuration files, see <bpt id=\"p1\">[</bpt>Connection Strings and Configuration Files<ept id=\"p1\">](../../../../docs/framework/data/adonet/connection-strings-and-configuration-files.md)</ept>.","pos":[265,484],"source":" For more information about working with connection strings and configuration files, see [Connection Strings and Configuration Files](../../../../docs/framework/data/adonet/connection-strings-and-configuration-files.md)."}]}]},{"pos":[5310,5317],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"This example demonstrates retrieving a partial connection string from a configuration file and completing it by setting the <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlConnectionStringBuilder.DataSource%2A&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.Data.SqlClient.SqlConnectionStringBuilder.UserID%2A&gt;</ph>, and <ph id=\"ph3\">&lt;xref:System.Data.SqlClient.SqlConnectionStringBuilder.Password%2A&gt;</ph> properties of the <ph id=\"ph4\">&lt;xref:System.Data.SqlClient.SqlConnectionStringBuilder&gt;</ph>.","pos":[5321,5729],"source":"This example demonstrates retrieving a partial connection string from a configuration file and completing it by setting the <xref:System.Data.SqlClient.SqlConnectionStringBuilder.DataSource%2A>, <xref:System.Data.SqlClient.SqlConnectionStringBuilder.UserID%2A>, and <xref:System.Data.SqlClient.SqlConnectionStringBuilder.Password%2A> properties of the <xref:System.Data.SqlClient.SqlConnectionStringBuilder>."},{"content":"The configuration file is defined as follows.","pos":[5730,5775]},{"pos":[5995,6101],"content":"[!NOTE]\n You must set a reference to the `System.Configuration.dll` in your project for the code to run.","leadings":["","> "],"nodes":[{"content":"You must set a reference to the <ph id=\"ph1\">`System.Configuration.dll`</ph> in your project for the code to run.","pos":[9,104],"source":"You must set a reference to the `System.Configuration.dll` in your project for the code to run."}]},{"pos":[6494,6502],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6506,6588],"content":"<bpt id=\"p1\">[</bpt>Connection Strings<ept id=\"p1\">](../../../../docs/framework/data/adonet/connection-strings.md)</ept>","source":"[Connection Strings](../../../../docs/framework/data/adonet/connection-strings.md)"},{"pos":[6591,6687],"content":"<bpt id=\"p1\">[</bpt>Privacy and Data Security<ept id=\"p1\">](../../../../docs/framework/data/adonet/privacy-and-data-security.md)</ept>","source":"[Privacy and Data Security](../../../../docs/framework/data/adonet/privacy-and-data-security.md)"},{"pos":[6690,6794],"content":"<bpt id=\"p1\">[</bpt>ADO.NET Managed Providers and DataSet Developer Center<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=217917)</ept>","source":"[ADO.NET Managed Providers and DataSet Developer Center](https://go.microsoft.com/fwlink/?LinkId=217917)"}]}