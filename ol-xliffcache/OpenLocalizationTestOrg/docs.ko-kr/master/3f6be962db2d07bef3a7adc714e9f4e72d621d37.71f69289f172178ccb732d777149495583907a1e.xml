{"content":"---\ntitle: \"Route by Body\"\nms.date: \"03/30/2017\"\nms.assetid: 07a6fc3b-c360-42e0-b663-3d0f22cf4502\n---\n# Route by Body\nThis sample demonstrates how to implement a service that accepts message objects with any SOAP action. This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) that implements a calculator service. The service implements a single `Calculate` operation that accepts a <xref:System.ServiceModel.Channels.Message> request parameter and returns a <xref:System.ServiceModel.Channels.Message> response.  \n  \n In this sample, the client is a console application (.exe) and the service is hosted in IIS.  \n  \n> [!NOTE]\n>  The setup procedure and build instructions for this sample are located at the end of this topic.  \n  \n The sample demonstrates message dispatch based on the body content. The built-in Windows Communication Foundation (WCF) service model message dispatch mechanism is based on message Actions. However, there are many existing Web services that define all of their operations with Action=\"\". It is impossible to build a service based on WSDL that keeps dispatching request messages based on Action information. This sample demonstrates a service contract that is based on WSDL (the WSDL is contained in Service.wsdl that is included with the sample). The service contract is Calculator, similar to the one used in [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md). However the `[OperationContract]` specifies `Action=\"\"` for all operations.  \n  \n```  \n[ServiceContract(Namespace = \"http://Microsoft.ServiceModel.Samples\"),    \n                 XmlSerializerFormat, DispatchByBodyBehavior]  \n    public interface ICalculator  \n    {  \n        [OperationContract(Action=\"\")]  \n        double Add(double n1, double n2);  \n        [OperationContract(Action = \"\")]  \n        double Subtract(double n1, double n2);  \n        [OperationContract(Action = \"\")]  \n        double Multiply(double n1, double n2);  \n        [OperationContract(Action = \"\")]  \n        double Divide(double n1, double n2);  \n    }  \n```  \n  \n Given a contract, a service requires custom dispatch behavior `DispatchByBodyBehavior` to allow messages to be dispatched between operations. This dispatch behavior initializes the `DispatchByBodyElementOperationSelector` custom operation selector with a table of the operation names keyed by QName of respective wrapper elements. `DispatchByBodyElementOperationSelector` looks at the start tag of the first child of the Body and selects the operation using the table previously mentioned.  \n  \n The client uses a proxy auto-generated from the WSDL exported by the service using [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).  \n  \n```  \nsvcutil.exe  /n:http://Microsoft.ServiceModel.Samples,Microsoft.ServiceModel.Samples /uxs http://localhost/servicemodelsamples/service.svc?wsdl /out:generatedProxy.cs  \n```  \n  \n The fact that actions of all operations are empty has no impact on the client code, except for the Action parameters in the auto-generated proxy.  \n  \n The client code performs several calculations. When you run the sample, the operation requests and responses are displayed in the client console window. Press ENTER in the client window to shut down the client.  \n  \n```  \nAdd(100, 15.99) = 115.99  \nSubtract(145, 76.54) = 68.46  \nMultiply(9, 81.25) = 731.25  \nDivide(22, 7) = 3.14285714285714  \n  \nPress <ENTER> to terminate client.  \n```  \n  \n### To set up, build, and run the sample  \n  \n1.  Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).  \n  \n2.  To build the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).  \n  \n3.  To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Extensibility\\Interop\\RouteByBody`  \n","nodes":[{"pos":[4,97],"embed":true,"restype":"x-metadata","content":"title: \"Route by Body\"\nms.date: \"03/30/2017\"\nms.assetid: 07a6fc3b-c360-42e0-b663-3d0f22cf4502","nodes":[{"content":"Route by Body","nodes":[{"pos":[0,13],"content":"Route by Body","nodes":[{"content":"Route by Body","pos":[0,13]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[104,117],"content":"Route by Body","linkify":"Route by Body","nodes":[{"content":"Route by Body","pos":[0,13]}]},{"content":"This sample demonstrates how to implement a service that accepts message objects with any SOAP action.","pos":[118,220]},{"content":"This sample is based on the <bpt id=\"p1\">[</bpt>Getting Started<ept id=\"p1\">](../../../../docs/framework/wcf/samples/getting-started-sample.md)</ept> that implements a calculator service.","pos":[221,370],"source":" This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) that implements a calculator service."},{"content":"The service implements a single <ph id=\"ph1\">`Calculate`</ph> operation that accepts a <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.Message&gt;</ph> request parameter and returns a <ph id=\"ph3\">&lt;xref:System.ServiceModel.Channels.Message&gt;</ph> response.","pos":[371,569],"source":" The service implements a single `Calculate` operation that accepts a <xref:System.ServiceModel.Channels.Message> request parameter and returns a <xref:System.ServiceModel.Channels.Message> response."},{"content":"In this sample, the client is a console application (.exe) and the service is hosted in IIS.","pos":[576,668]},{"pos":[676,783],"content":"[!NOTE]\n The setup procedure and build instructions for this sample are located at the end of this topic.","leadings":["","> "],"nodes":[{"content":"The setup procedure and build instructions for this sample are located at the end of this topic.","pos":[9,105]}]},{"content":"The sample demonstrates message dispatch based on the body content.","pos":[790,857]},{"content":"The built-in Windows Communication Foundation (WCF) service model message dispatch mechanism is based on message Actions.","pos":[858,979]},{"content":"However, there are many existing Web services that define all of their operations with Action=\"\".","pos":[980,1077]},{"content":"It is impossible to build a service based on WSDL that keeps dispatching request messages based on Action information.","pos":[1078,1196]},{"content":"This sample demonstrates a service contract that is based on WSDL (the WSDL is contained in Service.wsdl that is included with the sample).","pos":[1197,1336]},{"content":"The service contract is Calculator, similar to the one used in <bpt id=\"p1\">[</bpt>Getting Started<ept id=\"p1\">](../../../../docs/framework/wcf/samples/getting-started-sample.md)</ept>.","pos":[1337,1484],"source":" The service contract is Calculator, similar to the one used in [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md)."},{"content":"However the <ph id=\"ph1\">`[OperationContract]`</ph> specifies <ph id=\"ph2\">`Action=\"\"`</ph> for all operations.","pos":[1485,1560],"source":" However the `[OperationContract]` specifies `Action=\"\"` for all operations."},{"content":"Given a contract, a service requires custom dispatch behavior <ph id=\"ph1\">`DispatchByBodyBehavior`</ph> to allow messages to be dispatched between operations.","pos":[2131,2272],"source":"Given a contract, a service requires custom dispatch behavior `DispatchByBodyBehavior` to allow messages to be dispatched between operations."},{"content":"This dispatch behavior initializes the <ph id=\"ph1\">`DispatchByBodyElementOperationSelector`</ph> custom operation selector with a table of the operation names keyed by QName of respective wrapper elements.","pos":[2273,2461],"source":" This dispatch behavior initializes the `DispatchByBodyElementOperationSelector` custom operation selector with a table of the operation names keyed by QName of respective wrapper elements."},{"content":"<ph id=\"ph1\">`DispatchByBodyElementOperationSelector`</ph> looks at the start tag of the first child of the Body and selects the operation using the table previously mentioned.","pos":[2462,2620],"source":"`DispatchByBodyElementOperationSelector` looks at the start tag of the first child of the Body and selects the operation using the table previously mentioned."},{"pos":[2627,2843],"content":"The client uses a proxy auto-generated from the WSDL exported by the service using <bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept>.","source":"The client uses a proxy auto-generated from the WSDL exported by the service using [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)."},{"content":"The fact that actions of all operations are empty has no impact on the client code, except for the Action parameters in the auto-generated proxy.","pos":[3034,3179]},{"content":"The client code performs several calculations.","pos":[3186,3232]},{"content":"When you run the sample, the operation requests and responses are displayed in the client console window.","pos":[3233,3338]},{"content":"Press ENTER in the client window to shut down the client.","pos":[3339,3396]},{"pos":[3584,3620],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[3630,3829],"content":"Ensure that you have performed the <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"pos":[3839,4009],"content":"To build the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"pos":[4019,4227],"content":"To run the sample in a single- or cross-machine configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"pos":[4235,4367],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[14,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[0,53]},{"content":"Check for the following (default) directory before continuing.","pos":[54,116]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[4421,4731],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[4732,4782]}]}