{"content":"---\ntitle: \"Modifying Data with Stored Procedures | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-ado\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 7d8e9a46-1af6-4a02-bf61-969d77ae07e0\ncaps.latest.revision: 3\nauthor: \"JennieHubbard\"\nms.author: \"jhubbard\"\nmanager: \"jhubbard\"\n---\n# Modifying Data with Stored Procedures\nStored procedures can accept data as input parameters and can return data as output parameters, result sets, or return values. The sample below illustrates how ADO.NET sends and receives input parameters, output parameters, and return values. The example inserts a new record into a table where the primary key column is an identity column in a SQL Server database.  \n  \n> [!NOTE]\n>  If you are using SQL Server stored procedures to edit or delete data using a <xref:System.Data.SqlClient.SqlDataAdapter>, make sure that you do not use SET NOCOUNT ON in the stored procedure definition. This causes the rows affected count returned to be zero, which the `DataAdapter` interprets as a concurrency conflict. In this event, a <xref:System.Data.DBConcurrencyException> will be thrown.  \n  \n## Example  \n The sample uses the following stored procedure to insert a new category into the **Northwind** **Categories** table. The stored procedure takes the value in the **CategoryName** column as an input parameter and uses the SCOPE_IDENTITY() function to retrieve the new value of the identity field, **CategoryID**, and return it in an output parameter. The RETURN statement uses the @@ROWCOUNT function to return the number of rows inserted.  \n  \n```  \nCREATE PROCEDURE dbo.InsertCategory  \n  @CategoryName nvarchar(15),  \n  @Identity int OUT  \nAS  \nINSERT INTO Categories (CategoryName) VALUES(@CategoryName)  \nSET @Identity = SCOPE_IDENTITY()  \nRETURN @@ROWCOUNT  \n```  \n  \n The following code example uses the `InsertCategory` stored procedure shown above as the source for the <xref:System.Data.SqlClient.SqlDataAdapter.InsertCommand%2A> of the <xref:System.Data.SqlClient.SqlDataAdapter>. The `@Identity` output parameter will be reflected in the <xref:System.Data.DataSet> after the record has been inserted into the database when the `Update` method of the <xref:System.Data.SqlClient.SqlDataAdapter> is called. The code also retrieves the return value.  \n  \n> [!NOTE]\n>  When using the <xref:System.Data.OleDb.OleDbDataAdapter>, you must specify parameters with a <xref:System.Data.ParameterDirection> of **ReturnValue** before the other parameters.  \n  \n [!code-csharp[DataWorks SqlClient.SprocIdentityReturn#1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlClient.SprocIdentityReturn/CS/source.cs#1)]\n [!code-vb[DataWorks SqlClient.SprocIdentityReturn#1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlClient.SprocIdentityReturn/VB/source.vb#1)]  \n  \n## See Also  \n [Retrieving and Modifying Data in ADO.NET](../../../../docs/framework/data/adonet/retrieving-and-modifying-data.md)   \n [DataAdapters and DataReaders](../../../../docs/framework/data/adonet/dataadapters-and-datareaders.md)   \n [Executing a Command](../../../../docs/framework/data/adonet/executing-a-command.md)   \n [ADO.NET Managed Providers and DataSet Developer Center](http://go.microsoft.com/fwlink/?LinkId=217917)","nodes":[{"pos":[4,368],"nodes":[{"content":"Modifying Data with Stored Procedures | Microsoft Docs","nodes":[{"pos":[0,54],"content":"Modifying Data with Stored Procedures | Microsoft Docs","nodes":[{"content":"Modifying Data with Stored Procedures | Microsoft Docs","pos":[0,54]}]}],"pos":[6,63],"yaml":true}],"content":"title: \"Modifying Data with Stored Procedures | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-ado\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 7d8e9a46-1af6-4a02-bf61-969d77ae07e0\ncaps.latest.revision: 3\nauthor: \"JennieHubbard\"\nms.author: \"jhubbard\"\nmanager: \"jhubbard\"","yamlblock":true},{"pos":[375,412],"content":"Modifying Data with Stored Procedures","linkify":"Modifying Data with Stored Procedures","nodes":[{"content":"Modifying Data with Stored Procedures","pos":[0,37]}]},{"content":"Stored procedures can accept data as input parameters and can return data as output parameters, result sets, or return values.","pos":[413,539]},{"content":"The sample below illustrates how ADO.NET sends and receives input parameters, output parameters, and return values.","pos":[540,655]},{"content":"The example inserts a new record into a table where the primary key column is an identity column in a SQL Server database.","pos":[656,778]},{"pos":[786,1193],"content":"[!NOTE]\n If you are using SQL Server stored procedures to edit or delete data using a <xref:System.Data.SqlClient.SqlDataAdapter>, make sure that you do not use SET NOCOUNT ON in the stored procedure definition. This causes the rows affected count returned to be zero, which the `DataAdapter` interprets as a concurrency conflict. In this event, a <xref:System.Data.DBConcurrencyException> will be thrown.","leadings":["","> "],"nodes":[{"content":"If you are using SQL Server stored procedures to edit or delete data using a <xref:System.Data.SqlClient.SqlDataAdapter>, make sure that you do not use SET NOCOUNT ON in the stored procedure definition. This causes the rows affected count returned to be zero, which the `DataAdapter` interprets as a concurrency conflict. In this event, a <xref:System.Data.DBConcurrencyException> will be thrown.","pos":[9,405],"nodes":[{"content":"If you are using SQL Server stored procedures to edit or delete data using a <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlDataAdapter&gt;</ph>, make sure that you do not use SET NOCOUNT ON in the stored procedure definition.","pos":[0,202],"source":"If you are using SQL Server stored procedures to edit or delete data using a <xref:System.Data.SqlClient.SqlDataAdapter>, make sure that you do not use SET NOCOUNT ON in the stored procedure definition."},{"content":"This causes the rows affected count returned to be zero, which the <ph id=\"ph1\">`DataAdapter`</ph> interprets as a concurrency conflict.","pos":[203,321],"source":" This causes the rows affected count returned to be zero, which the `DataAdapter` interprets as a concurrency conflict."},{"content":"In this event, a <ph id=\"ph1\">&lt;xref:System.Data.DBConcurrencyException&gt;</ph> will be thrown.","pos":[322,396],"source":" In this event, a <xref:System.Data.DBConcurrencyException> will be thrown."}]}]},{"pos":[1202,1209],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The sample uses the following stored procedure to insert a new category into the <bpt id=\"p1\">**</bpt>Northwind<ept id=\"p1\">**</ept> <bpt id=\"p2\">**</bpt>Categories<ept id=\"p2\">**</ept> table.","pos":[1213,1329],"source":"The sample uses the following stored procedure to insert a new category into the **Northwind** **Categories** table."},{"content":"The stored procedure takes the value in the <bpt id=\"p1\">**</bpt>CategoryName<ept id=\"p1\">**</ept> column as an input parameter and uses the SCOPE_IDENTITY() function to retrieve the new value of the identity field, <bpt id=\"p2\">**</bpt>CategoryID<ept id=\"p2\">**</ept>, and return it in an output parameter.","pos":[1330,1561],"source":" The stored procedure takes the value in the **CategoryName** column as an input parameter and uses the SCOPE_IDENTITY() function to retrieve the new value of the identity field, **CategoryID**, and return it in an output parameter."},{"content":"The RETURN statement uses the @<ph id=\"ph1\">@ROWCOUNT</ph> function to return the number of rows inserted.","pos":[1562,1650],"source":" The RETURN statement uses the @@ROWCOUNT function to return the number of rows inserted."},{"content":"The following code example uses the <ph id=\"ph1\">`InsertCategory`</ph> stored procedure shown above as the source for the <ph id=\"ph2\">&lt;xref:System.Data.SqlClient.SqlDataAdapter.InsertCommand%2A&gt;</ph> of the <ph id=\"ph3\">&lt;xref:System.Data.SqlClient.SqlDataAdapter&gt;</ph>.","pos":[1886,2102],"source":"The following code example uses the `InsertCategory` stored procedure shown above as the source for the <xref:System.Data.SqlClient.SqlDataAdapter.InsertCommand%2A> of the <xref:System.Data.SqlClient.SqlDataAdapter>."},{"content":"The <ph id=\"ph1\">`@Identity`</ph> output parameter will be reflected in the <ph id=\"ph2\">&lt;xref:System.Data.DataSet&gt;</ph> after the record has been inserted into the database when the <ph id=\"ph3\">`Update`</ph> method of the <ph id=\"ph4\">&lt;xref:System.Data.SqlClient.SqlDataAdapter&gt;</ph> is called.","pos":[2103,2327],"source":" The `@Identity` output parameter will be reflected in the <xref:System.Data.DataSet> after the record has been inserted into the database when the `Update` method of the <xref:System.Data.SqlClient.SqlDataAdapter> is called."},{"content":"The code also retrieves the return value.","pos":[2328,2369]},{"pos":[2377,2566],"content":"[!NOTE]\n When using the <xref:System.Data.OleDb.OleDbDataAdapter>, you must specify parameters with a <xref:System.Data.ParameterDirection> of **ReturnValue** before the other parameters.","leadings":["","> "],"nodes":[{"content":"When using the <ph id=\"ph1\">&lt;xref:System.Data.OleDb.OleDbDataAdapter&gt;</ph>, you must specify parameters with a <ph id=\"ph2\">&lt;xref:System.Data.ParameterDirection&gt;</ph> of <bpt id=\"p1\">**</bpt>ReturnValue<ept id=\"p1\">**</ept> before the other parameters.","pos":[9,187],"source":"When using the <xref:System.Data.OleDb.OleDbDataAdapter>, you must specify parameters with a <xref:System.Data.ParameterDirection> of **ReturnValue** before the other parameters."}]},{"pos":[2573,2914],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>DataWorks SqlClient.SprocIdentityReturn#1<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlClient.SprocIdentityReturn/CS/source.cs#1)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>DataWorks SqlClient.SprocIdentityReturn#1<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlClient.SprocIdentityReturn/VB/source.vb#1)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[DataWorks SqlClient.SprocIdentityReturn#1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlClient.SprocIdentityReturn/CS/source.cs#1)]\n [!code-vb[DataWorks SqlClient.SprocIdentityReturn#1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlClient.SprocIdentityReturn/VB/source.vb#1)]"},{"pos":[2923,2931],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Retrieving and Modifying Data in ADO.NET<ept id=\"p1\">](../../../../docs/framework/data/adonet/retrieving-and-modifying-data.md)</ept><ph id=\"ph1\"> </ph>","pos":[2935,3051],"source":"[Retrieving and Modifying Data in ADO.NET](../../../../docs/framework/data/adonet/retrieving-and-modifying-data.md) "},{"content":"<bpt id=\"p1\">[</bpt>DataAdapters and DataReaders<ept id=\"p1\">](../../../../docs/framework/data/adonet/dataadapters-and-datareaders.md)</ept><ph id=\"ph1\"> </ph>","pos":[3055,3158],"source":"[DataAdapters and DataReaders](../../../../docs/framework/data/adonet/dataadapters-and-datareaders.md) "},{"content":"<bpt id=\"p1\">[</bpt>Executing a Command<ept id=\"p1\">](../../../../docs/framework/data/adonet/executing-a-command.md)</ept><ph id=\"ph1\"> </ph>","pos":[3162,3247],"source":"[Executing a Command](../../../../docs/framework/data/adonet/executing-a-command.md) "},{"content":"<bpt id=\"p1\">[</bpt>ADO.NET Managed Providers and DataSet Developer Center<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=217917)</ept>","pos":[3251,3354],"source":"[ADO.NET Managed Providers and DataSet Developer Center](http://go.microsoft.com/fwlink/?LinkId=217917)"}]}