{"content":"---\ntitle: \"Granting Row-Level Permissions in SQL Server\"\nms.date: \"03/30/2017\"\nms.assetid: a55aaa12-34ab-41cd-9dec-fd255b29258c\n---\n\n# Granting Row-Level Permissions in SQL Server\n\nIn some scenarios, there is a requirement to control access to data at a more granular level than what simply granting, revoking, or denying permissions provides. For example, a hospital database application may require individual Doctors to be restricted to accessing information related to only their patients. Similar requirements exist in many environments, including finance, law, government, and military applications. To help address these scenarios, SQL Server 2016 provides a [Row-Level Security](/sql/relational-databases/security/row-level-security) feature that simplifies and centralizes row-level access logic in a security policy. For earlier versions of SQL Server, similar functionality can be achieved by using views to enact row-level filtering.\n\n## Implementing Row-level Filtering\n\nRow-level filtering is used for applications storing information in a single table like in the hospital example above. To implement row-level filtering each row has a column that defines a differentiating parameter, such as a user name, label or other identifier. You create either a security policy or a view on the table, which filters the rows that the user can access. You then create parameterized stored procedures, which control the types of queries the user can execute.\n\nThe following example describes how to configure row-level filtering based on a user or login name:\n\n- Create the table, adding a column to store the name.\n\n- Enable row-level filtering:\n\n    - If you are using SQL Server 2016 or higher, or [Azure SQL Database](https://docs.microsoft.com/azure/sql-database/), create a security policy that adds a predicate on the table restricting the rows returned to those that match either the current database user (using the CURRENT_USER() built-in function) or the current login name (using the SUSER_SNAME() built-in function):\n\n        ```sql\n        CREATE SCHEMA Security\n        GO\n\n        CREATE FUNCTION Security.userAccessPredicate(@UserName sysname)\n            RETURNS TABLE\n            WITH SCHEMABINDING\n        AS\n            RETURN SELECT 1 AS accessResult\n            WHERE @UserName = SUSER_SNAME()\n        GO\n\n        CREATE SECURITY POLICY Security.userAccessPolicy\n            ADD FILTER PREDICATE Security.userAccessPredicate(UserName) ON dbo.MyTable,\n            ADD BLOCK PREDICATE Security.userAccessPredicate(UserName) ON dbo.MyTable\n        GO\n        ```\n\n    - If you are using a version of SQL Server prior to 2016, you can achieve similar functionality using a view:\n\n        ```sql\n        CREATE VIEW vw_MyTable\n        AS\n            RETURN SELECT * FROM MyTable\n            WHERE UserName = SUSER_SNAME()\n        GO\n        ```\n\n- Create stored procedures to select, insert, update, and delete data. If the filtering is enacted by a security policy, the stored procedures should perform these operations on the base table directly; otherwise, if the filtering is enacted by a view, the stored procedures should instead operate against the view. The security policy or view will automatically filter the rows returned or modified by user queries, and the stored procedure will provide a harder security boundary to prevent users with direct query access from successfully running queries that can infer the existence of filtered data.\n\n- For stored procedures that insert data, capture the user name using the same function specified in the security policy or view, and insert that value into the UserName column.\n\n- Deny all permissions on the tables (and views, if applicable) to the `public` role. Users will not be able to inherit permissions from other database roles, because the filter predicate is based on user or login names, not on roles.\n\n- Grant EXECUTE on the stored procedures to database roles. Users can only access data through the stored procedures provided.\n\n## See also\n\n- [Row-Level Security](/sql/relational-databases/security/row-level-security)\n- [Securing ADO.NET Applications](../../../../../docs/framework/data/adonet/securing-ado-net-applications.md)\n- [Overview of SQL Server Security](../../../../../docs/framework/data/adonet/sql/overview-of-sql-server-security.md)\n- [Application Security Scenarios in SQL Server](../../../../../docs/framework/data/adonet/sql/application-security-scenarios-in-sql-server.md)\n- [Managing Permissions with Stored Procedures in SQL Server](../../../../../docs/framework/data/adonet/sql/managing-permissions-with-stored-procedures-in-sql-server.md)\n- [Writing Secure Dynamic SQL in SQL Server](../../../../../docs/framework/data/adonet/sql/writing-secure-dynamic-sql-in-sql-server.md)\n- [ADO.NET Managed Providers and DataSet Developer Center](https://go.microsoft.com/fwlink/?LinkId=217917)\n","nodes":[{"pos":[4,128],"embed":true,"restype":"x-metadata","content":"title: \"Granting Row-Level Permissions in SQL Server\"\nms.date: \"03/30/2017\"\nms.assetid: a55aaa12-34ab-41cd-9dec-fd255b29258c","nodes":[{"content":"Granting Row-Level Permissions in SQL Server","nodes":[{"pos":[0,44],"content":"Granting Row-Level Permissions in SQL Server","nodes":[{"content":"Granting Row-Level Permissions in SQL Server","pos":[0,44]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[136,180],"content":"Granting Row-Level Permissions in SQL Server","linkify":"Granting Row-Level Permissions in SQL Server","nodes":[{"content":"Granting Row-Level Permissions in SQL Server","pos":[0,44]}]},{"content":"In some scenarios, there is a requirement to control access to data at a more granular level than what simply granting, revoking, or denying permissions provides.","pos":[182,344]},{"content":"For example, a hospital database application may require individual Doctors to be restricted to accessing information related to only their patients.","pos":[345,494]},{"content":"Similar requirements exist in many environments, including finance, law, government, and military applications.","pos":[495,606]},{"content":"To help address these scenarios, SQL Server 2016 provides a <bpt id=\"p1\">[</bpt>Row-Level Security<ept id=\"p1\">](/sql/relational-databases/security/row-level-security)</ept> feature that simplifies and centralizes row-level access logic in a security policy.","pos":[607,827],"source":" To help address these scenarios, SQL Server 2016 provides a [Row-Level Security](/sql/relational-databases/security/row-level-security) feature that simplifies and centralizes row-level access logic in a security policy."},{"content":"For earlier versions of SQL Server, similar functionality can be achieved by using views to enact row-level filtering.","pos":[828,946]},{"pos":[951,983],"content":"Implementing Row-level Filtering","linkify":"Implementing Row-level Filtering","nodes":[{"content":"Implementing Row-level Filtering","pos":[0,32]}]},{"content":"Row-level filtering is used for applications storing information in a single table like in the hospital example above.","pos":[985,1103]},{"content":"To implement row-level filtering each row has a column that defines a differentiating parameter, such as a user name, label or other identifier.","pos":[1104,1248]},{"content":"You create either a security policy or a view on the table, which filters the rows that the user can access.","pos":[1249,1357]},{"content":"You then create parameterized stored procedures, which control the types of queries the user can execute.","pos":[1358,1463]},{"content":"The following example describes how to configure row-level filtering based on a user or login name:","pos":[1465,1564]},{"content":"Create the table, adding a column to store the name.","pos":[1568,1620]},{"content":"Enable row-level filtering:","pos":[1624,1651]},{"pos":[1659,2034],"content":"If you are using SQL Server 2016 or higher, or <bpt id=\"p1\">[</bpt>Azure SQL Database<ept id=\"p1\">](https://docs.microsoft.com/azure/sql-database/)</ept>, create a security policy that adds a predicate on the table restricting the rows returned to those that match either the current database user (using the CURRENT_USER() built-in function) or the current login name (using the SUSER_SNAME() built-in function):","source":"If you are using SQL Server 2016 or higher, or [Azure SQL Database](https://docs.microsoft.com/azure/sql-database/), create a security policy that adds a predicate on the table restricting the rows returned to those that match either the current database user (using the CURRENT_USER() built-in function) or the current login name (using the SUSER_SNAME() built-in function):"},{"content":"If you are using a version of SQL Server prior to 2016, you can achieve similar functionality using a view:","pos":[2595,2702]},{"content":"Create stored procedures to select, insert, update, and delete data.","pos":[2871,2939]},{"content":"If the filtering is enacted by a security policy, the stored procedures should perform these operations on the base table directly; otherwise, if the filtering is enacted by a view, the stored procedures should instead operate against the view.","pos":[2940,3184]},{"content":"The security policy or view will automatically filter the rows returned or modified by user queries, and the stored procedure will provide a harder security boundary to prevent users with direct query access from successfully running queries that can infer the existence of filtered data.","pos":[3185,3473]},{"content":"For stored procedures that insert data, capture the user name using the same function specified in the security policy or view, and insert that value into the UserName column.","pos":[3477,3652]},{"content":"Deny all permissions on the tables (and views, if applicable) to the <ph id=\"ph1\">`public`</ph> role.","pos":[3656,3739],"source":"Deny all permissions on the tables (and views, if applicable) to the `public` role."},{"content":"Users will not be able to inherit permissions from other database roles, because the filter predicate is based on user or login names, not on roles.","pos":[3740,3888]},{"content":"Grant EXECUTE on the stored procedures to database roles.","pos":[3892,3949]},{"content":"Users can only access data through the stored procedures provided.","pos":[3950,4016]},{"pos":[4021,4029],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[4033,4108],"content":"<bpt id=\"p1\">[</bpt>Row-Level Security<ept id=\"p1\">](/sql/relational-databases/security/row-level-security)</ept>","source":"[Row-Level Security](/sql/relational-databases/security/row-level-security)"},{"pos":[4111,4218],"content":"<bpt id=\"p1\">[</bpt>Securing ADO.NET Applications<ept id=\"p1\">](../../../../../docs/framework/data/adonet/securing-ado-net-applications.md)</ept>","source":"[Securing ADO.NET Applications](../../../../../docs/framework/data/adonet/securing-ado-net-applications.md)"},{"pos":[4221,4336],"content":"<bpt id=\"p1\">[</bpt>Overview of SQL Server Security<ept id=\"p1\">](../../../../../docs/framework/data/adonet/sql/overview-of-sql-server-security.md)</ept>","source":"[Overview of SQL Server Security](../../../../../docs/framework/data/adonet/sql/overview-of-sql-server-security.md)"},{"pos":[4339,4480],"content":"<bpt id=\"p1\">[</bpt>Application Security Scenarios in SQL Server<ept id=\"p1\">](../../../../../docs/framework/data/adonet/sql/application-security-scenarios-in-sql-server.md)</ept>","source":"[Application Security Scenarios in SQL Server](../../../../../docs/framework/data/adonet/sql/application-security-scenarios-in-sql-server.md)"},{"pos":[4483,4650],"content":"<bpt id=\"p1\">[</bpt>Managing Permissions with Stored Procedures in SQL Server<ept id=\"p1\">](../../../../../docs/framework/data/adonet/sql/managing-permissions-with-stored-procedures-in-sql-server.md)</ept>","source":"[Managing Permissions with Stored Procedures in SQL Server](../../../../../docs/framework/data/adonet/sql/managing-permissions-with-stored-procedures-in-sql-server.md)"},{"pos":[4653,4786],"content":"<bpt id=\"p1\">[</bpt>Writing Secure Dynamic SQL in SQL Server<ept id=\"p1\">](../../../../../docs/framework/data/adonet/sql/writing-secure-dynamic-sql-in-sql-server.md)</ept>","source":"[Writing Secure Dynamic SQL in SQL Server](../../../../../docs/framework/data/adonet/sql/writing-secure-dynamic-sql-in-sql-server.md)"},{"pos":[4789,4893],"content":"<bpt id=\"p1\">[</bpt>ADO.NET Managed Providers and DataSet Developer Center<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=217917)</ept>","source":"[ADO.NET Managed Providers and DataSet Developer Center](https://go.microsoft.com/fwlink/?LinkId=217917)"}]}