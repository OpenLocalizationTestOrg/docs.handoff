{"content":"---\ntitle: \"Property Promotion Activity | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 802196b7-1159-4c05-b41b-d3bfdfcc88d9\ncaps.latest.revision: 6\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Property Promotion Activity\nThis sample provides an end-to-end solution that integrates the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> Promotion feature directly into the workflow authoring experience. A collection of configuration elements, workflow activities, and workflow extensions that simplify the use of the Promotion feature are provided. Additionally, the sample contains a simple workflow that demonstrates how to use this collection.  \n  \n> [!NOTE]\n>  Samples are provided for educational purposes only. They are not intended for a production environment, and have not been tested in a production environment. Microsoft does not provide technical support for these samples.  \n  \n## Prerequisites  \n  \n-   An initialized <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> database  \n  \n-   [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]  \n  \n## Sample Projects  \n  \n-   The **PropertyPromotionActivity** project contains files pertaining to the promotion-specific configuration elements, workflow activities, and workflow extensions.  \n  \n-   The **CounterServiceApplication** project contains a sample workflow that uses the **SqlWorkflowInstanceStorePromotion** project.  \n  \n-   A SQL script (PropertyPromotionActivitySQLSample.sql) that must be run against the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> database.  \n  \n-   A solution file that links the two [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] projects (`PropertyPromotionActivity.sln`)  \n  \n## To set up and run the sample  \n  \n1.  Initialize a workflow persistence database.  \n  \n    1.  Navigate to the sample directory (\\WF\\Basic\\Persistence\\PropertyPromotionActivity) and run CreateInstanceStore.cmd.  \n  \n    2.  If Administrator privileges are not available, create a SQL Server login. In SQL Server Management Studio, go to **Security**, **Logins**. Right-click **Logins** and create a new login. Add your ACL user to the SQL role by opening **Databases**, **InstanceStore**, **Security**. Right-click **Users** and select **New user**. Set the **Login name** to the user created above. Add the user to the Database role membership System.Activities.DurableInstancing.InstanceStoreUsers (and others). Note that the user might exist already (for example, user dbo).  \n  \n2.  Open the PropertyPromotionActivity.sln solution file in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].  \n  \n3.  If you created the instance store in a database other than a local installation of SQL Server Express, then you must update the database connection string. Alter the App.config file under the **CounterServiceApplication** by setting the value of the `connectionString` attribute on the `sqlWorkflowInstanceStorePromotion` node so that it points to the persistence database that was initialized in step 1.  \n  \n4.  Build and run the solution. This will start the Counter WF service and automatically start a workflow instance.  \n  \n5.  Quickly select all the rows in the [dbo].[CounterService] view in your persistence database (this view was added by running CreateInstanceStore.cmd in step 1). You will see a result set similar to the following:  \n  \n    |InstanceId|CounterValue|CounterValueLastUpdated|  \n    |----------------|------------------|-----------------------------|  \n    |2FA2C302-929E-4C0D-8C25-768A3DA20CE5|12|2010-02-18 22:48:01.740|  \n  \n     As you keep refreshing the view, you will notice that CounterValue and CounterValueLastUpdated change every two seconds. This is the interval at which the counter updates itself. CounterValue and CounterValueLastUpdated represent promoted properties for this workflow.  \n  \n## To remove the sample  \n  \n-   Run RemoveInstanceStore.cmd in the sample directory (\\WF\\Basic\\Persistence\\PropertyPromotionActivity).  \n  \n## Understanding This Sample  \n The sample contains two projects and an SQL file:  \n  \n-   **CounterServiceApplication** is a console application that hosts a simple Counter WF service. Upon receiving a one-way message through the `Start` endpoint, the workflow counts from 0 to 29, incrementing a counter variable every two seconds. After every counter increment, the workflow persists, and the promoted properties are updated in the [dbo].[CounterService] view. When the console application is run, it hosts the WF service and sends a message to the `Start` endpoint, creating a Counter WF instance.  \n  \n-   **PropertyPromotionActivity** is a class library that contains the configuration elements, workflow activities, and workflow extensions that the **CounterServiceApplication** uses.  \n  \n-   **PropertyPromotionActivitySQLSample.sql** creates and adds the view [dbo].[CounterService] to the database.  \n  \n### CounterServiceApplication  \n  \n#### Using the SqlWorkflowInstanceStorePromotion Configuration Element  \n The `SqlWorkflowInstanceStorePromotion` configuration element inherits from the `SqlWorkflowInstanceStore` configuration element, but adds an additional configuration element called `promotionSets`. The `promotionSets` element enables the user to specify promoted properties through configuration. This is the configuration file that is used by the sample:  \n  \n```xml  \n<sqlWorkflowInstanceStorePromotion connectionString =\"Data Source=.;Initial Catalog=SqlWorkflowInstanceStoreTest;Integrated Security=True;\">  \n  <promotionSets>  \n    <promotionSet name=\"CounterService\">  \n      <promotedValue propertyName=\"Count\"/>  \n      <promotedValue propertyName=\"LastIncrementedAt\"/>  \n    </promotionSet>  \n  </promotionSets>  \n</sqlWorkflowInstanceStorePromotion>  \n```  \n  \n Examine the definition for the [dbo].[CounterService] view.  \n  \n```sql  \ncreate view [dbo].[CounterService] as  \n      select [InstanceId],  \n [Value1] as [CounterValue],  \n [Value2] as [CounterValueLastUpdated]  \n      from [System.Activities.DurableInstancing].[InstancePromotedProperties]  \n      where [PromotionName] = 'CounterService'  \ngo  \n  \n```  \n  \n When a workflow instance persists, a row is inserted into the `InstancePromotedProperties` view for each `PromotionSet` defined in the configuration. This row contains all the promoted properties of the `PromotionSet` (one promoted property per column). This `PromotionSet` is keyed by the tuple: `InstanceId, PromotionName`. In this sample, we have one `PromotionSet` defined in configuration whose name attribute is `CounterService`. Note how the `PromotionName` column value is equal to the name attribute of the `PromotionSet` element.  \n  \n The order of the `promotedValue` elements correlates with the placement of the promoted properties in the `InstancePromotedProperties` view. `Count` is the first `promotedValue` element. As a result, it is mapped to the `Value1` column in the `InstancePromotedProperties` view. `LastIncrementedAt` is the second `promotedValue` element. As a result, it is mapped to the `Value2` column in the `InstancePromotedProperties` view.  \n  \n#### Using the PromoteValue Activity  \n Examine the CounterService.xamlx file in the [!INCLUDE[wf2](../../../../includes/wf2-md.md)] Designer. Notice that there are two special activities in the WF definition: `PromoteValue<DateTime>` and `PromoteValue<Int32>`.  \n  \n The `PromoteValue<Int32>` activity has its `Name` member defined as `Count`. This matches with the first `promotedValue` element in the configuration, and has its `Value` defined as the `Counter` workflow variable. When the workflow persists, the `Counter` workflow variable is persisted as a promoted property into the `Value1` column of the `InstancePromotedProperties` view.  \n  \n The `PromoteValue<DateTime>` activity has its `Name` member defined as `LastIncrementedAt`. This matches with the second `promotedValue` element in the configuration, and has its `Value` defined as the `TimeLastIncremented` workflow variable. This means that when the workflow persists, the value for the `TimeLastIncremented` workflow variable will be persisted as a promoted property into the `Value2` column of the `InstancePromotedProperties` view.  \n  \n Note that the `PromotedValue` activity also has a Boolean member called `ClearExistingPromotedData`. When this member is set to `true`, this clears all the promoted property values up to that point in the workflow. For example, if a Sequence activity is defined as follows:  \n  \n1.  PromoteValue { Name = \"Count\", Value = 3}  \n  \n2.  PromoteValue {Name = \"LastIncrementedAt\", Value = 1-1-2000 }  \n  \n3.  Persist  \n  \n4.  PromoteValue {Name = \"Count\", Value = 4, ClearExistingPromotedData = true}  \n  \n5.  Persist  \n  \n On the second persist, the promoted value for `Count` will be 4. However, the promoted value for `LastIncrementedAt` will be `NULL`. If `ClearExistingPromotedData` was not set to `true` for step 4, then after the second persist, the promoted value for Count would be 4. As a result, the promoted value for `LastIncrementedAt` would still be 1-1-2000.  \n  \n### PropertyPromotionActivity  \n This class library contains the following public classes to simplify use of the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> Promotion feature.  \n  \n#### PromoteValue Class  \n This class promotes one property. The name of the promoted property should match a name attribute of a `promotedValue` element in the configuration. This activity can be used in the Workflow Designer. See the CounterServiceApplication for an example usage.  \n  \n```csharp  \npublic class PromoteValue<T> : CodeActivity  \n{  \n    public PromoteValue()  \n    {  \n    }  \n  \n    public bool ClearExistingPromotedData { get; set; }  \n    public string Name { get; set; }  \n    public InArgument<T> Value { get; set; }  \n}  \n  \n```  \n  \n ClearExistingPromotedData (Bool)  \n Clears all values that were promoted before this activity.  \n  \n Name (string)  \n The name that represents this property. This should match the name attribute of a \\<promotedValue> element in the configuration.  \n  \n Value (InArgument\\<T>)  \n The variable / value that you want to store in the column.  \n  \n#### PromoteValues Class  \n Promotes multiple properties. The names of the promoted properties should match all name attributes in the `promotedValue` elements in the configuration. Usage is similar to the `PromoteValue` activity, except for the fact that multiple properties can be promoted at the same time. This activity cannot be used in the Workflow Designer.  \n  \n```  \npublic class PromoteValues : CodeActivity  \n{  \n    public PromoteValues()  \n    {  \n        this.ValuesToPromote = new Dictionary<string, InArgument>();  \n    }  \n  \n    public bool ClearExistingPromotedData { get; set; }  \n    public IDictionary<string, InArgument> ValuesToPromote { get; set; }  \n}  \n```  \n  \n#### SqlWorkflowInstanceStorePromotionBehavior  \n Derives from `SqlWorkflowInstanceStoreBehavior`. This derived class adds a custom persistence participant (also a part of this library) as a workflow extension. The implementation of the previous two workflow activities relies on this custom persistence participant.  \n  \n```  \npublic class SqlWorkflowInstanceStorePromotionBehavior :  \n             SqlWorkflowInstanceStoreBehavior, IServiceBehavior  \n{  \n        public void Promote(string name, IEnumerable<string> promoteAsSqlVariant,  \n                            IEnumerable<string> promoteAsBinary)  \n  \n}  \n  \n```  \n  \n This class library also contains the `ConfigurationElement` implementation for the `SqlWorkflowInstanceStorePromotionElement` and a custom persistence participant used by the previous promotion activities.  \n  \n### PropertyPromotionActivitySQLSample  \n This SQL file creates a `[dbo].[CounterService]` view in addition to the `[InstancePromotedProperties]` view for querying all instances that have a CounterService Promotion set.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your computer. Check for the following (default) directory before continuing:  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory:  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Basic\\Persistence\\PropertyPromotionActivity`  \n  \n## See Also  \n [AppFabric Hosting and Persistence Samples](http://go.microsoft.com/fwlink/?LinkId=193961)","nodes":[{"pos":[12,56],"content":"Property Promotion Activity | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Property Promotion Activity | Microsoft Docs","pos":[0,44]}]},{"pos":[321,348],"content":"Property Promotion Activity","linkify":"Property Promotion Activity","nodes":[{"content":"Property Promotion Activity","pos":[0,27]}]},{"content":"This sample provides an end-to-end solution that integrates the <ph id=\"ph1\">&lt;xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore&gt;</ph> Promotion feature directly into the workflow authoring experience.","pos":[349,547],"source":"This sample provides an end-to-end solution that integrates the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> Promotion feature directly into the workflow authoring experience."},{"content":"A collection of configuration elements, workflow activities, and workflow extensions that simplify the use of the Promotion feature are provided.","pos":[548,693]},{"content":"Additionally, the sample contains a simple workflow that demonstrates how to use this collection.","pos":[694,791]},{"pos":[799,1031],"content":"[!NOTE]\n Samples are provided for educational purposes only. They are not intended for a production environment, and have not been tested in a production environment. Microsoft does not provide technical support for these samples.","leadings":["","> "],"nodes":[{"content":" Samples are provided for educational purposes only. They are not intended for a production environment, and have not been tested in a production environment. Microsoft does not provide technical support for these samples.","pos":[8,230],"nodes":[{"content":"Samples are provided for educational purposes only.","pos":[1,52]},{"content":"They are not intended for a production environment, and have not been tested in a production environment.","pos":[53,158]},{"content":"Microsoft does not provide technical support for these samples.","pos":[159,222]}]}]},{"pos":[1040,1053],"content":"Prerequisites","linkify":"Prerequisites","nodes":[{"content":"Prerequisites","pos":[0,13]}]},{"content":"An initialized <ph id=\"ph1\">&lt;xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore&gt;</ph> database","pos":[1063,1154],"source":"An initialized <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> database"},{"pos":[1226,1241],"content":"Sample Projects","linkify":"Sample Projects","nodes":[{"content":"Sample Projects","pos":[0,15]}]},{"pos":[1251,1414],"content":"The <bpt id=\"p1\">**</bpt>PropertyPromotionActivity<ept id=\"p1\">**</ept> project contains files pertaining to the promotion-specific configuration elements, workflow activities, and workflow extensions.","source":"The **PropertyPromotionActivity** project contains files pertaining to the promotion-specific configuration elements, workflow activities, and workflow extensions."},{"pos":[1424,1553],"content":"The <bpt id=\"p1\">**</bpt>CounterServiceApplication<ept id=\"p1\">**</ept> project contains a sample workflow that uses the <bpt id=\"p2\">**</bpt>SqlWorkflowInstanceStorePromotion<ept id=\"p2\">**</ept> project.","source":"The **CounterServiceApplication** project contains a sample workflow that uses the **SqlWorkflowInstanceStorePromotion** project."},{"content":"A SQL script (PropertyPromotionActivitySQLSample.sql) that must be run against the <ph id=\"ph1\">&lt;xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore&gt;</ph> database.","pos":[1563,1723],"source":"A SQL script (PropertyPromotionActivitySQLSample.sql) that must be run against the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> database."},{"pos":[1733,1864],"content":"A solution file that links the two <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph> projects (<ph id=\"ph2\">`PropertyPromotionActivity.sln`</ph>)","source":"A solution file that links the two [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] projects (`PropertyPromotionActivity.sln`)"},{"pos":[1873,1901],"content":"To set up and run the sample","linkify":"To set up and run the sample","nodes":[{"content":"To set up and run the sample","pos":[0,28]}]},{"content":"Initialize a workflow persistence database.","pos":[1911,1954]},{"content":"Navigate to the sample directory (\\WF\\Basic\\Persistence\\PropertyPromotionActivity) and run CreateInstanceStore.cmd.","pos":[1968,2083]},{"content":"If Administrator privileges are not available, create a SQL Server login.","pos":[2097,2170]},{"content":"In SQL Server Management Studio, go to <bpt id=\"p1\">**</bpt>Security<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Logins<ept id=\"p2\">**</ept>.","pos":[2171,2235],"source":" In SQL Server Management Studio, go to **Security**, **Logins**."},{"content":"Right-click <bpt id=\"p1\">**</bpt>Logins<ept id=\"p1\">**</ept> and create a new login.","pos":[2236,2282],"source":" Right-click **Logins** and create a new login."},{"content":"Add your ACL user to the SQL role by opening <bpt id=\"p1\">**</bpt>Databases<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>InstanceStore<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Security<ept id=\"p3\">**</ept>.","pos":[2283,2375],"source":" Add your ACL user to the SQL role by opening **Databases**, **InstanceStore**, **Security**."},{"content":"Right-click <bpt id=\"p1\">**</bpt>Users<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>New user<ept id=\"p2\">**</ept>.","pos":[2376,2422],"source":" Right-click **Users** and select **New user**."},{"content":"Set the <bpt id=\"p1\">**</bpt>Login name<ept id=\"p1\">**</ept> to the user created above.","pos":[2423,2472],"source":" Set the **Login name** to the user created above."},{"content":"Add the user to the Database role membership System.Activities.DurableInstancing.InstanceStoreUsers (and others).","pos":[2473,2586]},{"content":"Note that the user might exist already (for example, user dbo).","pos":[2587,2650]},{"pos":[2660,2770],"content":"Open the PropertyPromotionActivity.sln solution file in <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph>.","source":"Open the PropertyPromotionActivity.sln solution file in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]."},{"content":"If you created the instance store in a database other than a local installation of SQL Server Express, then you must update the database connection string.","pos":[2780,2935]},{"content":"Alter the App.config file under the <bpt id=\"p1\">**</bpt>CounterServiceApplication<ept id=\"p1\">**</ept> by setting the value of the <ph id=\"ph1\">`connectionString`</ph> attribute on the <ph id=\"ph2\">`sqlWorkflowInstanceStorePromotion`</ph> node so that it points to the persistence database that was initialized in step 1.","pos":[2936,3184],"source":" Alter the App.config file under the **CounterServiceApplication** by setting the value of the `connectionString` attribute on the `sqlWorkflowInstanceStorePromotion` node so that it points to the persistence database that was initialized in step 1."},{"content":"Build and run the solution.","pos":[3194,3221]},{"content":"This will start the Counter WF service and automatically start a workflow instance.","pos":[3222,3305]},{"content":"Quickly select all the rows in the [dbo].[CounterService] view in your persistence database (this view was added by running CreateInstanceStore.cmd in step 1).","pos":[3315,3474]},{"content":"You will see a result set similar to the following:","pos":[3475,3526]},{"content":"InstanceId","pos":[3537,3547]},{"content":"CounterValue","pos":[3548,3560]},{"content":"CounterValueLastUpdated","pos":[3561,3584]},{"content":"2FA2C302-929E-4C0D-8C25-768A3DA20CE5","pos":[3667,3703]},{"content":"12","pos":[3704,3706]},{"content":"2010-02-18 22:48:01.740","pos":[3707,3730]},{"content":"As you keep refreshing the view, you will notice that CounterValue and CounterValueLastUpdated change every two seconds.","pos":[3742,3862]},{"content":"This is the interval at which the counter updates itself.","pos":[3863,3920]},{"content":"CounterValue and CounterValueLastUpdated represent promoted properties for this workflow.","pos":[3921,4010]},{"pos":[4019,4039],"content":"To remove the sample","linkify":"To remove the sample","nodes":[{"content":"To remove the sample","pos":[0,20]}]},{"content":"Run RemoveInstanceStore.cmd in the sample directory (\\WF\\Basic\\Persistence\\PropertyPromotionActivity).","pos":[4049,4151]},{"pos":[4160,4185],"content":"Understanding This Sample","linkify":"Understanding This Sample","nodes":[{"content":"Understanding This Sample","pos":[0,25]}]},{"content":"The sample contains two projects and an SQL file:","pos":[4189,4238]},{"content":"<bpt id=\"p1\">**</bpt>CounterServiceApplication<ept id=\"p1\">**</ept> is a console application that hosts a simple Counter WF service.","pos":[4248,4342],"source":"**CounterServiceApplication** is a console application that hosts a simple Counter WF service."},{"content":"Upon receiving a one-way message through the <ph id=\"ph1\">`Start`</ph> endpoint, the workflow counts from 0 to 29, incrementing a counter variable every two seconds.","pos":[4343,4490],"source":" Upon receiving a one-way message through the `Start` endpoint, the workflow counts from 0 to 29, incrementing a counter variable every two seconds."},{"content":"After every counter increment, the workflow persists, and the promoted properties are updated in the [dbo].[CounterService] view.","pos":[4491,4620]},{"content":"When the console application is run, it hosts the WF service and sends a message to the <ph id=\"ph1\">`Start`</ph> endpoint, creating a Counter WF instance.","pos":[4621,4758],"source":" When the console application is run, it hosts the WF service and sends a message to the `Start` endpoint, creating a Counter WF instance."},{"pos":[4768,4948],"content":"<bpt id=\"p1\">**</bpt>PropertyPromotionActivity<ept id=\"p1\">**</ept> is a class library that contains the configuration elements, workflow activities, and workflow extensions that the <bpt id=\"p2\">**</bpt>CounterServiceApplication<ept id=\"p2\">**</ept> uses.","source":"**PropertyPromotionActivity** is a class library that contains the configuration elements, workflow activities, and workflow extensions that the **CounterServiceApplication** uses."},{"pos":[4958,5066],"content":"<bpt id=\"p1\">**</bpt>PropertyPromotionActivitySQLSample.sql<ept id=\"p1\">**</ept> creates and adds the view [dbo].[CounterService] to the database.","source":"**PropertyPromotionActivitySQLSample.sql** creates and adds the view [dbo].[CounterService] to the database."},{"pos":[5076,5101],"content":"CounterServiceApplication","linkify":"CounterServiceApplication","nodes":[{"content":"CounterServiceApplication","pos":[0,25]}]},{"pos":[5112,5177],"content":"Using the SqlWorkflowInstanceStorePromotion Configuration Element","linkify":"Using the SqlWorkflowInstanceStorePromotion Configuration Element","nodes":[{"content":"Using the SqlWorkflowInstanceStorePromotion Configuration Element","pos":[0,65]}]},{"content":"The <ph id=\"ph1\">`SqlWorkflowInstanceStorePromotion`</ph> configuration element inherits from the <ph id=\"ph2\">`SqlWorkflowInstanceStore`</ph> configuration element, but adds an additional configuration element called <ph id=\"ph3\">`promotionSets`</ph>.","pos":[5181,5379],"source":"The `SqlWorkflowInstanceStorePromotion` configuration element inherits from the `SqlWorkflowInstanceStore` configuration element, but adds an additional configuration element called `promotionSets`."},{"content":"The <ph id=\"ph1\">`promotionSets`</ph> element enables the user to specify promoted properties through configuration.","pos":[5380,5478],"source":" The `promotionSets` element enables the user to specify promoted properties through configuration."},{"content":"This is the configuration file that is used by the sample:","pos":[5479,5537]},{"content":"Examine the definition for the [dbo].[CounterService] view.","pos":[5954,6013]},{"content":"When a workflow instance persists, a row is inserted into the <ph id=\"ph1\">`InstancePromotedProperties`</ph> view for each <ph id=\"ph2\">`PromotionSet`</ph> defined in the configuration.","pos":[6316,6465],"source":"When a workflow instance persists, a row is inserted into the `InstancePromotedProperties` view for each `PromotionSet` defined in the configuration."},{"content":"This row contains all the promoted properties of the <ph id=\"ph1\">`PromotionSet`</ph> (one promoted property per column).","pos":[6466,6569],"source":" This row contains all the promoted properties of the `PromotionSet` (one promoted property per column)."},{"content":"This <ph id=\"ph1\">`PromotionSet`</ph> is keyed by the tuple: <ph id=\"ph2\">`InstanceId, PromotionName`</ph>.","pos":[6570,6641],"source":" This `PromotionSet` is keyed by the tuple: `InstanceId, PromotionName`."},{"content":"In this sample, we have one <ph id=\"ph1\">`PromotionSet`</ph> defined in configuration whose name attribute is <ph id=\"ph2\">`CounterService`</ph>.","pos":[6642,6751],"source":" In this sample, we have one `PromotionSet` defined in configuration whose name attribute is `CounterService`."},{"content":"Note how the <ph id=\"ph1\">`PromotionName`</ph> column value is equal to the name attribute of the <ph id=\"ph2\">`PromotionSet`</ph> element.","pos":[6752,6855],"source":" Note how the `PromotionName` column value is equal to the name attribute of the `PromotionSet` element."},{"content":"The order of the <ph id=\"ph1\">`promotedValue`</ph> elements correlates with the placement of the promoted properties in the <ph id=\"ph2\">`InstancePromotedProperties`</ph> view.","pos":[6862,7002],"source":"The order of the `promotedValue` elements correlates with the placement of the promoted properties in the `InstancePromotedProperties` view."},{"content":"<ph id=\"ph1\">`Count`</ph> is the first <ph id=\"ph2\">`promotedValue`</ph> element.","pos":[7003,7048],"source":"`Count` is the first `promotedValue` element."},{"content":"As a result, it is mapped to the <ph id=\"ph1\">`Value1`</ph> column in the <ph id=\"ph2\">`InstancePromotedProperties`</ph> view.","pos":[7049,7139],"source":" As a result, it is mapped to the `Value1` column in the `InstancePromotedProperties` view."},{"content":"<ph id=\"ph1\">`LastIncrementedAt`</ph> is the second <ph id=\"ph2\">`promotedValue`</ph> element.","pos":[7140,7198],"source":"`LastIncrementedAt` is the second `promotedValue` element."},{"content":"As a result, it is mapped to the <ph id=\"ph1\">`Value2`</ph> column in the <ph id=\"ph2\">`InstancePromotedProperties`</ph> view.","pos":[7199,7289],"source":" As a result, it is mapped to the `Value2` column in the `InstancePromotedProperties` view."},{"pos":[7300,7331],"content":"Using the PromoteValue Activity","linkify":"Using the PromoteValue Activity","nodes":[{"content":"Using the PromoteValue Activity","pos":[0,31]}]},{"content":"Examine the CounterService.xamlx file in the <ph id=\"ph1\">[!INCLUDE[wf2](../../../../includes/wf2-md.md)]</ph> Designer.","pos":[7335,7437],"source":"Examine the CounterService.xamlx file in the [!INCLUDE[wf2](../../../../includes/wf2-md.md)] Designer."},{"content":"Notice that there are two special activities in the WF definition: <ph id=\"ph1\">`PromoteValue&lt;DateTime&gt;`</ph> and <ph id=\"ph2\">`PromoteValue&lt;Int32&gt;`</ph>.","pos":[7438,7556],"source":" Notice that there are two special activities in the WF definition: `PromoteValue<DateTime>` and `PromoteValue<Int32>`."},{"content":"The <ph id=\"ph1\">`PromoteValue&lt;Int32&gt;`</ph> activity has its <ph id=\"ph2\">`Name`</ph> member defined as <ph id=\"ph3\">`Count`</ph>.","pos":[7563,7639],"source":"The `PromoteValue<Int32>` activity has its `Name` member defined as `Count`."},{"content":"This matches with the first <ph id=\"ph1\">`promotedValue`</ph> element in the configuration, and has its <ph id=\"ph2\">`Value`</ph> defined as the <ph id=\"ph3\">`Counter`</ph> workflow variable.","pos":[7640,7777],"source":" This matches with the first `promotedValue` element in the configuration, and has its `Value` defined as the `Counter` workflow variable."},{"content":"When the workflow persists, the <ph id=\"ph1\">`Counter`</ph> workflow variable is persisted as a promoted property into the <ph id=\"ph2\">`Value1`</ph> column of the <ph id=\"ph3\">`InstancePromotedProperties`</ph> view.","pos":[7778,7940],"source":" When the workflow persists, the `Counter` workflow variable is persisted as a promoted property into the `Value1` column of the `InstancePromotedProperties` view."},{"content":"The <ph id=\"ph1\">`PromoteValue&lt;DateTime&gt;`</ph> activity has its <ph id=\"ph2\">`Name`</ph> member defined as <ph id=\"ph3\">`LastIncrementedAt`</ph>.","pos":[7947,8038],"source":"The `PromoteValue<DateTime>` activity has its `Name` member defined as `LastIncrementedAt`."},{"content":"This matches with the second <ph id=\"ph1\">`promotedValue`</ph> element in the configuration, and has its <ph id=\"ph2\">`Value`</ph> defined as the <ph id=\"ph3\">`TimeLastIncremented`</ph> workflow variable.","pos":[8039,8189],"source":" This matches with the second `promotedValue` element in the configuration, and has its `Value` defined as the `TimeLastIncremented` workflow variable."},{"content":"This means that when the workflow persists, the value for the <ph id=\"ph1\">`TimeLastIncremented`</ph> workflow variable will be persisted as a promoted property into the <ph id=\"ph2\">`Value2`</ph> column of the <ph id=\"ph3\">`InstancePromotedProperties`</ph> view.","pos":[8190,8399],"source":" This means that when the workflow persists, the value for the `TimeLastIncremented` workflow variable will be persisted as a promoted property into the `Value2` column of the `InstancePromotedProperties` view."},{"content":"Note that the <ph id=\"ph1\">`PromotedValue`</ph> activity also has a Boolean member called <ph id=\"ph2\">`ClearExistingPromotedData`</ph>.","pos":[8406,8506],"source":"Note that the `PromotedValue` activity also has a Boolean member called `ClearExistingPromotedData`."},{"content":"When this member is set to <ph id=\"ph1\">`true`</ph>, this clears all the promoted property values up to that point in the workflow.","pos":[8507,8620],"source":" When this member is set to `true`, this clears all the promoted property values up to that point in the workflow."},{"content":"For example, if a Sequence activity is defined as follows:","pos":[8621,8679]},{"content":"PromoteValue { Name = \"Count\", Value = 3}","pos":[8689,8730]},{"content":"PromoteValue {Name = \"LastIncrementedAt\", Value = 1-1-2000 }","pos":[8740,8800]},{"content":"Persist","pos":[8810,8817]},{"content":"PromoteValue {Name = \"Count\", Value = 4, ClearExistingPromotedData = true}","pos":[8827,8901]},{"content":"Persist","pos":[8911,8918]},{"content":"On the second persist, the promoted value for <ph id=\"ph1\">`Count`</ph> will be 4.","pos":[8925,8989],"source":"On the second persist, the promoted value for `Count` will be 4."},{"content":"However, the promoted value for <ph id=\"ph1\">`LastIncrementedAt`</ph> will be <ph id=\"ph2\">`NULL`</ph>.","pos":[8990,9057],"source":" However, the promoted value for `LastIncrementedAt` will be `NULL`."},{"content":"If <ph id=\"ph1\">`ClearExistingPromotedData`</ph> was not set to <ph id=\"ph2\">`true`</ph> for step 4, then after the second persist, the promoted value for Count would be 4.","pos":[9058,9194],"source":" If `ClearExistingPromotedData` was not set to `true` for step 4, then after the second persist, the promoted value for Count would be 4."},{"content":"As a result, the promoted value for <ph id=\"ph1\">`LastIncrementedAt`</ph> would still be 1-1-2000.","pos":[9195,9275],"source":" As a result, the promoted value for `LastIncrementedAt` would still be 1-1-2000."},{"pos":[9285,9310],"content":"PropertyPromotionActivity","linkify":"PropertyPromotionActivity","nodes":[{"content":"PropertyPromotionActivity","pos":[0,25]}]},{"content":"This class library contains the following public classes to simplify use of the <ph id=\"ph1\">&lt;xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore&gt;</ph> Promotion feature.","pos":[9314,9480],"source":"This class library contains the following public classes to simplify use of the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> Promotion feature."},{"pos":[9491,9509],"content":"PromoteValue Class","linkify":"PromoteValue Class","nodes":[{"content":"PromoteValue Class","pos":[0,18]}]},{"content":"This class promotes one property.","pos":[9513,9546]},{"content":"The name of the promoted property should match a name attribute of a <ph id=\"ph1\">`promotedValue`</ph> element in the configuration.","pos":[9547,9661],"source":" The name of the promoted property should match a name attribute of a `promotedValue` element in the configuration."},{"content":"This activity can be used in the Workflow Designer.","pos":[9662,9713]},{"content":"See the CounterServiceApplication for an example usage.","pos":[9714,9769]},{"content":"ClearExistingPromotedData (Bool)","pos":[10045,10077]},{"content":"Clears all values that were promoted before this activity.","pos":[10081,10139]},{"content":"Name (string)","pos":[10146,10159]},{"content":"The name that represents this property.","pos":[10163,10202]},{"content":"This should match the name attribute of a <ph id=\"ph1\">\\&lt;</ph>promotedValue&gt; element in the configuration.","pos":[10203,10291],"source":" This should match the name attribute of a \\<promotedValue> element in the configuration."},{"content":"Value (InArgument<ph id=\"ph1\">\\&lt;</ph>T&gt;)","pos":[10298,10320],"source":"Value (InArgument\\<T>)"},{"content":"The variable / value that you want to store in the column.","pos":[10324,10382]},{"pos":[10393,10412],"content":"PromoteValues Class","linkify":"PromoteValues Class","nodes":[{"content":"PromoteValues Class","pos":[0,19]}]},{"content":"Promotes multiple properties.","pos":[10416,10445]},{"content":"The names of the promoted properties should match all name attributes in the <ph id=\"ph1\">`promotedValue`</ph> elements in the configuration.","pos":[10446,10569],"source":" The names of the promoted properties should match all name attributes in the `promotedValue` elements in the configuration."},{"content":"Usage is similar to the <ph id=\"ph1\">`PromoteValue`</ph> activity, except for the fact that multiple properties can be promoted at the same time.","pos":[10570,10697],"source":" Usage is similar to the `PromoteValue` activity, except for the fact that multiple properties can be promoted at the same time."},{"content":"This activity cannot be used in the Workflow Designer.","pos":[10698,10752]},{"pos":[11082,11123],"content":"SqlWorkflowInstanceStorePromotionBehavior","linkify":"SqlWorkflowInstanceStorePromotionBehavior","nodes":[{"content":"SqlWorkflowInstanceStorePromotionBehavior","pos":[0,41]}]},{"content":"Derives from <ph id=\"ph1\">`SqlWorkflowInstanceStoreBehavior`</ph>.","pos":[11127,11175],"source":"Derives from `SqlWorkflowInstanceStoreBehavior`."},{"content":"This derived class adds a custom persistence participant (also a part of this library) as a workflow extension.","pos":[11176,11287]},{"content":"The implementation of the previous two workflow activities relies on this custom persistence participant.","pos":[11288,11393]},{"pos":[11705,11910],"content":"This class library also contains the <ph id=\"ph1\">`ConfigurationElement`</ph> implementation for the <ph id=\"ph2\">`SqlWorkflowInstanceStorePromotionElement`</ph> and a custom persistence participant used by the previous promotion activities.","source":"This class library also contains the `ConfigurationElement` implementation for the `SqlWorkflowInstanceStorePromotionElement` and a custom persistence participant used by the previous promotion activities."},{"pos":[11920,11954],"content":"PropertyPromotionActivitySQLSample","linkify":"PropertyPromotionActivitySQLSample","nodes":[{"content":"PropertyPromotionActivitySQLSample","pos":[0,34]}]},{"pos":[11958,12135],"content":"This SQL file creates a <ph id=\"ph1\">`[dbo].[CounterService]`</ph> view in addition to the <ph id=\"ph2\">`[InstancePromotedProperties]`</ph> view for querying all instances that have a CounterService Promotion set.","source":"This SQL file creates a `[dbo].[CounterService]` view in addition to the `[InstancePromotedProperties]` view for querying all instances that have a CounterService Promotion set."},{"pos":[12143,12276],"content":"[!IMPORTANT]\n The samples may already be installed on your computer. Check for the following (default) directory before continuing:","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your computer. Check for the following (default) directory before continuing:","pos":[13,131],"nodes":[{"content":"The samples may already be installed on your computer.","pos":[1,55]},{"content":"Check for the following (default) directory before continuing:","pos":[56,118]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[12330,12656],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory:","pos":[12657,12707]},{"pos":[12806,12814],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[12818,12908],"content":"<bpt id=\"p1\">[</bpt>AppFabric Hosting and Persistence Samples<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=193961)</ept>","source":"[AppFabric Hosting and Persistence Samples](http://go.microsoft.com/fwlink/?LinkId=193961)"}]}