{"content":"---\ntitle: \"Circular Tracing\"\nms.date: \"03/30/2017\"\nms.assetid: 5ff139f9-8806-47bc-8f33-47fe6c436b92\n---\n# Circular Tracing\nThis sample demonstrates the implementation of a circular buffer trace listener. A common scenario for production services is to have services that are available for long periods of time and to have trace logging enabled at a low level. These services consume a lot of disk space. When troubleshooting a service, the most recent data in the trace log is relevant to solving a problem. This sample demonstrates an implementation of a circular buffer trace listener in which only the most recent traces are kept on disk up to a configurable amount of data. This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) and includes a custom tracing listener.  \n  \n> [!NOTE]\n>  The setup procedure and build instructions for this sample are located at the end of this topic.  \n  \n This sample assumes that you are familiar with the [Tracing and Message Logging](../../../../docs/framework/wcf/samples/tracing-and-message-logging.md) sample and have read the documentation provided for the [Tracing and Message Logging](../../../../docs/framework/wcf/samples/tracing-and-message-logging.md) sample.  \n  \n## Circular Buffer Trace Listener  \n The concept behind the implementation of the Circular Buffer Trace Listener is to have two files that can each store up to half of the total desired trace log data. The listener creates one file and writes to that file until it reaches the limit of half of the data size, at which point it switches to a second file. When the listener reaches the limit for the second file - it overwrites the first file with new traces.  \n  \n This listener derives from the `XmlWriteTraceListener` and allows the logs to be viewed with the [Service Trace Viewer Tool (SvcTraceViewer.exe)](../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md). When attempting to view the logs, the two log files can be easily recombined by opening both of the log files at the same time in the Service Trace Viewer tool. The Service Trace Viewer tool automatically takes care of sorting the traces so that they appear in the correct order.  \n  \n## Configuration  \n A service can be configured to use the Circular Buffer Trace Listener by adding the following code for a listener and source elements. The max file size is specified by setting the `maxFileSizeKB` attribute in the circular trace listener's configuration. This is demonstrated in the following code.  \n  \n```xml  \n<system.diagnostics>  \n  <sources>  \n    <source name=\"System.ServiceModel\" switchValue=\"Information,ActivityTracing\" propagateActivity=\"true\">  \n      <listeners>  \n        <add name=\"CircularTraceListener\" />  \n      </listeners>  \n    </source>  \n  </sources>  \n  <sharedListeners>  \n    <add name=\"CircularTraceListener\" type=\"Microsoft. Samples.ServiceModel.CircularTraceListener,CircularTraceListener\"   \n         initializeData=\"c:\\logs\\CircularTracing-service.svclog\" maxFileSizeKB=\"100\" />  \n  </sharedListeners>  \n  <trace autoflush=\"true\" />  \n</system.diagnostics>  \n```  \n  \n#### To set up, build, and run the sample  \n  \n1.  Be sure you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).  \n  \n2.  To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).  \n  \n3.  To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your computer. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Management\\CircularTracing`  \n  \n## See also\n\n- [AppFabric Monitoring Samples](https://go.microsoft.com/fwlink/?LinkId=193959)\n","nodes":[{"pos":[4,100],"embed":true,"restype":"x-metadata","content":"title: \"Circular Tracing\"\nms.date: \"03/30/2017\"\nms.assetid: 5ff139f9-8806-47bc-8f33-47fe6c436b92","nodes":[{"content":"Circular Tracing","nodes":[{"pos":[0,16],"content":"Circular Tracing","nodes":[{"content":"Circular Tracing","pos":[0,16]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[107,123],"content":"Circular Tracing","linkify":"Circular Tracing","nodes":[{"content":"Circular Tracing","pos":[0,16]}]},{"content":"This sample demonstrates the implementation of a circular buffer trace listener.","pos":[124,204]},{"content":"A common scenario for production services is to have services that are available for long periods of time and to have trace logging enabled at a low level.","pos":[205,360]},{"content":"These services consume a lot of disk space.","pos":[361,404]},{"content":"When troubleshooting a service, the most recent data in the trace log is relevant to solving a problem.","pos":[405,508]},{"content":"This sample demonstrates an implementation of a circular buffer trace listener in which only the most recent traces are kept on disk up to a configurable amount of data.","pos":[509,678]},{"content":"This sample is based on the <bpt id=\"p1\">[</bpt>Getting Started<ept id=\"p1\">](../../../../docs/framework/wcf/samples/getting-started-sample.md)</ept> and includes a custom tracing listener.","pos":[679,830],"source":" This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) and includes a custom tracing listener."},{"pos":[838,945],"content":"[!NOTE]\n The setup procedure and build instructions for this sample are located at the end of this topic.","leadings":["","> "],"nodes":[{"content":"The setup procedure and build instructions for this sample are located at the end of this topic.","pos":[9,105]}]},{"pos":[952,1268],"content":"This sample assumes that you are familiar with the <bpt id=\"p1\">[</bpt>Tracing and Message Logging<ept id=\"p1\">](../../../../docs/framework/wcf/samples/tracing-and-message-logging.md)</ept> sample and have read the documentation provided for the <bpt id=\"p2\">[</bpt>Tracing and Message Logging<ept id=\"p2\">](../../../../docs/framework/wcf/samples/tracing-and-message-logging.md)</ept> sample.","source":"This sample assumes that you are familiar with the [Tracing and Message Logging](../../../../docs/framework/wcf/samples/tracing-and-message-logging.md) sample and have read the documentation provided for the [Tracing and Message Logging](../../../../docs/framework/wcf/samples/tracing-and-message-logging.md) sample."},{"pos":[1277,1307],"content":"Circular Buffer Trace Listener","linkify":"Circular Buffer Trace Listener","nodes":[{"content":"Circular Buffer Trace Listener","pos":[0,30]}]},{"content":"The concept behind the implementation of the Circular Buffer Trace Listener is to have two files that can each store up to half of the total desired trace log data.","pos":[1311,1475]},{"content":"The listener creates one file and writes to that file until it reaches the limit of half of the data size, at which point it switches to a second file.","pos":[1476,1627]},{"content":"When the listener reaches the limit for the second file - it overwrites the first file with new traces.","pos":[1628,1731]},{"content":"This listener derives from the <ph id=\"ph1\">`XmlWriteTraceListener`</ph> and allows the logs to be viewed with the <bpt id=\"p1\">[</bpt>Service Trace Viewer Tool (SvcTraceViewer.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md)</ept>.","pos":[1738,1964],"source":"This listener derives from the `XmlWriteTraceListener` and allows the logs to be viewed with the [Service Trace Viewer Tool (SvcTraceViewer.exe)](../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md)."},{"content":"When attempting to view the logs, the two log files can be easily recombined by opening both of the log files at the same time in the Service Trace Viewer tool.","pos":[1965,2125]},{"content":"The Service Trace Viewer tool automatically takes care of sorting the traces so that they appear in the correct order.","pos":[2126,2244]},{"pos":[2253,2266],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"content":"A service can be configured to use the Circular Buffer Trace Listener by adding the following code for a listener and source elements.","pos":[2270,2404]},{"content":"The max file size is specified by setting the <ph id=\"ph1\">`maxFileSizeKB`</ph> attribute in the circular trace listener's configuration.","pos":[2405,2524],"source":" The max file size is specified by setting the `maxFileSizeKB` attribute in the circular trace listener's configuration."},{"content":"This is demonstrated in the following code.","pos":[2525,2568]},{"pos":[3176,3212],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[3222,3417],"content":"Be sure you have performed the <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Be sure you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"pos":[3427,3636],"content":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"pos":[3646,3855],"content":"To run the sample in a single- or cross-computer configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"pos":[3863,3996],"content":"[!IMPORTANT]\n The samples may already be installed on your computer. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your computer. Check for the following (default) directory before continuing.","pos":[14,131],"nodes":[{"content":"The samples may already be installed on your computer.","pos":[0,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[4050,4360],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[4361,4411]},{"pos":[4500,4508],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[4512,4590],"content":"<bpt id=\"p1\">[</bpt>AppFabric Monitoring Samples<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=193959)</ept>","source":"[AppFabric Monitoring Samples](https://go.microsoft.com/fwlink/?LinkId=193959)"}]}