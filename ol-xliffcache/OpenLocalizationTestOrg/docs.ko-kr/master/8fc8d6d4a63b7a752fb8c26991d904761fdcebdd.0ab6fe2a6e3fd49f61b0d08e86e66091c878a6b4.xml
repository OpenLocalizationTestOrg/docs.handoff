{"content":"---\ntitle: \"Message Security with Mutual Certificates\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 99d7a528-7ae4-4d39-a0f9-3066ea237de0\n---\n# Message Security with Mutual Certificates\nThe following scenario shows a Windows Communication Foundation (WCF) service and client secured using message security mode. The client and the service are authenticated with certificates.  \n  \n This scenario is interoperable because it uses WS-Security with the X.509 certificate token profile.  \n  \n> [!NOTE]\n>  This scenario does not perform negotiation of the service certificate. The service certificate must be provided to the client in advance of any communication. The server certificate can be distributed with the application or provided in an out-of-band communication.  \n  \n ![Message security with mutual certificates](../../../../docs/framework/wcf/feature-details/media/f4157312-b17c-416c-a5ee-fa7b54db211b.gif \"f4157312-b17c-416c-a5ee-fa7b54db211b\")  \n  \n|Characteristic|Description|  \n|--------------------|-----------------|  \n|Security Mode|Message|  \n|Interoperability|Yes, with WS-Security and X.509 certificate token profile compatible clients and services.|  \n|Authentication|Mutual authentication of the server and client.|  \n|Integrity|Yes|  \n|Confidentiality|Yes|  \n|Transport|HTTP|  \n|Binding|<xref:System.ServiceModel.WSHttpBinding>|  \n  \n## Service  \n The following code and configuration are meant to run independently. Do one of the following:  \n  \n-   Create a stand-alone service using the code with no configuration.  \n  \n-   Create a service using the supplied configuration, but do not define any endpoints.  \n  \n### Code  \n The following code shows creates a service endpoint that uses message security. The service requires a certificate to authenticate itself.  \n  \n [!code-csharp[C_SecurityScenarios#13](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#13)]\n [!code-vb[C_SecurityScenarios#13](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#13)]  \n  \n### Configuration  \n The following configuration can be used instead of the code to create the same service.  \n  \n```xml  \n<?xml version=\"1.0\" encoding=\"utf-8\"?>  \n<configuration>  \n  <system.serviceModel>  \n    <behaviors>  \n      <serviceBehaviors>  \n        <behavior name=\"serviceCredentialBehavior\">  \n          <serviceCredentials>  \n            <serviceCertificate findValue=\"Contoso.com\"   \n                                storeLocation=\"LocalMachine\"  \n                                storeName=\"My\"   \n                                x509FindType=\"FindBySubjectName\" />  \n          </serviceCredentials>  \n        </behavior>  \n      </serviceBehaviors>  \n    </behaviors>  \n    <services>  \n      <service behaviorConfiguration=\"serviceCredentialBehavior\"   \n               name=\"ServiceModel.Calculator\">  \n        <endpoint address=\"http://localhost/Calculator\"   \n                  binding=\"wsHttpBinding\"  \n                  bindingConfiguration=\"InteropCertificateBinding\"  \n                  name=\"WSHttpBinding_ICalculator\"  \n                  contract=\"ServiceModel.ICalculator\" />  \n      </service>  \n    </services>  \n    <bindings>  \n      <wsHttpBinding>  \n        <binding name=\"InteropCertificateBinding\">  \n          <security mode=\"Message\">  \n            <message clientCredentialType=\"Certificate\"  \n                     negotiateServiceCredential=\"false\"  \n                     establishSecurityContext=\"false\" />  \n          </security>  \n        </binding>  \n      </wsHttpBinding>  \n    </bindings>  \n    <client />  \n  </system.serviceModel>  \n</configuration>  \n```  \n  \n## Client  \n The following code and configuration are meant to run independently. Do one of the following:  \n  \n-   Create a stand-alone client using the code (and client code).  \n  \n-   Create a client that does not define any endpoint addresses. Instead, use the client constructor that takes the configuration name as an argument. For example:  \n  \n     [!code-csharp[C_SecurityScenarios#0](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#0)]\n     [!code-vb[C_SecurityScenarios#0](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#0)]  \n  \n### Code  \n The following code creates the client. The security mode is set to Message, and the client credential type is set to Certificate.  \n  \n [!code-csharp[C_SecurityScenarios#20](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#20)]\n [!code-vb[C_SecurityScenarios#20](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#20)]  \n  \n### Configuration  \n The following configures the client. A client certificate must be specified using the [\\<clientCertificate>](../../../../docs/framework/configure-apps/file-schema/wcf/clientcertificate-of-clientcredentials-element.md). Also, the service certificate is specified using the [\\<defaultCertificate>](../../../../docs/framework/configure-apps/file-schema/wcf/defaultcertificate-element.md).  \n  \n```xml  \n<?xml version=\"1.0\" encoding=\"utf-8\"?>  \n<configuration>  \n  <system.serviceModel>  \n    <behaviors>  \n      <endpointBehaviors>  \n        <behavior name=\"ClientCredentialsBehavior\">  \n          <clientCredentials>  \n            <clientCertificate findValue=\"Cohowinery.com\"   \n                 storeLocation=\"CurrentUser\"  \n                 storeName=\"My\"  \n                 x509FindType=\"FindBySubjectName\" />  \n            <serviceCertificate>  \n              <defaultCertificate findValue=\"Contoso.com\"   \n                                  storeLocation=\"CurrentUser\"  \n                                  storeName=\"TrustedPeople\"  \n                                  x509FindType=\"FindBySubjectName\" />  \n            </serviceCertificate>  \n          </clientCredentials>  \n        </behavior>  \n      </endpointBehaviors>  \n    </behaviors>  \n    <bindings>  \n      <wsHttpBinding>  \n        <binding name=\"WSHttpBinding_ICalculator\" >  \n          <security mode=\"Message\">  \n            <message clientCredentialType=\"Certificate\"   \n                     negotiateServiceCredential=\"false\"  \n                     establishSecurityContext=\"false\" />  \n          </security>  \n        </binding>  \n      </wsHttpBinding>  \n    </bindings>  \n    <client>  \n      <endpoint address=\"http://machineName/Calculator\"   \n                behaviorConfiguration=\"ClientCredentialsBehavior\"  \n                binding=\"wsHttpBinding\"   \n                bindingConfiguration=\"WSHttpBinding_ICalculator\"  \n                contract=\"ICalculator\"  \n                name=\"WSHttpBinding_ICalculator\">  \n        <identity>  \n          <certificate encodedValue=\"Encoded_Value_Not_Shown\" />  \n        </identity>  \n      </endpoint>  \n    </client>  \n  </system.serviceModel>  \n</configuration>  \n```  \n  \n## See also\n\n- [Security Overview](../../../../docs/framework/wcf/feature-details/security-overview.md)\n- [Security Model for Windows Server App Fabric](https://go.microsoft.com/fwlink/?LinkID=201279&clcid=0x409)\n- [How to: Create and Install Temporary Certificates in WCF for Transport Security During Development](https://go.microsoft.com/fwlink/?LinkId=244264)\n","nodes":[{"pos":[4,159],"embed":true,"restype":"x-metadata","content":"title: \"Message Security with Mutual Certificates\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 99d7a528-7ae4-4d39-a0f9-3066ea237de0","nodes":[{"content":"Message Security with Mutual Certificates","nodes":[{"pos":[0,41],"content":"Message Security with Mutual Certificates","nodes":[{"content":"Message Security with Mutual Certificates","pos":[0,41]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[166,207],"content":"Message Security with Mutual Certificates","linkify":"Message Security with Mutual Certificates","nodes":[{"content":"Message Security with Mutual Certificates","pos":[0,41]}]},{"content":"The following scenario shows a Windows Communication Foundation (WCF) service and client secured using message security mode.","pos":[208,333]},{"content":"The client and the service are authenticated with certificates.","pos":[334,397]},{"content":"This scenario is interoperable because it uses WS-Security with the X.509 certificate token profile.","pos":[404,504]},{"pos":[512,789],"content":"[!NOTE]\n This scenario does not perform negotiation of the service certificate. The service certificate must be provided to the client in advance of any communication. The server certificate can be distributed with the application or provided in an out-of-band communication.","leadings":["","> "],"nodes":[{"content":"This scenario does not perform negotiation of the service certificate. The service certificate must be provided to the client in advance of any communication. The server certificate can be distributed with the application or provided in an out-of-band communication.","pos":[9,275],"nodes":[{"content":"This scenario does not perform negotiation of the service certificate.","pos":[0,70]},{"content":"The service certificate must be provided to the client in advance of any communication.","pos":[71,158]},{"content":"The server certificate can be distributed with the application or provided in an out-of-band communication.","pos":[159,266]}]}]},{"pos":[796,974],"content":"<bpt id=\"p1\">![</bpt>Message security with mutual certificates<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wcf/feature-details/media/f4157312-b17c-416c-a5ee-fa7b54db211b.gif \"</bpt>f4157312-b17c-416c-a5ee-fa7b54db211b<ept id=\"p2\">\")</ept>","source":"![Message security with mutual certificates](../../../../docs/framework/wcf/feature-details/media/f4157312-b17c-416c-a5ee-fa7b54db211b.gif \"f4157312-b17c-416c-a5ee-fa7b54db211b\")"},{"content":"Characteristic","pos":[981,995]},{"content":"Description","pos":[996,1007]},{"content":"Security Mode","pos":[1055,1068]},{"content":"Message","pos":[1069,1076]},{"content":"Interoperability","pos":[1081,1097]},{"content":"Yes, with WS-Security and X.509 certificate token profile compatible clients and services.","pos":[1098,1188]},{"content":"Authentication","pos":[1193,1207]},{"content":"Mutual authentication of the server and client.","pos":[1208,1255]},{"content":"Integrity","pos":[1260,1269]},{"content":"Yes","pos":[1270,1273]},{"content":"Confidentiality","pos":[1278,1293]},{"content":"Yes","pos":[1294,1297]},{"content":"Transport","pos":[1302,1311]},{"content":"HTTP","pos":[1312,1316]},{"content":"Binding","pos":[1321,1328]},{"pos":[1379,1386],"content":"Service","linkify":"Service","nodes":[{"content":"Service","pos":[0,7]}]},{"content":"The following code and configuration are meant to run independently.","pos":[1390,1458]},{"content":"Do one of the following:","pos":[1459,1483]},{"content":"Create a stand-alone service using the code with no configuration.","pos":[1493,1559]},{"content":"Create a service using the supplied configuration, but do not define any endpoints.","pos":[1569,1652]},{"pos":[1662,1666],"content":"Code","linkify":"Code","nodes":[{"content":"Code","pos":[0,4]}]},{"content":"The following code shows creates a service endpoint that uses message security.","pos":[1670,1749]},{"content":"The service requires a certificate to authenticate itself.","pos":[1750,1808]},{"pos":[2082,2095],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"content":"The following configuration can be used instead of the code to create the same service.","pos":[2099,2186]},{"pos":[3688,3694],"content":"Client","linkify":"Client","nodes":[{"content":"Client","pos":[0,6]}]},{"content":"The following code and configuration are meant to run independently.","pos":[3698,3766]},{"content":"Do one of the following:","pos":[3767,3791]},{"content":"Create a stand-alone client using the code (and client code).","pos":[3801,3862]},{"content":"Create a client that does not define any endpoint addresses.","pos":[3872,3932]},{"content":"Instead, use the client constructor that takes the configuration name as an argument.","pos":[3933,4018]},{"content":"For example:","pos":[4019,4031]},{"pos":[4042,4299],"content":"[!code-csharp[C_SecurityScenarios#0](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securityscenarios/cs/source.cs#0)]\n [!code-vb[C_SecurityScenarios#0](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securityscenarios/vb/source.vb#0)]","leadings":["","    "],"nodes":[]},{"pos":[4309,4313],"content":"Code","linkify":"Code","nodes":[{"content":"Code","pos":[0,4]}]},{"content":"The following code creates the client.","pos":[4317,4355]},{"content":"The security mode is set to Message, and the client credential type is set to Certificate.","pos":[4356,4446]},{"pos":[4720,4733],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"content":"The following configures the client.","pos":[4737,4773]},{"content":"A client certificate must be specified using the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>clientCertificate&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/clientcertificate-of-clientcredentials-element.md)</ept>.","pos":[4774,4955],"source":" A client certificate must be specified using the [\\<clientCertificate>](../../../../docs/framework/configure-apps/file-schema/wcf/clientcertificate-of-clientcredentials-element.md)."},{"content":"Also, the service certificate is specified using the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>defaultCertificate&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/defaultcertificate-element.md)</ept>.","pos":[4956,5122],"source":" Also, the service certificate is specified using the [\\<defaultCertificate>](../../../../docs/framework/configure-apps/file-schema/wcf/defaultcertificate-element.md)."},{"pos":[6930,6938],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6942,7030],"content":"<bpt id=\"p1\">[</bpt>Security Overview<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/security-overview.md)</ept>","source":"[Security Overview](../../../../docs/framework/wcf/feature-details/security-overview.md)"},{"pos":[7033,7139],"content":"<bpt id=\"p1\">[</bpt>Security Model for Windows Server App Fabric<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkID=201279&amp;clcid=0x409)</ept>","source":"[Security Model for Windows Server App Fabric](https://go.microsoft.com/fwlink/?LinkID=201279&clcid=0x409)"},{"pos":[7142,7290],"content":"<bpt id=\"p1\">[</bpt>How to: Create and Install Temporary Certificates in WCF for Transport Security During Development<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=244264)</ept>","source":"[How to: Create and Install Temporary Certificates in WCF for Transport Security During Development](https://go.microsoft.com/fwlink/?LinkId=244264)"}]}