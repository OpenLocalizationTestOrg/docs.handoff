{"content":"---\ntitle: \"How to: Create Signed Friend Assemblies (C#)\"\nms.date: 07/20/2015\nms.assetid: bab62063-61e6-453f-905f-77673df9534e\n---\n# How to: Create Signed Friend Assemblies (C#)\nThis example shows how to use friend assemblies with assemblies that have strong names. Both assemblies must be strong named. Although both assemblies in this example use the same keys, you could use different keys for two assemblies.  \n  \n### To create a signed assembly and a friend assembly  \n  \n1.  Open a command prompt.  \n  \n2.  Use the following sequence of commands with the Strong Name tool to generate a keyfile and to display its public key. For more information, see [Sn.exe (Strong Name Tool)](../../../../framework/tools/sn-exe-strong-name-tool.md).  \n  \n    1.  Generate a strong-name key for this example and store it in the file FriendAssemblies.snk:  \n  \n         `sn -k FriendAssemblies.snk`  \n  \n    2.  Extract the public key from FriendAssemblies.snk and put it into FriendAssemblies.publickey:  \n  \n         `sn -p FriendAssemblies.snk FriendAssemblies.publickey`  \n  \n    3.  Display the public key stored in the file FriendAssemblies.publickey:  \n  \n         `sn -tp FriendAssemblies.publickey`  \n  \n3.  Create a C# file named `friend_signed_A` that contains the following code. The code uses the <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> attribute to declare friend_signed_B as a friend assembly.  \n  \n     The Strong Name tool generates a new public key every time it runs. Therefore, you must replace the public key in the following code with the public key you just generated, as shown in the following example.  \n  \n    ```csharp  \n    // friend_signed_A.cs  \n    // Compile with:   \n    // csc /target:library /keyfile:FriendAssemblies.snk friend_signed_A.cs  \n    using System.Runtime.CompilerServices;  \n  \n    [assembly: InternalsVisibleTo(\"friend_signed_B, PublicKey=0024000004800000940000000602000000240000525341310004000001000100e3aedce99b7e10823920206f8e46cd5558b4ec7345bd1a5b201ffe71660625dcb8f9a08687d881c8f65a0dcf042f81475d2e88f3e3e273c8311ee40f952db306c02fbfc5d8bc6ee1e924e6ec8fe8c01932e0648a0d3e5695134af3bb7fab370d3012d083fa6b83179dd3d031053f72fc1f7da8459140b0af5afc4d2804deccb6\")]  \n    class Class1  \n    {  \n        public void Test()  \n        {  \n            System.Console.WriteLine(\"Class1.Test\");  \n            System.Console.ReadLine();  \n        }  \n    }  \n    ```  \n  \n4.  Compile and sign friend_signed_A by using the following command.  \n  \n    ```csharp  \n    csc /target:library /keyfile:FriendAssemblies.snk friend_signed_A.cs  \n    ```  \n  \n5.  Create a C# file that is named `friend_signed_B` and contains the following code. Because friend_signed_A specifies friend_signed_B as a friend assembly, the code in friend_signed_B can access `internal` types and members from friend_signed_A. The file contains the following code.  \n  \n    ```csharp  \n    // friend_signed_B.cs  \n    // Compile with:   \n    // csc /keyfile:FriendAssemblies.snk /r:friend_signed_A.dll /out:friend_signed_B.exe friend_signed_B.cs  \n    public class Program  \n    {  \n        static void Main()  \n        {  \n            Class1 inst = new Class1();  \n            inst.Test();  \n        }  \n    }  \n    ```  \n  \n6.  Compile and sign friend_signed_B by using the following command.  \n  \n    ```csharp  \n    csc /keyfile:FriendAssemblies.snk /r:friend_signed_A.dll /out:friend_signed_B.exe friend_signed_B.cs  \n    ```  \n  \n     The name of the assembly generated by the compiler must match the friend assembly name passed to the <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> attribute. You must explicitly specify the name of the output assembly (.exe or .dll) by using the `/out` compiler option.  For more information, see [/out (C# Compiler Options)](../../../../csharp/language-reference/compiler-options/out-compiler-option.md).  \n  \n7.  Run the friend_signed_B.exe file.  \n  \n     The program prints the string \"Class1.Test\".  \n  \n## .NET Framework Security  \n There are similarities between the <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> attribute and the <xref:System.Security.Permissions.StrongNameIdentityPermission> class. The main difference is that <xref:System.Security.Permissions.StrongNameIdentityPermission> can demand security permissions to run a particular section of code, whereas the <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> attribute controls the visibility of `internal` types and members.  \n  \n## See also\n\n- <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute>\n- [Assemblies in .NET](../../../../standard/assembly/index.md)\n- [Friend Assemblies](../../../../standard/assembly/friend-assemblies.md)\n- [How to: Create Unsigned Friend Assemblies (C#)](../../../../csharp/programming-guide/concepts/assemblies-gac/how-to-create-unsigned-friend-assemblies.md)\n- [/keyfile](../../../../csharp/language-reference/compiler-options/keyfile-compiler-option.md)\n- [Sn.exe (Strong Name Tool)](../../../../framework/tools/sn-exe-strong-name-tool.md)\n- [Creating and Using Strong-Named Assemblies](../../../../../docs/framework/app-domains/create-and-use-strong-named-assemblies.md)\n- [C# Programming Guide](../../../../csharp/programming-guide/index.md)\n","nodes":[{"pos":[4,126],"embed":true,"restype":"x-metadata","content":"title: \"How to: Create Signed Friend Assemblies (C#)\"\nms.date: 07/20/2015\nms.assetid: bab62063-61e6-453f-905f-77673df9534e","nodes":[{"content":"How to: Create Signed Friend Assemblies (C#)","nodes":[{"pos":[0,44],"content":"How to: Create Signed Friend Assemblies (C#)","nodes":[{"content":"How to: Create Signed Friend Assemblies (C#)","pos":[0,44]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[133,177],"content":"How to: Create Signed Friend Assemblies (C#)","linkify":"How to: Create Signed Friend Assemblies (C#)","nodes":[{"content":"How to: Create Signed Friend Assemblies (C#)","pos":[0,44]}]},{"content":"This example shows how to use friend assemblies with assemblies that have strong names.","pos":[178,265]},{"content":"Both assemblies must be strong named.","pos":[266,303]},{"content":"Although both assemblies in this example use the same keys, you could use different keys for two assemblies.","pos":[304,412]},{"pos":[422,471],"content":"To create a signed assembly and a friend assembly","linkify":"To create a signed assembly and a friend assembly","nodes":[{"content":"To create a signed assembly and a friend assembly","pos":[0,49]}]},{"content":"Open a command prompt.","pos":[481,503]},{"content":"Use the following sequence of commands with the Strong Name tool to generate a keyfile and to display its public key.","pos":[513,630]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Sn.exe (Strong Name Tool)<ept id=\"p1\">](../../../../framework/tools/sn-exe-strong-name-tool.md)</ept>.","pos":[631,741],"source":" For more information, see [Sn.exe (Strong Name Tool)](../../../../framework/tools/sn-exe-strong-name-tool.md)."},{"content":"Generate a strong-name key for this example and store it in the file FriendAssemblies.snk:","pos":[755,845]},{"content":"Extract the public key from FriendAssemblies.snk and put it into FriendAssemblies.publickey:","pos":[902,994]},{"content":"Display the public key stored in the file FriendAssemblies.publickey:","pos":[1078,1147]},{"content":"Create a C# file named <ph id=\"ph1\">`friend_signed_A`</ph> that contains the following code.","pos":[1207,1281],"source":"Create a C# file named `friend_signed_A` that contains the following code."},{"content":"The code uses the <ph id=\"ph1\">&lt;xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute&gt;</ph> attribute to declare friend_signed_B as a friend assembly.","pos":[1282,1425],"source":" The code uses the <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> attribute to declare friend_signed_B as a friend assembly."},{"content":"The Strong Name tool generates a new public key every time it runs.","pos":[1436,1503]},{"content":"Therefore, you must replace the public key in the following code with the public key you just generated, as shown in the following example.","pos":[1504,1643]},{"content":"Compile and sign friend_signed_A by using the following command.","pos":[2432,2496]},{"content":"Create a C# file that is named <ph id=\"ph1\">`friend_signed_B`</ph> and contains the following code.","pos":[2610,2691],"source":"Create a C# file that is named `friend_signed_B` and contains the following code."},{"content":"Because friend_signed_A specifies friend_signed_B as a friend assembly, the code in friend_signed_B can access <ph id=\"ph1\">`internal`</ph> types and members from friend_signed_A.","pos":[2692,2853],"source":" Because friend_signed_A specifies friend_signed_B as a friend assembly, the code in friend_signed_B can access `internal` types and members from friend_signed_A."},{"content":"The file contains the following code.","pos":[2854,2891]},{"content":"Compile and sign friend_signed_B by using the following command.","pos":[3257,3321]},{"content":"The name of the assembly generated by the compiler must match the friend assembly name passed to the <ph id=\"ph1\">&lt;xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute&gt;</ph> attribute.","pos":[3468,3646],"source":"The name of the assembly generated by the compiler must match the friend assembly name passed to the <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> attribute."},{"content":"You must explicitly specify the name of the output assembly (.exe or .dll) by using the <ph id=\"ph1\">`/out`</ph> compiler option.","pos":[3647,3758],"source":" You must explicitly specify the name of the output assembly (.exe or .dll) by using the `/out` compiler option."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>/out (C# Compiler Options)<ept id=\"p1\">](../../../../csharp/language-reference/compiler-options/out-compiler-option.md)</ept>.","pos":[3760,3894],"source":"  For more information, see [/out (C# Compiler Options)](../../../../csharp/language-reference/compiler-options/out-compiler-option.md)."},{"content":"Run the friend_signed_B.exe file.","pos":[3904,3937]},{"content":"The program prints the string \"Class1.Test\".","pos":[3948,3992]},{"pos":[4001,4024],"content":".NET Framework Security","linkify":".NET Framework Security","nodes":[{"content":".NET Framework Security","pos":[0,23]}]},{"content":"There are similarities between the <ph id=\"ph1\">&lt;xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute&gt;</ph> attribute and the <ph id=\"ph2\">&lt;xref:System.Security.Permissions.StrongNameIdentityPermission&gt;</ph> class.","pos":[4028,4218],"source":"There are similarities between the <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> attribute and the <xref:System.Security.Permissions.StrongNameIdentityPermission> class."},{"content":"The main difference is that <ph id=\"ph1\">&lt;xref:System.Security.Permissions.StrongNameIdentityPermission&gt;</ph> can demand security permissions to run a particular section of code, whereas the <ph id=\"ph2\">&lt;xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute&gt;</ph> attribute controls the visibility of <ph id=\"ph3\">`internal`</ph> types and members.","pos":[4219,4525],"source":" The main difference is that <xref:System.Security.Permissions.StrongNameIdentityPermission> can demand security permissions to run a particular section of code, whereas the <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> attribute controls the visibility of `internal` types and members."},{"pos":[4534,4542],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[4615,4675],"content":"<bpt id=\"p1\">[</bpt>Assemblies in .NET<ept id=\"p1\">](../../../../standard/assembly/index.md)</ept>","source":"[Assemblies in .NET](../../../../standard/assembly/index.md)"},{"pos":[4678,4749],"content":"<bpt id=\"p1\">[</bpt>Friend Assemblies<ept id=\"p1\">](../../../../standard/assembly/friend-assemblies.md)</ept>","source":"[Friend Assemblies](../../../../standard/assembly/friend-assemblies.md)"},{"pos":[4752,4906],"content":"<bpt id=\"p1\">[</bpt>How to: Create Unsigned Friend Assemblies (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/assemblies-gac/how-to-create-unsigned-friend-assemblies.md)</ept>","source":"[How to: Create Unsigned Friend Assemblies (C#)](../../../../csharp/programming-guide/concepts/assemblies-gac/how-to-create-unsigned-friend-assemblies.md)"},{"pos":[4909,5002],"content":"<bpt id=\"p1\">[</bpt>/keyfile<ept id=\"p1\">](../../../../csharp/language-reference/compiler-options/keyfile-compiler-option.md)</ept>","source":"[/keyfile](../../../../csharp/language-reference/compiler-options/keyfile-compiler-option.md)"},{"pos":[5005,5088],"content":"<bpt id=\"p1\">[</bpt>Sn.exe (Strong Name Tool)<ept id=\"p1\">](../../../../framework/tools/sn-exe-strong-name-tool.md)</ept>","source":"[Sn.exe (Strong Name Tool)](../../../../framework/tools/sn-exe-strong-name-tool.md)"},{"pos":[5091,5220],"content":"<bpt id=\"p1\">[</bpt>Creating and Using Strong-Named Assemblies<ept id=\"p1\">](../../../../../docs/framework/app-domains/create-and-use-strong-named-assemblies.md)</ept>","source":"[Creating and Using Strong-Named Assemblies](../../../../../docs/framework/app-domains/create-and-use-strong-named-assemblies.md)"},{"pos":[5223,5292],"content":"<bpt id=\"p1\">[</bpt>C# Programming Guide<ept id=\"p1\">](../../../../csharp/programming-guide/index.md)</ept>","source":"[C# Programming Guide](../../../../csharp/programming-guide/index.md)"}]}