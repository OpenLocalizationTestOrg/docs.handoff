{"content":"---\ntitle: \"Best Practices for Exceptions | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"exceptions, best practices\"\nms.assetid: f06da765-235b-427a-bfb6-47cd219af539\ncaps.latest.revision: 28\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"\n---\n# Best practices for exceptions\n\nA well-designed app handles exceptions and errors to prevent app crashes. This section describes best practices for handling and creating exceptions.\n\n## Use try/catch/finally blocks\n\nUse `try`/`catch`/`finally` blocks around code that can potentially generate an exception. \n\nIn `catch` blocks, always order exceptions from the most specific to the least specific.\n\nUse a `finally` block to clean up resources, whether you can recover or not.\n\n## Handle common conditions without throwing exceptions\n\nFor conditions that are likely to occur but might trigger an exception, consider handling them in a way that will avoid the exception. For example, if you try to close a connection that is already closed, you'll get an `InvalidOperationException`. You can avoid that by using an `if` statement to check the connection state before trying to close it.\n\n[!code-cpp[Conceptual.Exception.Handling#2](../../../samples/snippets/cpp/VS_Snippets_CLR/conceptual.exception.handling/cpp/source.cpp#2)]\n[!code-csharp[Conceptual.Exception.Handling#2](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.exception.handling/cs/source.cs#2)]\n[!code-vb[Conceptual.Exception.Handling#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.exception.handling/vb/source.vb#2)]  \n\nIf you don't check connection state before closing, you can catch the `InvalidOperationException` exception.\n\n[!code-cpp[Conceptual.Exception.Handling#3](../../../samples/snippets/cpp/VS_Snippets_CLR/conceptual.exception.handling/cpp/source.cpp#3)]\n[!code-csharp[Conceptual.Exception.Handling#3](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.exception.handling/cs/source.cs#3)]\n[!code-vb[Conceptual.Exception.Handling#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.exception.handling/vb/source.vb#3)]  \n\nThe method to choose depends on how often you expect the event to occur.\n\n- Use exception handling if the event doesn't occur very often, that is, if the event is truly exceptional and indicates an error (such as an unexpected end-of-file). When you use exception handling, less code is executed in normal conditions.\n\n- Check for error conditions in code if the event happens routinely and could be considered part of normal execution. When you check for common error conditions, less code is executed because you avoid exceptions.\n\n## Design classes so that exceptions can be avoided\n\nA class can provide methods or properties that enable you to avoid making a call that would trigger an exception. For example, a @System.IO.FileStream class provides methods that help determine whether the end of the file has been reached. These can be used to avoid the exception that is thrown if you read past the end of the file. The following example shows how to read to the end of a file without triggering an exception.\n\n[!code-cpp[Conceptual.Exception.Handling#5](../../../samples/snippets/cpp/VS_Snippets_CLR/conceptual.exception.handling/cpp/source.cpp#5)]\n[!code-csharp[Conceptual.Exception.Handling#5](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.exception.handling/cs/source.cs#5)]\n[!code-vb[Conceptual.Exception.Handling#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.exception.handling/vb/source.vb#5)]  \n\nAnother way to avoid exceptions is to return null for extremely common error cases instead of throwing an exception. An extremely common error case can be considered normal flow of control. By returning null in these cases, you minimize the performance impact to an app.\n\n## Throw exceptions instead of returning an error code\n\nExceptions ensure that failures do not go unnoticed because calling code didn't check a return code. \n\n## Use the predefined .NET exception types\n\nIntroduce a new exception class only when a predefined one doesn't apply. For example:\n\n- Throw an @System.InvalidOperationException exception if a property set or method call is not appropriate given the object's current state.\n\n- Throw an @System.ArgumentException exception or one of the predefined classes that derive from @System.ArgumentException if invalid parameters are passed.\n\n## End exception class names with the word `Exception`\n\nWhen a custom exception is necessary, name it appropriately and derive it from the @System.Exception class. For example:\n\n[!code-cpp[Conceptual.Exception.Handling#4](../../../samples/snippets/cpp/VS_Snippets_CLR/conceptual.exception.handling/cpp/source.cpp#4)]\n[!code-csharp[Conceptual.Exception.Handling#4](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.exception.handling/cs/source.cs#4)]\n[!code-vb[Conceptual.Exception.Handling#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.exception.handling/vb/source.vb#4)]  \n\n## Include three constructors in custom exception classes\n\nUse at least the three common constructors when creating your own exception classes: the default constructor, a constructor that takes a string message, and a constructor that takes a string message and an inner exception.\n\n* <xref:System.Exception.%23ctor> , which uses default vales.  \n  \n* <xref:System.Exception.%23ctor%28System.String%29>, which accepts a string message.  \n  \n* <xref:System.Exception.%23ctor%28System.String%2CSystem.Exception%29>, which accepts a string message and an inner exception.  \n  \nFor an example, see [How to: Create User-Defined Exceptions](how-to-create-user-defined-exceptions.md).\n\n## Ensure that exception data is available when code executes remotely\n\nWhen you create user-defined exceptions, ensure that the metadata for the exceptions is available to code that is executing remotely. \n\nFor example, on .NET runtimes that implement App Domains, exceptions may occur across App domains. Suppose App Domain A creates App Domain B, which executes code that throws an exception. For App Domain A to properly catch and handle the exception, it must be able to find the assembly that contains the exception thrown by App Domain B. If App Domain B throws an exception that is contained in an assembly under its application base, but not under App Domain A's application base, App Domain A will not be able to find the exception, and the common language runtime will throw a @System.IO.FileNotFoundException exception. To avoid this situation, you can deploy the assembly that contains the exception information in two ways:\n\n- Put the assembly into a common application base shared by both app domains.\n\n    \\- or -\n\n- If the domains do not share a common application base, sign the assembly that contains the exception information with a strong name and deploy the assembly into the global assembly cache.\n\n## Include a localized description string in every exception\n\nThe error message that the user sees is derived from the description string of the exception that was thrown, and not from the name of the exception class.\n\n## Use grammatically correct error messages\n\nWrite clear sentences and include ending punctuation. Each sentence in a description string of an exception should end in a period. For example, \"The log table has overflowed.\" would be an appropriate description string.\n\n## In custom exceptions, provide additional properties as needed\n\nProvide additional properties for an exception (in addition to the description string) only when there's a programmatic scenario where the additional information is useful. For example, the @System.IO.FileNotFoundException provides the @System.IO.FileNotFoundException.FileName property.\n\n## Place throw statements so that the stack trace will be helpful\n\nThe stack trace begins at the statement where the exception is thrown and ends at the `catch` statement that catches the exception.\n\n## Use exception builder methods\n\nIt is common for a class to throw the same exception from different places in its implementation. To avoid excessive code, use helper methods that create the exception and return it. For example:\n\n[!code-cpp[Conceptual.Exception.Handling#6](../../../samples/snippets/cpp/VS_Snippets_CLR/conceptual.exception.handling/cpp/source.cpp#6)]\n[!code-csharp[Conceptual.Exception.Handling#6](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.exception.handling/cs/source.cs#6)]\n[!code-vb[Conceptual.Exception.Handling#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.exception.handling/vb/source.vb#6)]  \n  \nIn some cases, it's more appropriate to use the exception's constructor to build the exception. An example is a global exception class such as @System.ArgumentException, \n\n## Clean up intermediate results when throwing an exception\n\nCallers should be able to assume that there are no side effects when an exception is thrown from a method. For example, if you have code that transfers money by withdrawing from one account and depositing in another account, and an exception is thrown while executing the deposit, you don't want the withdrawal to remain in effect.\n\n```csharp\npublic void TransferFunds(Account from, Account to, decimal amount)\n{\n    from.Withdrawal(amount);\n    // If the deposit fails, the withdrawal shouldn't remain in effect. \n    to.Deposit(amount);\n}\n```\n\nOne way to handle this situation is to catch any exceptions thrown by the deposit transaction and roll back the withdrawal.\n\n```csharp\nprivate static void TransferFunds(Account from, Account to, decimal amount)\n{\n    string withdrawalTrxID = from.Withdrawal(amount);\n    try\n    {\n        to.Deposit(amount);\n    }\n    catch\n    {\n        from.RollbackTransaction(withdrawalTrxID);\n        throw\n    }\n}\n```\n\nThis example illustrates the use of `throw` to re-throw the original exception, which can make it easier for callers to see the real cause of the problem without having to examine the @System.Exception.InnerException property. An alternative is to throw a new exception and include the original exception as the inner exception:\n\n```csharp\ncatch (Exception ex)\n{\n    from.RollbackTransaction(withdrawalTrxID);\n    throw new Exception(\"Withdrawal failed\", ex);\n}\n```\n\n## See Also  \n[Exceptions](index.md)","nodes":[{"pos":[4,395],"embed":true,"restype":"x-metadata","content":"title: \"Best Practices for Exceptions | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"exceptions, best practices\"\nms.assetid: f06da765-235b-427a-bfb6-47cd219af539\ncaps.latest.revision: 28\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"","nodes":[{"content":"Best Practices for Exceptions | Microsoft Docs","nodes":[{"pos":[0,46],"content":"Best Practices for Exceptions | Microsoft Docs","nodes":[{"content":"Best Practices for Exceptions | Microsoft Docs","pos":[0,46]}]}],"path":["title"]}],"yml":true},{"pos":[402,431],"content":"Best practices for exceptions","linkify":"Best practices for exceptions","nodes":[{"content":"Best practices for exceptions","pos":[0,29]}]},{"content":"A well-designed app handles exceptions and errors to prevent app crashes.","pos":[433,506]},{"content":"This section describes best practices for handling and creating exceptions.","pos":[507,582]},{"pos":[587,615],"content":"Use try/catch/finally blocks","linkify":"Use try/catch/finally blocks","nodes":[{"content":"Use try/catch/finally blocks","pos":[0,28]}]},{"pos":[617,707],"content":"Use <ph id=\"ph1\">`try`</ph><ph id=\"ph2\">/</ph><ph id=\"ph3\">`catch`</ph><ph id=\"ph4\">/</ph><ph id=\"ph5\">`finally`</ph> blocks around code that can potentially generate an exception.","source":"Use `try`/`catch`/`finally` blocks around code that can potentially generate an exception."},{"pos":[710,798],"content":"In <ph id=\"ph1\">`catch`</ph> blocks, always order exceptions from the most specific to the least specific.","source":"In `catch` blocks, always order exceptions from the most specific to the least specific."},{"pos":[800,876],"content":"Use a <ph id=\"ph1\">`finally`</ph> block to clean up resources, whether you can recover or not.","source":"Use a `finally` block to clean up resources, whether you can recover or not."},{"pos":[881,933],"content":"Handle common conditions without throwing exceptions","linkify":"Handle common conditions without throwing exceptions","nodes":[{"content":"Handle common conditions without throwing exceptions","pos":[0,52]}]},{"content":"For conditions that are likely to occur but might trigger an exception, consider handling them in a way that will avoid the exception.","pos":[935,1069]},{"content":"For example, if you try to close a connection that is already closed, you'll get an <ph id=\"ph1\">`InvalidOperationException`</ph>.","pos":[1070,1182],"source":" For example, if you try to close a connection that is already closed, you'll get an `InvalidOperationException`."},{"content":"You can avoid that by using an <ph id=\"ph1\">`if`</ph> statement to check the connection state before trying to close it.","pos":[1183,1285],"source":" You can avoid that by using an `if` statement to check the connection state before trying to close it."},{"pos":[1716,1824],"content":"If you don't check connection state before closing, you can catch the <ph id=\"ph1\">`InvalidOperationException`</ph> exception.","source":"If you don't check connection state before closing, you can catch the `InvalidOperationException` exception."},{"content":"The method to choose depends on how often you expect the event to occur.","pos":[2255,2327]},{"content":"Use exception handling if the event doesn't occur very often, that is, if the event is truly exceptional and indicates an error (such as an unexpected end-of-file).","pos":[2331,2495]},{"content":"When you use exception handling, less code is executed in normal conditions.","pos":[2496,2572]},{"content":"Check for error conditions in code if the event happens routinely and could be considered part of normal execution.","pos":[2576,2691]},{"content":"When you check for common error conditions, less code is executed because you avoid exceptions.","pos":[2692,2787]},{"pos":[2792,2840],"content":"Design classes so that exceptions can be avoided","linkify":"Design classes so that exceptions can be avoided","nodes":[{"content":"Design classes so that exceptions can be avoided","pos":[0,48]}]},{"content":"A class can provide methods or properties that enable you to avoid making a call that would trigger an exception.","pos":[2842,2955]},{"content":"For example, a <ph id=\"ph1\">@System.IO.FileStream</ph> class provides methods that help determine whether the end of the file has been reached.","pos":[2956,3081],"source":" For example, a @System.IO.FileStream class provides methods that help determine whether the end of the file has been reached."},{"content":"These can be used to avoid the exception that is thrown if you read past the end of the file.","pos":[3082,3175]},{"content":"The following example shows how to read to the end of a file without triggering an exception.","pos":[3176,3269]},{"content":"Another way to avoid exceptions is to return null for extremely common error cases instead of throwing an exception.","pos":[3700,3816]},{"content":"An extremely common error case can be considered normal flow of control.","pos":[3817,3889]},{"content":"By returning null in these cases, you minimize the performance impact to an app.","pos":[3890,3970]},{"pos":[3975,4026],"content":"Throw exceptions instead of returning an error code","linkify":"Throw exceptions instead of returning an error code","nodes":[{"content":"Throw exceptions instead of returning an error code","pos":[0,51]}]},{"content":"Exceptions ensure that failures do not go unnoticed because calling code didn't check a return code.","pos":[4028,4128]},{"pos":[4134,4173],"content":"Use the predefined .NET exception types","linkify":"Use the predefined .NET exception types","nodes":[{"content":"Use the predefined .NET exception types","pos":[0,39]}]},{"content":"Introduce a new exception class only when a predefined one doesn't apply.","pos":[4175,4248]},{"content":"For example:","pos":[4249,4261]},{"content":"Throw an <ph id=\"ph1\">@System.InvalidOperationException</ph> exception if a property set or method call is not appropriate given the object's current state.","pos":[4265,4403],"source":"Throw an @System.InvalidOperationException exception if a property set or method call is not appropriate given the object's current state."},{"content":"Throw an <ph id=\"ph1\">@System.ArgumentException</ph> exception or one of the predefined classes that derive from <ph id=\"ph2\">@System.ArgumentException</ph> if invalid parameters are passed.","pos":[4407,4561],"source":"Throw an @System.ArgumentException exception or one of the predefined classes that derive from @System.ArgumentException if invalid parameters are passed."},{"pos":[4566,4617],"content":"End exception class names with the word <ph id=\"ph1\">`Exception`</ph>","linkify":"End exception class names with the word `Exception`","source":"End exception class names with the word `Exception`"},{"content":"When a custom exception is necessary, name it appropriately and derive it from the <ph id=\"ph1\">@System.Exception</ph> class.","pos":[4619,4726],"source":"When a custom exception is necessary, name it appropriately and derive it from the @System.Exception class."},{"content":"For example:","pos":[4727,4739]},{"pos":[5173,5227],"content":"Include three constructors in custom exception classes","linkify":"Include three constructors in custom exception classes","nodes":[{"content":"Include three constructors in custom exception classes","pos":[0,54]}]},{"content":"Use at least the three common constructors when creating your own exception classes: the default constructor, a constructor that takes a string message, and a constructor that takes a string message and an inner exception.","pos":[5229,5451]},{"content":"<ph id=\"ph1\">&lt;xref:System.Exception.%23ctor&gt;</ph> , which uses default vales.","pos":[5455,5514],"source":"<xref:System.Exception.%23ctor> , which uses default vales."},{"content":"<ph id=\"ph1\">&lt;xref:System.Exception.%23ctor%28System.String%29&gt;</ph>, which accepts a string message.","pos":[5522,5605],"source":"<xref:System.Exception.%23ctor%28System.String%29>, which accepts a string message."},{"content":"<ph id=\"ph1\">&lt;xref:System.Exception.%23ctor%28System.String%2CSystem.Exception%29&gt;</ph>, which accepts a string message and an inner exception.","pos":[5613,5738],"source":"<xref:System.Exception.%23ctor%28System.String%2CSystem.Exception%29>, which accepts a string message and an inner exception."},{"pos":[5744,5847],"content":"For an example, see <bpt id=\"p1\">[</bpt>How to: Create User-Defined Exceptions<ept id=\"p1\">](how-to-create-user-defined-exceptions.md)</ept>.","source":"For an example, see [How to: Create User-Defined Exceptions](how-to-create-user-defined-exceptions.md)."},{"pos":[5852,5919],"content":"Ensure that exception data is available when code executes remotely","linkify":"Ensure that exception data is available when code executes remotely","nodes":[{"content":"Ensure that exception data is available when code executes remotely","pos":[0,67]}]},{"content":"When you create user-defined exceptions, ensure that the metadata for the exceptions is available to code that is executing remotely.","pos":[5921,6054]},{"content":"For example, on .NET runtimes that implement App Domains, exceptions may occur across App domains.","pos":[6057,6155]},{"content":"Suppose App Domain A creates App Domain B, which executes code that throws an exception.","pos":[6156,6244]},{"content":"For App Domain A to properly catch and handle the exception, it must be able to find the assembly that contains the exception thrown by App Domain B. If App Domain B throws an exception that is contained in an assembly under its application base, but not under App Domain A's application base, App Domain A will not be able to find the exception, and the common language runtime will throw a <ph id=\"ph1\">@System.IO.FileNotFoundException</ph> exception.","pos":[6245,6680],"source":" For App Domain A to properly catch and handle the exception, it must be able to find the assembly that contains the exception thrown by App Domain B. If App Domain B throws an exception that is contained in an assembly under its application base, but not under App Domain A's application base, App Domain A will not be able to find the exception, and the common language runtime will throw a @System.IO.FileNotFoundException exception."},{"content":"To avoid this situation, you can deploy the assembly that contains the exception information in two ways:","pos":[6681,6786]},{"content":"Put the assembly into a common application base shared by both app domains.","pos":[6790,6865]},{"content":"<ph id=\"ph1\">\\-</ph> or -","pos":[6871,6878],"source":"\\- or -"},{"content":"If the domains do not share a common application base, sign the assembly that contains the exception information with a strong name and deploy the assembly into the global assembly cache.","pos":[6882,7069]},{"pos":[7074,7131],"content":"Include a localized description string in every exception","linkify":"Include a localized description string in every exception","nodes":[{"content":"Include a localized description string in every exception","pos":[0,57]}]},{"content":"The error message that the user sees is derived from the description string of the exception that was thrown, and not from the name of the exception class.","pos":[7133,7288]},{"pos":[7293,7333],"content":"Use grammatically correct error messages","linkify":"Use grammatically correct error messages","nodes":[{"content":"Use grammatically correct error messages","pos":[0,40]}]},{"content":"Write clear sentences and include ending punctuation.","pos":[7335,7388]},{"content":"Each sentence in a description string of an exception should end in a period.","pos":[7389,7466]},{"content":"For example, \"The log table has overflowed.\"","pos":[7467,7511]},{"content":"would be an appropriate description string.","pos":[7512,7555]},{"pos":[7560,7621],"content":"In custom exceptions, provide additional properties as needed","linkify":"In custom exceptions, provide additional properties as needed","nodes":[{"content":"In custom exceptions, provide additional properties as needed","pos":[0,61]}]},{"content":"Provide additional properties for an exception (in addition to the description string) only when there's a programmatic scenario where the additional information is useful.","pos":[7623,7795]},{"content":"For example, the <ph id=\"ph1\">@System.IO.FileNotFoundException</ph> provides the <ph id=\"ph2\">@System.IO.FileNotFoundException.FileName</ph> property.","pos":[7796,7910],"source":" For example, the @System.IO.FileNotFoundException provides the @System.IO.FileNotFoundException.FileName property."},{"pos":[7915,7977],"content":"Place throw statements so that the stack trace will be helpful","linkify":"Place throw statements so that the stack trace will be helpful","nodes":[{"content":"Place throw statements so that the stack trace will be helpful","pos":[0,62]}]},{"pos":[7979,8110],"content":"The stack trace begins at the statement where the exception is thrown and ends at the <ph id=\"ph1\">`catch`</ph> statement that catches the exception.","source":"The stack trace begins at the statement where the exception is thrown and ends at the `catch` statement that catches the exception."},{"pos":[8115,8144],"content":"Use exception builder methods","linkify":"Use exception builder methods","nodes":[{"content":"Use exception builder methods","pos":[0,29]}]},{"content":"It is common for a class to throw the same exception from different places in its implementation.","pos":[8146,8243]},{"content":"To avoid excessive code, use helper methods that create the exception and return it.","pos":[8244,8328]},{"content":"For example:","pos":[8329,8341]},{"content":"In some cases, it's more appropriate to use the exception's constructor to build the exception.","pos":[8774,8869]},{"content":"An example is a global exception class such as <ph id=\"ph1\">@System.ArgumentException</ph>,","pos":[8870,8943],"source":" An example is a global exception class such as @System.ArgumentException,"},{"pos":[8949,9005],"content":"Clean up intermediate results when throwing an exception","linkify":"Clean up intermediate results when throwing an exception","nodes":[{"content":"Clean up intermediate results when throwing an exception","pos":[0,56]}]},{"content":"Callers should be able to assume that there are no side effects when an exception is thrown from a method.","pos":[9007,9113]},{"content":"For example, if you have code that transfers money by withdrawing from one account and depositing in another account, and an exception is thrown while executing the deposit, you don't want the withdrawal to remain in effect.","pos":[9114,9338]},{"content":"One way to handle this situation is to catch any exceptions thrown by the deposit transaction and roll back the withdrawal.","pos":[9553,9676]},{"content":"This example illustrates the use of <ph id=\"ph1\">`throw`</ph> to re-throw the original exception, which can make it easier for callers to see the real cause of the problem without having to examine the <ph id=\"ph2\">@System.Exception.InnerException</ph> property.","pos":[9962,10188],"source":"This example illustrates the use of `throw` to re-throw the original exception, which can make it easier for callers to see the real cause of the problem without having to examine the @System.Exception.InnerException property."},{"content":"An alternative is to throw a new exception and include the original exception as the inner exception:","pos":[10189,10290]},{"pos":[10432,10440],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[10443,10465],"content":"<bpt id=\"p1\">[</bpt>Exceptions<ept id=\"p1\">](index.md)</ept>","source":"[Exceptions](index.md)"}]}