{"content":"---\ntitle: \"ICorProfilerCallback::MovedReferences Method | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\napi_name: \n  - \"ICorProfilerCallback.MovedReferences\"\napi_location: \n  - \"mscorwks.dll\"\napi_type: \n  - \"COM\"\nf1_keywords: \n  - \"ICorProfilerCallback::MovedReferences\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"MovedReferences method [.NET Framework profiling]\"\n  - \"ICorProfilerCallback::MovedReferences method [.NET Framework profiling]\"\nms.assetid: 996c71ae-0676-4616-a085-84ebf507649d\ntopic_type: \n  - \"apiref\"\ncaps.latest.revision: 26\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"\n---\n# ICorProfilerCallback::MovedReferences Method\nCalled to report the new layout of objects in the heap as a result of a compacting garbage collection.  \n  \n## Syntax  \n  \n```  \nHRESULT MovedReferences(  \n    [in]  ULONG  cMovedObjectIDRanges,  \n    [in, size_is(cMovedObjectIDRanges)] ObjectID oldObjectIDRangeStart[] ,  \n    [in, size_is(cMovedObjectIDRanges)] ObjectID newObjectIDRangeStart[] ,  \n    [in, size_is(cMovedObjectIDRanges)] ULONG    cObjectIDRangeLength[] );  \n```  \n  \n#### Parameters  \n `cMovedObjectIDRanges`  \n [in] The number of blocks of contiguous objects that moved as the result of the compacting garbage collection. That is, the value of `cMovedObjectIDRanges` is the total size of the `oldObjectIDRangeStart`, `newObjectIDRangeStart`, and `cObjectIDRangeLength` arrays.  \n  \n The next three arguments of `MovedReferences` are parallel arrays. In other words, `oldObjectIDRangeStart[i]`, `newObjectIDRangeStart[i]`, and `cObjectIDRangeLength[i]` all concern a single block of contiguous objects.  \n  \n `oldObjectIDRangeStart`  \n [in] An array of `ObjectID` values, each of which is the old (pre-garbage collection) starting address of a block of contiguous, live objects in memory.  \n  \n `newObjectIDRangeStart`  \n [in] An array of `ObjectID` values, each of which is the new (post-garbage collection) starting address of a block of contiguous, live objects in memory.  \n  \n `cObjectIDRangeLength`  \n [in] An array of integers, each of which is the size of a block of contiguous objects in memory.  \n  \n A size is specified for each block that is referenced in the `oldObjectIDRangeStart` and `newObjectIDRangeStart` arrays.  \n  \n## Remarks  \n  \n> [!IMPORTANT]\n>  This method reports sizes as `MAX_ULONG` for objects that are greater than 4 GB on 64-bit platforms. To get the size of objects that are larger than 4 GB, use the [ICorProfilerCallback4::MovedReferences2](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-movedreferences2-method.md) method instead.  \n  \n A compacting garbage collector reclaims the memory occupied by dead objects and compacts that freed space. As a result, live objects might be moved within the heap, and `ObjectID` values distributed by previous notifications might change.  \n  \n Assume that an existing `ObjectID` value (`oldObjectID`) lies within the following range:  \n  \n `oldObjectIDRangeStart[i]` <= `oldObjectID` < `oldObjectIDRangeStart[i]` + `cObjectIDRangeLength[i]`  \n  \n In this case, the offset from the start of the range to the start of the object is as follows:  \n  \n `oldObjectID` - `oldObjectRangeStart[i]`  \n  \n For any value of `i` that is in the following range:  \n  \n 0 <= `i` < `cMovedObjectIDRanges`  \n  \n you can calculate the new `ObjectID` as follows:  \n  \n `newObjectID` = `newObjectIDRangeStart[i]` + (`oldObjectID` – `oldObjectIDRangeStart[i]`)  \n  \n None of the `ObjectID` values passed by `MovedReferences` are valid during the callback itself, because the garbage collection might be in the middle of moving objects from old locations to new locations. Therefore, profilers should not attempt to inspect objects during a `MovedReferences` call. A [ICorProfilerCallback2::GarbageCollectionFinished](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-garbagecollectionfinished-method.md) callback indicates that all objects have been moved to their new locations and inspection can be performed.  \n  \n## Requirements  \n **Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md).  \n  \n **Header:** CorProf.idl, CorProf.h  \n  \n **Library:** CorGuids.lib  \n  \n **.NET Framework Versions:** [!INCLUDE[net_current_v20plus](../../../../includes/net-current-v20plus-md.md)]  \n  \n## See Also  \n [ICorProfilerCallback Interface](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md)   \n [MovedReferences2 Method](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-movedreferences2-method.md)   \n [Profiling Interfaces](../../../../docs/framework/unmanaged-api/profiling/profiling-interfaces.md)   \n [Profiling](../../../../docs/framework/unmanaged-api/profiling/index.md)","nodes":[{"pos":[12,73],"content":"ICorProfilerCallback::MovedReferences Method | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"ICorProfilerCallback::MovedReferences Method | Microsoft Docs","pos":[0,61]}]},{"pos":[747,791],"content":"ICorProfilerCallback::MovedReferences Method","linkify":"ICorProfilerCallback::MovedReferences Method","nodes":[{"content":"ICorProfilerCallback::MovedReferences Method","pos":[0,44]}]},{"content":"Called to report the new layout of objects in the heap as a result of a compacting garbage collection.","pos":[792,894]},{"pos":[903,909],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[1234,1244],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"[in] The number of blocks of contiguous objects that moved as the result of the compacting garbage collection.","pos":[1274,1384]},{"content":"That is, the value of <ph id=\"ph1\">`cMovedObjectIDRanges`</ph> is the total size of the <ph id=\"ph2\">`oldObjectIDRangeStart`</ph>, <ph id=\"ph3\">`newObjectIDRangeStart`</ph>, and <ph id=\"ph4\">`cObjectIDRangeLength`</ph> arrays.","pos":[1385,1539],"source":" That is, the value of `cMovedObjectIDRanges` is the total size of the `oldObjectIDRangeStart`, `newObjectIDRangeStart`, and `cObjectIDRangeLength` arrays."},{"content":"The next three arguments of <ph id=\"ph1\">`MovedReferences`</ph> are parallel arrays.","pos":[1546,1612],"source":"The next three arguments of `MovedReferences` are parallel arrays."},{"content":"In other words, <ph id=\"ph1\">`oldObjectIDRangeStart[i]`</ph>, <ph id=\"ph2\">`newObjectIDRangeStart[i]`</ph>, and <ph id=\"ph3\">`cObjectIDRangeLength[i]`</ph> all concern a single block of contiguous objects.","pos":[1613,1764],"source":" In other words, `oldObjectIDRangeStart[i]`, `newObjectIDRangeStart[i]`, and `cObjectIDRangeLength[i]` all concern a single block of contiguous objects."},{"content":"[in] An array of <ph id=\"ph1\">`ObjectID`</ph> values, each of which is the old (pre-garbage collection) starting address of a block of contiguous, live objects in memory.","pos":[1798,1950],"source":" [in] An array of `ObjectID` values, each of which is the old (pre-garbage collection) starting address of a block of contiguous, live objects in memory."},{"content":"[in] An array of <ph id=\"ph1\">`ObjectID`</ph> values, each of which is the new (post-garbage collection) starting address of a block of contiguous, live objects in memory.","pos":[1984,2137],"source":" [in] An array of `ObjectID` values, each of which is the new (post-garbage collection) starting address of a block of contiguous, live objects in memory."},{"content":"[in] An array of integers, each of which is the size of a block of contiguous objects in memory.","pos":[2170,2266]},{"pos":[2273,2393],"content":"A size is specified for each block that is referenced in the <ph id=\"ph1\">`oldObjectIDRangeStart`</ph> and <ph id=\"ph2\">`newObjectIDRangeStart`</ph> arrays.","source":"A size is specified for each block that is referenced in the `oldObjectIDRangeStart` and `newObjectIDRangeStart` arrays."},{"pos":[2402,2409],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"pos":[2417,2754],"content":"[!IMPORTANT]\n This method reports sizes as `MAX_ULONG` for objects that are greater than 4 GB on 64-bit platforms. To get the size of objects that are larger than 4 GB, use the [ICorProfilerCallback4::MovedReferences2](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-movedreferences2-method.md) method instead.","leadings":["","> "],"nodes":[{"content":" This method reports sizes as `MAX_ULONG` for objects that are greater than 4 GB on 64-bit platforms. To get the size of objects that are larger than 4 GB, use the [ICorProfilerCallback4::MovedReferences2](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-movedreferences2-method.md) method instead.","pos":[13,335],"nodes":[{"content":"This method reports sizes as <ph id=\"ph1\">`MAX_ULONG`</ph> for objects that are greater than 4 GB on 64-bit platforms.","pos":[1,101],"source":" This method reports sizes as `MAX_ULONG` for objects that are greater than 4 GB on 64-bit platforms."},{"content":"To get the size of objects that are larger than 4 GB, use the <bpt id=\"p1\">[</bpt>ICorProfilerCallback4::MovedReferences2<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-movedreferences2-method.md)</ept> method instead.","pos":[102,322],"source":" To get the size of objects that are larger than 4 GB, use the [ICorProfilerCallback4::MovedReferences2](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-movedreferences2-method.md) method instead."}]}]},{"content":"A compacting garbage collector reclaims the memory occupied by dead objects and compacts that freed space.","pos":[2761,2867]},{"content":"As a result, live objects might be moved within the heap, and <ph id=\"ph1\">`ObjectID`</ph> values distributed by previous notifications might change.","pos":[2868,2999],"source":" As a result, live objects might be moved within the heap, and `ObjectID` values distributed by previous notifications might change."},{"pos":[3006,3095],"content":"Assume that an existing <ph id=\"ph1\">`ObjectID`</ph> value (<ph id=\"ph2\">`oldObjectID`</ph>) lies within the following range:","source":"Assume that an existing `ObjectID` value (`oldObjectID`) lies within the following range:"},{"content":"In this case, the offset from the start of the range to the start of the object is as follows:","pos":[3209,3303]},{"pos":[3357,3409],"content":"For any value of <ph id=\"ph1\">`i`</ph> that is in the following range:","source":"For any value of `i` that is in the following range:"},{"pos":[3416,3449],"content":"0 &lt;= <ph id=\"ph1\">`i`</ph><ph id=\"ph2\"> &lt; </ph><ph id=\"ph3\">`cMovedObjectIDRanges`</ph>","source":"0 <= `i` < `cMovedObjectIDRanges`"},{"pos":[3456,3504],"content":"you can calculate the new <ph id=\"ph1\">`ObjectID`</ph> as follows:","source":"you can calculate the new `ObjectID` as follows:"},{"pos":[3511,3600],"content":"<ph id=\"ph1\">`newObjectID`</ph><ph id=\"ph2\"> = </ph><ph id=\"ph3\">`newObjectIDRangeStart[i]`</ph> + (<ph id=\"ph4\">`oldObjectID`</ph> – <ph id=\"ph5\">`oldObjectIDRangeStart[i]`</ph>)","source":"`newObjectID` = `newObjectIDRangeStart[i]` + (`oldObjectID` – `oldObjectIDRangeStart[i]`)"},{"content":"None of the <ph id=\"ph1\">`ObjectID`</ph> values passed by <ph id=\"ph2\">`MovedReferences`</ph> are valid during the callback itself, because the garbage collection might be in the middle of moving objects from old locations to new locations.","pos":[3607,3811],"source":"None of the `ObjectID` values passed by `MovedReferences` are valid during the callback itself, because the garbage collection might be in the middle of moving objects from old locations to new locations."},{"content":"Therefore, profilers should not attempt to inspect objects during a <ph id=\"ph1\">`MovedReferences`</ph> call.","pos":[3812,3903],"source":" Therefore, profilers should not attempt to inspect objects during a `MovedReferences` call."},{"content":"A <bpt id=\"p1\">[</bpt>ICorProfilerCallback2::GarbageCollectionFinished<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-garbagecollectionfinished-method.md)</ept> callback indicates that all objects have been moved to their new locations and inspection can be performed.","pos":[3904,4174],"source":" A [ICorProfilerCallback2::GarbageCollectionFinished](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-garbagecollectionfinished-method.md) callback indicates that all objects have been moved to their new locations and inspection can be performed."},{"pos":[4183,4195],"content":"Requirements","linkify":"Requirements","nodes":[{"content":"Requirements","pos":[0,12]}]},{"pos":[4199,4303],"content":"<bpt id=\"p1\">**</bpt>Platforms:<ept id=\"p1\">**</ept> See <bpt id=\"p2\">[</bpt>System Requirements<ept id=\"p2\">](../../../../docs/framework/get-started/system-requirements.md)</ept>.","source":"**Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md)."},{"pos":[4310,4344],"content":"<bpt id=\"p1\">**</bpt>Header:<ept id=\"p1\">**</ept> CorProf.idl, CorProf.h","source":"**Header:** CorProf.idl, CorProf.h"},{"pos":[4351,4376],"content":"<bpt id=\"p1\">**</bpt>Library:<ept id=\"p1\">**</ept> CorGuids.lib","source":"**Library:** CorGuids.lib"},{"pos":[4383,4491],"content":"<bpt id=\"p1\">**</bpt>.NET Framework Versions:<ept id=\"p1\">**</ept> <ph id=\"ph1\">[!INCLUDE[net_current_v20plus](../../../../includes/net-current-v20plus-md.md)]</ph>","source":"**.NET Framework Versions:** [!INCLUDE[net_current_v20plus](../../../../includes/net-current-v20plus-md.md)]"},{"pos":[4500,4508],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>ICorProfilerCallback Interface<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md)</ept><ph id=\"ph1\"> </ph>","pos":[4512,4631],"source":"[ICorProfilerCallback Interface](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md) "},{"content":"<bpt id=\"p1\"> [</bpt>MovedReferences2 Method<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-movedreferences2-method.md)</ept><ph id=\"ph1\"> </ph>","pos":[4634,4762],"source":" [MovedReferences2 Method](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-movedreferences2-method.md) "},{"content":"<bpt id=\"p1\"> [</bpt>Profiling Interfaces<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/profiling-interfaces.md)</ept><ph id=\"ph1\"> </ph>","pos":[4765,4865],"source":" [Profiling Interfaces](../../../../docs/framework/unmanaged-api/profiling/profiling-interfaces.md) "},{"content":"<bpt id=\"p1\"> [</bpt>Profiling<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/index.md)</ept>","pos":[4868,4941],"source":" [Profiling](../../../../docs/framework/unmanaged-api/profiling/index.md)"}]}