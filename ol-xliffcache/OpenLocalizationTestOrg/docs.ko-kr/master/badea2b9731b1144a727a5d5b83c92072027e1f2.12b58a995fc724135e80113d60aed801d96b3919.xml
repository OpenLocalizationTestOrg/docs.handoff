{"content":"---\ntitle: \"How to: Deserialize Instance Data Properties\"\nms.date: \"03/30/2017\"\nms.assetid: b13a3508-1b97-4359-b336-03d85fa23bc4\n---\n# How to: Deserialize Instance Data Properties\nThere may be situations when a user or workflow administrator may want to manually inspect the state of a persisted workflow instance. <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> provides a view on the Instances table that exposes the following four columns:  \n  \n-   ReadWritePrimitiveDataProperties  \n  \n-   WriteOnlyPrimitiveDataProperties  \n  \n-   ReadWriteComplexDataProperties  \n  \n-   WriteOnlyComplexDataProperties  \n  \n Primitive data properties refer to properties whose .NET Framework types are considered to be \"common\" (for example, Int32 and String), while complex data properties refer to all other types. An exact enumeration of primitive types is found later in this code example.  \n  \n Read/write properties refer to properties that are returned back to the Workflow Runtime when an instance is loaded. WriteOnly properties are written to the database and then never read again.  \n  \n This example provides code that enables a user to deserialize primitive data properties. Given a byte array read from either the ReadWritePrimitiveDataProperties or WriteOnlyPrimitiveDataProperties column, this code will convert the binary large object (BLOB) into a <xref:System.Collections.Generic.Dictionary%602> of type \\<XName, object> where each key value pair represents a property name and its corresponding value.  \n  \n This example does not demonstrate how to deserialize complex data properties because this is currently not a supported operation.  \n  \n```  \nusing System;  \nusing System.Collections.Generic;  \nusing System.Linq;  \nusing System.Text;  \nusing System.IO;  \nusing System.IO.Compression;  \nusing System.Xml.Linq;  \nusing System.Xml;  \nusing System.Globalization;  \nusing System.Data.SqlClient;  \n  \nnamespace PropertyReader  \n{  \n    class Program  \n    {  \n        const string ConnectionString = @\"Data Source=localhost;Initial Catalog=Persistence;Integrated Security=True;Asynchronous Processing=True\";  \n        static void Main(string[] args)  \n        {  \n            string queryString = \"SELECT TOP 10 * FROM [System.Activities.DurableInstancing].[Instances]\";  \n  \n            using (SqlConnection connection =  \n                       new SqlConnection(ConnectionString))  \n            {  \n                SqlCommand command =  \n                    new SqlCommand(queryString, connection);  \n                connection.Open();  \n  \n                SqlDataReader reader = command.ExecuteReader();  \n  \n                byte encodingOption;  \n  \n                while (reader.Read())  \n                {  \n                    if (reader[\"ReadWritePrimitiveDataProperties\"] != DBNull.Value)  \n                    {  \n                        encodingOption = (byte)reader[\"EncodingOption\"];  \n                        Console.WriteLine(\"Printing the ReadWritePrimitiveDataProperties of the instance with Id:\" + reader[\"InstanceId\"]);  \n                        foreach (KeyValuePair<XName, object> pair in (Dictionary<XName, object>)ReadDataProperties((byte[])reader[\"ReadWritePrimitiveDataProperties\"], encodingOption))  \n                        {  \n                            Console.WriteLine(\"{0}, {1}\" , pair.Key, pair.Value);  \n                        }  \n                        Console.WriteLine();  \n                    }  \n                    if (reader[\"WriteOnlyPrimitiveDataProperties\"] != DBNull.Value)  \n                    {  \n                        encodingOption = (byte)reader[\"EncodingOption\"];  \n                        Console.WriteLine(\"Printing the WriteOnlyPrimitiveDataProperties of the instance with Id:\" + reader[\"InstanceId\"]);  \n                        foreach (KeyValuePair<XName, object> pair in (Dictionary<XName, object>)ReadDataProperties((byte[])reader[\"WriteOnlyPrimitiveDataProperties\"], encodingOption))  \n                        {  \n                            Console.WriteLine(\"{0}, {1}\", pair.Key, pair.Value);  \n                        }  \n                        Console.WriteLine();  \n                    }  \n                }  \n  \n                // Call Close when done reading.  \n                reader.Close();  \n            }  \n  \n            Console.ReadLine();  \n  \n        }  \n  \n        static Dictionary<XName, object> ReadDataProperties(byte[] serializedDataProperties, byte encodingOption)  \n        {  \n            if (serializedDataProperties != null)  \n            {  \n                Dictionary<XName, object> propertyBag = new Dictionary<XName, object>();  \n                bool isCompressed = (encodingOption == 1);  \n  \n                using (MemoryStream memoryStream = new MemoryStream(serializedDataProperties))  \n                {  \n                    // if the instance state is compressed using GZip algorithm  \n                    if (isCompressed)  \n                    {  \n                        // decompress the data using the GZip   \n                        using (GZipStream stream = new GZipStream(memoryStream, CompressionMode.Decompress))  \n                        {  \n                            // create an XmlReader object and pass it on to the helper method ReadPrimitiveDataProperties  \n                            using (XmlReader reader = XmlDictionaryReader.CreateBinaryReader(stream, XmlDictionaryReaderQuotas.Max))  \n                            {  \n                                // invoke the helper method  \n                                ReadPrimitiveDataProperties(reader, propertyBag);  \n                            }  \n                        }  \n                    }  \n                    else  \n                    {  \n                        // if the instance data is not compressed   \n                        // create an XmlReader object and pass it on to the helper method ReadPrimitiveDataProperties  \n                        using (XmlReader reader = XmlDictionaryReader.CreateBinaryReader(memoryStream, XmlDictionaryReaderQuotas.Max))  \n                        {  \n                            // invoke the helper method  \n                            ReadPrimitiveDataProperties(reader, propertyBag);  \n                        }  \n                    }  \n                    return propertyBag;  \n                }  \n            }  \n  \n            return null;  \n        }  \n  \n        // reads the primitive data properties from the XML stream  \n        // invoked by the ReadDataProperties method  \n        static void ReadPrimitiveDataProperties(XmlReader reader, Dictionary<XName, object> propertyBag)  \n        {  \n            const string xmlElementName = \"Property\";  \n  \n            if (reader.ReadToDescendant(xmlElementName))  \n            {  \n                do  \n                {  \n                    // get the name of the property  \n                    reader.MoveToFirstAttribute();  \n                    string propertyName = reader.Value;  \n  \n                    // get the type of the property  \n                    reader.MoveToNextAttribute();  \n                    PrimitiveType type = (PrimitiveType)Int32.Parse(reader.Value, CultureInfo.InvariantCulture);  \n  \n                    // get the value of the property  \n                    reader.MoveToNextAttribute();  \n                    object propertyValue = ConvertStringToNativeType(reader.Value, type);  \n  \n                    // add the name and value of the property to the property bag  \n                    propertyBag.Add(propertyName, propertyValue);  \n                }  \n  \n                while (reader.ReadToNextSibling(xmlElementName));  \n            }  \n        }  \n  \n        // invoked by the ReadPrimitiveDataProperties method  \n        // Given a property value as parsed from an XML attribute, and the .NET Type of the Property, recreates the actual property value  \n        // (e.g. Given a property value of \"1\" and a PrimitiveType of Int32, this method will return an object of type Int32 with value 1)  \n        static object ConvertStringToNativeType(string value, PrimitiveType type)  \n        {  \n            switch (type)  \n            {  \n                case PrimitiveType.Bool:  \n                    return XmlConvert.ToBoolean(value);  \n                case PrimitiveType.Byte:  \n                    return XmlConvert.ToByte(value);  \n                case PrimitiveType.Char:  \n                    return XmlConvert.ToChar(value);  \n                case PrimitiveType.DateTime:  \n                    return XmlConvert.ToDateTime(value, XmlDateTimeSerializationMode.RoundtripKind);  \n                case PrimitiveType.DateTimeOffset:  \n                    return XmlConvert.ToDateTimeOffset(value);  \n                case PrimitiveType.Decimal:  \n                    return XmlConvert.ToDecimal(value);  \n                case PrimitiveType.Double:  \n                    return XmlConvert.ToDouble(value);  \n                case PrimitiveType.Float:  \n                    return float.Parse(value, CultureInfo.InvariantCulture);  \n                case PrimitiveType.Guid:  \n                    return XmlConvert.ToGuid(value);  \n                case PrimitiveType.Int:  \n                    return XmlConvert.ToInt32(value);  \n                case PrimitiveType.Long:  \n                    return XmlConvert.ToInt64(value);  \n                case PrimitiveType.SByte:  \n                    return XmlConvert.ToSByte(value);  \n                case PrimitiveType.Short:  \n                    return XmlConvert.ToInt16(value);  \n                case PrimitiveType.String:  \n                    return value;  \n                case PrimitiveType.TimeSpan:  \n                    return XmlConvert.ToTimeSpan(value);  \n                case PrimitiveType.Type:  \n                    return Type.GetType(value);  \n                case PrimitiveType.UInt:  \n                    return XmlConvert.ToUInt32(value);  \n                case PrimitiveType.ULong:  \n                    return XmlConvert.ToUInt64(value);  \n                case PrimitiveType.Uri:  \n                    return new Uri(value);  \n                case PrimitiveType.UShort:  \n                    return XmlConvert.ToUInt16(value);  \n                case PrimitiveType.XmlQualifiedName:  \n                    return new XmlQualifiedName(value);  \n                case PrimitiveType.Null:  \n                case PrimitiveType.Unavailable:  \n                default:  \n                    return null;  \n            }  \n        }  \n        // .NET Types which SQL Workflow Instance Store considers to be Primitive. Any other .NET type not listed in this enumeration is a \"Complex\" property.  \n        enum PrimitiveType  \n        {  \n            Bool = 0,  \n            Byte,  \n            Char,  \n            DateTime,  \n            DateTimeOffset,  \n            Decimal,  \n            Double,  \n            Float,  \n            Guid,  \n            Int,  \n            Null,  \n            Long,  \n            SByte,  \n            Short,  \n            String,  \n            TimeSpan,  \n            Type,  \n            UInt,  \n            ULong,  \n            Uri,  \n            UShort,  \n            XmlQualifiedName,  \n            Unavailable = 99  \n        }  \n    }  \n}  \n```\n","nodes":[{"pos":[4,128],"embed":true,"restype":"x-metadata","content":"title: \"How to: Deserialize Instance Data Properties\"\nms.date: \"03/30/2017\"\nms.assetid: b13a3508-1b97-4359-b336-03d85fa23bc4","nodes":[{"content":"How to: Deserialize Instance Data Properties","nodes":[{"pos":[0,44],"content":"How to: Deserialize Instance Data Properties","nodes":[{"content":"How to: Deserialize Instance Data Properties","pos":[0,44]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[135,179],"content":"How to: Deserialize Instance Data Properties","linkify":"How to: Deserialize Instance Data Properties","nodes":[{"content":"How to: Deserialize Instance Data Properties","pos":[0,44]}]},{"content":"There may be situations when a user or workflow administrator may want to manually inspect the state of a persisted workflow instance.","pos":[180,314]},{"content":"<ph id=\"ph1\">&lt;xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore&gt;</ph> provides a view on the Instances table that exposes the following four columns:","pos":[315,462],"source":"<xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> provides a view on the Instances table that exposes the following four columns:"},{"content":"ReadWritePrimitiveDataProperties","pos":[472,504]},{"content":"WriteOnlyPrimitiveDataProperties","pos":[514,546]},{"content":"ReadWriteComplexDataProperties","pos":[556,586]},{"content":"WriteOnlyComplexDataProperties","pos":[596,626]},{"content":"Primitive data properties refer to properties whose .NET Framework types are considered to be \"common\" (for example, Int32 and String), while complex data properties refer to all other types.","pos":[633,824]},{"content":"An exact enumeration of primitive types is found later in this code example.","pos":[825,901]},{"content":"Read/write properties refer to properties that are returned back to the Workflow Runtime when an instance is loaded.","pos":[908,1024]},{"content":"WriteOnly properties are written to the database and then never read again.","pos":[1025,1100]},{"content":"This example provides code that enables a user to deserialize primitive data properties.","pos":[1107,1195]},{"content":"Given a byte array read from either the ReadWritePrimitiveDataProperties or WriteOnlyPrimitiveDataProperties column, this code will convert the binary large object (BLOB) into a <ph id=\"ph1\">&lt;xref:System.Collections.Generic.Dictionary%602&gt;</ph> of type <ph id=\"ph2\">\\&lt;</ph>XName, object&gt; where each key value pair represents a property name and its corresponding value.","pos":[1196,1529],"source":" Given a byte array read from either the ReadWritePrimitiveDataProperties or WriteOnlyPrimitiveDataProperties column, this code will convert the binary large object (BLOB) into a <xref:System.Collections.Generic.Dictionary%602> of type \\<XName, object> where each key value pair represents a property name and its corresponding value."},{"content":"This example does not demonstrate how to deserialize complex data properties because this is currently not a supported operation.","pos":[1536,1665]}]}