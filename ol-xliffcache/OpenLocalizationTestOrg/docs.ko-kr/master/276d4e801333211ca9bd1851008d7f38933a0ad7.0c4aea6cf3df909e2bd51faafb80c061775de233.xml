{"content":"---\ntitle: \"SyncLock Statement | Microsoft Docs\"\n\nms.date: \"2015-07-20\"\nms.prod: .net\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-visual-basic\"\n\nms.topic: \"article\"\nf1_keywords: \n  - \"vb.SyncLock\"\n  - \"SyncLock\"\ndev_langs: \n  - \"VB\"\nhelpviewer_keywords: \n  - \"threading [Visual Basic], locks\"\n  - \"SyncLock statement\"\n  - \"locks, threads\"\nms.assetid: 14501703-298f-4d43-b139-c4b6366af176\ncaps.latest.revision: 17\nauthor: dotnet-bot\nms.author: dotnetcontent\n\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# SyncLock Statement\nAcquires an exclusive lock for a statement block before executing the block.  \n  \n## Syntax  \n  \n```  \nSyncLock lockobject  \n    [ block ]  \nEnd SyncLock  \n```  \n  \n## Parts  \n `lockobject`  \n Required. Expression that evaluates to an object reference.  \n  \n `block`  \n Optional. Block of statements that are to execute when the lock is acquired.  \n  \n `End SyncLock`  \n Terminates a `SyncLock` block.  \n  \n## Remarks  \n The `SyncLock` statement ensures that multiple threads do not execute the statement block at the same time. `SyncLock` prevents each thread from entering the block until no other thread is executing it.  \n  \n The most common use of `SyncLock` is to protect data from being updated by more than one thread simultaneously. If the statements that manipulate the data must go to completion without interruption, put them inside a `SyncLock` block.  \n  \n A statement block protected by an exclusive lock is sometimes called a *critical section*.  \n  \n## Rules  \n  \n-   Branching. You cannot branch into a `SyncLock` block from outside the block.  \n  \n-   Lock Object Value. The value of `lockobject` cannot be `Nothing`. You must create the lock object before you use it in a `SyncLock` statement.  \n  \n     You cannot change the value of `lockobject` while executing a `SyncLock` block. The mechanism requires that the lock object remain unchanged.  \n  \n-   You can't use the [Await](../../../visual-basic/language-reference/operators/await-operator.md) operator in a `SyncLock` block.  \n  \n## Behavior  \n  \n-   Mechanism. When a thread reaches the `SyncLock` statement, it evaluates the `lockobject` expression and suspends execution until it acquires an exclusive lock on the object returned by the expression. When another thread reaches the `SyncLock` statement, it does not acquire a lock until the first thread executes the `End SyncLock` statement.  \n  \n-   Protected Data. If `lockobject` is a `Shared` variable, the exclusive lock prevents a thread in any instance of the class from executing the `SyncLock` block while any other thread is executing it. This protects data that is shared among all the instances.  \n  \n     If `lockobject` is an instance variable (not `Shared`), the lock prevents a thread running in the current instance from executing the `SyncLock` block at the same time as another thread in the same instance. This protects data maintained by the individual instance.  \n  \n-   Acquisition and Release. A `SyncLock` block behaves like a `Try...Finally` construction in which the `Try` block acquires an exclusive lock on `lockobject` and the `Finally` block releases it. Because of this, the `SyncLock` block guarantees release of the lock, no matter how you exit the block. This is true even in the case of an unhandled exception.  \n  \n-   Framework Calls. The `SyncLock` block acquires and releases the exclusive lock by calling the `Enter` and `Exit` methods of the `Monitor` class in the <xref:System.Threading> namespace.  \n  \n## Programming Practices  \n The `lockobject` expression should always evaluate to an object that belongs exclusively to your class. You should declare a `Private` object variable to protect data belonging to the current instance, or a `Private Shared` object variable to protect data common to all instances.  \n  \n You should not use the `Me` keyword to provide a lock object for instance data. If code external to your class has a reference to an instance of your class, it could use that reference as a lock object for a `SyncLock` block completely different from yours, protecting different data. In this way, your class and the other class could block each other from executing their unrelated `SyncLock` blocks. Similarly locking on a string can be problematic since any other code in the process using the same string will share the same lock.  \n  \n You should also not use the `Me.GetType` method to provide a lock object for shared data. This is because `GetType` always returns the same `Type` object for a given class name. External code could call `GetType` on your class and obtain the same lock object you are using. This would result in the two classes blocking each other from their `SyncLock` blocks.  \n  \n## Examples  \n  \n### Description  \n The following example shows a class that maintains a simple list of messages. It holds the messages in an array and the last used element of that array in a variable. The `addAnotherMessage` procedure increments the last element and stores the new message. Those two operations are protected by the `SyncLock` and `End SyncLock` statements, because once the last element has been incremented, the new message must be stored before any other thread can increment the last element again.  \n  \n If the `simpleMessageList` class shared one list of messages among all its instances, the variables `messagesList` and `messagesLast` would be declared as `Shared`. In this case, the variable `messagesLock` should also be `Shared`, so that there would be a single lock object used by every instance.  \n  \n### Code  \n [!code-vb[VbVbalrThreading#1](../../../visual-basic/language-reference/statements/codesnippet/VisualBasic/synclock-statement_1.vb)]  \n  \n### Description  \n The following example uses threads and `SyncLock`. As long as the `SyncLock` statement is present, the statement block is a critical section and `balance` never becomes a negative number. You can comment out the `SyncLock` and `End SyncLock` statements to see the effect of leaving out the `SyncLock` keyword.  \n  \n### Code  \n [!code-vb[VbVbalrThreading#21](../../../visual-basic/language-reference/statements/codesnippet/VisualBasic/synclock-statement_2.vb)]  \n  \n### Comments  \n  \n## See Also  \n <xref:System.Threading>   \n <xref:System.Threading.Monitor>   \n [Thread Synchronization](http://msdn.microsoft.com/library/413e1f28-a2c5-4eec-8338-aa43e7982ff4)   \n [Threading](http://msdn.microsoft.com/library/552f6c68-dbdb-4327-ae36-32cf9063d88c)","nodes":[{"pos":[12,47],"content":"SyncLock Statement | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"SyncLock Statement | Microsoft Docs","pos":[0,35]}]},{"pos":[660,678],"content":"SyncLock Statement","linkify":"SyncLock Statement","nodes":[{"content":"SyncLock Statement","pos":[0,18]}]},{"content":"Acquires an exclusive lock for a statement block before executing the block.","pos":[679,755]},{"pos":[764,770],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[847,852],"content":"Parts","linkify":"Parts","nodes":[{"content":"Parts","pos":[0,5]}]},{"content":"Required.","pos":[872,881]},{"content":"Expression that evaluates to an object reference.","pos":[882,931]},{"content":"Optional.","pos":[949,958]},{"content":"Block of statements that are to execute when the lock is acquired.","pos":[959,1025]},{"content":"Terminates a <ph id=\"ph1\">`SyncLock`</ph> block.","pos":[1050,1080],"source":" Terminates a `SyncLock` block."},{"pos":[1089,1096],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"The <ph id=\"ph1\">`SyncLock`</ph> statement ensures that multiple threads do not execute the statement block at the same time.","pos":[1100,1207],"source":"The `SyncLock` statement ensures that multiple threads do not execute the statement block at the same time."},{"content":"<ph id=\"ph1\">`SyncLock`</ph> prevents each thread from entering the block until no other thread is executing it.","pos":[1208,1302],"source":"`SyncLock` prevents each thread from entering the block until no other thread is executing it."},{"content":"The most common use of <ph id=\"ph1\">`SyncLock`</ph> is to protect data from being updated by more than one thread simultaneously.","pos":[1309,1420],"source":"The most common use of `SyncLock` is to protect data from being updated by more than one thread simultaneously."},{"content":"If the statements that manipulate the data must go to completion without interruption, put them inside a <ph id=\"ph1\">`SyncLock`</ph> block.","pos":[1421,1543],"source":" If the statements that manipulate the data must go to completion without interruption, put them inside a `SyncLock` block."},{"pos":[1550,1640],"content":"A statement block protected by an exclusive lock is sometimes called a <bpt id=\"p1\">*</bpt>critical section<ept id=\"p1\">*</ept>.","source":"A statement block protected by an exclusive lock is sometimes called a *critical section*."},{"pos":[1649,1654],"content":"Rules","linkify":"Rules","nodes":[{"content":"Rules","pos":[0,5]}]},{"content":"Branching.","pos":[1664,1674]},{"content":"You cannot branch into a <ph id=\"ph1\">`SyncLock`</ph> block from outside the block.","pos":[1675,1740],"source":" You cannot branch into a `SyncLock` block from outside the block."},{"content":"Lock Object Value.","pos":[1750,1768]},{"content":"The value of <ph id=\"ph1\">`lockobject`</ph> cannot be <ph id=\"ph2\">`Nothing`</ph>.","pos":[1769,1815],"source":" The value of `lockobject` cannot be `Nothing`."},{"content":"You must create the lock object before you use it in a <ph id=\"ph1\">`SyncLock`</ph> statement.","pos":[1816,1892],"source":" You must create the lock object before you use it in a `SyncLock` statement."},{"content":"You cannot change the value of <ph id=\"ph1\">`lockobject`</ph> while executing a <ph id=\"ph2\">`SyncLock`</ph> block.","pos":[1903,1982],"source":"You cannot change the value of `lockobject` while executing a `SyncLock` block."},{"content":"The mechanism requires that the lock object remain unchanged.","pos":[1983,2044]},{"pos":[2054,2181],"content":"You can't use the <bpt id=\"p1\">[</bpt>Await<ept id=\"p1\">](../../../visual-basic/language-reference/operators/await-operator.md)</ept> operator in a <ph id=\"ph1\">`SyncLock`</ph> block.","source":"You can't use the [Await](../../../visual-basic/language-reference/operators/await-operator.md) operator in a `SyncLock` block."},{"pos":[2190,2198],"content":"Behavior","linkify":"Behavior","nodes":[{"content":"Behavior","pos":[0,8]}]},{"content":"Mechanism.","pos":[2208,2218]},{"content":"When a thread reaches the <ph id=\"ph1\">`SyncLock`</ph> statement, it evaluates the <ph id=\"ph2\">`lockobject`</ph> expression and suspends execution until it acquires an exclusive lock on the object returned by the expression.","pos":[2219,2408],"source":" When a thread reaches the `SyncLock` statement, it evaluates the `lockobject` expression and suspends execution until it acquires an exclusive lock on the object returned by the expression."},{"content":"When another thread reaches the <ph id=\"ph1\">`SyncLock`</ph> statement, it does not acquire a lock until the first thread executes the <ph id=\"ph2\">`End SyncLock`</ph> statement.","pos":[2409,2551],"source":" When another thread reaches the `SyncLock` statement, it does not acquire a lock until the first thread executes the `End SyncLock` statement."},{"content":"Protected Data.","pos":[2561,2576]},{"content":"If <ph id=\"ph1\">`lockobject`</ph> is a <ph id=\"ph2\">`Shared`</ph> variable, the exclusive lock prevents a thread in any instance of the class from executing the <ph id=\"ph3\">`SyncLock`</ph> block while any other thread is executing it.","pos":[2577,2758],"source":" If `lockobject` is a `Shared` variable, the exclusive lock prevents a thread in any instance of the class from executing the `SyncLock` block while any other thread is executing it."},{"content":"This protects data that is shared among all the instances.","pos":[2759,2817]},{"content":"If <ph id=\"ph1\">`lockobject`</ph> is an instance variable (not <ph id=\"ph2\">`Shared`</ph>), the lock prevents a thread running in the current instance from executing the <ph id=\"ph3\">`SyncLock`</ph> block at the same time as another thread in the same instance.","pos":[2828,3035],"source":"If `lockobject` is an instance variable (not `Shared`), the lock prevents a thread running in the current instance from executing the `SyncLock` block at the same time as another thread in the same instance."},{"content":"This protects data maintained by the individual instance.","pos":[3036,3093]},{"content":"Acquisition and Release.","pos":[3103,3127]},{"content":"A <ph id=\"ph1\">`SyncLock`</ph> block behaves like a <ph id=\"ph2\">`Try...Finally`</ph> construction in which the <ph id=\"ph3\">`Try`</ph> block acquires an exclusive lock on <ph id=\"ph4\">`lockobject`</ph> and the <ph id=\"ph5\">`Finally`</ph> block releases it.","pos":[3128,3295],"source":" A `SyncLock` block behaves like a `Try...Finally` construction in which the `Try` block acquires an exclusive lock on `lockobject` and the `Finally` block releases it."},{"content":"Because of this, the <ph id=\"ph1\">`SyncLock`</ph> block guarantees release of the lock, no matter how you exit the block.","pos":[3296,3399],"source":" Because of this, the `SyncLock` block guarantees release of the lock, no matter how you exit the block."},{"content":"This is true even in the case of an unhandled exception.","pos":[3400,3456]},{"content":"Framework Calls.","pos":[3466,3482]},{"content":"The <ph id=\"ph1\">`SyncLock`</ph> block acquires and releases the exclusive lock by calling the <ph id=\"ph2\">`Enter`</ph> and <ph id=\"ph3\">`Exit`</ph> methods of the <ph id=\"ph4\">`Monitor`</ph> class in the <ph id=\"ph5\">&lt;xref:System.Threading&gt;</ph> namespace.","pos":[3483,3651],"source":" The `SyncLock` block acquires and releases the exclusive lock by calling the `Enter` and `Exit` methods of the `Monitor` class in the <xref:System.Threading> namespace."},{"pos":[3660,3681],"content":"Programming Practices","linkify":"Programming Practices","nodes":[{"content":"Programming Practices","pos":[0,21]}]},{"content":"The <ph id=\"ph1\">`lockobject`</ph> expression should always evaluate to an object that belongs exclusively to your class.","pos":[3685,3788],"source":"The `lockobject` expression should always evaluate to an object that belongs exclusively to your class."},{"content":"You should declare a <ph id=\"ph1\">`Private`</ph> object variable to protect data belonging to the current instance, or a <ph id=\"ph2\">`Private Shared`</ph> object variable to protect data common to all instances.","pos":[3789,3965],"source":" You should declare a `Private` object variable to protect data belonging to the current instance, or a `Private Shared` object variable to protect data common to all instances."},{"content":"You should not use the <ph id=\"ph1\">`Me`</ph> keyword to provide a lock object for instance data.","pos":[3972,4051],"source":"You should not use the `Me` keyword to provide a lock object for instance data."},{"content":"If code external to your class has a reference to an instance of your class, it could use that reference as a lock object for a <ph id=\"ph1\">`SyncLock`</ph> block completely different from yours, protecting different data.","pos":[4052,4256],"source":" If code external to your class has a reference to an instance of your class, it could use that reference as a lock object for a `SyncLock` block completely different from yours, protecting different data."},{"content":"In this way, your class and the other class could block each other from executing their unrelated <ph id=\"ph1\">`SyncLock`</ph> blocks.","pos":[4257,4373],"source":" In this way, your class and the other class could block each other from executing their unrelated `SyncLock` blocks."},{"content":"Similarly locking on a string can be problematic since any other code in the process using the same string will share the same lock.","pos":[4374,4506]},{"content":"You should also not use the <ph id=\"ph1\">`Me.GetType`</ph> method to provide a lock object for shared data.","pos":[4513,4602],"source":"You should also not use the `Me.GetType` method to provide a lock object for shared data."},{"content":"This is because <ph id=\"ph1\">`GetType`</ph> always returns the same <ph id=\"ph2\">`Type`</ph> object for a given class name.","pos":[4603,4690],"source":" This is because `GetType` always returns the same `Type` object for a given class name."},{"content":"External code could call <ph id=\"ph1\">`GetType`</ph> on your class and obtain the same lock object you are using.","pos":[4691,4786],"source":" External code could call `GetType` on your class and obtain the same lock object you are using."},{"content":"This would result in the two classes blocking each other from their <ph id=\"ph1\">`SyncLock`</ph> blocks.","pos":[4787,4873],"source":" This would result in the two classes blocking each other from their `SyncLock` blocks."},{"pos":[4882,4890],"content":"Examples","linkify":"Examples","nodes":[{"content":"Examples","pos":[0,8]}]},{"pos":[4900,4911],"content":"Description","linkify":"Description","nodes":[{"content":"Description","pos":[0,11]}]},{"content":"The following example shows a class that maintains a simple list of messages.","pos":[4915,4992]},{"content":"It holds the messages in an array and the last used element of that array in a variable.","pos":[4993,5081]},{"content":"The <ph id=\"ph1\">`addAnotherMessage`</ph> procedure increments the last element and stores the new message.","pos":[5082,5171],"source":" The `addAnotherMessage` procedure increments the last element and stores the new message."},{"content":"Those two operations are protected by the <ph id=\"ph1\">`SyncLock`</ph> and <ph id=\"ph2\">`End SyncLock`</ph> statements, because once the last element has been incremented, the new message must be stored before any other thread can increment the last element again.","pos":[5172,5400],"source":" Those two operations are protected by the `SyncLock` and `End SyncLock` statements, because once the last element has been incremented, the new message must be stored before any other thread can increment the last element again."},{"content":"If the <ph id=\"ph1\">`simpleMessageList`</ph> class shared one list of messages among all its instances, the variables <ph id=\"ph2\">`messagesList`</ph> and <ph id=\"ph3\">`messagesLast`</ph> would be declared as <ph id=\"ph4\">`Shared`</ph>.","pos":[5407,5571],"source":"If the `simpleMessageList` class shared one list of messages among all its instances, the variables `messagesList` and `messagesLast` would be declared as `Shared`."},{"content":"In this case, the variable <ph id=\"ph1\">`messagesLock`</ph> should also be <ph id=\"ph2\">`Shared`</ph>, so that there would be a single lock object used by every instance.","pos":[5572,5706],"source":" In this case, the variable `messagesLock` should also be `Shared`, so that there would be a single lock object used by every instance."},{"pos":[5716,5720],"content":"Code","linkify":"Code","nodes":[{"content":"Code","pos":[0,4]}]},{"pos":[5724,5855],"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>VbVbalrThreading#1<ept id=\"p2\">](../../../visual-basic/language-reference/statements/codesnippet/VisualBasic/synclock-statement_1.vb)</ept><ept id=\"p1\">]</ept>","source":"[!code-vb[VbVbalrThreading#1](../../../visual-basic/language-reference/statements/codesnippet/VisualBasic/synclock-statement_1.vb)]"},{"pos":[5865,5876],"content":"Description","linkify":"Description","nodes":[{"content":"Description","pos":[0,11]}]},{"content":"The following example uses threads and <ph id=\"ph1\">`SyncLock`</ph>.","pos":[5880,5930],"source":"The following example uses threads and `SyncLock`."},{"content":"As long as the <ph id=\"ph1\">`SyncLock`</ph> statement is present, the statement block is a critical section and <ph id=\"ph2\">`balance`</ph> never becomes a negative number.","pos":[5931,6067],"source":" As long as the `SyncLock` statement is present, the statement block is a critical section and `balance` never becomes a negative number."},{"content":"You can comment out the <ph id=\"ph1\">`SyncLock`</ph> and <ph id=\"ph2\">`End SyncLock`</ph> statements to see the effect of leaving out the <ph id=\"ph3\">`SyncLock`</ph> keyword.","pos":[6068,6189],"source":" You can comment out the `SyncLock` and `End SyncLock` statements to see the effect of leaving out the `SyncLock` keyword."},{"pos":[6199,6203],"content":"Code","linkify":"Code","nodes":[{"content":"Code","pos":[0,4]}]},{"pos":[6207,6339],"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>VbVbalrThreading#21<ept id=\"p2\">](../../../visual-basic/language-reference/statements/codesnippet/VisualBasic/synclock-statement_2.vb)</ept><ept id=\"p1\">]</ept>","source":"[!code-vb[VbVbalrThreading#21](../../../visual-basic/language-reference/statements/codesnippet/VisualBasic/synclock-statement_2.vb)]"},{"pos":[6349,6357],"content":"Comments","linkify":"Comments","nodes":[{"content":"Comments","pos":[0,8]}]},{"pos":[6366,6374],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\"> [</bpt>Thread Synchronization<ept id=\"p1\">](http://msdn.microsoft.com/library/413e1f28-a2c5-4eec-8338-aa43e7982ff4)</ept><ph id=\"ph1\"> </ph>","pos":[6441,6539],"source":" [Thread Synchronization](http://msdn.microsoft.com/library/413e1f28-a2c5-4eec-8338-aa43e7982ff4) "},{"content":"<bpt id=\"p1\"> [</bpt>Threading<ept id=\"p1\">](http://msdn.microsoft.com/library/552f6c68-dbdb-4327-ae36-32cf9063d88c)</ept>","pos":[6542,6626],"source":" [Threading](http://msdn.microsoft.com/library/552f6c68-dbdb-4327-ae36-32cf9063d88c)"}]}