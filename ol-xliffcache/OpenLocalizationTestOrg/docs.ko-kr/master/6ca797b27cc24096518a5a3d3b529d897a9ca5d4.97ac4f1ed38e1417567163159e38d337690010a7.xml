{"content":"---\ntitle: \"User Defined Functions and Variables | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\n  - \"CSharp\"\n  - \"C++\"\n  - \"jsharp\"\nms.assetid: 4772f20e-1e7f-496e-93c2-1484473be555\ncaps.latest.revision: 2\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"\n---\n# User Defined Functions and Variables\nThe <xref:System.Xml.XPath.XPathNavigator> class provides a set of methods that are used to interact with <xref:System.Xml.XPath.XPathDocument> data. You can supplement the standard XPath functions by implementing extension functions and variables for use by XPath query expressions. The <xref:System.Xml.XPath.XPathExpression.SetContext%2A> method can accept a user defined context derived from <xref:System.Xml.Xsl.XsltContext>. User defined functions are resolved by the custom context.  \n  \n Extension functions and variables can be useful in prevention of XML injection attacks. In these scenarios user input is assigned to custom variables and processed by extension functions, not as raw input concatenated with processing instructions. Extension functions and variables contain user input so that it only acts on XML data as intended by the designer.  \n  \n To use extensions you implement a custom <xref:System.Xml.Xsl.XsltContext> class along with the interfaces <xref:System.Xml.Xsl.IXsltContextFunction> and <xref:System.Xml.Xsl.IXsltContextVariable> that support extension functions and variables. An <xref:System.Xml.XPath.XPathExpression> adds user input with its <xref:System.Xml.Xsl.XsltArgumentList> to the custom <xref:System.Xml.Xsl.XsltContext>.  \n  \n The <xref:System.Xml.XPath.XPathExpression> represents a compiled query that <xref:System.Xml.XPath.XPathNavigator> uses to find and process the nodes identified by the expression.  \n  \n The following example shows implementation of a custom context class derived from <xref:System.Xml.Xsl.XsltContext>. Comments in the code describe class members and their use in custom functions. Function and variable implementations and a sample application that uses these implementations follow this code segment.  \n  \n [!code-csharp[XPathExtensionFunctions#2](../../../../samples/snippets/csharp/VS_Snippets_Data/xpathextensionfunctions/cs/xpathextensionfunctions.cs#2)]\n [!code-vb[XPathExtensionFunctions#2](../../../../samples/snippets/visualbasic/VS_Snippets_Data/xpathextensionfunctions/vb/xpathextensionfunctions.vb#2)]  \n  \n The following code implements <xref:System.Xml.Xsl.IXsltContextFunction>. The class that implements <xref:System.Xml.Xsl.IXsltContextFunction> resolves and executes user-defined functions. This example uses the function identified by the declaration: `private int CountChar(string title, char charTocount)`.  \n  \n Code comments describe class members.  \n  \n [!code-csharp[XPathExtensionFunctions#3](../../../../samples/snippets/csharp/VS_Snippets_Data/xpathextensionfunctions/cs/xpathextensionfunctions.cs#3)]\n [!code-vb[XPathExtensionFunctions#3](../../../../samples/snippets/visualbasic/VS_Snippets_Data/xpathextensionfunctions/vb/xpathextensionfunctions.vb#3)]  \n  \n The following code implements <xref:System.Xml.Xsl.IXsltContextVariable>. This class resolves references to user-defined variables in XPath query expressions at run time. An instance of this class is created and returned by the overridden <xref:System.Xml.Xsl.XsltContext.ResolveVariable%2A> method of the custom <xref:System.Xml.Xsl.XsltContext> class.  \n  \n Code comments describe the class members.  \n  \n [!code-csharp[XPathExtensionFunctions#4](../../../../samples/snippets/csharp/VS_Snippets_Data/xpathextensionfunctions/cs/xpathextensionfunctions.cs#4)]\n [!code-vb[XPathExtensionFunctions#4](../../../../samples/snippets/visualbasic/VS_Snippets_Data/xpathextensionfunctions/vb/xpathextensionfunctions.vb#4)]  \n  \n With the previous class definitions in scope, the following code uses the custom function to count characters in the elements of the `Tasks.xml` document. Comments in the code describe the code that compiles the custom function and runs it against the `Tasks.xml` document.  \n  \n [!code-csharp[XPathExtensionFunctions#1](../../../../samples/snippets/csharp/VS_Snippets_Data/xpathextensionfunctions/cs/xpathextensionfunctions.cs#1)]\n [!code-vb[XPathExtensionFunctions#1](../../../../samples/snippets/visualbasic/VS_Snippets_Data/xpathextensionfunctions/vb/xpathextensionfunctions.vb#1)]  \n  \n This example uses the following XML data.  \n  \n [!code-xml[XPathExtensionFunctions#5](../../../../samples/snippets/xml/VS_Snippets_Data/xpathextensionfunctions/XML/tasks.xml#5)]","nodes":[{"pos":[4,403],"embed":true,"restype":"x-metadata","content":"title: \"User Defined Functions and Variables | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\n  - \"CSharp\"\n  - \"C++\"\n  - \"jsharp\"\nms.assetid: 4772f20e-1e7f-496e-93c2-1484473be555\ncaps.latest.revision: 2\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"","nodes":[{"content":"User Defined Functions and Variables | Microsoft Docs","nodes":[{"pos":[0,53],"content":"User Defined Functions and Variables | Microsoft Docs","nodes":[{"content":"User Defined Functions and Variables | Microsoft Docs","pos":[0,53]}]}],"path":["title"]}],"yml":true},{"pos":[410,446],"content":"User Defined Functions and Variables","linkify":"User Defined Functions and Variables","nodes":[{"content":"User Defined Functions and Variables","pos":[0,36]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Xml.XPath.XPathNavigator&gt;</ph> class provides a set of methods that are used to interact with <ph id=\"ph2\">&lt;xref:System.Xml.XPath.XPathDocument&gt;</ph> data.","pos":[447,596],"source":"The <xref:System.Xml.XPath.XPathNavigator> class provides a set of methods that are used to interact with <xref:System.Xml.XPath.XPathDocument> data."},{"content":"You can supplement the standard XPath functions by implementing extension functions and variables for use by XPath query expressions.","pos":[597,730]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Xml.XPath.XPathExpression.SetContext%2A&gt;</ph> method can accept a user defined context derived from <ph id=\"ph2\">&lt;xref:System.Xml.Xsl.XsltContext&gt;</ph>.","pos":[731,877],"source":" The <xref:System.Xml.XPath.XPathExpression.SetContext%2A> method can accept a user defined context derived from <xref:System.Xml.Xsl.XsltContext>."},{"content":"User defined functions are resolved by the custom context.","pos":[878,936]},{"content":"Extension functions and variables can be useful in prevention of XML injection attacks.","pos":[943,1030]},{"content":"In these scenarios user input is assigned to custom variables and processed by extension functions, not as raw input concatenated with processing instructions.","pos":[1031,1190]},{"content":"Extension functions and variables contain user input so that it only acts on XML data as intended by the designer.","pos":[1191,1305]},{"content":"To use extensions you implement a custom <ph id=\"ph1\">&lt;xref:System.Xml.Xsl.XsltContext&gt;</ph> class along with the interfaces <ph id=\"ph2\">&lt;xref:System.Xml.Xsl.IXsltContextFunction&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.Xml.Xsl.IXsltContextVariable&gt;</ph> that support extension functions and variables.","pos":[1312,1556],"source":"To use extensions you implement a custom <xref:System.Xml.Xsl.XsltContext> class along with the interfaces <xref:System.Xml.Xsl.IXsltContextFunction> and <xref:System.Xml.Xsl.IXsltContextVariable> that support extension functions and variables."},{"content":"An <ph id=\"ph1\">&lt;xref:System.Xml.XPath.XPathExpression&gt;</ph> adds user input with its <ph id=\"ph2\">&lt;xref:System.Xml.Xsl.XsltArgumentList&gt;</ph> to the custom <ph id=\"ph3\">&lt;xref:System.Xml.Xsl.XsltContext&gt;</ph>.","pos":[1557,1712],"source":" An <xref:System.Xml.XPath.XPathExpression> adds user input with its <xref:System.Xml.Xsl.XsltArgumentList> to the custom <xref:System.Xml.Xsl.XsltContext>."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Xml.XPath.XPathExpression&gt;</ph> represents a compiled query that <ph id=\"ph2\">&lt;xref:System.Xml.XPath.XPathNavigator&gt;</ph> uses to find and process the nodes identified by the expression.","pos":[1719,1899],"source":"The <xref:System.Xml.XPath.XPathExpression> represents a compiled query that <xref:System.Xml.XPath.XPathNavigator> uses to find and process the nodes identified by the expression."},{"content":"The following example shows implementation of a custom context class derived from <ph id=\"ph1\">&lt;xref:System.Xml.Xsl.XsltContext&gt;</ph>.","pos":[1906,2022],"source":"The following example shows implementation of a custom context class derived from <xref:System.Xml.Xsl.XsltContext>."},{"content":"Comments in the code describe class members and their use in custom functions.","pos":[2023,2101]},{"content":"Function and variable implementations and a sample application that uses these implementations follow this code segment.","pos":[2102,2222]},{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>XPathExtensionFunctions#2<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Data/xpathextensionfunctions/cs/xpathextensionfunctions.cs#2)</ept><ept id=\"p1\">]</ept>","pos":[2229,2380],"source":"[!code-csharp[XPathExtensionFunctions#2](../../../../samples/snippets/csharp/VS_Snippets_Data/xpathextensionfunctions/cs/xpathextensionfunctions.cs#2)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>XPathExtensionFunctions#2<ept id=\"p2\">](../../../../samples/snippets/visualbasic/VS_Snippets_Data/xpathextensionfunctions/vb/xpathextensionfunctions.vb#2)</ept><ept id=\"p1\">]</ept>","pos":[2382,2534],"source":"[!code-vb[XPathExtensionFunctions#2](../../../../samples/snippets/visualbasic/VS_Snippets_Data/xpathextensionfunctions/vb/xpathextensionfunctions.vb#2)]"},{"content":"The following code implements <ph id=\"ph1\">&lt;xref:System.Xml.Xsl.IXsltContextFunction&gt;</ph>.","pos":[2541,2614],"source":"The following code implements <xref:System.Xml.Xsl.IXsltContextFunction>."},{"content":"The class that implements <ph id=\"ph1\">&lt;xref:System.Xml.Xsl.IXsltContextFunction&gt;</ph> resolves and executes user-defined functions.","pos":[2615,2729],"source":" The class that implements <xref:System.Xml.Xsl.IXsltContextFunction> resolves and executes user-defined functions."},{"content":"This example uses the function identified by the declaration: <ph id=\"ph1\">`private int CountChar(string title, char charTocount)`</ph>.","pos":[2730,2848],"source":" This example uses the function identified by the declaration: `private int CountChar(string title, char charTocount)`."},{"content":"Code comments describe class members.","pos":[2855,2892]},{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>XPathExtensionFunctions#3<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Data/xpathextensionfunctions/cs/xpathextensionfunctions.cs#3)</ept><ept id=\"p1\">]</ept>","pos":[2899,3050],"source":"[!code-csharp[XPathExtensionFunctions#3](../../../../samples/snippets/csharp/VS_Snippets_Data/xpathextensionfunctions/cs/xpathextensionfunctions.cs#3)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>XPathExtensionFunctions#3<ept id=\"p2\">](../../../../samples/snippets/visualbasic/VS_Snippets_Data/xpathextensionfunctions/vb/xpathextensionfunctions.vb#3)</ept><ept id=\"p1\">]</ept>","pos":[3052,3204],"source":"[!code-vb[XPathExtensionFunctions#3](../../../../samples/snippets/visualbasic/VS_Snippets_Data/xpathextensionfunctions/vb/xpathextensionfunctions.vb#3)]"},{"content":"The following code implements <ph id=\"ph1\">&lt;xref:System.Xml.Xsl.IXsltContextVariable&gt;</ph>.","pos":[3211,3284],"source":"The following code implements <xref:System.Xml.Xsl.IXsltContextVariable>."},{"content":"This class resolves references to user-defined variables in XPath query expressions at run time.","pos":[3285,3381]},{"content":"An instance of this class is created and returned by the overridden <ph id=\"ph1\">&lt;xref:System.Xml.Xsl.XsltContext.ResolveVariable%2A&gt;</ph> method of the custom <ph id=\"ph2\">&lt;xref:System.Xml.Xsl.XsltContext&gt;</ph> class.","pos":[3382,3564],"source":" An instance of this class is created and returned by the overridden <xref:System.Xml.Xsl.XsltContext.ResolveVariable%2A> method of the custom <xref:System.Xml.Xsl.XsltContext> class."},{"content":"Code comments describe the class members.","pos":[3571,3612]},{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>XPathExtensionFunctions#4<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Data/xpathextensionfunctions/cs/xpathextensionfunctions.cs#4)</ept><ept id=\"p1\">]</ept>","pos":[3619,3770],"source":"[!code-csharp[XPathExtensionFunctions#4](../../../../samples/snippets/csharp/VS_Snippets_Data/xpathextensionfunctions/cs/xpathextensionfunctions.cs#4)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>XPathExtensionFunctions#4<ept id=\"p2\">](../../../../samples/snippets/visualbasic/VS_Snippets_Data/xpathextensionfunctions/vb/xpathextensionfunctions.vb#4)</ept><ept id=\"p1\">]</ept>","pos":[3772,3924],"source":"[!code-vb[XPathExtensionFunctions#4](../../../../samples/snippets/visualbasic/VS_Snippets_Data/xpathextensionfunctions/vb/xpathextensionfunctions.vb#4)]"},{"content":"With the previous class definitions in scope, the following code uses the custom function to count characters in the elements of the <ph id=\"ph1\">`Tasks.xml`</ph> document.","pos":[3931,4085],"source":"With the previous class definitions in scope, the following code uses the custom function to count characters in the elements of the `Tasks.xml` document."},{"content":"Comments in the code describe the code that compiles the custom function and runs it against the <ph id=\"ph1\">`Tasks.xml`</ph> document.","pos":[4086,4204],"source":" Comments in the code describe the code that compiles the custom function and runs it against the `Tasks.xml` document."},{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>XPathExtensionFunctions#1<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_Data/xpathextensionfunctions/cs/xpathextensionfunctions.cs#1)</ept><ept id=\"p1\">]</ept>","pos":[4211,4362],"source":"[!code-csharp[XPathExtensionFunctions#1](../../../../samples/snippets/csharp/VS_Snippets_Data/xpathextensionfunctions/cs/xpathextensionfunctions.cs#1)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>XPathExtensionFunctions#1<ept id=\"p2\">](../../../../samples/snippets/visualbasic/VS_Snippets_Data/xpathextensionfunctions/vb/xpathextensionfunctions.vb#1)</ept><ept id=\"p1\">]</ept>","pos":[4364,4516],"source":"[!code-vb[XPathExtensionFunctions#1](../../../../samples/snippets/visualbasic/VS_Snippets_Data/xpathextensionfunctions/vb/xpathextensionfunctions.vb#1)]"},{"content":"This example uses the following XML data.","pos":[4523,4564]},{"pos":[4571,4700],"content":"<bpt id=\"p1\">[!code-xml</bpt><bpt id=\"p2\">[</bpt>XPathExtensionFunctions#5<ept id=\"p2\">](../../../../samples/snippets/xml/VS_Snippets_Data/xpathextensionfunctions/XML/tasks.xml#5)</ept><ept id=\"p1\">]</ept>","source":"[!code-xml[XPathExtensionFunctions#5](../../../../samples/snippets/xml/VS_Snippets_Data/xpathextensionfunctions/XML/tasks.xml#5)]"}]}