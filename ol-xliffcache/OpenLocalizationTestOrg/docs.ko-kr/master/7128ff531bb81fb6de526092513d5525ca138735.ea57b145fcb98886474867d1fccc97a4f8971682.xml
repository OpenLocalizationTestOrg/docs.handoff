{"content":"---\ntitle: \"Correlation Overview\"\nms.date: \"03/30/2017\"\nms.assetid: edcc0315-5d26-44d6-a36d-ea554c418e9f\n---\n# Correlation Overview\nCorrelation is the mechanism for relating workflow service messages to each other or to the application instance state, such as a reply to an initial request, or a particular order ID to the persisted state of an order-processing workflow. This topic provides an overview of correlation. The other topics in this section provide additional information for each type of correlation.  \n  \n## Types of Correlation  \n Correlation can be protocol-based or content-based. Protocol-based correlations use data provided by the message delivery infrastructure to provide the mapping between messages. Messages that are correlated using protocol-based correlation are related to each other using an object in memory, such as a <xref:System.ServiceModel.Channels.RequestContext>, or by a token provided by the transport protocol. Content-based correlations relate messages to each other using application-specified data. Messages that are correlated using content-based correlation are related to each other by some application-defined data in the message, such as a customer number.  \n  \n Activities that participate in correlation use a <xref:System.ServiceModel.Activities.CorrelationHandle> to tie the messaging activities together. For example, a <xref:System.ServiceModel.Activities.Send> that is used to call a service and a subsequent <xref:System.ServiceModel.Activities.Receive> that is used to receive a callback from the service, share the same <xref:System.ServiceModel.Activities.CorrelationHandle>. This basic pattern is used whether the correlation is content based or protocol based. The correlation handle can be explicitly set on each activity or the activities can be contained in a <xref:System.ServiceModel.Activities.CorrelationScope> activity. Activities contained in a <xref:System.ServiceModel.Activities.CorrelationScope> have their correlation handles managed by the <xref:System.ServiceModel.Activities.CorrelationScope> and do not require the <xref:System.ServiceModel.Activities.CorrelationHandle> to be explicitly set. A <xref:System.ServiceModel.Activities.CorrelationScope> scope provides <xref:System.ServiceModel.Activities.CorrelationHandle> management for a request-reply correlation and one additional correlation type. Workflow services hosted using <xref:System.ServiceModel.Activities.WorkflowServiceHost> have the same default correlation management as the <xref:System.ServiceModel.Activities.CorrelationScope> activity. This default correlation management generally means that in many scenarios, messaging activities in a <xref:System.ServiceModel.Activities.CorrelationScope> or a workflow service do not require their <xref:System.ServiceModel.Activities.CorrelationHandle> set unless multiple messaging activities are in parallel or overlap, such as two <xref:System.ServiceModel.Activities.Receive> activities in parallel, or two <xref:System.ServiceModel.Activities.Send> activities followed by two <xref:System.ServiceModel.Activities.Receive> activities. More information about default correlation is provided in the topics in this section that cover each specific type of correlation. For more information about messaging activities see [Messaging Activities](../../../../docs/framework/wcf/feature-details/messaging-activities.md) and [How to: Create a Workflow Service with Messaging Activities](../../../../docs/framework/wcf/feature-details/how-to-create-a-workflow-service-with-messaging-activities.md).  \n  \n## Protocol-Based Correlation\n\nProtocol-based correlation uses the transport mechanism to relate messages to each other and the appropriate instance. Some system-provided protocol correlations include request-reply correlation and context-based correlation. A request-reply correlation is used to correlate a single pair of messaging activities to form a two-way operation, such as a <xref:System.ServiceModel.Activities.Send> paired with a <xref:System.ServiceModel.Activities.ReceiveReply>, or a <xref:System.ServiceModel.Activities.Receive> paired with a <xref:System.ServiceModel.Activities.SendReply>. The Visual Studio Workflow Designer also provides a set of activity templates to quickly implement this pattern. A context-based correlation is based on the context exchange mechanism described in the [.NET Context Exchange Protocol Specification](https://go.microsoft.com/fwlink/?LinkID=166059). To use context-based correlation, a context-based binding such as <xref:System.ServiceModel.BasicHttpContextBinding>, <xref:System.ServiceModel.WSHttpContextBinding> or <xref:System.ServiceModel.NetTcpContextBinding> must be used on the endpoint.  \n  \nFor more information about protocol correlation, see [Durable Duplex](../../../../docs/framework/wcf/feature-details/durable-duplex-correlation.md) and [Request-Reply](../../../../docs/framework/wcf/feature-details/request-reply-correlation.md). For more information about using the Visual Studio Workflow Designer activity templates, see [Messaging Activities](../../../../docs/framework/wcf/feature-details/messaging-activities.md). For sample code, see the [NetContextExchangeCorrelation](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ee662963%28v%3dvs.100%29) sample.  \n  \n## Content-Based Correlation\n\nContent-based correlation uses some piece of information in the message to associate it to a particular instance. Unlike protocol-based correlation, content-based correlation requires the application author to explicitly state where this data can be found in each related message. Activities that use content-based correlation specify this message data by using a <xref:System.ServiceModel.MessageQuerySet>. Content-based correlation is useful when communicating with services that do not use one of the context bindings such as <xref:System.ServiceModel.BasicHttpContextBinding>.\n  \n## See also\n\n- [NetContextExchangeCorrelation](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ee662963%28v%3dvs.100%29)\n","nodes":[{"pos":[4,104],"embed":true,"restype":"x-metadata","content":"title: \"Correlation Overview\"\nms.date: \"03/30/2017\"\nms.assetid: edcc0315-5d26-44d6-a36d-ea554c418e9f","nodes":[{"content":"Correlation Overview","nodes":[{"pos":[0,20],"content":"Correlation Overview","nodes":[{"content":"Correlation Overview","pos":[0,20]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[111,131],"content":"Correlation Overview","linkify":"Correlation Overview","nodes":[{"content":"Correlation Overview","pos":[0,20]}]},{"content":"Correlation is the mechanism for relating workflow service messages to each other or to the application instance state, such as a reply to an initial request, or a particular order ID to the persisted state of an order-processing workflow.","pos":[132,371]},{"content":"This topic provides an overview of correlation.","pos":[372,419]},{"content":"The other topics in this section provide additional information for each type of correlation.","pos":[420,513]},{"pos":[522,542],"content":"Types of Correlation","linkify":"Types of Correlation","nodes":[{"content":"Types of Correlation","pos":[0,20]}]},{"content":"Correlation can be protocol-based or content-based.","pos":[546,597]},{"content":"Protocol-based correlations use data provided by the message delivery infrastructure to provide the mapping between messages.","pos":[598,723]},{"content":"Messages that are correlated using protocol-based correlation are related to each other using an object in memory, such as a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.RequestContext&gt;</ph>, or by a token provided by the transport protocol.","pos":[724,950],"source":" Messages that are correlated using protocol-based correlation are related to each other using an object in memory, such as a <xref:System.ServiceModel.Channels.RequestContext>, or by a token provided by the transport protocol."},{"content":"Content-based correlations relate messages to each other using application-specified data.","pos":[951,1041]},{"content":"Messages that are correlated using content-based correlation are related to each other by some application-defined data in the message, such as a customer number.","pos":[1042,1204]},{"content":"Activities that participate in correlation use a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.CorrelationHandle&gt;</ph> to tie the messaging activities together.","pos":[1211,1357],"source":"Activities that participate in correlation use a <xref:System.ServiceModel.Activities.CorrelationHandle> to tie the messaging activities together."},{"content":"For example, a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> that is used to call a service and a subsequent <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> that is used to receive a callback from the service, share the same <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.CorrelationHandle&gt;</ph>.","pos":[1358,1634],"source":" For example, a <xref:System.ServiceModel.Activities.Send> that is used to call a service and a subsequent <xref:System.ServiceModel.Activities.Receive> that is used to receive a callback from the service, share the same <xref:System.ServiceModel.Activities.CorrelationHandle>."},{"content":"This basic pattern is used whether the correlation is content based or protocol based.","pos":[1635,1721]},{"content":"The correlation handle can be explicitly set on each activity or the activities can be contained in a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.CorrelationScope&gt;</ph> activity.","pos":[1722,1888],"source":" The correlation handle can be explicitly set on each activity or the activities can be contained in a <xref:System.ServiceModel.Activities.CorrelationScope> activity."},{"content":"Activities contained in a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.CorrelationScope&gt;</ph> have their correlation handles managed by the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.CorrelationScope&gt;</ph> and do not require the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.CorrelationHandle&gt;</ph> to be explicitly set.","pos":[1889,2171],"source":" Activities contained in a <xref:System.ServiceModel.Activities.CorrelationScope> have their correlation handles managed by the <xref:System.ServiceModel.Activities.CorrelationScope> and do not require the <xref:System.ServiceModel.Activities.CorrelationHandle> to be explicitly set."},{"content":"A <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.CorrelationScope&gt;</ph> scope provides <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.CorrelationHandle&gt;</ph> management for a request-reply correlation and one additional correlation type.","pos":[2172,2379],"source":" A <xref:System.ServiceModel.Activities.CorrelationScope> scope provides <xref:System.ServiceModel.Activities.CorrelationHandle> management for a request-reply correlation and one additional correlation type."},{"content":"Workflow services hosted using <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.WorkflowServiceHost&gt;</ph> have the same default correlation management as the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.CorrelationScope&gt;</ph> activity.","pos":[2380,2585],"source":" Workflow services hosted using <xref:System.ServiceModel.Activities.WorkflowServiceHost> have the same default correlation management as the <xref:System.ServiceModel.Activities.CorrelationScope> activity."},{"content":"This default correlation management generally means that in many scenarios, messaging activities in a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.CorrelationScope&gt;</ph> or a workflow service do not require their <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.CorrelationHandle&gt;</ph> set unless multiple messaging activities are in parallel or overlap, such as two <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activities in parallel, or two <ph id=\"ph4\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> activities followed by two <ph id=\"ph5\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activities.","pos":[2586,3127],"source":" This default correlation management generally means that in many scenarios, messaging activities in a <xref:System.ServiceModel.Activities.CorrelationScope> or a workflow service do not require their <xref:System.ServiceModel.Activities.CorrelationHandle> set unless multiple messaging activities are in parallel or overlap, such as two <xref:System.ServiceModel.Activities.Receive> activities in parallel, or two <xref:System.ServiceModel.Activities.Send> activities followed by two <xref:System.ServiceModel.Activities.Receive> activities."},{"content":"More information about default correlation is provided in the topics in this section that cover each specific type of correlation.","pos":[3128,3258]},{"content":"For more information about messaging activities see <bpt id=\"p1\">[</bpt>Messaging Activities<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/messaging-activities.md)</ept> and <bpt id=\"p2\">[</bpt>How to: Create a Workflow Service with Messaging Activities<ept id=\"p2\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-workflow-service-with-messaging-activities.md)</ept>.","pos":[3259,3582],"source":" For more information about messaging activities see [Messaging Activities](../../../../docs/framework/wcf/feature-details/messaging-activities.md) and [How to: Create a Workflow Service with Messaging Activities](../../../../docs/framework/wcf/feature-details/how-to-create-a-workflow-service-with-messaging-activities.md)."},{"pos":[3591,3617],"content":"Protocol-Based Correlation","linkify":"Protocol-Based Correlation","nodes":[{"content":"Protocol-Based Correlation","pos":[0,26]}]},{"content":"Protocol-based correlation uses the transport mechanism to relate messages to each other and the appropriate instance.","pos":[3619,3737]},{"content":"Some system-provided protocol correlations include request-reply correlation and context-based correlation.","pos":[3738,3845]},{"content":"A request-reply correlation is used to correlate a single pair of messaging activities to form a two-way operation, such as a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> paired with a <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.ReceiveReply&gt;</ph>, or a <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> paired with a <ph id=\"ph4\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph>.","pos":[3846,4194],"source":" A request-reply correlation is used to correlate a single pair of messaging activities to form a two-way operation, such as a <xref:System.ServiceModel.Activities.Send> paired with a <xref:System.ServiceModel.Activities.ReceiveReply>, or a <xref:System.ServiceModel.Activities.Receive> paired with a <xref:System.ServiceModel.Activities.SendReply>."},{"content":"The Visual Studio Workflow Designer also provides a set of activity templates to quickly implement this pattern.","pos":[4195,4307]},{"content":"A context-based correlation is based on the context exchange mechanism described in the <bpt id=\"p1\">[</bpt>.NET Context Exchange Protocol Specification<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkID=166059)</ept>.","pos":[4308,4491],"source":" A context-based correlation is based on the context exchange mechanism described in the [.NET Context Exchange Protocol Specification](https://go.microsoft.com/fwlink/?LinkID=166059)."},{"content":"To use context-based correlation, a context-based binding such as <ph id=\"ph1\">&lt;xref:System.ServiceModel.BasicHttpContextBinding&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.ServiceModel.WSHttpContextBinding&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.ServiceModel.NetTcpContextBinding&gt;</ph> must be used on the endpoint.","pos":[4492,4738],"source":" To use context-based correlation, a context-based binding such as <xref:System.ServiceModel.BasicHttpContextBinding>, <xref:System.ServiceModel.WSHttpContextBinding> or <xref:System.ServiceModel.NetTcpContextBinding> must be used on the endpoint."},{"content":"For more information about protocol correlation, see <bpt id=\"p1\">[</bpt>Durable Duplex<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/durable-duplex-correlation.md)</ept> and <bpt id=\"p2\">[</bpt>Request-Reply<ept id=\"p2\">](../../../../docs/framework/wcf/feature-details/request-reply-correlation.md)</ept>.","pos":[4744,4989],"source":"For more information about protocol correlation, see [Durable Duplex](../../../../docs/framework/wcf/feature-details/durable-duplex-correlation.md) and [Request-Reply](../../../../docs/framework/wcf/feature-details/request-reply-correlation.md)."},{"content":"For more information about using the Visual Studio Workflow Designer activity templates, see <bpt id=\"p1\">[</bpt>Messaging Activities<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/messaging-activities.md)</ept>.","pos":[4990,5178],"source":" For more information about using the Visual Studio Workflow Designer activity templates, see [Messaging Activities](../../../../docs/framework/wcf/feature-details/messaging-activities.md)."},{"content":"For sample code, see the <bpt id=\"p1\">[</bpt>NetContextExchangeCorrelation<ept id=\"p1\">](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ee662963%28v%3dvs.100%29)</ept> sample.","pos":[5179,5338],"source":" For sample code, see the [NetContextExchangeCorrelation](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ee662963%28v%3dvs.100%29) sample."},{"pos":[5347,5372],"content":"Content-Based Correlation","linkify":"Content-Based Correlation","nodes":[{"content":"Content-Based Correlation","pos":[0,25]}]},{"content":"Content-based correlation uses some piece of information in the message to associate it to a particular instance.","pos":[5374,5487]},{"content":"Unlike protocol-based correlation, content-based correlation requires the application author to explicitly state where this data can be found in each related message.","pos":[5488,5654]},{"content":"Activities that use content-based correlation specify this message data by using a <ph id=\"ph1\">&lt;xref:System.ServiceModel.MessageQuerySet&gt;</ph>.","pos":[5655,5781],"source":" Activities that use content-based correlation specify this message data by using a <xref:System.ServiceModel.MessageQuerySet>."},{"content":"Content-based correlation is useful when communicating with services that do not use one of the context bindings such as <ph id=\"ph1\">&lt;xref:System.ServiceModel.BasicHttpContextBinding&gt;</ph>.","pos":[5782,5954],"source":" Content-based correlation is useful when communicating with services that do not use one of the context bindings such as <xref:System.ServiceModel.BasicHttpContextBinding>."},{"pos":[5961,5969],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[5973,6099],"content":"<bpt id=\"p1\">[</bpt>NetContextExchangeCorrelation<ept id=\"p1\">](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ee662963%28v%3dvs.100%29)</ept>","source":"[NetContextExchangeCorrelation](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ee662963%28v%3dvs.100%29)"}]}