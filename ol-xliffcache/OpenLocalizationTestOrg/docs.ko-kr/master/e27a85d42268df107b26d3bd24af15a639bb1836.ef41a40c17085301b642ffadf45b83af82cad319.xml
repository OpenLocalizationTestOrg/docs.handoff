{"content":"---\ntitle: \"Preventing Replay Attacks When a WCF Service is Hosted in a Web Farm\"\nms.date: \"03/30/2017\"\nms.assetid: 1c2ed695-7a31-4257-92bd-9e9731b886a5\n---\n# Preventing Replay Attacks When a WCF Service is Hosted in a Web Farm\nWhen using message security WCF prevents replay attacks by creating a NONCE out of the incoming message and checking the internal `InMemoryNonceCache` to see if the generated NONCE is present. If it is, the message is discarded as a replay. When a WCF service is hosted in a web farm, since the `InMemoryNonceCache` is not shared across the nodes in the web farm, the service is vulnerable to replay attacks.  To mitigate this scenario WCF 4.5 provides an extensibility point that allows you to implement your own shared NONCE cache by deriving a class from the abstract class <xref:System.ServiceModel.Security.NonceCache>.  \n  \n## NonceCache Implementation  \n To implement your own shared NONCE cache, derive a class from <xref:System.ServiceModel.Security.NonceCache> and override the <xref:System.ServiceModel.Security.NonceCache.CheckNonce%2A> and <xref:System.ServiceModel.Security.NonceCache.TryAddNonce%2A> methods. <xref:System.ServiceModel.Security.NonceCache.CheckNonce%2A> will check to see if the specified NONCE exists in the cache. <xref:System.ServiceModel.Security.NonceCache.TryAddNonce%2A> will attempt to add a NONCE to the cache. Once the class is implemented, you hook it up by instantiating an instance and assigning it to <xref:System.ServiceModel.Channels.LocalClientSecuritySettings.NonceCache%2A> for client-side replay detection and <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.NonceCache%2A> for server-side replay detection. There is no out of the box configuration support for this feature.  \n  \n## See also\n\n- [Message Security](../../../../docs/framework/wcf/feature-details/message-security-in-wcf.md)\n- [SymmetricSecurityBindingElement](../../../../docs/framework/wcf/diagnostics/wmi/symmetricsecuritybindingelement.md)\n","nodes":[{"pos":[4,152],"embed":true,"restype":"x-metadata","content":"title: \"Preventing Replay Attacks When a WCF Service is Hosted in a Web Farm\"\nms.date: \"03/30/2017\"\nms.assetid: 1c2ed695-7a31-4257-92bd-9e9731b886a5","nodes":[{"content":"Preventing Replay Attacks When a WCF Service is Hosted in a Web Farm","nodes":[{"pos":[0,68],"content":"Preventing Replay Attacks When a WCF Service is Hosted in a Web Farm","nodes":[{"content":"Preventing Replay Attacks When a WCF Service is Hosted in a Web Farm","pos":[0,68]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[159,227],"content":"Preventing Replay Attacks When a WCF Service is Hosted in a Web Farm","linkify":"Preventing Replay Attacks When a WCF Service is Hosted in a Web Farm","nodes":[{"content":"Preventing Replay Attacks When a WCF Service is Hosted in a Web Farm","pos":[0,68]}]},{"content":"When using message security WCF prevents replay attacks by creating a NONCE out of the incoming message and checking the internal <ph id=\"ph1\">`InMemoryNonceCache`</ph> to see if the generated NONCE is present.","pos":[228,420],"source":"When using message security WCF prevents replay attacks by creating a NONCE out of the incoming message and checking the internal `InMemoryNonceCache` to see if the generated NONCE is present."},{"content":"If it is, the message is discarded as a replay.","pos":[421,468]},{"content":"When a WCF service is hosted in a web farm, since the <ph id=\"ph1\">`InMemoryNonceCache`</ph> is not shared across the nodes in the web farm, the service is vulnerable to replay attacks.","pos":[469,636],"source":" When a WCF service is hosted in a web farm, since the `InMemoryNonceCache` is not shared across the nodes in the web farm, the service is vulnerable to replay attacks."},{"content":"To mitigate this scenario WCF 4.5 provides an extensibility point that allows you to implement your own shared NONCE cache by deriving a class from the abstract class <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.NonceCache&gt;</ph>.","pos":[638,852],"source":"  To mitigate this scenario WCF 4.5 provides an extensibility point that allows you to implement your own shared NONCE cache by deriving a class from the abstract class <xref:System.ServiceModel.Security.NonceCache>."},{"pos":[861,886],"content":"NonceCache Implementation","linkify":"NonceCache Implementation","nodes":[{"content":"NonceCache Implementation","pos":[0,25]}]},{"content":"To implement your own shared NONCE cache, derive a class from <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.NonceCache&gt;</ph> and override the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.NonceCache.CheckNonce%2A&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.ServiceModel.Security.NonceCache.TryAddNonce%2A&gt;</ph> methods.","pos":[890,1151],"source":"To implement your own shared NONCE cache, derive a class from <xref:System.ServiceModel.Security.NonceCache> and override the <xref:System.ServiceModel.Security.NonceCache.CheckNonce%2A> and <xref:System.ServiceModel.Security.NonceCache.TryAddNonce%2A> methods."},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.NonceCache.CheckNonce%2A&gt;</ph> will check to see if the specified NONCE exists in the cache.","pos":[1152,1274],"source":"<xref:System.ServiceModel.Security.NonceCache.CheckNonce%2A> will check to see if the specified NONCE exists in the cache."},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.NonceCache.TryAddNonce%2A&gt;</ph> will attempt to add a NONCE to the cache.","pos":[1275,1378],"source":"<xref:System.ServiceModel.Security.NonceCache.TryAddNonce%2A> will attempt to add a NONCE to the cache."},{"content":"Once the class is implemented, you hook it up by instantiating an instance and assigning it to <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.LocalClientSecuritySettings.NonceCache%2A&gt;</ph> for client-side replay detection and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.NonceCache%2A&gt;</ph> for server-side replay detection.","pos":[1379,1701],"source":" Once the class is implemented, you hook it up by instantiating an instance and assigning it to <xref:System.ServiceModel.Channels.LocalClientSecuritySettings.NonceCache%2A> for client-side replay detection and <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.NonceCache%2A> for server-side replay detection."},{"content":"There is no out of the box configuration support for this feature.","pos":[1702,1768]},{"pos":[1777,1785],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[1789,1882],"content":"<bpt id=\"p1\">[</bpt>Message Security<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/message-security-in-wcf.md)</ept>","source":"[Message Security](../../../../docs/framework/wcf/feature-details/message-security-in-wcf.md)"},{"pos":[1885,2001],"content":"<bpt id=\"p1\">[</bpt>SymmetricSecurityBindingElement<ept id=\"p1\">](../../../../docs/framework/wcf/diagnostics/wmi/symmetricsecuritybindingelement.md)</ept>","source":"[SymmetricSecurityBindingElement](../../../../docs/framework/wcf/diagnostics/wmi/symmetricsecuritybindingelement.md)"}]}