{"content":"---\ntitle: \"Propagation\"\nms.date: \"03/30/2017\"\nms.assetid: f8181e75-d693-48d1-b333-a776ad3b382a\n---\n# Propagation\nThis topic describes activity propagation in the Windows Communication Foundation (WCF) tracing model.  \n  \n## Using Propagation to Correlate Activities Across Endpoints  \n Propagation provides the user with direct correlation of error traces for the same unit of processing across application endpoints, for example, a request. Errors emitted at different endpoints for the same unit of processing are grouped in the same activity, even across application domains. This is done through propagation of the activity ID in the message headers. Therefore, if a client times out because of an internal error in the server, both errors appear in the same activity for direct correlation.  \n  \n To do this, use the `ActivityTracing` setting as demonstrated in the previous example. In addition, set the `propagateActivity` attribute for the `System.ServiceModel` trace source at all endpoints.  \n  \n```xml  \n<source name=\"System.ServiceModel\" switchValue=\"Verbose,ActivityTracing\" propagateActivity=\"true\" >  \n```  \n  \n Activity propagation is a configurable capability that causes WCF to add a header to outbound messages, which includes the activity ID on the TLS. By including this on subsequent traces on the server side, we can correlate client and server activities.  \n  \n## Propagation Definition  \n Activity M’s gAId is propagated to activity N if all of the following conditions apply.  \n  \n-   N is created because of M  \n  \n-   M’s gAId is known to N  \n  \n-   N's gAId is equal to M’s gAId.  \n  \n The gAId is propagated through the ActivityId message header, as illustrated in the following XML schema.  \n  \n```xml  \n<xsd:element name=\"ActivityId\" type=\"integer\" minOccurs=\"0\">  \n  <xsd:attribute name=\"CorrelationId\" type=\"integer\" minOccurs=\"0\"/>  \n</xsd:element>  \n```  \n  \n The following is an example of the message header.  \n  \n```xml  \n<MessageLogTraceRecord>  \n  <s:Envelope xmlns:s=\"http://www.w3.org/2003/05/soap-envelope\"\n                      xmlns:a=\"http://www.w3.org/2005/08/addressing\">  \n    <s:Header>  \n      <a:Action s:mustUnderstand=\"1\">http://Microsoft.ServiceModel.Samples/ICalculator/Subtract  \n      </a:Action>  \n      <a:MessageID>urn:uuid:f0091eae-d339-4c7e-9408-ece34602f1ce  \n      </a:MessageID>  \n      <ActivityId CorrelationId=\"f94c6af1-7d5d-4295-b693-4670a8a0ce34\"\n               xmlns=\"http://schemas.microsoft.com/2004/09/ServiceModel/Diagnostics\">  \n        17f59a29-b435-4a15-bf7b-642ffc40eac8  \n      </ActivityId>  \n      <a:ReplyTo>  \n          <a:Address>http://www.w3.org/2005/08/addressing/anonymous</a:Address>  \n      </a:ReplyTo>  \n      <a:To s:mustUnderstand=\"1\">net.tcp://localhost/servicemodelsamples/service</a:To>  \n   </s:Header>  \n   <s:Body>  \n     <Subtract xmlns=\"http://Microsoft.ServiceModel.Samples\">  \n       <n1>145</n1>  \n       <n2>76.54</n2>  \n     </Subtract>  \n   </s:Body>  \n  </s:Envelope>  \n</MessageLogTraceRecord>  \n```  \n  \n## Propagation and Activity Boundaries  \n When the activity ID is propagated across endpoints, the message receiver emits a Start and Stop traces with that (propagated) activity ID. Therefore, there is a Start and Stop trace with that gAId from each trace source. If the endpoints are in the same process and use the same trace source name, multiple Start and Stop with the same lAId (same gAId, same trace source, same process) are created.  \n  \n## Synchronization  \n To synchronize events across endpoints that run on different machines, a CorrelationId is added to the ActivityId header that is propagated in messages. Tools can use this ID to synchronize events across machines with clock discrepancy. Specifically, the Service Trace Viewer tool uses this ID for showing message flows between endpoints.  \n  \n## See also\n\n- [Configuring Tracing](../../../../../docs/framework/wcf/diagnostics/tracing/configuring-tracing.md)\n- [Using Service Trace Viewer for Viewing Correlated Traces and Troubleshooting](../../../../../docs/framework/wcf/diagnostics/tracing/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting.md)\n- [End-To-End Tracing Scenarios](../../../../../docs/framework/wcf/diagnostics/tracing/end-to-end-tracing-scenarios.md)\n- [Service Trace Viewer Tool (SvcTraceViewer.exe)](../../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md)\n","nodes":[{"pos":[4,95],"embed":true,"restype":"x-metadata","content":"title: \"Propagation\"\nms.date: \"03/30/2017\"\nms.assetid: f8181e75-d693-48d1-b333-a776ad3b382a","nodes":[{"content":"Propagation","nodes":[{"pos":[0,11],"content":"Propagation","nodes":[{"content":"Propagation","pos":[0,11]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[102,113],"content":"Propagation","linkify":"Propagation","nodes":[{"content":"Propagation","pos":[0,11]}]},{"content":"This topic describes activity propagation in the Windows Communication Foundation (WCF) tracing model.","pos":[114,216]},{"pos":[225,283],"content":"Using Propagation to Correlate Activities Across Endpoints","linkify":"Using Propagation to Correlate Activities Across Endpoints","nodes":[{"content":"Using Propagation to Correlate Activities Across Endpoints","pos":[0,58]}]},{"content":"Propagation provides the user with direct correlation of error traces for the same unit of processing across application endpoints, for example, a request.","pos":[287,442]},{"content":"Errors emitted at different endpoints for the same unit of processing are grouped in the same activity, even across application domains.","pos":[443,579]},{"content":"This is done through propagation of the activity ID in the message headers.","pos":[580,655]},{"content":"Therefore, if a client times out because of an internal error in the server, both errors appear in the same activity for direct correlation.","pos":[656,796]},{"content":"To do this, use the <ph id=\"ph1\">`ActivityTracing`</ph> setting as demonstrated in the previous example.","pos":[803,889],"source":"To do this, use the `ActivityTracing` setting as demonstrated in the previous example."},{"content":"In addition, set the <ph id=\"ph1\">`propagateActivity`</ph> attribute for the <ph id=\"ph2\">`System.ServiceModel`</ph> trace source at all endpoints.","pos":[890,1001],"source":" In addition, set the `propagateActivity` attribute for the `System.ServiceModel` trace source at all endpoints."},{"content":"Activity propagation is a configurable capability that causes WCF to add a header to outbound messages, which includes the activity ID on the TLS.","pos":[1128,1274]},{"content":"By including this on subsequent traces on the server side, we can correlate client and server activities.","pos":[1275,1380]},{"pos":[1389,1411],"content":"Propagation Definition","linkify":"Propagation Definition","nodes":[{"content":"Propagation Definition","pos":[0,22]}]},{"content":"Activity M’s gAId is propagated to activity N if all of the following conditions apply.","pos":[1415,1502]},{"content":"N is created because of M","pos":[1512,1537]},{"content":"M’s gAId is known to N","pos":[1547,1569]},{"content":"N's gAId is equal to M’s gAId.","pos":[1579,1609]},{"content":"The gAId is propagated through the ActivityId message header, as illustrated in the following XML schema.","pos":[1616,1721]},{"content":"The following is an example of the message header.","pos":[1897,1947]},{"pos":[3022,3057],"content":"Propagation and Activity Boundaries","linkify":"Propagation and Activity Boundaries","nodes":[{"content":"Propagation and Activity Boundaries","pos":[0,35]}]},{"content":"When the activity ID is propagated across endpoints, the message receiver emits a Start and Stop traces with that (propagated) activity ID.","pos":[3061,3200]},{"content":"Therefore, there is a Start and Stop trace with that gAId from each trace source.","pos":[3201,3282]},{"content":"If the endpoints are in the same process and use the same trace source name, multiple Start and Stop with the same lAId (same gAId, same trace source, same process) are created.","pos":[3283,3460]},{"pos":[3469,3484],"content":"Synchronization","linkify":"Synchronization","nodes":[{"content":"Synchronization","pos":[0,15]}]},{"content":"To synchronize events across endpoints that run on different machines, a CorrelationId is added to the ActivityId header that is propagated in messages.","pos":[3488,3640]},{"content":"Tools can use this ID to synchronize events across machines with clock discrepancy.","pos":[3641,3724]},{"content":"Specifically, the Service Trace Viewer tool uses this ID for showing message flows between endpoints.","pos":[3725,3826]},{"pos":[3835,3843],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[3847,3946],"content":"<bpt id=\"p1\">[</bpt>Configuring Tracing<ept id=\"p1\">](../../../../../docs/framework/wcf/diagnostics/tracing/configuring-tracing.md)</ept>","source":"[Configuring Tracing](../../../../../docs/framework/wcf/diagnostics/tracing/configuring-tracing.md)"},{"pos":[3949,4162],"content":"<bpt id=\"p1\">[</bpt>Using Service Trace Viewer for Viewing Correlated Traces and Troubleshooting<ept id=\"p1\">](../../../../../docs/framework/wcf/diagnostics/tracing/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting.md)</ept>","source":"[Using Service Trace Viewer for Viewing Correlated Traces and Troubleshooting](../../../../../docs/framework/wcf/diagnostics/tracing/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting.md)"},{"pos":[4165,4282],"content":"<bpt id=\"p1\">[</bpt>End-To-End Tracing Scenarios<ept id=\"p1\">](../../../../../docs/framework/wcf/diagnostics/tracing/end-to-end-tracing-scenarios.md)</ept>","source":"[End-To-End Tracing Scenarios](../../../../../docs/framework/wcf/diagnostics/tracing/end-to-end-tracing-scenarios.md)"},{"pos":[4285,4416],"content":"<bpt id=\"p1\">[</bpt>Service Trace Viewer Tool (SvcTraceViewer.exe)<ept id=\"p1\">](../../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md)</ept>","source":"[Service Trace Viewer Tool (SvcTraceViewer.exe)](../../../../../docs/framework/wcf/service-trace-viewer-tool-svctraceviewer-exe.md)"}]}