{"content":"---\ntitle: \"Inside the CustomPeerResolverService: Client Registrations\"\nms.date: \"03/30/2017\"\nms.assetid: 40236953-a916-4236-84a6-928859e1331a\n---\n# Inside the CustomPeerResolverService: Client Registrations\nEach node in the mesh publishes its endpoint information to the resolver service through the `Register` function. The resolver service stores this information as a registration record. This record contains a unique identifier (RegistrationID) and endpoint information (PeerNodeAddress) for the node.  \n  \n## Stale Records and Expiration Time  \n Ideally, when a node leaves the mesh, it will call the `Unregister` function, which causes the resolver service to remove the registration entry. Sometimes, nodes shut down or become inaccessible before calling `Unregister`, leaving behind a stale registration record.  \n  \n Stale records in your resolver service can cause failed connections. If a node trying to connect to a mesh receives stale connection information from the resolver service, it can take longer to successfully join the mesh. Stale records also take up memory. Without an efficient clean up process, the cache used to store registrations could eventually overflow and crash the resolver service.  \n  \n The <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> marks each record with an expiration time (DateTime), and stores that information as part of the record. The service uses the expiration time to identify stale records. Custom implementations should do something similar.  \n  \n## RefreshInterval and CleanupInterval  \n The `RefreshInterval` property of the <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> defines how long registration records remain valid in the service's registration lookup table. When the amount of time supplied to this property has passed for a given record, that record becomes stale and is marked for deletion.  \n  \n The `CleanupInterval` property of the <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> tells the service how often to search for and delete stale registration records. The `CleanupInterval` should be set to a time greater than or equal to the `RefreshInterval` set on the service.  \n  \n To implement your own resolver service, you need to write a maintenance function to remove stale registration records. There are several ways to do this:  \n  \n-   **Periodic maintenance**: Set a timer to go off periodically, and go through your data store to delete old records. The <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> uses this approach.  \n  \n-   **Passive deletion**: Instead of actively searching for stale records at regular intervals, you can identify and delete stale records when your service is already performing another function. This may potentially slow down response time to requests from the resolver clients, but it eliminates the need for a timer, and may be more efficient if few nodes are expected to leave without calling `Unregister`.  \n  \n## RegistrationLifetime and Refresh  \n When a node registers with a resolver service, it receives a <xref:System.ServiceModel.PeerResolvers.RegisterResponseInfo> object from the service. This object has a `RegistrationLifetime` property which indicates to the node how much time it has before the registration expires and is removed by the resolver service. If, for example, the `RegistrationLifetime` is 2 minutes, the node needs to call `Refresh` in under 2 minutes to ensure the record stays fresh and is not deleted. When the resolver service receives a `Refresh` request, it looks up the record and resets the expiration time. Refresh returns a <xref:System.ServiceModel.PeerResolvers.RefreshResponseInfo> object with a `RegistrationLifetime` property.  \n  \n## See also\n\n- [Peer Resolvers](../../../../docs/framework/wcf/feature-details/peer-resolvers.md)\n","nodes":[{"pos":[4,142],"embed":true,"restype":"x-metadata","content":"title: \"Inside the CustomPeerResolverService: Client Registrations\"\nms.date: \"03/30/2017\"\nms.assetid: 40236953-a916-4236-84a6-928859e1331a","nodes":[{"content":"Inside the CustomPeerResolverService: Client Registrations","nodes":[{"pos":[0,58],"content":"Inside the CustomPeerResolverService: Client Registrations","nodes":[{"content":"Inside the CustomPeerResolverService: Client Registrations","pos":[0,58]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[149,207],"content":"Inside the CustomPeerResolverService: Client Registrations","linkify":"Inside the CustomPeerResolverService: Client Registrations","nodes":[{"content":"Inside the CustomPeerResolverService: Client Registrations","pos":[0,58]}]},{"content":"Each node in the mesh publishes its endpoint information to the resolver service through the <ph id=\"ph1\">`Register`</ph> function.","pos":[208,321],"source":"Each node in the mesh publishes its endpoint information to the resolver service through the `Register` function."},{"content":"The resolver service stores this information as a registration record.","pos":[322,392]},{"content":"This record contains a unique identifier (RegistrationID) and endpoint information (PeerNodeAddress) for the node.","pos":[393,507]},{"pos":[516,549],"content":"Stale Records and Expiration Time","linkify":"Stale Records and Expiration Time","nodes":[{"content":"Stale Records and Expiration Time","pos":[0,33]}]},{"content":"Ideally, when a node leaves the mesh, it will call the <ph id=\"ph1\">`Unregister`</ph> function, which causes the resolver service to remove the registration entry.","pos":[553,698],"source":"Ideally, when a node leaves the mesh, it will call the `Unregister` function, which causes the resolver service to remove the registration entry."},{"content":"Sometimes, nodes shut down or become inaccessible before calling <ph id=\"ph1\">`Unregister`</ph>, leaving behind a stale registration record.","pos":[699,821],"source":" Sometimes, nodes shut down or become inaccessible before calling `Unregister`, leaving behind a stale registration record."},{"content":"Stale records in your resolver service can cause failed connections.","pos":[828,896]},{"content":"If a node trying to connect to a mesh receives stale connection information from the resolver service, it can take longer to successfully join the mesh.","pos":[897,1049]},{"content":"Stale records also take up memory.","pos":[1050,1084]},{"content":"Without an efficient clean up process, the cache used to store registrations could eventually overflow and crash the resolver service.","pos":[1085,1219]},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService&gt;</ph> marks each record with an expiration time (DateTime), and stores that information as part of the record.","pos":[1226,1401],"source":"The <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> marks each record with an expiration time (DateTime), and stores that information as part of the record."},{"content":"The service uses the expiration time to identify stale records.","pos":[1402,1465]},{"content":"Custom implementations should do something similar.","pos":[1466,1517]},{"pos":[1526,1561],"content":"RefreshInterval and CleanupInterval","linkify":"RefreshInterval and CleanupInterval","nodes":[{"content":"RefreshInterval and CleanupInterval","pos":[0,35]}]},{"content":"The <ph id=\"ph1\">`RefreshInterval`</ph> property of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService&gt;</ph> defines how long registration records remain valid in the service's registration lookup table.","pos":[1565,1764],"source":"The `RefreshInterval` property of the <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> defines how long registration records remain valid in the service's registration lookup table."},{"content":"When the amount of time supplied to this property has passed for a given record, that record becomes stale and is marked for deletion.","pos":[1765,1899]},{"content":"The <ph id=\"ph1\">`CleanupInterval`</ph> property of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService&gt;</ph> tells the service how often to search for and delete stale registration records.","pos":[1906,2091],"source":"The `CleanupInterval` property of the <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> tells the service how often to search for and delete stale registration records."},{"content":"The <ph id=\"ph1\">`CleanupInterval`</ph> should be set to a time greater than or equal to the <ph id=\"ph2\">`RefreshInterval`</ph> set on the service.","pos":[2092,2204],"source":" The `CleanupInterval` should be set to a time greater than or equal to the `RefreshInterval` set on the service."},{"content":"To implement your own resolver service, you need to write a maintenance function to remove stale registration records.","pos":[2211,2329]},{"content":"There are several ways to do this:","pos":[2330,2364]},{"content":"<bpt id=\"p1\">**</bpt>Periodic maintenance<ept id=\"p1\">**</ept>: Set a timer to go off periodically, and go through your data store to delete old records.","pos":[2374,2489],"source":"**Periodic maintenance**: Set a timer to go off periodically, and go through your data store to delete old records."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService&gt;</ph> uses this approach.","pos":[2490,2580],"source":" The <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> uses this approach."},{"content":"<bpt id=\"p1\">**</bpt>Passive deletion<ept id=\"p1\">**</ept>: Instead of actively searching for stale records at regular intervals, you can identify and delete stale records when your service is already performing another function.","pos":[2590,2781],"source":"**Passive deletion**: Instead of actively searching for stale records at regular intervals, you can identify and delete stale records when your service is already performing another function."},{"content":"This may potentially slow down response time to requests from the resolver clients, but it eliminates the need for a timer, and may be more efficient if few nodes are expected to leave without calling <ph id=\"ph1\">`Unregister`</ph>.","pos":[2782,2996],"source":" This may potentially slow down response time to requests from the resolver clients, but it eliminates the need for a timer, and may be more efficient if few nodes are expected to leave without calling `Unregister`."},{"pos":[3005,3037],"content":"RegistrationLifetime and Refresh","linkify":"RegistrationLifetime and Refresh","nodes":[{"content":"RegistrationLifetime and Refresh","pos":[0,32]}]},{"content":"When a node registers with a resolver service, it receives a <ph id=\"ph1\">&lt;xref:System.ServiceModel.PeerResolvers.RegisterResponseInfo&gt;</ph> object from the service.","pos":[3041,3188],"source":"When a node registers with a resolver service, it receives a <xref:System.ServiceModel.PeerResolvers.RegisterResponseInfo> object from the service."},{"content":"This object has a <ph id=\"ph1\">`RegistrationLifetime`</ph> property which indicates to the node how much time it has before the registration expires and is removed by the resolver service.","pos":[3189,3359],"source":" This object has a `RegistrationLifetime` property which indicates to the node how much time it has before the registration expires and is removed by the resolver service."},{"content":"If, for example, the <ph id=\"ph1\">`RegistrationLifetime`</ph> is 2 minutes, the node needs to call <ph id=\"ph2\">`Refresh`</ph> in under 2 minutes to ensure the record stays fresh and is not deleted.","pos":[3360,3522],"source":" If, for example, the `RegistrationLifetime` is 2 minutes, the node needs to call `Refresh` in under 2 minutes to ensure the record stays fresh and is not deleted."},{"content":"When the resolver service receives a <ph id=\"ph1\">`Refresh`</ph> request, it looks up the record and resets the expiration time.","pos":[3523,3633],"source":" When the resolver service receives a `Refresh` request, it looks up the record and resets the expiration time."},{"content":"Refresh returns a <ph id=\"ph1\">&lt;xref:System.ServiceModel.PeerResolvers.RefreshResponseInfo&gt;</ph> object with a <ph id=\"ph2\">`RegistrationLifetime`</ph> property.","pos":[3634,3759],"source":" Refresh returns a <xref:System.ServiceModel.PeerResolvers.RefreshResponseInfo> object with a `RegistrationLifetime` property."},{"pos":[3768,3776],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[3780,3862],"content":"<bpt id=\"p1\">[</bpt>Peer Resolvers<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/peer-resolvers.md)</ept>","source":"[Peer Resolvers](../../../../docs/framework/wcf/feature-details/peer-resolvers.md)"}]}