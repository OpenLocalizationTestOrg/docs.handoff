{"content":"---\ntitle: \"How to: Configure Credentials on a Federation Service | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"WCF, federation\"\n  - \"federation\"\nms.assetid: 149ab165-0ef3-490a-83a9-4322a07bd98a\ncaps.latest.revision: 21\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# How to: Configure Credentials on a Federation Service\nIn [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)], creating a federated service consists of the following main procedures:  \n  \n1.  Configuring a <xref:System.ServiceModel.WSFederationHttpBinding> or similar custom binding. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] creating an appropriate binding, see [How to: Create a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md).  \n  \n2.  Configuring the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> that controls how issued tokens presented to the service are authenticated.  \n  \n This topic provides details about the second step. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] how a federated service works, see [Federation](../../../../docs/framework/wcf/feature-details/federation.md).  \n  \n### To set the properties of IssuedTokenServiceCredential in code  \n  \n1.  Use the <xref:System.ServiceModel.Description.ServiceCredentials.IssuedTokenAuthentication%2A> property of the <xref:System.ServiceModel.Description.ServiceCredentials> class to return a reference to an <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> instance. The property is accessed from the <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> property of the <xref:System.ServiceModel.ServiceHostBase> class.  \n  \n2.  Set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> property to `true` if self-issued tokens such as [!INCLUDE[infocard](../../../../includes/infocard-md.md)] cards are to be authenticated. The default is `false`.  \n  \n3.  Populate the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property with instances of the <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> class. Each instance represents an issuer from which the service will authenticate tokens.  \n  \n    > [!NOTE]\n    >  Unlike the client-side collection returned by the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> property, the known certificates collection is not a keyed collection. The service accepts the tokens that the specified certificates issue regardless of the address of the client that sent the message containing the issued token (subject to the further constraints, which are described later in this topic).  \n  \n4.  Set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> property to one of the <xref:System.ServiceModel.Security.X509CertificateValidationMode> enumeration values. This can be done only in code. The default is <xref:System.IdentityModel.Selectors.X509CertificateValidator.ChainTrust%2A>.  \n  \n5.  If the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> property is set to <xref:System.ServiceModel.Security.X509CertificateValidationMode>, then assign an instance of the custom <xref:System.IdentityModel.Selectors.X509CertificateValidator> class to the <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CustomCertificateValidator%2A> property.  \n  \n6.  If the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> is set to `ChainTrust` or `PeerOrChainTrust`, set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.RevocationMode%2A> property to an appropriate value from the <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> enumeration. Note that the revocation mode is not used in `PeerTrust` or `Custom` validation modes.  \n  \n7.  If needed, assign an instance of a custom <xref:System.IdentityModel.Tokens.SamlSerializer> class to the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.SamlSerializer%2A> property. A custom Security Assertions Markup Language (SAML) serializer is needed, for example, for parsing custom SAML assertions.  \n  \n### To set the properties of IssuedTokenServiceCredential in configuration  \n  \n1.  Create an `<issuedTokenAuthentication>` element as a child of a <`serviceCredentials`> element.  \n  \n2.  Set the `allowUntrustedRsaIssuers` attribute of the `<issuedTokenAuthentication>` element to `true` if authenticating a self-issued token, such as an [!INCLUDE[infocard](../../../../includes/infocard-md.md)] card.  \n  \n3.  Create a `<knownCertificates>` element as a child of the `<issuedTokenAuthentication>` element.  \n  \n4.  Create zero or more `<add>` elements as children of the `<knownCertificates>` element, and specify how to locate the certificate using the `storeLocation`, `storeName`, `x509FindType`, and `findValue` attributes.  \n  \n5.  If necessary, set the `samlSerializer` attribute of the <`issuedTokenAuthentication`> element to the type name of the custom <xref:System.IdentityModel.Tokens.SamlSerializer> class.  \n  \n## Example  \n The following example sets the properties of an <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> in code.  \n  \n [!code-csharp[C_FederatedService#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_federatedservice/cs/source.cs#2)]\n [!code-vb[C_FederatedService#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_federatedservice/vb/source.vb#2)]  \n  \n In order for a federated service to authenticate a client, the following must be true about the issued token:  \n  \n-   When the issued token’s digital signature uses an RSA security key identifier, the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> property must be `true`.  \n  \n-   When the issued token’s signature uses an X.509 issuer serial number, X.509 subject key identifier, or X.509 thumbprint security identifier, the issued token must be signed by a certificate in the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property of the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> class.  \n  \n-   When the issued token is signed using an X.509 certificate, the certificate must validate per the semantics specified by the value of the <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A> property, regardless of whether the certificate was sent to the relying party as a <xref:System.IdentityModel.Tokens.X509RawDataKeyIdentifierClause> or was obtained from the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] X.509 certificate validation, see [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).  \n  \n For example, setting the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> to <xref:System.ServiceModel.Security.X509CertificateValidationMode> would authenticate any issued token whose signing certificate is in the `TrustedPeople` certificate store. In that case, set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.TrustedStoreLocation%2A> property to either <xref:System.Security.Cryptography.X509Certificates.StoreLocation> or <xref:System.Security.Cryptography.X509Certificates.StoreLocation>. You can select other modes, including <xref:System.ServiceModel.Security.X509CertificateValidationMode>. When `Custom` is selected, you must assign an instance of the <xref:System.IdentityModel.Selectors.X509CertificateValidator> class to the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CustomCertificateValidator%2A> property. The custom validator can validate certificates using any criteria it likes. [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][How to: Create a Service that Employs a Custom Certificate Validator](../../../../docs/framework/wcf/extending/how-to-create-a-service-that-employs-a-custom-certificate-validator.md).  \n  \n## See Also  \n [Federation](../../../../docs/framework/wcf/feature-details/federation.md)   \n [Federation and Trust](../../../../docs/framework/wcf/feature-details/federation-and-trust.md)   \n [Federation Sample](../../../../docs/framework/wcf/samples/federation-sample.md)   \n [How to: Disable Secure Sessions on a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-disable-secure-sessions-on-a-wsfederationhttpbinding.md)   \n [How to: Create a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)   \n [How to: Create a Federated Client](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md)   \n [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)   \n [SecurityBindingElement Authentication Modes](../../../../docs/framework/wcf/feature-details/securitybindingelement-authentication-modes.md)","nodes":[{"pos":[12,82],"content":"How to: Configure Credentials on a Federation Service | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"How to: Configure Credentials on a Federation Service | Microsoft Docs","pos":[0,70]}]},{"pos":[442,495],"content":"How to: Configure Credentials on a Federation Service","linkify":"How to: Configure Credentials on a Federation Service","nodes":[{"content":"How to: Configure Credentials on a Federation Service","pos":[0,53]}]},{"pos":[496,627],"content":"In <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph>, creating a federated service consists of the following main procedures:","source":"In [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)], creating a federated service consists of the following main procedures:"},{"content":"Configuring a <ph id=\"ph1\">&lt;xref:System.ServiceModel.WSFederationHttpBinding&gt;</ph> or similar custom binding.","pos":[637,728],"source":"Configuring a <xref:System.ServiceModel.WSFederationHttpBinding> or similar custom binding."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> creating an appropriate binding, see <bpt id=\"p1\">[</bpt>How to: Create a WSFederationHttpBinding<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)</ept>.","pos":[729,956],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] creating an appropriate binding, see [How to: Create a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)."},{"content":"Configuring the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential&gt;</ph> that controls how issued tokens presented to the service are authenticated.","pos":[966,1122],"source":"Configuring the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> that controls how issued tokens presented to the service are authenticated."},{"content":"This topic provides details about the second step.","pos":[1129,1179]},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> how a federated service works, see <bpt id=\"p1\">[</bpt>Federation<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/federation.md)</ept>.","pos":[1180,1346],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] how a federated service works, see [Federation](../../../../docs/framework/wcf/feature-details/federation.md)."},{"pos":[1356,1417],"content":"To set the properties of IssuedTokenServiceCredential in code","linkify":"To set the properties of IssuedTokenServiceCredential in code","nodes":[{"content":"To set the properties of IssuedTokenServiceCredential in code","pos":[0,61]}]},{"content":"Use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceCredentials.IssuedTokenAuthentication%2A&gt;</ph> property of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.ServiceCredentials&gt;</ph> class to return a reference to an <ph id=\"ph3\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential&gt;</ph> instance.","pos":[1427,1704],"source":"Use the <xref:System.ServiceModel.Description.ServiceCredentials.IssuedTokenAuthentication%2A> property of the <xref:System.ServiceModel.Description.ServiceCredentials> class to return a reference to an <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> instance."},{"content":"The property is accessed from the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHostBase.Credentials%2A&gt;</ph> property of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceHostBase&gt;</ph> class.","pos":[1705,1862],"source":" The property is accessed from the <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> property of the <xref:System.ServiceModel.ServiceHostBase> class."},{"content":"Set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A&gt;</ph> property to <ph id=\"ph2\">`true`</ph> if self-issued tokens such as <ph id=\"ph3\">[!INCLUDE[infocard](../../../../includes/infocard-md.md)]</ph> cards are to be authenticated.","pos":[1872,2110],"source":"Set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> property to `true` if self-issued tokens such as [!INCLUDE[infocard](../../../../includes/infocard-md.md)] cards are to be authenticated."},{"content":"The default is <ph id=\"ph1\">`false`</ph>.","pos":[2111,2134],"source":" The default is `false`."},{"content":"Populate the collection returned by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A&gt;</ph> property with instances of the <ph id=\"ph2\">&lt;xref:System.Security.Cryptography.X509Certificates.X509Certificate2&gt;</ph> class.","pos":[2144,2377],"source":"Populate the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property with instances of the <xref:System.Security.Cryptography.X509Certificates.X509Certificate2> class."},{"content":"Each instance represents an issuer from which the service will authenticate tokens.","pos":[2378,2461]},{"pos":[2473,2945],"content":"[!NOTE]\nUnlike the client-side collection returned by the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> property, the known certificates collection is not a keyed collection. The service accepts the tokens that the specified certificates issue regardless of the address of the client that sent the message containing the issued token (subject to the further constraints, which are described later in this topic).","leadings":["","    >  "],"nodes":[{"content":"Unlike the client-side collection returned by the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> property, the known certificates collection is not a keyed collection. The service accepts the tokens that the specified certificates issue regardless of the address of the client that sent the message containing the issued token (subject to the further constraints, which are described later in this topic).","pos":[8,465],"nodes":[{"content":"Unlike the client-side collection returned by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A&gt;</ph> property, the known certificates collection is not a keyed collection.","pos":[0,219],"source":"Unlike the client-side collection returned by the <xref:System.ServiceModel.Security.X509CertificateRecipientClientCredential.ScopedCertificates%2A> property, the known certificates collection is not a keyed collection."},{"content":"The service accepts the tokens that the specified certificates issue regardless of the address of the client that sent the message containing the issued token (subject to the further constraints, which are described later in this topic).","pos":[220,457]}]}]},{"content":"Set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A&gt;</ph> property to one of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.X509CertificateValidationMode&gt;</ph> enumeration values.","pos":[2955,3165],"source":"Set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> property to one of the <xref:System.ServiceModel.Security.X509CertificateValidationMode> enumeration values."},{"content":"This can be done only in code.","pos":[3166,3196]},{"content":"The default is <ph id=\"ph1\">&lt;xref:System.IdentityModel.Selectors.X509CertificateValidator.ChainTrust%2A&gt;</ph>.","pos":[3197,3289],"source":" The default is <xref:System.IdentityModel.Selectors.X509CertificateValidator.ChainTrust%2A>."},{"content":"If the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A&gt;</ph> property is set to <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.X509CertificateValidationMode&gt;</ph>, then assign an instance of the custom <ph id=\"ph3\">&lt;xref:System.IdentityModel.Selectors.X509CertificateValidator&gt;</ph> class to the <ph id=\"ph4\">&lt;xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CustomCertificateValidator%2A&gt;</ph> property.","pos":[3299,3712],"source":"If the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> property is set to <xref:System.ServiceModel.Security.X509CertificateValidationMode>, then assign an instance of the custom <xref:System.IdentityModel.Selectors.X509CertificateValidator> class to the <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CustomCertificateValidator%2A> property."},{"content":"If the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A&gt;</ph> is set to <ph id=\"ph2\">`ChainTrust`</ph> or <ph id=\"ph3\">`PeerOrChainTrust`</ph>, set the <ph id=\"ph4\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential.RevocationMode%2A&gt;</ph> property to an appropriate value from the <ph id=\"ph5\">&lt;xref:System.Security.Cryptography.X509Certificates.X509RevocationMode&gt;</ph> enumeration.","pos":[3722,4086],"source":"If the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> is set to `ChainTrust` or `PeerOrChainTrust`, set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.RevocationMode%2A> property to an appropriate value from the <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> enumeration."},{"content":"Note that the revocation mode is not used in <ph id=\"ph1\">`PeerTrust`</ph> or <ph id=\"ph2\">`Custom`</ph> validation modes.","pos":[4087,4173],"source":" Note that the revocation mode is not used in `PeerTrust` or `Custom` validation modes."},{"content":"If needed, assign an instance of a custom <ph id=\"ph1\">&lt;xref:System.IdentityModel.Tokens.SamlSerializer&gt;</ph> class to the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential.SamlSerializer%2A&gt;</ph> property.","pos":[4183,4380],"source":"If needed, assign an instance of a custom <xref:System.IdentityModel.Tokens.SamlSerializer> class to the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.SamlSerializer%2A> property."},{"content":"A custom Security Assertions Markup Language (SAML) serializer is needed, for example, for parsing custom SAML assertions.","pos":[4381,4503]},{"pos":[4513,4583],"content":"To set the properties of IssuedTokenServiceCredential in configuration","linkify":"To set the properties of IssuedTokenServiceCredential in configuration","nodes":[{"content":"To set the properties of IssuedTokenServiceCredential in configuration","pos":[0,70]}]},{"pos":[4593,4688],"content":"Create an <ph id=\"ph1\">`&lt;issuedTokenAuthentication&gt;`</ph> element as a child of a &lt;<ph id=\"ph2\">`serviceCredentials`</ph>&gt; element.","source":"Create an `<issuedTokenAuthentication>` element as a child of a <`serviceCredentials`> element."},{"pos":[4698,4911],"content":"Set the <ph id=\"ph1\">`allowUntrustedRsaIssuers`</ph> attribute of the <ph id=\"ph2\">`&lt;issuedTokenAuthentication&gt;`</ph> element to <ph id=\"ph3\">`true`</ph> if authenticating a self-issued token, such as an <ph id=\"ph4\">[!INCLUDE[infocard](../../../../includes/infocard-md.md)]</ph> card.","source":"Set the `allowUntrustedRsaIssuers` attribute of the `<issuedTokenAuthentication>` element to `true` if authenticating a self-issued token, such as an [!INCLUDE[infocard](../../../../includes/infocard-md.md)] card."},{"pos":[4921,5016],"content":"Create a <ph id=\"ph1\">`&lt;knownCertificates&gt;`</ph> element as a child of the <ph id=\"ph2\">`&lt;issuedTokenAuthentication&gt;`</ph> element.","source":"Create a `<knownCertificates>` element as a child of the `<issuedTokenAuthentication>` element."},{"pos":[5026,5238],"content":"Create zero or more <ph id=\"ph1\">`&lt;add&gt;`</ph> elements as children of the <ph id=\"ph2\">`&lt;knownCertificates&gt;`</ph> element, and specify how to locate the certificate using the <ph id=\"ph3\">`storeLocation`</ph>, <ph id=\"ph4\">`storeName`</ph>, <ph id=\"ph5\">`x509FindType`</ph>, and <ph id=\"ph6\">`findValue`</ph> attributes.","source":"Create zero or more `<add>` elements as children of the `<knownCertificates>` element, and specify how to locate the certificate using the `storeLocation`, `storeName`, `x509FindType`, and `findValue` attributes."},{"pos":[5248,5429],"content":"If necessary, set the <ph id=\"ph1\">`samlSerializer`</ph> attribute of the &lt;<ph id=\"ph2\">`issuedTokenAuthentication`</ph>&gt; element to the type name of the custom <ph id=\"ph3\">&lt;xref:System.IdentityModel.Tokens.SamlSerializer&gt;</ph> class.","source":"If necessary, set the `samlSerializer` attribute of the <`issuedTokenAuthentication`> element to the type name of the custom <xref:System.IdentityModel.Tokens.SamlSerializer> class."},{"pos":[5438,5445],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following example sets the properties of an <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential&gt;</ph> in code.","pos":[5449,5570],"source":"The following example sets the properties of an <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> in code."},{"pos":[5577,5826],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>C_FederatedService#2<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_federatedservice/cs/source.cs#2)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>C_FederatedService#2<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_federatedservice/vb/source.vb#2)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[C_FederatedService#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_federatedservice/cs/source.cs#2)]\n [!code-vb[C_FederatedService#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_federatedservice/vb/source.vb#2)]"},{"content":"In order for a federated service to authenticate a client, the following must be true about the issued token:","pos":[5833,5942]},{"pos":[5952,6152],"content":"When the issued token’s digital signature uses an RSA security key identifier, the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A&gt;</ph> property must be <ph id=\"ph2\">`true`</ph>.","source":"When the issued token’s digital signature uses an RSA security key identifier, the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.AllowUntrustedRsaIssuers%2A> property must be `true`."},{"content":"When the issued token’s signature uses an X.509 issuer serial number, X.509 subject key identifier, or X.509 thumbprint security identifier, the issued token must be signed by a certificate in the collection returned by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A&gt;</ph> property of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential&gt;</ph> class.","pos":[6162,6559],"source":"When the issued token’s signature uses an X.509 issuer serial number, X.509 subject key identifier, or X.509 thumbprint security identifier, the issued token must be signed by a certificate in the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property of the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> class."},{"content":"When the issued token is signed using an X.509 certificate, the certificate must validate per the semantics specified by the value of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A&gt;</ph> property, regardless of whether the certificate was sent to the relying party as a <ph id=\"ph2\">&lt;xref:System.IdentityModel.Tokens.X509RawDataKeyIdentifierClause&gt;</ph> or was obtained from the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A&gt;</ph> property.","pos":[6569,7078],"source":"When the issued token is signed using an X.509 certificate, the certificate must validate per the semantics specified by the value of the <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A> property, regardless of whether the certificate was sent to the relying party as a <xref:System.IdentityModel.Tokens.X509RawDataKeyIdentifierClause> or was obtained from the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.KnownCertificates%2A> property."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> X.509 certificate validation, see <bpt id=\"p1\">[</bpt>Working with Certificates<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)</ept>.","pos":[7079,7274],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] X.509 certificate validation, see [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)."},{"content":"For example, setting the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A&gt;</ph> to <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.X509CertificateValidationMode&gt;</ph> would authenticate any issued token whose signing certificate is in the <ph id=\"ph3\">`TrustedPeople`</ph> certificate store.","pos":[7281,7575],"source":"For example, setting the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A> to <xref:System.ServiceModel.Security.X509CertificateValidationMode> would authenticate any issued token whose signing certificate is in the `TrustedPeople` certificate store."},{"content":"In that case, set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential.TrustedStoreLocation%2A&gt;</ph> property to either <ph id=\"ph2\">&lt;xref:System.Security.Cryptography.X509Certificates.StoreLocation&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.Security.Cryptography.X509Certificates.StoreLocation&gt;</ph>.","pos":[7576,7843],"source":" In that case, set the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.TrustedStoreLocation%2A> property to either <xref:System.Security.Cryptography.X509Certificates.StoreLocation> or <xref:System.Security.Cryptography.X509Certificates.StoreLocation>."},{"content":"You can select other modes, including <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.X509CertificateValidationMode&gt;</ph>.","pos":[7844,7948],"source":" You can select other modes, including <xref:System.ServiceModel.Security.X509CertificateValidationMode>."},{"content":"When <ph id=\"ph1\">`Custom`</ph> is selected, you must assign an instance of the <ph id=\"ph2\">&lt;xref:System.IdentityModel.Selectors.X509CertificateValidator&gt;</ph> class to the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CustomCertificateValidator%2A&gt;</ph> property.","pos":[7949,8191],"source":" When `Custom` is selected, you must assign an instance of the <xref:System.IdentityModel.Selectors.X509CertificateValidator> class to the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CustomCertificateValidator%2A> property."},{"content":"The custom validator can validate certificates using any criteria it likes.","pos":[8192,8267]},{"content":"<ph id=\"ph1\">[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]</ph><bpt id=\"p1\">[</bpt>How to: Create a Service that Employs a Custom Certificate Validator<ept id=\"p1\">](../../../../docs/framework/wcf/extending/how-to-create-a-service-that-employs-a-custom-certificate-validator.md)</ept>.","pos":[8268,8511],"source":"[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][How to: Create a Service that Employs a Custom Certificate Validator](../../../../docs/framework/wcf/extending/how-to-create-a-service-that-employs-a-custom-certificate-validator.md)."},{"pos":[8520,8528],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Federation<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/federation.md)</ept><ph id=\"ph1\"> </ph>","pos":[8532,8607],"source":"[Federation](../../../../docs/framework/wcf/feature-details/federation.md) "},{"content":"<bpt id=\"p1\"> [</bpt>Federation and Trust<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/federation-and-trust.md)</ept><ph id=\"ph1\"> </ph>","pos":[8610,8706],"source":" [Federation and Trust](../../../../docs/framework/wcf/feature-details/federation-and-trust.md) "},{"content":"<bpt id=\"p1\"> [</bpt>Federation Sample<ept id=\"p1\">](../../../../docs/framework/wcf/samples/federation-sample.md)</ept><ph id=\"ph1\"> </ph>","pos":[8709,8791],"source":" [Federation Sample](../../../../docs/framework/wcf/samples/federation-sample.md) "},{"content":"<bpt id=\"p1\"> [</bpt>How to: Disable Secure Sessions on a WSFederationHttpBinding<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-disable-secure-sessions-on-a-wsfederationhttpbinding.md)</ept><ph id=\"ph1\"> </ph>","pos":[8794,8969],"source":" [How to: Disable Secure Sessions on a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-disable-secure-sessions-on-a-wsfederationhttpbinding.md) "},{"content":"<bpt id=\"p1\"> [</bpt>How to: Create a WSFederationHttpBinding<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)</ept><ph id=\"ph1\"> </ph>","pos":[8972,9107],"source":" [How to: Create a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md) "},{"content":"<bpt id=\"p1\"> [</bpt>How to: Create a Federated Client<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md)</ept><ph id=\"ph1\"> </ph>","pos":[9110,9231],"source":" [How to: Create a Federated Client](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md) "},{"content":"<bpt id=\"p1\"> [</bpt>Working with Certificates<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)</ept><ph id=\"ph1\"> </ph>","pos":[9234,9340],"source":" [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md) "},{"content":"<bpt id=\"p1\"> [</bpt>SecurityBindingElement Authentication Modes<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/securitybindingelement-authentication-modes.md)</ept>","pos":[9343,9484],"source":" [SecurityBindingElement Authentication Modes](../../../../docs/framework/wcf/feature-details/securitybindingelement-authentication-modes.md)"}]}