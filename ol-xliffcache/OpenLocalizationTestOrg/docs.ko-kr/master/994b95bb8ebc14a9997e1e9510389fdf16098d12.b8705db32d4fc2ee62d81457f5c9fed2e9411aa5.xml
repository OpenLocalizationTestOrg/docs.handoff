{"content":"---\ntitle: \"Sessions, Instancing, and Concurrency\"\nms.date: \"03/30/2017\"\nms.assetid: 50797a3b-7678-44ed-8138-49ac1602f35b\n---\n# Sessions, Instancing, and Concurrency\nA *session* is a correlation of all messages sent between two endpoints. *Instancing* refers to controlling the lifetime of user-defined service objects and their related <xref:System.ServiceModel.InstanceContext> objects. *Concurrency* is the term given to the control of the number of threads executing in an <xref:System.ServiceModel.InstanceContext> at the same time.  \n  \n This topic describes these settings, how to use them, and the various interactions between them.  \n  \n## Sessions  \n When a service contract sets the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property to <xref:System.ServiceModel.SessionMode.Required?displayProperty=nameWithType>, that contract is saying that all calls (that is, the underlying message exchanges that support the calls) must be part of the same conversation. If a contract specifies that it allows sessions but does not require one, clients can connect and either establish a session or not. If the session ends and a message is sent over the same session-based channel an exception is thrown.  \n  \n WCF sessions have the following main conceptual features:  \n  \n-   They are explicitly initiated and terminated by the calling application.  \n  \n-   Messages delivered during a session are processed in the order in which they are received.  \n  \n-   Sessions correlate a group of messages into a conversation. The meaning of that correlation is an abstraction. For instance, one session-based channel may correlate messages based on a shared network connection while another session-based channel may correlate messages based on a shared tag in the message body. The features that can be derived from the session depend on the nature of the correlation.  \n  \n-   There is no general data store associated with a WCF session.  \n  \n If you are familiar with the <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> class in [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] applications and the functionality it provides, you might notice the following differences between that kind of session and WCF sessions:  \n  \n-   [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] sessions are always server-initiated.  \n  \n-   [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] sessions are implicitly unordered.  \n  \n-   [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] sessions provide a general data storage mechanism across requests.  \n  \n Client applications and service applications interact with sessions in different ways. Client applications initiate sessions and then receive and process the messages sent within the session. Service applications can use sessions as an extensibility point to add additional behavior. This is done by working directly with the <xref:System.ServiceModel.InstanceContext> or implementing a custom instance context provider.  \n  \n## Instancing  \n The instancing behavior (set by using the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property) controls how the <xref:System.ServiceModel.InstanceContext> is created in response to incoming messages. By default, each <xref:System.ServiceModel.InstanceContext> is associated with one user-defined service object, so (in the default case) setting the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> property also controls the instancing of user-defined service objects. The <xref:System.ServiceModel.InstanceContextMode> enumeration defines the instancing modes.  \n  \n The following instancing modes are available:  \n  \n-   <xref:System.ServiceModel.InstanceContextMode.PerCall>: A new <xref:System.ServiceModel.InstanceContext> (and therefore service object) is created for each client request.  \n  \n-   <xref:System.ServiceModel.InstanceContextMode.PerSession>: A new <xref:System.ServiceModel.InstanceContext> (and therefore service object) is created for each new client session and maintained for the lifetime of that session (this requires a binding that supports sessions).  \n  \n-   <xref:System.ServiceModel.InstanceContextMode.Single>: A single <xref:System.ServiceModel.InstanceContext> (and therefore service object) handles all client requests for the lifetime of the application.  \n  \n The following code example shows the default <xref:System.ServiceModel.InstanceContextMode> value, <xref:System.ServiceModel.InstanceContextMode.PerSession> being explicitly set on a service class.  \n  \n```  \n[ServiceBehavior(InstanceContextMode=InstanceContextMode.PerSession)]   \npublic class CalculatorService : ICalculatorInstance   \n{   \n    ...  \n}  \n```  \n  \n And while the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property controls how often the <xref:System.ServiceModel.InstanceContext> is released, the <xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType> and <xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A?displayProperty=nameWithType> properties control when the service object is released.  \n  \n### Well-Known Singleton Services  \n One variation on single instance service objects is sometimes useful: you can create a service object yourself and create the service host using that object. To do so, you must also set the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property to <xref:System.ServiceModel.InstanceContextMode.Single> or an exception is thrown when the service host is opened.  \n  \n Use the <xref:System.ServiceModel.ServiceHost.%23ctor%28System.Object%2CSystem.Uri%5B%5D%29?displayProperty=nameWithType> constructor to create such a service. It provides an alternative to implementing a custom <xref:System.ServiceModel.Dispatcher.IInstanceContextInitializer?displayProperty=nameWithType> when you wish to provide a specific object instance for use by a singleton service. You can use this overload when your service implementation type is difficult to construct (for example, if it does not implement a default parameterless public constructor).  \n  \n Note that when an object is provided to this constructor, some features related to the Windows Communication Foundation (WCF) instancing behavior work differently. For example, calling <xref:System.ServiceModel.InstanceContext.ReleaseServiceInstance%2A?displayProperty=nameWithType> has no effect when a singleton object instance is provided. Similarly, any other instance-release mechanism is ignored. The <xref:System.ServiceModel.ServiceHost> always behaves as if the <xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType> property is set to <xref:System.ServiceModel.ReleaseInstanceMode.None?displayProperty=nameWithType> for all operations.  \n  \n### Sharing InstanceContext Objects  \n You can also control which sessionful channel or call is associated with which <xref:System.ServiceModel.InstanceContext> object by performing that association yourself.  \n  \n## Concurrency  \n Concurrency is the control of the number of threads active in an <xref:System.ServiceModel.InstanceContext> at any one time. This is controlled by using the <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A?displayProperty=nameWithType> with the <xref:System.ServiceModel.ConcurrencyMode> enumeration.  \n  \n The following three concurrency modes are available:  \n  \n-   <xref:System.ServiceModel.ConcurrencyMode.Single>: Each instance context is allowed to have a maximum of one thread processing messages in the instance context at a time. Other threads wishing to use the same instance context must block until the original thread exits the instance context.  \n  \n-   <xref:System.ServiceModel.ConcurrencyMode.Multiple>: Each service instance can have multiple threads processing messages concurrently. The service implementation must be thread-safe to use this concurrency mode.  \n  \n-   <xref:System.ServiceModel.ConcurrencyMode.Reentrant>: Each service instance processes one message at a time, but accepts re-entrant operation calls. The service only accepts these calls when it is calling out through a WCF client object.  \n  \n> [!NOTE]\n>  Understanding and developing code that safely uses more than one thread can be difficult to write successfully. Before using <xref:System.ServiceModel.ConcurrencyMode.Multiple> or <xref:System.ServiceModel.ConcurrencyMode.Reentrant> values, ensure that your service is properly designed for these modes. For more information, see <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A>.  \n  \n The use of concurrency is related to the instancing mode. In <xref:System.ServiceModel.InstanceContextMode.PerCall> instancing, concurrency is not relevant, because each message is processed by a new <xref:System.ServiceModel.InstanceContext> and, therefore, never more than one thread is active in the <xref:System.ServiceModel.InstanceContext>.  \n  \n The following code example demonstrates setting the <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A> property to <xref:System.ServiceModel.ConcurrencyMode.Multiple>.  \n  \n```  \n[ServiceBehavior(ConcurrencyMode=ConcurrencyMode.Multiple, InstanceContextMode = InstanceContextMode.Single)]   \npublic class CalculatorService : ICalculatorConcurrency   \n{   \n    ...  \n}  \n```  \n  \n## Sessions Interact with InstanceContext Settings  \n Sessions and <xref:System.ServiceModel.InstanceContext> interact depending upon the combination of the value of the <xref:System.ServiceModel.SessionMode> enumeration in a contract and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property on the service implementation, which controls the association between channels and specific service objects.  \n  \n The following table shows the result of an incoming channel either supporting sessions or not supporting sessions given a service's combination of the values of the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property.  \n  \n|InstanceContextMode value|<xref:System.ServiceModel.SessionMode.Required>|<xref:System.ServiceModel.SessionMode.Allowed>|<xref:System.ServiceModel.SessionMode.NotAllowed>|  \n|-------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|  \n|PerCall|-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each call.<br />-   Behavior with sessionless channel: An exception is thrown.|-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each call.<br />-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call.|-   Behavior with sessionful channel: An exception is thrown.<br />-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call.|  \n|PerSession|-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each channel.<br />-   Behavior with sessionless channel: An exception is thrown.|-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each channel.<br />-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call.|-   Behavior with sessionful channel: An exception is thrown.<br />-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call.|  \n|Single|-   Behavior with sessionful channel: A session and one <xref:System.ServiceModel.InstanceContext> for all calls.<br />-   Behavior with sessionless channel: An exception is thrown.|-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for the created or user-specified singleton.<br />-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for the created or user-specified singleton.|-   Behavior with sessionful channel: An exception is thrown.<br />-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each created singleton or for the user-specified singleton.|  \n  \n## See also\n\n- [Using Sessions](../../../../docs/framework/wcf/using-sessions.md)\n- [How to: Create a Service That Requires Sessions](../../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md)\n- [How to: Control Service Instancing](../../../../docs/framework/wcf/feature-details/how-to-control-service-instancing.md)\n- [Concurrency](../../../../docs/framework/wcf/samples/concurrency.md)\n- [Instancing](../../../../docs/framework/wcf/samples/instancing.md)\n- [Session](../../../../docs/framework/wcf/samples/session.md)\n","nodes":[{"pos":[4,121],"embed":true,"restype":"x-metadata","content":"title: \"Sessions, Instancing, and Concurrency\"\nms.date: \"03/30/2017\"\nms.assetid: 50797a3b-7678-44ed-8138-49ac1602f35b","nodes":[{"content":"Sessions, Instancing, and Concurrency","nodes":[{"pos":[0,37],"content":"Sessions, Instancing, and Concurrency","nodes":[{"content":"Sessions, Instancing, and Concurrency","pos":[0,37]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[128,165],"content":"Sessions, Instancing, and Concurrency","linkify":"Sessions, Instancing, and Concurrency","nodes":[{"content":"Sessions, Instancing, and Concurrency","pos":[0,37]}]},{"content":"A <bpt id=\"p1\">*</bpt>session<ept id=\"p1\">*</ept> is a correlation of all messages sent between two endpoints.","pos":[166,238],"source":"A *session* is a correlation of all messages sent between two endpoints."},{"content":"<bpt id=\"p1\">*</bpt>Instancing<ept id=\"p1\">*</ept> refers to controlling the lifetime of user-defined service objects and their related <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> objects.","pos":[239,388],"source":"*Instancing* refers to controlling the lifetime of user-defined service objects and their related <xref:System.ServiceModel.InstanceContext> objects."},{"content":"<bpt id=\"p1\">*</bpt>Concurrency<ept id=\"p1\">*</ept> is the term given to the control of the number of threads executing in an <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> at the same time.","pos":[389,537],"source":"*Concurrency* is the term given to the control of the number of threads executing in an <xref:System.ServiceModel.InstanceContext> at the same time."},{"content":"This topic describes these settings, how to use them, and the various interactions between them.","pos":[544,640]},{"pos":[649,657],"content":"Sessions","linkify":"Sessions","nodes":[{"content":"Sessions","pos":[0,8]}]},{"content":"When a service contract sets the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType&gt;</ph> property to <ph id=\"ph2\">&lt;xref:System.ServiceModel.SessionMode.Required?displayProperty=nameWithType&gt;</ph>, that contract is saying that all calls (that is, the underlying message exchanges that support the calls) must be part of the same conversation.","pos":[661,1024],"source":"When a service contract sets the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property to <xref:System.ServiceModel.SessionMode.Required?displayProperty=nameWithType>, that contract is saying that all calls (that is, the underlying message exchanges that support the calls) must be part of the same conversation."},{"content":"If a contract specifies that it allows sessions but does not require one, clients can connect and either establish a session or not.","pos":[1025,1157]},{"content":"If the session ends and a message is sent over the same session-based channel an exception is thrown.","pos":[1158,1259]},{"content":"WCF sessions have the following main conceptual features:","pos":[1266,1323]},{"content":"They are explicitly initiated and terminated by the calling application.","pos":[1333,1405]},{"content":"Messages delivered during a session are processed in the order in which they are received.","pos":[1415,1505]},{"content":"Sessions correlate a group of messages into a conversation.","pos":[1515,1574]},{"content":"The meaning of that correlation is an abstraction.","pos":[1575,1625]},{"content":"For instance, one session-based channel may correlate messages based on a shared network connection while another session-based channel may correlate messages based on a shared tag in the message body.","pos":[1626,1827]},{"content":"The features that can be derived from the session depend on the nature of the correlation.","pos":[1828,1918]},{"content":"There is no general data store associated with a WCF session.","pos":[1928,1989]},{"pos":[1996,2306],"content":"If you are familiar with the <ph id=\"ph1\">&lt;xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType&gt;</ph> class in <ph id=\"ph2\">[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]</ph> applications and the functionality it provides, you might notice the following differences between that kind of session and WCF sessions:","source":"If you are familiar with the <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> class in [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] applications and the functionality it provides, you might notice the following differences between that kind of session and WCF sessions:"},{"pos":[2316,2411],"content":"<ph id=\"ph1\">[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]</ph> sessions are always server-initiated.","source":"[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] sessions are always server-initiated."},{"pos":[2421,2513],"content":"<ph id=\"ph1\">[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]</ph> sessions are implicitly unordered.","source":"[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] sessions are implicitly unordered."},{"pos":[2523,2647],"content":"<ph id=\"ph1\">[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]</ph> sessions provide a general data storage mechanism across requests.","source":"[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] sessions provide a general data storage mechanism across requests."},{"content":"Client applications and service applications interact with sessions in different ways.","pos":[2654,2740]},{"content":"Client applications initiate sessions and then receive and process the messages sent within the session.","pos":[2741,2845]},{"content":"Service applications can use sessions as an extensibility point to add additional behavior.","pos":[2846,2937]},{"content":"This is done by working directly with the <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> or implementing a custom instance context provider.","pos":[2938,3074],"source":" This is done by working directly with the <xref:System.ServiceModel.InstanceContext> or implementing a custom instance context provider."},{"pos":[3083,3093],"content":"Instancing","linkify":"Instancing","nodes":[{"content":"Instancing","pos":[0,10]}]},{"content":"The instancing behavior (set by using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType&gt;</ph> property) controls how the <ph id=\"ph2\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> is created in response to incoming messages.","pos":[3097,3357],"source":"The instancing behavior (set by using the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property) controls how the <xref:System.ServiceModel.InstanceContext> is created in response to incoming messages."},{"content":"By default, each <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> is associated with one user-defined service object, so (in the default case) setting the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A&gt;</ph> property also controls the instancing of user-defined service objects.","pos":[3358,3652],"source":" By default, each <xref:System.ServiceModel.InstanceContext> is associated with one user-defined service object, so (in the default case) setting the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A> property also controls the instancing of user-defined service objects."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContextMode&gt;</ph> enumeration defines the instancing modes.","pos":[3653,3745],"source":" The <xref:System.ServiceModel.InstanceContextMode> enumeration defines the instancing modes."},{"content":"The following instancing modes are available:","pos":[3752,3797]},{"pos":[3807,3978],"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContextMode.PerCall&gt;</ph>: A new <ph id=\"ph2\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> (and therefore service object) is created for each client request.","source":"<xref:System.ServiceModel.InstanceContextMode.PerCall>: A new <xref:System.ServiceModel.InstanceContext> (and therefore service object) is created for each client request."},{"pos":[3988,4263],"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContextMode.PerSession&gt;</ph>: A new <ph id=\"ph2\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> (and therefore service object) is created for each new client session and maintained for the lifetime of that session (this requires a binding that supports sessions).","source":"<xref:System.ServiceModel.InstanceContextMode.PerSession>: A new <xref:System.ServiceModel.InstanceContext> (and therefore service object) is created for each new client session and maintained for the lifetime of that session (this requires a binding that supports sessions)."},{"pos":[4273,4475],"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContextMode.Single&gt;</ph>: A single <ph id=\"ph2\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> (and therefore service object) handles all client requests for the lifetime of the application.","source":"<xref:System.ServiceModel.InstanceContextMode.Single>: A single <xref:System.ServiceModel.InstanceContext> (and therefore service object) handles all client requests for the lifetime of the application."},{"pos":[4482,4679],"content":"The following code example shows the default <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContextMode&gt;</ph> value, <ph id=\"ph2\">&lt;xref:System.ServiceModel.InstanceContextMode.PerSession&gt;</ph> being explicitly set on a service class.","source":"The following code example shows the default <xref:System.ServiceModel.InstanceContextMode> value, <xref:System.ServiceModel.InstanceContextMode.PerSession> being explicitly set on a service class."},{"pos":[4849,5352],"content":"And while the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType&gt;</ph> property controls how often the <ph id=\"ph2\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> is released, the <ph id=\"ph3\">&lt;xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType&gt;</ph> and <ph id=\"ph4\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A?displayProperty=nameWithType&gt;</ph> properties control when the service object is released.","source":"And while the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property controls how often the <xref:System.ServiceModel.InstanceContext> is released, the <xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType> and <xref:System.ServiceModel.ServiceBehaviorAttribute.ReleaseServiceInstanceOnTransactionComplete%2A?displayProperty=nameWithType> properties control when the service object is released."},{"pos":[5362,5391],"content":"Well-Known Singleton Services","linkify":"Well-Known Singleton Services","nodes":[{"content":"Well-Known Singleton Services","pos":[0,29]}]},{"content":"One variation on single instance service objects is sometimes useful: you can create a service object yourself and create the service host using that object.","pos":[5395,5552]},{"content":"To do so, you must also set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType&gt;</ph> property to <ph id=\"ph2\">&lt;xref:System.ServiceModel.InstanceContextMode.Single&gt;</ph> or an exception is thrown when the service host is opened.","pos":[5553,5813],"source":" To do so, you must also set the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property to <xref:System.ServiceModel.InstanceContextMode.Single> or an exception is thrown when the service host is opened."},{"content":"Use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost.%23ctor%28System.Object%2CSystem.Uri%5B%5D%29?displayProperty=nameWithType&gt;</ph> constructor to create such a service.","pos":[5820,5979],"source":"Use the <xref:System.ServiceModel.ServiceHost.%23ctor%28System.Object%2CSystem.Uri%5B%5D%29?displayProperty=nameWithType> constructor to create such a service."},{"content":"It provides an alternative to implementing a custom <ph id=\"ph1\">&lt;xref:System.ServiceModel.Dispatcher.IInstanceContextInitializer?displayProperty=nameWithType&gt;</ph> when you wish to provide a specific object instance for use by a singleton service.","pos":[5980,6210],"source":" It provides an alternative to implementing a custom <xref:System.ServiceModel.Dispatcher.IInstanceContextInitializer?displayProperty=nameWithType> when you wish to provide a specific object instance for use by a singleton service."},{"content":"You can use this overload when your service implementation type is difficult to construct (for example, if it does not implement a default parameterless public constructor).","pos":[6211,6384]},{"content":"Note that when an object is provided to this constructor, some features related to the Windows Communication Foundation (WCF) instancing behavior work differently.","pos":[6391,6554]},{"content":"For example, calling <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext.ReleaseServiceInstance%2A?displayProperty=nameWithType&gt;</ph> has no effect when a singleton object instance is provided.","pos":[6555,6733],"source":" For example, calling <xref:System.ServiceModel.InstanceContext.ReleaseServiceInstance%2A?displayProperty=nameWithType> has no effect when a singleton object instance is provided."},{"content":"Similarly, any other instance-release mechanism is ignored.","pos":[6734,6793]},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> always behaves as if the <ph id=\"ph2\">&lt;xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType&gt;</ph> property is set to <ph id=\"ph3\">&lt;xref:System.ServiceModel.ReleaseInstanceMode.None?displayProperty=nameWithType&gt;</ph> for all operations.","pos":[6794,7087],"source":" The <xref:System.ServiceModel.ServiceHost> always behaves as if the <xref:System.ServiceModel.OperationBehaviorAttribute.ReleaseInstanceMode%2A?displayProperty=nameWithType> property is set to <xref:System.ServiceModel.ReleaseInstanceMode.None?displayProperty=nameWithType> for all operations."},{"pos":[7097,7128],"content":"Sharing InstanceContext Objects","linkify":"Sharing InstanceContext Objects","nodes":[{"content":"Sharing InstanceContext Objects","pos":[0,31]}]},{"pos":[7132,7301],"content":"You can also control which sessionful channel or call is associated with which <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> object by performing that association yourself.","source":"You can also control which sessionful channel or call is associated with which <xref:System.ServiceModel.InstanceContext> object by performing that association yourself."},{"pos":[7310,7321],"content":"Concurrency","linkify":"Concurrency","nodes":[{"content":"Concurrency","pos":[0,11]}]},{"content":"Concurrency is the control of the number of threads active in an <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> at any one time.","pos":[7325,7449],"source":"Concurrency is the control of the number of threads active in an <xref:System.ServiceModel.InstanceContext> at any one time."},{"content":"This is controlled by using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A?displayProperty=nameWithType&gt;</ph> with the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ConcurrencyMode&gt;</ph> enumeration.","pos":[7450,7646],"source":" This is controlled by using the <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A?displayProperty=nameWithType> with the <xref:System.ServiceModel.ConcurrencyMode> enumeration."},{"content":"The following three concurrency modes are available:","pos":[7653,7705]},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.ConcurrencyMode.Single&gt;</ph>: Each instance context is allowed to have a maximum of one thread processing messages in the instance context at a time.","pos":[7715,7885],"source":"<xref:System.ServiceModel.ConcurrencyMode.Single>: Each instance context is allowed to have a maximum of one thread processing messages in the instance context at a time."},{"content":"Other threads wishing to use the same instance context must block until the original thread exits the instance context.","pos":[7886,8005]},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.ConcurrencyMode.Multiple&gt;</ph>: Each service instance can have multiple threads processing messages concurrently.","pos":[8015,8149],"source":"<xref:System.ServiceModel.ConcurrencyMode.Multiple>: Each service instance can have multiple threads processing messages concurrently."},{"content":"The service implementation must be thread-safe to use this concurrency mode.","pos":[8150,8226]},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.ConcurrencyMode.Reentrant&gt;</ph>: Each service instance processes one message at a time, but accepts re-entrant operation calls.","pos":[8236,8384],"source":"<xref:System.ServiceModel.ConcurrencyMode.Reentrant>: Each service instance processes one message at a time, but accepts re-entrant operation calls."},{"content":"The service only accepts these calls when it is calling out through a WCF client object.","pos":[8385,8473]},{"pos":[8481,8893],"content":"[!NOTE]\n Understanding and developing code that safely uses more than one thread can be difficult to write successfully. Before using <xref:System.ServiceModel.ConcurrencyMode.Multiple> or <xref:System.ServiceModel.ConcurrencyMode.Reentrant> values, ensure that your service is properly designed for these modes. For more information, see <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A>.","leadings":["","> "],"nodes":[{"content":"Understanding and developing code that safely uses more than one thread can be difficult to write successfully. Before using <xref:System.ServiceModel.ConcurrencyMode.Multiple> or <xref:System.ServiceModel.ConcurrencyMode.Reentrant> values, ensure that your service is properly designed for these modes. For more information, see <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A>.","pos":[9,410],"nodes":[{"content":"Understanding and developing code that safely uses more than one thread can be difficult to write successfully.","pos":[0,111]},{"content":"Before using <ph id=\"ph1\">&lt;xref:System.ServiceModel.ConcurrencyMode.Multiple&gt;</ph> or <ph id=\"ph2\">&lt;xref:System.ServiceModel.ConcurrencyMode.Reentrant&gt;</ph> values, ensure that your service is properly designed for these modes.","pos":[112,303],"source":" Before using <xref:System.ServiceModel.ConcurrencyMode.Multiple> or <xref:System.ServiceModel.ConcurrencyMode.Reentrant> values, ensure that your service is properly designed for these modes."},{"content":"For more information, see <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A&gt;</ph>.","pos":[304,401],"source":" For more information, see <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A>."}]}]},{"content":"The use of concurrency is related to the instancing mode.","pos":[8900,8957]},{"content":"In <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContextMode.PerCall&gt;</ph> instancing, concurrency is not relevant, because each message is processed by a new <ph id=\"ph2\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> and, therefore, never more than one thread is active in the <ph id=\"ph3\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph>.","pos":[8958,9246],"source":" In <xref:System.ServiceModel.InstanceContextMode.PerCall> instancing, concurrency is not relevant, because each message is processed by a new <xref:System.ServiceModel.InstanceContext> and, therefore, never more than one thread is active in the <xref:System.ServiceModel.InstanceContext>."},{"pos":[9253,9440],"content":"The following code example demonstrates setting the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A&gt;</ph> property to <ph id=\"ph2\">&lt;xref:System.ServiceModel.ConcurrencyMode.Multiple&gt;</ph>.","source":"The following code example demonstrates setting the <xref:System.ServiceModel.ServiceBehaviorAttribute.ConcurrencyMode%2A> property to <xref:System.ServiceModel.ConcurrencyMode.Multiple>."},{"pos":[9655,9702],"content":"Sessions Interact with InstanceContext Settings","linkify":"Sessions Interact with InstanceContext Settings","nodes":[{"content":"Sessions Interact with InstanceContext Settings","pos":[0,47]}]},{"pos":[9706,10116],"content":"Sessions and <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> interact depending upon the combination of the value of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.SessionMode&gt;</ph> enumeration in a contract and the <ph id=\"ph3\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType&gt;</ph> property on the service implementation, which controls the association between channels and specific service objects.","source":"Sessions and <xref:System.ServiceModel.InstanceContext> interact depending upon the combination of the value of the <xref:System.ServiceModel.SessionMode> enumeration in a contract and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property on the service implementation, which controls the association between channels and specific service objects."},{"pos":[10123,10514],"content":"The following table shows the result of an incoming channel either supporting sessions or not supporting sessions given a service's combination of the values of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType&gt;</ph> property and the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType&gt;</ph> property.","source":"The following table shows the result of an incoming channel either supporting sessions or not supporting sessions given a service's combination of the values of the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property."},{"content":"InstanceContextMode value","pos":[10521,10546]},{"content":"PerCall","pos":[11189,11196]},{"content":"-   Behavior with sessionful channel: A session and <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> for each call.","pos":[11197,11306],"source":"-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each call."},{"content":"-   Behavior with sessionless channel: An exception is thrown.","pos":[11312,11374]},{"content":"-   Behavior with sessionful channel: A session and <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> for each call.","pos":[11375,11484],"source":"-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each call."},{"content":"-   Behavior with sessionless channel: An <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> for each call.","pos":[11490,11589],"source":"-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call."},{"content":"-   Behavior with sessionful channel: An exception is thrown.","pos":[11590,11651]},{"content":"-   Behavior with sessionless channel: An <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> for each call.","pos":[11657,11756],"source":"-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call."},{"content":"PerSession","pos":[11761,11771]},{"content":"-   Behavior with sessionful channel: A session and <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> for each channel.","pos":[11772,11884],"source":"-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each channel."},{"content":"-   Behavior with sessionless channel: An exception is thrown.","pos":[11890,11952]},{"content":"-   Behavior with sessionful channel: A session and <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> for each channel.","pos":[11953,12065],"source":"-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for each channel."},{"content":"-   Behavior with sessionless channel: An <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> for each call.","pos":[12071,12170],"source":"-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call."},{"content":"-   Behavior with sessionful channel: An exception is thrown.","pos":[12171,12232]},{"content":"-   Behavior with sessionless channel: An <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> for each call.","pos":[12238,12337],"source":"-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each call."},{"content":"Single","pos":[12342,12348]},{"content":"-   Behavior with sessionful channel: A session and one <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> for all calls.","pos":[12349,12462],"source":"-   Behavior with sessionful channel: A session and one <xref:System.ServiceModel.InstanceContext> for all calls."},{"content":"-   Behavior with sessionless channel: An exception is thrown.","pos":[12468,12530]},{"content":"-   Behavior with sessionful channel: A session and <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> for the created or user-specified singleton.","pos":[12531,12670],"source":"-   Behavior with sessionful channel: A session and <xref:System.ServiceModel.InstanceContext> for the created or user-specified singleton."},{"content":"-   Behavior with sessionless channel: An <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> for the created or user-specified singleton.","pos":[12676,12805],"source":"-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for the created or user-specified singleton."},{"content":"-   Behavior with sessionful channel: An exception is thrown.","pos":[12806,12867]},{"content":"-   Behavior with sessionless channel: An <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> for each created singleton or for the user-specified singleton.","pos":[12873,13021],"source":"-   Behavior with sessionless channel: An <xref:System.ServiceModel.InstanceContext> for each created singleton or for the user-specified singleton."},{"pos":[13031,13039],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[13043,13109],"content":"<bpt id=\"p1\">[</bpt>Using Sessions<ept id=\"p1\">](../../../../docs/framework/wcf/using-sessions.md)</ept>","source":"[Using Sessions](../../../../docs/framework/wcf/using-sessions.md)"},{"pos":[13112,13259],"content":"<bpt id=\"p1\">[</bpt>How to: Create a Service That Requires Sessions<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md)</ept>","source":"[How to: Create a Service That Requires Sessions](../../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md)"},{"pos":[13262,13383],"content":"<bpt id=\"p1\">[</bpt>How to: Control Service Instancing<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-control-service-instancing.md)</ept>","source":"[How to: Control Service Instancing](../../../../docs/framework/wcf/feature-details/how-to-control-service-instancing.md)"},{"pos":[13386,13454],"content":"<bpt id=\"p1\">[</bpt>Concurrency<ept id=\"p1\">](../../../../docs/framework/wcf/samples/concurrency.md)</ept>","source":"[Concurrency](../../../../docs/framework/wcf/samples/concurrency.md)"},{"pos":[13457,13523],"content":"<bpt id=\"p1\">[</bpt>Instancing<ept id=\"p1\">](../../../../docs/framework/wcf/samples/instancing.md)</ept>","source":"[Instancing](../../../../docs/framework/wcf/samples/instancing.md)"},{"pos":[13526,13586],"content":"<bpt id=\"p1\">[</bpt>Session<ept id=\"p1\">](../../../../docs/framework/wcf/samples/session.md)</ept>","source":"[Session](../../../../docs/framework/wcf/samples/session.md)"}]}