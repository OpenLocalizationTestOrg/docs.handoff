{"content":"---\ntitle: \"How to: Use JoinBlock to Read Data From Multiple Sources\"\nms.date: \"03/30/2017\"\nms.technology: dotnet-standard\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"Task Parallel Library, dataflows\"\n  - \"TPL dataflow library, joining blocks in\"\n  - \"dataflow blocks, joining in TPL\"\nms.assetid: e9c1ada4-ac57-4704-87cb-2f5117f8151d\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\n---\n# How to: Use JoinBlock to Read Data From Multiple Sources\nThis document explains how to use the <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> class to perform an operation when data is available from multiple sources. It also demonstrates how to use non-greedy mode to enable multiple join blocks to share a data source more efficiently.\n\n[!INCLUDE [tpl-install-instructions](../../../includes/tpl-install-instructions.md)]\n\n## Example  \n The following example defines three resource types, `NetworkResource`, `FileResource`, and `MemoryResource`, and performs operations when resources become available. This example requires a `NetworkResource` and `MemoryResource` pair in order to perform the first operation and a `FileResource` and `MemoryResource` pair in order to perform the second operation. To enable these operations to occur when all required resources are available, this example uses the <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> class. When a <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> object receives data from all sources, it propagates that data to its target, which in this example is an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object. Both <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects read from a shared pool of `MemoryResource` objects.  \n  \n [!code-csharp[TPLDataflow_NonGreedyJoin#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_nongreedyjoin/cs/nongreedyjoin.cs#1)]\n [!code-vb[TPLDataflow_NonGreedyJoin#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_nongreedyjoin/vb/nongreedyjoin.vb#1)]  \n  \n To enable efficient use of the shared pool of `MemoryResource` objects, this example specifies a <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> property set to `False` to create <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects that act in non-greedy mode. A non-greedy join block postpones all incoming messages until one is available from each source. If any of the postponed messages were accepted by another block, the join block restarts the process. Non-greedy mode enables join blocks that share one or more source blocks to make forward progress as the other blocks wait for data. In this example, if a `MemoryResource` object is added to the `memoryResources` pool, the first join block to receive its second data source can make forward progress. If this example were to use greedy mode, which is the default, one join block might take the `MemoryResource` object and wait for the second resource to become available. However, if the other join block has its second data source available, it cannot make forward progress because the `MemoryResource` object has been taken by the other join block.  \n  \n## Compiling the Code  \n Copy the example code and paste it in a Visual Studio project, or paste it in a file that is named `DataflowNonGreedyJoin.cs` (`DataflowNonGreedyJoin.vb` for Visual Basic), and then run the following command in a Developer Command Prompt for Visual Studio window.  \n  \n Visual C#  \n  \n **csc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowNonGreedyJoin.cs**  \n  \n Visual Basic  \n  \n **vbc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowNonGreedyJoin.vb**  \n  \n## Robust Programming  \n The use of non-greedy joins can also help you prevent deadlock in your application. In a software application, *deadlock* occurs when two or more processes each hold a resource and mutually wait for another process to release some other resource. Consider an application that defines two <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects. Both objects each read data from two shared source blocks. In greedy mode, if one join block reads from the first source and the second join block reads from the second source, the application might deadlock because both join blocks mutually wait for the other to release its resource. In non-greedy mode, each join block reads from its sources only when all data is available, and therefore, the risk of deadlock is eliminated.  \n  \n## See also\n\n- [Dataflow](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)\n","nodes":[{"pos":[4,390],"embed":true,"restype":"x-metadata","content":"title: \"How to: Use JoinBlock to Read Data From Multiple Sources\"\nms.date: \"03/30/2017\"\nms.technology: dotnet-standard\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"Task Parallel Library, dataflows\"\n  - \"TPL dataflow library, joining blocks in\"\n  - \"dataflow blocks, joining in TPL\"\nms.assetid: e9c1ada4-ac57-4704-87cb-2f5117f8151d\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"","nodes":[{"content":"How to: Use JoinBlock to Read Data From Multiple Sources","nodes":[{"pos":[0,56],"content":"How to: Use JoinBlock to Read Data From Multiple Sources","nodes":[{"content":"How to: Use JoinBlock to Read Data From Multiple Sources","pos":[0,56]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[397,453],"content":"How to: Use JoinBlock to Read Data From Multiple Sources","linkify":"How to: Use JoinBlock to Read Data From Multiple Sources","nodes":[{"content":"How to: Use JoinBlock to Read Data From Multiple Sources","pos":[0,56]}]},{"content":"This document explains how to use the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow.JoinBlock%602&gt;</ph> class to perform an operation when data is available from multiple sources.","pos":[454,620],"source":"This document explains how to use the <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> class to perform an operation when data is available from multiple sources."},{"content":"It also demonstrates how to use non-greedy mode to enable multiple join blocks to share a data source more efficiently.","pos":[621,740]},{"pos":[831,838],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following example defines three resource types, <ph id=\"ph1\">`NetworkResource`</ph>, <ph id=\"ph2\">`FileResource`</ph>, and <ph id=\"ph3\">`MemoryResource`</ph>, and performs operations when resources become available.","pos":[842,1007],"source":"The following example defines three resource types, `NetworkResource`, `FileResource`, and `MemoryResource`, and performs operations when resources become available."},{"content":"This example requires a <ph id=\"ph1\">`NetworkResource`</ph> and <ph id=\"ph2\">`MemoryResource`</ph> pair in order to perform the first operation and a <ph id=\"ph3\">`FileResource`</ph> and <ph id=\"ph4\">`MemoryResource`</ph> pair in order to perform the second operation.","pos":[1008,1204],"source":" This example requires a `NetworkResource` and `MemoryResource` pair in order to perform the first operation and a `FileResource` and `MemoryResource` pair in order to perform the second operation."},{"content":"To enable these operations to occur when all required resources are available, this example uses the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow.JoinBlock%602&gt;</ph> class.","pos":[1205,1365],"source":" To enable these operations to occur when all required resources are available, this example uses the <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> class."},{"content":"When a <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow.JoinBlock%602&gt;</ph> object receives data from all sources, it propagates that data to its target, which in this example is an <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Dataflow.ActionBlock%601&gt;</ph> object.","pos":[1366,1594],"source":" When a <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> object receives data from all sources, it propagates that data to its target, which in this example is an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object."},{"content":"Both <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow.JoinBlock%602&gt;</ph> objects read from a shared pool of <ph id=\"ph2\">`MemoryResource`</ph> objects.","pos":[1595,1713],"source":" Both <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects read from a shared pool of `MemoryResource` objects."},{"content":"To enable efficient use of the shared pool of <ph id=\"ph1\">`MemoryResource`</ph> objects, this example specifies a <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions&gt;</ph> object that has the <ph id=\"ph3\">&lt;xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A&gt;</ph> property set to <ph id=\"ph4\">`False`</ph> to create <ph id=\"ph5\">&lt;xref:System.Threading.Tasks.Dataflow.JoinBlock%602&gt;</ph> objects that act in non-greedy mode.","pos":[2014,2400],"source":"To enable efficient use of the shared pool of `MemoryResource` objects, this example specifies a <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> property set to `False` to create <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects that act in non-greedy mode."},{"content":"A non-greedy join block postpones all incoming messages until one is available from each source.","pos":[2401,2497]},{"content":"If any of the postponed messages were accepted by another block, the join block restarts the process.","pos":[2498,2599]},{"content":"Non-greedy mode enables join blocks that share one or more source blocks to make forward progress as the other blocks wait for data.","pos":[2600,2732]},{"content":"In this example, if a <ph id=\"ph1\">`MemoryResource`</ph> object is added to the <ph id=\"ph2\">`memoryResources`</ph> pool, the first join block to receive its second data source can make forward progress.","pos":[2733,2900],"source":" In this example, if a `MemoryResource` object is added to the `memoryResources` pool, the first join block to receive its second data source can make forward progress."},{"content":"If this example were to use greedy mode, which is the default, one join block might take the <ph id=\"ph1\">`MemoryResource`</ph> object and wait for the second resource to become available.","pos":[2901,3071],"source":" If this example were to use greedy mode, which is the default, one join block might take the `MemoryResource` object and wait for the second resource to become available."},{"content":"However, if the other join block has its second data source available, it cannot make forward progress because the <ph id=\"ph1\">`MemoryResource`</ph> object has been taken by the other join block.","pos":[3072,3250],"source":" However, if the other join block has its second data source available, it cannot make forward progress because the `MemoryResource` object has been taken by the other join block."},{"pos":[3259,3277],"content":"Compiling the Code","linkify":"Compiling the Code","nodes":[{"content":"Compiling the Code","pos":[0,18]}]},{"pos":[3281,3544],"content":"Copy the example code and paste it in a Visual Studio project, or paste it in a file that is named <ph id=\"ph1\">`DataflowNonGreedyJoin.cs`</ph> (<ph id=\"ph2\">`DataflowNonGreedyJoin.vb`</ph> for Visual Basic), and then run the following command in a Developer Command Prompt for Visual Studio window.","source":"Copy the example code and paste it in a Visual Studio project, or paste it in a file that is named `DataflowNonGreedyJoin.cs` (`DataflowNonGreedyJoin.vb` for Visual Basic), and then run the following command in a Developer Command Prompt for Visual Studio window."},{"content":"Visual C#","pos":[3551,3560]},{"pos":[3567,3642],"content":"<bpt id=\"p1\">**</bpt>csc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowNonGreedyJoin.cs<ept id=\"p1\">**</ept>","source":"**csc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowNonGreedyJoin.cs**"},{"content":"Visual Basic","pos":[3649,3661]},{"pos":[3668,3743],"content":"<bpt id=\"p1\">**</bpt>vbc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowNonGreedyJoin.vb<ept id=\"p1\">**</ept>","source":"**vbc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowNonGreedyJoin.vb**"},{"pos":[3752,3770],"content":"Robust Programming","linkify":"Robust Programming","nodes":[{"content":"Robust Programming","pos":[0,18]}]},{"content":"The use of non-greedy joins can also help you prevent deadlock in your application.","pos":[3774,3857]},{"content":"In a software application, <bpt id=\"p1\">*</bpt>deadlock<ept id=\"p1\">*</ept> occurs when two or more processes each hold a resource and mutually wait for another process to release some other resource.","pos":[3858,4020],"source":" In a software application, *deadlock* occurs when two or more processes each hold a resource and mutually wait for another process to release some other resource."},{"content":"Consider an application that defines two <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow.JoinBlock%602&gt;</ph> objects.","pos":[4021,4123],"source":" Consider an application that defines two <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects."},{"content":"Both objects each read data from two shared source blocks.","pos":[4124,4182]},{"content":"In greedy mode, if one join block reads from the first source and the second join block reads from the second source, the application might deadlock because both join blocks mutually wait for the other to release its resource.","pos":[4183,4409]},{"content":"In non-greedy mode, each join block reads from its sources only when all data is available, and therefore, the risk of deadlock is eliminated.","pos":[4410,4552]},{"pos":[4561,4569],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[4573,4662],"content":"<bpt id=\"p1\">[</bpt>Dataflow<ept id=\"p1\">](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)</ept>","source":"[Dataflow](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)"}]}