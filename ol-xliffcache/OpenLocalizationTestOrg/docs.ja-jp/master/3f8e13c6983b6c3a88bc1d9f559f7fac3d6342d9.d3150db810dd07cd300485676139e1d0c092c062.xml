{"content":"---\ntitle: \"Duplex Services\"\nms.date: \"05/09/2018\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 396b875a-d203-4ebe-a3a1-6a330d962e95\n---\n# Duplex Services\nA duplex service contract is a message exchange pattern in which both endpoints can send messages to the other independently. A duplex service, therefore, can send messages back to the client endpoint, providing event-like behavior. Duplex communication occurs when a client connects to a service and provides the service with a channel on which the service can send messages back to the client. Note that the event-like behavior of duplex services only works within a session.  \n  \n To create a duplex contract you create a pair of interfaces. The first is the service contract interface that describes the operations that a client can invoke. That service contract must specify a *callback contract* in the <xref:System.ServiceModel.ServiceContractAttribute.CallbackContract%2A?displayProperty=nameWithType> property. The callback contract is the interface that defines the operations that the service can call on the client endpoint. A duplex contract does not require a session, although the system-provided duplex bindings make use of them.  \n  \n The following is an example of a duplex contract.  \n  \n [!code-csharp[c_DuplexServices#0](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_duplexservices/cs/service.cs#0)]\n [!code-vb[c_DuplexServices#0](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_duplexservices/vb/service.vb#0)]  \n  \n The `CalculatorService` class implements the primary `ICalculatorDuplex` interface. The service uses the <xref:System.ServiceModel.InstanceContextMode.PerSession> instance mode to maintain the result for each session. A private property named `Callback` accesses the callback channel to the client. The service uses the callback for sending messages back to the client through the callback interface, as shown in the following sample code.  \n  \n [!code-csharp[c_DuplexServices#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_duplexservices/cs/service.cs#1)]\n [!code-vb[c_DuplexServices#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_duplexservices/vb/service.vb#1)]  \n  \n The client must provide a class that implements the callback interface of the duplex contract, for receiving messages from the service. The following sample code shows a `CallbackHandler` class that implements the `ICalculatorDuplexCallback` interface.  \n  \n [!code-csharp[c_DuplexServices#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_duplexservices/cs/client.cs#2)]\n [!code-vb[c_DuplexServices#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_duplexservices/vb/client.vb#2)]  \n  \n The WCF client that is generated for a duplex contract requires a <xref:System.ServiceModel.InstanceContext> class to be provided upon construction. This <xref:System.ServiceModel.InstanceContext> class is used as the site for an object that implements the callback interface and handles messages that are sent back from the service. An <xref:System.ServiceModel.InstanceContext> class is constructed with an instance of the `CallbackHandler` class. This object handles messages sent from the service to the client on the callback interface.  \n  \n [!code-csharp[c_DuplexServices#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_duplexservices/cs/client.cs#3)]\n [!code-vb[c_DuplexServices#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_duplexservices/vb/client.vb#3)]  \n  \n The configuration for the service must be set up to provide a binding that supports both session communication and duplex communication. The `wsDualHttpBinding` element supports session communication and allows duplex communication by providing dual HTTP connections, one for each direction.  \n  \n On the client, you must configure an address that the server can use to connect to the client, as shown in the following sample configuration.  \n\n> [!NOTE]\n>  Non-duplex clients that fail to authenticate using a secure conversation typically throw a <xref:System.ServiceModel.Security.MessageSecurityException>. However, if a duplex client that uses a secure conversation fails to authenticate, the client receives a <xref:System.TimeoutException> instead.  \n  \n If you create a client/service using the `WSHttpBinding` element and you do not include the client callback endpoint, you will receive the following error.  \n  \n```  \nHTTP could not register URL  \nhtp://+:80/Temporary_Listen_Addresses/<guid> because TCP port 80 is being used by another application.  \n```  \n  \n The following sample code shows how to specify the client endpoint address programmatically.\n  \n```csharp  \nWSDualHttpBinding binding = new WSDualHttpBinding();  \nEndpointAddress endptadr = new EndpointAddress(\"http://localhost:12000/DuplexTestUsingCode/Server\");  \nbinding.ClientBaseAddress = new Uri(\"http://localhost:8000/DuplexTestUsingCode/Client/\");  \n```  \n```vb\nDim binding As New WSDualHttpBinding()\nDim endptadr As New EndpointAddress(\"http://localhost:12000/DuplexTestUsingCode/Server\")\nbinding.ClientBaseAddress = New Uri(\"http://localhost:8000/DuplexTestUsingCode/Client/\")  \n```\n\n The following sample code shows how to specify the client endpoint address in configuration.  \n  \n```xml  \n<client>  \n    <endpoint name =\"ServerEndpoint\"   \n          address=\"http://localhost:12000/DuplexTestUsingConfig/Server\"  \n          bindingConfiguration=\"WSDualHttpBinding_IDuplexTest\"   \n            binding=\"wsDualHttpBinding\"  \n           contract=\"IDuplexTest\" />  \n</client>  \n<bindings>  \n    <wsDualHttpBinding>  \n        <binding name=\"WSDualHttpBinding_IDuplexTest\"    \n          clientBaseAddress=\"http://localhost:8000/myClient/\" >  \n            <security mode=\"None\"/>  \n         </binding>  \n    </wsDualHttpBinding>  \n</bindings>  \n```  \n  \n> [!WARNING]\n>  The duplex model does not automatically detect when a service or client closes its channel. So if a client unexpectedly terminates, by default the service will not be notified, or if a client unexpectedly terminates, the service will not be notified. Clients and services can implement their own protocol to notify each other if they so choose.  \n  \n## See also\n\n- [Duplex](../../../../docs/framework/wcf/samples/duplex.md)\n- [Specifying Client Run-Time Behavior](../../../../docs/framework/wcf/specifying-client-run-time-behavior.md)\n- [How to: Create a Channel Factory and Use it to Create and Manage Channels](../../../../docs/framework/wcf/feature-details/how-to-create-a-channel-factory-and-use-it-to-create-and-manage-channels.md)\n","nodes":[{"pos":[4,133],"embed":true,"restype":"x-metadata","content":"title: \"Duplex Services\"\nms.date: \"05/09/2018\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 396b875a-d203-4ebe-a3a1-6a330d962e95","nodes":[{"content":"Duplex Services","nodes":[{"pos":[0,15],"content":"Duplex Services","nodes":[{"content":"Duplex Services","pos":[0,15]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[140,155],"content":"Duplex Services","linkify":"Duplex Services","nodes":[{"content":"Duplex Services","pos":[0,15]}]},{"content":"A duplex service contract is a message exchange pattern in which both endpoints can send messages to the other independently.","pos":[156,281]},{"content":"A duplex service, therefore, can send messages back to the client endpoint, providing event-like behavior.","pos":[282,388]},{"content":"Duplex communication occurs when a client connects to a service and provides the service with a channel on which the service can send messages back to the client.","pos":[389,551]},{"content":"Note that the event-like behavior of duplex services only works within a session.","pos":[552,633]},{"content":"To create a duplex contract you create a pair of interfaces.","pos":[640,700]},{"content":"The first is the service contract interface that describes the operations that a client can invoke.","pos":[701,800]},{"content":"That service contract must specify a <bpt id=\"p1\">*</bpt>callback contract<ept id=\"p1\">*</ept> in the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceContractAttribute.CallbackContract%2A?displayProperty=nameWithType&gt;</ph> property.","pos":[801,975],"source":" That service contract must specify a *callback contract* in the <xref:System.ServiceModel.ServiceContractAttribute.CallbackContract%2A?displayProperty=nameWithType> property."},{"content":"The callback contract is the interface that defines the operations that the service can call on the client endpoint.","pos":[976,1092]},{"content":"A duplex contract does not require a session, although the system-provided duplex bindings make use of them.","pos":[1093,1201]},{"content":"The following is an example of a duplex contract.","pos":[1208,1257]},{"content":"The <ph id=\"ph1\">`CalculatorService`</ph> class implements the primary <ph id=\"ph2\">`ICalculatorDuplex`</ph> interface.","pos":[1514,1597],"source":"The `CalculatorService` class implements the primary `ICalculatorDuplex` interface."},{"content":"The service uses the <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContextMode.PerSession&gt;</ph> instance mode to maintain the result for each session.","pos":[1598,1731],"source":" The service uses the <xref:System.ServiceModel.InstanceContextMode.PerSession> instance mode to maintain the result for each session."},{"content":"A private property named <ph id=\"ph1\">`Callback`</ph> accesses the callback channel to the client.","pos":[1732,1812],"source":" A private property named `Callback` accesses the callback channel to the client."},{"content":"The service uses the callback for sending messages back to the client through the callback interface, as shown in the following sample code.","pos":[1813,1953]},{"content":"The client must provide a class that implements the callback interface of the duplex contract, for receiving messages from the service.","pos":[2210,2345]},{"content":"The following sample code shows a <ph id=\"ph1\">`CallbackHandler`</ph> class that implements the <ph id=\"ph2\">`ICalculatorDuplexCallback`</ph> interface.","pos":[2346,2462],"source":" The following sample code shows a `CallbackHandler` class that implements the `ICalculatorDuplexCallback` interface."},{"content":"The WCF client that is generated for a duplex contract requires a <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> class to be provided upon construction.","pos":[2717,2865],"source":"The WCF client that is generated for a duplex contract requires a <xref:System.ServiceModel.InstanceContext> class to be provided upon construction."},{"content":"This <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> class is used as the site for an object that implements the callback interface and handles messages that are sent back from the service.","pos":[2866,3050],"source":" This <xref:System.ServiceModel.InstanceContext> class is used as the site for an object that implements the callback interface and handles messages that are sent back from the service."},{"content":"An <ph id=\"ph1\">&lt;xref:System.ServiceModel.InstanceContext&gt;</ph> class is constructed with an instance of the <ph id=\"ph2\">`CallbackHandler`</ph> class.","pos":[3051,3166],"source":" An <xref:System.ServiceModel.InstanceContext> class is constructed with an instance of the `CallbackHandler` class."},{"content":"This object handles messages sent from the service to the client on the callback interface.","pos":[3167,3258]},{"content":"The configuration for the service must be set up to provide a binding that supports both session communication and duplex communication.","pos":[3513,3649]},{"content":"The <ph id=\"ph1\">`wsDualHttpBinding`</ph> element supports session communication and allows duplex communication by providing dual HTTP connections, one for each direction.","pos":[3650,3804],"source":" The `wsDualHttpBinding` element supports session communication and allows duplex communication by providing dual HTTP connections, one for each direction."},{"content":"On the client, you must configure an address that the server can use to connect to the client, as shown in the following sample configuration.","pos":[3811,3953]},{"pos":[3959,4267],"content":"[!NOTE]\n Non-duplex clients that fail to authenticate using a secure conversation typically throw a <xref:System.ServiceModel.Security.MessageSecurityException>. However, if a duplex client that uses a secure conversation fails to authenticate, the client receives a <xref:System.TimeoutException> instead.","leadings":["","> "],"nodes":[{"content":"Non-duplex clients that fail to authenticate using a secure conversation typically throw a <xref:System.ServiceModel.Security.MessageSecurityException>. However, if a duplex client that uses a secure conversation fails to authenticate, the client receives a <xref:System.TimeoutException> instead.","pos":[9,306],"nodes":[{"content":"Non-duplex clients that fail to authenticate using a secure conversation typically throw a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.MessageSecurityException&gt;</ph>.","pos":[0,152],"source":"Non-duplex clients that fail to authenticate using a secure conversation typically throw a <xref:System.ServiceModel.Security.MessageSecurityException>."},{"content":"However, if a duplex client that uses a secure conversation fails to authenticate, the client receives a <ph id=\"ph1\">&lt;xref:System.TimeoutException&gt;</ph> instead.","pos":[153,297],"source":" However, if a duplex client that uses a secure conversation fails to authenticate, the client receives a <xref:System.TimeoutException> instead."}]}]},{"pos":[4274,4429],"content":"If you create a client/service using the <ph id=\"ph1\">`WSHttpBinding`</ph> element and you do not include the client callback endpoint, you will receive the following error.","source":"If you create a client/service using the `WSHttpBinding` element and you do not include the client callback endpoint, you will receive the following error."},{"content":"The following sample code shows how to specify the client endpoint address programmatically.","pos":[4586,4678]},{"content":"The following sample code shows how to specify the client endpoint address in configuration.","pos":[5181,5273]},{"pos":[5847,6205],"content":"[!WARNING]\n The duplex model does not automatically detect when a service or client closes its channel. So if a client unexpectedly terminates, by default the service will not be notified, or if a client unexpectedly terminates, the service will not be notified. Clients and services can implement their own protocol to notify each other if they so choose.","leadings":["","> "],"nodes":[{"content":"The duplex model does not automatically detect when a service or client closes its channel. So if a client unexpectedly terminates, by default the service will not be notified, or if a client unexpectedly terminates, the service will not be notified. Clients and services can implement their own protocol to notify each other if they so choose.","pos":[12,356],"nodes":[{"content":"The duplex model does not automatically detect when a service or client closes its channel.","pos":[0,91]},{"content":"So if a client unexpectedly terminates, by default the service will not be notified, or if a client unexpectedly terminates, the service will not be notified.","pos":[92,250]},{"content":"Clients and services can implement their own protocol to notify each other if they so choose.","pos":[251,344]}]}]},{"pos":[6214,6222],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6226,6284],"content":"<bpt id=\"p1\">[</bpt>Duplex<ept id=\"p1\">](../../../../docs/framework/wcf/samples/duplex.md)</ept>","source":"[Duplex](../../../../docs/framework/wcf/samples/duplex.md)"},{"pos":[6287,6395],"content":"<bpt id=\"p1\">[</bpt>Specifying Client Run-Time Behavior<ept id=\"p1\">](../../../../docs/framework/wcf/specifying-client-run-time-behavior.md)</ept>","source":"[Specifying Client Run-Time Behavior](../../../../docs/framework/wcf/specifying-client-run-time-behavior.md)"},{"pos":[6398,6597],"content":"<bpt id=\"p1\">[</bpt>How to: Create a Channel Factory and Use it to Create and Manage Channels<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-channel-factory-and-use-it-to-create-and-manage-channels.md)</ept>","source":"[How to: Create a Channel Factory and Use it to Create and Manage Channels](../../../../docs/framework/wcf/feature-details/how-to-create-a-channel-factory-and-use-it-to-create-and-manage-channels.md)"}]}