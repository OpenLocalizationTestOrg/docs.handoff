{"content":"---\ntitle: \"How to: Configure a Custom WS-Metadata Exchange Binding\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"WS-Metadata Exchange [WCF]\"\n  - \"WS-Metadata Exchange [WCF], configuring a custom binding\"\nms.assetid: cdba4d73-da64-4805-bc56-9822becfd1e4\n---\n# How to: Configure a Custom WS-Metadata Exchange Binding\nThis topic will explain how to configure a custom WS-Metadata exchange binding. Windows Communication Foundation (WCF) includes four system-defined metadata bindings, but you can publish metadata using any binding you want. This topic will show you how to publish metadata using the `wsHttpBinding`. This binding gives you the option of exposing metadata in a secure way. The code in this article is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md).  \n  \n### Using a configuration file  \n  \n1.  In the service's configuration file, add a service behavior that contains the `serviceMetadata` tag:  \n  \n    ```xml  \n    <behaviors>  \n       <serviceBehaviors>  \n         <behavior name=\"CalculatorServiceBehavior\">  \n           <serviceMetadata httpGetEnabled=\"True\"/>  \n         </behavior>  \n       </serviceBehaviors>  \n    </behaviors>  \n    ```  \n  \n2.  Add a `behaviorConfiguration` attribute to the service tag that references this new behavior:  \n  \n    ```xml  \n    <service        name=\"Microsoft.ServiceModel.Samples.CalculatorService\"  \n    behaviorConfiguration=\"CalculatorServiceBehavior\">   \n    ```  \n  \n3.  Add a metadata endpoint specifying mex as the address, `wsHttpBinding` as the binding, and <xref:System.ServiceModel.Description.IMetadataExchange> as the contract:  \n  \n    ```xml  \n    <endpoint address=\"mex\"  \n              binding=\"wsHttpBinding\"  \n              contract=\"IMetadataExchange\" />  \n    ```  \n  \n4.  To verify the metadata exchange endpoint is working correctly add an endpoint tag in the client configuration file:  \n  \n    ```xml  \n    <endpoint name=\"MyMexEndpoint\"               address=\"http://localhost:8000/servicemodelsamples/service/mex\"  \n              binding=\"wsHttpBinding\"  \n              contract=\"IMetadataExchange\"/>  \n    ```  \n  \n5.  In the client's Main() method, create a new <xref:System.ServiceModel.Description.MetadataExchangeClient> instance, set its <xref:System.ServiceModel.Description.MetadataExchangeClient.ResolveMetadataReferences%2A> property to `true`, call <xref:System.ServiceModel.Description.MetadataExchangeClient.GetMetadata%2A> and then iterate through the collection of metadata returned:  \n  \n    ```  \n    string mexAddress = \"http://localhost:8000/servicemodelsamples/service/mex\";  \n  \n    MetadataExchangeClient mexClient = new MetadataExchangeClient(\"MyMexEndpoint\");  \n    mexClient.ResolveMetadataReferences = true;  \n    MetadataSet mdSet = mexClient.GetMetadata(new EndpointAddress(mexAddress));  \n    foreach (MetadataSection section in mdSet.MetadataSections)  \n    Console.WriteLine(\"Metadata section: \" + section.Dialect.ToString());  \n    ```  \n  \n### Configuring by code  \n  \n1.  Create a <xref:System.ServiceModel.WSHttpBinding> binding instance:  \n  \n    ```  \n    WSHttpBinding binding = new WSHttpBinding();  \n    ```  \n  \n2.  Create a <xref:System.ServiceModel.ServiceHost> instance:  \n  \n    ```  \n    ServiceHost serviceHost = new ServiceHost(typeof(CalculatorService), baseAddress);  \n    ```  \n  \n3.  Add a service endpoint and add a <xref:System.ServiceModel.Description.ServiceMetadataBehavior> instance:  \n  \n    ```  \n    serviceHost.AddServiceEndpoint(typeof(ICalculator), binding, baseAddress);  \n    ServiceMetadataBehavior smb = new ServiceMetadataBehavior();  \n    smb.HttpGetEnabled = true;  \n    serviceHost.Description.Behaviors.Add(smb);  \n    ```  \n  \n4.  Add a metadata exchange endpoint, specifying the <xref:System.ServiceModel.WSHttpBinding> created earlier:  \n  \n    ```  \n    serviceHost.AddServiceEndpoint(typeof(IMetadataExchange), binding, mexAddress);  \n    ```  \n  \n5.  To verify that the metadata exchange endpoint is working correctly, add an endpoint tag in the client configuration file:  \n  \n    ```xml  \n    <endpoint name=\"MyMexEndpoint\"               address=\"http://localhost:8000/servicemodelsamples/service/mex\"  \n              binding=\"wsHttpBinding\"  \n              contract=\"IMetadataExchange\"/>  \n    ```  \n  \n6.  In the client's Main() method, create a new <xref:System.ServiceModel.Description.MetadataExchangeClient> instance, set the <xref:System.ServiceModel.Description.MetadataExchangeClient.ResolveMetadataReferences%2A> property to `true`, call <xref:System.ServiceModel.Description.MetadataExchangeClient.GetMetadata%2A> and then iterate through the collection of metadata returned:  \n  \n    ```  \n    string mexAddress = \"http://localhost:8000/servicemodelsamples/service/mex\";  \n  \n    MetadataExchangeClient mexClient = new MetadataExchangeClient(\"MyMexEndpoint\");  \n    mexClient.ResolveMetadataReferences = true;  \n    MetadataSet mdSet = mexClient.GetMetadata(new EndpointAddress(mexAddress));  \n    foreach (MetadataSection section in mdSet.MetadataSections)  \n    Console.WriteLine(\"Metadata section: \" + section.Dialect.ToString());  \n    ```  \n  \n## See also\n\n- [Metadata Publishing Behavior](../../../../docs/framework/wcf/samples/metadata-publishing-behavior.md)\n- [Retrieve Metadata](../../../../docs/framework/wcf/samples/retrieve-metadata.md)\n- [Metadata](../../../../docs/framework/wcf/feature-details/metadata.md)\n- [Publishing Metadata](../../../../docs/framework/wcf/feature-details/publishing-metadata.md)\n- [Publishing Metadata Endpoints](../../../../docs/framework/wcf/publishing-metadata-endpoints.md)\n","nodes":[{"pos":[4,257],"embed":true,"restype":"x-metadata","content":"title: \"How to: Configure a Custom WS-Metadata Exchange Binding\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"WS-Metadata Exchange [WCF]\"\n  - \"WS-Metadata Exchange [WCF], configuring a custom binding\"\nms.assetid: cdba4d73-da64-4805-bc56-9822becfd1e4","nodes":[{"content":"How to: Configure a Custom WS-Metadata Exchange Binding","nodes":[{"pos":[0,55],"content":"How to: Configure a Custom WS-Metadata Exchange Binding","nodes":[{"content":"How to: Configure a Custom WS-Metadata Exchange Binding","pos":[0,55]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[264,319],"content":"How to: Configure a Custom WS-Metadata Exchange Binding","linkify":"How to: Configure a Custom WS-Metadata Exchange Binding","nodes":[{"content":"How to: Configure a Custom WS-Metadata Exchange Binding","pos":[0,55]}]},{"content":"This topic will explain how to configure a custom WS-Metadata exchange binding.","pos":[320,399]},{"content":"Windows Communication Foundation (WCF) includes four system-defined metadata bindings, but you can publish metadata using any binding you want.","pos":[400,543]},{"content":"This topic will show you how to publish metadata using the <ph id=\"ph1\">`wsHttpBinding`</ph>.","pos":[544,619],"source":" This topic will show you how to publish metadata using the `wsHttpBinding`."},{"content":"This binding gives you the option of exposing metadata in a secure way.","pos":[620,691]},{"content":"The code in this article is based on the <bpt id=\"p1\">[</bpt>Getting Started<ept id=\"p1\">](../../../../docs/framework/wcf/samples/getting-started-sample.md)</ept>.","pos":[692,817],"source":" The code in this article is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md)."},{"pos":[827,853],"content":"Using a configuration file","linkify":"Using a configuration file","nodes":[{"content":"Using a configuration file","pos":[0,26]}]},{"pos":[863,963],"content":"In the service's configuration file, add a service behavior that contains the <ph id=\"ph1\">`serviceMetadata`</ph> tag:","source":"In the service's configuration file, add a service behavior that contains the `serviceMetadata` tag:"},{"pos":[1225,1318],"content":"Add a <ph id=\"ph1\">`behaviorConfiguration`</ph> attribute to the service tag that references this new behavior:","source":"Add a `behaviorConfiguration` attribute to the service tag that references this new behavior:"},{"pos":[1490,1654],"content":"Add a metadata endpoint specifying mex as the address, <ph id=\"ph1\">`wsHttpBinding`</ph> as the binding, and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.IMetadataExchange&gt;</ph> as the contract:","source":"Add a metadata endpoint specifying mex as the address, `wsHttpBinding` as the binding, and <xref:System.ServiceModel.Description.IMetadataExchange> as the contract:"},{"content":"To verify the metadata exchange endpoint is working correctly add an endpoint tag in the client configuration file:","pos":[1808,1923]},{"pos":[2161,2539],"content":"In the client's Main() method, create a new <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.MetadataExchangeClient&gt;</ph> instance, set its <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.MetadataExchangeClient.ResolveMetadataReferences%2A&gt;</ph> property to <ph id=\"ph3\">`true`</ph>, call <ph id=\"ph4\">&lt;xref:System.ServiceModel.Description.MetadataExchangeClient.GetMetadata%2A&gt;</ph> and then iterate through the collection of metadata returned:","source":"In the client's Main() method, create a new <xref:System.ServiceModel.Description.MetadataExchangeClient> instance, set its <xref:System.ServiceModel.Description.MetadataExchangeClient.ResolveMetadataReferences%2A> property to `true`, call <xref:System.ServiceModel.Description.MetadataExchangeClient.GetMetadata%2A> and then iterate through the collection of metadata returned:"},{"pos":[3018,3037],"content":"Configuring by code","linkify":"Configuring by code","nodes":[{"content":"Configuring by code","pos":[0,19]}]},{"pos":[3047,3114],"content":"Create a <ph id=\"ph1\">&lt;xref:System.ServiceModel.WSHttpBinding&gt;</ph> binding instance:","source":"Create a <xref:System.ServiceModel.WSHttpBinding> binding instance:"},{"pos":[3198,3255],"content":"Create a <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> instance:","source":"Create a <xref:System.ServiceModel.ServiceHost> instance:"},{"pos":[3377,3482],"content":"Add a service endpoint and add a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceMetadataBehavior&gt;</ph> instance:","source":"Add a service endpoint and add a <xref:System.ServiceModel.Description.ServiceMetadataBehavior> instance:"},{"pos":[3746,3852],"content":"Add a metadata exchange endpoint, specifying the <ph id=\"ph1\">&lt;xref:System.ServiceModel.WSHttpBinding&gt;</ph> created earlier:","source":"Add a metadata exchange endpoint, specifying the <xref:System.ServiceModel.WSHttpBinding> created earlier:"},{"content":"To verify that the metadata exchange endpoint is working correctly, add an endpoint tag in the client configuration file:","pos":[3971,4092]},{"pos":[4330,4708],"content":"In the client's Main() method, create a new <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.MetadataExchangeClient&gt;</ph> instance, set the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.MetadataExchangeClient.ResolveMetadataReferences%2A&gt;</ph> property to <ph id=\"ph3\">`true`</ph>, call <ph id=\"ph4\">&lt;xref:System.ServiceModel.Description.MetadataExchangeClient.GetMetadata%2A&gt;</ph> and then iterate through the collection of metadata returned:","source":"In the client's Main() method, create a new <xref:System.ServiceModel.Description.MetadataExchangeClient> instance, set the <xref:System.ServiceModel.Description.MetadataExchangeClient.ResolveMetadataReferences%2A> property to `true`, call <xref:System.ServiceModel.Description.MetadataExchangeClient.GetMetadata%2A> and then iterate through the collection of metadata returned:"},{"pos":[5186,5194],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[5198,5300],"content":"<bpt id=\"p1\">[</bpt>Metadata Publishing Behavior<ept id=\"p1\">](../../../../docs/framework/wcf/samples/metadata-publishing-behavior.md)</ept>","source":"[Metadata Publishing Behavior](../../../../docs/framework/wcf/samples/metadata-publishing-behavior.md)"},{"pos":[5303,5383],"content":"<bpt id=\"p1\">[</bpt>Retrieve Metadata<ept id=\"p1\">](../../../../docs/framework/wcf/samples/retrieve-metadata.md)</ept>","source":"[Retrieve Metadata](../../../../docs/framework/wcf/samples/retrieve-metadata.md)"},{"pos":[5386,5456],"content":"<bpt id=\"p1\">[</bpt>Metadata<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/metadata.md)</ept>","source":"[Metadata](../../../../docs/framework/wcf/feature-details/metadata.md)"},{"pos":[5459,5551],"content":"<bpt id=\"p1\">[</bpt>Publishing Metadata<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/publishing-metadata.md)</ept>","source":"[Publishing Metadata](../../../../docs/framework/wcf/feature-details/publishing-metadata.md)"},{"pos":[5554,5650],"content":"<bpt id=\"p1\">[</bpt>Publishing Metadata Endpoints<ept id=\"p1\">](../../../../docs/framework/wcf/publishing-metadata-endpoints.md)</ept>","source":"[Publishing Metadata Endpoints](../../../../docs/framework/wcf/publishing-metadata-endpoints.md)"}]}