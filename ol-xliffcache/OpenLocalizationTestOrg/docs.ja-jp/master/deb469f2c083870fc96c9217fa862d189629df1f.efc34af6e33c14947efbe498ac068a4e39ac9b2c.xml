{"content":"---\ntitle: \"Cancel an Async Task or a List of Tasks (Visual Basic)\"\nms.date: 07/20/2015\nms.assetid: a9ee1b71-5bec-4736-a1e9-448042dd7215\n---\n# Cancel an Async Task or a List of Tasks (Visual Basic)\nYou can set up a button that you can use to cancel an async application if you don't want to wait for it to finish. By following the examples in this topic, you can add a cancellation button to an application that downloads the contents of one website or a list of websites.  \n  \n The examples use the UI that [Fine-Tuning Your Async Application (Visual Basic)](../../../../visual-basic/programming-guide/concepts/async/fine-tuning-your-async-application.md) describes.  \n  \n> [!NOTE]\n>  To run the examples, you must have Visual Studio 2012 or newer and the .NET Framework 4.5 or newer installed on your computer.  \n  \n## <a name=\"BKMK_CancelaTask\"></a> Cancel a Task  \n The first example associates the **Cancel** button with a single download task. If you choose the button while the application is downloading content, the download is canceled.  \n  \n### Downloading the Example  \n You can download the complete Windows Presentation Foundation (WPF) project from [Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea) and then follow these steps.  \n  \n1.  Decompress the file that you downloaded, and then start Visual Studio.  \n  \n2.  On the menu bar, choose **File**, **Open**, **Project/Solution**.  \n  \n3.  In the **Open Project** dialog box, open the folder that holds the sample code that you decompressed, and then open the solution (.sln) file for AsyncFineTuningVB.  \n  \n4.  In **Solution Explorer**, open the shortcut menu for the **CancelATask** project, and then choose **Set as StartUp Project**.  \n  \n5.  Choose the F5 key to run the project.  \n  \n     Choose the Ctrl+F5 keys to run the project without debugging it.  \n  \n If you don't want to download the project, you can review the MainWindow.xaml.vb files at the end of this topic.  \n  \n### Building the Example  \n The following changes add a **Cancel** button to an application that downloads a website. If you don't want to download or build the example, you can review the final product in the \"Complete Examples\" section at the end of this topic. Asterisks mark the changes in the code.  \n  \n To build the example yourself, step by step, follow the instructions in the \"Downloading the Example\" section, but choose **StarterCode** as the **StartUp Project** instead of **CancelATask**.  \n  \n Then add the following changes to the MainWindow.xaml.vb file of that project.  \n  \n1.  Declare a `CancellationTokenSource` variable, `cts`, that’s in scope for all methods that access it.  \n  \n    ```vb  \n    Class MainWindow  \n  \n        ' ***Declare a System.Threading.CancellationTokenSource.  \n        Dim cts As CancellationTokenSource  \n    ```  \n  \n2.  Add the following event handler for the **Cancel** button. The event handler uses the <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> method to notify `cts` when the user requests cancellation.  \n  \n    ```vb  \n    ' ***Add an event handler for the Cancel button.  \n    Private Sub cancelButton_Click(sender As Object, e As RoutedEventArgs)  \n  \n        If cts IsNot Nothing Then  \n            cts.Cancel()  \n        End If  \n    End Sub  \n    ```  \n  \n3.  Make the following changes in the event handler for the **Start** button, `startButton_Click`.  \n  \n    -   Instantiate the `CancellationTokenSource`, `cts`.  \n  \n        ```vb  \n        ' ***Instantiate the CancellationTokenSource.  \n        cts = New CancellationTokenSource()  \n        ```  \n  \n    -   In the call to `AccessTheWebAsync`, which downloads the contents of a specified website, send the <xref:System.Threading.CancellationTokenSource.Token%2A?displayProperty=nameWithType> property of `cts` as an argument. The `Token` property propagates the message if cancellation is requested. Add a catch block that displays a message if the user chooses to cancel the download operation. The following code shows the changes.  \n  \n        ```vb  \n        Try  \n            ' ***Send a token to carry the message if cancellation is requested.  \n            Dim contentLength As Integer = Await AccessTheWebAsync(cts.Token)  \n  \n            resultsTextBox.Text &=  \n                String.Format(vbCrLf & \"Length of the downloaded string: {0}.\" & vbCrLf, contentLength)  \n  \n            ' *** If cancellation is requested, an OperationCanceledException results.  \n        Catch ex As OperationCanceledException  \n            resultsTextBox.Text &= vbCrLf & \"Download canceled.\" & vbCrLf  \n  \n        Catch ex As Exception  \n            resultsTextBox.Text &= vbCrLf & \"Download failed.\" & vbCrLf  \n        End Try  \n        ```  \n  \n4.  In `AccessTheWebAsync`, use the  <xref:System.Net.Http.HttpClient.GetAsync%28System.String%2CSystem.Threading.CancellationToken%29?displayProperty=nameWithType> overload of the `GetAsync` method in the <xref:System.Net.Http.HttpClient> type to download the contents of a website. Pass `ct`, the <xref:System.Threading.CancellationToken> parameter of `AccessTheWebAsync`, as the second argument. The token carries the message if the user chooses the **Cancel** button.  \n  \n     The following code shows the changes in `AccessTheWebAsync`.  \n  \n    ```vb  \n    ' ***Provide a parameter for the CancellationToken.  \n    Async Function AccessTheWebAsync(ct As CancellationToken) As Task(Of Integer)  \n  \n        Dim client As HttpClient = New HttpClient()  \n  \n        resultsTextBox.Text &=  \n            String.Format(vbCrLf & \"Ready to download.\" & vbCrLf)  \n  \n        ' You might need to slow things down to have a chance to cancel.  \n        Await Task.Delay(250)  \n  \n        ' GetAsync returns a Task(Of HttpResponseMessage).   \n        ' ***The ct argument carries the message if the Cancel button is chosen.  \n        Dim response As HttpResponseMessage = Await client.GetAsync(\"https://msdn.microsoft.com/library/dd470362.aspx\", ct)  \n  \n        ' Retrieve the website contents from the HttpResponseMessage.  \n        Dim urlContents As Byte() = Await response.Content.ReadAsByteArrayAsync()  \n  \n        ' The result of the method is the length of the downloaded website.  \n        Return urlContents.Length  \n    End Function  \n    ```  \n  \n5.  If you don’t cancel the program, it produces the following output.  \n  \n    ```  \n    Ready to download.  \n    Length of the downloaded string: 158125.  \n    ```  \n  \n     If you choose the **Cancel** button before the program finishes downloading the content, the program produces the following output.  \n  \n    ```  \n    Ready to download.  \n    Download canceled.  \n    ```  \n  \n## <a name=\"BKMK_CancelaListofTasks\"></a> Cancel a List of Tasks  \n You can extend the previous example to cancel many tasks by associating the same `CancellationTokenSource` instance with each task. If you choose the **Cancel** button, you cancel all tasks that aren’t yet complete.  \n  \n### Downloading the Example  \n You can download the complete Windows Presentation Foundation (WPF) project from [Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea) and then follow these steps.  \n  \n1.  Decompress the file that you downloaded, and then start Visual Studio.  \n  \n2.  On the menu bar, choose **File**, **Open**, **Project/Solution**.  \n  \n3.  In the **Open Project** dialog box, open the folder that holds the sample code that you decompressed, and then open the solution (.sln) file for AsyncFineTuningVB.  \n  \n4.  In **Solution Explorer**, open the shortcut menu for the **CancelAListOfTasks** project, and then choose **Set as StartUp Project**.  \n  \n5.  Choose the F5 key to run the project.  \n  \n     Choose the Ctrl+F5 keys to run the project without debugging it.  \n  \n If you don't want to download the project, you can review the MainWindow.xaml.vb files at the end of this topic.  \n  \n### Building the Example  \n To extend the example yourself, step by step, follow the instructions in the \"Downloading the Example\" section, but choose **CancelATask** as the **StartUp Project**. Add the following changes to that project. Asterisks mark the changes in the program.  \n  \n1.  Add a method to create a list of web addresses.  \n  \n    ```vb  \n    ' ***Add a method that creates a list of web addresses.  \n    Private Function SetUpURLList() As List(Of String)  \n  \n        Dim urls = New List(Of String) From  \n            {  \n                \"https://msdn.microsoft.com\",  \n                \"https://msdn.microsoft.com/library/hh290138.aspx\",  \n                \"https://msdn.microsoft.com/library/hh290140.aspx\",  \n                \"https://msdn.microsoft.com/library/dd470362.aspx\",  \n                \"https://msdn.microsoft.com/library/aa578028.aspx\",  \n                \"https://msdn.microsoft.com/library/ms404677.aspx\",  \n                \"https://msdn.microsoft.com/library/ff730837.aspx\"  \n            }  \n        Return urls  \n    End Function  \n    ```  \n  \n2.  Call the method in `AccessTheWebAsync`.  \n  \n    ```vb  \n    ' ***Call SetUpURLList to make a list of web addresses.  \n    Dim urlList As List(Of String) = SetUpURLList()  \n    ```  \n  \n3.  Add the following loop in `AccessTheWebAsync` to process each web address in the list.  \n  \n    ```vb  \n    ' ***Add a loop to process the list of web addresses.  \n    For Each url In urlList  \n        ' GetAsync returns a Task(Of HttpResponseMessage).   \n        ' Argument ct carries the message if the Cancel button is chosen.   \n        ' ***Note that the Cancel button can cancel all remaining downloads.  \n        Dim response As HttpResponseMessage = Await client.GetAsync(url, ct)  \n  \n        ' Retrieve the website contents from the HttpResponseMessage.  \n        Dim urlContents As Byte() = Await response.Content.ReadAsByteArrayAsync()  \n  \n        resultsTextBox.Text &=  \n            String.Format(vbCrLf & \"Length of the downloaded string: {0}.\" & vbCrLf, urlContents.Length)  \n    Next  \n    ```  \n  \n4.  Because `AccessTheWebAsync` displays the lengths, the method doesn't need to return anything. Remove the return statement, and change the return type of the method to <xref:System.Threading.Tasks.Task> instead of <xref:System.Threading.Tasks.Task%601>.  \n  \n    ```vb  \n    Async Function AccessTheWebAsync(ct As CancellationToken) As Task  \n    ```  \n  \n     Call the method from `startButton_Click` by using a statement instead of an expression.  \n  \n    ```vb  \n    Await AccessTheWebAsync(cts.Token)  \n    ```  \n  \n5.  If you don’t cancel the program, it produces the following output.  \n  \n    ```  \n    Length of the downloaded string: 35939.  \n  \n    Length of the downloaded string: 237682.  \n  \n    Length of the downloaded string: 128607.  \n  \n    Length of the downloaded string: 158124.  \n  \n    Length of the downloaded string: 204890.  \n  \n    Length of the downloaded string: 175488.  \n  \n    Length of the downloaded string: 145790.  \n  \n    Downloads complete.  \n    ```  \n  \n     If you choose the **Cancel** button before the downloads are complete, the output contains the lengths of the downloads that completed before the cancellation.  \n  \n    ```  \n    Length of the downloaded string: 35939.  \n  \n    Length of the downloaded string: 237682.  \n  \n    Length of the downloaded string: 128607.  \n  \n    Downloads canceled.  \n    ```  \n  \n## <a name=\"BKMK_CompleteExamples\"></a> Complete Examples  \n The following sections contain the code for each of the previous examples. Notice that you must add a reference for <xref:System.Net.Http>.  \n  \n You can download the projects from [Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea).  \n  \n### Cancel a Task Example  \n The following code is the complete MainWindow.xaml.vb file for the example that cancels a single task.  \n  \n```vb  \n' Add an Imports directive and a reference for System.Net.Http.  \nImports System.Net.Http  \n  \n' Add the following Imports directive for System.Threading.  \nImports System.Threading  \n  \nClass MainWindow  \n  \n    ' ***Declare a System.Threading.CancellationTokenSource.  \n    Dim cts As CancellationTokenSource  \n  \n    Private Async Sub startButton_Click(sender As Object, e As RoutedEventArgs)  \n        ' ***Instantiate the CancellationTokenSource.  \n        cts = New CancellationTokenSource()  \n  \n        resultsTextBox.Clear()  \n  \n        Try  \n            ' ***Send a token to carry the message if cancellation is requested.  \n            Dim contentLength As Integer = Await AccessTheWebAsync(cts.Token)  \n  \n            resultsTextBox.Text &=  \n                String.Format(vbCrLf & \"Length of the downloaded string: {0}.\" & vbCrLf, contentLength)  \n  \n            ' *** If cancellation is requested, an OperationCanceledException results.  \n        Catch ex As OperationCanceledException  \n            resultsTextBox.Text &= vbCrLf & \"Download canceled.\" & vbCrLf  \n  \n        Catch ex As Exception  \n            resultsTextBox.Text &= vbCrLf & \"Download failed.\" & vbCrLf  \n        End Try  \n  \n        ' ***Set the CancellationTokenSource to Nothing when the download is complete.  \n        cts = Nothing  \n    End Sub  \n  \n    ' ***Add an event handler for the Cancel button.  \n    Private Sub cancelButton_Click(sender As Object, e As RoutedEventArgs)  \n  \n        If cts IsNot Nothing Then  \n            cts.Cancel()  \n        End If  \n    End Sub  \n  \n    ' ***Provide a parameter for the CancellationToken.  \n    Async Function AccessTheWebAsync(ct As CancellationToken) As Task(Of Integer)  \n  \n        Dim client As HttpClient = New HttpClient()  \n  \n        resultsTextBox.Text &=  \n            String.Format(vbCrLf & \"Ready to download.\" & vbCrLf)  \n  \n        ' You might need to slow things down to have a chance to cancel.  \n        Await Task.Delay(250)  \n  \n        ' GetAsync returns a Task(Of HttpResponseMessage).   \n        ' ***The ct argument carries the message if the Cancel button is chosen.  \n        Dim response As HttpResponseMessage = Await client.GetAsync(\"https://msdn.microsoft.com/library/dd470362.aspx\", ct)  \n  \n        ' Retrieve the website contents from the HttpResponseMessage.  \n        Dim urlContents As Byte() = Await response.Content.ReadAsByteArrayAsync()  \n  \n        ' The result of the method is the length of the downloaded website.  \n        Return urlContents.Length  \n    End Function  \nEnd Class  \n  \n' Output for a successful download:  \n  \n' Ready to download.  \n  \n' Length of the downloaded string: 158125.  \n  \n' Or, if you cancel:  \n  \n' Ready to download.  \n  \n' Download canceled.  \n```  \n  \n### Cancel a List of Tasks Example  \n The following code is the complete MainWindow.xaml.vb file for the example that cancels a list of tasks.  \n  \n```vb  \n' Add an Imports directive and a reference for System.Net.Http.  \nImports System.Net.Http  \n  \n' Add the following Imports directive for System.Threading.  \nImports System.Threading  \n  \nClass MainWindow  \n  \n    ' Declare a System.Threading.CancellationTokenSource.  \n    Dim cts As CancellationTokenSource  \n  \n    Private Async Sub startButton_Click(sender As Object, e As RoutedEventArgs)  \n  \n        ' Instantiate the CancellationTokenSource.  \n        cts = New CancellationTokenSource()  \n  \n        resultsTextBox.Clear()  \n  \n        Try  \n            ' ***AccessTheWebAsync returns a Task, not a Task(Of Integer).  \n            Await AccessTheWebAsync(cts.Token)  \n            '  ***Small change in the display lines.  \n            resultsTextBox.Text &= vbCrLf & \"Downloads complete.\"  \n  \n        Catch ex As OperationCanceledException  \n            resultsTextBox.Text &= vbCrLf & \"Downloads canceled.\" & vbCrLf  \n  \n        Catch ex As Exception  \n            resultsTextBox.Text &= vbCrLf & \"Downloads failed.\" & vbCrLf  \n        End Try  \n  \n        ' Set the CancellationTokenSource to Nothing when the download is complete.  \n        cts = Nothing  \n    End Sub  \n  \n    ' Add an event handler for the Cancel button.  \n    Private Sub cancelButton_Click(sender As Object, e As RoutedEventArgs)  \n  \n        If cts IsNot Nothing Then  \n            cts.Cancel()  \n        End If  \n    End Sub  \n  \n    ' Provide a parameter for the CancellationToken.  \n    ' ***Change the return type to Task because the method has no return statement.  \n    Async Function AccessTheWebAsync(ct As CancellationToken) As Task  \n  \n        Dim client As HttpClient = New HttpClient()  \n  \n        ' ***Call SetUpURLList to make a list of web addresses.  \n        Dim urlList As List(Of String) = SetUpURLList()  \n  \n        ' ***Add a loop to process the list of web addresses.  \n        For Each url In urlList  \n            ' GetAsync returns a Task(Of HttpResponseMessage).   \n            ' Argument ct carries the message if the Cancel button is chosen.   \n            ' ***Note that the Cancel button can cancel all remaining downloads.  \n            Dim response As HttpResponseMessage = Await client.GetAsync(url, ct)  \n  \n            ' Retrieve the website contents from the HttpResponseMessage.  \n            Dim urlContents As Byte() = Await response.Content.ReadAsByteArrayAsync()  \n  \n            resultsTextBox.Text &=  \n                String.Format(vbCrLf & \"Length of the downloaded string: {0}.\" & vbCrLf, urlContents.Length)  \n        Next  \n    End Function  \n  \n    ' ***Add a method that creates a list of web addresses.  \n    Private Function SetUpURLList() As List(Of String)  \n  \n        Dim urls = New List(Of String) From  \n            {  \n                \"https://msdn.microsoft.com\",  \n                \"https://msdn.microsoft.com/library/hh290138.aspx\",  \n                \"https://msdn.microsoft.com/library/hh290140.aspx\",  \n                \"https://msdn.microsoft.com/library/dd470362.aspx\",  \n                \"https://msdn.microsoft.com/library/aa578028.aspx\",  \n                \"https://msdn.microsoft.com/library/ms404677.aspx\",  \n                \"https://msdn.microsoft.com/library/ff730837.aspx\"  \n            }  \n        Return urls  \n    End Function  \n  \nEnd Class  \n  \n' Output if you do not choose to cancel:  \n  \n' Length of the downloaded string: 35939.  \n  \n' Length of the downloaded string: 237682.  \n  \n' Length of the downloaded string: 128607.  \n  \n' Length of the downloaded string: 158124.  \n  \n' Length of the downloaded string: 204890.  \n  \n' Length of the downloaded string: 175488.  \n  \n' Length of the downloaded string: 145790.  \n  \n' Downloads complete.  \n  \n'  Sample output if you choose to cancel:  \n  \n' Length of the downloaded string: 35939.  \n  \n' Length of the downloaded string: 237682.  \n  \n' Length of the downloaded string: 128607.  \n  \n' Downloads canceled.  \n```  \n  \n## See also\n\n- <xref:System.Threading.CancellationTokenSource>\n- <xref:System.Threading.CancellationToken>\n- [Asynchronous Programming with Async and Await (Visual Basic)](../../../../visual-basic/programming-guide/concepts/async/index.md)\n- [Fine-Tuning Your Async Application (Visual Basic)](../../../../visual-basic/programming-guide/concepts/async/fine-tuning-your-async-application.md)\n- [Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea)\n","nodes":[{"pos":[4,136],"embed":true,"restype":"x-metadata","content":"title: \"Cancel an Async Task or a List of Tasks (Visual Basic)\"\nms.date: 07/20/2015\nms.assetid: a9ee1b71-5bec-4736-a1e9-448042dd7215","nodes":[{"content":"Cancel an Async Task or a List of Tasks (Visual Basic)","nodes":[{"pos":[0,54],"content":"Cancel an Async Task or a List of Tasks (Visual Basic)","nodes":[{"content":"Cancel an Async Task or a List of Tasks (Visual Basic)","pos":[0,54]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[143,197],"content":"Cancel an Async Task or a List of Tasks (Visual Basic)","linkify":"Cancel an Async Task or a List of Tasks (Visual Basic)","nodes":[{"content":"Cancel an Async Task or a List of Tasks (Visual Basic)","pos":[0,54]}]},{"content":"You can set up a button that you can use to cancel an async application if you don't want to wait for it to finish.","pos":[198,313]},{"content":"By following the examples in this topic, you can add a cancellation button to an application that downloads the contents of one website or a list of websites.","pos":[314,472]},{"pos":[479,667],"content":"The examples use the UI that <bpt id=\"p1\">[</bpt>Fine-Tuning Your Async Application (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/async/fine-tuning-your-async-application.md)</ept> describes.","source":"The examples use the UI that [Fine-Tuning Your Async Application (Visual Basic)](../../../../visual-basic/programming-guide/concepts/async/fine-tuning-your-async-application.md) describes."},{"pos":[675,812],"content":"[!NOTE]\n To run the examples, you must have Visual Studio 2012 or newer and the .NET Framework 4.5 or newer installed on your computer.","leadings":["","> "],"nodes":[{"content":"To run the examples, you must have Visual Studio 2012 or newer and the .NET Framework 4.5 or newer installed on your computer.","pos":[9,135]}]},{"pos":[821,866],"content":"<bpt id=\"p1\">&lt;a name=\"BKMK_CancelaTask\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Cancel a Task","linkify":"<a name=\"BKMK_CancelaTask\"></a> Cancel a Task","source":"<a name=\"BKMK_CancelaTask\"></a> Cancel a Task"},{"content":"The first example associates the <bpt id=\"p1\">**</bpt>Cancel<ept id=\"p1\">**</ept> button with a single download task.","pos":[870,949],"source":"The first example associates the **Cancel** button with a single download task."},{"content":"If you choose the button while the application is downloading content, the download is canceled.","pos":[950,1046]},{"pos":[1056,1079],"content":"Downloading the Example","linkify":"Downloading the Example","nodes":[{"content":"Downloading the Example","pos":[0,23]}]},{"pos":[1083,1302],"content":"You can download the complete Windows Presentation Foundation (WPF) project from <bpt id=\"p1\">[</bpt>Async Sample: Fine Tuning Your Application<ept id=\"p1\">](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea)</ept> and then follow these steps.","source":"You can download the complete Windows Presentation Foundation (WPF) project from [Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea) and then follow these steps."},{"content":"Decompress the file that you downloaded, and then start Visual Studio.","pos":[1312,1382]},{"pos":[1392,1457],"content":"On the menu bar, choose <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Open<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Project/Solution<ept id=\"p3\">**</ept>.","source":"On the menu bar, choose **File**, **Open**, **Project/Solution**."},{"pos":[1467,1630],"content":"In the <bpt id=\"p1\">**</bpt>Open Project<ept id=\"p1\">**</ept> dialog box, open the folder that holds the sample code that you decompressed, and then open the solution (.sln) file for AsyncFineTuningVB.","source":"In the **Open Project** dialog box, open the folder that holds the sample code that you decompressed, and then open the solution (.sln) file for AsyncFineTuningVB."},{"pos":[1640,1765],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, open the shortcut menu for the <bpt id=\"p2\">**</bpt>CancelATask<ept id=\"p2\">**</ept> project, and then choose <bpt id=\"p3\">**</bpt>Set as StartUp Project<ept id=\"p3\">**</ept>.","source":"In **Solution Explorer**, open the shortcut menu for the **CancelATask** project, and then choose **Set as StartUp Project**."},{"content":"Choose the F5 key to run the project.","pos":[1775,1812]},{"content":"Choose the Ctrl+F5 keys to run the project without debugging it.","pos":[1823,1887]},{"content":"If you don't want to download the project, you can review the MainWindow.xaml.vb files at the end of this topic.","pos":[1894,2006]},{"pos":[2016,2036],"content":"Building the Example","linkify":"Building the Example","nodes":[{"content":"Building the Example","pos":[0,20]}]},{"content":"The following changes add a <bpt id=\"p1\">**</bpt>Cancel<ept id=\"p1\">**</ept> button to an application that downloads a website.","pos":[2040,2129],"source":"The following changes add a **Cancel** button to an application that downloads a website."},{"content":"If you don't want to download or build the example, you can review the final product in the \"Complete Examples\" section at the end of this topic.","pos":[2130,2275]},{"content":"Asterisks mark the changes in the code.","pos":[2276,2315]},{"pos":[2322,2514],"content":"To build the example yourself, step by step, follow the instructions in the \"Downloading the Example\" section, but choose <bpt id=\"p1\">**</bpt>StarterCode<ept id=\"p1\">**</ept> as the <bpt id=\"p2\">**</bpt>StartUp Project<ept id=\"p2\">**</ept> instead of <bpt id=\"p3\">**</bpt>CancelATask<ept id=\"p3\">**</ept>.","source":"To build the example yourself, step by step, follow the instructions in the \"Downloading the Example\" section, but choose **StarterCode** as the **StartUp Project** instead of **CancelATask**."},{"content":"Then add the following changes to the MainWindow.xaml.vb file of that project.","pos":[2521,2599]},{"pos":[2609,2709],"content":"Declare a <ph id=\"ph1\">`CancellationTokenSource`</ph> variable, <ph id=\"ph2\">`cts`</ph>, that’s in scope for all methods that access it.","source":"Declare a `CancellationTokenSource` variable, `cts`, that’s in scope for all methods that access it."},{"content":"Add the following event handler for the <bpt id=\"p1\">**</bpt>Cancel<ept id=\"p1\">**</ept> button.","pos":[2882,2940],"source":"Add the following event handler for the **Cancel** button."},{"content":"The event handler uses the <ph id=\"ph1\">&lt;xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType&gt;</ph> method to notify <ph id=\"ph2\">`cts`</ph> when the user requests cancellation.","pos":[2941,3114],"source":" The event handler uses the <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> method to notify `cts` when the user requests cancellation."},{"pos":[3378,3472],"content":"Make the following changes in the event handler for the <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept> button, <ph id=\"ph1\">`startButton_Click`</ph>.","source":"Make the following changes in the event handler for the **Start** button, `startButton_Click`."},{"pos":[3486,3535],"content":"Instantiate the <ph id=\"ph1\">`CancellationTokenSource`</ph>, <ph id=\"ph2\">`cts`</ph>.","source":"Instantiate the `CancellationTokenSource`, `cts`."},{"content":"In the call to <ph id=\"ph1\">`AccessTheWebAsync`</ph>, which downloads the contents of a specified website, send the <ph id=\"ph2\">&lt;xref:System.Threading.CancellationTokenSource.Token%2A?displayProperty=nameWithType&gt;</ph> property of <ph id=\"ph3\">`cts`</ph> as an argument.","pos":[3684,3901],"source":"In the call to `AccessTheWebAsync`, which downloads the contents of a specified website, send the <xref:System.Threading.CancellationTokenSource.Token%2A?displayProperty=nameWithType> property of `cts` as an argument."},{"content":"The <ph id=\"ph1\">`Token`</ph> property propagates the message if cancellation is requested.","pos":[3902,3975],"source":" The `Token` property propagates the message if cancellation is requested."},{"content":"Add a catch block that displays a message if the user chooses to cancel the download operation.","pos":[3976,4071]},{"content":"The following code shows the changes.","pos":[4072,4109]},{"content":"In <ph id=\"ph1\">`AccessTheWebAsync`</ph>, use the  <ph id=\"ph2\">&lt;xref:System.Net.Http.HttpClient.GetAsync%28System.String%2CSystem.Threading.CancellationToken%29?displayProperty=nameWithType&gt;</ph> overload of the <ph id=\"ph3\">`GetAsync`</ph> method in the <ph id=\"ph4\">&lt;xref:System.Net.Http.HttpClient&gt;</ph> type to download the contents of a website.","pos":[4819,5098],"source":"In `AccessTheWebAsync`, use the  <xref:System.Net.Http.HttpClient.GetAsync%28System.String%2CSystem.Threading.CancellationToken%29?displayProperty=nameWithType> overload of the `GetAsync` method in the <xref:System.Net.Http.HttpClient> type to download the contents of a website."},{"content":"Pass <ph id=\"ph1\">`ct`</ph>, the <ph id=\"ph2\">&lt;xref:System.Threading.CancellationToken&gt;</ph> parameter of <ph id=\"ph3\">`AccessTheWebAsync`</ph>, as the second argument.","pos":[5099,5213],"source":" Pass `ct`, the <xref:System.Threading.CancellationToken> parameter of `AccessTheWebAsync`, as the second argument."},{"content":"The token carries the message if the user chooses the <bpt id=\"p1\">**</bpt>Cancel<ept id=\"p1\">**</ept> button.","pos":[5214,5286],"source":" The token carries the message if the user chooses the **Cancel** button."},{"pos":[5297,5357],"content":"The following code shows the changes in <ph id=\"ph1\">`AccessTheWebAsync`</ph>.","source":"The following code shows the changes in `AccessTheWebAsync`."},{"content":"If you don’t cancel the program, it produces the following output.","pos":[6374,6440]},{"pos":[6546,6677],"content":"If you choose the <bpt id=\"p1\">**</bpt>Cancel<ept id=\"p1\">**</ept> button before the program finishes downloading the content, the program produces the following output.","source":"If you choose the **Cancel** button before the program finishes downloading the content, the program produces the following output."},{"pos":[6759,6820],"content":"<bpt id=\"p1\">&lt;a name=\"BKMK_CancelaListofTasks\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Cancel a List of Tasks","linkify":"<a name=\"BKMK_CancelaListofTasks\"></a> Cancel a List of Tasks","source":"<a name=\"BKMK_CancelaListofTasks\"></a> Cancel a List of Tasks"},{"content":"You can extend the previous example to cancel many tasks by associating the same <ph id=\"ph1\">`CancellationTokenSource`</ph> instance with each task.","pos":[6824,6955],"source":"You can extend the previous example to cancel many tasks by associating the same `CancellationTokenSource` instance with each task."},{"content":"If you choose the <bpt id=\"p1\">**</bpt>Cancel<ept id=\"p1\">**</ept> button, you cancel all tasks that aren’t yet complete.","pos":[6956,7039],"source":" If you choose the **Cancel** button, you cancel all tasks that aren’t yet complete."},{"pos":[7049,7072],"content":"Downloading the Example","linkify":"Downloading the Example","nodes":[{"content":"Downloading the Example","pos":[0,23]}]},{"pos":[7076,7295],"content":"You can download the complete Windows Presentation Foundation (WPF) project from <bpt id=\"p1\">[</bpt>Async Sample: Fine Tuning Your Application<ept id=\"p1\">](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea)</ept> and then follow these steps.","source":"You can download the complete Windows Presentation Foundation (WPF) project from [Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea) and then follow these steps."},{"content":"Decompress the file that you downloaded, and then start Visual Studio.","pos":[7305,7375]},{"pos":[7385,7450],"content":"On the menu bar, choose <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Open<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Project/Solution<ept id=\"p3\">**</ept>.","source":"On the menu bar, choose **File**, **Open**, **Project/Solution**."},{"pos":[7460,7623],"content":"In the <bpt id=\"p1\">**</bpt>Open Project<ept id=\"p1\">**</ept> dialog box, open the folder that holds the sample code that you decompressed, and then open the solution (.sln) file for AsyncFineTuningVB.","source":"In the **Open Project** dialog box, open the folder that holds the sample code that you decompressed, and then open the solution (.sln) file for AsyncFineTuningVB."},{"pos":[7633,7765],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, open the shortcut menu for the <bpt id=\"p2\">**</bpt>CancelAListOfTasks<ept id=\"p2\">**</ept> project, and then choose <bpt id=\"p3\">**</bpt>Set as StartUp Project<ept id=\"p3\">**</ept>.","source":"In **Solution Explorer**, open the shortcut menu for the **CancelAListOfTasks** project, and then choose **Set as StartUp Project**."},{"content":"Choose the F5 key to run the project.","pos":[7775,7812]},{"content":"Choose the Ctrl+F5 keys to run the project without debugging it.","pos":[7823,7887]},{"content":"If you don't want to download the project, you can review the MainWindow.xaml.vb files at the end of this topic.","pos":[7894,8006]},{"pos":[8016,8036],"content":"Building the Example","linkify":"Building the Example","nodes":[{"content":"Building the Example","pos":[0,20]}]},{"content":"To extend the example yourself, step by step, follow the instructions in the \"Downloading the Example\" section, but choose <bpt id=\"p1\">**</bpt>CancelATask<ept id=\"p1\">**</ept> as the <bpt id=\"p2\">**</bpt>StartUp Project<ept id=\"p2\">**</ept>.","pos":[8040,8206],"source":"To extend the example yourself, step by step, follow the instructions in the \"Downloading the Example\" section, but choose **CancelATask** as the **StartUp Project**."},{"content":"Add the following changes to that project.","pos":[8207,8249]},{"content":"Asterisks mark the changes in the program.","pos":[8250,8292]},{"content":"Add a method to create a list of web addresses.","pos":[8302,8349]},{"pos":[9092,9131],"content":"Call the method in <ph id=\"ph1\">`AccessTheWebAsync`</ph>.","source":"Call the method in `AccessTheWebAsync`."},{"pos":[9282,9368],"content":"Add the following loop in <ph id=\"ph1\">`AccessTheWebAsync`</ph> to process each web address in the list.","source":"Add the following loop in `AccessTheWebAsync` to process each web address in the list."},{"content":"Because <ph id=\"ph1\">`AccessTheWebAsync`</ph> displays the lengths, the method doesn't need to return anything.","pos":[10103,10196],"source":"Because `AccessTheWebAsync` displays the lengths, the method doesn't need to return anything."},{"content":"Remove the return statement, and change the return type of the method to <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Task&gt;</ph> instead of <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Task%601&gt;</ph>.","pos":[10197,10355],"source":" Remove the return statement, and change the return type of the method to <xref:System.Threading.Tasks.Task> instead of <xref:System.Threading.Tasks.Task%601>."},{"pos":[10463,10550],"content":"Call the method from <ph id=\"ph1\">`startButton_Click`</ph> by using a statement instead of an expression.","source":"Call the method from `startButton_Click` by using a statement instead of an expression."},{"content":"If you don’t cancel the program, it produces the following output.","pos":[10626,10692]},{"pos":[11101,11260],"content":"If you choose the <bpt id=\"p1\">**</bpt>Cancel<ept id=\"p1\">**</ept> button before the downloads are complete, the output contains the lengths of the downloads that completed before the cancellation.","source":"If you choose the **Cancel** button before the downloads are complete, the output contains the lengths of the downloads that completed before the cancellation."},{"pos":[11467,11521],"content":"<bpt id=\"p1\">&lt;a name=\"BKMK_CompleteExamples\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Complete Examples","linkify":"<a name=\"BKMK_CompleteExamples\"></a> Complete Examples","source":"<a name=\"BKMK_CompleteExamples\"></a> Complete Examples"},{"content":"The following sections contain the code for each of the previous examples.","pos":[11525,11599]},{"content":"Notice that you must add a reference for <ph id=\"ph1\">&lt;xref:System.Net.Http&gt;</ph>.","pos":[11600,11664],"source":" Notice that you must add a reference for <xref:System.Net.Http>."},{"pos":[11671,11816],"content":"You can download the projects from <bpt id=\"p1\">[</bpt>Async Sample: Fine Tuning Your Application<ept id=\"p1\">](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea)</ept>.","source":"You can download the projects from [Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea)."},{"pos":[11826,11847],"content":"Cancel a Task Example","linkify":"Cancel a Task Example","nodes":[{"content":"Cancel a Task Example","pos":[0,21]}]},{"content":"The following code is the complete MainWindow.xaml.vb file for the example that cancels a single task.","pos":[11851,11953]},{"pos":[14738,14768],"content":"Cancel a List of Tasks Example","linkify":"Cancel a List of Tasks Example","nodes":[{"content":"Cancel a List of Tasks Example","pos":[0,30]}]},{"content":"The following code is the complete MainWindow.xaml.vb file for the example that cancels a list of tasks.","pos":[14772,14876]},{"pos":[18831,18839],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[18937,19067],"content":"<bpt id=\"p1\">[</bpt>Asynchronous Programming with Async and Await (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/async/index.md)</ept>","source":"[Asynchronous Programming with Async and Await (Visual Basic)](../../../../visual-basic/programming-guide/concepts/async/index.md)"},{"pos":[19070,19218],"content":"<bpt id=\"p1\">[</bpt>Fine-Tuning Your Async Application (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/async/fine-tuning-your-async-application.md)</ept>","source":"[Fine-Tuning Your Async Application (Visual Basic)](../../../../visual-basic/programming-guide/concepts/async/fine-tuning-your-async-application.md)"},{"pos":[19221,19330],"content":"<bpt id=\"p1\">[</bpt>Async Sample: Fine Tuning Your Application<ept id=\"p1\">](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea)</ept>","source":"[Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea)"}]}