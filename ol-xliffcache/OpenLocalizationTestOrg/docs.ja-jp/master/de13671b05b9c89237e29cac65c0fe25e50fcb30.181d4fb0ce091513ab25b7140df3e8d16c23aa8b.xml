{"content":"---\ntitle: \"How to: Specify a Task Scheduler in a Dataflow Block | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"TPL dataflow library, linking to task scheduler in TPL\"\n  - \"Task Parallel Library, dataflows\"\n  - \"task scheduler, linking from TPL\"\nms.assetid: 27ece374-ed5b-49ef-9cec-b20db34a65e8\ncaps.latest.revision: 7\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# How to: Specify a Task Scheduler in a Dataflow Block\nThis document demonstrates how to associate a specific task scheduler when you use dataflow in your application. The example uses the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair?displayProperty=fullName> class in a Windows Forms application to show when reader tasks are active and when a writer task is active. It also uses the <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=fullName> method to enable a dataflow block to run on the user-interface thread.  \n  \n> [!TIP]\n>  The TPL Dataflow Library (<xref:System.Threading.Tasks.Dataflow?displayProperty=fullName> namespace) is not distributed with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)]. To install the <xref:System.Threading.Tasks.Dataflow> namespace, open your project in [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], choose **Manage NuGet Packages** from the Project menu, and search online for the `Microsoft.Tpl.Dataflow` package.  \n  \n### To Create the Windows Forms Application  \n  \n1.  Create a [!INCLUDE[csprcs](../../../includes/csprcs-md.md)] or Visual Basic **Windows Forms Application** project. In the following steps, the project is named `WriterReadersWinForms`.  \n  \n2.  On the form designer for the main form, Form1.cs (Form1.vb for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), add four <xref:System.Windows.Forms.CheckBox> controls. Set the <xref:System.Windows.Forms.Control.Text%2A> property to **Reader 1** for `checkBox1`, **Reader 2** for `checkBox2`, **Reader 3** for `checkBox3`, and **Writer** for `checkBox4`. Set the <xref:System.Windows.Forms.Control.Enabled%2A> property for each control to `False`.  \n  \n3.  Add a <xref:System.Windows.Forms.Timer> control to the form. Set the <xref:System.Windows.Forms.Timer.Interval%2A> property to `2500`.  \n  \n## Adding Dataflow Functionality  \n This section describes how to create the dataflow blocks that participate in the application and how to associate each one with a task scheduler.  \n  \n#### To Add Dataflow Functionality to the Application  \n  \n1.  In your project, add a reference to System.Threading.Tasks.Dataflow.dll.  \n  \n2.  Ensure that Form1.cs (Form1.vb for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) contains the following `using` statements (`Imports` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]).  \n  \n     [!code-csharp[TPLDataflow_WriterReadersWinForms#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#1)]\n     [!code-vb[TPLDataflow_WriterReadersWinForms#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#1)]  \n  \n3.  Add a <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> data member to the `Form1` class.  \n  \n     [!code-csharp[TPLDataflow_WriterReadersWinForms#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#2)]\n     [!code-vb[TPLDataflow_WriterReadersWinForms#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#2)]  \n  \n4.  In the `Form1` constructor, after the call to `InitializeComponent`, create an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object that toggles the state of <xref:System.Windows.Forms.CheckBox> objects.  \n  \n     [!code-csharp[TPLDataflow_WriterReadersWinForms#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#3)]\n     [!code-vb[TPLDataflow_WriterReadersWinForms#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#3)]  \n  \n5.  In the `Form1` constructor, create a <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> object and four <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> objects, one <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object for each <xref:System.Windows.Forms.CheckBox> object. For each <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object, specify a <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property set to the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair.ConcurrentScheduler%2A> property for the readers, and the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair.ExclusiveScheduler%2A> property for the writer.  \n  \n     [!code-csharp[TPLDataflow_WriterReadersWinForms#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#4)]\n     [!code-vb[TPLDataflow_WriterReadersWinForms#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#4)]  \n  \n6.  In the `Form1` constructor, start the <xref:System.Windows.Forms.Timer> object.  \n  \n     [!code-csharp[TPLDataflow_WriterReadersWinForms#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#5)]\n     [!code-vb[TPLDataflow_WriterReadersWinForms#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#5)]  \n  \n7.  On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.Timer.Tick> event for the timer.  \n  \n8.  Implement the <xref:System.Windows.Forms.Timer.Tick> event for the timer.  \n  \n     [!code-csharp[TPLDataflow_WriterReadersWinForms#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#6)]\n     [!code-vb[TPLDataflow_WriterReadersWinForms#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#6)]  \n  \n Because the `toggleCheckBox` dataflow block acts on the user interface, it is important that this action occur on the user-interface thread. To accomplish this, during construction this object provides a <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property set to <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=fullName>. The <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A> method creates a <xref:System.Threading.Tasks.TaskScheduler> object that performs work on the current synchronization context. Because the `Form1` constructor is called from the user-interface thread, the action for the `toggleCheckBox` dataflow block also runs on the user-interface thread.  \n  \n This example also uses the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> class to enable some dataflow blocks to act concurrently, and another dataflow block to act exclusive with respect to all other dataflow blocks that run on the same <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> object. This technique is useful when multiple dataflow blocks share a resource and some require exclusive access to that resource, because it eliminates the requirement to manually synchronize access to that resource. The elimination of manual synchronization can make code more efficient.  \n  \n## Example  \n The following example shows the complete code for Form1.cs (Form1.vb for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]).  \n  \n [!code-csharp[TPLDataflow_WriterReadersWinForms#100](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#100)]\n [!code-vb[TPLDataflow_WriterReadersWinForms#100](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#100)]  \n  \n## See Also  \n [Dataflow](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)","nodes":[{"pos":[12,81],"content":"How to: Specify a Task Scheduler in a Dataflow Block | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"How to: Specify a Task Scheduler in a Dataflow Block | Microsoft Docs","pos":[0,69]}]},{"pos":[533,585],"content":"How to: Specify a Task Scheduler in a Dataflow Block","linkify":"How to: Specify a Task Scheduler in a Dataflow Block","nodes":[{"content":"How to: Specify a Task Scheduler in a Dataflow Block","pos":[0,52]}]},{"content":"This document demonstrates how to associate a specific task scheduler when you use dataflow in your application.","pos":[586,698]},{"content":"The example uses the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair?displayProperty=fullName&gt;</ph> class in a Windows Forms application to show when reader tasks are active and when a writer task is active.","pos":[699,915],"source":" The example uses the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair?displayProperty=fullName> class in a Windows Forms application to show when reader tasks are active and when a writer task is active."},{"content":"It also uses the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=fullName&gt;</ph> method to enable a dataflow block to run on the user-interface thread.","pos":[916,1109],"source":" It also uses the <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=fullName> method to enable a dataflow block to run on the user-interface thread."},{"pos":[1117,1577],"content":"[!TIP]\n The TPL Dataflow Library (<xref:System.Threading.Tasks.Dataflow?displayProperty=fullName> namespace) is not distributed with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)]. To install the <xref:System.Threading.Tasks.Dataflow> namespace, open your project in [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], choose **Manage NuGet Packages** from the Project menu, and search online for the `Microsoft.Tpl.Dataflow` package.","leadings":["","> "],"nodes":[{"content":" The TPL Dataflow Library (<xref:System.Threading.Tasks.Dataflow?displayProperty=fullName> namespace) is not distributed with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)]. To install the <xref:System.Threading.Tasks.Dataflow> namespace, open your project in [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], choose **Manage NuGet Packages** from the Project menu, and search online for the `Microsoft.Tpl.Dataflow` package.","pos":[7,458],"nodes":[{"content":"The TPL Dataflow Library (<ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow?displayProperty=fullName&gt;</ph> namespace) is not distributed with the <ph id=\"ph2\">[!INCLUDE[net_v45](../../../includes/net-v45-md.md)]</ph>.","pos":[1,183],"source":" The TPL Dataflow Library (<xref:System.Threading.Tasks.Dataflow?displayProperty=fullName> namespace) is not distributed with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)]."},{"content":"To install the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow&gt;</ph> namespace, open your project in <ph id=\"ph2\">[!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)]</ph>, choose <bpt id=\"p1\">**</bpt>Manage NuGet Packages<ept id=\"p1\">**</ept> from the Project menu, and search online for the <ph id=\"ph3\">`Microsoft.Tpl.Dataflow`</ph> package.","pos":[184,451],"source":" To install the <xref:System.Threading.Tasks.Dataflow> namespace, open your project in [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], choose **Manage NuGet Packages** from the Project menu, and search online for the `Microsoft.Tpl.Dataflow` package."}]}]},{"pos":[1587,1626],"content":"To Create the Windows Forms Application","linkify":"To Create the Windows Forms Application","nodes":[{"content":"To Create the Windows Forms Application","pos":[0,39]}]},{"content":"Create a <ph id=\"ph1\">[!INCLUDE[csprcs](../../../includes/csprcs-md.md)]</ph> or Visual Basic <bpt id=\"p1\">**</bpt>Windows Forms Application<ept id=\"p1\">**</ept> project.","pos":[1636,1750],"source":"Create a [!INCLUDE[csprcs](../../../includes/csprcs-md.md)] or Visual Basic **Windows Forms Application** project."},{"content":"In the following steps, the project is named <ph id=\"ph1\">`WriterReadersWinForms`</ph>.","pos":[1751,1820],"source":" In the following steps, the project is named `WriterReadersWinForms`."},{"content":"On the form designer for the main form, Form1.cs (Form1.vb for <ph id=\"ph1\">[!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]</ph>), add four <ph id=\"ph2\">&lt;xref:System.Windows.Forms.CheckBox&gt;</ph> controls.","pos":[1830,2001],"source":"On the form designer for the main form, Form1.cs (Form1.vb for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), add four <xref:System.Windows.Forms.CheckBox> controls."},{"content":"Set the <ph id=\"ph1\">&lt;xref:System.Windows.Forms.Control.Text%2A&gt;</ph> property to <bpt id=\"p1\">**</bpt>Reader 1<ept id=\"p1\">**</ept> for <ph id=\"ph2\">`checkBox1`</ph>, <bpt id=\"p2\">**</bpt>Reader 2<ept id=\"p2\">**</ept> for <ph id=\"ph3\">`checkBox2`</ph>, <bpt id=\"p3\">**</bpt>Reader 3<ept id=\"p3\">**</ept> for <ph id=\"ph4\">`checkBox3`</ph>, and <bpt id=\"p4\">**</bpt>Writer<ept id=\"p4\">**</ept> for <ph id=\"ph5\">`checkBox4`</ph>.","pos":[2002,2187],"source":" Set the <xref:System.Windows.Forms.Control.Text%2A> property to **Reader 1** for `checkBox1`, **Reader 2** for `checkBox2`, **Reader 3** for `checkBox3`, and **Writer** for `checkBox4`."},{"content":"Set the <ph id=\"ph1\">&lt;xref:System.Windows.Forms.Control.Enabled%2A&gt;</ph> property for each control to <ph id=\"ph2\">`False`</ph>.","pos":[2188,2280],"source":" Set the <xref:System.Windows.Forms.Control.Enabled%2A> property for each control to `False`."},{"content":"Add a <ph id=\"ph1\">&lt;xref:System.Windows.Forms.Timer&gt;</ph> control to the form.","pos":[2290,2350],"source":"Add a <xref:System.Windows.Forms.Timer> control to the form."},{"content":"Set the <ph id=\"ph1\">&lt;xref:System.Windows.Forms.Timer.Interval%2A&gt;</ph> property to <ph id=\"ph2\">`2500`</ph>.","pos":[2351,2424],"source":" Set the <xref:System.Windows.Forms.Timer.Interval%2A> property to `2500`."},{"pos":[2433,2462],"content":"Adding Dataflow Functionality","linkify":"Adding Dataflow Functionality","nodes":[{"content":"Adding Dataflow Functionality","pos":[0,29]}]},{"content":"This section describes how to create the dataflow blocks that participate in the application and how to associate each one with a task scheduler.","pos":[2466,2611]},{"pos":[2622,2670],"content":"To Add Dataflow Functionality to the Application","linkify":"To Add Dataflow Functionality to the Application","nodes":[{"content":"To Add Dataflow Functionality to the Application","pos":[0,48]}]},{"content":"In your project, add a reference to System.Threading.Tasks.Dataflow.dll.","pos":[2680,2752]},{"pos":[2762,2957],"content":"Ensure that Form1.cs (Form1.vb for <ph id=\"ph1\">[!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]</ph>) contains the following <ph id=\"ph2\">`using`</ph> statements (<ph id=\"ph3\">`Imports`</ph> in <ph id=\"ph4\">[!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]</ph>).","source":"Ensure that Form1.cs (Form1.vb for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) contains the following `using` statements (`Imports` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)])."},{"pos":[2968,3319],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPLDataflow_WriterReadersWinForms#1<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#1)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPLDataflow_WriterReadersWinForms#1<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#1)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[TPLDataflow_WriterReadersWinForms#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#1)]\n [!code-vb[TPLDataflow_WriterReadersWinForms#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#1)]"},{"pos":[3329,3426],"content":"Add a <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601&gt;</ph> data member to the <ph id=\"ph2\">`Form1`</ph> class.","source":"Add a <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> data member to the `Form1` class."},{"pos":[3437,3788],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPLDataflow_WriterReadersWinForms#2<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#2)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPLDataflow_WriterReadersWinForms#2<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#2)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[TPLDataflow_WriterReadersWinForms#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#2)]\n [!code-vb[TPLDataflow_WriterReadersWinForms#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#2)]"},{"pos":[3798,4010],"content":"In the <ph id=\"ph1\">`Form1`</ph> constructor, after the call to <ph id=\"ph2\">`InitializeComponent`</ph>, create an <ph id=\"ph3\">&lt;xref:System.Threading.Tasks.Dataflow.ActionBlock%601&gt;</ph> object that toggles the state of <ph id=\"ph4\">&lt;xref:System.Windows.Forms.CheckBox&gt;</ph> objects.","source":"In the `Form1` constructor, after the call to `InitializeComponent`, create an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object that toggles the state of <xref:System.Windows.Forms.CheckBox> objects."},{"pos":[4021,4372],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPLDataflow_WriterReadersWinForms#3<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#3)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPLDataflow_WriterReadersWinForms#3<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#3)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[TPLDataflow_WriterReadersWinForms#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#3)]\n [!code-vb[TPLDataflow_WriterReadersWinForms#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#3)]"},{"content":"In the <ph id=\"ph1\">`Form1`</ph> constructor, create a <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair&gt;</ph> object and four <ph id=\"ph3\">&lt;xref:System.Threading.Tasks.Dataflow.ActionBlock%601&gt;</ph> objects, one <ph id=\"ph4\">&lt;xref:System.Threading.Tasks.Dataflow.ActionBlock%601&gt;</ph> object for each <ph id=\"ph5\">&lt;xref:System.Windows.Forms.CheckBox&gt;</ph> object.","pos":[4382,4681],"source":"In the `Form1` constructor, create a <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> object and four <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> objects, one <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object for each <xref:System.Windows.Forms.CheckBox> object."},{"content":"For each <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow.ActionBlock%601&gt;</ph> object, specify a <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions&gt;</ph> object that has the <ph id=\"ph3\">&lt;xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A&gt;</ph> property set to the <ph id=\"ph4\">&lt;xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair.ConcurrentScheduler%2A&gt;</ph> property for the readers, and the <ph id=\"ph5\">&lt;xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair.ExclusiveScheduler%2A&gt;</ph> property for the writer.","pos":[4682,5179],"source":" For each <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object, specify a <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property set to the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair.ConcurrentScheduler%2A> property for the readers, and the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair.ExclusiveScheduler%2A> property for the writer."},{"pos":[5190,5541],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPLDataflow_WriterReadersWinForms#4<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#4)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPLDataflow_WriterReadersWinForms#4<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#4)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[TPLDataflow_WriterReadersWinForms#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#4)]\n [!code-vb[TPLDataflow_WriterReadersWinForms#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#4)]"},{"pos":[5551,5630],"content":"In the <ph id=\"ph1\">`Form1`</ph> constructor, start the <ph id=\"ph2\">&lt;xref:System.Windows.Forms.Timer&gt;</ph> object.","source":"In the `Form1` constructor, start the <xref:System.Windows.Forms.Timer> object."},{"pos":[5641,5992],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPLDataflow_WriterReadersWinForms#5<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#5)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPLDataflow_WriterReadersWinForms#5<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#5)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[TPLDataflow_WriterReadersWinForms#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#5)]\n [!code-vb[TPLDataflow_WriterReadersWinForms#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#5)]"},{"content":"On the form designer for the main form, create an event handler for the <ph id=\"ph1\">&lt;xref:System.Windows.Forms.Timer.Tick&gt;</ph> event for the timer.","pos":[6002,6133],"source":"On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.Timer.Tick> event for the timer."},{"content":"Implement the <ph id=\"ph1\">&lt;xref:System.Windows.Forms.Timer.Tick&gt;</ph> event for the timer.","pos":[6143,6216],"source":"Implement the <xref:System.Windows.Forms.Timer.Tick> event for the timer."},{"pos":[6227,6578],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPLDataflow_WriterReadersWinForms#6<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#6)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPLDataflow_WriterReadersWinForms#6<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#6)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[TPLDataflow_WriterReadersWinForms#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#6)]\n [!code-vb[TPLDataflow_WriterReadersWinForms#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#6)]"},{"content":"Because the <ph id=\"ph1\">`toggleCheckBox`</ph> dataflow block acts on the user interface, it is important that this action occur on the user-interface thread.","pos":[6585,6725],"source":"Because the `toggleCheckBox` dataflow block acts on the user interface, it is important that this action occur on the user-interface thread."},{"content":"To accomplish this, during construction this object provides a <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions&gt;</ph> object that has the <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A&gt;</ph> property set to <ph id=\"ph3\">&lt;xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=fullName&gt;</ph>.","pos":[6726,7077],"source":" To accomplish this, during construction this object provides a <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property set to <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=fullName>."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A&gt;</ph> method creates a <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.TaskScheduler&gt;</ph> object that performs work on the current synchronization context.","pos":[7078,7289],"source":" The <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A> method creates a <xref:System.Threading.Tasks.TaskScheduler> object that performs work on the current synchronization context."},{"content":"Because the <ph id=\"ph1\">`Form1`</ph> constructor is called from the user-interface thread, the action for the <ph id=\"ph2\">`toggleCheckBox`</ph> dataflow block also runs on the user-interface thread.","pos":[7290,7454],"source":" Because the `Form1` constructor is called from the user-interface thread, the action for the `toggleCheckBox` dataflow block also runs on the user-interface thread."},{"content":"This example also uses the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair&gt;</ph> class to enable some dataflow blocks to act concurrently, and another dataflow block to act exclusive with respect to all other dataflow blocks that run on the same <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair&gt;</ph> object.","pos":[7461,7786],"source":"This example also uses the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> class to enable some dataflow blocks to act concurrently, and another dataflow block to act exclusive with respect to all other dataflow blocks that run on the same <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> object."},{"content":"This technique is useful when multiple dataflow blocks share a resource and some require exclusive access to that resource, because it eliminates the requirement to manually synchronize access to that resource.","pos":[7787,7997]},{"content":"The elimination of manual synchronization can make code more efficient.","pos":[7998,8069]},{"pos":[8078,8085],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"pos":[8089,8214],"content":"The following example shows the complete code for Form1.cs (Form1.vb for <ph id=\"ph1\">[!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]</ph>).","source":"The following example shows the complete code for Form1.cs (Form1.vb for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)])."},{"pos":[8221,8576],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPLDataflow_WriterReadersWinForms#100<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#100)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPLDataflow_WriterReadersWinForms#100<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#100)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[TPLDataflow_WriterReadersWinForms#100](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#100)]\n [!code-vb[TPLDataflow_WriterReadersWinForms#100](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#100)]"},{"pos":[8585,8593],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[8597,8686],"content":"<bpt id=\"p1\">[</bpt>Dataflow<ept id=\"p1\">](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)</ept>","source":"[Dataflow](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)"}]}