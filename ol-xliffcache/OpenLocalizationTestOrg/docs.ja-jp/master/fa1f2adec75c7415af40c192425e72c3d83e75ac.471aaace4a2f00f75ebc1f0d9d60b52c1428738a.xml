{"content":"---\ntitle: \"Authorizing Access to Service Operations | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"service behaviors, authorizing access sample\"\n  - \"Authorizing Access To Service Operations Sample [Windows Communication Foundation]\"\n  - \"authorization, Windows Communication Foundation sample\"\nms.assetid: ddcfdaa5-8b2e-4e13-bd85-887209dc6328\ncaps.latest.revision: 23\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Authorizing Access to Service Operations\nThis sample demonstrates how to use the [\\<serviceAuthorization>](../../../../docs/framework/configure-apps/file-schema/wcf/serviceauthorization-element.md) to enable use of the <xref:System.Security.Permissions.PrincipalPermissionAttribute> attribute to authorize access to service operations. This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) sample. The service and client are configured using the [\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md). The `mode` attribute of the [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-of-custombinding.md) has been set to `Message` and `clientCredentialType` has been set to `Windows`. The <xref:System.Security.Permissions.PrincipalPermissionAttribute> is applied to each service method and used to restrict access to each operation. The caller must be a Windows administrator to access each operation.  \n  \n In this sample, the client is a console application (.exe) and the service is hosted by Internet Information Services (IIS).  \n  \n> [!NOTE]\n>  The setup procedure and build instructions for this sample are located at the end of this topic.  \n  \n The service configuration file uses the [\\<serviceAuthorization>](../../../../docs/framework/configure-apps/file-schema/wcf/serviceauthorization-element.md) to set the `principalPermissionMode` attribute:  \n  \n```  \n<behaviors>  \n  <serviceBehaviors>  \n    <behavior>  \n      ...  \n      <!-- The serviceAuthorization behavior sets the  \n           principalPermissionMode to UseWindowsGroups.  \n           This puts a WindowsPrincipal on the current thread when a   \n           service is invoked. -->  \n      <serviceAuthorization principalPermissionMode=\"UseWindowsGroups\" />  \n    </behavior>  \n  </serviceBehaviors>  \n</behaviors>  \n```  \n  \n Setting the `principalPermissionMode` to `UseWindowsGroups` enables the use of <xref:System.Security.Permissions.PrincipalPermissionAttribute> based on Windows group names.  \n  \n The <xref:System.Security.Permissions.PrincipalPermissionAttribute> is applied to each operation to require the caller to be part of the Windows administrators group, as shown in the following sample code.  \n  \n```  \n[PrincipalPermission(SecurityAction.Demand,   \n                             Role = \"Builtin\\\\Administrators\")]  \npublic double Add(double n1, double n2)  \n{  \n    double result = n1 + n2;  \n    return result;  \n}  \n```  \n  \n When you run the sample, the operation requests and responses are displayed in the client console window. The client successfully communicates with each operation if it is running under an account that is part of the Administrators group; otherwise, access is denied. To experiment with authorization failure, run the client under an account that is not part of the Administrators group. Press ENTER in the console window to shut down the client.  \n  \n A service can be notified of authorization failures by implementing an <xref:System.ServiceModel.Dispatcher.IErrorHandler>. See [Extending Control Over Error Handling and Reporting](../../../../docs/framework/wcf/samples/extending-control-over-error-handling-and-reporting.md) for information about implementing `IErrorHandler`.  \n  \n### To set up, build, and run the sample  \n  \n1.  Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).  \n  \n2.  To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).  \n  \n3.  To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).  \n  \n## See Also","nodes":[{"pos":[12,69],"content":"Authorizing Access to Service Operations | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Authorizing Access to Service Operations | Microsoft Docs","pos":[0,57]}]},{"pos":[591,631],"content":"Authorizing Access to Service Operations","linkify":"Authorizing Access to Service Operations","nodes":[{"content":"Authorizing Access to Service Operations","pos":[0,40]}]},{"content":"This sample demonstrates how to use the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>serviceAuthorization&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/serviceauthorization-element.md)</ept> to enable use of the <ph id=\"ph2\">&lt;xref:System.Security.Permissions.PrincipalPermissionAttribute&gt;</ph> attribute to authorize access to service operations.","pos":[632,926],"source":"This sample demonstrates how to use the [\\<serviceAuthorization>](../../../../docs/framework/configure-apps/file-schema/wcf/serviceauthorization-element.md) to enable use of the <xref:System.Security.Permissions.PrincipalPermissionAttribute> attribute to authorize access to service operations."},{"content":"This sample is based on the <bpt id=\"p1\">[</bpt>Getting Started<ept id=\"p1\">](../../../../docs/framework/wcf/samples/getting-started-sample.md)</ept> sample.","pos":[927,1046],"source":" This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md) sample."},{"content":"The service and client are configured using the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>wsHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md)</ept>.","pos":[1047,1190],"source":" The service and client are configured using the [\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md)."},{"content":"The <ph id=\"ph1\">`mode`</ph> attribute of the <bpt id=\"p1\">[</bpt><ph id=\"ph2\">\\&lt;</ph>security&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/security-of-custombinding.md)</ept> has been set to <ph id=\"ph3\">`Message`</ph> and <ph id=\"ph4\">`clientCredentialType`</ph> has been set to <ph id=\"ph5\">`Windows`</ph>.","pos":[1191,1400],"source":" The `mode` attribute of the [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-of-custombinding.md) has been set to `Message` and `clientCredentialType` has been set to `Windows`."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Security.Permissions.PrincipalPermissionAttribute&gt;</ph> is applied to each service method and used to restrict access to each operation.","pos":[1401,1549],"source":" The <xref:System.Security.Permissions.PrincipalPermissionAttribute> is applied to each service method and used to restrict access to each operation."},{"content":"The caller must be a Windows administrator to access each operation.","pos":[1550,1618]},{"content":"In this sample, the client is a console application (.exe) and the service is hosted by Internet Information Services (IIS).","pos":[1625,1749]},{"pos":[1757,1864],"content":"[!NOTE]\n The setup procedure and build instructions for this sample are located at the end of this topic.","leadings":["","> "],"nodes":[{"content":"The setup procedure and build instructions for this sample are located at the end of this topic.","pos":[9,105]}]},{"pos":[1871,2075],"content":"The service configuration file uses the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>serviceAuthorization&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/serviceauthorization-element.md)</ept> to set the <ph id=\"ph2\">`principalPermissionMode`</ph> attribute:","source":"The service configuration file uses the [\\<serviceAuthorization>](../../../../docs/framework/configure-apps/file-schema/wcf/serviceauthorization-element.md) to set the `principalPermissionMode` attribute:"},{"pos":[2519,2691],"content":"Setting the <ph id=\"ph1\">`principalPermissionMode`</ph> to <ph id=\"ph2\">`UseWindowsGroups`</ph> enables the use of <ph id=\"ph3\">&lt;xref:System.Security.Permissions.PrincipalPermissionAttribute&gt;</ph> based on Windows group names.","source":"Setting the `principalPermissionMode` to `UseWindowsGroups` enables the use of <xref:System.Security.Permissions.PrincipalPermissionAttribute> based on Windows group names."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Security.Permissions.PrincipalPermissionAttribute&gt;</ph> is applied to each operation to require the caller to be part of the Windows administrators group, as shown in the following sample code.","pos":[2698,2903],"source":"The <xref:System.Security.Permissions.PrincipalPermissionAttribute> is applied to each operation to require the caller to be part of the Windows administrators group, as shown in the following sample code."},{"content":"When you run the sample, the operation requests and responses are displayed in the client console window.","pos":[3140,3245]},{"content":"The client successfully communicates with each operation if it is running under an account that is part of the Administrators group; otherwise, access is denied.","pos":[3246,3407]},{"content":"To experiment with authorization failure, run the client under an account that is not part of the Administrators group.","pos":[3408,3527]},{"content":"Press ENTER in the console window to shut down the client.","pos":[3528,3586]},{"content":"A service can be notified of authorization failures by implementing an <ph id=\"ph1\">&lt;xref:System.ServiceModel.Dispatcher.IErrorHandler&gt;</ph>.","pos":[3593,3716],"source":"A service can be notified of authorization failures by implementing an <xref:System.ServiceModel.Dispatcher.IErrorHandler>."},{"content":"See <bpt id=\"p1\">[</bpt>Extending Control Over Error Handling and Reporting<ept id=\"p1\">](../../../../docs/framework/wcf/samples/extending-control-over-error-handling-and-reporting.md)</ept> for information about implementing <ph id=\"ph1\">`IErrorHandler`</ph>.","pos":[3717,3921],"source":" See [Extending Control Over Error Handling and Reporting](../../../../docs/framework/wcf/samples/extending-control-over-error-handling-and-reporting.md) for information about implementing `IErrorHandler`."},{"pos":[3931,3967],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[3977,4176],"content":"Ensure that you have performed the <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"pos":[4186,4395],"content":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"pos":[4405,4614],"content":"To run the sample in a single- or cross-computer configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"pos":[4623,4631],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]}]}