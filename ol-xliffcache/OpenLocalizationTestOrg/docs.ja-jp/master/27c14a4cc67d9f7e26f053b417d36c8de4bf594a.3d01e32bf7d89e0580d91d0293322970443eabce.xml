{"content":"---\ntitle: \"Cancel an Async Task or a List of Tasks (C#)\"\nms.date: 07/20/2015\nms.assetid: eec32dbb-70ea-4c88-bd27-fa2e34546914\n---\n# Cancel an async task or a list of tasks (C#)\n\nYou can set up a button that you can use to cancel an async application if you don't want to wait for it to finish. By following the examples in this topic, you can add a cancellation button to an application that downloads the contents of one website or a list of websites.\n\nThe examples use the UI that [Fine-Tuning Your Async Application (C#)](../../../../csharp/programming-guide/concepts/async/fine-tuning-your-async-application.md) describes.\n\n> [!NOTE]\n> To run the examples, you must have Visual Studio 2012 or newer and the .NET Framework 4.5 or newer installed on your computer.\n\n## Cancel a task\n\nThe first example associates the **Cancel** button with a single download task. If you choose the button while the application is downloading content, the download is canceled.\n\n### Download the example\n\nYou can download the complete Windows Presentation Foundation (WPF) project from [Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea) and then follow these steps.\n\n1.  Decompress the file that you downloaded, and then start Visual Studio.\n\n2.  On the menu bar, choose **File** > **Open** > **Project/Solution**.\n\n3.  In the **Open Project** dialog box, open the folder that holds the sample code that you decompressed, and then open the solution (.sln) file for AsyncFineTuningCS.\n\n4.  In **Solution Explorer**, open the shortcut menu for the **CancelATask** project, and then choose **Set as StartUp Project**.\n\n5.  Choose the **F5** key to run the project (or, press **Ctrl**+**F5** to run the project without debugging it).\n\n> [!TIP]\n> If you don't want to download the project, you can review the MainWindow.xaml.cs files at the end of this topic.\n\n### Build the example\n The following changes add a **Cancel** button to an application that downloads a website. If you don't want to download or build the example, you can review the final product in the \"Complete Examples\" section at the end of this topic. Asterisks mark the changes in the code.\n\n To build the example yourself, step by step, follow the instructions in the \"Downloading the Example\" section, but choose **StarterCode** as the **StartUp Project** instead of **CancelATask**.\n\n Then add the following changes to the MainWindow.xaml.cs file of that project.\n\n1.  Declare a `CancellationTokenSource` variable, `cts`, that’s in scope for all methods that access it.\n\n    ```csharp\n    public partial class MainWindow : Window\n    {\n        // ***Declare a System.Threading.CancellationTokenSource.\n        CancellationTokenSource cts;\n    ```\n\n2.  Add the following event handler for the **Cancel** button. The event handler uses the <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> method to notify `cts` when the user requests cancellation.\n\n    ```csharp\n    // ***Add an event handler for the Cancel button.\n    private void cancelButton_Click(object sender, RoutedEventArgs e)\n    {\n        if (cts != null)\n        {\n            cts.Cancel();\n        }\n    }\n    ```\n\n3.  Make the following changes in the event handler for the **Start** button, `startButton_Click`.\n\n    -   Instantiate the `CancellationTokenSource`, `cts`.\n\n        ```csharp\n        // ***Instantiate the CancellationTokenSource.\n        cts = new CancellationTokenSource();\n        ```\n\n    -   In the call to `AccessTheWebAsync`, which downloads the contents of a specified website, send the <xref:System.Threading.CancellationTokenSource.Token%2A?displayProperty=nameWithType> property of `cts` as an argument. The `Token` property propagates the message if cancellation is requested. Add a catch block that displays a message if the user chooses to cancel the download operation. The following code shows the changes.\n\n        ```csharp\n        try\n        {\n            // ***Send a token to carry the message if cancellation is requested.\n            int contentLength = await AccessTheWebAsync(cts.Token);\n            resultsTextBox.Text += $\"\\r\\nLength of the downloaded string: {contentLength}.\\r\\n\";\n        }\n        // *** If cancellation is requested, an OperationCanceledException results.\n        catch (OperationCanceledException)\n        {\n            resultsTextBox.Text += \"\\r\\nDownload canceled.\\r\\n\";\n        }\n        catch (Exception)\n        {\n            resultsTextBox.Text += \"\\r\\nDownload failed.\\r\\n\";\n        }\n        ```\n\n4.  In `AccessTheWebAsync`, use the  <xref:System.Net.Http.HttpClient.GetAsync%28System.String%2CSystem.Threading.CancellationToken%29?displayProperty=nameWithType> overload of the `GetAsync` method in the <xref:System.Net.Http.HttpClient> type to download the contents of a website. Pass `ct`, the <xref:System.Threading.CancellationToken> parameter of `AccessTheWebAsync`, as the second argument. The token carries the message if the user chooses the **Cancel** button.\n\n     The following code shows the changes in `AccessTheWebAsync`.\n\n    ```csharp\n    // ***Provide a parameter for the CancellationToken.\n    async Task<int> AccessTheWebAsync(CancellationToken ct)\n    {\n        HttpClient client = new HttpClient();\n\n        resultsTextBox.Text += \"\\r\\nReady to download.\\r\\n\";\n\n        // You might need to slow things down to have a chance to cancel.\n        await Task.Delay(250);\n\n        // GetAsync returns a Task<HttpResponseMessage>.\n        // ***The ct argument carries the message if the Cancel button is chosen.\n        HttpResponseMessage response = await client.GetAsync(\"https://msdn.microsoft.com/library/dd470362.aspx\", ct);\n\n        // Retrieve the website contents from the HttpResponseMessage.\n        byte[] urlContents = await response.Content.ReadAsByteArrayAsync();\n\n        // The result of the method is the length of the downloaded website.\n        return urlContents.Length;\n    }\n    ```\n\n5.  If you don’t cancel the program, it produces the following output.\n\n    ```text\n    Ready to download.\n    Length of the downloaded string: 158125.\n    ```\n\n     If you choose the **Cancel** button before the program finishes downloading the content, the program produces the following output.\n\n    ```text\n    Ready to download.\n    Download canceled.\n    ```\n\n## Cancel a list of tasks\n\nYou can extend the previous example to cancel many tasks by associating the same `CancellationTokenSource` instance with each task. If you choose the **Cancel** button, you cancel all tasks that aren’t yet complete.\n\n### Download the example\n\nYou can download the complete Windows Presentation Foundation (WPF) project from [Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea) and then follow these steps.\n\n1.  Decompress the file that you downloaded, and then start Visual Studio.\n\n2.  On the menu bar, choose **File** > **Open** > **Project/Solution**.\n\n3.  In the **Open Project** dialog box, open the folder that holds the sample code that you decompressed, and then open the solution (.sln) file for AsyncFineTuningCS.\n\n4.  In **Solution Explorer**, open the shortcut menu for the **CancelAListOfTasks** project, and then choose **Set as StartUp Project**.\n\n5.  Choose the **F5** key to run the project.\n\n     Choose the **Ctrl**+**F5** keys to run the project without debugging it.\n\nIf you don't want to download the project, you can review the MainWindow.xaml.cs files at the end of this topic.\n\n### Build the example\n\nTo extend the example yourself, step by step, follow the instructions in the \"Downloading the Example\" section, but choose **CancelATask** as the **StartUp Project**. Add the following changes to that project. Asterisks mark the changes in the program.\n\n1.  Add a method to create a list of web addresses.\n\n    ```csharp\n    // ***Add a method that creates a list of web addresses.\n    private List<string> SetUpURLList()\n    {\n        List<string> urls = new List<string>\n        {\n            \"https://msdn.microsoft.com\",\n            \"https://msdn.microsoft.com/library/hh290138.aspx\",\n            \"https://msdn.microsoft.com/library/hh290140.aspx\",\n            \"https://msdn.microsoft.com/library/dd470362.aspx\",\n            \"https://msdn.microsoft.com/library/aa578028.aspx\",\n            \"https://msdn.microsoft.com/library/ms404677.aspx\",\n            \"https://msdn.microsoft.com/library/ff730837.aspx\"\n        };\n        return urls;\n    }\n    ```\n\n2.  Call the method in `AccessTheWebAsync`.\n\n    ```csharp\n    // ***Call SetUpURLList to make a list of web addresses.\n    List<string> urlList = SetUpURLList();\n    ```\n\n3.  Add the following loop in `AccessTheWebAsync` to process each web address in the list.\n\n    ```csharp\n    // ***Add a loop to process the list of web addresses.\n    foreach (var url in urlList)\n    {\n        // GetAsync returns a Task<HttpResponseMessage>.\n        // Argument ct carries the message if the Cancel button is chosen.\n        // ***Note that the Cancel button can cancel all remaining downloads.\n        HttpResponseMessage response = await client.GetAsync(url, ct);\n\n        // Retrieve the website contents from the HttpResponseMessage.\n        byte[] urlContents = await response.Content.ReadAsByteArrayAsync();\n\n        resultsTextBox.Text +=\n            $\"\\r\\nLength of the downloaded string: {urlContents.Length}.\\r\\n\";\n    }\n    ```\n\n4.  Because `AccessTheWebAsync` displays the lengths, the method doesn't need to return anything. Remove the return statement, and change the return type of the method to <xref:System.Threading.Tasks.Task> instead of <xref:System.Threading.Tasks.Task%601>.\n\n    ```csharp\n    async Task AccessTheWebAsync(CancellationToken ct)\n    ```\n\n     Call the method from `startButton_Click` by using a statement instead of an expression.\n\n    ```csharp\n    await AccessTheWebAsync(cts.Token);\n    ```\n\n5.  If you don’t cancel the program, it produces the following output.\n\n    ```text\n    Length of the downloaded string: 35939.\n\n    Length of the downloaded string: 237682.\n\n    Length of the downloaded string: 128607.\n\n    Length of the downloaded string: 158124.\n\n    Length of the downloaded string: 204890.\n\n    Length of the downloaded string: 175488.\n\n    Length of the downloaded string: 145790.\n\n    Downloads complete.\n    ```\n\n     If you choose the **Cancel** button before the downloads are complete, the output contains the lengths of the downloads that completed before the cancellation.\n\n    ```text\n    Length of the downloaded string: 35939.\n\n    Length of the downloaded string: 237682.\n\n    Length of the downloaded string: 128607.\n\n    Downloads canceled.\n    ```\n\n## Complete examples\n\nThe following sections contain the code for each of the previous examples. Notice that you must add a reference for <xref:System.Net.Http>.\n\nYou can download the projects from [Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea).\n\n### Example - Cancel a task\n\nThe following code is the complete MainWindow.xaml.cs file for the example that cancels a single task.\n\n```csharp\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\nusing System.Windows;\nusing System.Windows.Controls;\nusing System.Windows.Data;\nusing System.Windows.Documents;\nusing System.Windows.Input;\nusing System.Windows.Media;\nusing System.Windows.Media.Imaging;\nusing System.Windows.Navigation;\nusing System.Windows.Shapes;\n\n// Add a using directive and a reference for System.Net.Http.\nusing System.Net.Http;\n\n// Add the following using directive for System.Threading.\n\nusing System.Threading;\nnamespace CancelATask\n{\n    public partial class MainWindow : Window\n    {\n        // ***Declare a System.Threading.CancellationTokenSource.\n        CancellationTokenSource cts;\n\n        public MainWindow()\n        {\n            InitializeComponent();\n        }\n\n        private async void startButton_Click(object sender, RoutedEventArgs e)\n        {\n            // ***Instantiate the CancellationTokenSource.\n            cts = new CancellationTokenSource();\n\n            resultsTextBox.Clear();\n\n            try\n            {\n                // ***Send a token to carry the message if cancellation is requested.\n                int contentLength = await AccessTheWebAsync(cts.Token);\n                resultsTextBox.Text +=\n                    $\"\\r\\nLength of the downloaded string: {contentLength}.\\r\\n\";\n            }\n            // *** If cancellation is requested, an OperationCanceledException results.\n            catch (OperationCanceledException)\n            {\n                resultsTextBox.Text += \"\\r\\nDownload canceled.\\r\\n\";\n            }\n            catch (Exception)\n            {\n                resultsTextBox.Text += \"\\r\\nDownload failed.\\r\\n\";\n            }\n\n            // ***Set the CancellationTokenSource to null when the download is complete.\n            cts = null;\n        }\n\n        // ***Add an event handler for the Cancel button.\n        private void cancelButton_Click(object sender, RoutedEventArgs e)\n        {\n            if (cts != null)\n            {\n                cts.Cancel();\n            }\n        }\n\n        // ***Provide a parameter for the CancellationToken.\n        async Task<int> AccessTheWebAsync(CancellationToken ct)\n        {\n            HttpClient client = new HttpClient();\n\n            resultsTextBox.Text += \"\\r\\nReady to download.\\r\\n\";\n\n            // You might need to slow things down to have a chance to cancel.\n            await Task.Delay(250);\n\n            // GetAsync returns a Task<HttpResponseMessage>.\n            // ***The ct argument carries the message if the Cancel button is chosen.\n            HttpResponseMessage response = await client.GetAsync(\"https://msdn.microsoft.com/library/dd470362.aspx\", ct);\n\n            // Retrieve the website contents from the HttpResponseMessage.\n            byte[] urlContents = await response.Content.ReadAsByteArrayAsync();\n\n            // The result of the method is the length of the downloaded website.\n            return urlContents.Length;\n        }\n    }\n\n    // Output for a successful download:\n\n    // Ready to download.\n\n    // Length of the downloaded string: 158125.\n\n    // Or, if you cancel:\n\n    // Ready to download.\n\n    // Download canceled.\n}\n```\n\n### Example - Cancel a list of tasks\n\nThe following code is the complete MainWindow.xaml.cs file for the example that cancels a list of tasks.\n\n```csharp\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\nusing System.Windows;\nusing System.Windows.Controls;\nusing System.Windows.Data;\nusing System.Windows.Documents;\nusing System.Windows.Input;\nusing System.Windows.Media;\nusing System.Windows.Media.Imaging;\nusing System.Windows.Navigation;\nusing System.Windows.Shapes;\n\n// Add a using directive and a reference for System.Net.Http.\nusing System.Net.Http;\n\n// Add the following using directive for System.Threading.\nusing System.Threading;\n\nnamespace CancelAListOfTasks\n{\n    public partial class MainWindow : Window\n    {\n        // Declare a System.Threading.CancellationTokenSource.\n        CancellationTokenSource cts;\n\n        public MainWindow()\n        {\n            InitializeComponent();\n        }\n\n        private async void startButton_Click(object sender, RoutedEventArgs e)\n        {\n            // Instantiate the CancellationTokenSource.\n            cts = new CancellationTokenSource();\n\n            resultsTextBox.Clear();\n\n            try\n            {\n                await AccessTheWebAsync(cts.Token);\n                // ***Small change in the display lines.\n                resultsTextBox.Text += \"\\r\\nDownloads complete.\";\n            }\n            catch (OperationCanceledException)\n            {\n                resultsTextBox.Text += \"\\r\\nDownloads canceled.\";\n            }\n            catch (Exception)\n            {\n                resultsTextBox.Text += \"\\r\\nDownloads failed.\";\n            }\n\n            // Set the CancellationTokenSource to null when the download is complete.\n            cts = null;\n        }\n\n        // Add an event handler for the Cancel button.\n        private void cancelButton_Click(object sender, RoutedEventArgs e)\n        {\n            if (cts != null)\n            {\n                cts.Cancel();\n            }\n        }\n\n        // Provide a parameter for the CancellationToken.\n        // ***Change the return type to Task because the method has no return statement.\n        async Task AccessTheWebAsync(CancellationToken ct)\n        {\n            // Declare an HttpClient object.\n            HttpClient client = new HttpClient();\n\n            // ***Call SetUpURLList to make a list of web addresses.\n            List<string> urlList = SetUpURLList();\n\n            // ***Add a loop to process the list of web addresses.\n            foreach (var url in urlList)\n            {\n                // GetAsync returns a Task<HttpResponseMessage>.\n                // Argument ct carries the message if the Cancel button is chosen.\n                // ***Note that the Cancel button can cancel all remaining downloads.\n                HttpResponseMessage response = await client.GetAsync(url, ct);\n\n                // Retrieve the website contents from the HttpResponseMessage.\n                byte[] urlContents = await response.Content.ReadAsByteArrayAsync();\n\n                resultsTextBox.Text +=\n                    $\"\\r\\nLength of the downloaded string: {urlContents.Length}.\\r\\n\";\n            }\n        }\n\n        // ***Add a method that creates a list of web addresses.\n        private List<string> SetUpURLList()\n        {\n            List<string> urls = new List<string>\n            {\n                \"https://msdn.microsoft.com\",\n                \"https://msdn.microsoft.com/library/hh290138.aspx\",\n                \"https://msdn.microsoft.com/library/hh290140.aspx\",\n                \"https://msdn.microsoft.com/library/dd470362.aspx\",\n                \"https://msdn.microsoft.com/library/aa578028.aspx\",\n                \"https://msdn.microsoft.com/library/ms404677.aspx\",\n                \"https://msdn.microsoft.com/library/ff730837.aspx\"\n            };\n            return urls;\n        }\n    }\n\n    // Output if you do not choose to cancel:\n\n    //Length of the downloaded string: 35939.\n\n    //Length of the downloaded string: 237682.\n\n    //Length of the downloaded string: 128607.\n\n    //Length of the downloaded string: 158124.\n\n    //Length of the downloaded string: 204890.\n\n    //Length of the downloaded string: 175488.\n\n    //Length of the downloaded string: 145790.\n\n    //Downloads complete.\n\n    // Sample output if you choose to cancel:\n\n    //Length of the downloaded string: 35939.\n\n    //Length of the downloaded string: 237682.\n\n    //Length of the downloaded string: 128607.\n\n    //Downloads canceled.\n}\n```\n\n## See also\n\n- <xref:System.Threading.CancellationTokenSource>\n- <xref:System.Threading.CancellationToken>\n- [Asynchronous Programming with async and await (C#)](../../../../csharp/programming-guide/concepts/async/index.md)\n- [Fine-Tuning Your Async Application (C#)](../../../../csharp/programming-guide/concepts/async/fine-tuning-your-async-application.md)\n- [Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea)\n","nodes":[{"pos":[4,126],"embed":true,"restype":"x-metadata","content":"title: \"Cancel an Async Task or a List of Tasks (C#)\"\nms.date: 07/20/2015\nms.assetid: eec32dbb-70ea-4c88-bd27-fa2e34546914","nodes":[{"content":"Cancel an Async Task or a List of Tasks (C#)","nodes":[{"pos":[0,44],"content":"Cancel an Async Task or a List of Tasks (C#)","nodes":[{"content":"Cancel an Async Task or a List of Tasks (C#)","pos":[0,44]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[133,177],"content":"Cancel an async task or a list of tasks (C#)","linkify":"Cancel an async task or a list of tasks (C#)","nodes":[{"content":"Cancel an async task or a list of tasks (C#)","pos":[0,44]}]},{"content":"You can set up a button that you can use to cancel an async application if you don't want to wait for it to finish.","pos":[179,294]},{"content":"By following the examples in this topic, you can add a cancellation button to an application that downloads the contents of one website or a list of websites.","pos":[295,453]},{"pos":[455,627],"content":"The examples use the UI that <bpt id=\"p1\">[</bpt>Fine-Tuning Your Async Application (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/async/fine-tuning-your-async-application.md)</ept> describes.","source":"The examples use the UI that [Fine-Tuning Your Async Application (C#)](../../../../csharp/programming-guide/concepts/async/fine-tuning-your-async-application.md) describes."},{"pos":[631,767],"content":"[!NOTE]\nTo run the examples, you must have Visual Studio 2012 or newer and the .NET Framework 4.5 or newer installed on your computer.","leadings":["","> "],"nodes":[{"content":"To run the examples, you must have Visual Studio 2012 or newer and the .NET Framework 4.5 or newer installed on your computer.","pos":[8,134]}]},{"pos":[772,785],"content":"Cancel a task","linkify":"Cancel a task","nodes":[{"content":"Cancel a task","pos":[0,13]}]},{"content":"The first example associates the <bpt id=\"p1\">**</bpt>Cancel<ept id=\"p1\">**</ept> button with a single download task.","pos":[787,866],"source":"The first example associates the **Cancel** button with a single download task."},{"content":"If you choose the button while the application is downloading content, the download is canceled.","pos":[867,963]},{"pos":[969,989],"content":"Download the example","linkify":"Download the example","nodes":[{"content":"Download the example","pos":[0,20]}]},{"pos":[991,1210],"content":"You can download the complete Windows Presentation Foundation (WPF) project from <bpt id=\"p1\">[</bpt>Async Sample: Fine Tuning Your Application<ept id=\"p1\">](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea)</ept> and then follow these steps.","source":"You can download the complete Windows Presentation Foundation (WPF) project from [Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea) and then follow these steps."},{"content":"Decompress the file that you downloaded, and then start Visual Studio.","pos":[1216,1286]},{"pos":[1292,1359],"content":"On the menu bar, choose <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept><ph id=\"ph1\"> &gt; </ph><bpt id=\"p2\">**</bpt>Open<ept id=\"p2\">**</ept><ph id=\"ph2\"> &gt; </ph><bpt id=\"p3\">**</bpt>Project/Solution<ept id=\"p3\">**</ept>.","source":"On the menu bar, choose **File** > **Open** > **Project/Solution**."},{"pos":[1365,1528],"content":"In the <bpt id=\"p1\">**</bpt>Open Project<ept id=\"p1\">**</ept> dialog box, open the folder that holds the sample code that you decompressed, and then open the solution (.sln) file for AsyncFineTuningCS.","source":"In the **Open Project** dialog box, open the folder that holds the sample code that you decompressed, and then open the solution (.sln) file for AsyncFineTuningCS."},{"pos":[1534,1659],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, open the shortcut menu for the <bpt id=\"p2\">**</bpt>CancelATask<ept id=\"p2\">**</ept> project, and then choose <bpt id=\"p3\">**</bpt>Set as StartUp Project<ept id=\"p3\">**</ept>.","source":"In **Solution Explorer**, open the shortcut menu for the **CancelATask** project, and then choose **Set as StartUp Project**."},{"pos":[1665,1774],"content":"Choose the <bpt id=\"p1\">**</bpt>F5<ept id=\"p1\">**</ept> key to run the project (or, press <bpt id=\"p2\">**</bpt>Ctrl<ept id=\"p2\">**</ept><ph id=\"ph1\">+</ph><bpt id=\"p3\">**</bpt>F5<ept id=\"p3\">**</ept> to run the project without debugging it).","source":"Choose the **F5** key to run the project (or, press **Ctrl**+**F5** to run the project without debugging it)."},{"pos":[1778,1899],"content":"[!TIP]\nIf you don't want to download the project, you can review the MainWindow.xaml.cs files at the end of this topic.","leadings":["","> "],"nodes":[{"content":"If you don't want to download the project, you can review the MainWindow.xaml.cs files at the end of this topic.","pos":[7,119]}]},{"pos":[1905,1922],"content":"Build the example","linkify":"Build the example","nodes":[{"content":"Build the example","pos":[0,17]}]},{"content":"The following changes add a <bpt id=\"p1\">**</bpt>Cancel<ept id=\"p1\">**</ept> button to an application that downloads a website.","pos":[1924,2013],"source":"The following changes add a **Cancel** button to an application that downloads a website."},{"content":"If you don't want to download or build the example, you can review the final product in the \"Complete Examples\" section at the end of this topic.","pos":[2014,2159]},{"content":"Asterisks mark the changes in the code.","pos":[2160,2199]},{"pos":[2202,2394],"content":"To build the example yourself, step by step, follow the instructions in the \"Downloading the Example\" section, but choose <bpt id=\"p1\">**</bpt>StarterCode<ept id=\"p1\">**</ept> as the <bpt id=\"p2\">**</bpt>StartUp Project<ept id=\"p2\">**</ept> instead of <bpt id=\"p3\">**</bpt>CancelATask<ept id=\"p3\">**</ept>.","source":"To build the example yourself, step by step, follow the instructions in the \"Downloading the Example\" section, but choose **StarterCode** as the **StartUp Project** instead of **CancelATask**."},{"content":"Then add the following changes to the MainWindow.xaml.cs file of that project.","pos":[2397,2475]},{"pos":[2481,2581],"content":"Declare a <ph id=\"ph1\">`CancellationTokenSource`</ph> variable, <ph id=\"ph2\">`cts`</ph>, that’s in scope for all methods that access it.","source":"Declare a `CancellationTokenSource` variable, `cts`, that’s in scope for all methods that access it."},{"content":"Add the following event handler for the <bpt id=\"p1\">**</bpt>Cancel<ept id=\"p1\">**</ept> button.","pos":[2764,2822],"source":"Add the following event handler for the **Cancel** button."},{"content":"The event handler uses the <ph id=\"ph1\">&lt;xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType&gt;</ph> method to notify <ph id=\"ph2\">`cts`</ph> when the user requests cancellation.","pos":[2823,2996],"source":" The event handler uses the <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> method to notify `cts` when the user requests cancellation."},{"pos":[3232,3326],"content":"Make the following changes in the event handler for the <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept> button, <ph id=\"ph1\">`startButton_Click`</ph>.","source":"Make the following changes in the event handler for the **Start** button, `startButton_Click`."},{"pos":[3336,3385],"content":"Instantiate the <ph id=\"ph1\">`CancellationTokenSource`</ph>, <ph id=\"ph2\">`cts`</ph>.","source":"Instantiate the `CancellationTokenSource`, `cts`."},{"content":"In the call to <ph id=\"ph1\">`AccessTheWebAsync`</ph>, which downloads the contents of a specified website, send the <ph id=\"ph2\">&lt;xref:System.Threading.CancellationTokenSource.Token%2A?displayProperty=nameWithType&gt;</ph> property of <ph id=\"ph3\">`cts`</ph> as an argument.","pos":[3526,3743],"source":"In the call to `AccessTheWebAsync`, which downloads the contents of a specified website, send the <xref:System.Threading.CancellationTokenSource.Token%2A?displayProperty=nameWithType> property of `cts` as an argument."},{"content":"The <ph id=\"ph1\">`Token`</ph> property propagates the message if cancellation is requested.","pos":[3744,3817],"source":" The `Token` property propagates the message if cancellation is requested."},{"content":"Add a catch block that displays a message if the user chooses to cancel the download operation.","pos":[3818,3913]},{"content":"The following code shows the changes.","pos":[3914,3951]},{"content":"In <ph id=\"ph1\">`AccessTheWebAsync`</ph>, use the  <ph id=\"ph2\">&lt;xref:System.Net.Http.HttpClient.GetAsync%28System.String%2CSystem.Threading.CancellationToken%29?displayProperty=nameWithType&gt;</ph> overload of the <ph id=\"ph3\">`GetAsync`</ph> method in the <ph id=\"ph4\">&lt;xref:System.Net.Http.HttpClient&gt;</ph> type to download the contents of a website.","pos":[4588,4867],"source":"In `AccessTheWebAsync`, use the  <xref:System.Net.Http.HttpClient.GetAsync%28System.String%2CSystem.Threading.CancellationToken%29?displayProperty=nameWithType> overload of the `GetAsync` method in the <xref:System.Net.Http.HttpClient> type to download the contents of a website."},{"content":"Pass <ph id=\"ph1\">`ct`</ph>, the <ph id=\"ph2\">&lt;xref:System.Threading.CancellationToken&gt;</ph> parameter of <ph id=\"ph3\">`AccessTheWebAsync`</ph>, as the second argument.","pos":[4868,4982],"source":" Pass `ct`, the <xref:System.Threading.CancellationToken> parameter of `AccessTheWebAsync`, as the second argument."},{"content":"The token carries the message if the user chooses the <bpt id=\"p1\">**</bpt>Cancel<ept id=\"p1\">**</ept> button.","pos":[4983,5055],"source":" The token carries the message if the user chooses the **Cancel** button."},{"pos":[5062,5122],"content":"The following code shows the changes in <ph id=\"ph1\">`AccessTheWebAsync`</ph>.","source":"The following code shows the changes in `AccessTheWebAsync`."},{"content":"If you don’t cancel the program, it produces the following output.","pos":[6013,6079]},{"pos":[6175,6306],"content":"If you choose the <bpt id=\"p1\">**</bpt>Cancel<ept id=\"p1\">**</ept> button before the program finishes downloading the content, the program produces the following output.","source":"If you choose the **Cancel** button before the program finishes downloading the content, the program produces the following output."},{"pos":[6378,6400],"content":"Cancel a list of tasks","linkify":"Cancel a list of tasks","nodes":[{"content":"Cancel a list of tasks","pos":[0,22]}]},{"content":"You can extend the previous example to cancel many tasks by associating the same <ph id=\"ph1\">`CancellationTokenSource`</ph> instance with each task.","pos":[6402,6533],"source":"You can extend the previous example to cancel many tasks by associating the same `CancellationTokenSource` instance with each task."},{"content":"If you choose the <bpt id=\"p1\">**</bpt>Cancel<ept id=\"p1\">**</ept> button, you cancel all tasks that aren’t yet complete.","pos":[6534,6617],"source":" If you choose the **Cancel** button, you cancel all tasks that aren’t yet complete."},{"pos":[6623,6643],"content":"Download the example","linkify":"Download the example","nodes":[{"content":"Download the example","pos":[0,20]}]},{"pos":[6645,6864],"content":"You can download the complete Windows Presentation Foundation (WPF) project from <bpt id=\"p1\">[</bpt>Async Sample: Fine Tuning Your Application<ept id=\"p1\">](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea)</ept> and then follow these steps.","source":"You can download the complete Windows Presentation Foundation (WPF) project from [Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea) and then follow these steps."},{"content":"Decompress the file that you downloaded, and then start Visual Studio.","pos":[6870,6940]},{"pos":[6946,7013],"content":"On the menu bar, choose <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept><ph id=\"ph1\"> &gt; </ph><bpt id=\"p2\">**</bpt>Open<ept id=\"p2\">**</ept><ph id=\"ph2\"> &gt; </ph><bpt id=\"p3\">**</bpt>Project/Solution<ept id=\"p3\">**</ept>.","source":"On the menu bar, choose **File** > **Open** > **Project/Solution**."},{"pos":[7019,7182],"content":"In the <bpt id=\"p1\">**</bpt>Open Project<ept id=\"p1\">**</ept> dialog box, open the folder that holds the sample code that you decompressed, and then open the solution (.sln) file for AsyncFineTuningCS.","source":"In the **Open Project** dialog box, open the folder that holds the sample code that you decompressed, and then open the solution (.sln) file for AsyncFineTuningCS."},{"pos":[7188,7320],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, open the shortcut menu for the <bpt id=\"p2\">**</bpt>CancelAListOfTasks<ept id=\"p2\">**</ept> project, and then choose <bpt id=\"p3\">**</bpt>Set as StartUp Project<ept id=\"p3\">**</ept>.","source":"In **Solution Explorer**, open the shortcut menu for the **CancelAListOfTasks** project, and then choose **Set as StartUp Project**."},{"pos":[7326,7367],"content":"Choose the <bpt id=\"p1\">**</bpt>F5<ept id=\"p1\">**</ept> key to run the project.","source":"Choose the **F5** key to run the project."},{"pos":[7374,7446],"content":"Choose the <bpt id=\"p1\">**</bpt>Ctrl<ept id=\"p1\">**</ept><ph id=\"ph1\">+</ph><bpt id=\"p2\">**</bpt>F5<ept id=\"p2\">**</ept> keys to run the project without debugging it.","source":"Choose the **Ctrl**+**F5** keys to run the project without debugging it."},{"content":"If you don't want to download the project, you can review the MainWindow.xaml.cs files at the end of this topic.","pos":[7448,7560]},{"pos":[7566,7583],"content":"Build the example","linkify":"Build the example","nodes":[{"content":"Build the example","pos":[0,17]}]},{"content":"To extend the example yourself, step by step, follow the instructions in the \"Downloading the Example\" section, but choose <bpt id=\"p1\">**</bpt>CancelATask<ept id=\"p1\">**</ept> as the <bpt id=\"p2\">**</bpt>StartUp Project<ept id=\"p2\">**</ept>.","pos":[7585,7751],"source":"To extend the example yourself, step by step, follow the instructions in the \"Downloading the Example\" section, but choose **CancelATask** as the **StartUp Project**."},{"content":"Add the following changes to that project.","pos":[7752,7794]},{"content":"Asterisks mark the changes in the program.","pos":[7795,7837]},{"content":"Add a method to create a list of web addresses.","pos":[7843,7890]},{"pos":[8544,8583],"content":"Call the method in <ph id=\"ph1\">`AccessTheWebAsync`</ph>.","source":"Call the method in `AccessTheWebAsync`."},{"pos":[8716,8802],"content":"Add the following loop in <ph id=\"ph1\">`AccessTheWebAsync`</ph> to process each web address in the list.","source":"Add the following loop in `AccessTheWebAsync` to process each web address in the list."},{"content":"Because <ph id=\"ph1\">`AccessTheWebAsync`</ph> displays the lengths, the method doesn't need to return anything.","pos":[9475,9568],"source":"Because `AccessTheWebAsync` displays the lengths, the method doesn't need to return anything."},{"content":"Remove the return statement, and change the return type of the method to <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Task&gt;</ph> instead of <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Task%601&gt;</ph>.","pos":[9569,9727],"source":" Remove the return statement, and change the return type of the method to <xref:System.Threading.Tasks.Task> instead of <xref:System.Threading.Tasks.Task%601>."},{"pos":[9812,9899],"content":"Call the method from <ph id=\"ph1\">`startButton_Click`</ph> by using a statement instead of an expression.","source":"Call the method from `startButton_Click` by using a statement instead of an expression."},{"content":"If you don’t cancel the program, it produces the following output.","pos":[9968,10034]},{"pos":[10407,10566],"content":"If you choose the <bpt id=\"p1\">**</bpt>Cancel<ept id=\"p1\">**</ept> button before the downloads are complete, the output contains the lengths of the downloads that completed before the cancellation.","source":"If you choose the **Cancel** button before the downloads are complete, the output contains the lengths of the downloads that completed before the cancellation."},{"pos":[10753,10770],"content":"Complete examples","linkify":"Complete examples","nodes":[{"content":"Complete examples","pos":[0,17]}]},{"content":"The following sections contain the code for each of the previous examples.","pos":[10772,10846]},{"content":"Notice that you must add a reference for <ph id=\"ph1\">&lt;xref:System.Net.Http&gt;</ph>.","pos":[10847,10911],"source":" Notice that you must add a reference for <xref:System.Net.Http>."},{"pos":[10913,11058],"content":"You can download the projects from <bpt id=\"p1\">[</bpt>Async Sample: Fine Tuning Your Application<ept id=\"p1\">](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea)</ept>.","source":"You can download the projects from [Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea)."},{"pos":[11064,11087],"content":"Example - Cancel a task","linkify":"Example - Cancel a task","nodes":[{"content":"Example - Cancel a task","pos":[0,23]}]},{"content":"The following code is the complete MainWindow.xaml.cs file for the example that cancels a single task.","pos":[11089,11191]},{"pos":[14437,14469],"content":"Example - Cancel a list of tasks","linkify":"Example - Cancel a list of tasks","nodes":[{"content":"Example - Cancel a list of tasks","pos":[0,32]}]},{"content":"The following code is the complete MainWindow.xaml.cs file for the example that cancels a list of tasks.","pos":[14471,14575]},{"pos":[18991,18999],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[19097,19211],"content":"<bpt id=\"p1\">[</bpt>Asynchronous Programming with async and await (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/async/index.md)</ept>","source":"[Asynchronous Programming with async and await (C#)](../../../../csharp/programming-guide/concepts/async/index.md)"},{"pos":[19214,19346],"content":"<bpt id=\"p1\">[</bpt>Fine-Tuning Your Async Application (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/async/fine-tuning-your-async-application.md)</ept>","source":"[Fine-Tuning Your Async Application (C#)](../../../../csharp/programming-guide/concepts/async/fine-tuning-your-async-application.md)"},{"pos":[19349,19458],"content":"<bpt id=\"p1\">[</bpt>Async Sample: Fine Tuning Your Application<ept id=\"p1\">](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea)</ept>","source":"[Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea)"}]}