{"content":"---\ntitle: \"Default Marshaling for Objects\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"objects, interop marshaling\"\n  - \"interop marshaling, objects\"\nms.assetid: c2ef0284-b061-4e12-b6d3-6a502b9cc558\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\n---\n# Default Marshaling for Objects\nParameters and fields typed as <xref:System.Object?displayProperty=nameWithType> can be exposed to unmanaged code as one of the following types:  \n  \n-   A variant when the object is a parameter.  \n  \n-   An interface when the object is a structure field.  \n  \n Only COM interop supports marshaling for object types. The default behavior is to marshal objects to COM variants. These rules apply only to the type **Object** and do not apply to strongly typed objects that derive from the **Object** class.  \n  \n## Marshaling Options  \n The following table shows the marshaling options for the **Object** data type. The <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute provides several <xref:System.Runtime.InteropServices.UnmanagedType> enumeration values to marshal objects.  \n  \n|Enumeration type|Description of unmanaged format|  \n|----------------------|-------------------------------------|  \n|**UnmanagedType.Struct**<br /><br /> (default for parameters)|A COM-style variant.|  \n|**UnmanagedType.Interface**|An **IDispatch** interface, if possible; otherwise, an **IUnknown** interface.|  \n|**UnmanagedType.IUnknown**<br /><br /> (default for fields)|An **IUnknown** interface.|  \n|**UnmanagedType.IDispatch**|An **IDispatch** interface.|  \n  \n The following example shows the managed interface definition for `MarshalObject`.  \n  \n```vb  \nInterface MarshalObject  \n   Sub SetVariant(o As Object)  \n   Sub SetVariantRef(ByRef o As Object)  \n   Function GetVariant() As Object  \n  \n   Sub SetIDispatch( <MarshalAs(UnmanagedType.IDispatch)> o As Object)  \n   Sub SetIDispatchRef(ByRef <MarshalAs(UnmanagedType.IDispatch)> o _  \n      As Object)  \n   Function GetIDispatch() As <MarshalAs(UnmanagedType.IDispatch)> Object  \n   Sub SetIUnknown( <MarshalAs(UnmanagedType.IUnknown)> o As Object)  \n   Sub SetIUnknownRef(ByRef <MarshalAs(UnmanagedType.IUnknown)> o _  \n      As Object)  \n   Function GetIUnknown() As <MarshalAs(UnmanagedType.IUnknown)> Object  \nEnd Interface  \n```  \n  \n```csharp  \ninterface MarshalObject {  \n   void SetVariant(Object o);  \n   void SetVariantRef(ref Object o);  \n   Object GetVariant();  \n  \n   void SetIDispatch ([MarshalAs(UnmanagedType.IDispatch)]Object o);  \n   void SetIDispatchRef([MarshalAs(UnmanagedType.IDispatch)]ref Object o);  \n   [MarshalAs(UnmanagedType.IDispatch)] Object GetIDispatch();  \n   void SetIUnknown ([MarshalAs(UnmanagedType.IUnknown)]Object o);  \n   void SetIUnknownRef([MarshalAs(UnmanagedType.IUnknown)]ref Object o);  \n   [MarshalAs(UnmanagedType.IUnknown)] Object GetIUnknown();  \n}  \n```  \n  \n The following code exports the `MarshalObject` interface to a type library.  \n  \n```  \ninterface MarshalObject {  \n   HRESULT SetVariant([in] VARIANT o);  \n   HRESULT SetVariantRef([in,out] VARIANT *o);  \n   HRESULT GetVariant([out,retval] VARIANT *o)   \n   HRESULT SetIDispatch([in] IDispatch *o);  \n   HRESULT SetIDispatchRef([in,out] IDispatch **o);  \n   HRESULT GetIDispatch([out,retval] IDispatch **o)   \n   HRESULT SetIUnknown([in] IUnknown *o);  \n   HRESULT SetIUnknownRef([in,out] IUnknown **o);  \n   HRESULT GetIUnknown([out,retval] IUnknown **o)   \n}  \n```  \n  \n> [!NOTE]\n>  The interop marshaler automatically frees any allocated object inside the variant after the call.  \n  \n The following example shows a formatted value type.  \n  \n```vb  \nPublic Structure ObjectHolder  \n   Dim o1 As Object  \n   <MarshalAs(UnmanagedType.IDispatch)> Public o2 As Object  \nEnd Structure  \n```  \n  \n```csharp  \npublic struct ObjectHolder {  \n   Object o1;  \n   [MarshalAs(UnmanagedType.IDispatch)]public Object o2;  \n}  \n```  \n  \n The following code exports the formatted type to a type library.  \n  \n```  \nstruct ObjectHolder {  \n   VARIANT o1;  \n   IDispatch *o2;  \n}  \n```  \n  \n## Marshaling Object to Interface  \n When an object is exposed to COM as an interface, that interface is the class interface for the managed type <xref:System.Object> (the **_Object** interface). This interface is typed as an **IDispatch** (<xref:System.Runtime.InteropServices.UnmanagedType>) or an **IUnknown** (**UnmanagedType.IUnknown**) in the resulting type library. COM clients can dynamically invoke the members of the managed class or any members implemented by its derived classes through the **_Object** interface. The client can also call **QueryInterface** to obtain any other interface explicitly implemented by the managed type.  \n  \n## Marshaling Object to Variant  \n When an object is marshaled to a variant, the internal variant type is determined at run time, based on the following rules:  \n  \n-   If the object reference is null (**Nothing** in Visual Basic), the object is marshaled to a variant of type **VT_EMPTY**.  \n  \n-   If the object is an instance of any type listed in the following table, the resulting variant type is determined by the rules built into the marshaler and shown in the table.  \n  \n-   Other objects that need to explicitly control the marshaling behavior can implement the <xref:System.IConvertible> interface. In that case, the variant type is determined by the type code returned from the <xref:System.IConvertible.GetTypeCode%2A?displayProperty=nameWithType> method. Otherwise, the object is marshaled as a variant of type **VT_UNKNOWN**.  \n  \n### Marshaling System Types to Variant  \n The following table shows managed object types and their corresponding COM variant types. These types are converted only when the signature of the method being called is of type <xref:System.Object?displayProperty=nameWithType>.  \n  \n|Object type|COM variant type|  \n|-----------------|----------------------|  \n|Null object reference (**Nothing** in Visual Basic).|**VT_EMPTY**|  \n|<xref:System.DBNull?displayProperty=nameWithType>|**VT_NULL**|  \n|<xref:System.Runtime.InteropServices.ErrorWrapper?displayProperty=nameWithType>|**VT_ERROR**|  \n|<xref:System.Reflection.Missing?displayProperty=nameWithType>|**VT_ERROR** with **E_PARAMNOTFOUND**|  \n|<xref:System.Runtime.InteropServices.DispatchWrapper?displayProperty=nameWithType>|**VT_DISPATCH**|  \n|<xref:System.Runtime.InteropServices.UnknownWrapper?displayProperty=nameWithType>|**VT_UNKNOWN**|  \n|<xref:System.Runtime.InteropServices.CurrencyWrapper?displayProperty=nameWithType>|**VT_CY**|  \n|<xref:System.Boolean?displayProperty=nameWithType>|**VT_BOOL**|  \n|<xref:System.SByte?displayProperty=nameWithType>|**VT_I1**|  \n|<xref:System.Byte?displayProperty=nameWithType>|**VT_UI1**|  \n|<xref:System.Int16?displayProperty=nameWithType>|**VT_I2**|  \n|<xref:System.UInt16?displayProperty=nameWithType>|**VT_UI2**|  \n|<xref:System.Int32?displayProperty=nameWithType>|**VT_I4**|  \n|<xref:System.UInt32?displayProperty=nameWithType>|**VT_UI4**|  \n|<xref:System.Int64?displayProperty=nameWithType>|**VT_I8**|  \n|<xref:System.UInt64?displayProperty=nameWithType>|**VT_UI8**|  \n|<xref:System.Single?displayProperty=nameWithType>|**VT_R4**|  \n|<xref:System.Double?displayProperty=nameWithType>|**VT_R8**|  \n|<xref:System.Decimal?displayProperty=nameWithType>|**VT_DECIMAL**|  \n|<xref:System.DateTime?displayProperty=nameWithType>|**VT_DATE**|  \n|<xref:System.String?displayProperty=nameWithType>|**VT_BSTR**|  \n|<xref:System.IntPtr?displayProperty=nameWithType>|**VT_INT**|  \n|<xref:System.UIntPtr?displayProperty=nameWithType>|**VT_UINT**|  \n|<xref:System.Array?displayProperty=nameWithType>|**VT_ARRAY**|  \n  \n Using the `MarshalObject` interface defined in the previous example, the following code example demonstrates how to pass various types of variants to a COM server.  \n  \n```vb  \nDim mo As New MarshalObject()  \nmo.SetVariant(Nothing)         ' Marshal as variant of type VT_EMPTY.  \nmo.SetVariant(System.DBNull.Value) ' Marshal as variant of type VT_NULL.  \nmo.SetVariant(CInt(27))        ' Marshal as variant of type VT_I2.  \nmo.SetVariant(CLng(27))        ' Marshal as variant of type VT_I4.  \nmo.SetVariant(CSng(27.0))      ' Marshal as variant of type VT_R4.  \nmo.SetVariant(CDbl(27.0))      ' Marshal as variant of type VT_R8.  \n```  \n  \n```csharp  \nMarshalObject mo = new MarshalObject();  \nmo.SetVariant(null);            // Marshal as variant of type VT_EMPTY.  \nmo.SetVariant(System.DBNull.Value); // Marshal as variant of type VT_NULL.  \nmo.SetVariant((int)27);          // Marshal as variant of type VT_I2.  \nmo.SetVariant((long)27);          // Marshal as variant of type VT_I4.  \nmo.SetVariant((single)27.0);   // Marshal as variant of type VT_R4.  \nmo.SetVariant((double)27.0);   // Marshal as variant of type VT_R8.  \n```  \n  \n COM types that do not have corresponding managed types can be marshaled using wrapper classes such as <xref:System.Runtime.InteropServices.ErrorWrapper>, <xref:System.Runtime.InteropServices.DispatchWrapper>, <xref:System.Runtime.InteropServices.UnknownWrapper>, and <xref:System.Runtime.InteropServices.CurrencyWrapper>. The following code example demonstrates how to use these wrappers to pass various types of variants to a COM server.  \n  \n```vb  \nImports System.Runtime.InteropServices  \n' Pass inew as a variant of type VT_UNKNOWN interface.  \nmo.SetVariant(New UnknownWrapper(inew))  \n' Pass inew as a variant of type VT_DISPATCH interface.  \nmo.SetVariant(New DispatchWrapper(inew))  \n' Pass a value as a variant of type VT_ERROR interface.  \nmo.SetVariant(New ErrorWrapper(&H80054002))  \n' Pass a value as a variant of type VT_CURRENCY interface.  \nmo.SetVariant(New CurrencyWrapper(New Decimal(5.25)))  \n```  \n  \n```csharp  \nusing System.Runtime.InteropServices;  \n// Pass inew as a variant of type VT_UNKNOWN interface.  \nmo.SetVariant(new UnknownWrapper(inew));  \n// Pass inew as a variant of type VT_DISPATCH interface.  \nmo.SetVariant(new DispatchWrapper(inew));  \n// Pass a value as a variant of type VT_ERROR interface.  \nmo.SetVariant(new ErrorWrapper(0x80054002));  \n// Pass a value as a variant of type VT_CURRENCY interface.  \nmo.SetVariant(new CurrencyWrapper(new Decimal(5.25)));  \n```  \n  \n The wrapper classes are defined in the <xref:System.Runtime.InteropServices> namespace.  \n  \n### Marshaling the IConvertible Interface to Variant  \n Types other than those listed in the previous section can control how they are marshaled by implementing the <xref:System.IConvertible> interface. If the object implements the **IConvertible** interface, the COM variant type is determined at run time by the value of the <xref:System.TypeCode> enumeration returned from the <xref:System.IConvertible.GetTypeCode%2A?displayProperty=nameWithType> method.  \n  \n The following table shows the possible values for the **TypeCode** enumeration and the corresponding COM variant type for each value.  \n  \n|TypeCode|COM variant type|  \n|--------------|----------------------|  \n|**TypeCode.Empty**|**VT_EMPTY**|  \n|**TypeCode.Object**|**VT_UNKNOWN**|  \n|**TypeCode.DBNull**|**VT_NULL**|  \n|**TypeCode.Boolean**|**VT_BOOL**|  \n|**TypeCode.Char**|**VT_UI2**|  \n|**TypeCode.Sbyte**|**VT_I1**|  \n|**TypeCode.Byte**|**VT_UI1**|  \n|**TypeCode.Int16**|**VT_I2**|  \n|**TypeCode.UInt16**|**VT_UI2**|  \n|**TypeCode.Int32**|**VT_I4**|  \n|**TypeCode.UInt32**|**VT_UI4**|  \n|**TypeCode.Int64**|**VT_I8**|  \n|**TypeCode.UInt64**|**VT_UI8**|  \n|**TypeCode.Single**|**VT_R4**|  \n|**TypeCode.Double**|**VT_R8**|  \n|**TypeCode.Decimal**|**VT_DECIMAL**|  \n|**TypeCode.DateTime**|**VT_DATE**|  \n|**TypeCode.String**|**VT_BSTR**|  \n|Not supported.|**VT_INT**|  \n|Not supported.|**VT_UINT**|  \n|Not supported.|**VT_ARRAY**|  \n|Not supported.|**VT_RECORD**|  \n|Not supported.|**VT_CY**|  \n|Not supported.|**VT_VARIANT**|  \n  \n The value of the COM variant is determined by calling the **IConvertible.To** *Type* interface, where **To** *Type* is the conversion routine that corresponds to the type that was returned from **IConvertible.GetTypeCode**. For example, an object that returns **TypeCode.Double** from **IConvertible.GetTypeCode** is marshaled as a COM variant of type **VT_R8**. You can obtain the value of the variant (stored in the **dblVal** field of the COM variant) by casting to the **IConvertible** interface and calling the <xref:System.IConvertible.ToDouble%2A> method.  \n  \n## Marshaling Variant to Object  \n When marshaling a variant to an object, the type, and sometimes the value, of the marshaled variant determines the type of object produced. The following table identifies each variant type and the corresponding object type that the marshaler creates when a variant is passed from COM to the .NET Framework.  \n  \n|COM variant type|Object type|  \n|----------------------|-----------------|  \n|**VT_EMPTY**|Null object reference (**Nothing** in Visual Basic).|  \n|**VT_NULL**|<xref:System.DBNull?displayProperty=nameWithType>|  \n|**VT_DISPATCH**|**System.__ComObject** or null if (pdispVal == null)|  \n|**VT_UNKNOWN**|**System.__ComObject** or null if (punkVal == null)|  \n|**VT_ERROR**|<xref:System.UInt32?displayProperty=nameWithType>|  \n|**VT_BOOL**|<xref:System.Boolean?displayProperty=nameWithType>|  \n|**VT_I1**|<xref:System.SByte?displayProperty=nameWithType>|  \n|**VT_UI1**|<xref:System.Byte?displayProperty=nameWithType>|  \n|**VT_I2**|<xref:System.Int16?displayProperty=nameWithType>|  \n|**VT_UI2**|<xref:System.UInt16?displayProperty=nameWithType>|  \n|**VT_I4**|<xref:System.Int32?displayProperty=nameWithType>|  \n|**VT_UI4**|<xref:System.UInt32?displayProperty=nameWithType>|  \n|**VT_I8**|<xref:System.Int64?displayProperty=nameWithType>|  \n|**VT_UI8**|<xref:System.UInt64?displayProperty=nameWithType>|  \n|**VT_R4**|<xref:System.Single?displayProperty=nameWithType>|  \n|**VT_R8**|<xref:System.Double?displayProperty=nameWithType>|  \n|**VT_DECIMAL**|<xref:System.Decimal?displayProperty=nameWithType>|  \n|**VT_DATE**|<xref:System.DateTime?displayProperty=nameWithType>|  \n|**VT_BSTR**|<xref:System.String?displayProperty=nameWithType>|  \n|**VT_INT**|<xref:System.Int32?displayProperty=nameWithType>|  \n|**VT_UINT**|<xref:System.UInt32?displayProperty=nameWithType>|  \n|**VT_ARRAY** &#124; **VT_**\\*|<xref:System.Array?displayProperty=nameWithType>|  \n|**VT_CY**|<xref:System.Decimal?displayProperty=nameWithType>|  \n|**VT_RECORD**|Corresponding boxed value type.|  \n|**VT_VARIANT**|Not supported.|  \n  \n Variant types passed from COM to managed code and then back to COM might not retain the same variant type for the duration of the call. Consider what happens when a variant of type **VT_DISPATCH** is passed from COM to the .NET Framework. During marshaling, the variant is converted to a <xref:System.Object?displayProperty=nameWithType>. If the **Object** is then passed back to COM, it is marshaled back to a variant of type **VT_UNKNOWN**. There is no guarantee that the variant produced when an object is marshaled from managed code to COM will be the same type as the variant initially used to produce the object.  \n  \n## Marshaling ByRef Variants  \n Although variants themselves can be passed by value or by reference, the **VT_BYREF** flag can also be used with any variant type to indicate that the contents of the variant are being passed by reference instead of by value. The difference between marshaling variants by reference and marshaling a variant with the **VT_BYREF** flag set can be confusing. The following illustration clarifies the differences:  \n  \n ![Diagram that shows variant passed on the stack.](./media/default-marshaling-for-objects/interop-variant-passed-value-reference.gif)  \nVariants passed by value and by reference  \n  \n **Default behavior for marshaling objects and variants by value**  \n  \n-   When passing objects from managed code to COM, the contents of the object are copied into a new variant created by the marshaler, using the rules defined in [Marshaling Object to Variant](#marshaling-object-to-variant). Changes made to the variant on the unmanaged side are not propagated back to the original object on return from the call.  \n  \n-   When passing variants from COM to managed code, the contents of the variant are copied to a newly created object, using the rules defined in [Marshaling Variant to Object](#marshaling-variant-to-object). Changes made to the object on the managed side are not propagated back to the original variant on return from the call.  \n  \n **Default behavior for marshaling objects and variants by reference**  \n  \n To propagate changes back to the caller, the parameters must be passed by reference. For example, you can use the **ref** keyword in C# (or **ByRef** in Visual Basic managed code) to pass parameters by reference. In COM, reference parameters are passed using a pointer such as a **variant \\***.  \n  \n-   When passing an object to COM by reference, the marshaler creates a new variant and copies the contents of the object reference into the variant before the call is made. The variant is passed to the unmanaged function where the user is free to change the contents of the variant. On return from the call, any changes made to the variant on the unmanaged side are propagated back to the original object. If the type of the variant differs from the type of the variant passed to the call, then the changes are propagated back to an object of a different type. That is, the type of the object passed into the call can differ from the type of the object returned from the call.  \n  \n-   When passing a variant to managed code by reference, the marshaler creates a new object and copies the contents of the variant into the object before making the call. A reference to the object is passed to the managed function, where the user is free to change the object. On return from the call, any changes made to the referenced object are propagated back to the original variant. If the type of the object differs from the type of the object passed in to the call, the type of the original variant is changed and the value is propagated back into the variant. Again, the type of the variant passed into the call can differ from the type of the variant returned from the call.  \n  \n **Default behavior for marshaling a variant with the VT_BYREF flag set**  \n  \n-   A variant being passed to managed code by value can have the **VT_BYREF** flag set to indicate that the variant contains a reference instead of a value. In this case, the variant is still marshaled to an object because the variant is being passed by value. The marshaler automatically dereferences the contents of the variant and copies it into a newly created object before making the call. The object is then passed into the managed function; however, on return from the call, the object is not propagated back into the original variant. Changes made to the managed object are lost.  \n  \n    > [!CAUTION]\n    >  There is no way to change the value of a variant passed by value, even if the variant has the **VT_BYREF** flag set.  \n  \n-   A variant being passed to managed code by reference can also have the **VT_BYREF** flag set to indicate that the variant contains another reference. If it does, the variant is marshaled to a **ref** object because the variant is being passed by reference. The marshaler automatically dereferences the contents of the variant and copies it into a newly created object before making the call. On return from the call, the value of the object is propagated back to the reference within the original variant only if the object is the same type as the object passed in. That is, propagation does not change the type of a variant with the **VT_BYREF** flag set. If the type of the object is changed during the call, an <xref:System.InvalidCastException> occurs on return from the call.  \n  \n The following table summarizes the propagation rules for variants and objects.  \n  \n|From|To|Changes propagated back|  \n|----------|--------|-----------------------------|  \n|**Variant**  *v*|**Object**  *o*|Never|  \n|**Object**  *o*|**Variant**  *v*|Never|  \n|**Variant**   ***\\****  *pv*|**Ref Object**  *o*|Always|  \n|**Ref object**  *o*|**Variant**   ***\\****  *pv*|Always|  \n|**Variant**  *v* **(VT_BYREF** *&#124;* **VT_\\*)**|**Object**  *o*|Never|  \n|**Variant**  *v* **(VT_BYREF** *&#124;* **VT_)**|**Ref Object**  *o*|Only if the type has not changed.|  \n  \n## See also\n\n- [Default Marshaling Behavior](default-marshaling-behavior.md)\n- [Blittable and Non-Blittable Types](blittable-and-non-blittable-types.md)\n- [Directional Attributes](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/77e6taeh(v=vs.100))\n- [Copying and Pinning](copying-and-pinning.md)\n","nodes":[{"pos":[4,278],"embed":true,"restype":"x-metadata","content":"title: \"Default Marshaling for Objects\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"objects, interop marshaling\"\n  - \"interop marshaling, objects\"\nms.assetid: c2ef0284-b061-4e12-b6d3-6a502b9cc558\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"","nodes":[{"content":"Default Marshaling for Objects","nodes":[{"pos":[0,30],"content":"Default Marshaling for Objects","nodes":[{"content":"Default Marshaling for Objects","pos":[0,30]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[285,315],"content":"Default Marshaling for Objects","linkify":"Default Marshaling for Objects","nodes":[{"content":"Default Marshaling for Objects","pos":[0,30]}]},{"pos":[316,460],"content":"Parameters and fields typed as <ph id=\"ph1\">&lt;xref:System.Object?displayProperty=nameWithType&gt;</ph> can be exposed to unmanaged code as one of the following types:","source":"Parameters and fields typed as <xref:System.Object?displayProperty=nameWithType> can be exposed to unmanaged code as one of the following types:"},{"content":"A variant when the object is a parameter.","pos":[470,511]},{"content":"An interface when the object is a structure field.","pos":[521,571]},{"content":"Only COM interop supports marshaling for object types.","pos":[578,632]},{"content":"The default behavior is to marshal objects to COM variants.","pos":[633,692]},{"content":"These rules apply only to the type <bpt id=\"p1\">**</bpt>Object<ept id=\"p1\">**</ept> and do not apply to strongly typed objects that derive from the <bpt id=\"p2\">**</bpt>Object<ept id=\"p2\">**</ept> class.","pos":[693,820],"source":" These rules apply only to the type **Object** and do not apply to strongly typed objects that derive from the **Object** class."},{"pos":[829,847],"content":"Marshaling Options","linkify":"Marshaling Options","nodes":[{"content":"Marshaling Options","pos":[0,18]}]},{"content":"The following table shows the marshaling options for the <bpt id=\"p1\">**</bpt>Object<ept id=\"p1\">**</ept> data type.","pos":[851,929],"source":"The following table shows the marshaling options for the **Object** data type."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute&gt;</ph> attribute provides several <ph id=\"ph2\">&lt;xref:System.Runtime.InteropServices.UnmanagedType&gt;</ph> enumeration values to marshal objects.","pos":[930,1108],"source":" The <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute provides several <xref:System.Runtime.InteropServices.UnmanagedType> enumeration values to marshal objects."},{"content":"Enumeration type","pos":[1115,1131]},{"content":"Description of unmanaged format","pos":[1132,1163]},{"content":"<bpt id=\"p1\">**</bpt>UnmanagedType.Struct<ept id=\"p1\">**</ept>","pos":[1233,1257],"source":"**UnmanagedType.Struct**"},{"content":"(default for parameters)","pos":[1270,1294]},{"content":"A COM-style variant.","pos":[1295,1315]},{"pos":[1320,1347],"content":"<bpt id=\"p1\">**</bpt>UnmanagedType.Interface<ept id=\"p1\">**</ept>","source":"**UnmanagedType.Interface**"},{"pos":[1348,1426],"content":"An <bpt id=\"p1\">**</bpt>IDispatch<ept id=\"p1\">**</ept> interface, if possible; otherwise, an <bpt id=\"p2\">**</bpt>IUnknown<ept id=\"p2\">**</ept> interface.","source":"An **IDispatch** interface, if possible; otherwise, an **IUnknown** interface."},{"content":"<bpt id=\"p1\">**</bpt>UnmanagedType.IUnknown<ept id=\"p1\">**</ept>","pos":[1431,1457],"source":"**UnmanagedType.IUnknown**"},{"content":"(default for fields)","pos":[1470,1490]},{"pos":[1491,1517],"content":"An <bpt id=\"p1\">**</bpt>IUnknown<ept id=\"p1\">**</ept> interface.","source":"An **IUnknown** interface."},{"pos":[1522,1549],"content":"<bpt id=\"p1\">**</bpt>UnmanagedType.IDispatch<ept id=\"p1\">**</ept>","source":"**UnmanagedType.IDispatch**"},{"pos":[1550,1577],"content":"An <bpt id=\"p1\">**</bpt>IDispatch<ept id=\"p1\">**</ept> interface.","source":"An **IDispatch** interface."},{"pos":[1585,1666],"content":"The following example shows the managed interface definition for <ph id=\"ph1\">`MarshalObject`</ph>.","source":"The following example shows the managed interface definition for `MarshalObject`."},{"pos":[2894,2969],"content":"The following code exports the <ph id=\"ph1\">`MarshalObject`</ph> interface to a type library.","source":"The following code exports the `MarshalObject` interface to a type library."},{"pos":[3468,3576],"content":"[!NOTE]\n The interop marshaler automatically frees any allocated object inside the variant after the call.","leadings":["","> "],"nodes":[{"content":"The interop marshaler automatically frees any allocated object inside the variant after the call.","pos":[9,106]}]},{"content":"The following example shows a formatted value type.","pos":[3583,3634]},{"content":"The following code exports the formatted type to a type library.","pos":[3921,3985]},{"pos":[4074,4104],"content":"Marshaling Object to Interface","linkify":"Marshaling Object to Interface","nodes":[{"content":"Marshaling Object to Interface","pos":[0,30]}]},{"content":"When an object is exposed to COM as an interface, that interface is the class interface for the managed type <ph id=\"ph1\">&lt;xref:System.Object&gt;</ph> (the <bpt id=\"p1\">**</bpt>_Object<ept id=\"p1\">**</ept> interface).","pos":[4108,4266],"source":"When an object is exposed to COM as an interface, that interface is the class interface for the managed type <xref:System.Object> (the **_Object** interface)."},{"content":"This interface is typed as an <bpt id=\"p1\">**</bpt>IDispatch<ept id=\"p1\">**</ept> (<ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.UnmanagedType&gt;</ph>) or an <bpt id=\"p2\">**</bpt>IUnknown<ept id=\"p2\">**</ept> (<bpt id=\"p3\">**</bpt>UnmanagedType.IUnknown<ept id=\"p3\">**</ept>) in the resulting type library.","pos":[4267,4443],"source":" This interface is typed as an **IDispatch** (<xref:System.Runtime.InteropServices.UnmanagedType>) or an **IUnknown** (**UnmanagedType.IUnknown**) in the resulting type library."},{"content":"COM clients can dynamically invoke the members of the managed class or any members implemented by its derived classes through the <bpt id=\"p1\">**</bpt>_Object<ept id=\"p1\">**</ept> interface.","pos":[4444,4596],"source":" COM clients can dynamically invoke the members of the managed class or any members implemented by its derived classes through the **_Object** interface."},{"content":"The client can also call <bpt id=\"p1\">**</bpt>QueryInterface<ept id=\"p1\">**</ept> to obtain any other interface explicitly implemented by the managed type.","pos":[4597,4714],"source":" The client can also call **QueryInterface** to obtain any other interface explicitly implemented by the managed type."},{"pos":[4723,4751],"content":"Marshaling Object to Variant","linkify":"Marshaling Object to Variant","nodes":[{"content":"Marshaling Object to Variant","pos":[0,28]}]},{"content":"When an object is marshaled to a variant, the internal variant type is determined at run time, based on the following rules:","pos":[4755,4879]},{"pos":[4889,5010],"content":"If the object reference is null (<bpt id=\"p1\">**</bpt>Nothing<ept id=\"p1\">**</ept> in Visual Basic), the object is marshaled to a variant of type <bpt id=\"p2\">**</bpt>VT_EMPTY<ept id=\"p2\">**</ept>.","source":"If the object reference is null (**Nothing** in Visual Basic), the object is marshaled to a variant of type **VT_EMPTY**."},{"content":"If the object is an instance of any type listed in the following table, the resulting variant type is determined by the rules built into the marshaler and shown in the table.","pos":[5020,5194]},{"content":"Other objects that need to explicitly control the marshaling behavior can implement the <ph id=\"ph1\">&lt;xref:System.IConvertible&gt;</ph> interface.","pos":[5204,5329],"source":"Other objects that need to explicitly control the marshaling behavior can implement the <xref:System.IConvertible> interface."},{"content":"In that case, the variant type is determined by the type code returned from the <ph id=\"ph1\">&lt;xref:System.IConvertible.GetTypeCode%2A?displayProperty=nameWithType&gt;</ph> method.","pos":[5330,5488],"source":" In that case, the variant type is determined by the type code returned from the <xref:System.IConvertible.GetTypeCode%2A?displayProperty=nameWithType> method."},{"content":"Otherwise, the object is marshaled as a variant of type <bpt id=\"p1\">**</bpt>VT_UNKNOWN<ept id=\"p1\">**</ept>.","pos":[5489,5560],"source":" Otherwise, the object is marshaled as a variant of type **VT_UNKNOWN**."},{"pos":[5570,5604],"content":"Marshaling System Types to Variant","linkify":"Marshaling System Types to Variant","nodes":[{"content":"Marshaling System Types to Variant","pos":[0,34]}]},{"content":"The following table shows managed object types and their corresponding COM variant types.","pos":[5608,5697]},{"content":"These types are converted only when the signature of the method being called is of type <ph id=\"ph1\">&lt;xref:System.Object?displayProperty=nameWithType&gt;</ph>.","pos":[5698,5836],"source":" These types are converted only when the signature of the method being called is of type <xref:System.Object?displayProperty=nameWithType>."},{"content":"Object type","pos":[5843,5854]},{"content":"COM variant type","pos":[5855,5871]},{"pos":[5921,5973],"content":"Null object reference (<bpt id=\"p1\">**</bpt>Nothing<ept id=\"p1\">**</ept> in Visual Basic).","source":"Null object reference (**Nothing** in Visual Basic)."},{"pos":[5974,5986],"content":"<bpt id=\"p1\">**</bpt>VT_EMPTY<ept id=\"p1\">**</ept>","source":"**VT_EMPTY**"},{"pos":[6041,6052],"content":"<bpt id=\"p1\">**</bpt>VT_NULL<ept id=\"p1\">**</ept>","source":"**VT_NULL**"},{"pos":[6137,6149],"content":"<bpt id=\"p1\">**</bpt>VT_ERROR<ept id=\"p1\">**</ept>","source":"**VT_ERROR**"},{"pos":[6216,6253],"content":"<bpt id=\"p1\">**</bpt>VT_ERROR<ept id=\"p1\">**</ept> with <bpt id=\"p2\">**</bpt>E_PARAMNOTFOUND<ept id=\"p2\">**</ept>","source":"**VT_ERROR** with **E_PARAMNOTFOUND**"},{"pos":[6341,6356],"content":"<bpt id=\"p1\">**</bpt>VT_DISPATCH<ept id=\"p1\">**</ept>","source":"**VT_DISPATCH**"},{"pos":[6443,6457],"content":"<bpt id=\"p1\">**</bpt>VT_UNKNOWN<ept id=\"p1\">**</ept>","source":"**VT_UNKNOWN**"},{"pos":[6545,6554],"content":"<bpt id=\"p1\">**</bpt>VT_CY<ept id=\"p1\">**</ept>","source":"**VT_CY**"},{"pos":[6610,6621],"content":"<bpt id=\"p1\">**</bpt>VT_BOOL<ept id=\"p1\">**</ept>","source":"**VT_BOOL**"},{"pos":[6675,6684],"content":"<bpt id=\"p1\">**</bpt>VT_I1<ept id=\"p1\">**</ept>","source":"**VT_I1**"},{"pos":[6737,6747],"content":"<bpt id=\"p1\">**</bpt>VT_UI1<ept id=\"p1\">**</ept>","source":"**VT_UI1**"},{"pos":[6801,6810],"content":"<bpt id=\"p1\">**</bpt>VT_I2<ept id=\"p1\">**</ept>","source":"**VT_I2**"},{"pos":[6865,6875],"content":"<bpt id=\"p1\">**</bpt>VT_UI2<ept id=\"p1\">**</ept>","source":"**VT_UI2**"},{"pos":[6929,6938],"content":"<bpt id=\"p1\">**</bpt>VT_I4<ept id=\"p1\">**</ept>","source":"**VT_I4**"},{"pos":[6993,7003],"content":"<bpt id=\"p1\">**</bpt>VT_UI4<ept id=\"p1\">**</ept>","source":"**VT_UI4**"},{"pos":[7057,7066],"content":"<bpt id=\"p1\">**</bpt>VT_I8<ept id=\"p1\">**</ept>","source":"**VT_I8**"},{"pos":[7121,7131],"content":"<bpt id=\"p1\">**</bpt>VT_UI8<ept id=\"p1\">**</ept>","source":"**VT_UI8**"},{"pos":[7186,7195],"content":"<bpt id=\"p1\">**</bpt>VT_R4<ept id=\"p1\">**</ept>","source":"**VT_R4**"},{"pos":[7250,7259],"content":"<bpt id=\"p1\">**</bpt>VT_R8<ept id=\"p1\">**</ept>","source":"**VT_R8**"},{"pos":[7315,7329],"content":"<bpt id=\"p1\">**</bpt>VT_DECIMAL<ept id=\"p1\">**</ept>","source":"**VT_DECIMAL**"},{"pos":[7386,7397],"content":"<bpt id=\"p1\">**</bpt>VT_DATE<ept id=\"p1\">**</ept>","source":"**VT_DATE**"},{"pos":[7452,7463],"content":"<bpt id=\"p1\">**</bpt>VT_BSTR<ept id=\"p1\">**</ept>","source":"**VT_BSTR**"},{"pos":[7518,7528],"content":"<bpt id=\"p1\">**</bpt>VT_INT<ept id=\"p1\">**</ept>","source":"**VT_INT**"},{"pos":[7584,7595],"content":"<bpt id=\"p1\">**</bpt>VT_UINT<ept id=\"p1\">**</ept>","source":"**VT_UINT**"},{"pos":[7649,7661],"content":"<bpt id=\"p1\">**</bpt>VT_ARRAY<ept id=\"p1\">**</ept>","source":"**VT_ARRAY**"},{"pos":[7669,7832],"content":"Using the <ph id=\"ph1\">`MarshalObject`</ph> interface defined in the previous example, the following code example demonstrates how to pass various types of variants to a COM server.","source":"Using the `MarshalObject` interface defined in the previous example, the following code example demonstrates how to pass various types of variants to a COM server."},{"content":"COM types that do not have corresponding managed types can be marshaled using wrapper classes such as <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.ErrorWrapper&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.Runtime.InteropServices.DispatchWrapper&gt;</ph>, <ph id=\"ph3\">&lt;xref:System.Runtime.InteropServices.UnknownWrapper&gt;</ph>, and <ph id=\"ph4\">&lt;xref:System.Runtime.InteropServices.CurrencyWrapper&gt;</ph>.","pos":[8810,9131],"source":"COM types that do not have corresponding managed types can be marshaled using wrapper classes such as <xref:System.Runtime.InteropServices.ErrorWrapper>, <xref:System.Runtime.InteropServices.DispatchWrapper>, <xref:System.Runtime.InteropServices.UnknownWrapper>, and <xref:System.Runtime.InteropServices.CurrencyWrapper>."},{"content":"The following code example demonstrates how to use these wrappers to pass various types of variants to a COM server.","pos":[9132,9248]},{"pos":[10224,10311],"content":"The wrapper classes are defined in the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices&gt;</ph> namespace.","source":"The wrapper classes are defined in the <xref:System.Runtime.InteropServices> namespace."},{"pos":[10321,10369],"content":"Marshaling the IConvertible Interface to Variant","linkify":"Marshaling the IConvertible Interface to Variant","nodes":[{"content":"Marshaling the IConvertible Interface to Variant","pos":[0,48]}]},{"content":"Types other than those listed in the previous section can control how they are marshaled by implementing the <ph id=\"ph1\">&lt;xref:System.IConvertible&gt;</ph> interface.","pos":[10373,10519],"source":"Types other than those listed in the previous section can control how they are marshaled by implementing the <xref:System.IConvertible> interface."},{"content":"If the object implements the <bpt id=\"p1\">**</bpt>IConvertible<ept id=\"p1\">**</ept> interface, the COM variant type is determined at run time by the value of the <ph id=\"ph1\">&lt;xref:System.TypeCode&gt;</ph> enumeration returned from the <ph id=\"ph2\">&lt;xref:System.IConvertible.GetTypeCode%2A?displayProperty=nameWithType&gt;</ph> method.","pos":[10520,10775],"source":" If the object implements the **IConvertible** interface, the COM variant type is determined at run time by the value of the <xref:System.TypeCode> enumeration returned from the <xref:System.IConvertible.GetTypeCode%2A?displayProperty=nameWithType> method."},{"pos":[10782,10915],"content":"The following table shows the possible values for the <bpt id=\"p1\">**</bpt>TypeCode<ept id=\"p1\">**</ept> enumeration and the corresponding COM variant type for each value.","source":"The following table shows the possible values for the **TypeCode** enumeration and the corresponding COM variant type for each value."},{"content":"TypeCode","pos":[10922,10930]},{"content":"COM variant type","pos":[10931,10947]},{"pos":[10994,11012],"content":"<bpt id=\"p1\">**</bpt>TypeCode.Empty<ept id=\"p1\">**</ept>","source":"**TypeCode.Empty**"},{"pos":[11013,11025],"content":"<bpt id=\"p1\">**</bpt>VT_EMPTY<ept id=\"p1\">**</ept>","source":"**VT_EMPTY**"},{"pos":[11030,11049],"content":"<bpt id=\"p1\">**</bpt>TypeCode.Object<ept id=\"p1\">**</ept>","source":"**TypeCode.Object**"},{"pos":[11050,11064],"content":"<bpt id=\"p1\">**</bpt>VT_UNKNOWN<ept id=\"p1\">**</ept>","source":"**VT_UNKNOWN**"},{"pos":[11069,11088],"content":"<bpt id=\"p1\">**</bpt>TypeCode.DBNull<ept id=\"p1\">**</ept>","source":"**TypeCode.DBNull**"},{"pos":[11089,11100],"content":"<bpt id=\"p1\">**</bpt>VT_NULL<ept id=\"p1\">**</ept>","source":"**VT_NULL**"},{"pos":[11105,11125],"content":"<bpt id=\"p1\">**</bpt>TypeCode.Boolean<ept id=\"p1\">**</ept>","source":"**TypeCode.Boolean**"},{"pos":[11126,11137],"content":"<bpt id=\"p1\">**</bpt>VT_BOOL<ept id=\"p1\">**</ept>","source":"**VT_BOOL**"},{"pos":[11142,11159],"content":"<bpt id=\"p1\">**</bpt>TypeCode.Char<ept id=\"p1\">**</ept>","source":"**TypeCode.Char**"},{"pos":[11160,11170],"content":"<bpt id=\"p1\">**</bpt>VT_UI2<ept id=\"p1\">**</ept>","source":"**VT_UI2**"},{"pos":[11175,11193],"content":"<bpt id=\"p1\">**</bpt>TypeCode.Sbyte<ept id=\"p1\">**</ept>","source":"**TypeCode.Sbyte**"},{"pos":[11194,11203],"content":"<bpt id=\"p1\">**</bpt>VT_I1<ept id=\"p1\">**</ept>","source":"**VT_I1**"},{"pos":[11208,11225],"content":"<bpt id=\"p1\">**</bpt>TypeCode.Byte<ept id=\"p1\">**</ept>","source":"**TypeCode.Byte**"},{"pos":[11226,11236],"content":"<bpt id=\"p1\">**</bpt>VT_UI1<ept id=\"p1\">**</ept>","source":"**VT_UI1**"},{"pos":[11241,11259],"content":"<bpt id=\"p1\">**</bpt>TypeCode.Int16<ept id=\"p1\">**</ept>","source":"**TypeCode.Int16**"},{"pos":[11260,11269],"content":"<bpt id=\"p1\">**</bpt>VT_I2<ept id=\"p1\">**</ept>","source":"**VT_I2**"},{"pos":[11274,11293],"content":"<bpt id=\"p1\">**</bpt>TypeCode.UInt16<ept id=\"p1\">**</ept>","source":"**TypeCode.UInt16**"},{"pos":[11294,11304],"content":"<bpt id=\"p1\">**</bpt>VT_UI2<ept id=\"p1\">**</ept>","source":"**VT_UI2**"},{"pos":[11309,11327],"content":"<bpt id=\"p1\">**</bpt>TypeCode.Int32<ept id=\"p1\">**</ept>","source":"**TypeCode.Int32**"},{"pos":[11328,11337],"content":"<bpt id=\"p1\">**</bpt>VT_I4<ept id=\"p1\">**</ept>","source":"**VT_I4**"},{"pos":[11342,11361],"content":"<bpt id=\"p1\">**</bpt>TypeCode.UInt32<ept id=\"p1\">**</ept>","source":"**TypeCode.UInt32**"},{"pos":[11362,11372],"content":"<bpt id=\"p1\">**</bpt>VT_UI4<ept id=\"p1\">**</ept>","source":"**VT_UI4**"},{"pos":[11377,11395],"content":"<bpt id=\"p1\">**</bpt>TypeCode.Int64<ept id=\"p1\">**</ept>","source":"**TypeCode.Int64**"},{"pos":[11396,11405],"content":"<bpt id=\"p1\">**</bpt>VT_I8<ept id=\"p1\">**</ept>","source":"**VT_I8**"},{"pos":[11410,11429],"content":"<bpt id=\"p1\">**</bpt>TypeCode.UInt64<ept id=\"p1\">**</ept>","source":"**TypeCode.UInt64**"},{"pos":[11430,11440],"content":"<bpt id=\"p1\">**</bpt>VT_UI8<ept id=\"p1\">**</ept>","source":"**VT_UI8**"},{"pos":[11445,11464],"content":"<bpt id=\"p1\">**</bpt>TypeCode.Single<ept id=\"p1\">**</ept>","source":"**TypeCode.Single**"},{"pos":[11465,11474],"content":"<bpt id=\"p1\">**</bpt>VT_R4<ept id=\"p1\">**</ept>","source":"**VT_R4**"},{"pos":[11479,11498],"content":"<bpt id=\"p1\">**</bpt>TypeCode.Double<ept id=\"p1\">**</ept>","source":"**TypeCode.Double**"},{"pos":[11499,11508],"content":"<bpt id=\"p1\">**</bpt>VT_R8<ept id=\"p1\">**</ept>","source":"**VT_R8**"},{"pos":[11513,11533],"content":"<bpt id=\"p1\">**</bpt>TypeCode.Decimal<ept id=\"p1\">**</ept>","source":"**TypeCode.Decimal**"},{"pos":[11534,11548],"content":"<bpt id=\"p1\">**</bpt>VT_DECIMAL<ept id=\"p1\">**</ept>","source":"**VT_DECIMAL**"},{"pos":[11553,11574],"content":"<bpt id=\"p1\">**</bpt>TypeCode.DateTime<ept id=\"p1\">**</ept>","source":"**TypeCode.DateTime**"},{"pos":[11575,11586],"content":"<bpt id=\"p1\">**</bpt>VT_DATE<ept id=\"p1\">**</ept>","source":"**VT_DATE**"},{"pos":[11591,11610],"content":"<bpt id=\"p1\">**</bpt>TypeCode.String<ept id=\"p1\">**</ept>","source":"**TypeCode.String**"},{"pos":[11611,11622],"content":"<bpt id=\"p1\">**</bpt>VT_BSTR<ept id=\"p1\">**</ept>","source":"**VT_BSTR**"},{"content":"Not supported.","pos":[11627,11641]},{"pos":[11642,11652],"content":"<bpt id=\"p1\">**</bpt>VT_INT<ept id=\"p1\">**</ept>","source":"**VT_INT**"},{"content":"Not supported.","pos":[11657,11671]},{"pos":[11672,11683],"content":"<bpt id=\"p1\">**</bpt>VT_UINT<ept id=\"p1\">**</ept>","source":"**VT_UINT**"},{"content":"Not supported.","pos":[11688,11702]},{"pos":[11703,11715],"content":"<bpt id=\"p1\">**</bpt>VT_ARRAY<ept id=\"p1\">**</ept>","source":"**VT_ARRAY**"},{"content":"Not supported.","pos":[11720,11734]},{"pos":[11735,11748],"content":"<bpt id=\"p1\">**</bpt>VT_RECORD<ept id=\"p1\">**</ept>","source":"**VT_RECORD**"},{"content":"Not supported.","pos":[11753,11767]},{"pos":[11768,11777],"content":"<bpt id=\"p1\">**</bpt>VT_CY<ept id=\"p1\">**</ept>","source":"**VT_CY**"},{"content":"Not supported.","pos":[11782,11796]},{"pos":[11797,11811],"content":"<bpt id=\"p1\">**</bpt>VT_VARIANT<ept id=\"p1\">**</ept>","source":"**VT_VARIANT**"},{"content":"The value of the COM variant is determined by calling the <bpt id=\"p1\">**</bpt>IConvertible.To<ept id=\"p1\">**</ept> <bpt id=\"p2\">*</bpt>Type<ept id=\"p2\">*</ept> interface, where <bpt id=\"p3\">**</bpt>To<ept id=\"p3\">**</ept> <bpt id=\"p4\">*</bpt>Type<ept id=\"p4\">*</ept> is the conversion routine that corresponds to the type that was returned from <bpt id=\"p5\">**</bpt>IConvertible.GetTypeCode<ept id=\"p5\">**</ept>.","pos":[11819,12042],"source":"The value of the COM variant is determined by calling the **IConvertible.To** *Type* interface, where **To** *Type* is the conversion routine that corresponds to the type that was returned from **IConvertible.GetTypeCode**."},{"content":"For example, an object that returns <bpt id=\"p1\">**</bpt>TypeCode.Double<ept id=\"p1\">**</ept> from <bpt id=\"p2\">**</bpt>IConvertible.GetTypeCode<ept id=\"p2\">**</ept> is marshaled as a COM variant of type <bpt id=\"p3\">**</bpt>VT_R8<ept id=\"p3\">**</ept>.","pos":[12043,12181],"source":" For example, an object that returns **TypeCode.Double** from **IConvertible.GetTypeCode** is marshaled as a COM variant of type **VT_R8**."},{"content":"You can obtain the value of the variant (stored in the <bpt id=\"p1\">**</bpt>dblVal<ept id=\"p1\">**</ept> field of the COM variant) by casting to the <bpt id=\"p2\">**</bpt>IConvertible<ept id=\"p2\">**</ept> interface and calling the <ph id=\"ph1\">&lt;xref:System.IConvertible.ToDouble%2A&gt;</ph> method.","pos":[12182,12381],"source":" You can obtain the value of the variant (stored in the **dblVal** field of the COM variant) by casting to the **IConvertible** interface and calling the <xref:System.IConvertible.ToDouble%2A> method."},{"pos":[12390,12418],"content":"Marshaling Variant to Object","linkify":"Marshaling Variant to Object","nodes":[{"content":"Marshaling Variant to Object","pos":[0,28]}]},{"content":"When marshaling a variant to an object, the type, and sometimes the value, of the marshaled variant determines the type of object produced.","pos":[12422,12561]},{"content":"The following table identifies each variant type and the corresponding object type that the marshaler creates when a variant is passed from COM to the .NET Framework.","pos":[12562,12728]},{"content":"COM variant type","pos":[12735,12751]},{"content":"Object type","pos":[12752,12763]},{"pos":[12813,12825],"content":"<bpt id=\"p1\">**</bpt>VT_EMPTY<ept id=\"p1\">**</ept>","source":"**VT_EMPTY**"},{"pos":[12826,12878],"content":"Null object reference (<bpt id=\"p1\">**</bpt>Nothing<ept id=\"p1\">**</ept> in Visual Basic).","source":"Null object reference (**Nothing** in Visual Basic)."},{"pos":[12883,12894],"content":"<bpt id=\"p1\">**</bpt>VT_NULL<ept id=\"p1\">**</ept>","source":"**VT_NULL**"},{"pos":[12949,12964],"content":"<bpt id=\"p1\">**</bpt>VT_DISPATCH<ept id=\"p1\">**</ept>","source":"**VT_DISPATCH**"},{"pos":[12965,13017],"content":"<bpt id=\"p1\">**</bpt>System.__ComObject<ept id=\"p1\">**</ept> or null if (pdispVal == null)","source":"**System.__ComObject** or null if (pdispVal == null)"},{"pos":[13022,13036],"content":"<bpt id=\"p1\">**</bpt>VT_UNKNOWN<ept id=\"p1\">**</ept>","source":"**VT_UNKNOWN**"},{"pos":[13037,13088],"content":"<bpt id=\"p1\">**</bpt>System.__ComObject<ept id=\"p1\">**</ept> or null if (punkVal == null)","source":"**System.__ComObject** or null if (punkVal == null)"},{"pos":[13093,13105],"content":"<bpt id=\"p1\">**</bpt>VT_ERROR<ept id=\"p1\">**</ept>","source":"**VT_ERROR**"},{"pos":[13160,13171],"content":"<bpt id=\"p1\">**</bpt>VT_BOOL<ept id=\"p1\">**</ept>","source":"**VT_BOOL**"},{"pos":[13227,13236],"content":"<bpt id=\"p1\">**</bpt>VT_I1<ept id=\"p1\">**</ept>","source":"**VT_I1**"},{"pos":[13290,13300],"content":"<bpt id=\"p1\">**</bpt>VT_UI1<ept id=\"p1\">**</ept>","source":"**VT_UI1**"},{"pos":[13353,13362],"content":"<bpt id=\"p1\">**</bpt>VT_I2<ept id=\"p1\">**</ept>","source":"**VT_I2**"},{"pos":[13416,13426],"content":"<bpt id=\"p1\">**</bpt>VT_UI2<ept id=\"p1\">**</ept>","source":"**VT_UI2**"},{"pos":[13481,13490],"content":"<bpt id=\"p1\">**</bpt>VT_I4<ept id=\"p1\">**</ept>","source":"**VT_I4**"},{"pos":[13544,13554],"content":"<bpt id=\"p1\">**</bpt>VT_UI4<ept id=\"p1\">**</ept>","source":"**VT_UI4**"},{"pos":[13609,13618],"content":"<bpt id=\"p1\">**</bpt>VT_I8<ept id=\"p1\">**</ept>","source":"**VT_I8**"},{"pos":[13672,13682],"content":"<bpt id=\"p1\">**</bpt>VT_UI8<ept id=\"p1\">**</ept>","source":"**VT_UI8**"},{"pos":[13737,13746],"content":"<bpt id=\"p1\">**</bpt>VT_R4<ept id=\"p1\">**</ept>","source":"**VT_R4**"},{"pos":[13801,13810],"content":"<bpt id=\"p1\">**</bpt>VT_R8<ept id=\"p1\">**</ept>","source":"**VT_R8**"},{"pos":[13865,13879],"content":"<bpt id=\"p1\">**</bpt>VT_DECIMAL<ept id=\"p1\">**</ept>","source":"**VT_DECIMAL**"},{"pos":[13935,13946],"content":"<bpt id=\"p1\">**</bpt>VT_DATE<ept id=\"p1\">**</ept>","source":"**VT_DATE**"},{"pos":[14003,14014],"content":"<bpt id=\"p1\">**</bpt>VT_BSTR<ept id=\"p1\">**</ept>","source":"**VT_BSTR**"},{"pos":[14069,14079],"content":"<bpt id=\"p1\">**</bpt>VT_INT<ept id=\"p1\">**</ept>","source":"**VT_INT**"},{"pos":[14133,14144],"content":"<bpt id=\"p1\">**</bpt>VT_UINT<ept id=\"p1\">**</ept>","source":"**VT_UINT**"},{"pos":[14199,14228],"content":"<bpt id=\"p1\">**</bpt>VT_ARRAY<ept id=\"p1\">**</ept> &amp;#124; <bpt id=\"p2\">**</bpt>VT_<ept id=\"p2\">**</ept><ph id=\"ph1\">\\*</ph>","source":"**VT_ARRAY** &#124; **VT_**\\*"},{"pos":[14282,14291],"content":"<bpt id=\"p1\">**</bpt>VT_CY<ept id=\"p1\">**</ept>","source":"**VT_CY**"},{"pos":[14347,14360],"content":"<bpt id=\"p1\">**</bpt>VT_RECORD<ept id=\"p1\">**</ept>","source":"**VT_RECORD**"},{"content":"Corresponding boxed value type.","pos":[14361,14392]},{"pos":[14397,14411],"content":"<bpt id=\"p1\">**</bpt>VT_VARIANT<ept id=\"p1\">**</ept>","source":"**VT_VARIANT**"},{"content":"Not supported.","pos":[14412,14426]},{"content":"Variant types passed from COM to managed code and then back to COM might not retain the same variant type for the duration of the call.","pos":[14434,14569]},{"content":"Consider what happens when a variant of type <bpt id=\"p1\">**</bpt>VT_DISPATCH<ept id=\"p1\">**</ept> is passed from COM to the .NET Framework.","pos":[14570,14672],"source":" Consider what happens when a variant of type **VT_DISPATCH** is passed from COM to the .NET Framework."},{"content":"During marshaling, the variant is converted to a <ph id=\"ph1\">&lt;xref:System.Object?displayProperty=nameWithType&gt;</ph>.","pos":[14673,14772],"source":" During marshaling, the variant is converted to a <xref:System.Object?displayProperty=nameWithType>."},{"content":"If the <bpt id=\"p1\">**</bpt>Object<ept id=\"p1\">**</ept> is then passed back to COM, it is marshaled back to a variant of type <bpt id=\"p2\">**</bpt>VT_UNKNOWN<ept id=\"p2\">**</ept>.","pos":[14773,14876],"source":" If the **Object** is then passed back to COM, it is marshaled back to a variant of type **VT_UNKNOWN**."},{"content":"There is no guarantee that the variant produced when an object is marshaled from managed code to COM will be the same type as the variant initially used to produce the object.","pos":[14877,15052]},{"pos":[15061,15086],"content":"Marshaling ByRef Variants","linkify":"Marshaling ByRef Variants","nodes":[{"content":"Marshaling ByRef Variants","pos":[0,25]}]},{"content":"Although variants themselves can be passed by value or by reference, the <bpt id=\"p1\">**</bpt>VT_BYREF<ept id=\"p1\">**</ept> flag can also be used with any variant type to indicate that the contents of the variant are being passed by reference instead of by value.","pos":[15090,15315],"source":"Although variants themselves can be passed by value or by reference, the **VT_BYREF** flag can also be used with any variant type to indicate that the contents of the variant are being passed by reference instead of by value."},{"content":"The difference between marshaling variants by reference and marshaling a variant with the <bpt id=\"p1\">**</bpt>VT_BYREF<ept id=\"p1\">**</ept> flag set can be confusing.","pos":[15316,15445],"source":" The difference between marshaling variants by reference and marshaling a variant with the **VT_BYREF** flag set can be confusing."},{"content":"The following illustration clarifies the differences:","pos":[15446,15499]},{"content":"Diagram that shows variant passed on the stack.","pos":[15508,15555]},{"content":"Variants passed by value and by reference","pos":[15642,15683]},{"pos":[15690,15755],"content":"<bpt id=\"p1\">**</bpt>Default behavior for marshaling objects and variants by value<ept id=\"p1\">**</ept>","source":"**Default behavior for marshaling objects and variants by value**"},{"content":"When passing objects from managed code to COM, the contents of the object are copied into a new variant created by the marshaler, using the rules defined in <bpt id=\"p1\">[</bpt>Marshaling Object to Variant<ept id=\"p1\">](#marshaling-object-to-variant)</ept>.","pos":[15765,15984],"source":"When passing objects from managed code to COM, the contents of the object are copied into a new variant created by the marshaler, using the rules defined in [Marshaling Object to Variant](#marshaling-object-to-variant)."},{"content":"Changes made to the variant on the unmanaged side are not propagated back to the original object on return from the call.","pos":[15985,16106]},{"content":"When passing variants from COM to managed code, the contents of the variant are copied to a newly created object, using the rules defined in <bpt id=\"p1\">[</bpt>Marshaling Variant to Object<ept id=\"p1\">](#marshaling-variant-to-object)</ept>.","pos":[16116,16319],"source":"When passing variants from COM to managed code, the contents of the variant are copied to a newly created object, using the rules defined in [Marshaling Variant to Object](#marshaling-variant-to-object)."},{"content":"Changes made to the object on the managed side are not propagated back to the original variant on return from the call.","pos":[16320,16439]},{"pos":[16446,16515],"content":"<bpt id=\"p1\">**</bpt>Default behavior for marshaling objects and variants by reference<ept id=\"p1\">**</ept>","source":"**Default behavior for marshaling objects and variants by reference**"},{"content":"To propagate changes back to the caller, the parameters must be passed by reference.","pos":[16522,16606]},{"content":"For example, you can use the <bpt id=\"p1\">**</bpt>ref<ept id=\"p1\">**</ept> keyword in C# (or <bpt id=\"p2\">**</bpt>ByRef<ept id=\"p2\">**</ept> in Visual Basic managed code) to pass parameters by reference.","pos":[16607,16734],"source":" For example, you can use the **ref** keyword in C# (or **ByRef** in Visual Basic managed code) to pass parameters by reference."},{"content":"In COM, reference parameters are passed using a pointer such as a <bpt id=\"p1\">**</bpt>variant <ph id=\"ph1\">\\*</ph><ept id=\"p1\">**</ept>.","pos":[16735,16816],"source":" In COM, reference parameters are passed using a pointer such as a **variant \\***."},{"content":"When passing an object to COM by reference, the marshaler creates a new variant and copies the contents of the object reference into the variant before the call is made.","pos":[16826,16995]},{"content":"The variant is passed to the unmanaged function where the user is free to change the contents of the variant.","pos":[16996,17105]},{"content":"On return from the call, any changes made to the variant on the unmanaged side are propagated back to the original object.","pos":[17106,17228]},{"content":"If the type of the variant differs from the type of the variant passed to the call, then the changes are propagated back to an object of a different type.","pos":[17229,17383]},{"content":"That is, the type of the object passed into the call can differ from the type of the object returned from the call.","pos":[17384,17499]},{"content":"When passing a variant to managed code by reference, the marshaler creates a new object and copies the contents of the variant into the object before making the call.","pos":[17509,17675]},{"content":"A reference to the object is passed to the managed function, where the user is free to change the object.","pos":[17676,17781]},{"content":"On return from the call, any changes made to the referenced object are propagated back to the original variant.","pos":[17782,17893]},{"content":"If the type of the object differs from the type of the object passed in to the call, the type of the original variant is changed and the value is propagated back into the variant.","pos":[17894,18073]},{"content":"Again, the type of the variant passed into the call can differ from the type of the variant returned from the call.","pos":[18074,18189]},{"pos":[18196,18268],"content":"<bpt id=\"p1\">**</bpt>Default behavior for marshaling a variant with the VT_BYREF flag set<ept id=\"p1\">**</ept>","source":"**Default behavior for marshaling a variant with the VT_BYREF flag set**"},{"content":"A variant being passed to managed code by value can have the <bpt id=\"p1\">**</bpt>VT_BYREF<ept id=\"p1\">**</ept> flag set to indicate that the variant contains a reference instead of a value.","pos":[18278,18430],"source":"A variant being passed to managed code by value can have the **VT_BYREF** flag set to indicate that the variant contains a reference instead of a value."},{"content":"In this case, the variant is still marshaled to an object because the variant is being passed by value.","pos":[18431,18534]},{"content":"The marshaler automatically dereferences the contents of the variant and copies it into a newly created object before making the call.","pos":[18535,18669]},{"content":"The object is then passed into the managed function; however, on return from the call, the object is not propagated back into the original variant.","pos":[18670,18817]},{"content":"Changes made to the managed object are lost.","pos":[18818,18862]},{"pos":[18874,19008],"content":"[!CAUTION]\nThere is no way to change the value of a variant passed by value, even if the variant has the **VT_BYREF** flag set.","leadings":["","    >  "],"nodes":[{"content":"There is no way to change the value of a variant passed by value, even if the variant has the <bpt id=\"p1\">**</bpt>VT_BYREF<ept id=\"p1\">**</ept> flag set.","pos":[11,127],"source":"There is no way to change the value of a variant passed by value, even if the variant has the **VT_BYREF** flag set."}]},{"content":"A variant being passed to managed code by reference can also have the <bpt id=\"p1\">**</bpt>VT_BYREF<ept id=\"p1\">**</ept> flag set to indicate that the variant contains another reference.","pos":[19018,19166],"source":"A variant being passed to managed code by reference can also have the **VT_BYREF** flag set to indicate that the variant contains another reference."},{"content":"If it does, the variant is marshaled to a <bpt id=\"p1\">**</bpt>ref<ept id=\"p1\">**</ept> object because the variant is being passed by reference.","pos":[19167,19273],"source":" If it does, the variant is marshaled to a **ref** object because the variant is being passed by reference."},{"content":"The marshaler automatically dereferences the contents of the variant and copies it into a newly created object before making the call.","pos":[19274,19408]},{"content":"On return from the call, the value of the object is propagated back to the reference within the original variant only if the object is the same type as the object passed in.","pos":[19409,19582]},{"content":"That is, propagation does not change the type of a variant with the <bpt id=\"p1\">**</bpt>VT_BYREF<ept id=\"p1\">**</ept> flag set.","pos":[19583,19673],"source":" That is, propagation does not change the type of a variant with the **VT_BYREF** flag set."},{"content":"If the type of the object is changed during the call, an <ph id=\"ph1\">&lt;xref:System.InvalidCastException&gt;</ph> occurs on return from the call.","pos":[19674,19797],"source":" If the type of the object is changed during the call, an <xref:System.InvalidCastException> occurs on return from the call."},{"content":"The following table summarizes the propagation rules for variants and objects.","pos":[19804,19882]},{"content":"From","pos":[19889,19893]},{"content":"To","pos":[19894,19896]},{"content":"Changes propagated back","pos":[19897,19920]},{"pos":[19979,19995],"content":"<bpt id=\"p1\">**</bpt>Variant<ept id=\"p1\">**</ept>  <bpt id=\"p2\">*</bpt>v<ept id=\"p2\">*</ept>","source":"**Variant**  *v*"},{"pos":[19996,20011],"content":"<bpt id=\"p1\">**</bpt>Object<ept id=\"p1\">**</ept>  <bpt id=\"p2\">*</bpt>o<ept id=\"p2\">*</ept>","source":"**Object**  *o*"},{"content":"Never","pos":[20012,20017]},{"pos":[20022,20037],"content":"<bpt id=\"p1\">**</bpt>Object<ept id=\"p1\">**</ept>  <bpt id=\"p2\">*</bpt>o<ept id=\"p2\">*</ept>","source":"**Object**  *o*"},{"pos":[20038,20054],"content":"<bpt id=\"p1\">**</bpt>Variant<ept id=\"p1\">**</ept>  <bpt id=\"p2\">*</bpt>v<ept id=\"p2\">*</ept>","source":"**Variant**  *v*"},{"content":"Never","pos":[20055,20060]},{"pos":[20065,20093],"content":"<bpt id=\"p1\">**</bpt>Variant<ept id=\"p1\">**</ept>   <bpt id=\"p2\">***</bpt><ph id=\"ph1\">\\*</ph><ept id=\"p2\">***</ept>  <bpt id=\"p3\">*</bpt>pv<ept id=\"p3\">*</ept>","source":"**Variant**   ***\\****  *pv*"},{"pos":[20094,20113],"content":"<bpt id=\"p1\">**</bpt>Ref Object<ept id=\"p1\">**</ept>  <bpt id=\"p2\">*</bpt>o<ept id=\"p2\">*</ept>","source":"**Ref Object**  *o*"},{"content":"Always","pos":[20114,20120]},{"pos":[20125,20144],"content":"<bpt id=\"p1\">**</bpt>Ref object<ept id=\"p1\">**</ept>  <bpt id=\"p2\">*</bpt>o<ept id=\"p2\">*</ept>","source":"**Ref object**  *o*"},{"pos":[20145,20173],"content":"<bpt id=\"p1\">**</bpt>Variant<ept id=\"p1\">**</ept>   <bpt id=\"p2\">***</bpt><ph id=\"ph1\">\\*</ph><ept id=\"p2\">***</ept>  <bpt id=\"p3\">*</bpt>pv<ept id=\"p3\">*</ept>","source":"**Variant**   ***\\****  *pv*"},{"content":"Always","pos":[20174,20180]},{"pos":[20185,20235],"content":"<bpt id=\"p1\">**</bpt>Variant<ept id=\"p1\">**</ept>  <bpt id=\"p2\">*</bpt>v<ept id=\"p2\">*</ept> <bpt id=\"p3\">**</bpt>(VT_BYREF<ept id=\"p3\">**</ept> <bpt id=\"p4\">*</bpt>&amp;#124;<ept id=\"p4\">*</ept> <bpt id=\"p5\">**</bpt>VT_<ph id=\"ph1\">\\*</ph>)<ept id=\"p5\">**</ept>","source":"**Variant**  *v* **(VT_BYREF** *&#124;* **VT_\\*)**"},{"pos":[20236,20251],"content":"<bpt id=\"p1\">**</bpt>Object<ept id=\"p1\">**</ept>  <bpt id=\"p2\">*</bpt>o<ept id=\"p2\">*</ept>","source":"**Object**  *o*"},{"content":"Never","pos":[20252,20257]},{"pos":[20262,20310],"content":"<bpt id=\"p1\">**</bpt>Variant<ept id=\"p1\">**</ept>  <bpt id=\"p2\">*</bpt>v<ept id=\"p2\">*</ept> <bpt id=\"p3\">**</bpt>(VT_BYREF<ept id=\"p3\">**</ept> <bpt id=\"p4\">*</bpt>&amp;#124;<ept id=\"p4\">*</ept> <bpt id=\"p5\">**</bpt>VT_)<ept id=\"p5\">**</ept>","source":"**Variant**  *v* **(VT_BYREF** *&#124;* **VT_)**"},{"pos":[20311,20330],"content":"<bpt id=\"p1\">**</bpt>Ref Object<ept id=\"p1\">**</ept>  <bpt id=\"p2\">*</bpt>o<ept id=\"p2\">*</ept>","source":"**Ref Object**  *o*"},{"content":"Only if the type has not changed.","pos":[20331,20364]},{"pos":[20374,20382],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[20386,20447],"content":"<bpt id=\"p1\">[</bpt>Default Marshaling Behavior<ept id=\"p1\">](default-marshaling-behavior.md)</ept>","source":"[Default Marshaling Behavior](default-marshaling-behavior.md)"},{"pos":[20450,20523],"content":"<bpt id=\"p1\">[</bpt>Blittable and Non-Blittable Types<ept id=\"p1\">](blittable-and-non-blittable-types.md)</ept>","source":"[Blittable and Non-Blittable Types](blittable-and-non-blittable-types.md)"},{"pos":[20526,20639],"content":"<bpt id=\"p1\">[</bpt>Directional Attributes<ept id=\"p1\">](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/77e6taeh(v=vs.100))</ept>","source":"[Directional Attributes](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/77e6taeh(v=vs.100))"},{"pos":[20642,20687],"content":"<bpt id=\"p1\">[</bpt>Copying and Pinning<ept id=\"p1\">](copying-and-pinning.md)</ept>","source":"[Copying and Pinning](copying-and-pinning.md)"}]}