{"content":"---\ntitle: \"How to: Configure a Local Issuer\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"WCF, federation\"\n  - \"federation\"\nms.assetid: 15263371-514e-4ea6-90fb-14b4939154cd\n---\n# How to: Configure a Local Issuer\nThis topic describes how to configure a client to use a local issuer for issued tokens.  \n  \n Often, when a client communicates with a federated service, the service specifies the address of the security token service that is expected to issue the token the client will use to authenticate itself to the federated service. In certain situations, the client may be configured to use a *local issuer*.  \n  \n Windows Communication Foundation (WCF) uses a local issuer in cases where the issuer address of a federated binding is `http://schemas.microsoft.com/2005/12/ServiceModel/Addressing/Anonymous` or `null`. In such cases, you must configure the <xref:System.ServiceModel.Description.ClientCredentials> with the address of the local issuer and the binding to use to communicate with that issuer.  \n  \n> [!NOTE]\n>  If the <xref:System.ServiceModel.Description.ClientCredentials.SupportInteractive%2A> property of the `ClientCredentials` class is set to `true`, a local issuer address is not specified, and the issuer address specified by the [\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) or other federated binding is `http://schemas.xmlsoap.org/ws/2005/05/identity/issuer/self`, `http://schemas.microsoft.com/2005/12/ServiceModel/Addressing/Anonymous`, or is `null`, then the Windows [!INCLUDE[infocard](../../../../includes/infocard-md.md)] issuer is used.  \n  \n### To configure the local issuer in code  \n  \n1.  Create a variable of type <xref:System.ServiceModel.Security.IssuedTokenClientCredential>  \n  \n2.  Set the variable to the instance returned from the <xref:System.ServiceModel.Description.ClientCredentials.IssuedToken%2A> property of the `ClientCredentials` class. That instance is returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the client (inherited from <xref:System.ServiceModel.ClientBase%601>) or the <xref:System.ServiceModel.ChannelFactory.Credentials%2A> property of the <xref:System.ServiceModel.ChannelFactory>:  \n  \n     [!code-csharp[c_CreateSTS#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#9)]\n     [!code-vb[c_CreateSTS#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#9)]  \n  \n3.  Set the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerAddress%2A> property to a new instance of the <xref:System.ServiceModel.EndpointAddress>, with the address of the local issuer as an argument to the constructor.  \n  \n     [!code-csharp[c_CreateSTS#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#10)]\n     [!code-vb[c_CreateSTS#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#10)]  \n  \n     Alternatively, create a new <xref:System.Uri> instance as an argument to the constructor.  \n  \n     [!code-csharp[c_CreateSTS#11](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#11)]\n     [!code-vb[c_CreateSTS#11](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#11)]  \n  \n     The `addressHeaders` parameter is an array of <xref:System.ServiceModel.Channels.AddressHeader> instances, as shown.  \n  \n     [!code-csharp[c_CreateSTS#12](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#12)]\n     [!code-vb[c_CreateSTS#12](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#12)]  \n  \n4.  Set the binding for the local issuer using the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerBinding%2A> property.  \n  \n     [!code-csharp[c_CreateSTS#13](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#13)]\n     [!code-vb[c_CreateSTS#13](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#13)]  \n  \n5.  Optional. Add configured endpoint behaviors for the local issuer by adding such behaviors to the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerChannelBehaviors%2A> property.  \n  \n     [!code-csharp[c_CreateSTS#14](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#14)]\n     [!code-vb[c_CreateSTS#14](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#14)]  \n  \n### To configure the local issuer in configuration  \n  \n1.  Create a [\\<localIssuer>](../../../../docs/framework/configure-apps/file-schema/wcf/localissuer.md) element as a child of the [\\<issuedToken>](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtoken.md) element that is itself a child of the [\\<clientCredentials>](../../../../docs/framework/configure-apps/file-schema/wcf/clientcredentials.md) element in an endpoint behavior.  \n  \n2.  Set the `address` attribute to the address of the local issuer that will accept token requests.  \n  \n3.  Set the `binding` and `bindingConfiguration` attributes to values that reference the appropriate binding to use when communicating with the local issuer endpoint.  \n  \n4.  Optional. Set the [\\<identity>](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) element as a child of the <`localIssuer`> element and specify identity information for the local issuer.  \n  \n5.  Optional. Set the [\\<headers>](../../../../docs/framework/configure-apps/file-schema/wcf/headers.md) element as a child of the <`localIssuer`> element and specify additional headers that are required in order to correctly address the local issuer.  \n  \n## .NET Framework Security  \n Note that if an issuer address and binding are specified for a given binding, the local issuer is not used for endpoints that use that binding. Clients who expect to always use the local issuer should ensure that they do not use such a binding or that they modify the binding so that the issuer address is `null`.  \n  \n## See also\n\n- [How to: Configure Credentials on a Federation Service](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md)\n- [How to: Create a Federated Client](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md)\n- [How to: Create a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)\n","nodes":[{"pos":[4,211],"embed":true,"restype":"x-metadata","content":"title: \"How to: Configure a Local Issuer\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"WCF, federation\"\n  - \"federation\"\nms.assetid: 15263371-514e-4ea6-90fb-14b4939154cd","nodes":[{"content":"How to: Configure a Local Issuer","nodes":[{"pos":[0,32],"content":"How to: Configure a Local Issuer","nodes":[{"content":"How to: Configure a Local Issuer","pos":[0,32]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[218,250],"content":"How to: Configure a Local Issuer","linkify":"How to: Configure a Local Issuer","nodes":[{"content":"How to: Configure a Local Issuer","pos":[0,32]}]},{"content":"This topic describes how to configure a client to use a local issuer for issued tokens.","pos":[251,338]},{"content":"Often, when a client communicates with a federated service, the service specifies the address of the security token service that is expected to issue the token the client will use to authenticate itself to the federated service.","pos":[345,573]},{"content":"In certain situations, the client may be configured to use a <bpt id=\"p1\">*</bpt>local issuer<ept id=\"p1\">*</ept>.","pos":[574,650],"source":" In certain situations, the client may be configured to use a *local issuer*."},{"content":"Windows Communication Foundation (WCF) uses a local issuer in cases where the issuer address of a federated binding is <ph id=\"ph1\">`http://schemas.microsoft.com/2005/12/ServiceModel/Addressing/Anonymous`</ph> or <ph id=\"ph2\">`null`</ph>.","pos":[657,859],"source":"Windows Communication Foundation (WCF) uses a local issuer in cases where the issuer address of a federated binding is `http://schemas.microsoft.com/2005/12/ServiceModel/Addressing/Anonymous` or `null`."},{"content":"In such cases, you must configure the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ClientCredentials&gt;</ph> with the address of the local issuer and the binding to use to communicate with that issuer.","pos":[860,1047],"source":" In such cases, you must configure the <xref:System.ServiceModel.Description.ClientCredentials> with the address of the local issuer and the binding to use to communicate with that issuer."},{"pos":[1055,1678],"content":"[!NOTE]\n If the <xref:System.ServiceModel.Description.ClientCredentials.SupportInteractive%2A> property of the `ClientCredentials` class is set to `true`, a local issuer address is not specified, and the issuer address specified by the [\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) or other federated binding is `http://schemas.xmlsoap.org/ws/2005/05/identity/issuer/self`, `http://schemas.microsoft.com/2005/12/ServiceModel/Addressing/Anonymous`, or is `null`, then the Windows [!INCLUDE[infocard](../../../../includes/infocard-md.md)] issuer is used.","leadings":["","> "],"nodes":[{"content":"If the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ClientCredentials.SupportInteractive%2A&gt;</ph> property of the <ph id=\"ph2\">`ClientCredentials`</ph> class is set to <ph id=\"ph3\">`true`</ph>, a local issuer address is not specified, and the issuer address specified by the <bpt id=\"p1\">[</bpt><ph id=\"ph4\">\\&lt;</ph>wsFederationHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md)</ept> or other federated binding is <ph id=\"ph5\">`http://schemas.xmlsoap.org/ws/2005/05/identity/issuer/self`</ph>, <ph id=\"ph6\">`http://schemas.microsoft.com/2005/12/ServiceModel/Addressing/Anonymous`</ph>, or is <ph id=\"ph7\">`null`</ph>, then the Windows <ph id=\"ph8\">[!INCLUDE[infocard](../../../../includes/infocard-md.md)]</ph> issuer is used.","pos":[9,621],"source":"If the <xref:System.ServiceModel.Description.ClientCredentials.SupportInteractive%2A> property of the `ClientCredentials` class is set to `true`, a local issuer address is not specified, and the issuer address specified by the [\\<wsFederationHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wsfederationhttpbinding.md) or other federated binding is `http://schemas.xmlsoap.org/ws/2005/05/identity/issuer/self`, `http://schemas.microsoft.com/2005/12/ServiceModel/Addressing/Anonymous`, or is `null`, then the Windows [!INCLUDE[infocard](../../../../includes/infocard-md.md)] issuer is used."}]},{"pos":[1688,1725],"content":"To configure the local issuer in code","linkify":"To configure the local issuer in code","nodes":[{"content":"To configure the local issuer in code","pos":[0,37]}]},{"pos":[1735,1824],"content":"Create a variable of type <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential&gt;</ph>","source":"Create a variable of type <xref:System.ServiceModel.Security.IssuedTokenClientCredential>"},{"content":"Set the variable to the instance returned from the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ClientCredentials.IssuedToken%2A&gt;</ph> property of the <ph id=\"ph2\">`ClientCredentials`</ph> class.","pos":[1834,1999],"source":"Set the variable to the instance returned from the <xref:System.ServiceModel.Description.ClientCredentials.IssuedToken%2A> property of the `ClientCredentials` class."},{"content":"That instance is returned by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A&gt;</ph> property of the client (inherited from <ph id=\"ph2\">&lt;xref:System.ServiceModel.ClientBase%601&gt;</ph>) or the <ph id=\"ph3\">&lt;xref:System.ServiceModel.ChannelFactory.Credentials%2A&gt;</ph> property of the <ph id=\"ph4\">&lt;xref:System.ServiceModel.ChannelFactory&gt;</ph>:","pos":[2000,2300],"source":" That instance is returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the client (inherited from <xref:System.ServiceModel.ClientBase%601>) or the <xref:System.ServiceModel.ChannelFactory.Credentials%2A> property of the <xref:System.ServiceModel.ChannelFactory>:"},{"pos":[2311,2536],"content":"[!code-csharp[c_CreateSTS#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#9)]\n [!code-vb[c_CreateSTS#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#9)]","leadings":["","    "],"nodes":[]},{"pos":[2546,2789],"content":"Set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerAddress%2A&gt;</ph> property to a new instance of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.EndpointAddress&gt;</ph>, with the address of the local issuer as an argument to the constructor.","source":"Set the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerAddress%2A> property to a new instance of the <xref:System.ServiceModel.EndpointAddress>, with the address of the local issuer as an argument to the constructor."},{"pos":[2800,3029],"content":"[!code-csharp[c_CreateSTS#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#10)]\n [!code-vb[c_CreateSTS#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#10)]","leadings":["","    "],"nodes":[]},{"pos":[3040,3129],"content":"Alternatively, create a new <ph id=\"ph1\">&lt;xref:System.Uri&gt;</ph> instance as an argument to the constructor.","source":"Alternatively, create a new <xref:System.Uri> instance as an argument to the constructor."},{"pos":[3140,3369],"content":"[!code-csharp[c_CreateSTS#11](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#11)]\n [!code-vb[c_CreateSTS#11](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#11)]","leadings":["","    "],"nodes":[]},{"pos":[3380,3496],"content":"The <ph id=\"ph1\">`addressHeaders`</ph> parameter is an array of <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.AddressHeader&gt;</ph> instances, as shown.","source":"The `addressHeaders` parameter is an array of <xref:System.ServiceModel.Channels.AddressHeader> instances, as shown."},{"pos":[3507,3736],"content":"[!code-csharp[c_CreateSTS#12](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#12)]\n [!code-vb[c_CreateSTS#12](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#12)]","leadings":["","    "],"nodes":[]},{"pos":[3746,3888],"content":"Set the binding for the local issuer using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerBinding%2A&gt;</ph> property.","source":"Set the binding for the local issuer using the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerBinding%2A> property."},{"pos":[3899,4128],"content":"[!code-csharp[c_CreateSTS#13](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#13)]\n [!code-vb[c_CreateSTS#13](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#13)]","leadings":["","    "],"nodes":[]},{"content":"Optional.","pos":[4138,4147]},{"content":"Add configured endpoint behaviors for the local issuer by adding such behaviors to the collection returned by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerChannelBehaviors%2A&gt;</ph> property.","pos":[4148,4366],"source":" Add configured endpoint behaviors for the local issuer by adding such behaviors to the collection returned by the <xref:System.ServiceModel.Security.IssuedTokenClientCredential.LocalIssuerChannelBehaviors%2A> property."},{"pos":[4377,4606],"content":"[!code-csharp[c_CreateSTS#14](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_creatests/cs/source.cs#14)]\n [!code-vb[c_CreateSTS#14](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_creatests/vb/source.vb#14)]","leadings":["","    "],"nodes":[]},{"pos":[4616,4662],"content":"To configure the local issuer in configuration","linkify":"To configure the local issuer in configuration","nodes":[{"content":"To configure the local issuer in configuration","pos":[0,46]}]},{"pos":[4672,5062],"content":"Create a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>localIssuer&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/localissuer.md)</ept> element as a child of the <bpt id=\"p2\">[</bpt><ph id=\"ph2\">\\&lt;</ph>issuedToken&gt;<ept id=\"p2\">](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtoken.md)</ept> element that is itself a child of the <bpt id=\"p3\">[</bpt><ph id=\"ph3\">\\&lt;</ph>clientCredentials&gt;<ept id=\"p3\">](../../../../docs/framework/configure-apps/file-schema/wcf/clientcredentials.md)</ept> element in an endpoint behavior.","source":"Create a [\\<localIssuer>](../../../../docs/framework/configure-apps/file-schema/wcf/localissuer.md) element as a child of the [\\<issuedToken>](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtoken.md) element that is itself a child of the [\\<clientCredentials>](../../../../docs/framework/configure-apps/file-schema/wcf/clientcredentials.md) element in an endpoint behavior."},{"pos":[5072,5167],"content":"Set the <ph id=\"ph1\">`address`</ph> attribute to the address of the local issuer that will accept token requests.","source":"Set the `address` attribute to the address of the local issuer that will accept token requests."},{"pos":[5177,5339],"content":"Set the <ph id=\"ph1\">`binding`</ph> and <ph id=\"ph2\">`bindingConfiguration`</ph> attributes to values that reference the appropriate binding to use when communicating with the local issuer endpoint.","source":"Set the `binding` and `bindingConfiguration` attributes to values that reference the appropriate binding to use when communicating with the local issuer endpoint."},{"content":"Optional.","pos":[5349,5358]},{"content":"Set the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>identity&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md)</ept> element as a child of the &lt;<ph id=\"ph2\">`localIssuer`</ph>&gt; element and specify identity information for the local issuer.","pos":[5359,5556],"source":" Set the [\\<identity>](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) element as a child of the <`localIssuer`> element and specify identity information for the local issuer."},{"content":"Optional.","pos":[5566,5575]},{"content":"Set the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>headers&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/headers.md)</ept> element as a child of the &lt;<ph id=\"ph2\">`localIssuer`</ph>&gt; element and specify additional headers that are required in order to correctly address the local issuer.","pos":[5576,5813],"source":" Set the [\\<headers>](../../../../docs/framework/configure-apps/file-schema/wcf/headers.md) element as a child of the <`localIssuer`> element and specify additional headers that are required in order to correctly address the local issuer."},{"pos":[5822,5845],"content":".NET Framework Security","linkify":".NET Framework Security","nodes":[{"content":".NET Framework Security","pos":[0,23]}]},{"content":"Note that if an issuer address and binding are specified for a given binding, the local issuer is not used for endpoints that use that binding.","pos":[5849,5992]},{"content":"Clients who expect to always use the local issuer should ensure that they do not use such a binding or that they modify the binding so that the issuer address is <ph id=\"ph1\">`null`</ph>.","pos":[5993,6162],"source":" Clients who expect to always use the local issuer should ensure that they do not use such a binding or that they modify the binding so that the issuer address is `null`."},{"pos":[6171,6179],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6183,6342],"content":"<bpt id=\"p1\">[</bpt>How to: Configure Credentials on a Federation Service<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md)</ept>","source":"[How to: Configure Credentials on a Federation Service](../../../../docs/framework/wcf/feature-details/how-to-configure-credentials-on-a-federation-service.md)"},{"pos":[6345,6464],"content":"<bpt id=\"p1\">[</bpt>How to: Create a Federated Client<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md)</ept>","source":"[How to: Create a Federated Client](../../../../docs/framework/wcf/feature-details/how-to-create-a-federated-client.md)"},{"pos":[6467,6600],"content":"<bpt id=\"p1\">[</bpt>How to: Create a WSFederationHttpBinding<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)</ept>","source":"[How to: Create a WSFederationHttpBinding](../../../../docs/framework/wcf/feature-details/how-to-create-a-wsfederationhttpbinding.md)"}]}