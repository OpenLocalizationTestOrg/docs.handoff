{"content":"---\ntitle: \"IMetaDataEmit::DefineMethod Method | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\napi_name: \n  - \"IMetaDataEmit.DefineMethod\"\napi_location: \n  - \"mscoree.dll\"\napi_type: \n  - \"COM\"\nf1_keywords: \n  - \"IMetaDataEmit::DefineMethod\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"DefineMethod method [.NET Framework metadata]\"\n  - \"IMetaDataEmit::DefineMethod method [.NET Framework metadata]\"\nms.assetid: 3e2102c5-48b7-4c0e-b805-7e2b5e156e3d\ntopic_type: \n  - \"apiref\"\ncaps.latest.revision: 12\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"\n---\n# IMetaDataEmit::DefineMethod Method\nCreates a definition for a method or global function with the specified signature, and returns a token to that method definition.  \n  \n## Syntax  \n  \n```  \nHRESULT DefineMethod (      \n    [in]  mdTypeDef         td,   \n    [in]  LPCWSTR           szName,   \n    [in]  DWORD             dwMethodFlags,   \n    [in]  PCCOR_SIGNATURE   pvSigBlob,   \n    [in]  ULONG             cbSigBlob,   \n    [in]  ULONG             ulCodeRVA,   \n    [in]  DWORD             dwImplFlags,   \n    [out] mdMethodDef      *pmd  \n);  \n```  \n  \n#### Parameters  \n `td`  \n [in] The `mdTypedef` token of the parent class or parent interface of the method. Set `td` to `mdTokenNil`, if you are defining a global function.  \n  \n `szName`  \n [in] The member name in Unicode.  \n  \n `dwMethodFlags`  \n [in] A value of the [CorMethodAttr](../../../../docs/framework/unmanaged-api/metadata/cormethodattr-enumeration.md) enumeration that specifies the attributes of the method or global function.  \n  \n `pvSigBlob`  \n [in] The method signature. The signature is persisted as supplied. If you need to specify additional information for any parameters, use the [IMetaDataEmit::SetParamProps](../../../../docs/framework/unmanaged-api/metadata/imetadataemit-setparamprops-method.md) method.  \n  \n `cbSigBlob`  \n [in] The count of bytes in `pvSigBlob`.  \n  \n `ulCodeRVA`  \n [in] The address of the code.  \n  \n `dwImplFlags`  \n [in] A value of the [CorMethodImpl](../../../../docs/framework/unmanaged-api/metadata/cormethodimpl-enumeration.md) enumeration that specifies the implementation features of the method.  \n  \n `pmd`  \n [out] The member token.  \n  \n## Remarks  \n The metadata API guarantees to persist methods in the same order as the caller emits them for a given enclosing class or interface, which is specified in the `td` parameter.  \n  \n Additional information regarding the use of `DefineMethod` and particular parameter settings is given below.  \n  \n## Slots in the V-table  \n The runtime uses method definitions to set up v-table slots. In the case where one or more slots need to be skipped, such as to preserve parity with a COM interface layout, a dummy method is defined to take up the slot or slots in the v-table; set the `dwMethodFlags` to the `mdRTSpecialName` value of the [CorMethodAttr](../../../../docs/framework/unmanaged-api/metadata/cormethodattr-enumeration.md) enumeration and specify the name as:  \n  \n _VtblGap\\<*SequenceNumber*>\\<\\_*CountOfSlots*>  \n  \n where *SequenceNumber* is the sequence number of the method and *CountOfSlots* is the number of slots to skip in the v-table. If *CountOfSlots* is omitted, 1 is assumed. These dummy methods are not callable from either managed or unmanaged code and any attempt to call them, from either managed or unmanaged code, generates an exception. Their only purpose is to take up space in the v-table that the runtime generates for COM integration.  \n  \n## Duplicate Methods  \n You should not define duplicate methods. That is, you should not call `DefineMethod` with a duplicate set of values in the `td`, `wzName`, and `pvSig` parameters. (These three parameters together uniquely define the method.). However, you can use a duplicate triple provided that, for one of the method definitions, you set the `mdPrivateScope` bit in the `dwMethodFlags` parameter. (The `mdPrivateScope` bit means that the compiler will not emit a reference to this method definition.)  \n  \n## Method Implementation Information  \n Information about the method implementation is often not known at the time the method is declared. Therefore, you do not need to pass values in the `ulCodeRVA` and `dwImplFlags` parameters when calling `DefineMethod`. The values can be supplied later through [IMetaDataEmit::SetMethodImplFlags](../../../../docs/framework/unmanaged-api/metadata/imetadataemit-setmethodimplflags-method.md) or [IMetaDataEmit::SetRVA](../../../../docs/framework/unmanaged-api/metadata/imetadataemit-setrva-method.md), as appropriate.  \n  \n In some situations, such as platform invocation (PInvoke) or COM interop scenarios, the method body will not be supplied, and `ulCodeRVA` should be set to zero. In these situations, the method should not be tagged as abstract, because the runtime will locate the implementation.  \n  \n## Defining a Method for PInvoke  \n For each unmanaged function to be called through PInvoke, you must define a managed method that represents the target unmanaged function. To define the managed method, use `DefineMethod` with some of the parameters set to certain values, depending on the way in which PInvoke is used:  \n  \n-   True PInvoke - involves invocation of an external unmanaged method that resides in an unmanaged DLL.  \n  \n-   Local PInvoke - involves invocation of a native unmanaged method that is embedded in the current managed module.  \n  \n The parameter settings are given in the following table.  \n  \n|Parameter|Values for true PInvoke|Values for local PInvoke|  \n|---------------|-----------------------------|------------------------------|  \n|`dwMethodFlags`||Set `mdStatic`; clear `mdSynchronized` and `mdAbstract`.|  \n|`pvSigBlob`|A valid common language runtime (CLR) method signature with parameters that are valid managed types.|A valid CLR method signature with parameters that are valid managed types.|  \n|`ulCodeRVA`||0|  \n|`dwImplFlags`|Set `miCil` and `miManaged`.|Set `miNative` and `miUnmanaged`.|  \n  \n## Requirements  \n **Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md).  \n  \n **Header:** Cor.h  \n  \n **Library:** Used as a resource in MSCorEE.dll  \n  \n **.NET Framework Versions:** [!INCLUDE[net_current_v10plus](../../../../includes/net-current-v10plus-md.md)]  \n  \n## See Also  \n [IMetaDataEmit Interface](../../../../docs/framework/unmanaged-api/metadata/imetadataemit-interface.md)   \n [IMetaDataEmit2 Interface](../../../../docs/framework/unmanaged-api/metadata/imetadataemit2-interface.md)","nodes":[{"pos":[4,694],"embed":true,"restype":"x-metadata","content":"title: \"IMetaDataEmit::DefineMethod Method | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\napi_name: \n  - \"IMetaDataEmit.DefineMethod\"\napi_location: \n  - \"mscoree.dll\"\napi_type: \n  - \"COM\"\nf1_keywords: \n  - \"IMetaDataEmit::DefineMethod\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"DefineMethod method [.NET Framework metadata]\"\n  - \"IMetaDataEmit::DefineMethod method [.NET Framework metadata]\"\nms.assetid: 3e2102c5-48b7-4c0e-b805-7e2b5e156e3d\ntopic_type: \n  - \"apiref\"\ncaps.latest.revision: 12\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"","nodes":[{"content":"IMetaDataEmit::DefineMethod Method | Microsoft Docs","nodes":[{"pos":[0,51],"content":"IMetaDataEmit::DefineMethod Method | Microsoft Docs","nodes":[{"content":"IMetaDataEmit::DefineMethod Method | Microsoft Docs","pos":[0,51]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[701,735],"content":"IMetaDataEmit::DefineMethod Method","linkify":"IMetaDataEmit::DefineMethod Method","nodes":[{"content":"IMetaDataEmit::DefineMethod Method","pos":[0,34]}]},{"content":"Creates a definition for a method or global function with the specified signature, and returns a token to that method definition.","pos":[736,865]},{"pos":[874,880],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[1264,1274],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"[in] The <ph id=\"ph1\">`mdTypedef`</ph> token of the parent class or parent interface of the method.","pos":[1286,1367],"source":"[in] The `mdTypedef` token of the parent class or parent interface of the method."},{"content":"Set <ph id=\"ph1\">`td`</ph> to <ph id=\"ph2\">`mdTokenNil`</ph>, if you are defining a global function.","pos":[1368,1432],"source":" Set `td` to `mdTokenNil`, if you are defining a global function."},{"content":"[in] The member name in Unicode.","pos":[1451,1483]},{"content":"[in] A value of the <bpt id=\"p1\">[</bpt>CorMethodAttr<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/metadata/cormethodattr-enumeration.md)</ept> enumeration that specifies the attributes of the method or global function.","pos":[1509,1700],"source":"[in] A value of the [CorMethodAttr](../../../../docs/framework/unmanaged-api/metadata/cormethodattr-enumeration.md) enumeration that specifies the attributes of the method or global function."},{"content":"[in] The method signature.","pos":[1722,1748]},{"content":"The signature is persisted as supplied.","pos":[1749,1788]},{"content":"If you need to specify additional information for any parameters, use the <bpt id=\"p1\">[</bpt>IMetaDataEmit::SetParamProps<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/metadata/imetadataemit-setparamprops-method.md)</ept> method.","pos":[1789,1990],"source":" If you need to specify additional information for any parameters, use the [IMetaDataEmit::SetParamProps](../../../../docs/framework/unmanaged-api/metadata/imetadataemit-setparamprops-method.md) method."},{"content":"[in] The count of bytes in <ph id=\"ph1\">`pvSigBlob`</ph>.","pos":[2012,2051],"source":"[in] The count of bytes in `pvSigBlob`."},{"content":"[in] The address of the code.","pos":[2073,2102]},{"content":"[in] A value of the <bpt id=\"p1\">[</bpt>CorMethodImpl<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/metadata/cormethodimpl-enumeration.md)</ept> enumeration that specifies the implementation features of the method.","pos":[2126,2311],"source":"[in] A value of the [CorMethodImpl](../../../../docs/framework/unmanaged-api/metadata/cormethodimpl-enumeration.md) enumeration that specifies the implementation features of the method."},{"content":"[out] The member token.","pos":[2327,2350]},{"pos":[2359,2366],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"pos":[2370,2543],"content":"The metadata API guarantees to persist methods in the same order as the caller emits them for a given enclosing class or interface, which is specified in the <ph id=\"ph1\">`td`</ph> parameter.","source":"The metadata API guarantees to persist methods in the same order as the caller emits them for a given enclosing class or interface, which is specified in the `td` parameter."},{"pos":[2550,2658],"content":"Additional information regarding the use of <ph id=\"ph1\">`DefineMethod`</ph> and particular parameter settings is given below.","source":"Additional information regarding the use of `DefineMethod` and particular parameter settings is given below."},{"pos":[2667,2687],"content":"Slots in the V-table","linkify":"Slots in the V-table","nodes":[{"content":"Slots in the V-table","pos":[0,20]}]},{"content":"The runtime uses method definitions to set up v-table slots.","pos":[2691,2751]},{"content":"In the case where one or more slots need to be skipped, such as to preserve parity with a COM interface layout, a dummy method is defined to take up the slot or slots in the v-table; set the <ph id=\"ph1\">`dwMethodFlags`</ph> to the <ph id=\"ph2\">`mdRTSpecialName`</ph> value of the <bpt id=\"p1\">[</bpt>CorMethodAttr<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/metadata/cormethodattr-enumeration.md)</ept> enumeration and specify the name as:","pos":[2752,3129],"source":" In the case where one or more slots need to be skipped, such as to preserve parity with a COM interface layout, a dummy method is defined to take up the slot or slots in the v-table; set the `dwMethodFlags` to the `mdRTSpecialName` value of the [CorMethodAttr](../../../../docs/framework/unmanaged-api/metadata/cormethodattr-enumeration.md) enumeration and specify the name as:"},{"pos":[3136,3182],"content":"_VtblGap<ph id=\"ph1\">\\&lt;</ph><bpt id=\"p1\">*</bpt>SequenceNumber<ept id=\"p1\">*</ept><ph id=\"ph2\">&gt;</ph><ph id=\"ph3\">\\&lt;</ph><ph id=\"ph4\">\\_</ph><bpt id=\"p2\">*</bpt>CountOfSlots<ept id=\"p2\">*</ept><ph id=\"ph5\">&gt;</ph>","source":"_VtblGap\\<*SequenceNumber*>\\<\\_*CountOfSlots*>"},{"content":"where <bpt id=\"p1\">*</bpt>SequenceNumber<ept id=\"p1\">*</ept> is the sequence number of the method and <bpt id=\"p2\">*</bpt>CountOfSlots<ept id=\"p2\">*</ept> is the number of slots to skip in the v-table.","pos":[3189,3314],"source":"where *SequenceNumber* is the sequence number of the method and *CountOfSlots* is the number of slots to skip in the v-table."},{"content":"If <bpt id=\"p1\">*</bpt>CountOfSlots<ept id=\"p1\">*</ept> is omitted, 1 is assumed.","pos":[3315,3358],"source":" If *CountOfSlots* is omitted, 1 is assumed."},{"content":"These dummy methods are not callable from either managed or unmanaged code and any attempt to call them, from either managed or unmanaged code, generates an exception.","pos":[3359,3526]},{"content":"Their only purpose is to take up space in the v-table that the runtime generates for COM integration.","pos":[3527,3628]},{"pos":[3637,3654],"content":"Duplicate Methods","linkify":"Duplicate Methods","nodes":[{"content":"Duplicate Methods","pos":[0,17]}]},{"content":"You should not define duplicate methods.","pos":[3658,3698]},{"content":"That is, you should not call <ph id=\"ph1\">`DefineMethod`</ph> with a duplicate set of values in the <ph id=\"ph2\">`td`</ph>, <ph id=\"ph3\">`wzName`</ph>, and <ph id=\"ph4\">`pvSig`</ph> parameters.","pos":[3699,3820],"source":" That is, you should not call `DefineMethod` with a duplicate set of values in the `td`, `wzName`, and `pvSig` parameters."},{"content":"(These three parameters together uniquely define the method.).","pos":[3821,3883]},{"content":"However, you can use a duplicate triple provided that, for one of the method definitions, you set the <ph id=\"ph1\">`mdPrivateScope`</ph> bit in the <ph id=\"ph2\">`dwMethodFlags`</ph> parameter.","pos":[3884,4040],"source":" However, you can use a duplicate triple provided that, for one of the method definitions, you set the `mdPrivateScope` bit in the `dwMethodFlags` parameter."},{"content":"(The <ph id=\"ph1\">`mdPrivateScope`</ph> bit means that the compiler will not emit a reference to this method definition.)","pos":[4041,4144],"source":" (The `mdPrivateScope` bit means that the compiler will not emit a reference to this method definition.)"},{"pos":[4153,4186],"content":"Method Implementation Information","linkify":"Method Implementation Information","nodes":[{"content":"Method Implementation Information","pos":[0,33]}]},{"content":"Information about the method implementation is often not known at the time the method is declared.","pos":[4190,4288]},{"content":"Therefore, you do not need to pass values in the <ph id=\"ph1\">`ulCodeRVA`</ph> and <ph id=\"ph2\">`dwImplFlags`</ph> parameters when calling <ph id=\"ph3\">`DefineMethod`</ph>.","pos":[4289,4407],"source":" Therefore, you do not need to pass values in the `ulCodeRVA` and `dwImplFlags` parameters when calling `DefineMethod`."},{"content":"The values can be supplied later through <bpt id=\"p1\">[</bpt>IMetaDataEmit::SetMethodImplFlags<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/metadata/imetadataemit-setmethodimplflags-method.md)</ept> or <bpt id=\"p2\">[</bpt>IMetaDataEmit::SetRVA<ept id=\"p2\">](../../../../docs/framework/unmanaged-api/metadata/imetadataemit-setrva-method.md)</ept>, as appropriate.","pos":[4408,4704],"source":" The values can be supplied later through [IMetaDataEmit::SetMethodImplFlags](../../../../docs/framework/unmanaged-api/metadata/imetadataemit-setmethodimplflags-method.md) or [IMetaDataEmit::SetRVA](../../../../docs/framework/unmanaged-api/metadata/imetadataemit-setrva-method.md), as appropriate."},{"content":"In some situations, such as platform invocation (PInvoke) or COM interop scenarios, the method body will not be supplied, and <ph id=\"ph1\">`ulCodeRVA`</ph> should be set to zero.","pos":[4711,4871],"source":"In some situations, such as platform invocation (PInvoke) or COM interop scenarios, the method body will not be supplied, and `ulCodeRVA` should be set to zero."},{"content":"In these situations, the method should not be tagged as abstract, because the runtime will locate the implementation.","pos":[4872,4989]},{"pos":[4998,5027],"content":"Defining a Method for PInvoke","linkify":"Defining a Method for PInvoke","nodes":[{"content":"Defining a Method for PInvoke","pos":[0,29]}]},{"content":"For each unmanaged function to be called through PInvoke, you must define a managed method that represents the target unmanaged function.","pos":[5031,5168]},{"content":"To define the managed method, use <ph id=\"ph1\">`DefineMethod`</ph> with some of the parameters set to certain values, depending on the way in which PInvoke is used:","pos":[5169,5315],"source":" To define the managed method, use `DefineMethod` with some of the parameters set to certain values, depending on the way in which PInvoke is used:"},{"content":"True PInvoke - involves invocation of an external unmanaged method that resides in an unmanaged DLL.","pos":[5325,5425]},{"content":"Local PInvoke - involves invocation of a native unmanaged method that is embedded in the current managed module.","pos":[5435,5547]},{"content":"The parameter settings are given in the following table.","pos":[5554,5610]},{"content":"Parameter","pos":[5617,5626]},{"content":"Values for true PInvoke","pos":[5627,5650]},{"content":"Values for local PInvoke","pos":[5651,5675]},{"pos":[5778,5834],"content":"Set <ph id=\"ph1\">`mdStatic`</ph>; clear <ph id=\"ph2\">`mdSynchronized`</ph> and <ph id=\"ph3\">`mdAbstract`</ph>.","source":"Set `mdStatic`; clear `mdSynchronized` and `mdAbstract`."},{"content":"A valid common language runtime (CLR) method signature with parameters that are valid managed types.","pos":[5851,5951]},{"content":"A valid CLR method signature with parameters that are valid managed types.","pos":[5952,6026]},{"content":"0","pos":[6044,6045]},{"pos":[6064,6092],"content":"Set <ph id=\"ph1\">`miCil`</ph> and <ph id=\"ph2\">`miManaged`</ph>.","source":"Set `miCil` and `miManaged`."},{"pos":[6093,6126],"content":"Set <ph id=\"ph1\">`miNative`</ph> and <ph id=\"ph2\">`miUnmanaged`</ph>.","source":"Set `miNative` and `miUnmanaged`."},{"pos":[6136,6148],"content":"Requirements","linkify":"Requirements","nodes":[{"content":"Requirements","pos":[0,12]}]},{"pos":[6152,6256],"content":"<bpt id=\"p1\">**</bpt>Platforms:<ept id=\"p1\">**</ept> See <bpt id=\"p2\">[</bpt>System Requirements<ept id=\"p2\">](../../../../docs/framework/get-started/system-requirements.md)</ept>.","source":"**Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md)."},{"pos":[6263,6280],"content":"<bpt id=\"p1\">**</bpt>Header:<ept id=\"p1\">**</ept> Cor.h","source":"**Header:** Cor.h"},{"pos":[6287,6333],"content":"<bpt id=\"p1\">**</bpt>Library:<ept id=\"p1\">**</ept> Used as a resource in MSCorEE.dll","source":"**Library:** Used as a resource in MSCorEE.dll"},{"pos":[6340,6368],"content":"<bpt id=\"p1\">**</bpt>.NET Framework Versions:<ept id=\"p1\">**</ept>","source":"**.NET Framework Versions:**"},{"pos":[6457,6465],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>IMetaDataEmit Interface<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/metadata/imetadataemit-interface.md)</ept><ph id=\"ph1\"> </ph>","pos":[6469,6573],"source":"[IMetaDataEmit Interface](../../../../docs/framework/unmanaged-api/metadata/imetadataemit-interface.md) "},{"content":"<bpt id=\"p1\">[</bpt>IMetaDataEmit2 Interface<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/metadata/imetadataemit2-interface.md)</ept>","pos":[6577,6682],"source":"[IMetaDataEmit2 Interface](../../../../docs/framework/unmanaged-api/metadata/imetadataemit2-interface.md)"}]}