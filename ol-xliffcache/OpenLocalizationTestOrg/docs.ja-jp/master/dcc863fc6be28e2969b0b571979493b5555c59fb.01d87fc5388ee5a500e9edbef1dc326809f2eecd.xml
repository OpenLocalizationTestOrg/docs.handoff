{"content":"---\ntitle: \"FunctionLeave2 Function | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\napi_name: \n  - \"FunctionLeave2\"\napi_location: \n  - \"mscorwks.dll\"\napi_type: \n  - \"COM\"\nf1_keywords: \n  - \"FunctionLeave2\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"FunctionLeave2 function [.NET Framework profiling]\"\nms.assetid: 8cdac941-8b94-4497-b874-4e571785f3fe\ntopic_type: \n  - \"apiref\"\ncaps.latest.revision: 15\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"\n---\n# FunctionLeave2 Function\nNotifies the profiler that a function is about to return to the caller and provides information about the stack frame and function return value.  \n  \n## Syntax  \n  \n```  \nvoid __stdcall FunctionLeave2 (  \n    [in]  FunctionID                        funcId,  \n    [in]  UINT_PTR                          clientData,  \n    [in]  COR_PRF_FRAME_INFO                func,  \n    [in]  COR_PRF_FUNCTION_ARGUMENT_RANGE  *retvalRange  \n);  \n```  \n  \n#### Parameters  \n `funcId`  \n [in] The identifier of the function that is returning.  \n  \n `clientData`  \n [in] The remapped function identifier, which the profiler previously specified via the [FunctionIDMapper](../../../../docs/framework/unmanaged-api/profiling/functionidmapper-function.md) function.  \n  \n `func`  \n [in] A `COR_PRF_FRAME_INFO` value that points to information about the stack frame.  \n  \n The profiler should treat this as an opaque handle that can be passed back to the execution engine in the [ICorProfilerInfo2::GetFunctionInfo2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-getfunctioninfo2-method.md) method.  \n  \n `retvalRange`  \n [in] A pointer to a [COR_PRF_FUNCTION_ARGUMENT_RANGE](../../../../docs/framework/unmanaged-api/profiling/cor-prf-function-argument-range-structure.md) structure that specifies the memory location of the function's return value.  \n  \n In order to access return value information, the `COR_PRF_ENABLE_FUNCTION_RETVAL` flag must be set. The profiler can use the [ICorProfilerInfo::SetEventMask](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-seteventmask-method.md) method to set the event flags.  \n  \n## Remarks  \n The values of the `func` and `retvalRange` parameters are not valid after the `FunctionLeave2` function returns because the values may change or be destroyed.  \n  \n The `FunctionLeave2` function is a callback; you must implement it. The implementation must use the `__declspec`(`naked`) storage-class attribute.  \n  \n The execution engine does not save any registers before calling this function.  \n  \n-   On entry, you must save all registers that you use, including those in the floating-point unit (FPU).  \n  \n-   On exit, you must restore the stack by popping off all the parameters that were pushed by its caller.  \n  \n The implementation of `FunctionLeave2` should not block because it will delay garbage collection. The implementation should not attempt a garbage collection because the stack may not be in a garbage collection-friendly state. If a garbage collection is attempted, the runtime will block until `FunctionLeave2` returns.  \n  \n Also, the `FunctionLeave2` function must not call into managed code or in any way cause a managed memory allocation.  \n  \n## Requirements  \n **Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md).  \n  \n **Header:** CorProf.idl  \n  \n **Library:** CorGuids.lib  \n  \n **.NET Framework Versions:** [!INCLUDE[net_current_v20plus](../../../../includes/net-current-v20plus-md.md)]  \n  \n## See Also  \n [FunctionEnter2 Function](../../../../docs/framework/unmanaged-api/profiling/functionenter2-function.md)   \n [FunctionTailcall2 Function](../../../../docs/framework/unmanaged-api/profiling/functiontailcall2-function.md)   \n [SetEnterLeaveFunctionHooks2 Method](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-setenterleavefunctionhooks2-method.md)   \n [Profiling Global Static Functions](../../../../docs/framework/unmanaged-api/profiling/profiling-global-static-functions.md)","nodes":[{"pos":[4,597],"embed":true,"restype":"x-metadata","content":"title: \"FunctionLeave2 Function | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\napi_name: \n  - \"FunctionLeave2\"\napi_location: \n  - \"mscorwks.dll\"\napi_type: \n  - \"COM\"\nf1_keywords: \n  - \"FunctionLeave2\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"FunctionLeave2 function [.NET Framework profiling]\"\nms.assetid: 8cdac941-8b94-4497-b874-4e571785f3fe\ntopic_type: \n  - \"apiref\"\ncaps.latest.revision: 15\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"","nodes":[{"content":"FunctionLeave2 Function | Microsoft Docs","nodes":[{"pos":[0,40],"content":"FunctionLeave2 Function | Microsoft Docs","nodes":[{"content":"FunctionLeave2 Function | Microsoft Docs","pos":[0,40]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[604,627],"content":"FunctionLeave2 Function","linkify":"FunctionLeave2 Function","nodes":[{"content":"FunctionLeave2 Function","pos":[0,23]}]},{"content":"Notifies the profiler that a function is about to return to the caller and provides information about the stack frame and function return value.","pos":[628,772]},{"pos":[781,787],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[1074,1084],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"[in] The identifier of the function that is returning.","pos":[1100,1154]},{"content":"[in] The remapped function identifier, which the profiler previously specified via the <bpt id=\"p1\">[</bpt>FunctionIDMapper<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/functionidmapper-function.md)</ept> function.","pos":[1177,1373],"source":"[in] The remapped function identifier, which the profiler previously specified via the [FunctionIDMapper](../../../../docs/framework/unmanaged-api/profiling/functionidmapper-function.md) function."},{"content":"[in] A <ph id=\"ph1\">`COR_PRF_FRAME_INFO`</ph> value that points to information about the stack frame.","pos":[1390,1473],"source":"[in] A `COR_PRF_FRAME_INFO` value that points to information about the stack frame."},{"pos":[1480,1728],"content":"The profiler should treat this as an opaque handle that can be passed back to the execution engine in the <bpt id=\"p1\">[</bpt>ICorProfilerInfo2::GetFunctionInfo2<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-getfunctioninfo2-method.md)</ept> method.","source":"The profiler should treat this as an opaque handle that can be passed back to the execution engine in the [ICorProfilerInfo2::GetFunctionInfo2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-getfunctioninfo2-method.md) method."},{"content":"[in] A pointer to a <bpt id=\"p1\">[</bpt>COR_PRF_FUNCTION_ARGUMENT_RANGE<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/cor-prf-function-argument-range-structure.md)</ept> structure that specifies the memory location of the function's return value.","pos":[1752,1979],"source":"[in] A pointer to a [COR_PRF_FUNCTION_ARGUMENT_RANGE](../../../../docs/framework/unmanaged-api/profiling/cor-prf-function-argument-range-structure.md) structure that specifies the memory location of the function's return value."},{"content":"In order to access return value information, the <ph id=\"ph1\">`COR_PRF_ENABLE_FUNCTION_RETVAL`</ph> flag must be set.","pos":[1986,2085],"source":"In order to access return value information, the `COR_PRF_ENABLE_FUNCTION_RETVAL` flag must be set."},{"content":"The profiler can use the <bpt id=\"p1\">[</bpt>ICorProfilerInfo::SetEventMask<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-seteventmask-method.md)</ept> method to set the event flags.","pos":[2086,2266],"source":" The profiler can use the [ICorProfilerInfo::SetEventMask](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-seteventmask-method.md) method to set the event flags."},{"pos":[2275,2282],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"pos":[2286,2444],"content":"The values of the <ph id=\"ph1\">`func`</ph> and <ph id=\"ph2\">`retvalRange`</ph> parameters are not valid after the <ph id=\"ph3\">`FunctionLeave2`</ph> function returns because the values may change or be destroyed.","source":"The values of the `func` and `retvalRange` parameters are not valid after the `FunctionLeave2` function returns because the values may change or be destroyed."},{"content":"The <ph id=\"ph1\">`FunctionLeave2`</ph> function is a callback; you must implement it.","pos":[2451,2518],"source":"The `FunctionLeave2` function is a callback; you must implement it."},{"content":"The implementation must use the <ph id=\"ph1\">`__declspec`</ph>(<ph id=\"ph2\">`naked`</ph>) storage-class attribute.","pos":[2519,2597],"source":" The implementation must use the `__declspec`(`naked`) storage-class attribute."},{"content":"The execution engine does not save any registers before calling this function.","pos":[2604,2682]},{"content":"On entry, you must save all registers that you use, including those in the floating-point unit (FPU).","pos":[2692,2793]},{"content":"On exit, you must restore the stack by popping off all the parameters that were pushed by its caller.","pos":[2803,2904]},{"content":"The implementation of <ph id=\"ph1\">`FunctionLeave2`</ph> should not block because it will delay garbage collection.","pos":[2911,3008],"source":"The implementation of `FunctionLeave2` should not block because it will delay garbage collection."},{"content":"The implementation should not attempt a garbage collection because the stack may not be in a garbage collection-friendly state.","pos":[3009,3136]},{"content":"If a garbage collection is attempted, the runtime will block until <ph id=\"ph1\">`FunctionLeave2`</ph> returns.","pos":[3137,3229],"source":" If a garbage collection is attempted, the runtime will block until `FunctionLeave2` returns."},{"pos":[3236,3352],"content":"Also, the <ph id=\"ph1\">`FunctionLeave2`</ph> function must not call into managed code or in any way cause a managed memory allocation.","source":"Also, the `FunctionLeave2` function must not call into managed code or in any way cause a managed memory allocation."},{"pos":[3361,3373],"content":"Requirements","linkify":"Requirements","nodes":[{"content":"Requirements","pos":[0,12]}]},{"pos":[3377,3481],"content":"<bpt id=\"p1\">**</bpt>Platforms:<ept id=\"p1\">**</ept> See <bpt id=\"p2\">[</bpt>System Requirements<ept id=\"p2\">](../../../../docs/framework/get-started/system-requirements.md)</ept>.","source":"**Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md)."},{"pos":[3488,3511],"content":"<bpt id=\"p1\">**</bpt>Header:<ept id=\"p1\">**</ept> CorProf.idl","source":"**Header:** CorProf.idl"},{"pos":[3518,3543],"content":"<bpt id=\"p1\">**</bpt>Library:<ept id=\"p1\">**</ept> CorGuids.lib","source":"**Library:** CorGuids.lib"},{"pos":[3550,3578],"content":"<bpt id=\"p1\">**</bpt>.NET Framework Versions:<ept id=\"p1\">**</ept>","source":"**.NET Framework Versions:**"},{"pos":[3667,3675],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>FunctionEnter2 Function<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/functionenter2-function.md)</ept><ph id=\"ph1\"> </ph>","pos":[3679,3784],"source":"[FunctionEnter2 Function](../../../../docs/framework/unmanaged-api/profiling/functionenter2-function.md) "},{"content":"<bpt id=\"p1\">[</bpt>FunctionTailcall2 Function<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/functiontailcall2-function.md)</ept><ph id=\"ph1\"> </ph>","pos":[3788,3899],"source":"[FunctionTailcall2 Function](../../../../docs/framework/unmanaged-api/profiling/functiontailcall2-function.md) "},{"content":"<bpt id=\"p1\">[</bpt>SetEnterLeaveFunctionHooks2 Method<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-setenterleavefunctionhooks2-method.md)</ept><ph id=\"ph1\"> </ph>","pos":[3903,4048],"source":"[SetEnterLeaveFunctionHooks2 Method](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-setenterleavefunctionhooks2-method.md) "},{"content":"<bpt id=\"p1\">[</bpt>Profiling Global Static Functions<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/profiling-global-static-functions.md)</ept>","pos":[4052,4176],"source":"[Profiling Global Static Functions](../../../../docs/framework/unmanaged-api/profiling/profiling-global-static-functions.md)"}]}