{"content":"---\ntitle: \"Workflow services overview - WCF\"\nms.date: \"03/30/2017\"\nms.assetid: e536dda3-e286-441e-99a7-49ddc004b646\n---\n# Workflow services overview\n\nWorkflow services are WCF-based services that are implemented using workflows. Workflow services are workflows that use the messaging activities to send and receive Windows Communication Foundation (WCF) messages. .NET Framework 4.5 introduces a number of messaging activities that allow you send and receive messages from within a workflow. For more information about messaging activities and how they can be used to implement different message exchange patterns, see [Messaging Activities](messaging-activities.md).\n\n## Benefits of using workflow services\n\nAs applications become increasingly distributed, individual services become responsible for calling other services to offload some of the work. Implementing these calls as asynchronous operations introduces some complexity into the code. Error handling adds additional complexity in the form of handling exceptions and providing detailed tracking information. Some services are often long running and can take up valuable system resources while waiting for input. Because of these issues, distributed applications are often very complex and difficult to write and maintain. Workflows are a natural way to express the coordination of asynchronous work, especially calls to external services. Workflows are also effective at representing long-running business processes. It is these qualities that make the workflow a great asset to building services in a distributed environment.\n\n## Implementing a workflow service\n\nWhen implementing a WCF service, you define a number of contracts that describe the service and the data that it sends and receives. The data is represented as data contracts and message contracts. Both WCF and workflow services use data contract and message contract definitions as part of service descriptions. The service itself exposes metadata (in the form of WSDL) to describe the operations of the service. In WCF, service contracts and operation contracts define the service and the operations it supports. However in a workflow service, these contracts are part of the business process itself. They are exposed in metadata by a process called contract inference. When a workflow service is hosted using <xref:System.ServiceModel.Activities.WorkflowServiceHost>, the workflow definition is examined and a contract is generated based on the set of messaging activities found in the workflow. In particular, the following activities and properties are used to generate the contract:\n\n<xref:System.ServiceModel.Activities.Receive> Activity\n\n- <xref:System.ServiceModel.Activities.Receive.ServiceContractName%2A>\n\n- <xref:System.ServiceModel.Activities.Receive.OperationName%2A>\n\n- <xref:System.ServiceModel.Activities.Receive.Action%2A>\n\n<xref:System.ServiceModel.Activities.SendReply> Activity\n\n- <xref:System.ServiceModel.Activities.SendReply.Action%2A>\n\n<xref:System.ServiceModel.Activities.TransactedReceiveScope> Activity\n\nThe end result of contract inference is a description of the service using the same data structures as WCF services and operation contracts. This information is then used to expose WSDL for the workflow service.\n\n> [!NOTE]\n> [!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)] does not allow you to write workflow services using an existing contract definition without some additional tooling support. Workflow service contracts are created by the contract inference process discussed previously. Message contracts and data contracts are fully supported, however.\n\n## Workflow services and MSMQ-based bindings\n\nWCF defines two MSMQ-based bindings <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.  MSMQ-based bindings are often used with workflow services because of the long-running nature of such services. The MSMQ-based bindings have a `ValidityDuration` property that specifies how long MSMQ messages can assume to be valid. Because of the long running nature of workflow services it is possible that the validity duration of a MSMQ message may elapse before the workflow service can process it. It is therefore very important to set the validity duration of a MSMQ binding to an appropriate value. This value must be chosen based on the workflow and how it processes messages. For example if you have a workflow with a <xref:System.ServiceModel.Activities.Receive> activity followed by a custom activity that takes 10 minutes to run, followed by another <xref:System.ServiceModel.Activities.Receive> activity, the correct value for `ValidityDuration` would be greater than 10 minutes.\n\n## Hosting a workflow service\n\nLike WCF services, workflow services must be hosted. WCF services use the <xref:System.ServiceModel.ServiceHost> class to host services and workflow services use <xref:System.ServiceModel.Activities.WorkflowServiceHost> to host services. Like WCF services, workflow services can be hosted in a variety of ways, for example:\n\n- In a managed [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] application.\n\n- In Internet Information Services (IIS).\n\n- In Windows Process Activation Service (WAS).\n\n- In a managed Windows Service.\n\nWorkflow services hosted in a managed [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] application or a managed Windows service create an instance of the <xref:System.ServiceModel.Activities.WorkflowServiceHost> class and pass it an instance of the <xref:System.ServiceModel.Activities.WorkflowService> that contains the workflow definition within the <xref:System.ServiceModel.Activities.WorkflowService.Body%2A> property. A workflow definition that contains messaging activities is exposed as a workflow service.\n\nTo host a workflow service in IIS or WAS, place the .xamlx file that contains the workflow service definition into a virtual directory. A default endpoint (using <xref:System.ServiceModel.BasicHttpBinding>) is created automatically For more information, see [Simplified Configuration](../../../../docs/framework/wcf/simplified-configuration.md). You can also place a Web.config file in the virtual directory to specify your own endpoints. If your workflow definition is in an assembly you can place a .svc file in the virtual directory and the workflow assembly in the App_Code directory. The .svc file must specify the service host factory and the class that implements the workflow service. The following example shows how to specify the service host factory and specify the class that implements the workflow service.\n\n```\n<%@ServiceHost Factory=\" System.ServiceModel.Activities.Activation.WorkflowServiceHostFactory\nService=\"EchoService\"%>\n```","nodes":[{"pos":[4,116],"embed":true,"restype":"x-metadata","content":"title: \"Workflow services overview - WCF\"\nms.date: \"03/30/2017\"\nms.assetid: e536dda3-e286-441e-99a7-49ddc004b646","nodes":[{"content":"Workflow services overview - WCF","nodes":[{"pos":[0,32],"content":"Workflow services overview - WCF","nodes":[{"content":"Workflow services overview - WCF","pos":[0,32]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[123,149],"content":"Workflow services overview","linkify":"Workflow services overview","nodes":[{"content":"Workflow services overview","pos":[0,26]}]},{"content":"Workflow services are WCF-based services that are implemented using workflows.","pos":[151,229]},{"content":"Workflow services are workflows that use the messaging activities to send and receive Windows Communication Foundation (WCF) messages.","pos":[230,364]},{"content":".NET Framework 4.5 introduces a number of messaging activities that allow you send and receive messages from within a workflow.","pos":[365,492]},{"content":"For more information about messaging activities and how they can be used to implement different message exchange patterns, see <bpt id=\"p1\">[</bpt>Messaging Activities<ept id=\"p1\">](messaging-activities.md)</ept>.","pos":[493,668],"source":" For more information about messaging activities and how they can be used to implement different message exchange patterns, see [Messaging Activities](messaging-activities.md)."},{"pos":[673,708],"content":"Benefits of using workflow services","linkify":"Benefits of using workflow services","nodes":[{"content":"Benefits of using workflow services","pos":[0,35]}]},{"content":"As applications become increasingly distributed, individual services become responsible for calling other services to offload some of the work.","pos":[710,853]},{"content":"Implementing these calls as asynchronous operations introduces some complexity into the code.","pos":[854,947]},{"content":"Error handling adds additional complexity in the form of handling exceptions and providing detailed tracking information.","pos":[948,1069]},{"content":"Some services are often long running and can take up valuable system resources while waiting for input.","pos":[1070,1173]},{"content":"Because of these issues, distributed applications are often very complex and difficult to write and maintain.","pos":[1174,1283]},{"content":"Workflows are a natural way to express the coordination of asynchronous work, especially calls to external services.","pos":[1284,1400]},{"content":"Workflows are also effective at representing long-running business processes.","pos":[1401,1478]},{"content":"It is these qualities that make the workflow a great asset to building services in a distributed environment.","pos":[1479,1588]},{"pos":[1593,1624],"content":"Implementing a workflow service","linkify":"Implementing a workflow service","nodes":[{"content":"Implementing a workflow service","pos":[0,31]}]},{"content":"When implementing a WCF service, you define a number of contracts that describe the service and the data that it sends and receives.","pos":[1626,1758]},{"content":"The data is represented as data contracts and message contracts.","pos":[1759,1823]},{"content":"Both WCF and workflow services use data contract and message contract definitions as part of service descriptions.","pos":[1824,1938]},{"content":"The service itself exposes metadata (in the form of WSDL) to describe the operations of the service.","pos":[1939,2039]},{"content":"In WCF, service contracts and operation contracts define the service and the operations it supports.","pos":[2040,2140]},{"content":"However in a workflow service, these contracts are part of the business process itself.","pos":[2141,2228]},{"content":"They are exposed in metadata by a process called contract inference.","pos":[2229,2297]},{"content":"When a workflow service is hosted using <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.WorkflowServiceHost&gt;</ph>, the workflow definition is examined and a contract is generated based on the set of messaging activities found in the workflow.","pos":[2298,2524],"source":" When a workflow service is hosted using <xref:System.ServiceModel.Activities.WorkflowServiceHost>, the workflow definition is examined and a contract is generated based on the set of messaging activities found in the workflow."},{"content":"In particular, the following activities and properties are used to generate the contract:","pos":[2525,2614]},{"pos":[2616,2670],"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> Activity","source":"<xref:System.ServiceModel.Activities.Receive> Activity"},{"pos":[2869,2925],"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph> Activity","source":"<xref:System.ServiceModel.Activities.SendReply> Activity"},{"pos":[2988,3057],"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.TransactedReceiveScope&gt;</ph> Activity","source":"<xref:System.ServiceModel.Activities.TransactedReceiveScope> Activity"},{"content":"The end result of contract inference is a description of the service using the same data structures as WCF services and operation contracts.","pos":[3059,3199]},{"content":"This information is then used to expose WSDL for the workflow service.","pos":[3200,3270]},{"pos":[3274,3650],"content":"[!NOTE]\n[!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)] does not allow you to write workflow services using an existing contract definition without some additional tooling support. Workflow service contracts are created by the contract inference process discussed previously. Message contracts and data contracts are fully supported, however.","leadings":["","> "],"nodes":[{"content":"[!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)] does not allow you to write workflow services using an existing contract definition without some additional tooling support. Workflow service contracts are created by the contract inference process discussed previously. Message contracts and data contracts are fully supported, however.","pos":[8,374],"nodes":[{"content":"<ph id=\"ph1\">[!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)]</ph> does not allow you to write workflow services using an existing contract definition without some additional tooling support.","pos":[0,204],"source":"[!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)] does not allow you to write workflow services using an existing contract definition without some additional tooling support."},{"content":"Workflow service contracts are created by the contract inference process discussed previously.","pos":[205,299]},{"content":"Message contracts and data contracts are fully supported, however.","pos":[300,366]}]}]},{"pos":[3655,3696],"content":"Workflow services and MSMQ-based bindings","linkify":"Workflow services and MSMQ-based bindings","nodes":[{"content":"Workflow services and MSMQ-based bindings","pos":[0,41]}]},{"content":"WCF defines two MSMQ-based bindings <ph id=\"ph1\">&lt;xref:System.ServiceModel.NetMsmqBinding&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding&gt;</ph>.","pos":[3698,3846],"source":"WCF defines two MSMQ-based bindings <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>."},{"content":"MSMQ-based bindings are often used with workflow services because of the long-running nature of such services.","pos":[3848,3958]},{"content":"The MSMQ-based bindings have a <ph id=\"ph1\">`ValidityDuration`</ph> property that specifies how long MSMQ messages can assume to be valid.","pos":[3959,4079],"source":" The MSMQ-based bindings have a `ValidityDuration` property that specifies how long MSMQ messages can assume to be valid."},{"content":"Because of the long running nature of workflow services it is possible that the validity duration of a MSMQ message may elapse before the workflow service can process it.","pos":[4080,4250]},{"content":"It is therefore very important to set the validity duration of a MSMQ binding to an appropriate value.","pos":[4251,4353]},{"content":"This value must be chosen based on the workflow and how it processes messages.","pos":[4354,4432]},{"content":"For example if you have a workflow with a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activity followed by a custom activity that takes 10 minutes to run, followed by another <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activity, the correct value for <ph id=\"ph3\">`ValidityDuration`</ph> would be greater than 10 minutes.","pos":[4433,4740],"source":" For example if you have a workflow with a <xref:System.ServiceModel.Activities.Receive> activity followed by a custom activity that takes 10 minutes to run, followed by another <xref:System.ServiceModel.Activities.Receive> activity, the correct value for `ValidityDuration` would be greater than 10 minutes."},{"pos":[4745,4771],"content":"Hosting a workflow service","linkify":"Hosting a workflow service","nodes":[{"content":"Hosting a workflow service","pos":[0,26]}]},{"content":"Like WCF services, workflow services must be hosted.","pos":[4773,4825]},{"content":"WCF services use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> class to host services and workflow services use <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.WorkflowServiceHost&gt;</ph> to host services.","pos":[4826,5010],"source":" WCF services use the <xref:System.ServiceModel.ServiceHost> class to host services and workflow services use <xref:System.ServiceModel.Activities.WorkflowServiceHost> to host services."},{"content":"Like WCF services, workflow services can be hosted in a variety of ways, for example:","pos":[5011,5096]},{"pos":[5100,5189],"content":"In a managed <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> application.","source":"In a managed [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] application."},{"content":"In Internet Information Services (IIS).","pos":[5193,5232]},{"content":"In Windows Process Activation Service (WAS).","pos":[5236,5280]},{"content":"In a managed Windows Service.","pos":[5284,5313]},{"content":"Workflow services hosted in a managed <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> application or a managed Windows service create an instance of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.WorkflowServiceHost&gt;</ph> class and pass it an instance of the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.WorkflowService&gt;</ph> that contains the workflow definition within the <ph id=\"ph4\">&lt;xref:System.ServiceModel.Activities.WorkflowService.Body%2A&gt;</ph> property.","pos":[5315,5753],"source":"Workflow services hosted in a managed [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] application or a managed Windows service create an instance of the <xref:System.ServiceModel.Activities.WorkflowServiceHost> class and pass it an instance of the <xref:System.ServiceModel.Activities.WorkflowService> that contains the workflow definition within the <xref:System.ServiceModel.Activities.WorkflowService.Body%2A> property."},{"content":"A workflow definition that contains messaging activities is exposed as a workflow service.","pos":[5754,5844]},{"content":"To host a workflow service in IIS or WAS, place the .xamlx file that contains the workflow service definition into a virtual directory.","pos":[5846,5981]},{"content":"A default endpoint (using <ph id=\"ph1\">&lt;xref:System.ServiceModel.BasicHttpBinding&gt;</ph>) is created automatically For more information, see <bpt id=\"p1\">[</bpt>Simplified Configuration<ept id=\"p1\">](../../../../docs/framework/wcf/simplified-configuration.md)</ept>.","pos":[5982,6191],"source":" A default endpoint (using <xref:System.ServiceModel.BasicHttpBinding>) is created automatically For more information, see [Simplified Configuration](../../../../docs/framework/wcf/simplified-configuration.md)."},{"content":"You can also place a Web.config file in the virtual directory to specify your own endpoints.","pos":[6192,6284]},{"content":"If your workflow definition is in an assembly you can place a .svc file in the virtual directory and the workflow assembly in the App_Code directory.","pos":[6285,6434]},{"content":"The .svc file must specify the service host factory and the class that implements the workflow service.","pos":[6435,6538]},{"content":"The following example shows how to specify the service host factory and specify the class that implements the workflow service.","pos":[6539,6666]}]}