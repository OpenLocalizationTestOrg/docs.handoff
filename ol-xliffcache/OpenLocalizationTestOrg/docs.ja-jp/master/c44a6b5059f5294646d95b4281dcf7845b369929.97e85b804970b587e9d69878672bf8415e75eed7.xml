{"content":"---\ntitle: \"Web Hosting a Queued Application\"\nms.date: \"03/30/2017\"\nms.assetid: c7a539fa-e442-4c08-a7f1-17b7f5a03e88\n---\n# Web Hosting a Queued Application\nThe Windows Process Activation Service (WAS) manages the activation and lifetime of the worker processes that contain applications that host Windows Communication Foundation (WCF) services. The WAS process model generalizes the [!INCLUDE[iis601](../../../../includes/iis601-md.md)] process model for the HTTP server by removing the dependency on HTTP. This allows WCF services to use both HTTP and non-HTTP protocols, such as net.msmq and msmq.formatname, in a hosting environment that supports message-based activation and offers the ability to host a large number of applications on a given computer.  \n  \n WAS includes a Message Queuing (MSMQ) activation service that activates a queued application when one or more messages are placed in one of the queues used by the application. The MSMQ activation service is an NT service that is automatically started by default.  \n  \n For more information about WAS and its benefits, see [Hosting in Windows Process Activation Service](../../../../docs/framework/wcf/feature-details/hosting-in-windows-process-activation-service.md). For more information about MSMQ, see [Queues Overview](../../../../docs/framework/wcf/feature-details/queues-overview.md).\n  \n## Queue Addressing in WAS  \n WAS applications have Uniform Resource Identifier (URI) addresses. Application addresses have two parts: a base URI prefix and an application-specific, relative address (path). These two parts provide the external address for an application when joined together. The base URI prefix is constructed from the site binding and is used for all the applications under the site, for example, \"net.msmq://localhost\", \"msmq.formatname://localhost\", or \"net.tcp://localhost\". Application addresses are then constructed by taking application-specific path fragments (such as \"/applicationOne\") and appending them to the base URI prefix to arrive at the full application URI, for example, \"net.msmq://localhost/applicationOne\".  \n  \n The MSMQ activation service uses the application URI to match the queue that the MSMQ activation service must monitor for messages. When the MSMQ activation service starts, it enumerates all public and private queues on the computer it is configured to receive from and monitors them for messages. Every 10 minutes, the MSMQ activation service refreshes the list of queues to monitor. When a message is found in a queue, the activation service matches the queue name to the longest matching application URI for the net.msmq binding and activates the application.  \n  \n> [!NOTE]\n>  The application being activated must match (longest match) the prefix of the queue name.  \n  \n For example, a queue name is: msmqWebHost/orderProcessing/service.svc. If Application 1 has a virtual directory /msmqWebHost/orderProcessing with a service.svc under it, and Application 2 has a virtual directory /msmqWebHost with an orderProcessing.svc under it, Application 1 is activated. If Application 1 is deleted, Application 2 is activated.  \n  \n> [!NOTE]\n>  When a queue is created, any messages sent to it do not activate an application until the MSMQ activation service refreshes the queue list, which is, at most, 10 minutes from the time the queue was created. Restarting the activation service refreshes the queue list as well.  \n  \n### The Effect of Private and Public Queues on Addressing  \n The MSMQ activation service does not distinguish between private and public queue monitoring. As such, you cannot have public and private queues with the same name. If you do, a Web-hosted application may get activated reading from either of the queues.  \n  \n### Queue Configuration for Activation  \n The MSMQ activation service runs as NETWORK SERVICE. It is the service that monitors queues to activate applications. For it to activate applications from the queue, the queue must provide for NETWORK SERVICE access to peek for messages in its access control list (ACL).  \n  \n### Poison Messaging  \n Poison message handling in WCF is handled by the channel, which not only detects that a message is poisoned but selects a disposition based on user configuration. As a result, there is a single message in the queue. The Web-hosted application aborts successive times and the message is moved to a retry queue. At a point dictated by the retry cycle delay, the message is moved from the retry queue to the main queue to try again. But this requires the queued channel to be active. If the application is recycled by WAS, then the message remains in the retry queue until another message arrives in the main queue to activate the queued application. The workaround in this case is to move the message manually from the retry queue back to the main queue to reactivate the application.  \n  \n### Subqueue and System Queue Caveat  \n A WAS-hosted application cannot be activated based on messages in a system queue, such as the system-wide dead-letter queue, or sub-queues, such as poison sub-queues. This is a limitation for this version of the product.  \n  \n## See also\n\n- [Poison Message Handling](../../../../docs/framework/wcf/feature-details/poison-message-handling.md)\n- [Service Endpoints and Queue Addressing](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)\n","nodes":[{"pos":[4,116],"embed":true,"restype":"x-metadata","content":"title: \"Web Hosting a Queued Application\"\nms.date: \"03/30/2017\"\nms.assetid: c7a539fa-e442-4c08-a7f1-17b7f5a03e88","nodes":[{"content":"Web Hosting a Queued Application","nodes":[{"pos":[0,32],"content":"Web Hosting a Queued Application","nodes":[{"content":"Web Hosting a Queued Application","pos":[0,32]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[123,155],"content":"Web Hosting a Queued Application","linkify":"Web Hosting a Queued Application","nodes":[{"content":"Web Hosting a Queued Application","pos":[0,32]}]},{"content":"The Windows Process Activation Service (WAS) manages the activation and lifetime of the worker processes that contain applications that host Windows Communication Foundation (WCF) services.","pos":[156,345]},{"content":"The WAS process model generalizes the <ph id=\"ph1\">[!INCLUDE[iis601](../../../../includes/iis601-md.md)]</ph> process model for the HTTP server by removing the dependency on HTTP.","pos":[346,507],"source":" The WAS process model generalizes the [!INCLUDE[iis601](../../../../includes/iis601-md.md)] process model for the HTTP server by removing the dependency on HTTP."},{"content":"This allows WCF services to use both HTTP and non-HTTP protocols, such as net.msmq and msmq.formatname, in a hosting environment that supports message-based activation and offers the ability to host a large number of applications on a given computer.","pos":[508,758]},{"content":"WAS includes a Message Queuing (MSMQ) activation service that activates a queued application when one or more messages are placed in one of the queues used by the application.","pos":[765,940]},{"content":"The MSMQ activation service is an NT service that is automatically started by default.","pos":[941,1027]},{"content":"For more information about WAS and its benefits, see <bpt id=\"p1\">[</bpt>Hosting in Windows Process Activation Service<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/hosting-in-windows-process-activation-service.md)</ept>.","pos":[1034,1232],"source":"For more information about WAS and its benefits, see [Hosting in Windows Process Activation Service](../../../../docs/framework/wcf/feature-details/hosting-in-windows-process-activation-service.md)."},{"content":"For more information about MSMQ, see <bpt id=\"p1\">[</bpt>Queues Overview<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/queues-overview.md)</ept>.","pos":[1233,1355],"source":" For more information about MSMQ, see [Queues Overview](../../../../docs/framework/wcf/feature-details/queues-overview.md)."},{"pos":[1362,1385],"content":"Queue Addressing in WAS","linkify":"Queue Addressing in WAS","nodes":[{"content":"Queue Addressing in WAS","pos":[0,23]}]},{"content":"WAS applications have Uniform Resource Identifier (URI) addresses.","pos":[1389,1455]},{"content":"Application addresses have two parts: a base URI prefix and an application-specific, relative address (path).","pos":[1456,1565]},{"content":"These two parts provide the external address for an application when joined together.","pos":[1566,1651]},{"content":"The base URI prefix is constructed from the site binding and is used for all the applications under the site, for example, \"net.msmq://localhost\", \"msmq.formatname://localhost\", or \"net.tcp://localhost\".","pos":[1652,1855]},{"content":"Application addresses are then constructed by taking application-specific path fragments (such as \"/applicationOne\") and appending them to the base URI prefix to arrive at the full application URI, for example, \"net.msmq://localhost/applicationOne\".","pos":[1856,2105]},{"content":"The MSMQ activation service uses the application URI to match the queue that the MSMQ activation service must monitor for messages.","pos":[2112,2243]},{"content":"When the MSMQ activation service starts, it enumerates all public and private queues on the computer it is configured to receive from and monitors them for messages.","pos":[2244,2409]},{"content":"Every 10 minutes, the MSMQ activation service refreshes the list of queues to monitor.","pos":[2410,2496]},{"content":"When a message is found in a queue, the activation service matches the queue name to the longest matching application URI for the net.msmq binding and activates the application.","pos":[2497,2674]},{"pos":[2682,2781],"content":"[!NOTE]\n The application being activated must match (longest match) the prefix of the queue name.","leadings":["","> "],"nodes":[{"content":"The application being activated must match (longest match) the prefix of the queue name.","pos":[9,97]}]},{"content":"For example, a queue name is: msmqWebHost/orderProcessing/service.svc.","pos":[2788,2858]},{"content":"If Application 1 has a virtual directory /msmqWebHost/orderProcessing with a service.svc under it, and Application 2 has a virtual directory /msmqWebHost with an orderProcessing.svc under it, Application 1 is activated.","pos":[2859,3078]},{"content":"If Application 1 is deleted, Application 2 is activated.","pos":[3079,3135]},{"pos":[3143,3428],"content":"[!NOTE]\n When a queue is created, any messages sent to it do not activate an application until the MSMQ activation service refreshes the queue list, which is, at most, 10 minutes from the time the queue was created. Restarting the activation service refreshes the queue list as well.","leadings":["","> "],"nodes":[{"content":"When a queue is created, any messages sent to it do not activate an application until the MSMQ activation service refreshes the queue list, which is, at most, 10 minutes from the time the queue was created. Restarting the activation service refreshes the queue list as well.","pos":[9,283],"nodes":[{"content":"When a queue is created, any messages sent to it do not activate an application until the MSMQ activation service refreshes the queue list, which is, at most, 10 minutes from the time the queue was created.","pos":[0,206]},{"content":"Restarting the activation service refreshes the queue list as well.","pos":[207,274]}]}]},{"pos":[3438,3491],"content":"The Effect of Private and Public Queues on Addressing","linkify":"The Effect of Private and Public Queues on Addressing","nodes":[{"content":"The Effect of Private and Public Queues on Addressing","pos":[0,53]}]},{"content":"The MSMQ activation service does not distinguish between private and public queue monitoring.","pos":[3495,3588]},{"content":"As such, you cannot have public and private queues with the same name.","pos":[3589,3659]},{"content":"If you do, a Web-hosted application may get activated reading from either of the queues.","pos":[3660,3748]},{"pos":[3758,3792],"content":"Queue Configuration for Activation","linkify":"Queue Configuration for Activation","nodes":[{"content":"Queue Configuration for Activation","pos":[0,34]}]},{"content":"The MSMQ activation service runs as NETWORK SERVICE.","pos":[3796,3848]},{"content":"It is the service that monitors queues to activate applications.","pos":[3849,3913]},{"content":"For it to activate applications from the queue, the queue must provide for NETWORK SERVICE access to peek for messages in its access control list (ACL).","pos":[3914,4066]},{"pos":[4076,4092],"content":"Poison Messaging","linkify":"Poison Messaging","nodes":[{"content":"Poison Messaging","pos":[0,16]}]},{"content":"Poison message handling in WCF is handled by the channel, which not only detects that a message is poisoned but selects a disposition based on user configuration.","pos":[4096,4258]},{"content":"As a result, there is a single message in the queue.","pos":[4259,4311]},{"content":"The Web-hosted application aborts successive times and the message is moved to a retry queue.","pos":[4312,4405]},{"content":"At a point dictated by the retry cycle delay, the message is moved from the retry queue to the main queue to try again.","pos":[4406,4525]},{"content":"But this requires the queued channel to be active.","pos":[4526,4576]},{"content":"If the application is recycled by WAS, then the message remains in the retry queue until another message arrives in the main queue to activate the queued application.","pos":[4577,4743]},{"content":"The workaround in this case is to move the message manually from the retry queue back to the main queue to reactivate the application.","pos":[4744,4878]},{"pos":[4888,4920],"content":"Subqueue and System Queue Caveat","linkify":"Subqueue and System Queue Caveat","nodes":[{"content":"Subqueue and System Queue Caveat","pos":[0,32]}]},{"content":"A WAS-hosted application cannot be activated based on messages in a system queue, such as the system-wide dead-letter queue, or sub-queues, such as poison sub-queues.","pos":[4924,5090]},{"content":"This is a limitation for this version of the product.","pos":[5091,5144]},{"pos":[5153,5161],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[5165,5265],"content":"<bpt id=\"p1\">[</bpt>Poison Message Handling<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/poison-message-handling.md)</ept>","source":"[Poison Message Handling](../../../../docs/framework/wcf/feature-details/poison-message-handling.md)"},{"pos":[5268,5398],"content":"<bpt id=\"p1\">[</bpt>Service Endpoints and Queue Addressing<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)</ept>","source":"[Service Endpoints and Queue Addressing](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)"}]}