{"content":"---\ntitle: \"Creating Multicasting Applications using the UDP Transport\"\nms.date: \"03/30/2017\"\nms.assetid: 7485154a-6e85-4a67-a9d4-9008e741d4df\n---\n# Creating Multicasting Applications using the UDP Transport\nMulticasting applications send small messages to a large number of recipients at the same time without the need to establish point to point connections. The emphasis of such applications is speed over reliability. In other words, it is more important to send timely data than to ensure any specific message is actually received. WCF now supports writing multicasting applications using the <xref:System.ServiceModel.UdpBinding>. This transport is useful in scenarios where a service needs to send out small messages to a number of clients simultaneously. A stock ticker application is an example of such a service.  \n  \n## Implementing a Multicast Application  \n To implement a multicast application, define a service contract and for each software component that needs to respond to the multicast messages, implement the service contract. For example, a stock ticker application might define a service contract:  \n  \n```csharp\n// Shared contracts between the client and the service  \n[ServiceContract]\ninterface IStockTicker\n{\n    [OperationContract(IsOneWay = true)]\n    void SendStockInfo(StockInfo[] stockInfo);\n}\n\n[DataContract]\nclass StockInfo\n{\n    [DataMember]\n    public string Symbol;\n\n    [DataMember]\n    public float Price;\n\n    public StockInfo(string symbol, float price)\n    {\n        this.Symbol = symbol;\n        this.Price = price;\n    }\n}\n```  \n  \n Each application that wants to receive multicast messages must host a service that exposes this interface.  For example, here is a code sample that illustrates how to receive multicast messages:  \n  \n```csharp\n// Service Address\nstring serviceAddress = \"soap.udp://224.0.0.1:40000\";\n// Binding\nUdpBinding myBinding = new UdpBinding();\n// Host\nServiceHost host = new ServiceHost(typeof(StockTickerService), new Uri(serviceAddress));\n// Add service endpoint\nhost.AddServiceEndpoint(typeof(IStockTicker), myBinding, string.Empty);\n// Openup the service host\nhost.Open();\n\nConsole.WriteLine(\"Start receiving stock information\");\nConsole.ReadLine();\n```  \n  \n The application specifies the UDP address that all services will be listening on. A new <xref:System.ServiceModel.ServiceHost> is created and a service endpoint is exposed using the <xref:System.ServiceModel.UdpBinding>. The <xref:System.ServiceModel.ServiceHost> is then opened and will start listening for incoming messages.  \n  \n In this type of a scenario it is the client that actually sends out multicast messages. Each service that is listening at the correct UDP address will receive the multicast messages. Here is an example of a client that sends out multicast messages:  \n  \n```csharp\n// Multicast Address\nstring serviceAddress = \"soap.udp://224.0.0.1:40000\";\n\n// Binding\nUdpBinding myBinding = new UdpBinding();\n\n// Channel factory\nChannelFactory<IStockTicker> factory \n    = new ChannelFactory<IStockTicker>(myBinding,\n                new EndpointAddress(serviceAddress));\n\n// Call service\nIStockTicker proxy = factory.CreateChannel();\n\nwhile (true)\n{\n    // This will continue to mulicast stock information\n    proxy.SendStockInfo(GetStockInfo());\n    Console.WriteLine($\"sent stock info at {DateTime.Now}\");\n    // Wait for one second before sending another update\n    System.Threading.Thread.Sleep(new TimeSpan(0, 0, 1));\n}\n```  \n  \n This code generates stock information and then uses the service contract IStockTicker to send multicast messages to call services listening on the correct UDP address.  \n  \n### UDP and Reliable Messaging  \n The UDP binding does not support reliable messaging because of the lightweight nature of the UDP protocol. If you need to confirm that messages are received by a remote endpoint, use a transport that supports reliable messaging like  HTTP or TCP. For more information about reliable messaging see https://go.microsoft.com/fwlink/?LinkId=231830  \n  \n### Two-way Multicast Messaging  \n While multicast messages are generally one-way, the UdpBinding does support request/reply message exchange. Messages sent using the UDP transport contain both a From and To address. Care must be taken when using the From address as it could be maliciously changed en-route.  The address can be checked using the following code:  \n  \n```csharp\nif (address.AddressFamily == AddressFamily.InterNetwork)\n{\n    // IPv4\n    byte[] addressBytes = address.GetAddressBytes();\n    return ((addressBytes[0] & 0xE0) == 0xE0);\n}\nelse\n{\n    // IPv6\n    return address.IsIPv6Multicast;\n}\n```  \n  \n This code checks the first byte of the From address to see if it contains 0xE0 which signifies that the address is a multi-cast address.  \n  \n### Security Considerations  \n When listening for multicast messages an ICMP packet is sent to the router notifying it you are listening on the multicast address. Anyone on the local subnet who has permissions could listen for these types of packets and determine which multicast address and port you are listening on.  \n  \n Do not use the IP address of the sender for any security purposes. This information can be spoofed and can cause an application to send responses to the wrong machine. One way to mitigate this threat is to enable message level security. At the network level IPSec  (Internet Protocol Security) and/or NAP (Network Access Protection) could also be used.\n","nodes":[{"pos":[4,142],"embed":true,"restype":"x-metadata","content":"title: \"Creating Multicasting Applications using the UDP Transport\"\nms.date: \"03/30/2017\"\nms.assetid: 7485154a-6e85-4a67-a9d4-9008e741d4df","nodes":[{"content":"Creating Multicasting Applications using the UDP Transport","nodes":[{"pos":[0,58],"content":"Creating Multicasting Applications using the UDP Transport","nodes":[{"content":"Creating Multicasting Applications using the UDP Transport","pos":[0,58]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[149,207],"content":"Creating Multicasting Applications using the UDP Transport","linkify":"Creating Multicasting Applications using the UDP Transport","nodes":[{"content":"Creating Multicasting Applications using the UDP Transport","pos":[0,58]}]},{"content":"Multicasting applications send small messages to a large number of recipients at the same time without the need to establish point to point connections.","pos":[208,360]},{"content":"The emphasis of such applications is speed over reliability.","pos":[361,421]},{"content":"In other words, it is more important to send timely data than to ensure any specific message is actually received.","pos":[422,536]},{"content":"WCF now supports writing multicasting applications using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.UdpBinding&gt;</ph>.","pos":[537,636],"source":" WCF now supports writing multicasting applications using the <xref:System.ServiceModel.UdpBinding>."},{"content":"This transport is useful in scenarios where a service needs to send out small messages to a number of clients simultaneously.","pos":[637,762]},{"content":"A stock ticker application is an example of such a service.","pos":[763,822]},{"pos":[831,867],"content":"Implementing a Multicast Application","linkify":"Implementing a Multicast Application","nodes":[{"content":"Implementing a Multicast Application","pos":[0,36]}]},{"content":"To implement a multicast application, define a service contract and for each software component that needs to respond to the multicast messages, implement the service contract.","pos":[871,1047]},{"content":"For example, a stock ticker application might define a service contract:","pos":[1048,1120]},{"content":"Each application that wants to receive multicast messages must host a service that exposes this interface.","pos":[1577,1683]},{"content":"For example, here is a code sample that illustrates how to receive multicast messages:","pos":[1685,1771]},{"content":"The application specifies the UDP address that all services will be listening on.","pos":[2232,2313]},{"content":"A new <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> is created and a service endpoint is exposed using the <ph id=\"ph2\">&lt;xref:System.ServiceModel.UdpBinding&gt;</ph>.","pos":[2314,2452],"source":" A new <xref:System.ServiceModel.ServiceHost> is created and a service endpoint is exposed using the <xref:System.ServiceModel.UdpBinding>."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> is then opened and will start listening for incoming messages.","pos":[2453,2558],"source":" The <xref:System.ServiceModel.ServiceHost> is then opened and will start listening for incoming messages."},{"content":"In this type of a scenario it is the client that actually sends out multicast messages.","pos":[2565,2652]},{"content":"Each service that is listening at the correct UDP address will receive the multicast messages.","pos":[2653,2747]},{"content":"Here is an example of a client that sends out multicast messages:","pos":[2748,2813]},{"content":"This code generates stock information and then uses the service contract IStockTicker to send multicast messages to call services listening on the correct UDP address.","pos":[3483,3650]},{"pos":[3660,3686],"content":"UDP and Reliable Messaging","linkify":"UDP and Reliable Messaging","nodes":[{"content":"UDP and Reliable Messaging","pos":[0,26]}]},{"content":"The UDP binding does not support reliable messaging because of the lightweight nature of the UDP protocol.","pos":[3690,3796]},{"content":"If you need to confirm that messages are received by a remote endpoint, use a transport that supports reliable messaging like  HTTP or TCP.","pos":[3797,3936]},{"content":"For more information about reliable messaging see <ph id=\"ph1\">https://go.microsoft.com/fwlink/?LinkId=231830</ph>","pos":[3937,4033],"source":" For more information about reliable messaging see https://go.microsoft.com/fwlink/?LinkId=231830"},{"pos":[4043,4070],"content":"Two-way Multicast Messaging","linkify":"Two-way Multicast Messaging","nodes":[{"content":"Two-way Multicast Messaging","pos":[0,27]}]},{"content":"While multicast messages are generally one-way, the UdpBinding does support request/reply message exchange.","pos":[4074,4181]},{"content":"Messages sent using the UDP transport contain both a From and To address.","pos":[4182,4255]},{"content":"Care must be taken when using the From address as it could be maliciously changed en-route.","pos":[4256,4347]},{"content":"The address can be checked using the following code:","pos":[4349,4401]},{"content":"This code checks the first byte of the From address to see if it contains 0xE0 which signifies that the address is a multi-cast address.","pos":[4657,4793]},{"pos":[4803,4826],"content":"Security Considerations","linkify":"Security Considerations","nodes":[{"content":"Security Considerations","pos":[0,23]}]},{"content":"When listening for multicast messages an ICMP packet is sent to the router notifying it you are listening on the multicast address.","pos":[4830,4961]},{"content":"Anyone on the local subnet who has permissions could listen for these types of packets and determine which multicast address and port you are listening on.","pos":[4962,5117]},{"content":"Do not use the IP address of the sender for any security purposes.","pos":[5124,5190]},{"content":"This information can be spoofed and can cause an application to send responses to the wrong machine.","pos":[5191,5291]},{"content":"One way to mitigate this threat is to enable message level security.","pos":[5292,5360]},{"content":"At the network level IPSec  (Internet Protocol Security) and/or NAP (Network Access Protection) could also be used.","pos":[5361,5476]}]}