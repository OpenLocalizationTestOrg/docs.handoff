{"content":"---\ntitle: \"How to: Remotely Survey the Status of Printers\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\n  - \"cpp\"\nhelpviewer_keywords: \n  - \"surveying printer status remotely [WPF]\"\n  - \"printer status [WPF], surveying remotely\"\n  - \"remotely surveying printer status [WPF]\"\n  - \"status [WPF], printers [WPF], surveying remotely\"\nms.assetid: d6324759-8292-4c23-9584-9c708887dc94\n---\n# How to: Remotely Survey the Status of Printers\nAt any given time at medium and large companies there may be multiple printers that are not working due to a paper jam or being out of paper or some other problematic situation. The rich set of printer properties exposed in the [!INCLUDE[TLA#tla_api#plural](../../../../includes/tlasharptla-apisharpplural-md.md)] of Microsoft .NET Framework provide a means for performing a rapid survey of the states of printers.  \n  \n## Example  \n The major steps for creating this kind of utility are as follows.  \n  \n1.  Obtain a list of all print servers.  \n  \n2.  Loop through the servers to query their print queues.  \n  \n3.  Within each pass of the server loop, loop through all the server's queues and read each property that might indicate that the queue is not currently working.  \n  \n The code below is a series of snippets. For simplicity, this example assumes that there is a CRLF-delimited list of print servers. The variable `fileOfPrintServers` is a <xref:System.IO.StreamReader> object for this file. Since each server name is on its own line, any call of <xref:System.IO.StreamReader.ReadLine%2A> gets the name of the next server and moves the <xref:System.IO.StreamReader>'s cursor to the beginning of the next line.  \n  \n Within the outer loop, the code creates a <xref:System.Printing.PrintServer> object for the latest print server and specifies that the application is to have administrative rights to the server.  \n  \n> [!NOTE]\n>  If there are a lot of servers, you can improve performance by using the <xref:System.Printing.PrintServer.%23ctor%28System.String%2CSystem.String%5B%5D%2CSystem.Printing.PrintSystemDesiredAccess%29> constructors that only initialize the properties you are going to need.  \n  \n The example then uses <xref:System.Printing.PrintServer.GetPrintQueues%2A> to create a collection of all of the server's queues and begins to loop through them. This inner loop contains a branching structure corresponding to the two ways of checking a printer's status:  \n  \n-   You can read the flags of the <xref:System.Printing.PrintQueue.QueueStatus%2A> property which is of type <xref:System.Printing.PrintQueueStatus>.  \n  \n-   You can read each relevant property such as <xref:System.Printing.PrintQueue.IsOutOfPaper%2A>, and <xref:System.Printing.PrintQueue.IsPaperJammed%2A>.  \n  \n This example demonstrates both methods, so the user was previously prompted as to which method to use and responded with \"y\" if he or she wanted to use the flags of the <xref:System.Printing.PrintQueue.QueueStatus%2A> property. See below for the details of the two methods.  \n  \n Finally, the results are presented to the user.  \n  \n [!code-cpp[PrinterStatusSurvey#SurveyQueues](~/samples/snippets/cpp/VS_Snippets_Wpf/PrinterStatusSurvey/CPP/Program.cpp#surveyqueues)]\n [!code-csharp[PrinterStatusSurvey#SurveyQueues](~/samples/snippets/csharp/VS_Snippets_Wpf/PrinterStatusSurvey/CSharp/Program.cs#surveyqueues)]\n [!code-vb[PrinterStatusSurvey#SurveyQueues](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PrinterStatusSurvey/visualbasic/program.vb#surveyqueues)]  \n  \n To check printer status using the flags of the <xref:System.Printing.PrintQueue.QueueStatus%2A> property, you check each relevant flag to see if it is set. The standard way to see if one bit is set in a set of bit flags is to perform a logical AND operation with the set of flags as one operand and the flag itself as the other. Since the flag itself has only one bit set, the result of the logical AND is that, at most, that same bit is set. To find out whether it is or not, just compare the result of the logical AND with the flag itself. For more information, see <xref:System.Printing.PrintQueueStatus>, the [& Operator (C# Reference)](~/docs/csharp/language-reference/operators/and-operator.md), and <xref:System.FlagsAttribute>.  \n  \n For each attribute whose bit is set, the code adds a notice to the final report that will be presented to the user. (The **ReportAvailabilityAtThisTime** method that is called at the end of the code is discussed below.)  \n  \n [!code-cpp[PrinterStatusSurvey#SpotTroubleUsingQueueAttributes](~/samples/snippets/cpp/VS_Snippets_Wpf/PrinterStatusSurvey/CPP/Program.cpp#spottroubleusingqueueattributes)]\n [!code-csharp[PrinterStatusSurvey#SpotTroubleUsingQueueAttributes](~/samples/snippets/csharp/VS_Snippets_Wpf/PrinterStatusSurvey/CSharp/Program.cs#spottroubleusingqueueattributes)]\n [!code-vb[PrinterStatusSurvey#SpotTroubleUsingQueueAttributes](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PrinterStatusSurvey/visualbasic/program.vb#spottroubleusingqueueattributes)]  \n  \n To check printer status using each property, you simply read each property and add a note to the final report that will be presented to the user if the property is `true`. (The **ReportAvailabilityAtThisTime** method that is called at the end of the code is discussed below.)  \n  \n [!code-cpp[PrinterStatusSurvey#SpotTroubleUsingQueueProperties](~/samples/snippets/cpp/VS_Snippets_Wpf/PrinterStatusSurvey/CPP/Program.cpp#spottroubleusingqueueproperties)]\n [!code-csharp[PrinterStatusSurvey#SpotTroubleUsingQueueProperties](~/samples/snippets/csharp/VS_Snippets_Wpf/PrinterStatusSurvey/CSharp/Program.cs#spottroubleusingqueueproperties)]\n [!code-vb[PrinterStatusSurvey#SpotTroubleUsingQueueProperties](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PrinterStatusSurvey/visualbasic/program.vb#spottroubleusingqueueproperties)]  \n  \n The **ReportAvailabilityAtThisTime** method was created in case you need to determine if the queue is available at the current time of day.  \n  \n The method will do nothing if the <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> and <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> properties are equal; because in that case the printer is available at all times. If they are different, the method gets the current time which then has to be converted into total minutes past midnight because the <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> and <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> properties are <xref:System.Int32>s representing minutes-after-midnight, not <xref:System.DateTime> objects. Finally, the method checks to see if the current time is between the start and \"until\" times.  \n  \n [!code-cpp[PrinterStatusSurvey#UsingStartAndUntilTimes](~/samples/snippets/cpp/VS_Snippets_Wpf/PrinterStatusSurvey/CPP/Program.cpp#usingstartanduntiltimes)]\n [!code-csharp[PrinterStatusSurvey#UsingStartAndUntilTimes](~/samples/snippets/csharp/VS_Snippets_Wpf/PrinterStatusSurvey/CSharp/Program.cs#usingstartanduntiltimes)]\n [!code-vb[PrinterStatusSurvey#UsingStartAndUntilTimes](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PrinterStatusSurvey/visualbasic/program.vb#usingstartanduntiltimes)]  \n  \n## See also\n\n- <xref:System.Printing.PrintQueue.StartTimeOfDay%2A>\n- <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A>\n- <xref:System.DateTime>\n- <xref:System.Printing.PrintQueueStatus>\n- <xref:System.FlagsAttribute>\n- <xref:System.Printing.PrintServer.GetPrintQueues%2A>\n- <xref:System.Printing.PrintServer>\n- <xref:System.Printing.LocalPrintServer>\n- <xref:System.Printing.EnumeratedPrintQueueTypes>\n- <xref:System.Printing.PrintQueue>\n- [& Operator (C# Reference)](~/docs/csharp/language-reference/operators/and-operator.md)\n- [Documents in WPF](documents-in-wpf.md)\n- [Printing Overview](printing-overview.md)\n","nodes":[{"pos":[4,390],"embed":true,"restype":"x-metadata","content":"title: \"How to: Remotely Survey the Status of Printers\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\n  - \"cpp\"\nhelpviewer_keywords: \n  - \"surveying printer status remotely [WPF]\"\n  - \"printer status [WPF], surveying remotely\"\n  - \"remotely surveying printer status [WPF]\"\n  - \"status [WPF], printers [WPF], surveying remotely\"\nms.assetid: d6324759-8292-4c23-9584-9c708887dc94","nodes":[{"content":"How to: Remotely Survey the Status of Printers","nodes":[{"pos":[0,46],"content":"How to: Remotely Survey the Status of Printers","nodes":[{"content":"How to: Remotely Survey the Status of Printers","pos":[0,46]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[397,443],"content":"How to: Remotely Survey the Status of Printers","linkify":"How to: Remotely Survey the Status of Printers","nodes":[{"content":"How to: Remotely Survey the Status of Printers","pos":[0,46]}]},{"content":"At any given time at medium and large companies there may be multiple printers that are not working due to a paper jam or being out of paper or some other problematic situation.","pos":[444,621]},{"content":"The rich set of printer properties exposed in the <ph id=\"ph1\">[!INCLUDE[TLA#tla_api#plural](../../../../includes/tlasharptla-apisharpplural-md.md)]</ph> of Microsoft .NET Framework provide a means for performing a rapid survey of the states of printers.","pos":[622,858],"source":" The rich set of printer properties exposed in the [!INCLUDE[TLA#tla_api#plural](../../../../includes/tlasharptla-apisharpplural-md.md)] of Microsoft .NET Framework provide a means for performing a rapid survey of the states of printers."},{"pos":[867,874],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The major steps for creating this kind of utility are as follows.","pos":[878,943]},{"content":"Obtain a list of all print servers.","pos":[953,988]},{"content":"Loop through the servers to query their print queues.","pos":[998,1051]},{"content":"Within each pass of the server loop, loop through all the server's queues and read each property that might indicate that the queue is not currently working.","pos":[1061,1218]},{"content":"The code below is a series of snippets.","pos":[1225,1264]},{"content":"For simplicity, this example assumes that there is a CRLF-delimited list of print servers.","pos":[1265,1355]},{"content":"The variable <ph id=\"ph1\">`fileOfPrintServers`</ph> is a <ph id=\"ph2\">&lt;xref:System.IO.StreamReader&gt;</ph> object for this file.","pos":[1356,1446],"source":" The variable `fileOfPrintServers` is a <xref:System.IO.StreamReader> object for this file."},{"content":"Since each server name is on its own line, any call of <ph id=\"ph1\">&lt;xref:System.IO.StreamReader.ReadLine%2A&gt;</ph> gets the name of the next server and moves the <ph id=\"ph2\">&lt;xref:System.IO.StreamReader&gt;</ph>'s cursor to the beginning of the next line.","pos":[1447,1664],"source":" Since each server name is on its own line, any call of <xref:System.IO.StreamReader.ReadLine%2A> gets the name of the next server and moves the <xref:System.IO.StreamReader>'s cursor to the beginning of the next line."},{"pos":[1671,1865],"content":"Within the outer loop, the code creates a <ph id=\"ph1\">&lt;xref:System.Printing.PrintServer&gt;</ph> object for the latest print server and specifies that the application is to have administrative rights to the server.","source":"Within the outer loop, the code creates a <xref:System.Printing.PrintServer> object for the latest print server and specifies that the application is to have administrative rights to the server."},{"pos":[1873,2154],"content":"[!NOTE]\n If there are a lot of servers, you can improve performance by using the <xref:System.Printing.PrintServer.%23ctor%28System.String%2CSystem.String%5B%5D%2CSystem.Printing.PrintSystemDesiredAccess%29> constructors that only initialize the properties you are going to need.","leadings":["","> "],"nodes":[{"content":"If there are a lot of servers, you can improve performance by using the <ph id=\"ph1\">&lt;xref:System.Printing.PrintServer.%23ctor%28System.String%2CSystem.String%5B%5D%2CSystem.Printing.PrintSystemDesiredAccess%29&gt;</ph> constructors that only initialize the properties you are going to need.","pos":[9,279],"source":"If there are a lot of servers, you can improve performance by using the <xref:System.Printing.PrintServer.%23ctor%28System.String%2CSystem.String%5B%5D%2CSystem.Printing.PrintSystemDesiredAccess%29> constructors that only initialize the properties you are going to need."}]},{"content":"The example then uses <ph id=\"ph1\">&lt;xref:System.Printing.PrintServer.GetPrintQueues%2A&gt;</ph> to create a collection of all of the server's queues and begins to loop through them.","pos":[2161,2321],"source":"The example then uses <xref:System.Printing.PrintServer.GetPrintQueues%2A> to create a collection of all of the server's queues and begins to loop through them."},{"content":"This inner loop contains a branching structure corresponding to the two ways of checking a printer's status:","pos":[2322,2430]},{"pos":[2440,2585],"content":"You can read the flags of the <ph id=\"ph1\">&lt;xref:System.Printing.PrintQueue.QueueStatus%2A&gt;</ph> property which is of type <ph id=\"ph2\">&lt;xref:System.Printing.PrintQueueStatus&gt;</ph>.","source":"You can read the flags of the <xref:System.Printing.PrintQueue.QueueStatus%2A> property which is of type <xref:System.Printing.PrintQueueStatus>."},{"pos":[2595,2745],"content":"You can read each relevant property such as <ph id=\"ph1\">&lt;xref:System.Printing.PrintQueue.IsOutOfPaper%2A&gt;</ph>, and <ph id=\"ph2\">&lt;xref:System.Printing.PrintQueue.IsPaperJammed%2A&gt;</ph>.","source":"You can read each relevant property such as <xref:System.Printing.PrintQueue.IsOutOfPaper%2A>, and <xref:System.Printing.PrintQueue.IsPaperJammed%2A>."},{"content":"This example demonstrates both methods, so the user was previously prompted as to which method to use and responded with \"y\" if he or she wanted to use the flags of the <ph id=\"ph1\">&lt;xref:System.Printing.PrintQueue.QueueStatus%2A&gt;</ph> property.","pos":[2752,2979],"source":"This example demonstrates both methods, so the user was previously prompted as to which method to use and responded with \"y\" if he or she wanted to use the flags of the <xref:System.Printing.PrintQueue.QueueStatus%2A> property."},{"content":"See below for the details of the two methods.","pos":[2980,3025]},{"content":"Finally, the results are presented to the user.","pos":[3032,3079]},{"pos":[3086,3514],"content":"[!code-cpp[PrinterStatusSurvey#SurveyQueues](~/samples/snippets/cpp/VS_Snippets_Wpf/PrinterStatusSurvey/CPP/Program.cpp#surveyqueues)]\n[!code-csharp[PrinterStatusSurvey#SurveyQueues](~/samples/snippets/csharp/VS_Snippets_Wpf/PrinterStatusSurvey/CSharp/Program.cs#surveyqueues)]\n[!code-vb[PrinterStatusSurvey#SurveyQueues](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PrinterStatusSurvey/visualbasic/program.vb#surveyqueues)]","leadings":[""," "," "],"nodes":[]},{"content":"To check printer status using the flags of the <ph id=\"ph1\">&lt;xref:System.Printing.PrintQueue.QueueStatus%2A&gt;</ph> property, you check each relevant flag to see if it is set.","pos":[3521,3676],"source":"To check printer status using the flags of the <xref:System.Printing.PrintQueue.QueueStatus%2A> property, you check each relevant flag to see if it is set."},{"content":"The standard way to see if one bit is set in a set of bit flags is to perform a logical AND operation with the set of flags as one operand and the flag itself as the other.","pos":[3677,3849]},{"content":"Since the flag itself has only one bit set, the result of the logical AND is that, at most, that same bit is set.","pos":[3850,3963]},{"content":"To find out whether it is or not, just compare the result of the logical AND with the flag itself.","pos":[3964,4062]},{"content":"For more information, see <ph id=\"ph1\">&lt;xref:System.Printing.PrintQueueStatus&gt;</ph>, the <bpt id=\"p1\">[</bpt>&amp; Operator (C# Reference)<ept id=\"p1\">](~/docs/csharp/language-reference/operators/and-operator.md)</ept>, and <ph id=\"ph2\">&lt;xref:System.FlagsAttribute&gt;</ph>.","pos":[4063,4256],"source":" For more information, see <xref:System.Printing.PrintQueueStatus>, the [& Operator (C# Reference)](~/docs/csharp/language-reference/operators/and-operator.md), and <xref:System.FlagsAttribute>."},{"content":"For each attribute whose bit is set, the code adds a notice to the final report that will be presented to the user.","pos":[4263,4378]},{"content":"(The <bpt id=\"p1\">**</bpt>ReportAvailabilityAtThisTime<ept id=\"p1\">**</ept> method that is called at the end of the code is discussed below.)","pos":[4379,4482],"source":" (The **ReportAvailabilityAtThisTime** method that is called at the end of the code is discussed below.)"},{"pos":[4489,5031],"content":"[!code-cpp[PrinterStatusSurvey#SpotTroubleUsingQueueAttributes](~/samples/snippets/cpp/VS_Snippets_Wpf/PrinterStatusSurvey/CPP/Program.cpp#spottroubleusingqueueattributes)]\n[!code-csharp[PrinterStatusSurvey#SpotTroubleUsingQueueAttributes](~/samples/snippets/csharp/VS_Snippets_Wpf/PrinterStatusSurvey/CSharp/Program.cs#spottroubleusingqueueattributes)]\n[!code-vb[PrinterStatusSurvey#SpotTroubleUsingQueueAttributes](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PrinterStatusSurvey/visualbasic/program.vb#spottroubleusingqueueattributes)]","leadings":[""," "," "],"nodes":[]},{"content":"To check printer status using each property, you simply read each property and add a note to the final report that will be presented to the user if the property is <ph id=\"ph1\">`true`</ph>.","pos":[5038,5209],"source":"To check printer status using each property, you simply read each property and add a note to the final report that will be presented to the user if the property is `true`."},{"content":"(The <bpt id=\"p1\">**</bpt>ReportAvailabilityAtThisTime<ept id=\"p1\">**</ept> method that is called at the end of the code is discussed below.)","pos":[5210,5313],"source":" (The **ReportAvailabilityAtThisTime** method that is called at the end of the code is discussed below.)"},{"pos":[5320,5862],"content":"[!code-cpp[PrinterStatusSurvey#SpotTroubleUsingQueueProperties](~/samples/snippets/cpp/VS_Snippets_Wpf/PrinterStatusSurvey/CPP/Program.cpp#spottroubleusingqueueproperties)]\n[!code-csharp[PrinterStatusSurvey#SpotTroubleUsingQueueProperties](~/samples/snippets/csharp/VS_Snippets_Wpf/PrinterStatusSurvey/CSharp/Program.cs#spottroubleusingqueueproperties)]\n[!code-vb[PrinterStatusSurvey#SpotTroubleUsingQueueProperties](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PrinterStatusSurvey/visualbasic/program.vb#spottroubleusingqueueproperties)]","leadings":[""," "," "],"nodes":[]},{"pos":[5869,6008],"content":"The <bpt id=\"p1\">**</bpt>ReportAvailabilityAtThisTime<ept id=\"p1\">**</ept> method was created in case you need to determine if the queue is available at the current time of day.","source":"The **ReportAvailabilityAtThisTime** method was created in case you need to determine if the queue is available at the current time of day."},{"content":"The method will do nothing if the <ph id=\"ph1\">&lt;xref:System.Printing.PrintQueue.StartTimeOfDay%2A&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Printing.PrintQueue.UntilTimeOfDay%2A&gt;</ph> properties are equal; because in that case the printer is available at all times.","pos":[6015,6238],"source":"The method will do nothing if the <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> and <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> properties are equal; because in that case the printer is available at all times."},{"content":"If they are different, the method gets the current time which then has to be converted into total minutes past midnight because the <ph id=\"ph1\">&lt;xref:System.Printing.PrintQueue.StartTimeOfDay%2A&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Printing.PrintQueue.UntilTimeOfDay%2A&gt;</ph> properties are <ph id=\"ph3\">&lt;xref:System.Int32&gt;</ph>s representing minutes-after-midnight, not <ph id=\"ph4\">&lt;xref:System.DateTime&gt;</ph> objects.","pos":[6239,6587],"source":" If they are different, the method gets the current time which then has to be converted into total minutes past midnight because the <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> and <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> properties are <xref:System.Int32>s representing minutes-after-midnight, not <xref:System.DateTime> objects."},{"content":"Finally, the method checks to see if the current time is between the start and \"until\" times.","pos":[6588,6681]},{"pos":[6688,7182],"content":"[!code-cpp[PrinterStatusSurvey#UsingStartAndUntilTimes](~/samples/snippets/cpp/VS_Snippets_Wpf/PrinterStatusSurvey/CPP/Program.cpp#usingstartanduntiltimes)]\n[!code-csharp[PrinterStatusSurvey#UsingStartAndUntilTimes](~/samples/snippets/csharp/VS_Snippets_Wpf/PrinterStatusSurvey/CSharp/Program.cs#usingstartanduntiltimes)]\n[!code-vb[PrinterStatusSurvey#UsingStartAndUntilTimes](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PrinterStatusSurvey/visualbasic/program.vb#usingstartanduntiltimes)]","leadings":[""," "," "],"nodes":[]},{"pos":[7191,7199],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[7630,7717],"content":"<bpt id=\"p1\">[</bpt>&amp; Operator (C# Reference)<ept id=\"p1\">](~/docs/csharp/language-reference/operators/and-operator.md)</ept>","source":"[& Operator (C# Reference)](~/docs/csharp/language-reference/operators/and-operator.md)"},{"pos":[7720,7759],"content":"<bpt id=\"p1\">[</bpt>Documents in WPF<ept id=\"p1\">](documents-in-wpf.md)</ept>","source":"[Documents in WPF](documents-in-wpf.md)"},{"pos":[7762,7803],"content":"<bpt id=\"p1\">[</bpt>Printing Overview<ept id=\"p1\">](printing-overview.md)</ept>","source":"[Printing Overview](printing-overview.md)"}]}