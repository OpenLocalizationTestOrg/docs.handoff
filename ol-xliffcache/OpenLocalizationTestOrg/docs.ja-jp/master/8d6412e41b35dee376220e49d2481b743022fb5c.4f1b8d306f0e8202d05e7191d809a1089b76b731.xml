{"content":"---\ntitle: \"CorBindToRuntimeEx Function | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\napi_name: \n  - \"CorBindToRuntimeEx\"\napi_location: \n  - \"mscoree.dll\"\n  - \"mscoreei.dll\"\napi_type: \n  - \"DLLExport\"\nf1_keywords: \n  - \"CorBindToRuntimeEx\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"CorBindToRuntimeEx function [.NET Framework hosting]\"\nms.assetid: aae9fb17-5d01-41da-9773-1b5b5b642d81\ntopic_type: \n  - \"apiref\"\ncaps.latest.revision: 41\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# CorBindToRuntimeEx Function\nEnables unmanaged hosts to load the common language runtime (CLR) into a process. The [CorBindToRuntime](../../../../docs/framework/unmanaged-api/hosting/corbindtoruntime-function.md) and `CorBindToRuntimeEx` functions perform the same operation, but the `CorBindToRuntimeEx` function allows you to set flags to specify the behavior of the CLR.  \n  \n This function has been deprecated in the [!INCLUDE[net_v40_long](../../../../includes/net-v40-long-md.md)].  \n  \n This function takes a set of parameters that allow a host to do the following:  \n  \n-   Specify the version of the runtime that will be loaded.  \n  \n-   Indicate whether the server or workstation build should be loaded.  \n  \n-   Control whether concurrent garbage collection or non-concurrent garbage collection is done.  \n  \n> [!NOTE]\n>  Concurrent garbage collection is not supported in applications running the WOW64 x86 emulator on 64-bit systems that implement the Intel Itanium architecture (formerly called IA-64). For more information about using WOW64 on 64-bit Windows systems, see [Running 32-bit Applications](http://msdn.microsoft.com/library/windows/desktop/aa384249.aspx).  \n  \n-   Control whether assemblies are loaded as domain-neutral.  \n  \n-   Obtain an interface pointer to an [ICorRuntimeHost](../../../../docs/framework/unmanaged-api/hosting/icorruntimehost-interface.md) that can be used to set additional options for configuring an instance of the CLR before it is started.  \n  \n## Syntax  \n  \n```  \nHRESULT CorBindToRuntimeEx (  \n    [in]  LPCWSTR      pwszVersion,   \n    [in]  LPCWSTR      pwszBuildFlavor,   \n    [in]  DWORD        startupFlags,   \n    [in]  REFCLSID     rclsid,   \n    [in]  REFIID       riid,   \n    [out] LPVOID FAR  *ppv  \n);  \n```  \n  \n#### Parameters  \n `pwszVersion`  \n [in] A string describing the version of the CLR you want to load.  \n  \n A version number in the .NET Framework consists of four parts separated by periods: *major.minor.build.revision*. The string passed as `pwszVersion` must start with the character \"v\" followed by the first three parts of the version number (for example, \"v1.0.1529\").  \n  \n Some versions of the CLR are installed with a policy statement that specifies compatibility with previous versions of the CLR. By default, the startup shim evaluates `pwszVersion` against policy statements and loads the latest version of the runtime that is compatible with the version being requested. A host can force the shim to skip policy evaluation and load the exact version specified in `pwszVersion` by passing a value of  `STARTUP_LOADER_SAFEMODE` for the `startupFlags` parameter, as described below.  \n  \n If the caller specifies null for `pwszVersion`, `CorBindToRuntimeEx` identifies the set of installed runtimes whose version numbers are lower than the .NET Framework 4 runtime, and loads the latest version of the runtime from that set. It won't load the .NET Framework 4 or later, and fails if no earlier version is installed. Note that passing null gives the host no control over which version of the runtime is loaded. Although this approach may be appropriate in some scenarios, it is strongly recommended that the host supply a specific version to load.  \n  \n `pwszBuildFlavor`  \n [in] A string that specifies whether to load the server or the workstation build of the CLR. Valid values are `svr` and `wks`. The server build is optimized to take advantage of multiple processors for garbage collections, and the workstation build is optimized for client applications running on a single-processor machine.  \n  \n If `pwszBuildFlavor`is set to null, the workstation build is loaded. When running on a single-processor machine, the workstation build is always loaded, even if `pwszBuildFlavor`is set to `svr`. However, if `pwszBuildFlavor`is set to `svr` and concurrent garbage collection is specified (see the description of the `startupFlags` parameter), the server build is loaded.  \n  \n `startupFlags`  \n [in] A combination of values of the [STARTUP_FLAGS](../../../../docs/framework/unmanaged-api/hosting/startup-flags-enumeration.md) enumeration. These flags control concurrent garbage collection, domain-neutral code, and the behavior of the `pwszVersion` parameter. The default is single domain if no flag is set. The following values are valid:  \n  \n-   `STARTUP_CONCURRENT_GC`  \n  \n-   `STARTUP_LOADER_OPTIMIZATION_SINGLE_DOMAIN`  \n  \n-   `STARTUP_LOADER_OPTIMIZATION_MULTI_DOMAIN`  \n  \n-   `STARTUP_LOADER_OPTIMIZATION_MULTI_DOMAIN_HOST`  \n  \n-   `STARTUP_LOADER_SAFEMODE`  \n  \n-   `STARTUP_LEGACY_IMPERSONATION`  \n  \n-   `STARTUP_LOADER_SETPREFERENCE`  \n  \n-   `STARTUP_SERVER_GC`  \n  \n-   `STARTUP_HOARD_GC_VM`  \n  \n-   `STARTUP_SINGLE_VERSION_HOSTING_INTERFACE`  \n  \n-   `STARTUP_LEGACY_IMPERSONATION`  \n  \n-   `STARTUP_DISABLE_COMMITTHREADSTACK`  \n  \n-   `STARTUP_ALWAYSFLOW_IMPERSONATION`  \n  \n For descriptions of these flags, see the [STARTUP_FLAGS](../../../../docs/framework/unmanaged-api/hosting/startup-flags-enumeration.md) enumeration.  \n  \n `rclsid`  \n [in] The `CLSID` of the coclass that implements either the [ICorRuntimeHost](../../../../docs/framework/unmanaged-api/hosting/icorruntimehost-interface.md) or the [ICLRRuntimeHost](../../../../docs/framework/unmanaged-api/hosting/iclrruntimehost-interface.md) interface. Supported values are CLSID_CorRuntimeHost or CLSID_CLRRuntimeHost.  \n  \n `riid`  \n [in] The `IID` of the requested interface from `rclsid`. Supported values are IID_ICorRuntimeHost or IID_ICLRRuntimeHost.  \n  \n `ppv`  \n [out] The returned interface pointer to `riid`.  \n  \n## Remarks  \n If `pwszVersion` specifies a runtime version that does not exist, `CorBindToRuntimeEx` returns an HRESULT value of CLR_E_SHIM_RUNTIMELOAD.  \n  \n## Execution Context and Flow of Windows Identity  \n In version 1 of the CLR, the <xref:System.Security.Principal.WindowsIdentity> object does not flow across asynchronous points such as new threads, thread pools, or timer callbacks. In version 2.0 of the CLR, an <xref:System.Threading.ExecutionContext> object wraps some information about the currently executing thread and flows it across any asynchronous point, but not across application domain boundaries. Similarly, the <xref:System.Security.Principal.WindowsIdentity> object also flows across any asynchronous point. Therefore, the current impersonation on the thread, if any, flows too.  \n  \n You can alter the flow in two ways:  \n  \n1.  By modifying the <xref:System.Threading.ExecutionContext> settings to suppress the flow on a per-thread basis (see the <xref:System.Threading.ExecutionContext.SuppressFlow%2A>, <xref:System.Security.SecurityContext.SuppressFlow%2A>, and <xref:System.Security.SecurityContext.SuppressFlowWindowsIdentity%2A> methods).  \n  \n2.  By changing the process default mode to the version 1 compatibility mode, where the <xref:System.Security.Principal.WindowsIdentity> object does not flow across any asynchronous point, regardless of the <xref:System.Threading.ExecutionContext> settings on the current thread. How you change the default mode depends on whether you use a managed executable or an unmanaged hosting interface to load the CLR:  \n  \n    1.  For managed executables, you must set the `enabled` attribute of the [\\<legacyImpersonationPolicy>](../../../../docs/framework/configure-apps/file-schema/runtime/legacyimpersonationpolicy-element.md) element to `true`.  \n  \n    2.  For unmanaged hosting interfaces, set the `STARTUP_LEGACY_IMPERSONATION` flag in the `startupFlags` parameter when calling the `CorBindToRuntimeEx` function.  \n  \n     The version 1 compatibility mode applies to the entire process and to all the application domains in the process.  \n  \n## Requirements  \n **Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md).  \n  \n **Header:** MSCorEE.h  \n  \n **Library:** MSCorEE.dll  \n  \n **.NET Framework Versions:** [!INCLUDE[net_current_v10plus](../../../../includes/net-current-v10plus-md.md)]  \n  \n## See Also  \n [CorBindToCurrentRuntime Function](../../../../docs/framework/unmanaged-api/hosting/corbindtocurrentruntime-function.md)   \n [CorBindToRuntime Function](../../../../docs/framework/unmanaged-api/hosting/corbindtoruntime-function.md)   \n [CorBindToRuntimeByCfg Function](../../../../docs/framework/unmanaged-api/hosting/corbindtoruntimebycfg-function.md)   \n [CorBindToRuntimeHost Function](../../../../docs/framework/unmanaged-api/hosting/corbindtoruntimehost-function.md)   \n [ICorRuntimeHost Interface](../../../../docs/framework/unmanaged-api/hosting/icorruntimehost-interface.md)   \n [Deprecated CLR Hosting Functions](../../../../docs/framework/unmanaged-api/hosting/deprecated-clr-hosting-functions.md)","nodes":[{"pos":[4,638],"embed":true,"restype":"x-metadata","content":"title: \"CorBindToRuntimeEx Function | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\napi_name: \n  - \"CorBindToRuntimeEx\"\napi_location: \n  - \"mscoree.dll\"\n  - \"mscoreei.dll\"\napi_type: \n  - \"DLLExport\"\nf1_keywords: \n  - \"CorBindToRuntimeEx\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"CorBindToRuntimeEx function [.NET Framework hosting]\"\nms.assetid: aae9fb17-5d01-41da-9773-1b5b5b642d81\ntopic_type: \n  - \"apiref\"\ncaps.latest.revision: 41\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"","nodes":[{"content":"CorBindToRuntimeEx Function | Microsoft Docs","nodes":[{"pos":[0,44],"content":"CorBindToRuntimeEx Function | Microsoft Docs","nodes":[{"content":"CorBindToRuntimeEx Function | Microsoft Docs","pos":[0,44]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[645,672],"content":"CorBindToRuntimeEx Function","linkify":"CorBindToRuntimeEx Function","nodes":[{"content":"CorBindToRuntimeEx Function","pos":[0,27]}]},{"content":"Enables unmanaged hosts to load the common language runtime (CLR) into a process.","pos":[673,754]},{"content":"The <bpt id=\"p1\">[</bpt>CorBindToRuntime<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/hosting/corbindtoruntime-function.md)</ept> and <ph id=\"ph1\">`CorBindToRuntimeEx`</ph> functions perform the same operation, but the <ph id=\"ph2\">`CorBindToRuntimeEx`</ph> function allows you to set flags to specify the behavior of the CLR.","pos":[755,1017],"source":" The [CorBindToRuntime](../../../../docs/framework/unmanaged-api/hosting/corbindtoruntime-function.md) and `CorBindToRuntimeEx` functions perform the same operation, but the `CorBindToRuntimeEx` function allows you to set flags to specify the behavior of the CLR."},{"pos":[1024,1131],"content":"This function has been deprecated in the <ph id=\"ph1\">[!INCLUDE[net_v40_long](../../../../includes/net-v40-long-md.md)]</ph>.","source":"This function has been deprecated in the [!INCLUDE[net_v40_long](../../../../includes/net-v40-long-md.md)]."},{"content":"This function takes a set of parameters that allow a host to do the following:","pos":[1138,1216]},{"content":"Specify the version of the runtime that will be loaded.","pos":[1226,1281]},{"content":"Indicate whether the server or workstation build should be loaded.","pos":[1291,1357]},{"content":"Control whether concurrent garbage collection or non-concurrent garbage collection is done.","pos":[1367,1458]},{"pos":[1466,1825],"content":"[!NOTE]\n Concurrent garbage collection is not supported in applications running the WOW64 x86 emulator on 64-bit systems that implement the Intel Itanium architecture (formerly called IA-64). For more information about using WOW64 on 64-bit Windows systems, see [Running 32-bit Applications](http://msdn.microsoft.com/library/windows/desktop/aa384249.aspx).","leadings":["","> "],"nodes":[{"content":"Concurrent garbage collection is not supported in applications running the WOW64 x86 emulator on 64-bit systems that implement the Intel Itanium architecture (formerly called IA-64). For more information about using WOW64 on 64-bit Windows systems, see [Running 32-bit Applications](http://msdn.microsoft.com/library/windows/desktop/aa384249.aspx).","pos":[9,357],"nodes":[{"content":"Concurrent garbage collection is not supported in applications running the WOW64 x86 emulator on 64-bit systems that implement the Intel Itanium architecture (formerly called IA-64).","pos":[0,182]},{"content":"For more information about using WOW64 on 64-bit Windows systems, see <bpt id=\"p1\">[</bpt>Running 32-bit Applications<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa384249.aspx)</ept>.","pos":[183,348],"source":" For more information about using WOW64 on 64-bit Windows systems, see [Running 32-bit Applications](http://msdn.microsoft.com/library/windows/desktop/aa384249.aspx)."}]}]},{"content":"Control whether assemblies are loaded as domain-neutral.","pos":[1835,1891]},{"pos":[1901,2135],"content":"Obtain an interface pointer to an <bpt id=\"p1\">[</bpt>ICorRuntimeHost<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/hosting/icorruntimehost-interface.md)</ept> that can be used to set additional options for configuring an instance of the CLR before it is started.","source":"Obtain an interface pointer to an [ICorRuntimeHost](../../../../docs/framework/unmanaged-api/hosting/icorruntimehost-interface.md) that can be used to set additional options for configuring an instance of the CLR before it is started."},{"pos":[2144,2150],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[2429,2439],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"[in] A string describing the version of the CLR you want to load.","pos":[2460,2525]},{"content":"A version number in the .NET Framework consists of four parts separated by periods: <bpt id=\"p1\">*</bpt>major.minor.build.revision<ept id=\"p1\">*</ept>.","pos":[2532,2645],"source":"A version number in the .NET Framework consists of four parts separated by periods: *major.minor.build.revision*."},{"content":"The string passed as <ph id=\"ph1\">`pwszVersion`</ph> must start with the character \"v\" followed by the first three parts of the version number (for example, \"v1.0.1529\").","pos":[2646,2798],"source":" The string passed as `pwszVersion` must start with the character \"v\" followed by the first three parts of the version number (for example, \"v1.0.1529\")."},{"content":"Some versions of the CLR are installed with a policy statement that specifies compatibility with previous versions of the CLR.","pos":[2805,2931]},{"content":"By default, the startup shim evaluates <ph id=\"ph1\">`pwszVersion`</ph> against policy statements and loads the latest version of the runtime that is compatible with the version being requested.","pos":[2932,3107],"source":" By default, the startup shim evaluates `pwszVersion` against policy statements and loads the latest version of the runtime that is compatible with the version being requested."},{"content":"A host can force the shim to skip policy evaluation and load the exact version specified in <ph id=\"ph1\">`pwszVersion`</ph> by passing a value of  <ph id=\"ph2\">`STARTUP_LOADER_SAFEMODE`</ph> for the <ph id=\"ph3\">`startupFlags`</ph> parameter, as described below.","pos":[3108,3316],"source":" A host can force the shim to skip policy evaluation and load the exact version specified in `pwszVersion` by passing a value of  `STARTUP_LOADER_SAFEMODE` for the `startupFlags` parameter, as described below."},{"content":"If the caller specifies null for <ph id=\"ph1\">`pwszVersion`</ph>, <ph id=\"ph2\">`CorBindToRuntimeEx`</ph> identifies the set of installed runtimes whose version numbers are lower than the .NET Framework 4 runtime, and loads the latest version of the runtime from that set.","pos":[3323,3558],"source":"If the caller specifies null for `pwszVersion`, `CorBindToRuntimeEx` identifies the set of installed runtimes whose version numbers are lower than the .NET Framework 4 runtime, and loads the latest version of the runtime from that set."},{"content":"It won't load the .NET Framework 4 or later, and fails if no earlier version is installed.","pos":[3559,3649]},{"content":"Note that passing null gives the host no control over which version of the runtime is loaded.","pos":[3650,3743]},{"content":"Although this approach may be appropriate in some scenarios, it is strongly recommended that the host supply a specific version to load.","pos":[3744,3880]},{"content":"[in] A string that specifies whether to load the server or the workstation build of the CLR.","pos":[3908,4000]},{"content":"Valid values are <ph id=\"ph1\">`svr`</ph> and <ph id=\"ph2\">`wks`</ph>.","pos":[4001,4034],"source":" Valid values are `svr` and `wks`."},{"content":"The server build is optimized to take advantage of multiple processors for garbage collections, and the workstation build is optimized for client applications running on a single-processor machine.","pos":[4035,4232]},{"content":"If <ph id=\"ph1\">`pwszBuildFlavor`</ph>is set to null, the workstation build is loaded.","pos":[4239,4307],"source":"If `pwszBuildFlavor`is set to null, the workstation build is loaded."},{"content":"When running on a single-processor machine, the workstation build is always loaded, even if <ph id=\"ph1\">`pwszBuildFlavor`</ph>is set to <ph id=\"ph2\">`svr`</ph>.","pos":[4308,4433],"source":" When running on a single-processor machine, the workstation build is always loaded, even if `pwszBuildFlavor`is set to `svr`."},{"content":"However, if <ph id=\"ph1\">`pwszBuildFlavor`</ph>is set to <ph id=\"ph2\">`svr`</ph> and concurrent garbage collection is specified (see the description of the <ph id=\"ph3\">`startupFlags`</ph> parameter), the server build is loaded.","pos":[4434,4608],"source":" However, if `pwszBuildFlavor`is set to `svr` and concurrent garbage collection is specified (see the description of the `startupFlags` parameter), the server build is loaded."},{"content":"[in] A combination of values of the <bpt id=\"p1\">[</bpt>STARTUP_FLAGS<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/hosting/startup-flags-enumeration.md)</ept> enumeration.","pos":[4633,4776],"source":"[in] A combination of values of the [STARTUP_FLAGS](../../../../docs/framework/unmanaged-api/hosting/startup-flags-enumeration.md) enumeration."},{"content":"These flags control concurrent garbage collection, domain-neutral code, and the behavior of the <ph id=\"ph1\">`pwszVersion`</ph> parameter.","pos":[4777,4897],"source":" These flags control concurrent garbage collection, domain-neutral code, and the behavior of the `pwszVersion` parameter."},{"content":"The default is single domain if no flag is set.","pos":[4898,4945]},{"content":"The following values are valid:","pos":[4946,4977]},{"pos":[5535,5683],"content":"For descriptions of these flags, see the <bpt id=\"p1\">[</bpt>STARTUP_FLAGS<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/hosting/startup-flags-enumeration.md)</ept> enumeration.","source":"For descriptions of these flags, see the [STARTUP_FLAGS](../../../../docs/framework/unmanaged-api/hosting/startup-flags-enumeration.md) enumeration."},{"pos":[5690,6039],"content":"`rclsid`  \n[in] The `CLSID` of the coclass that implements either the [ICorRuntimeHost](../../../../docs/framework/unmanaged-api/hosting/icorruntimehost-interface.md) or the [ICLRRuntimeHost](../../../../docs/framework/unmanaged-api/hosting/iclrruntimehost-interface.md) interface. Supported values are CLSID_CorRuntimeHost or CLSID_CLRRuntimeHost.","leadings":[""," "],"nodes":[{"content":"[in] The `CLSID` of the coclass that implements either the [ICorRuntimeHost](../../../../docs/framework/unmanaged-api/hosting/icorruntimehost-interface.md) or the [ICLRRuntimeHost](../../../../docs/framework/unmanaged-api/hosting/iclrruntimehost-interface.md) interface. Supported values are CLSID_CorRuntimeHost or CLSID_CLRRuntimeHost.","pos":[11,348],"nodes":[{"content":"[in] The <ph id=\"ph1\">`CLSID`</ph> of the coclass that implements either the <bpt id=\"p1\">[</bpt>ICorRuntimeHost<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/hosting/icorruntimehost-interface.md)</ept> or the <bpt id=\"p2\">[</bpt>ICLRRuntimeHost<ept id=\"p2\">](../../../../docs/framework/unmanaged-api/hosting/iclrruntimehost-interface.md)</ept> interface.","pos":[0,270],"source":"[in] The `CLSID` of the coclass that implements either the [ICorRuntimeHost](../../../../docs/framework/unmanaged-api/hosting/icorruntimehost-interface.md) or the [ICLRRuntimeHost](../../../../docs/framework/unmanaged-api/hosting/iclrruntimehost-interface.md) interface."},{"content":"Supported values are CLSID_CorRuntimeHost or CLSID_CLRRuntimeHost.","pos":[271,337]}]}]},{"pos":[6046,6177],"content":"`riid`  \n[in] The `IID` of the requested interface from `rclsid`. Supported values are IID_ICorRuntimeHost or IID_ICLRRuntimeHost.","leadings":[""," "],"nodes":[{"content":"[in] The `IID` of the requested interface from `rclsid`. Supported values are IID_ICorRuntimeHost or IID_ICLRRuntimeHost.","pos":[9,130],"nodes":[{"content":"[in] The <ph id=\"ph1\">`IID`</ph> of the requested interface from <ph id=\"ph2\">`rclsid`</ph>.","pos":[0,56],"source":"[in] The `IID` of the requested interface from `rclsid`."},{"content":"Supported values are IID_ICorRuntimeHost or IID_ICLRRuntimeHost.","pos":[57,121]}]}]},{"pos":[6184,6240],"content":"`ppv`  \n[out] The returned interface pointer to `riid`.","leadings":[""," "],"nodes":[{"content":"[out] The returned interface pointer to <ph id=\"ph1\">`riid`</ph>.","pos":[8,55],"source":"[out] The returned interface pointer to `riid`."}]},{"pos":[6249,6256],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"pos":[6260,6398],"content":"If <ph id=\"ph1\">`pwszVersion`</ph> specifies a runtime version that does not exist, <ph id=\"ph2\">`CorBindToRuntimeEx`</ph> returns an HRESULT value of CLR_E_SHIM_RUNTIMELOAD.","source":"If `pwszVersion` specifies a runtime version that does not exist, `CorBindToRuntimeEx` returns an HRESULT value of CLR_E_SHIM_RUNTIMELOAD."},{"pos":[6407,6453],"content":"Execution Context and Flow of Windows Identity","linkify":"Execution Context and Flow of Windows Identity","nodes":[{"content":"Execution Context and Flow of Windows Identity","pos":[0,46]}]},{"content":"In version 1 of the CLR, the <ph id=\"ph1\">&lt;xref:System.Security.Principal.WindowsIdentity&gt;</ph> object does not flow across asynchronous points such as new threads, thread pools, or timer callbacks.","pos":[6457,6637],"source":"In version 1 of the CLR, the <xref:System.Security.Principal.WindowsIdentity> object does not flow across asynchronous points such as new threads, thread pools, or timer callbacks."},{"content":"In version 2.0 of the CLR, an <ph id=\"ph1\">&lt;xref:System.Threading.ExecutionContext&gt;</ph> object wraps some information about the currently executing thread and flows it across any asynchronous point, but not across application domain boundaries.","pos":[6638,6865],"source":" In version 2.0 of the CLR, an <xref:System.Threading.ExecutionContext> object wraps some information about the currently executing thread and flows it across any asynchronous point, but not across application domain boundaries."},{"content":"Similarly, the <ph id=\"ph1\">&lt;xref:System.Security.Principal.WindowsIdentity&gt;</ph> object also flows across any asynchronous point.","pos":[6866,6978],"source":" Similarly, the <xref:System.Security.Principal.WindowsIdentity> object also flows across any asynchronous point."},{"content":"Therefore, the current impersonation on the thread, if any, flows too.","pos":[6979,7049]},{"content":"You can alter the flow in two ways:","pos":[7056,7091]},{"content":"By modifying the <ph id=\"ph1\">&lt;xref:System.Threading.ExecutionContext&gt;</ph> settings to suppress the flow on a per-thread basis (see the <ph id=\"ph2\">&lt;xref:System.Threading.ExecutionContext.SuppressFlow%2A&gt;</ph>, <ph id=\"ph3\">&lt;xref:System.Security.SecurityContext.SuppressFlow%2A&gt;</ph>, and <ph id=\"ph4\">&lt;xref:System.Security.SecurityContext.SuppressFlowWindowsIdentity%2A&gt;</ph> methods).","pos":[7101,7417],"source":"By modifying the <xref:System.Threading.ExecutionContext> settings to suppress the flow on a per-thread basis (see the <xref:System.Threading.ExecutionContext.SuppressFlow%2A>, <xref:System.Security.SecurityContext.SuppressFlow%2A>, and <xref:System.Security.SecurityContext.SuppressFlowWindowsIdentity%2A> methods)."},{"content":"By changing the process default mode to the version 1 compatibility mode, where the <ph id=\"ph1\">&lt;xref:System.Security.Principal.WindowsIdentity&gt;</ph> object does not flow across any asynchronous point, regardless of the <ph id=\"ph2\">&lt;xref:System.Threading.ExecutionContext&gt;</ph> settings on the current thread.","pos":[7427,7702],"source":"By changing the process default mode to the version 1 compatibility mode, where the <xref:System.Security.Principal.WindowsIdentity> object does not flow across any asynchronous point, regardless of the <xref:System.Threading.ExecutionContext> settings on the current thread."},{"content":"How you change the default mode depends on whether you use a managed executable or an unmanaged hosting interface to load the CLR:","pos":[7703,7833]},{"pos":[7847,8065],"content":"For managed executables, you must set the <ph id=\"ph1\">`enabled`</ph> attribute of the <bpt id=\"p1\">[</bpt><ph id=\"ph2\">\\&lt;</ph>legacyImpersonationPolicy&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/runtime/legacyimpersonationpolicy-element.md)</ept> element to <ph id=\"ph3\">`true`</ph>.","source":"For managed executables, you must set the `enabled` attribute of the [\\<legacyImpersonationPolicy>](../../../../docs/framework/configure-apps/file-schema/runtime/legacyimpersonationpolicy-element.md) element to `true`."},{"pos":[8079,8236],"content":"For unmanaged hosting interfaces, set the <ph id=\"ph1\">`STARTUP_LEGACY_IMPERSONATION`</ph> flag in the <ph id=\"ph2\">`startupFlags`</ph> parameter when calling the <ph id=\"ph3\">`CorBindToRuntimeEx`</ph> function.","source":"For unmanaged hosting interfaces, set the `STARTUP_LEGACY_IMPERSONATION` flag in the `startupFlags` parameter when calling the `CorBindToRuntimeEx` function."},{"content":"The version 1 compatibility mode applies to the entire process and to all the application domains in the process.","pos":[8247,8360]},{"pos":[8369,8381],"content":"Requirements","linkify":"Requirements","nodes":[{"content":"Requirements","pos":[0,12]}]},{"pos":[8385,8489],"content":"<bpt id=\"p1\">**</bpt>Platforms:<ept id=\"p1\">**</ept> See <bpt id=\"p2\">[</bpt>System Requirements<ept id=\"p2\">](../../../../docs/framework/get-started/system-requirements.md)</ept>.","source":"**Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md)."},{"pos":[8496,8517],"content":"<bpt id=\"p1\">**</bpt>Header:<ept id=\"p1\">**</ept> MSCorEE.h","source":"**Header:** MSCorEE.h"},{"pos":[8524,8548],"content":"<bpt id=\"p1\">**</bpt>Library:<ept id=\"p1\">**</ept> MSCorEE.dll","source":"**Library:** MSCorEE.dll"},{"pos":[8555,8583],"content":"<bpt id=\"p1\">**</bpt>.NET Framework Versions:<ept id=\"p1\">**</ept>","source":"**.NET Framework Versions:**"},{"pos":[8672,8680],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>CorBindToCurrentRuntime Function<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/hosting/corbindtocurrentruntime-function.md)</ept><ph id=\"ph1\"> </ph>","pos":[8684,8805],"source":"[CorBindToCurrentRuntime Function](../../../../docs/framework/unmanaged-api/hosting/corbindtocurrentruntime-function.md) "},{"content":"<bpt id=\"p1\">[</bpt>CorBindToRuntime Function<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/hosting/corbindtoruntime-function.md)</ept><ph id=\"ph1\"> </ph>","pos":[8809,8916],"source":"[CorBindToRuntime Function](../../../../docs/framework/unmanaged-api/hosting/corbindtoruntime-function.md) "},{"content":"<bpt id=\"p1\">[</bpt>CorBindToRuntimeByCfg Function<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/hosting/corbindtoruntimebycfg-function.md)</ept><ph id=\"ph1\"> </ph>","pos":[8920,9037],"source":"[CorBindToRuntimeByCfg Function](../../../../docs/framework/unmanaged-api/hosting/corbindtoruntimebycfg-function.md) "},{"content":"<bpt id=\"p1\">[</bpt>CorBindToRuntimeHost Function<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/hosting/corbindtoruntimehost-function.md)</ept><ph id=\"ph1\"> </ph>","pos":[9041,9156],"source":"[CorBindToRuntimeHost Function](../../../../docs/framework/unmanaged-api/hosting/corbindtoruntimehost-function.md) "},{"content":"<bpt id=\"p1\">[</bpt>ICorRuntimeHost Interface<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/hosting/icorruntimehost-interface.md)</ept><ph id=\"ph1\"> </ph>","pos":[9160,9267],"source":"[ICorRuntimeHost Interface](../../../../docs/framework/unmanaged-api/hosting/icorruntimehost-interface.md) "},{"content":"<bpt id=\"p1\">[</bpt>Deprecated CLR Hosting Functions<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/hosting/deprecated-clr-hosting-functions.md)</ept>","pos":[9271,9391],"source":"[Deprecated CLR Hosting Functions](../../../../docs/framework/unmanaged-api/hosting/deprecated-clr-hosting-functions.md)"}]}