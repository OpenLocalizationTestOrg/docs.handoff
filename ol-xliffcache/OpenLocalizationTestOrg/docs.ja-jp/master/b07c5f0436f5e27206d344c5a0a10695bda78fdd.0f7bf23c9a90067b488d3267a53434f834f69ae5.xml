{"content":"---\ntitle: \"Correlation Overview | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: edcc0315-5d26-44d6-a36d-ea554c418e9f\ncaps.latest.revision: 12\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Correlation Overview\nCorrelation is the mechanism for relating workflow service messages to each other or to the application instance state, such as a reply to an initial request, or a particular order ID to the persisted state of an order-processing workflow. This topic provides an overview of correlation. The other topics in this section provide additional information for each type of correlation.  \n  \n## Types of Correlation  \n Correlation can be protocol-based or content-based. Protocol-based correlations use data provided by the message delivery infrastructure to provide the mapping between messages. Messages that are correlated using protocol-based correlation are related to each other using an object in memory, such as a <xref:System.ServiceModel.Channels.RequestContext>, or by a token provided by the transport protocol. Content-based correlations relate messages to each other using application-specified data. Messages that are correlated using content-based correlation are related to each other by some application-defined data in the message, such as a customer number.  \n  \n Activities that participate in correlation use a <xref:System.ServiceModel.Activities.CorrelationHandle> to tie the messaging activities together. For example, a <xref:System.ServiceModel.Activities.Send> that is used to call a service and a subsequent <xref:System.ServiceModel.Activities.Receive> that is used to receive a callback from the service, share the same <xref:System.ServiceModel.Activities.CorrelationHandle>. This basic pattern is used whether the correlation is content based or protocol based. The correlation handle can be explicitly set on each activity or the activities can be contained in a <xref:System.ServiceModel.Activities.CorrelationScope> activity. Activities contained in a <xref:System.ServiceModel.Activities.CorrelationScope> have their correlation handles managed by the <xref:System.ServiceModel.Activities.CorrelationScope> and do not require the <xref:System.ServiceModel.Activities.CorrelationHandle> to be explicitly set. A <xref:System.ServiceModel.Activities.CorrelationScope> scope provides <xref:System.ServiceModel.Activities.CorrelationHandle> management for a request-reply correlation and one additional correlation type. Workflow services hosted using <xref:System.ServiceModel.Activities.WorkflowServiceHost> have the same default correlation management as the <xref:System.ServiceModel.Activities.CorrelationScope> activity. This default correlation management generally means that in many scenarios, messaging activities in a <xref:System.ServiceModel.Activities.CorrelationScope> or a workflow service do not require their <xref:System.ServiceModel.Activities.CorrelationHandle> set unless multiple messaging activities are in parallel or overlap, such as two <xref:System.ServiceModel.Activities.Receive> activities in parallel, or two <xref:System.ServiceModel.Activities.Send> activities followed by two <xref:System.ServiceModel.Activities.Receive> activities. More information about default correlation is provided in the topics in this section that cover each specific type of correlation. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] messaging activities see [Messaging Activities](../../../../docs/framework/wcf/feature-details/messaging-activities.md) and [How to: Create a Workflow Service with Messaging Activities](../../../../docs/framework/wcf/feature-details/how-to-create-a-workflow-service-with-messaging-activities.md).  \n  \n## Protocol-Based Correlation  \n Protocol-based correlation uses the transport mechanism to relate messages to each other and the appropriate instance. Some system-provided protocol correlations include request-reply correlation and context-based correlation. A request-reply correlation is used to correlate a single pair of messaging activities to form a two-way operation, such as a <xref:System.ServiceModel.Activities.Send> paired with a <xref:System.ServiceModel.Activities.ReceiveReply>, or a <xref:System.ServiceModel.Activities.Receive> paired with a <xref:System.ServiceModel.Activities.SendReply>. The [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] Workflow Designer also provides a set of activity templates to quickly implement this pattern. A context-based correlation is based on the context exchange mechanism described in the [.NET Context Exchange Protocol Specification](http://go.microsoft.com/fwlink/?LinkID=166059). To use context-based correlation, a context-based binding such as <xref:System.ServiceModel.BasicHttpContextBinding>, <xref:System.ServiceModel.WSHttpContextBinding> or <xref:System.ServiceModel.NetTcpContextBinding> must be used on the endpoint.  \n  \n [!INCLUDE[crabout](../../../../includes/crabout-md.md)] protocol correlation, see [Context Exchange](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md), [Durable Duplex](../../../../docs/framework/wcf/feature-details/durable-duplex-correlation.md), and [Request-Reply](../../../../docs/framework/wcf/feature-details/request-reply-correlation.md). [!INCLUDE[crabout](../../../../includes/crabout-md.md)] using the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] Workflow Designer activity templates, see [Messaging Activities](../../../../docs/framework/wcf/feature-details/messaging-activities.md). For sample code, see the [Durable Duplex &#91;WF Samples&#93;](../../../../docs/framework/windows-workflow-foundation/samples/durable-duplex.md) and [NetContextExchangeCorrelation](http://msdn.microsoft.com/en-us/93c74a1a-b9e2-46c6-95c0-c9b0e9472caf) samples.  \n  \n## Content-Based Correlation  \n Content-based correlation uses some piece of information in the message to associate it to a particular instance. Unlike protocol-based correlation, content-based correlation requires the application author to explicitly state where this data can be found in each related message. Activities that use content-based correlation specify this message data by using a <xref:System.ServiceModel.MessageQuerySet>. Content-based correlation is useful when communicating with services that do not use one of the context bindings such as <xref:System.ServiceModel.BasicHttpContextBinding>. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] content-based correlation, see [Content Based](../../../../docs/framework/wcf/feature-details/content-based-correlation.md). For sample code, see the [Content-Based Correlation](../../../../docs/framework/windows-workflow-foundation/samples/content-based-correlation.md) and [Correlated Calculator](../../../../docs/framework/windows-workflow-foundation/samples/correlated-calculator.md) samples.  \n  \n## See Also  \n [Content-Based Correlation](../../../../docs/framework/windows-workflow-foundation/samples/content-based-correlation.md)   \n [Correlated Calculator](../../../../docs/framework/windows-workflow-foundation/samples/correlated-calculator.md)   \n [Durable Duplex &#91;WF Samples&#93;](../../../../docs/framework/windows-workflow-foundation/samples/durable-duplex.md)   \n [NetContextExchangeCorrelation](http://msdn.microsoft.com/en-us/93c74a1a-b9e2-46c6-95c0-c9b0e9472caf)","nodes":[{"pos":[4,341],"embed":true,"restype":"x-metadata","content":"title: \"Correlation Overview | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: edcc0315-5d26-44d6-a36d-ea554c418e9f\ncaps.latest.revision: 12\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"","nodes":[{"content":"Correlation Overview | Microsoft Docs","nodes":[{"pos":[0,37],"content":"Correlation Overview | Microsoft Docs","nodes":[{"content":"Correlation Overview | Microsoft Docs","pos":[0,37]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[348,368],"content":"Correlation Overview","linkify":"Correlation Overview","nodes":[{"content":"Correlation Overview","pos":[0,20]}]},{"content":"Correlation is the mechanism for relating workflow service messages to each other or to the application instance state, such as a reply to an initial request, or a particular order ID to the persisted state of an order-processing workflow.","pos":[369,608]},{"content":"This topic provides an overview of correlation.","pos":[609,656]},{"content":"The other topics in this section provide additional information for each type of correlation.","pos":[657,750]},{"pos":[759,779],"content":"Types of Correlation","linkify":"Types of Correlation","nodes":[{"content":"Types of Correlation","pos":[0,20]}]},{"content":"Correlation can be protocol-based or content-based.","pos":[783,834]},{"content":"Protocol-based correlations use data provided by the message delivery infrastructure to provide the mapping between messages.","pos":[835,960]},{"content":"Messages that are correlated using protocol-based correlation are related to each other using an object in memory, such as a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.RequestContext&gt;</ph>, or by a token provided by the transport protocol.","pos":[961,1187],"source":" Messages that are correlated using protocol-based correlation are related to each other using an object in memory, such as a <xref:System.ServiceModel.Channels.RequestContext>, or by a token provided by the transport protocol."},{"content":"Content-based correlations relate messages to each other using application-specified data.","pos":[1188,1278]},{"content":"Messages that are correlated using content-based correlation are related to each other by some application-defined data in the message, such as a customer number.","pos":[1279,1441]},{"content":"Activities that participate in correlation use a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.CorrelationHandle&gt;</ph> to tie the messaging activities together.","pos":[1448,1594],"source":"Activities that participate in correlation use a <xref:System.ServiceModel.Activities.CorrelationHandle> to tie the messaging activities together."},{"content":"For example, a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> that is used to call a service and a subsequent <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> that is used to receive a callback from the service, share the same <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.CorrelationHandle&gt;</ph>.","pos":[1595,1871],"source":" For example, a <xref:System.ServiceModel.Activities.Send> that is used to call a service and a subsequent <xref:System.ServiceModel.Activities.Receive> that is used to receive a callback from the service, share the same <xref:System.ServiceModel.Activities.CorrelationHandle>."},{"content":"This basic pattern is used whether the correlation is content based or protocol based.","pos":[1872,1958]},{"content":"The correlation handle can be explicitly set on each activity or the activities can be contained in a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.CorrelationScope&gt;</ph> activity.","pos":[1959,2125],"source":" The correlation handle can be explicitly set on each activity or the activities can be contained in a <xref:System.ServiceModel.Activities.CorrelationScope> activity."},{"content":"Activities contained in a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.CorrelationScope&gt;</ph> have their correlation handles managed by the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.CorrelationScope&gt;</ph> and do not require the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.CorrelationHandle&gt;</ph> to be explicitly set.","pos":[2126,2408],"source":" Activities contained in a <xref:System.ServiceModel.Activities.CorrelationScope> have their correlation handles managed by the <xref:System.ServiceModel.Activities.CorrelationScope> and do not require the <xref:System.ServiceModel.Activities.CorrelationHandle> to be explicitly set."},{"content":"A <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.CorrelationScope&gt;</ph> scope provides <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.CorrelationHandle&gt;</ph> management for a request-reply correlation and one additional correlation type.","pos":[2409,2616],"source":" A <xref:System.ServiceModel.Activities.CorrelationScope> scope provides <xref:System.ServiceModel.Activities.CorrelationHandle> management for a request-reply correlation and one additional correlation type."},{"content":"Workflow services hosted using <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.WorkflowServiceHost&gt;</ph> have the same default correlation management as the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.CorrelationScope&gt;</ph> activity.","pos":[2617,2822],"source":" Workflow services hosted using <xref:System.ServiceModel.Activities.WorkflowServiceHost> have the same default correlation management as the <xref:System.ServiceModel.Activities.CorrelationScope> activity."},{"content":"This default correlation management generally means that in many scenarios, messaging activities in a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.CorrelationScope&gt;</ph> or a workflow service do not require their <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.CorrelationHandle&gt;</ph> set unless multiple messaging activities are in parallel or overlap, such as two <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activities in parallel, or two <ph id=\"ph4\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> activities followed by two <ph id=\"ph5\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activities.","pos":[2823,3364],"source":" This default correlation management generally means that in many scenarios, messaging activities in a <xref:System.ServiceModel.Activities.CorrelationScope> or a workflow service do not require their <xref:System.ServiceModel.Activities.CorrelationHandle> set unless multiple messaging activities are in parallel or overlap, such as two <xref:System.ServiceModel.Activities.Receive> activities in parallel, or two <xref:System.ServiceModel.Activities.Send> activities followed by two <xref:System.ServiceModel.Activities.Receive> activities."},{"content":"More information about default correlation is provided in the topics in this section that cover each specific type of correlation.","pos":[3365,3495]},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> messaging activities see <bpt id=\"p1\">[</bpt>Messaging Activities<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/messaging-activities.md)</ept> and <bpt id=\"p2\">[</bpt>How to: Create a Workflow Service with Messaging Activities<ept id=\"p2\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-workflow-service-with-messaging-activities.md)</ept>.","pos":[3496,3848],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] messaging activities see [Messaging Activities](../../../../docs/framework/wcf/feature-details/messaging-activities.md) and [How to: Create a Workflow Service with Messaging Activities](../../../../docs/framework/wcf/feature-details/how-to-create-a-workflow-service-with-messaging-activities.md)."},{"pos":[3857,3883],"content":"Protocol-Based Correlation","linkify":"Protocol-Based Correlation","nodes":[{"content":"Protocol-Based Correlation","pos":[0,26]}]},{"content":"Protocol-based correlation uses the transport mechanism to relate messages to each other and the appropriate instance.","pos":[3887,4005]},{"content":"Some system-provided protocol correlations include request-reply correlation and context-based correlation.","pos":[4006,4113]},{"content":"A request-reply correlation is used to correlate a single pair of messaging activities to form a two-way operation, such as a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> paired with a <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.ReceiveReply&gt;</ph>, or a <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> paired with a <ph id=\"ph4\">&lt;xref:System.ServiceModel.Activities.SendReply&gt;</ph>.","pos":[4114,4462],"source":" A request-reply correlation is used to correlate a single pair of messaging activities to form a two-way operation, such as a <xref:System.ServiceModel.Activities.Send> paired with a <xref:System.ServiceModel.Activities.ReceiveReply>, or a <xref:System.ServiceModel.Activities.Receive> paired with a <xref:System.ServiceModel.Activities.SendReply>."},{"content":"The <ph id=\"ph1\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph> Workflow Designer also provides a set of activity templates to quickly implement this pattern.","pos":[4463,4633],"source":" The [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] Workflow Designer also provides a set of activity templates to quickly implement this pattern."},{"content":"A context-based correlation is based on the context exchange mechanism described in the <bpt id=\"p1\">[</bpt>.NET Context Exchange Protocol Specification<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkID=166059)</ept>.","pos":[4634,4816],"source":" A context-based correlation is based on the context exchange mechanism described in the [.NET Context Exchange Protocol Specification](http://go.microsoft.com/fwlink/?LinkID=166059)."},{"content":"To use context-based correlation, a context-based binding such as <ph id=\"ph1\">&lt;xref:System.ServiceModel.BasicHttpContextBinding&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.ServiceModel.WSHttpContextBinding&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.ServiceModel.NetTcpContextBinding&gt;</ph> must be used on the endpoint.","pos":[4817,5063],"source":" To use context-based correlation, a context-based binding such as <xref:System.ServiceModel.BasicHttpContextBinding>, <xref:System.ServiceModel.WSHttpContextBinding> or <xref:System.ServiceModel.NetTcpContextBinding> must be used on the endpoint."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> protocol correlation, see <bpt id=\"p1\">[</bpt>Context Exchange<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md)</ept>, <bpt id=\"p2\">[</bpt>Durable Duplex<ept id=\"p2\">](../../../../docs/framework/wcf/feature-details/durable-duplex-correlation.md)</ept>, and <bpt id=\"p3\">[</bpt>Request-Reply<ept id=\"p3\">](../../../../docs/framework/wcf/feature-details/request-reply-correlation.md)</ept>.","pos":[5070,5445],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] protocol correlation, see [Context Exchange](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md), [Durable Duplex](../../../../docs/framework/wcf/feature-details/durable-duplex-correlation.md), and [Request-Reply](../../../../docs/framework/wcf/feature-details/request-reply-correlation.md)."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> using the <ph id=\"ph2\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph> Workflow Designer activity templates, see <bpt id=\"p1\">[</bpt>Messaging Activities<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/messaging-activities.md)</ept>.","pos":[5446,5721],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] using the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] Workflow Designer activity templates, see [Messaging Activities](../../../../docs/framework/wcf/feature-details/messaging-activities.md)."},{"content":"For sample code, see the <bpt id=\"p1\">[</bpt>Durable Duplex &amp;#91;WF Samples&amp;#93;<ept id=\"p1\">](../../../../docs/framework/windows-workflow-foundation/samples/durable-duplex.md)</ept> and <bpt id=\"p2\">[</bpt>NetContextExchangeCorrelation<ept id=\"p2\">](http://msdn.microsoft.com/en-us/93c74a1a-b9e2-46c6-95c0-c9b0e9472caf)</ept> samples.","pos":[5722,5981],"source":" For sample code, see the [Durable Duplex &#91;WF Samples&#93;](../../../../docs/framework/windows-workflow-foundation/samples/durable-duplex.md) and [NetContextExchangeCorrelation](http://msdn.microsoft.com/en-us/93c74a1a-b9e2-46c6-95c0-c9b0e9472caf) samples."},{"pos":[5990,6015],"content":"Content-Based Correlation","linkify":"Content-Based Correlation","nodes":[{"content":"Content-Based Correlation","pos":[0,25]}]},{"content":"Content-based correlation uses some piece of information in the message to associate it to a particular instance.","pos":[6019,6132]},{"content":"Unlike protocol-based correlation, content-based correlation requires the application author to explicitly state where this data can be found in each related message.","pos":[6133,6299]},{"content":"Activities that use content-based correlation specify this message data by using a <ph id=\"ph1\">&lt;xref:System.ServiceModel.MessageQuerySet&gt;</ph>.","pos":[6300,6426],"source":" Activities that use content-based correlation specify this message data by using a <xref:System.ServiceModel.MessageQuerySet>."},{"content":"Content-based correlation is useful when communicating with services that do not use one of the context bindings such as <ph id=\"ph1\">&lt;xref:System.ServiceModel.BasicHttpContextBinding&gt;</ph>.","pos":[6427,6599],"source":" Content-based correlation is useful when communicating with services that do not use one of the context bindings such as <xref:System.ServiceModel.BasicHttpContextBinding>."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> content-based correlation, see <bpt id=\"p1\">[</bpt>Content Based<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/content-based-correlation.md)</ept>.","pos":[6600,6780],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] content-based correlation, see [Content Based](../../../../docs/framework/wcf/feature-details/content-based-correlation.md)."},{"content":"For sample code, see the <bpt id=\"p1\">[</bpt>Content-Based Correlation<ept id=\"p1\">](../../../../docs/framework/windows-workflow-foundation/samples/content-based-correlation.md)</ept> and <bpt id=\"p2\">[</bpt>Correlated Calculator<ept id=\"p2\">](../../../../docs/framework/windows-workflow-foundation/samples/correlated-calculator.md)</ept> samples.","pos":[6781,7052],"source":" For sample code, see the [Content-Based Correlation](../../../../docs/framework/windows-workflow-foundation/samples/content-based-correlation.md) and [Correlated Calculator](../../../../docs/framework/windows-workflow-foundation/samples/correlated-calculator.md) samples."},{"pos":[7061,7069],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Content-Based Correlation<ept id=\"p1\">](../../../../docs/framework/windows-workflow-foundation/samples/content-based-correlation.md)</ept><ph id=\"ph1\"> </ph>","pos":[7073,7194],"source":"[Content-Based Correlation](../../../../docs/framework/windows-workflow-foundation/samples/content-based-correlation.md) "},{"content":"<bpt id=\"p1\">[</bpt>Correlated Calculator<ept id=\"p1\">](../../../../docs/framework/windows-workflow-foundation/samples/correlated-calculator.md)</ept><ph id=\"ph1\"> </ph>","pos":[7198,7311],"source":"[Correlated Calculator](../../../../docs/framework/windows-workflow-foundation/samples/correlated-calculator.md) "},{"content":"<bpt id=\"p1\">[</bpt>Durable Duplex &amp;#91;WF Samples&amp;#93;<ept id=\"p1\">](../../../../docs/framework/windows-workflow-foundation/samples/durable-duplex.md)</ept><ph id=\"ph1\"> </ph>","pos":[7315,7435],"source":"[Durable Duplex &#91;WF Samples&#93;](../../../../docs/framework/windows-workflow-foundation/samples/durable-duplex.md) "},{"content":"<bpt id=\"p1\">[</bpt>NetContextExchangeCorrelation<ept id=\"p1\">](http://msdn.microsoft.com/en-us/93c74a1a-b9e2-46c6-95c0-c9b0e9472caf)</ept>","pos":[7439,7540],"source":"[NetContextExchangeCorrelation](http://msdn.microsoft.com/en-us/93c74a1a-b9e2-46c6-95c0-c9b0e9472caf)"}]}