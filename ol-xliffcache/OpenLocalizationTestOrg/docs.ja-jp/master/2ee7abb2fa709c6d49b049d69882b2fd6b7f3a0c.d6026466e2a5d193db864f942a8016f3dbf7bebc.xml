{"content":"---\ntitle: \"Windows Service Host\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords:\n  - \"NT Service\"\n  - \"NT Service Host Sample [Windows Communication Foundation]\"\nms.assetid: 1b2f45c5-2bed-4979-b0ee-8f9efcfec028\n---\n# Windows Service Host\nThis sample demonstrates a Windows Communication Foundation (WCF) service hosted in a managed Windows Service. Windows Services are controlled using the Services applet in **Control Panel** and can be configured to start up automatically after a system reboot. The sample consists of a client program and an Windows Service program. The service is implemented as an .exe program and contains its own hosting code. In other hosting environments, such as Windows Process Activation Services (WAS) or Internet Information Services (IIS), it is not necessary for you to write hosting code.\n\n> [!NOTE]\n>  The set-up procedure and build instructions for this sample are located at the end of this topic.\n\n> [!IMPORTANT]\n>  The samples may already be installed on your computer. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Services\\Hosting\\WindowsService`  \n  \n After building this service, it must be installed with the Installutil.exe utility like any other Windows Service. If you are going to make changes to the service, you must first uninstall it with `installutil /u`. The Setup.bat and Cleanup.bat files included in this sample are the commands to install and start up the Windows Service, and to shut down and uninstall the Windows Service. The WCF service can only respond to clients if the Windows Service is running. If you stop the Windows Service by using the Services applet from **Control Panel** and run the client, a <xref:System.ServiceModel.EndpointNotFoundException> exception occurs when a client attempts to access the service. If you restart the Windows Service and rerun the client, communication succeeds.  \n  \n The service code includes an installer class, a WCF service implementation class which implements the ICalculator contract, and a Windows Service class that acts as the run-time host. The installer class, which inherits from <xref:System.Configuration.Install.Installer>, allows the program to be installed as an NT service by the Installutil.exe tool. The service implementation class, `WcfCalculatorService`, is an WCF service that implements a basic service contract. This WCF service is hosted inside a Windows Service class called `WindowsCalculatorService`. To qualify as a Windows Service, the class inherits from <xref:System.ServiceProcess.ServiceBase> and implements the <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> and <xref:System.ServiceProcess.ServiceBase.OnStop> methods. In <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>, a <xref:System.ServiceModel.ServiceHost> object is created for the `WcfCalculatorService` type and opened. In <xref:System.ServiceProcess.ServiceBase.OnStop>, the ServiceHost is closed by calling the <xref:System.ServiceModel.Channels.CommunicationObject.Close%28System.TimeSpan%29> method of the <xref:System.ServiceModel.ServiceHost> object. The host's base address is configured using the [\\<add>](../../../../docs/framework/configure-apps/file-schema/wcf/add-of-baseaddresses.md) element, which is a child of [\\<baseAddresses>](../../../../docs/framework/configure-apps/file-schema/wcf/baseaddresses.md), which is a child of the [\\<host>](../../../../docs/framework/configure-apps/file-schema/wcf/host.md) element, which is a child of the [\\<service>](../../../../docs/framework/configure-apps/file-schema/wcf/service.md) element.  \n  \n The endpoint that is defined uses the base address and a [\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md). The following sample shows the configuration of the base address as well as the endpoint that exposes the CalculatorService.  \n  \n```xml  \n<services>  \n  <service name=\"Microsoft.ServiceModel.Samples.WcfCalculatorService\"  \n           behaviorConfiguration=\"CalculatorServiceBehavior\">  \n    <host>  \n      <baseAddresses>  \n        <add baseAddress=\"http://localhost:8000/ServiceModelSamples/service\"/>  \n      </baseAddresses>  \n    </host>  \n    <!-- This endpoint is exposed at the base address provided by host: http://localhost:8000/ServiceModelSamples/service.  -->  \n    <endpoint address=\"\"  \n              binding=\"wsHttpBinding\"  \n              contract=\"Microsoft.ServiceModel.Samples.ICalculator\" />  \n    ...  \n  </service>  \n</services>  \n```  \n  \n When you run the sample, the operation requests and responses are displayed in both the service and client console windows. Press ENTER in each console window to shut down the service and client.  \n  \n### To set up, build, and run the sample  \n  \n1.  Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).  \n  \n2.  To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).  \n  \n3.  After the solution has been built, run Setup.bat from an elevated Visual Studio 2012 command prompt to install the Windows service using the Installutil.exe tool. The service should appear in Services.  \n  \n4.  To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).  \n  \n## See also\n\n- [AppFabric Hosting and Persistence Samples](https://go.microsoft.com/fwlink/?LinkId=193961)\n","nodes":[{"pos":[4,206],"embed":true,"restype":"x-metadata","content":"title: \"Windows Service Host\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords:\n  - \"NT Service\"\n  - \"NT Service Host Sample [Windows Communication Foundation]\"\nms.assetid: 1b2f45c5-2bed-4979-b0ee-8f9efcfec028","nodes":[{"content":"Windows Service Host","nodes":[{"pos":[0,20],"content":"Windows Service Host","nodes":[{"content":"Windows Service Host","pos":[0,20]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[213,233],"content":"Windows Service Host","linkify":"Windows Service Host","nodes":[{"content":"Windows Service Host","pos":[0,20]}]},{"content":"This sample demonstrates a Windows Communication Foundation (WCF) service hosted in a managed Windows Service.","pos":[234,344]},{"content":"Windows Services are controlled using the Services applet in <bpt id=\"p1\">**</bpt>Control Panel<ept id=\"p1\">**</ept> and can be configured to start up automatically after a system reboot.","pos":[345,494],"source":" Windows Services are controlled using the Services applet in **Control Panel** and can be configured to start up automatically after a system reboot."},{"content":"The sample consists of a client program and an Windows Service program.","pos":[495,566]},{"content":"The service is implemented as an .exe program and contains its own hosting code.","pos":[567,647]},{"content":"In other hosting environments, such as Windows Process Activation Services (WAS) or Internet Information Services (IIS), it is not necessary for you to write hosting code.","pos":[648,819]},{"pos":[823,931],"content":"[!NOTE]\n The set-up procedure and build instructions for this sample are located at the end of this topic.","leadings":["","> "],"nodes":[{"content":"The set-up procedure and build instructions for this sample are located at the end of this topic.","pos":[9,106]}]},{"pos":[935,1068],"content":"[!IMPORTANT]\n The samples may already be installed on your computer. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your computer. Check for the following (default) directory before continuing.","pos":[14,131],"nodes":[{"content":"The samples may already be installed on your computer.","pos":[0,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[1122,1432],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[1433,1483]},{"content":"After building this service, it must be installed with the Installutil.exe utility like any other Windows Service.","pos":[1575,1689]},{"content":"If you are going to make changes to the service, you must first uninstall it with <ph id=\"ph1\">`installutil /u`</ph>.","pos":[1690,1789],"source":" If you are going to make changes to the service, you must first uninstall it with `installutil /u`."},{"content":"The Setup.bat and Cleanup.bat files included in this sample are the commands to install and start up the Windows Service, and to shut down and uninstall the Windows Service.","pos":[1790,1963]},{"content":"The WCF service can only respond to clients if the Windows Service is running.","pos":[1964,2042]},{"content":"If you stop the Windows Service by using the Services applet from <bpt id=\"p1\">**</bpt>Control Panel<ept id=\"p1\">**</ept> and run the client, a <ph id=\"ph1\">&lt;xref:System.ServiceModel.EndpointNotFoundException&gt;</ph> exception occurs when a client attempts to access the service.","pos":[2043,2264],"source":" If you stop the Windows Service by using the Services applet from **Control Panel** and run the client, a <xref:System.ServiceModel.EndpointNotFoundException> exception occurs when a client attempts to access the service."},{"content":"If you restart the Windows Service and rerun the client, communication succeeds.","pos":[2265,2345]},{"content":"The service code includes an installer class, a WCF service implementation class which implements the ICalculator contract, and a Windows Service class that acts as the run-time host.","pos":[2352,2535]},{"content":"The installer class, which inherits from <ph id=\"ph1\">&lt;xref:System.Configuration.Install.Installer&gt;</ph>, allows the program to be installed as an NT service by the Installutil.exe tool.","pos":[2536,2704],"source":" The installer class, which inherits from <xref:System.Configuration.Install.Installer>, allows the program to be installed as an NT service by the Installutil.exe tool."},{"content":"The service implementation class, <ph id=\"ph1\">`WcfCalculatorService`</ph>, is an WCF service that implements a basic service contract.","pos":[2705,2822],"source":" The service implementation class, `WcfCalculatorService`, is an WCF service that implements a basic service contract."},{"content":"This WCF service is hosted inside a Windows Service class called <ph id=\"ph1\">`WindowsCalculatorService`</ph>.","pos":[2823,2915],"source":" This WCF service is hosted inside a Windows Service class called `WindowsCalculatorService`."},{"content":"To qualify as a Windows Service, the class inherits from <ph id=\"ph1\">&lt;xref:System.ServiceProcess.ServiceBase&gt;</ph> and implements the <ph id=\"ph2\">&lt;xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.ServiceProcess.ServiceBase.OnStop&gt;</ph> methods.","pos":[2916,3167],"source":" To qualify as a Windows Service, the class inherits from <xref:System.ServiceProcess.ServiceBase> and implements the <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> and <xref:System.ServiceProcess.ServiceBase.OnStop> methods."},{"content":"In <ph id=\"ph1\">&lt;xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29&gt;</ph>, a <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> object is created for the <ph id=\"ph3\">`WcfCalculatorService`</ph> type and opened.","pos":[3168,3352],"source":" In <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>, a <xref:System.ServiceModel.ServiceHost> object is created for the `WcfCalculatorService` type and opened."},{"content":"In <ph id=\"ph1\">&lt;xref:System.ServiceProcess.ServiceBase.OnStop&gt;</ph>, the ServiceHost is closed by calling the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.CommunicationObject.Close%28System.TimeSpan%29&gt;</ph> method of the <ph id=\"ph3\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> object.","pos":[3353,3589],"source":" In <xref:System.ServiceProcess.ServiceBase.OnStop>, the ServiceHost is closed by calling the <xref:System.ServiceModel.Channels.CommunicationObject.Close%28System.TimeSpan%29> method of the <xref:System.ServiceModel.ServiceHost> object."},{"content":"The host's base address is configured using the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>add&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/add-of-baseaddresses.md)</ept> element, which is a child of <bpt id=\"p2\">[</bpt><ph id=\"ph2\">\\&lt;</ph>baseAddresses&gt;<ept id=\"p2\">](../../../../docs/framework/configure-apps/file-schema/wcf/baseaddresses.md)</ept>, which is a child of the <bpt id=\"p3\">[</bpt><ph id=\"ph3\">\\&lt;</ph>host&gt;<ept id=\"p3\">](../../../../docs/framework/configure-apps/file-schema/wcf/host.md)</ept> element, which is a child of the <bpt id=\"p4\">[</bpt><ph id=\"ph4\">\\&lt;</ph>service&gt;<ept id=\"p4\">](../../../../docs/framework/configure-apps/file-schema/wcf/service.md)</ept> element.","pos":[3590,4080],"source":" The host's base address is configured using the [\\<add>](../../../../docs/framework/configure-apps/file-schema/wcf/add-of-baseaddresses.md) element, which is a child of [\\<baseAddresses>](../../../../docs/framework/configure-apps/file-schema/wcf/baseaddresses.md), which is a child of the [\\<host>](../../../../docs/framework/configure-apps/file-schema/wcf/host.md) element, which is a child of the [\\<service>](../../../../docs/framework/configure-apps/file-schema/wcf/service.md) element."},{"content":"The endpoint that is defined uses the base address and a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>wsHttpBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md)</ept>.","pos":[4087,4239],"source":"The endpoint that is defined uses the base address and a [\\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md)."},{"content":"The following sample shows the configuration of the base address as well as the endpoint that exposes the CalculatorService.","pos":[4240,4364]},{"content":"When you run the sample, the operation requests and responses are displayed in both the service and client console windows.","pos":[5004,5127]},{"content":"Press ENTER in each console window to shut down the service and client.","pos":[5128,5199]},{"pos":[5209,5245],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[5255,5454],"content":"Ensure that you have performed the <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"pos":[5464,5673],"content":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"content":"After the solution has been built, run Setup.bat from an elevated Visual Studio 2012 command prompt to install the Windows service using the Installutil.exe tool.","pos":[5683,5845]},{"content":"The service should appear in Services.","pos":[5846,5884]},{"pos":[5894,6103],"content":"To run the sample in a single- or cross-computer configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"pos":[6112,6120],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6124,6215],"content":"<bpt id=\"p1\">[</bpt>AppFabric Hosting and Persistence Samples<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=193961)</ept>","source":"[AppFabric Hosting and Persistence Samples](https://go.microsoft.com/fwlink/?LinkId=193961)"}]}