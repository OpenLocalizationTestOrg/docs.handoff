{"content":"---\ntitle: \"How to: Set a Max Clock Skew\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"MaxClockSkew property\"\n  - \"WCF, custom bindings\"\nms.assetid: 491d1705-eb29-43c2-a44c-c0cf996f74eb\n---\n# How to: Set a Max Clock Skew\nTime-critical functions can be derailed if the clock settings on two computers are different. To mitigate this possibility, you can set the `MaxClockSkew` property to a <xref:System.TimeSpan>. This property is available on two classes:  \n  \n <xref:System.ServiceModel.Channels.LocalClientSecuritySettings>  \n  \n <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings>  \n  \n> [!IMPORTANT]\n>  Important   For a secure conversation, changes to the `MaxClockSkew` property  must be made when the service or client is bootstrapped. To do this, you must set the property on the <xref:System.ServiceModel.Channels.SecurityBindingElement> returned by the <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters.BootstrapSecurityBindingElement%2A>.  \n  \n To change the property on one of the system-provided bindings, you must find the security binding element in the collection of bindings and set the `MaxClockSkew` property to a new value. Two classes derive from the <xref:System.ServiceModel.Channels.SecurityBindingElement>: <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> and <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement>. When retrieving the security binding from the collection, you must cast to one of these types in order to correctly set the `MaxClockSkew` property. The following example uses a <xref:System.ServiceModel.WSHttpBinding>, which uses the <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement>. For a list that specifies which type of security binding to use in each system-provided binding, see [System-Provided Bindings](../../../../docs/framework/wcf/system-provided-bindings.md).  \n  \n### To create a custom binding with a new clock skew value in code  \n  \n1.  > [!WARNING]\n    >  Note   Add references to the following namespaces in your code: <xref:System.ServiceModel.Channels>, <xref:System.ServiceModel.Description>, <xref:System.Security.Permissions>, and <xref:System.ServiceModel.Security.Tokens>.  \n  \n     Create an instance of a <xref:System.ServiceModel.WSHttpBinding> class and set its security mode to <xref:System.ServiceModel.SecurityMode.Message>.  \n  \n2.  Create a new instance of the <xref:System.ServiceModel.Channels.BindingElementCollection> class by calling the <xref:System.ServiceModel.WSHttpBinding.CreateBindingElements%2A> method.  \n  \n3.  Use the <xref:System.ServiceModel.Channels.BindingElementCollection.Find%2A> method of the <xref:System.ServiceModel.Channels.BindingElementCollection> class to find the security binding element.  \n  \n4.  When using the <xref:System.ServiceModel.Channels.BindingElementCollection.Find%2A> method, cast to the actual type. The example below casts to the <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> type.  \n  \n5.  Set the <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxClockSkew%2A> property on the security binding element.  \n  \n6.  Create a <xref:System.ServiceModel.ServiceHost> with an appropriate service type and base address.  \n  \n7.  Use the <xref:System.ServiceModel.ServiceHost.AddServiceEndpoint%2A> method to add an endpoint and include the <xref:System.ServiceModel.Channels.CustomBinding>.  \n  \n     [!code-csharp[c_MaxClockSkew#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_maxclockskew/cs/source.cs#1)]\n     [!code-vb[c_MaxClockSkew#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_maxclockskew/vb/source.vb#1)]  \n  \n### To set the MaxClockSkew in configuration  \n  \n1.  Create a [\\<customBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/custombinding.md) in the [\\<bindings>](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md) element section.  \n  \n2.  Create a [\\<binding>](../../../../docs/framework/misc/binding.md) element and set the `name` attribute to an appropriate value. The following example sets it to `MaxClockSkewBinding`.  \n  \n3.  Add an encoding element. The example below adds a [\\<textMessageEncoding>](../../../../docs/framework/configure-apps/file-schema/wcf/textmessageencoding.md).  \n  \n4.  Add a [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-of-custombinding.md) element and set the `authenticationMode` attribute to an appropriate setting. The following example set the attribute to `Kerberos` to specify that the service use Windows authentication.  \n  \n5.  Add a [\\<localServiceSettings>](../../../../docs/framework/configure-apps/file-schema/wcf/localservicesettings-element.md) and set the `maxClockSkew` attribute to a value in the form of `\"##:##:##\"`. The following example sets it to 7 minutes. Optionally, add a [\\<localServiceSettings>](../../../../docs/framework/configure-apps/file-schema/wcf/localservicesettings-element.md) and set the `maxClockSkew` attribute to an appropriate setting.  \n  \n6.  Add a transport element. The following example uses an [\\<httpTransport>](../../../../docs/framework/configure-apps/file-schema/wcf/httptransport.md).  \n  \n7.  For a secure conversation, the security settings must occur at the bootstrap in the [\\<secureConversationBootstrap>](../../../../docs/framework/configure-apps/file-schema/wcf/secureconversationbootstrap.md) element.  \n  \n    ```xml  \n    <bindings>  \n      <customBinding>  \n        <binding name=\"MaxClockSkewBinding\">  \n            <textMessageEncoding />  \n            <security authenticationMode=\"Kerberos\">  \n               <localClientSettings maxClockSkew=\"00:07:00\" />  \n               <localServiceSettings maxClockSkew=\"00:07:00\" />  \n               <secureConversationBootstrap>  \n                  <localClientSettings maxClockSkew=\"00:30:00\" />  \n                  <localServiceSettings maxClockSkew=\"00:30:00\" />  \n               </secureConversationBootstrap>  \n            </security>  \n            <httpTransport />  \n        </binding>  \n      </customBinding>  \n    </bindings>  \n    ```  \n  \n## See also\n\n- <xref:System.ServiceModel.Channels.LocalClientSecuritySettings>\n- <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings>\n- <xref:System.ServiceModel.Channels.CustomBinding>\n- [How to: Create a Custom Binding Using the SecurityBindingElement](../../../../docs/framework/wcf/feature-details/how-to-create-a-custom-binding-using-the-securitybindingelement.md)\n","nodes":[{"pos":[4,223],"embed":true,"restype":"x-metadata","content":"title: \"How to: Set a Max Clock Skew\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"MaxClockSkew property\"\n  - \"WCF, custom bindings\"\nms.assetid: 491d1705-eb29-43c2-a44c-c0cf996f74eb","nodes":[{"content":"How to: Set a Max Clock Skew","nodes":[{"pos":[0,28],"content":"How to: Set a Max Clock Skew","nodes":[{"content":"How to: Set a Max Clock Skew","pos":[0,28]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[230,258],"content":"How to: Set a Max Clock Skew","linkify":"How to: Set a Max Clock Skew","nodes":[{"content":"How to: Set a Max Clock Skew","pos":[0,28]}]},{"content":"Time-critical functions can be derailed if the clock settings on two computers are different.","pos":[259,352]},{"content":"To mitigate this possibility, you can set the <ph id=\"ph1\">`MaxClockSkew`</ph> property to a <ph id=\"ph2\">&lt;xref:System.TimeSpan&gt;</ph>.","pos":[353,451],"source":" To mitigate this possibility, you can set the `MaxClockSkew` property to a <xref:System.TimeSpan>."},{"content":"This property is available on two classes:","pos":[452,494]},{"pos":[643,1035],"content":"[!IMPORTANT]\n Important   For a secure conversation, changes to the `MaxClockSkew` property  must be made when the service or client is bootstrapped. To do this, you must set the property on the <xref:System.ServiceModel.Channels.SecurityBindingElement> returned by the <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters.BootstrapSecurityBindingElement%2A>.","leadings":["","> "],"nodes":[{"content":"Important   For a secure conversation, changes to the `MaxClockSkew` property  must be made when the service or client is bootstrapped. To do this, you must set the property on the <xref:System.ServiceModel.Channels.SecurityBindingElement> returned by the <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters.BootstrapSecurityBindingElement%2A>.","pos":[14,390],"nodes":[{"content":"Important   For a secure conversation, changes to the <ph id=\"ph1\">`MaxClockSkew`</ph> property  must be made when the service or client is bootstrapped.","pos":[0,135],"source":"Important   For a secure conversation, changes to the `MaxClockSkew` property  must be made when the service or client is bootstrapped."},{"content":"To do this, you must set the property on the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.SecurityBindingElement&gt;</ph> returned by the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters.BootstrapSecurityBindingElement%2A&gt;</ph>.","pos":[136,376],"source":" To do this, you must set the property on the <xref:System.ServiceModel.Channels.SecurityBindingElement> returned by the <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters.BootstrapSecurityBindingElement%2A>."}]}]},{"content":"To change the property on one of the system-provided bindings, you must find the security binding element in the collection of bindings and set the <ph id=\"ph1\">`MaxClockSkew`</ph> property to a new value.","pos":[1042,1229],"source":"To change the property on one of the system-provided bindings, you must find the security binding element in the collection of bindings and set the `MaxClockSkew` property to a new value."},{"content":"Two classes derive from the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.SecurityBindingElement&gt;</ph>: <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement&gt;</ph>.","pos":[1230,1459],"source":" Two classes derive from the <xref:System.ServiceModel.Channels.SecurityBindingElement>: <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> and <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement>."},{"content":"When retrieving the security binding from the collection, you must cast to one of these types in order to correctly set the <ph id=\"ph1\">`MaxClockSkew`</ph> property.","pos":[1460,1608],"source":" When retrieving the security binding from the collection, you must cast to one of these types in order to correctly set the `MaxClockSkew` property."},{"content":"The following example uses a <ph id=\"ph1\">&lt;xref:System.ServiceModel.WSHttpBinding&gt;</ph>, which uses the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement&gt;</ph>.","pos":[1609,1763],"source":" The following example uses a <xref:System.ServiceModel.WSHttpBinding>, which uses the <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement>."},{"content":"For a list that specifies which type of security binding to use in each system-provided binding, see <bpt id=\"p1\">[</bpt>System-Provided Bindings<ept id=\"p1\">](../../../../docs/framework/wcf/system-provided-bindings.md)</ept>.","pos":[1764,1952],"source":" For a list that specifies which type of security binding to use in each system-provided binding, see [System-Provided Bindings](../../../../docs/framework/wcf/system-provided-bindings.md)."},{"pos":[1962,2024],"content":"To create a custom binding with a new clock skew value in code","linkify":"To create a custom binding with a new clock skew value in code","nodes":[{"content":"To create a custom binding with a new clock skew value in code","pos":[0,62]}]},{"pos":[2036,2278],"content":"[!WARNING]\nNote   Add references to the following namespaces in your code: <xref:System.ServiceModel.Channels>, <xref:System.ServiceModel.Description>, <xref:System.Security.Permissions>, and <xref:System.ServiceModel.Security.Tokens>.","leadings":["","    >  "],"nodes":[{"content":"Note   Add references to the following namespaces in your code: <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description&gt;</ph>, <ph id=\"ph3\">&lt;xref:System.Security.Permissions&gt;</ph>, and <ph id=\"ph4\">&lt;xref:System.ServiceModel.Security.Tokens&gt;</ph>.","pos":[11,235],"source":"Note   Add references to the following namespaces in your code: <xref:System.ServiceModel.Channels>, <xref:System.ServiceModel.Description>, <xref:System.Security.Permissions>, and <xref:System.ServiceModel.Security.Tokens>."}]},{"pos":[2289,2437],"content":"Create an instance of a <ph id=\"ph1\">&lt;xref:System.ServiceModel.WSHttpBinding&gt;</ph> class and set its security mode to <ph id=\"ph2\">&lt;xref:System.ServiceModel.SecurityMode.Message&gt;</ph>.","source":"Create an instance of a <xref:System.ServiceModel.WSHttpBinding> class and set its security mode to <xref:System.ServiceModel.SecurityMode.Message>."},{"pos":[2447,2631],"content":"Create a new instance of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.BindingElementCollection&gt;</ph> class by calling the <ph id=\"ph2\">&lt;xref:System.ServiceModel.WSHttpBinding.CreateBindingElements%2A&gt;</ph> method.","source":"Create a new instance of the <xref:System.ServiceModel.Channels.BindingElementCollection> class by calling the <xref:System.ServiceModel.WSHttpBinding.CreateBindingElements%2A> method."},{"pos":[2641,2836],"content":"Use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.BindingElementCollection.Find%2A&gt;</ph> method of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.BindingElementCollection&gt;</ph> class to find the security binding element.","source":"Use the <xref:System.ServiceModel.Channels.BindingElementCollection.Find%2A> method of the <xref:System.ServiceModel.Channels.BindingElementCollection> class to find the security binding element."},{"content":"When using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.BindingElementCollection.Find%2A&gt;</ph> method, cast to the actual type.","pos":[2846,2962],"source":"When using the <xref:System.ServiceModel.Channels.BindingElementCollection.Find%2A> method, cast to the actual type."},{"content":"The example below casts to the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement&gt;</ph> type.","pos":[2963,3067],"source":" The example below casts to the <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> type."},{"pos":[3077,3207],"content":"Set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxClockSkew%2A&gt;</ph> property on the security binding element.","source":"Set the <xref:System.ServiceModel.Channels.LocalServiceSecuritySettings.MaxClockSkew%2A> property on the security binding element."},{"pos":[3217,3315],"content":"Create a <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> with an appropriate service type and base address.","source":"Create a <xref:System.ServiceModel.ServiceHost> with an appropriate service type and base address."},{"pos":[3325,3486],"content":"Use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost.AddServiceEndpoint%2A&gt;</ph> method to add an endpoint and include the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.CustomBinding&gt;</ph>.","source":"Use the <xref:System.ServiceModel.ServiceHost.AddServiceEndpoint%2A> method to add an endpoint and include the <xref:System.ServiceModel.Channels.CustomBinding>."},{"pos":[3497,3734],"content":"[!code-csharp[c_MaxClockSkew#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_maxclockskew/cs/source.cs#1)]\n [!code-vb[c_MaxClockSkew#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_maxclockskew/vb/source.vb#1)]","leadings":["","    "],"nodes":[]},{"pos":[3744,3784],"content":"To set the MaxClockSkew in configuration","linkify":"To set the MaxClockSkew in configuration","nodes":[{"content":"To set the MaxClockSkew in configuration","pos":[0,40]}]},{"pos":[3794,4006],"content":"Create a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>customBinding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/custombinding.md)</ept> in the <bpt id=\"p2\">[</bpt><ph id=\"ph2\">\\&lt;</ph>bindings&gt;<ept id=\"p2\">](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md)</ept> element section.","source":"Create a [\\<customBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/custombinding.md) in the [\\<bindings>](../../../../docs/framework/configure-apps/file-schema/wcf/bindings.md) element section."},{"content":"Create a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>binding&gt;<ept id=\"p1\">](../../../../docs/framework/misc/binding.md)</ept> element and set the <ph id=\"ph2\">`name`</ph> attribute to an appropriate value.","pos":[4016,4143],"source":"Create a [\\<binding>](../../../../docs/framework/misc/binding.md) element and set the `name` attribute to an appropriate value."},{"content":"The following example sets it to <ph id=\"ph1\">`MaxClockSkewBinding`</ph>.","pos":[4144,4199],"source":" The following example sets it to `MaxClockSkewBinding`."},{"content":"Add an encoding element.","pos":[4209,4233]},{"content":"The example below adds a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>textMessageEncoding&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/textmessageencoding.md)</ept>.","pos":[4234,4366],"source":" The example below adds a [\\<textMessageEncoding>](../../../../docs/framework/configure-apps/file-schema/wcf/textmessageencoding.md)."},{"content":"Add a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>security&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/security-of-custombinding.md)</ept> element and set the <ph id=\"ph2\">`authenticationMode`</ph> attribute to an appropriate setting.","pos":[4376,4561],"source":"Add a [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-of-custombinding.md) element and set the `authenticationMode` attribute to an appropriate setting."},{"content":"The following example set the attribute to <ph id=\"ph1\">`Kerberos`</ph> to specify that the service use Windows authentication.","pos":[4562,4671],"source":" The following example set the attribute to `Kerberos` to specify that the service use Windows authentication."},{"content":"Add a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>localServiceSettings&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/localservicesettings-element.md)</ept> and set the <ph id=\"ph2\">`maxClockSkew`</ph> attribute to a value in the form of <ph id=\"ph3\">`\"##:##:##\"`</ph>.","pos":[4681,4880],"source":"Add a [\\<localServiceSettings>](../../../../docs/framework/configure-apps/file-schema/wcf/localservicesettings-element.md) and set the `maxClockSkew` attribute to a value in the form of `\"##:##:##\"`."},{"content":"The following example sets it to 7 minutes.","pos":[4881,4924]},{"content":"Optionally, add a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>localServiceSettings&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/localservicesettings-element.md)</ept> and set the <ph id=\"ph2\">`maxClockSkew`</ph> attribute to an appropriate setting.","pos":[4925,5123],"source":" Optionally, add a [\\<localServiceSettings>](../../../../docs/framework/configure-apps/file-schema/wcf/localservicesettings-element.md) and set the `maxClockSkew` attribute to an appropriate setting."},{"content":"Add a transport element.","pos":[5133,5157]},{"content":"The following example uses an <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>httpTransport&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/httptransport.md)</ept>.","pos":[5158,5283],"source":" The following example uses an [\\<httpTransport>](../../../../docs/framework/configure-apps/file-schema/wcf/httptransport.md)."},{"pos":[5293,5508],"content":"For a secure conversation, the security settings must occur at the bootstrap in the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>secureConversationBootstrap&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/secureconversationbootstrap.md)</ept> element.","source":"For a secure conversation, the security settings must occur at the bootstrap in the [\\<secureConversationBootstrap>](../../../../docs/framework/configure-apps/file-schema/wcf/secureconversationbootstrap.md) element."},{"pos":[6209,6217],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6406,6587],"content":"<bpt id=\"p1\">[</bpt>How to: Create a Custom Binding Using the SecurityBindingElement<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-custom-binding-using-the-securitybindingelement.md)</ept>","source":"[How to: Create a Custom Binding Using the SecurityBindingElement](../../../../docs/framework/wcf/feature-details/how-to-create-a-custom-binding-using-the-securitybindingelement.md)"}]}