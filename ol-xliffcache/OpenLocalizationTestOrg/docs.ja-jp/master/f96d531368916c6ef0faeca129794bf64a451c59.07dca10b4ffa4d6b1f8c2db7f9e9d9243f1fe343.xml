{"content":"---\ntitle: \"How to: Secure a Service with an X.509 Certificate | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 2d06c2aa-d0d7-4e5e-ad7e-77416aa1c10b\ncaps.latest.revision: 8\nauthor: \"BrucePerlerMS\"\nms.author: \"bruceper\"\nmanager: \"mbaldwin\"\n---\n# How to: Secure a Service with an X.509 Certificate\nSecuring a service with an X.509 certificate is a basic technique that most bindings in [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] use. This topic walks through the steps of configuring a self-hosted service with an X.509 certificate.  \n  \n A prerequisite is a valid certificate that can be used to authenticate the server. The certificate must be issued to the server by a trusted certificate authority. If the certificate is not valid, any client trying to use the service will not trust the service, and consequently no connection will be made. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] using certificates, see [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).  \n  \n### To configure a service with a certificate using code  \n  \n1.  Create the service contract and the implemented service. [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][Designing and Implementing Services](../../../../docs/framework/wcf/designing-and-implementing-services.md).  \n  \n2.  Create an instance of the <xref:System.ServiceModel.WSHttpBinding> class and set its security mode to <xref:System.ServiceModel.SecurityMode>, as shown in the following code.  \n  \n     [!code-csharp[C_SecureWithCertificate#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#1)]\n     [!code-vb[C_SecureWithCertificate#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#1)]  \n  \n3.  Create two <xref:System.Type> variables, one each for the contract type and the implemented contract, as shown in the following code.  \n  \n     [!code-csharp[C_SecureWithCertificate#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#2)]\n     [!code-vb[C_SecureWithCertificate#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#2)]  \n  \n4.  Create an instance of the <xref:System.Uri> class for the base address of the service. Because the `WSHttpBinding` uses the HTTP transport, the Uniform Resource Identifier (URI) must begin with that schema, or [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] will throw an exception when the service is opened.  \n  \n     [!code-csharp[C_SecureWithCertificate#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#3)]\n     [!code-vb[C_SecureWithCertificate#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#3)]  \n  \n5.  Create a new instance of the <xref:System.ServiceModel.ServiceHost> class with the implemented contract type variable and the URI.  \n  \n     [!code-csharp[C_SecureWithCertificate#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#4)]\n     [!code-vb[C_SecureWithCertificate#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#4)]  \n  \n6.  Add a <xref:System.ServiceModel.Description.ServiceEndpoint> to the service using the <xref:System.ServiceModel.ServiceHost.AddServiceEndpoint%2A> method. Pass the contract, binding, and an endpoint address to the constructor, as shown in the following code.  \n  \n     [!code-csharp[C_SecureWithCertificate#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#5)]\n     [!code-vb[C_SecureWithCertificate#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#5)]  \n  \n7.  Optional. To retrieve metadata from the service, create a new <xref:System.ServiceModel.Description.ServiceMetadataBehavior> object and set the <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpGetEnabled%2A> property to `true`.  \n  \n     [!code-csharp[C_SecureWithCertificate#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#6)]\n     [!code-vb[C_SecureWithCertificate#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#6)]  \n  \n8.  Use the <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A> method of the <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential> class to add the valid certificate to the service. The method can use one of several methods to find a certificate. This example uses the <xref:System.Security.Cryptography.X509Certificates.X509FindType> enumeration. The enumeration specifies that the supplied value is the name of the entity that the certificate was issued to.  \n  \n     [!code-csharp[C_SecureWithCertificate#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#7)]\n     [!code-vb[C_SecureWithCertificate#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#7)]  \n  \n9. Call the <xref:System.ServiceModel.Channels.CommunicationObject.Open%2A> method to start the service listening. If you are creating a console application, call the <xref:System.Console.ReadLine%2A> method to keep the service in the listening state.  \n  \n     [!code-csharp[C_SecureWithCertificate#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#8)]\n     [!code-vb[C_SecureWithCertificate#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#8)]  \n  \n## Example  \n The following example uses the <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A> method to configure a service with an X.509 certificate.  \n  \n [!code-csharp[C_SecureWithCertificate#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#9)]\n [!code-vb[C_SecureWithCertificate#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#9)]  \n  \n## Compiling the Code  \n The following namespaces are required to compile the code:  \n  \n-   <xref:System>  \n  \n-   <xref:System.ServiceModel>  \n  \n-   <xref:System.ServiceModel.Channels>  \n  \n-   <xref:System.Web.Services.Description>  \n  \n-   <xref:System.Security.Cryptography.X509Certificates>  \n  \n-   <xref:System.Runtime.Serialization>  \n  \n## See Also  \n [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)","nodes":[{"pos":[4,381],"embed":true,"restype":"x-metadata","content":"title: \"How to: Secure a Service with an X.509 Certificate | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 2d06c2aa-d0d7-4e5e-ad7e-77416aa1c10b\ncaps.latest.revision: 8\nauthor: \"BrucePerlerMS\"\nms.author: \"bruceper\"\nmanager: \"mbaldwin\"","nodes":[{"content":"How to: Secure a Service with an X.509 Certificate | Microsoft Docs","nodes":[{"pos":[0,67],"content":"How to: Secure a Service with an X.509 Certificate | Microsoft Docs","nodes":[{"content":"How to: Secure a Service with an X.509 Certificate | Microsoft Docs","pos":[0,67]}]}],"path":["title"]}],"yml":true},{"pos":[388,438],"content":"How to: Secure a Service with an X.509 Certificate","linkify":"How to: Secure a Service with an X.509 Certificate","nodes":[{"content":"How to: Secure a Service with an X.509 Certificate","pos":[0,50]}]},{"content":"Securing a service with an X.509 certificate is a basic technique that most bindings in <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> use.","pos":[439,587],"source":"Securing a service with an X.509 certificate is a basic technique that most bindings in [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] use."},{"content":"This topic walks through the steps of configuring a self-hosted service with an X.509 certificate.","pos":[588,686]},{"content":"A prerequisite is a valid certificate that can be used to authenticate the server.","pos":[693,775]},{"content":"The certificate must be issued to the server by a trusted certificate authority.","pos":[776,856]},{"content":"If the certificate is not valid, any client trying to use the service will not trust the service, and consequently no connection will be made.","pos":[857,999]},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> using certificates, see <bpt id=\"p1\">[</bpt>Working with Certificates<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)</ept>.","pos":[1000,1185],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] using certificates, see [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)."},{"pos":[1195,1247],"content":"To configure a service with a certificate using code","linkify":"To configure a service with a certificate using code","nodes":[{"content":"To configure a service with a certificate using code","pos":[0,52]}]},{"content":"Create the service contract and the implemented service.","pos":[1257,1313]},{"content":"<ph id=\"ph1\">[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]</ph><bpt id=\"p1\">[</bpt>Designing and Implementing Services<ept id=\"p1\">](../../../../docs/framework/wcf/designing-and-implementing-services.md)</ept>.","pos":[1314,1482],"source":"[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][Designing and Implementing Services](../../../../docs/framework/wcf/designing-and-implementing-services.md)."},{"content":"Create an instance of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.WSHttpBinding&gt;</ph> class and set its security mode to <ph id=\"ph2\">&lt;xref:System.ServiceModel.SecurityMode&gt;</ph>, as shown in the following code.","pos":[1492,1666],"source":"Create an instance of the <xref:System.ServiceModel.WSHttpBinding> class and set its security mode to <xref:System.ServiceModel.SecurityMode>, as shown in the following code."},{"pos":[1677,1950],"content":"[!code-csharp[C_SecureWithCertificate#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#1)]\n [!code-vb[C_SecureWithCertificate#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#1)]","leadings":["","    "],"nodes":[]},{"content":"Create two <ph id=\"ph1\">&lt;xref:System.Type&gt;</ph> variables, one each for the contract type and the implemented contract, as shown in the following code.","pos":[1960,2093],"source":"Create two <xref:System.Type> variables, one each for the contract type and the implemented contract, as shown in the following code."},{"pos":[2104,2377],"content":"[!code-csharp[C_SecureWithCertificate#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#2)]\n [!code-vb[C_SecureWithCertificate#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#2)]","leadings":["","    "],"nodes":[]},{"content":"Create an instance of the <ph id=\"ph1\">&lt;xref:System.Uri&gt;</ph> class for the base address of the service.","pos":[2387,2473],"source":"Create an instance of the <xref:System.Uri> class for the base address of the service."},{"content":"Because the <ph id=\"ph1\">`WSHttpBinding`</ph> uses the HTTP transport, the Uniform Resource Identifier (URI) must begin with that schema, or <ph id=\"ph2\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> will throw an exception when the service is opened.","pos":[2474,2704],"source":" Because the `WSHttpBinding` uses the HTTP transport, the Uniform Resource Identifier (URI) must begin with that schema, or [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] will throw an exception when the service is opened."},{"pos":[2715,2988],"content":"[!code-csharp[C_SecureWithCertificate#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#3)]\n [!code-vb[C_SecureWithCertificate#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#3)]","leadings":["","    "],"nodes":[]},{"content":"Create a new instance of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> class with the implemented contract type variable and the URI.","pos":[2998,3128],"source":"Create a new instance of the <xref:System.ServiceModel.ServiceHost> class with the implemented contract type variable and the URI."},{"pos":[3139,3412],"content":"[!code-csharp[C_SecureWithCertificate#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#4)]\n [!code-vb[C_SecureWithCertificate#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#4)]","leadings":["","    "],"nodes":[]},{"content":"Add a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceEndpoint&gt;</ph> to the service using the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceHost.AddServiceEndpoint%2A&gt;</ph> method.","pos":[3422,3576],"source":"Add a <xref:System.ServiceModel.Description.ServiceEndpoint> to the service using the <xref:System.ServiceModel.ServiceHost.AddServiceEndpoint%2A> method."},{"content":"Pass the contract, binding, and an endpoint address to the constructor, as shown in the following code.","pos":[3577,3680]},{"pos":[3691,3964],"content":"[!code-csharp[C_SecureWithCertificate#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#5)]\n [!code-vb[C_SecureWithCertificate#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#5)]","leadings":["","    "],"nodes":[]},{"content":"Optional.","pos":[3974,3983]},{"content":"To retrieve metadata from the service, create a new <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceMetadataBehavior&gt;</ph> object and set the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpGetEnabled%2A&gt;</ph> property to <ph id=\"ph3\">`true`</ph>.","pos":[3984,4218],"source":" To retrieve metadata from the service, create a new <xref:System.ServiceModel.Description.ServiceMetadataBehavior> object and set the <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpGetEnabled%2A> property to `true`."},{"pos":[4229,4502],"content":"[!code-csharp[C_SecureWithCertificate#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#6)]\n [!code-vb[C_SecureWithCertificate#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#6)]","leadings":["","    "],"nodes":[]},{"content":"Use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A&gt;</ph> method of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential&gt;</ph> class to add the valid certificate to the service.","pos":[4512,4758],"source":"Use the <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A> method of the <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential> class to add the valid certificate to the service."},{"content":"The method can use one of several methods to find a certificate.","pos":[4759,4823]},{"content":"This example uses the <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.X509Certificates.X509FindType&gt;</ph> enumeration.","pos":[4824,4924],"source":" This example uses the <xref:System.Security.Cryptography.X509Certificates.X509FindType> enumeration."},{"content":"The enumeration specifies that the supplied value is the name of the entity that the certificate was issued to.","pos":[4925,5036]},{"pos":[5047,5320],"content":"[!code-csharp[C_SecureWithCertificate#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#7)]\n [!code-vb[C_SecureWithCertificate#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#7)]","leadings":["","    "],"nodes":[]},{"content":"Call the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.CommunicationObject.Open%2A&gt;</ph> method to start the service listening.","pos":[5329,5440],"source":"Call the <xref:System.ServiceModel.Channels.CommunicationObject.Open%2A> method to start the service listening."},{"content":"If you are creating a console application, call the <ph id=\"ph1\">&lt;xref:System.Console.ReadLine%2A&gt;</ph> method to keep the service in the listening state.","pos":[5441,5577],"source":" If you are creating a console application, call the <xref:System.Console.ReadLine%2A> method to keep the service in the listening state."},{"pos":[5588,5861],"content":"[!code-csharp[C_SecureWithCertificate#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securewithcertificate/cs/source.cs#8)]\n  [!code-vb[C_SecureWithCertificate#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securewithcertificate/vb/source.vb#8)]","leadings":["","   "],"nodes":[]},{"pos":[5870,5877],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following example uses the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A&gt;</ph> method to configure a service with an X.509 certificate.","pos":[5881,6064],"source":"The following example uses the <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A> method to configure a service with an X.509 certificate."},{"pos":[6349,6367],"content":"Compiling the Code","linkify":"Compiling the Code","nodes":[{"content":"Compiling the Code","pos":[0,18]}]},{"content":"The following namespaces are required to compile the code:","pos":[6371,6429]},{"pos":[6697,6705],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[6709,6813],"content":"<bpt id=\"p1\">[</bpt>Working with Certificates<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)</ept>","source":"[Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)"}]}