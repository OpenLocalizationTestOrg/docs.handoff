{"content":"---\ntitle: \"How to: Restrict Access with the PrincipalPermissionAttribute Class\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"PrincipalPermissionAttribute class\"\n  - \"WCF, authorization\"\n  - \"WCF, security\"\nms.assetid: 5162f5c4-8781-4cc4-9425-bb7620eaeaf4\n---\n# How to: Restrict Access with the PrincipalPermissionAttribute Class\nControlling the access to resources on a Windows-domain computer is a basic security task. For example, only certain users should be able to view sensitive data, such as payroll information. This topic explains how to restrict access to a method by demanding that the user belong to a predefined group. For a working sample, see [Authorizing Access to Service Operations](../../../docs/framework/wcf/samples/authorizing-access-to-service-operations.md).  \n  \n The task consists of two separate procedures. The first creates the group and populates it with users. The second applies the <xref:System.Security.Permissions.PrincipalPermissionAttribute> class to specify the group.  \n  \n### To create a Windows group  \n  \n1.  Open the **Computer Management** console.  \n  \n2.  In the left panel, click **Local Users and Groups**.  \n  \n3.  Right-click **Groups**, and click **New Group**.  \n  \n4.  In the **Group Name** box, type a name for the new group.  \n  \n5.  In the **Description** box, type a description of the new group.  \n  \n6.  Click the **Add** button to add new members to the group.  \n  \n7.  If you have added yourself to the group and want to test the following code, you must log off the computer and log back on to be included in the group.  \n  \n### To demand user membership  \n  \n1.  Open the Windows Communication Foundation (WCF) code file that contains the implemented service contract code. For more information about implementing a contract, see [Implementing Service Contracts](../../../docs/framework/wcf/implementing-service-contracts.md).  \n  \n2.  Apply the <xref:System.Security.Permissions.PrincipalPermissionAttribute> attribute to each method that must be restricted to a specific group. Set the <xref:System.Security.Permissions.SecurityAttribute.Action%2A> property to <xref:System.Security.Permissions.SecurityAction.Demand> and the <xref:System.Security.Permissions.PrincipalPermissionAttribute.Role%2A> property to the name of the group. For example:  \n  \n     [!code-csharp[c_PrincipalPermissionAttribute#1](../../../samples/snippets/csharp/VS_Snippets_CFX/c_principalpermissionattribute/cs/source.cs#1)]\n     [!code-vb[c_PrincipalPermissionAttribute#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_principalpermissionattribute/vb/source.vb#1)]  \n  \n    > [!NOTE]\n    >  If you apply the <xref:System.Security.Permissions.PrincipalPermissionAttribute> attribute to a contract a <xref:System.Security.SecurityException> will be thrown. You can only apply the attribute at the method level.  \n  \n## Using a Certificate to Control Access to a Method  \n You can also use the `PrincipalPermissionAttribute` class to control access to a method if the client credential type is a certificate. To do this, you must have the certificate's subject and thumbprint.  \n  \n To examine a certificate for its properties, see [How to: View Certificates with the MMC Snap-in](../../../docs/framework/wcf/feature-details/how-to-view-certificates-with-the-mmc-snap-in.md). To find the thumbprint value, see [How to: Retrieve the Thumbprint of a Certificate](../../../docs/framework/wcf/feature-details/how-to-retrieve-the-thumbprint-of-a-certificate.md).  \n  \n#### To control access using a certificate  \n  \n1.  Apply the <xref:System.Security.Permissions.PrincipalPermissionAttribute> class to the method you want to restrict access to.  \n  \n2.  Set the action of the attribute to <xref:System.Security.Permissions.SecurityAction.Demand?displayProperty=nameWithType>.  \n  \n3.  Set the `Name` property to a string that consists of the subject name and the certificate's thumbprint. Separate the two values with a semicolon and a space, as shown in the following example:  \n  \n     [!code-csharp[c_PrincipalPermissionAttribute#2](../../../samples/snippets/csharp/VS_Snippets_CFX/c_principalpermissionattribute/cs/source.cs#2)]\n     [!code-vb[c_PrincipalPermissionAttribute#2](../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_principalpermissionattribute/vb/source.vb#2)]  \n  \n4.  Set the <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.PrincipalPermissionMode%2A> property to <xref:System.ServiceModel.Description.PrincipalPermissionMode.UseAspNetRoles> as shown in the following configuration example:  \n  \n    ```xml  \n    <behaviors>  \n      <serviceBehaviors>  \n      <behavior name=\"SvcBehavior1\">  \n      <serviceAuthorization principalPermissionMode=\"UseAspNetRoles\" />  \n      </behavior>  \n      </serviceBehaviors>  \n    </behaviors>  \n    ```  \n  \n     Setting this value to `UseAspNetRoles` indicates that the `Name` property of the `PrincipalPermissionAttribute` will be used to perform a string comparison. When a certificate is used as a client credential, by default WCF concatenates the certificate common name and the thumbprint with a semicolon to create a unique value for the client's primary identity. With `UseAspNetRoles` set as the `PrincipalPermissionMode` on the service, this primary identity value is compared with the `Name` property value to determine the access rights of the user.  \n  \n     Alternatively, when creating a self-hosted service, set the <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.PrincipalPermissionMode%2A> property in code as shown in the following code:  \n  \n     [!code-csharp[c_PrincipalPermissionAttribute#3](../../../samples/snippets/csharp/VS_Snippets_CFX/c_principalpermissionattribute/cs/source.cs#3)]\n     [!code-vb[c_PrincipalPermissionAttribute#3](../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_principalpermissionattribute/vb/source.vb#3)]  \n  \n## See also\n\n- <xref:System.Security.Permissions.PrincipalPermissionAttribute>\n- <xref:System.Security.Permissions.PrincipalPermissionAttribute>\n- <xref:System.Security.Permissions.SecurityAction.Demand>\n- <xref:System.Security.Permissions.PrincipalPermissionAttribute.Role%2A>\n- [Authorizing Access to Service Operations](../../../docs/framework/wcf/samples/authorizing-access-to-service-operations.md)\n- [Security Overview](../../../docs/framework/wcf/feature-details/security-overview.md)\n- [Implementing Service Contracts](../../../docs/framework/wcf/implementing-service-contracts.md)\n","nodes":[{"pos":[4,293],"embed":true,"restype":"x-metadata","content":"title: \"How to: Restrict Access with the PrincipalPermissionAttribute Class\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"PrincipalPermissionAttribute class\"\n  - \"WCF, authorization\"\n  - \"WCF, security\"\nms.assetid: 5162f5c4-8781-4cc4-9425-bb7620eaeaf4","nodes":[{"content":"How to: Restrict Access with the PrincipalPermissionAttribute Class","nodes":[{"pos":[0,67],"content":"How to: Restrict Access with the PrincipalPermissionAttribute Class","nodes":[{"content":"How to: Restrict Access with the PrincipalPermissionAttribute Class","pos":[0,67]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[300,367],"content":"How to: Restrict Access with the PrincipalPermissionAttribute Class","linkify":"How to: Restrict Access with the PrincipalPermissionAttribute Class","nodes":[{"content":"How to: Restrict Access with the PrincipalPermissionAttribute Class","pos":[0,67]}]},{"content":"Controlling the access to resources on a Windows-domain computer is a basic security task.","pos":[368,458]},{"content":"For example, only certain users should be able to view sensitive data, such as payroll information.","pos":[459,558]},{"content":"This topic explains how to restrict access to a method by demanding that the user belong to a predefined group.","pos":[559,670]},{"content":"For a working sample, see <bpt id=\"p1\">[</bpt>Authorizing Access to Service Operations<ept id=\"p1\">](../../../docs/framework/wcf/samples/authorizing-access-to-service-operations.md)</ept>.","pos":[671,821],"source":" For a working sample, see [Authorizing Access to Service Operations](../../../docs/framework/wcf/samples/authorizing-access-to-service-operations.md)."},{"content":"The task consists of two separate procedures.","pos":[828,873]},{"content":"The first creates the group and populates it with users.","pos":[874,930]},{"content":"The second applies the <ph id=\"ph1\">&lt;xref:System.Security.Permissions.PrincipalPermissionAttribute&gt;</ph> class to specify the group.","pos":[931,1045],"source":" The second applies the <xref:System.Security.Permissions.PrincipalPermissionAttribute> class to specify the group."},{"pos":[1055,1080],"content":"To create a Windows group","linkify":"To create a Windows group","nodes":[{"content":"To create a Windows group","pos":[0,25]}]},{"pos":[1090,1131],"content":"Open the <bpt id=\"p1\">**</bpt>Computer Management<ept id=\"p1\">**</ept> console.","source":"Open the **Computer Management** console."},{"pos":[1141,1193],"content":"In the left panel, click <bpt id=\"p1\">**</bpt>Local Users and Groups<ept id=\"p1\">**</ept>.","source":"In the left panel, click **Local Users and Groups**."},{"pos":[1203,1251],"content":"Right-click <bpt id=\"p1\">**</bpt>Groups<ept id=\"p1\">**</ept>, and click <bpt id=\"p2\">**</bpt>New Group<ept id=\"p2\">**</ept>.","source":"Right-click **Groups**, and click **New Group**."},{"pos":[1261,1318],"content":"In the <bpt id=\"p1\">**</bpt>Group Name<ept id=\"p1\">**</ept> box, type a name for the new group.","source":"In the **Group Name** box, type a name for the new group."},{"pos":[1328,1392],"content":"In the <bpt id=\"p1\">**</bpt>Description<ept id=\"p1\">**</ept> box, type a description of the new group.","source":"In the **Description** box, type a description of the new group."},{"pos":[1402,1459],"content":"Click the <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept> button to add new members to the group.","source":"Click the **Add** button to add new members to the group."},{"content":"If you have added yourself to the group and want to test the following code, you must log off the computer and log back on to be included in the group.","pos":[1469,1620]},{"pos":[1630,1655],"content":"To demand user membership","linkify":"To demand user membership","nodes":[{"content":"To demand user membership","pos":[0,25]}]},{"content":"Open the Windows Communication Foundation (WCF) code file that contains the implemented service contract code.","pos":[1665,1775]},{"content":"For more information about implementing a contract, see <bpt id=\"p1\">[</bpt>Implementing Service Contracts<ept id=\"p1\">](../../../docs/framework/wcf/implementing-service-contracts.md)</ept>.","pos":[1776,1928],"source":" For more information about implementing a contract, see [Implementing Service Contracts](../../../docs/framework/wcf/implementing-service-contracts.md)."},{"content":"Apply the <ph id=\"ph1\">&lt;xref:System.Security.Permissions.PrincipalPermissionAttribute&gt;</ph> attribute to each method that must be restricted to a specific group.","pos":[1938,2081],"source":"Apply the <xref:System.Security.Permissions.PrincipalPermissionAttribute> attribute to each method that must be restricted to a specific group."},{"content":"Set the <ph id=\"ph1\">&lt;xref:System.Security.Permissions.SecurityAttribute.Action%2A&gt;</ph> property to <ph id=\"ph2\">&lt;xref:System.Security.Permissions.SecurityAction.Demand&gt;</ph> and the <ph id=\"ph3\">&lt;xref:System.Security.Permissions.PrincipalPermissionAttribute.Role%2A&gt;</ph> property to the name of the group.","pos":[2082,2336],"source":" Set the <xref:System.Security.Permissions.SecurityAttribute.Action%2A> property to <xref:System.Security.Permissions.SecurityAction.Demand> and the <xref:System.Security.Permissions.PrincipalPermissionAttribute.Role%2A> property to the name of the group."},{"content":"For example:","pos":[2337,2349]},{"pos":[2360,2655],"content":"[!code-csharp[c_PrincipalPermissionAttribute#1](../../../samples/snippets/csharp/VS_Snippets_CFX/c_principalpermissionattribute/cs/source.cs#1)]\n [!code-vb[c_PrincipalPermissionAttribute#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_principalpermissionattribute/vb/source.vb#1)]","leadings":["","    "],"nodes":[]},{"pos":[2667,2899],"content":"[!NOTE]\nIf you apply the <xref:System.Security.Permissions.PrincipalPermissionAttribute> attribute to a contract a <xref:System.Security.SecurityException> will be thrown. You can only apply the attribute at the method level.","leadings":["","    >  "],"nodes":[{"content":"If you apply the <xref:System.Security.Permissions.PrincipalPermissionAttribute> attribute to a contract a <xref:System.Security.SecurityException> will be thrown. You can only apply the attribute at the method level.","pos":[8,225],"nodes":[{"content":"If you apply the <ph id=\"ph1\">&lt;xref:System.Security.Permissions.PrincipalPermissionAttribute&gt;</ph> attribute to a contract a <ph id=\"ph2\">&lt;xref:System.Security.SecurityException&gt;</ph> will be thrown.","pos":[0,163],"source":"If you apply the <xref:System.Security.Permissions.PrincipalPermissionAttribute> attribute to a contract a <xref:System.Security.SecurityException> will be thrown."},{"content":"You can only apply the attribute at the method level.","pos":[164,217]}]}]},{"pos":[2908,2957],"content":"Using a Certificate to Control Access to a Method","linkify":"Using a Certificate to Control Access to a Method","nodes":[{"content":"Using a Certificate to Control Access to a Method","pos":[0,49]}]},{"content":"You can also use the <ph id=\"ph1\">`PrincipalPermissionAttribute`</ph> class to control access to a method if the client credential type is a certificate.","pos":[2961,3096],"source":"You can also use the `PrincipalPermissionAttribute` class to control access to a method if the client credential type is a certificate."},{"content":"To do this, you must have the certificate's subject and thumbprint.","pos":[3097,3164]},{"content":"To examine a certificate for its properties, see <bpt id=\"p1\">[</bpt>How to: View Certificates with the MMC Snap-in<ept id=\"p1\">](../../../docs/framework/wcf/feature-details/how-to-view-certificates-with-the-mmc-snap-in.md)</ept>.","pos":[3171,3363],"source":"To examine a certificate for its properties, see [How to: View Certificates with the MMC Snap-in](../../../docs/framework/wcf/feature-details/how-to-view-certificates-with-the-mmc-snap-in.md)."},{"content":"To find the thumbprint value, see <bpt id=\"p1\">[</bpt>How to: Retrieve the Thumbprint of a Certificate<ept id=\"p1\">](../../../docs/framework/wcf/feature-details/how-to-retrieve-the-thumbprint-of-a-certificate.md)</ept>.","pos":[3364,3545],"source":" To find the thumbprint value, see [How to: Retrieve the Thumbprint of a Certificate](../../../docs/framework/wcf/feature-details/how-to-retrieve-the-thumbprint-of-a-certificate.md)."},{"pos":[3556,3593],"content":"To control access using a certificate","linkify":"To control access using a certificate","nodes":[{"content":"To control access using a certificate","pos":[0,37]}]},{"pos":[3603,3728],"content":"Apply the <ph id=\"ph1\">&lt;xref:System.Security.Permissions.PrincipalPermissionAttribute&gt;</ph> class to the method you want to restrict access to.","source":"Apply the <xref:System.Security.Permissions.PrincipalPermissionAttribute> class to the method you want to restrict access to."},{"pos":[3738,3859],"content":"Set the action of the attribute to <ph id=\"ph1\">&lt;xref:System.Security.Permissions.SecurityAction.Demand?displayProperty=nameWithType&gt;</ph>.","source":"Set the action of the attribute to <xref:System.Security.Permissions.SecurityAction.Demand?displayProperty=nameWithType>."},{"content":"Set the <ph id=\"ph1\">`Name`</ph> property to a string that consists of the subject name and the certificate's thumbprint.","pos":[3869,3972],"source":"Set the `Name` property to a string that consists of the subject name and the certificate's thumbprint."},{"content":"Separate the two values with a semicolon and a space, as shown in the following example:","pos":[3973,4061]},{"pos":[4072,4367],"content":"[!code-csharp[c_PrincipalPermissionAttribute#2](../../../samples/snippets/csharp/VS_Snippets_CFX/c_principalpermissionattribute/cs/source.cs#2)]\n [!code-vb[c_PrincipalPermissionAttribute#2](../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_principalpermissionattribute/vb/source.vb#2)]","leadings":["","    "],"nodes":[]},{"pos":[4377,4618],"content":"Set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.PrincipalPermissionMode%2A&gt;</ph> property to <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.PrincipalPermissionMode.UseAspNetRoles&gt;</ph> as shown in the following configuration example:","source":"Set the <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.PrincipalPermissionMode%2A> property to <xref:System.ServiceModel.Description.PrincipalPermissionMode.UseAspNetRoles> as shown in the following configuration example:"},{"content":"Setting this value to <ph id=\"ph1\">`UseAspNetRoles`</ph> indicates that the <ph id=\"ph2\">`Name`</ph> property of the <ph id=\"ph3\">`PrincipalPermissionAttribute`</ph> will be used to perform a string comparison.","pos":[4880,5036],"source":"Setting this value to `UseAspNetRoles` indicates that the `Name` property of the `PrincipalPermissionAttribute` will be used to perform a string comparison."},{"content":"When a certificate is used as a client credential, by default WCF concatenates the certificate common name and the thumbprint with a semicolon to create a unique value for the client's primary identity.","pos":[5037,5239]},{"content":"With <ph id=\"ph1\">`UseAspNetRoles`</ph> set as the <ph id=\"ph2\">`PrincipalPermissionMode`</ph> on the service, this primary identity value is compared with the <ph id=\"ph3\">`Name`</ph> property value to determine the access rights of the user.","pos":[5240,5429],"source":" With `UseAspNetRoles` set as the `PrincipalPermissionMode` on the service, this primary identity value is compared with the `Name` property value to determine the access rights of the user."},{"pos":[5440,5643],"content":"Alternatively, when creating a self-hosted service, set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.PrincipalPermissionMode%2A&gt;</ph> property in code as shown in the following code:","source":"Alternatively, when creating a self-hosted service, set the <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.PrincipalPermissionMode%2A> property in code as shown in the following code:"},{"pos":[5654,5949],"content":"[!code-csharp[c_PrincipalPermissionAttribute#3](../../../samples/snippets/csharp/VS_Snippets_CFX/c_principalpermissionattribute/cs/source.cs#3)]\n [!code-vb[c_PrincipalPermissionAttribute#3](../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_principalpermissionattribute/vb/source.vb#3)]","leadings":["","    "],"nodes":[]},{"pos":[5958,5966],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6235,6358],"content":"<bpt id=\"p1\">[</bpt>Authorizing Access to Service Operations<ept id=\"p1\">](../../../docs/framework/wcf/samples/authorizing-access-to-service-operations.md)</ept>","source":"[Authorizing Access to Service Operations](../../../docs/framework/wcf/samples/authorizing-access-to-service-operations.md)"},{"pos":[6361,6446],"content":"<bpt id=\"p1\">[</bpt>Security Overview<ept id=\"p1\">](../../../docs/framework/wcf/feature-details/security-overview.md)</ept>","source":"[Security Overview](../../../docs/framework/wcf/feature-details/security-overview.md)"},{"pos":[6449,6544],"content":"<bpt id=\"p1\">[</bpt>Implementing Service Contracts<ept id=\"p1\">](../../../docs/framework/wcf/implementing-service-contracts.md)</ept>","source":"[Implementing Service Contracts](../../../docs/framework/wcf/implementing-service-contracts.md)"}]}