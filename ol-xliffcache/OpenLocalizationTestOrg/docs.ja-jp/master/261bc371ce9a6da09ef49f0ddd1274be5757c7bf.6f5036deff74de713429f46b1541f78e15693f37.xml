{"content":"---\ntitle: \"XmlReader Sample\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"XML Reader\"\nms.assetid: 60e5848d-7d9c-4ea5-bed9-22758c9ac16c\n---\n# XmlReader Sample\nThe XmlReader sample demonstrates the processing of a message body using an <xref:System.Xml.XmlReader>. The sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md), which implements a calculator service. An additional service operation, `Sum`, has been added that accepts a message that contains an array of values to add together. The service reads the message using an <xref:System.Xml.XmlReader>.  \n  \n> [!NOTE]\n>  The setup procedure and build instructions for this sample are located at the end of this topic.  \n  \n The calculator interface includes a service operation named `Sum` that accepts a <xref:System.ServiceModel.Channels.Message> parameter, as shown in the following sample code.  \n  \n```csharp\npublic interface ICalculator  \n{  \n    [OperationContract]  \n    double Add(double n1, double n2);  \n    [OperationContract]  \n    double Subtract(double n1, double n2);  \n    [OperationContract]  \n    double Multiply(double n1, double n2);  \n    [OperationContract]  \n    double Divide(double n1, double n2);  \n    [OperationContract]  \n    Message Sum(Message message);  \n}  \n```  \n  \n The client accesses `Sum` by first creating an array of integer values, then creating a message from the array, and then calling the `Sum` method using the created message, as shown in the following sample code.  \n  \n```csharp\nCalculatorClient client = new CalculatorClient();  \n//...  \n\n// Call the Sum service operation.  \nint[] values = { 1, 2, 3, 4, 5 };  \nusing (new OperationContextScope(client.InnerChannel))  \n{  \n    Message request = Message.CreateMessage(OperationContext.Current.OutgoingMessageHeaders.MessageVersion, \"http://Microsoft.ServiceModel.Samples/ICalculator/Sum\", values);  \n    Message reply = client.Sum(request);  \n    int sum = reply.GetBody<int>();  \n  \n    Console.WriteLine(\"Sum(1,2,3,4,5) = {0}\", sum);  \n}  \n```  \n  \n In the service, the implementation of the service operation `Sum` accesses the message body using an <xref:System.Xml.XmlReader> object to iterate through the values to sum. The <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> method is called to access the message body, as shown in the following sample code.  \n  \n```csharp  \npublic int Sum(Message message)  \n{  \n    int sum = 0;  \n    string text = \"\";  \n  \n    //The body of the message contains a list of numbers that are read  \n    //directly using an XmlReader.  \n    XmlReader body = message.GetReaderAtBodyContents ();  \n    while (body.Read())  \n    {  \n        text = body.ReadString().Trim();  \n        if (text.Length>0)  \n        {  \n            sum += Convert.ToInt32(text);  \n        }  \n    }  \n    body.Close();  \n    Message response = Message.CreateMessage(  \n       \"http://Microsoft.ServiceModel.Samples/ICalculator/SumResponse\",  \n       sum);  \n    return response;  \n}  \n```  \n  \n When you run the sample, the requests and responses of the operation are displayed in the client console window. Press ENTER in the client window to shut down the client.  \n  \n```console  \nAdd(100,15.99) = 115.99  \nSubtract(145,76.54) = 68.46  \nMultiply(9,81.25) = 731.25  \nDivide(22,7) = 3.14285714285714  \nSum(1,2,3,4,5) = 15  \n  \nPress <ENTER> to terminate client.  \n```  \n  \n### To set up, build, and run the sample  \n  \n1.  Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).  \n  \n2.  To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).  \n  \n3.  To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Contract\\Message\\XmlReader`  \n","nodes":[{"pos":[4,139],"embed":true,"restype":"x-metadata","content":"title: \"XmlReader Sample\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"XML Reader\"\nms.assetid: 60e5848d-7d9c-4ea5-bed9-22758c9ac16c","nodes":[{"content":"XmlReader Sample","nodes":[{"pos":[0,16],"content":"XmlReader Sample","nodes":[{"content":"XmlReader Sample","pos":[0,16]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[146,162],"content":"XmlReader Sample","linkify":"XmlReader Sample","nodes":[{"content":"XmlReader Sample","pos":[0,16]}]},{"content":"The XmlReader sample demonstrates the processing of a message body using an <ph id=\"ph1\">&lt;xref:System.Xml.XmlReader&gt;</ph>.","pos":[163,267],"source":"The XmlReader sample demonstrates the processing of a message body using an <xref:System.Xml.XmlReader>."},{"content":"The sample is based on the <bpt id=\"p1\">[</bpt>Getting Started<ept id=\"p1\">](../../../../docs/framework/wcf/samples/getting-started-sample.md)</ept>, which implements a calculator service.","pos":[268,418],"source":" The sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md), which implements a calculator service."},{"content":"An additional service operation, <ph id=\"ph1\">`Sum`</ph>, has been added that accepts a message that contains an array of values to add together.","pos":[419,546],"source":" An additional service operation, `Sum`, has been added that accepts a message that contains an array of values to add together."},{"content":"The service reads the message using an <ph id=\"ph1\">&lt;xref:System.Xml.XmlReader&gt;</ph>.","pos":[547,614],"source":" The service reads the message using an <xref:System.Xml.XmlReader>."},{"pos":[622,729],"content":"[!NOTE]\n The setup procedure and build instructions for this sample are located at the end of this topic.","leadings":["","> "],"nodes":[{"content":"The setup procedure and build instructions for this sample are located at the end of this topic.","pos":[9,105]}]},{"pos":[736,910],"content":"The calculator interface includes a service operation named <ph id=\"ph1\">`Sum`</ph> that accepts a <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.Message&gt;</ph> parameter, as shown in the following sample code.","source":"The calculator interface includes a service operation named `Sum` that accepts a <xref:System.ServiceModel.Channels.Message> parameter, as shown in the following sample code."},{"pos":[1314,1525],"content":"The client accesses <ph id=\"ph1\">`Sum`</ph> by first creating an array of integer values, then creating a message from the array, and then calling the <ph id=\"ph2\">`Sum`</ph> method using the created message, as shown in the following sample code.","source":"The client accesses `Sum` by first creating an array of integer values, then creating a message from the array, and then calling the `Sum` method using the created message, as shown in the following sample code."},{"content":"In the service, the implementation of the service operation <ph id=\"ph1\">`Sum`</ph> accesses the message body using an <ph id=\"ph2\">&lt;xref:System.Xml.XmlReader&gt;</ph> object to iterate through the values to sum.","pos":[2064,2237],"source":"In the service, the implementation of the service operation `Sum` accesses the message body using an <xref:System.Xml.XmlReader> object to iterate through the values to sum."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A&gt;</ph> method is called to access the message body, as shown in the following sample code.","pos":[2238,2396],"source":" The <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> method is called to access the message body, as shown in the following sample code."},{"content":"When you run the sample, the requests and responses of the operation are displayed in the client console window.","pos":[3043,3155]},{"content":"Press ENTER in the client window to shut down the client.","pos":[3156,3213]},{"pos":[3426,3462],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[3472,3671],"content":"Ensure that you have performed the <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"pos":[3681,3890],"content":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"pos":[3900,4108],"content":"To run the sample in a single- or cross-machine configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"pos":[4116,4248],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[14,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[0,53]},{"content":"Check for the following (default) directory before continuing.","pos":[54,116]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[4302,4612],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[4613,4663]}]}