{"content":"---\ntitle: \"Walkthrough: Creating Custom Client and Service Credentials | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 2b5ba5c3-0c6c-48e9-9e46-54acaec443ba\ncaps.latest.revision: 13\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Walkthrough: Creating Custom Client and Service Credentials\nThis topic shows how to implement custom client and service credentials and how to use custom credentials from application code.  \n  \n## Credentials Extensibility Classes  \n The <xref:System.ServiceModel.Description.ClientCredentials> and <xref:System.ServiceModel.Description.ServiceCredentials> classes are the main entry points to the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] security extensibility. These credentials classes provide the APIs that enable application code to set credentials information and to convert credential types into security tokens. (*Security tokens* are the form used to transmit credential information inside SOAP messages.) The responsibilities of these credentials classes can be divided into two areas:  \n  \n-   Provide the APIs for applications to set credentials information.  \n  \n-   Perform as a factory for <xref:System.IdentityModel.Selectors.SecurityTokenManager> implementations.  \n  \n Both the <xref:System.ServiceModel.Description.ClientCredentials> and the <xref:System.ServiceModel.Description.ServiceCredentials> classes inherit from the abstract <xref:System.ServiceModel.Security.SecurityCredentialsManager> class that defines the contract for returning the <xref:System.IdentityModel.Selectors.SecurityTokenManager>.  \n  \n [!INCLUDE[crabout](../../../../includes/crabout-md.md)] the credentials classes and how they fit into the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] security architecture, see [Security Architecture](http://msdn.microsoft.com/en-us/16593476-d36a-408d-808c-ae6fd483e28f).  \n  \n The default implementations provided in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] support the system-provided credential types and create a security token manager that is capable of handling those credentials types.  \n  \n## Reasons to Customize  \n There are multiple reasons for customizing either client or service credential classes. Foremost is the requirement to change the default [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] security behavior with regard to handling system-provided credential types, especially for the following reasons:  \n  \n-   Changes that are not possible using other extensibility points.  \n  \n-   Adding new credential types.  \n  \n-   Adding new custom security token types.  \n  \n This topic describes how to implement custom client and service credentials and how to use them from application code.  \n  \n## First in a Series  \n Creating a custom credentials class is only the first step, because the reason for customizing credentials is to change [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] behavior regarding credentials provisioning, security token serialization, or authentication. Other topics in this section describe how to create custom serializers and authenticators. In this regard, creating custom credential class is the first topic in the series. Subsequent actions (creating custom serializers and authenticators) can be done only after creating custom credentials. Additional topics that build upon this topic include:  \n  \n-   [How to: Create a Custom Security Token Provider](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)  \n  \n-   [How to: Create a Custom Security Token Authenticator](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md)  \n  \n-   [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).  \n  \n## Procedures  \n  \n#### To implement custom client credentials  \n  \n1.  Define a new class derived from the <xref:System.ServiceModel.Description.ClientCredentials> class.  \n  \n2.  Optional. Add new methods or properties for new credential types. If you do not add new credential types, skip this step. The following example adds a `CreditCardNumber` property.  \n  \n3.  Override the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method. This method is automatically called by [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] security infrastructure when the custom client credential is used. This method is responsible for creating and returning an instance of an implementation of the <xref:System.IdentityModel.Selectors.SecurityTokenManager> class.  \n  \n    > [!IMPORTANT]\n    >  It is important to note that the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method is overridden to create a custom security token manager. The security token manager, derived from <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>, must return a custom security token provider, derived from <xref:System.IdentityModel.Selectors.SecurityTokenProvider>, to create the actual security token. If you do not follow this pattern for creating security tokens, your application may function incorrectly when <xref:System.ServiceModel.ChannelFactory> objects are cached (which is the default behavior for WCF client proxies), potentially resulting in an elevation of privilege attack. The custom credential object is cached as part of the <xref:System.ServiceModel.ChannelFactory>. However, the custom <xref:System.IdentityModel.Selectors.SecurityTokenManager> is created on every invocation, which mitigates the security threat as long as the token creation logic is placed in the <xref:System.IdentityModel.Selectors.SecurityTokenManager>.  \n  \n4.  Override the <xref:System.ServiceModel.Description.ClientCredentials.CloneCore%2A> method.  \n  \n     [!code-csharp[c_CustomCredentials#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#1)]\n     [!code-vb[c_CustomCredentials#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#1)]  \n  \n#### To implement a custom client security token manager  \n  \n1.  Define a new class derived from <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.  \n  \n2.  Optional. Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%28System.IdentityModel.Selectors.SecurityTokenRequirement%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenProvider> implementation must be created. [!INCLUDE[crabout](../../../../includes/crabout-md.md)]custom security token providers, see [How to: Create a Custom Security Token Provider](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md).  \n  \n3.  Optional. Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%28System.IdentityModel.Selectors.SecurityTokenRequirement%2CSystem.IdentityModel.Selectors.SecurityTokenResolver%40%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> implementation must be created. [!INCLUDE[crabout](../../../../includes/crabout-md.md)]custom security token authenticators, see [How to: Create a Custom Security Token Authenticator](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md).  \n  \n4.  Optional. Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> must be created. [!INCLUDE[crabout](../../../../includes/crabout-md.md)]custom security tokens and custom security token serializers, see [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).  \n  \n     [!code-csharp[c_CustomCredentials#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#2)]\n     [!code-vb[c_CustomCredentials#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#2)]  \n  \n#### To use a custom client credentials from application code  \n  \n1.  Either create an instance of the generated client that represents the service interface, or create an instance of the <xref:System.ServiceModel.ChannelFactory> pointing to a service you want to communicate with.  \n  \n2.  Remove the system-provided client credentials behavior from the <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A> collection, which can be accessed through the <xref:System.ServiceModel.ChannelFactory.Endpoint%2A> property.  \n  \n3.  Create a new instance of a custom client credentials class and add it to the <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A> collection, which can be accessed through the <xref:System.ServiceModel.ChannelFactory.Endpoint%2A> property.  \n  \n     [!code-csharp[c_CustomCredentials#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#3)]\n     [!code-vb[c_CustomCredentials#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#3)]  \n  \n The previous procedure shows how to use client credentials from application code. [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] credentials can also be configured using the application configuration file. Using application configuration is often preferable to hard-coding because it enables modification of application parameters without having to modify the source, recompiling, and redeployment.  \n  \n The next procedure describes how to provide support for configuration of custom credentials.  \n  \n#### Creating a configuration handler for custom client credentials  \n  \n1.  Define a new class derived from <xref:System.ServiceModel.Configuration.ClientCredentialsElement>.  \n  \n2.  Optional. Add properties for all additional configuration parameters that you want to expose through application configuration. The example below adds one property named `CreditCardNumber`.  \n  \n3.  Override the <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.BehaviorType%2A> property to return the type of the custom client credentials class created with the configuration element.  \n  \n4.  Override the <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.CreateBehavior%2A> method. The method is responsible for creating and returning an instance of the custom credential class based on the settings loaded from the configuration file. Call the base <xref:System.ServiceModel.Configuration.ClientCredentialsElement.ApplyConfiguration%28System.ServiceModel.Description.ClientCredentials%29> method from this method to retrieve the system-provided credentials settings loaded into your custom client credentials instance.  \n  \n5.  Optional. If you added additional properties in step 2, you need to override the <xref:System.Configuration.ConfigurationElement.Properties%2A> property in order to register your additional configuration settings for the configuration framework to recognize them. Combine your properties with the base class properties to allow the system-provided settings to be configured through this custom client credentials configuration element.  \n  \n     [!code-csharp[c_CustomCredentials#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#7)]\n     [!code-vb[c_CustomCredentials#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#7)]  \n  \n Once you have the configuration handler class, it can be integrated into the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] configuration framework. That enables the custom client credentials to be used in the client endpoint behavior elements, as shown in the next procedure.  \n  \n#### To register and use a custom client credentials configuration handler in the application configuration  \n  \n1.  Add an <`extensions`> element and a <`behaviorExtensions`> element to the configuration file.  \n  \n2.  Add an <`add`> element to the <`behaviorExtensions`> element and set the `name` attribute to an appropriate value.  \n  \n3.  Set the `type` attribute to the fully-qualified type name. Also include the assembly name and other assembly attributes.  \n  \n    ```  \n    <system.serviceModel>  \n      <extensions>  \n        <behaviorExtensions>  \n          <add name=\"myClientCredentials\" type=\"Microsoft.ServiceModel.Samples.MyClientCredentialsConfigHandler, CustomCredentials, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\" />  \n        </behaviorExtensions>  \n      </extensions>  \n    <system.serviceModel>  \n    ```  \n  \n4.  After registering your configuration handler, the custom credentials element can be used inside the same configuration file instead of the system-provided <`clientCredentials`> element. You can use both the system-provided properties and any new properties that you have added to your configuration handler implementation. The following example sets the value of a custom property using the `creditCardNumber` attribute.  \n  \n    ```  \n    <behaviors>  \n      <endpointBehaviors>  \n        <behavior name=\"myClientCredentialsBehavior\">  \n          <myClientCredentials creditCardNumber=\"123-123-123\"/>  \n        </behavior>  \n      </endpointBehaviors>  \n    </behaviors>  \n    ```  \n  \n#### To implement custom service credentials  \n  \n1.  Define a new class derived from <xref:System.ServiceModel.Description.ServiceCredentials>.  \n  \n2.  Optional. Add new properties to provide APIs for new credential values that are being added. If you do not add new credential values, skip this step. The following example adds an `AdditionalCertificate` property.  \n  \n3.  Override the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method. This method is automatically called by the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] infrastructure when the custom client credential is used. The method is responsible for creating and returning an instance of an implementation of the <xref:System.IdentityModel.Selectors.SecurityTokenManager> class (described in the next procedure).  \n  \n4.  Optional. Override the <xref:System.ServiceModel.Description.ServiceCredentials.CloneCore%2A> method. This is required only if adding new properties or internal fields to the custom client credentials implementation.  \n  \n     [!code-csharp[c_CustomCredentials#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#4)]\n     [!code-vb[c_CustomCredentials#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#4)]  \n  \n#### To implement a custom service security token manager  \n  \n1.  Define a new class derived from the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class.  \n  \n2.  Optional. Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenProvider> implementation must be created. [!INCLUDE[crabout](../../../../includes/crabout-md.md)]custom security token providers, see [How to: Create a Custom Security Token Provider](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md).  \n  \n3.  Optional. Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> implementation must be created. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] custom security token authenticators, see [How to: Create a Custom Security Token Authenticator](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md) topic.  \n  \n4.  Optional. Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%28System.IdentityModel.Selectors.SecurityTokenVersion%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> must be created. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] custom security tokens and custom security token serializers, see [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).  \n  \n     [!code-csharp[c_CustomCredentials#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#5)]\n     [!code-vb[c_CustomCredentials#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#5)]  \n  \n#### To use custom service credentials from application code  \n  \n1.  Create an instance of the <xref:System.ServiceModel.ServiceHost>.  \n  \n2.  Remove the system-provided service credentials behavior from the <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A> collection.  \n  \n3.  Create a new instance of the custom service credentials class and add it to the <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A> collection.  \n  \n     [!code-csharp[c_CustomCredentials#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#6)]\n     [!code-vb[c_CustomCredentials#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#6)]  \n  \n Add support for configuration using the steps described previously in the procedures \"`To create a configuration handler for custom client credentials`\" and \"`To register and use a custom client credentials configuration handler in the application configuration`.\" The only difference is to use the <xref:System.ServiceModel.Configuration.ServiceCredentialsElement> class instead of the <xref:System.ServiceModel.Configuration.ClientCredentialsElement> class as a base class for the configuration handler. The custom service credential element can then be used wherever the system-provided `<serviceCredentials>` element is used.  \n  \n## See Also  \n <xref:System.ServiceModel.Description.ClientCredentials>   \n <xref:System.ServiceModel.Description.ServiceCredentials>   \n <xref:System.ServiceModel.Security.SecurityCredentialsManager>   \n <xref:System.IdentityModel.Selectors.SecurityTokenManager>   \n <xref:System.ServiceModel.Configuration.ClientCredentialsElement>   \n <xref:System.ServiceModel.Configuration.ServiceCredentialsElement>   \n [How to: Create a Custom Security Token Provider](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)   \n [How to: Create a Custom Security Token Authenticator](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md)   \n [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md)","nodes":[{"pos":[12,88],"content":"Walkthrough: Creating Custom Client and Service Credentials | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Walkthrough: Creating Custom Client and Service Credentials | Microsoft Docs","pos":[0,76]}]},{"pos":[387,446],"content":"Walkthrough: Creating Custom Client and Service Credentials","linkify":"Walkthrough: Creating Custom Client and Service Credentials","nodes":[{"content":"Walkthrough: Creating Custom Client and Service Credentials","pos":[0,59]}]},{"content":"This topic shows how to implement custom client and service credentials and how to use custom credentials from application code.","pos":[447,575]},{"pos":[584,617],"content":"Credentials Extensibility Classes","linkify":"Credentials Extensibility Classes","nodes":[{"content":"Credentials Extensibility Classes","pos":[0,33]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ClientCredentials&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.ServiceCredentials&gt;</ph> classes are the main entry points to the <ph id=\"ph3\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> security extensibility.","pos":[621,864],"source":"The <xref:System.ServiceModel.Description.ClientCredentials> and <xref:System.ServiceModel.Description.ServiceCredentials> classes are the main entry points to the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] security extensibility."},{"content":"These credentials classes provide the APIs that enable application code to set credentials information and to convert credential types into security tokens.","pos":[865,1021]},{"content":"(<bpt id=\"p1\">*</bpt>Security tokens<ept id=\"p1\">*</ept> are the form used to transmit credential information inside SOAP messages.) The responsibilities of these credentials classes can be divided into two areas:","pos":[1022,1197],"source":" (*Security tokens* are the form used to transmit credential information inside SOAP messages.) The responsibilities of these credentials classes can be divided into two areas:"},{"content":"Provide the APIs for applications to set credentials information.","pos":[1207,1272]},{"content":"Perform as a factory for <ph id=\"ph1\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenManager&gt;</ph> implementations.","pos":[1282,1382],"source":"Perform as a factory for <xref:System.IdentityModel.Selectors.SecurityTokenManager> implementations."},{"content":"Both the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ClientCredentials&gt;</ph> and the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.ServiceCredentials&gt;</ph> classes inherit from the abstract <ph id=\"ph3\">&lt;xref:System.ServiceModel.Security.SecurityCredentialsManager&gt;</ph> class that defines the contract for returning the <ph id=\"ph4\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenManager&gt;</ph>.","pos":[1389,1727],"source":"Both the <xref:System.ServiceModel.Description.ClientCredentials> and the <xref:System.ServiceModel.Description.ServiceCredentials> classes inherit from the abstract <xref:System.ServiceModel.Security.SecurityCredentialsManager> class that defines the contract for returning the <xref:System.IdentityModel.Selectors.SecurityTokenManager>."},{"pos":[1734,2017],"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> the credentials classes and how they fit into the <ph id=\"ph2\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> security architecture, see <bpt id=\"p1\">[</bpt>Security Architecture<ept id=\"p1\">](http://msdn.microsoft.com/en-us/16593476-d36a-408d-808c-ae6fd483e28f)</ept>.","source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] the credentials classes and how they fit into the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] security architecture, see [Security Architecture](http://msdn.microsoft.com/en-us/16593476-d36a-408d-808c-ae6fd483e28f)."},{"pos":[2024,2253],"content":"The default implementations provided in <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> support the system-provided credential types and create a security token manager that is capable of handling those credentials types.","source":"The default implementations provided in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] support the system-provided credential types and create a security token manager that is capable of handling those credentials types."},{"pos":[2262,2282],"content":"Reasons to Customize","linkify":"Reasons to Customize","nodes":[{"content":"Reasons to Customize","pos":[0,20]}]},{"content":"There are multiple reasons for customizing either client or service credential classes.","pos":[2286,2373]},{"content":"Foremost is the requirement to change the default <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> security behavior with regard to handling system-provided credential types, especially for the following reasons:","pos":[2374,2593],"source":" Foremost is the requirement to change the default [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] security behavior with regard to handling system-provided credential types, especially for the following reasons:"},{"content":"Changes that are not possible using other extensibility points.","pos":[2603,2666]},{"content":"Adding new credential types.","pos":[2676,2704]},{"content":"Adding new custom security token types.","pos":[2714,2753]},{"content":"This topic describes how to implement custom client and service credentials and how to use them from application code.","pos":[2760,2878]},{"pos":[2887,2904],"content":"First in a Series","linkify":"First in a Series","nodes":[{"content":"First in a Series","pos":[0,17]}]},{"content":"Creating a custom credentials class is only the first step, because the reason for customizing credentials is to change <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> behavior regarding credentials provisioning, security token serialization, or authentication.","pos":[2908,3177],"source":"Creating a custom credentials class is only the first step, because the reason for customizing credentials is to change [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] behavior regarding credentials provisioning, security token serialization, or authentication."},{"content":"Other topics in this section describe how to create custom serializers and authenticators.","pos":[3178,3268]},{"content":"In this regard, creating custom credential class is the first topic in the series.","pos":[3269,3351]},{"content":"Subsequent actions (creating custom serializers and authenticators) can be done only after creating custom credentials.","pos":[3352,3471]},{"content":"Additional topics that build upon this topic include:","pos":[3472,3525]},{"pos":[3535,3676],"content":"<bpt id=\"p1\">[</bpt>How to: Create a Custom Security Token Provider<ept id=\"p1\">](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)</ept>","source":"[How to: Create a Custom Security Token Provider](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)"},{"pos":[3686,3837],"content":"<bpt id=\"p1\">[</bpt>How to: Create a Custom Security Token Authenticator<ept id=\"p1\">](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md)</ept>","source":"[How to: Create a Custom Security Token Authenticator](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md)"},{"pos":[3847,3953],"content":"<bpt id=\"p1\">[</bpt>How to: Create a Custom Token<ept id=\"p1\">](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md)</ept>.","source":"[How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md)."},{"pos":[3962,3972],"content":"Procedures","linkify":"Procedures","nodes":[{"content":"Procedures","pos":[0,10]}]},{"pos":[3983,4021],"content":"To implement custom client credentials","linkify":"To implement custom client credentials","nodes":[{"content":"To implement custom client credentials","pos":[0,38]}]},{"content":"Define a new class derived from the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ClientCredentials&gt;</ph> class.","pos":[4031,4130],"source":"Define a new class derived from the <xref:System.ServiceModel.Description.ClientCredentials> class."},{"content":"Optional.","pos":[4140,4149]},{"content":"Add new methods or properties for new credential types.","pos":[4150,4205]},{"content":"If you do not add new credential types, skip this step.","pos":[4206,4261]},{"content":"The following example adds a <ph id=\"ph1\">`CreditCardNumber`</ph> property.","pos":[4262,4319],"source":" The following example adds a `CreditCardNumber` property."},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A&gt;</ph> method.","pos":[4329,4442],"source":"Override the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method."},{"content":"This method is automatically called by <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> security infrastructure when the custom client credential is used.","pos":[4443,4604],"source":" This method is automatically called by [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] security infrastructure when the custom client credential is used."},{"content":"This method is responsible for creating and returning an instance of an implementation of the <ph id=\"ph1\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenManager&gt;</ph> class.","pos":[4605,4764],"source":" This method is responsible for creating and returning an instance of an implementation of the <xref:System.IdentityModel.Selectors.SecurityTokenManager> class."},{"pos":[4776,5893],"content":"[!IMPORTANT]\nIt is important to note that the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method is overridden to create a custom security token manager. The security token manager, derived from <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>, must return a custom security token provider, derived from <xref:System.IdentityModel.Selectors.SecurityTokenProvider>, to create the actual security token. If you do not follow this pattern for creating security tokens, your application may function incorrectly when <xref:System.ServiceModel.ChannelFactory> objects are cached (which is the default behavior for WCF client proxies), potentially resulting in an elevation of privilege attack. The custom credential object is cached as part of the <xref:System.ServiceModel.ChannelFactory>. However, the custom <xref:System.IdentityModel.Selectors.SecurityTokenManager> is created on every invocation, which mitigates the security threat as long as the token creation logic is placed in the <xref:System.IdentityModel.Selectors.SecurityTokenManager>.","leadings":["","    >  "],"nodes":[{"content":"It is important to note that the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method is overridden to create a custom security token manager. The security token manager, derived from <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>, must return a custom security token provider, derived from <xref:System.IdentityModel.Selectors.SecurityTokenProvider>, to create the actual security token. If you do not follow this pattern for creating security tokens, your application may function incorrectly when <xref:System.ServiceModel.ChannelFactory> objects are cached (which is the default behavior for WCF client proxies), potentially resulting in an elevation of privilege attack. The custom credential object is cached as part of the <xref:System.ServiceModel.ChannelFactory>. However, the custom <xref:System.IdentityModel.Selectors.SecurityTokenManager> is created on every invocation, which mitigates the security threat as long as the token creation logic is placed in the <xref:System.IdentityModel.Selectors.SecurityTokenManager>.","pos":[13,1110],"nodes":[{"content":"It is important to note that the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A&gt;</ph> method is overridden to create a custom security token manager.","pos":[0,189],"source":"It is important to note that the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method is overridden to create a custom security token manager."},{"content":"The security token manager, derived from <ph id=\"ph1\">&lt;xref:System.ServiceModel.ClientCredentialsSecurityTokenManager&gt;</ph>, must return a custom security token provider, derived from <ph id=\"ph2\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenProvider&gt;</ph>, to create the actual security token.","pos":[190,453],"source":" The security token manager, derived from <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>, must return a custom security token provider, derived from <xref:System.IdentityModel.Selectors.SecurityTokenProvider>, to create the actual security token."},{"content":"If you do not follow this pattern for creating security tokens, your application may function incorrectly when <ph id=\"ph1\">&lt;xref:System.ServiceModel.ChannelFactory&gt;</ph> objects are cached (which is the default behavior for WCF client proxies), potentially resulting in an elevation of privilege attack.","pos":[454,740],"source":" If you do not follow this pattern for creating security tokens, your application may function incorrectly when <xref:System.ServiceModel.ChannelFactory> objects are cached (which is the default behavior for WCF client proxies), potentially resulting in an elevation of privilege attack."},{"content":"The custom credential object is cached as part of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ChannelFactory&gt;</ph>.","pos":[741,837],"source":" The custom credential object is cached as part of the <xref:System.ServiceModel.ChannelFactory>."},{"content":"However, the custom <ph id=\"ph1\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenManager&gt;</ph> is created on every invocation, which mitigates the security threat as long as the token creation logic is placed in the <ph id=\"ph2\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenManager&gt;</ph>.","pos":[838,1097],"source":" However, the custom <xref:System.IdentityModel.Selectors.SecurityTokenManager> is created on every invocation, which mitigates the security threat as long as the token creation logic is placed in the <xref:System.IdentityModel.Selectors.SecurityTokenManager>."}]}]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ClientCredentials.CloneCore%2A&gt;</ph> method.","pos":[5903,5993],"source":"Override the <xref:System.ServiceModel.Description.ClientCredentials.CloneCore%2A> method."},{"pos":[6004,6268],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_CustomCredentials#1<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#1)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_CustomCredentials#1<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#1)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[c_CustomCredentials#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#1)]\n [!code-vb[c_CustomCredentials#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#1)]"},{"pos":[6279,6330],"content":"To implement a custom client security token manager","linkify":"To implement a custom client security token manager","nodes":[{"content":"To implement a custom client security token manager","pos":[0,51]}]},{"content":"Define a new class derived from <ph id=\"ph1\">&lt;xref:System.ServiceModel.ClientCredentialsSecurityTokenManager&gt;</ph>.","pos":[6340,6437],"source":"Define a new class derived from <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>."},{"content":"Optional.","pos":[6447,6456]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%28System.IdentityModel.Selectors.SecurityTokenRequirement%29&gt;</ph> method if a custom <ph id=\"ph2\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenProvider&gt;</ph> implementation must be created.","pos":[6457,6728],"source":" Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%28System.IdentityModel.Selectors.SecurityTokenRequirement%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenProvider> implementation must be created."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph>custom security token providers, see <bpt id=\"p1\">[</bpt>How to: Create a Custom Security Token Provider<ept id=\"p1\">](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)</ept>.","pos":[6729,6963],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)]custom security token providers, see [How to: Create a Custom Security Token Provider](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)."},{"content":"Optional.","pos":[6973,6982]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%28System.IdentityModel.Selectors.SecurityTokenRequirement%2CSystem.IdentityModel.Selectors.SecurityTokenResolver%40%29&gt;</ph> method if a custom <ph id=\"ph2\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator&gt;</ph> implementation must be created.","pos":[6983,7322],"source":" Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%28System.IdentityModel.Selectors.SecurityTokenRequirement%2CSystem.IdentityModel.Selectors.SecurityTokenResolver%40%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> implementation must be created."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph>custom security token authenticators, see <bpt id=\"p1\">[</bpt>How to: Create a Custom Security Token Authenticator<ept id=\"p1\">](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md)</ept>.","pos":[7323,7572],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)]custom security token authenticators, see [How to: Create a Custom Security Token Authenticator](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md)."},{"content":"Optional.","pos":[7582,7591]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%2A&gt;</ph> method if a custom <ph id=\"ph2\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenSerializer&gt;</ph> must be created.","pos":[7592,7794],"source":" Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> must be created."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph>custom security tokens and custom security token serializers, see <bpt id=\"p1\">[</bpt>How to: Create a Custom Token<ept id=\"p1\">](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md)</ept>.","pos":[7795,8022],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)]custom security tokens and custom security token serializers, see [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md)."},{"pos":[8033,8297],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_CustomCredentials#2<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#2)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_CustomCredentials#2<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#2)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[c_CustomCredentials#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#2)]\n [!code-vb[c_CustomCredentials#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#2)]"},{"pos":[8308,8364],"content":"To use a custom client credentials from application code","linkify":"To use a custom client credentials from application code","nodes":[{"content":"To use a custom client credentials from application code","pos":[0,56]}]},{"content":"Either create an instance of the generated client that represents the service interface, or create an instance of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ChannelFactory&gt;</ph> pointing to a service you want to communicate with.","pos":[8374,8585],"source":"Either create an instance of the generated client that represents the service interface, or create an instance of the <xref:System.ServiceModel.ChannelFactory> pointing to a service you want to communicate with."},{"content":"Remove the system-provided client credentials behavior from the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A&gt;</ph> collection, which can be accessed through the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ChannelFactory.Endpoint%2A&gt;</ph> property.","pos":[8595,8836],"source":"Remove the system-provided client credentials behavior from the <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A> collection, which can be accessed through the <xref:System.ServiceModel.ChannelFactory.Endpoint%2A> property."},{"content":"Create a new instance of a custom client credentials class and add it to the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A&gt;</ph> collection, which can be accessed through the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ChannelFactory.Endpoint%2A&gt;</ph> property.","pos":[8846,9100],"source":"Create a new instance of a custom client credentials class and add it to the <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A> collection, which can be accessed through the <xref:System.ServiceModel.ChannelFactory.Endpoint%2A> property."},{"pos":[9111,9375],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_CustomCredentials#3<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#3)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_CustomCredentials#3<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#3)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[c_CustomCredentials#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#3)]\n [!code-vb[c_CustomCredentials#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#3)]"},{"content":"The previous procedure shows how to use client credentials from application code.","pos":[9382,9463]},{"content":"<ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> credentials can also be configured using the application configuration file.","pos":[9464,9596],"source":"[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] credentials can also be configured using the application configuration file."},{"content":"Using application configuration is often preferable to hard-coding because it enables modification of application parameters without having to modify the source, recompiling, and redeployment.","pos":[9597,9789]},{"content":"The next procedure describes how to provide support for configuration of custom credentials.","pos":[9796,9888]},{"pos":[9899,9961],"content":"Creating a configuration handler for custom client credentials","linkify":"Creating a configuration handler for custom client credentials","nodes":[{"content":"Creating a configuration handler for custom client credentials","pos":[0,62]}]},{"content":"Define a new class derived from <ph id=\"ph1\">&lt;xref:System.ServiceModel.Configuration.ClientCredentialsElement&gt;</ph>.","pos":[9971,10069],"source":"Define a new class derived from <xref:System.ServiceModel.Configuration.ClientCredentialsElement>."},{"content":"Optional.","pos":[10079,10088]},{"content":"Add properties for all additional configuration parameters that you want to expose through application configuration.","pos":[10089,10206]},{"content":"The example below adds one property named <ph id=\"ph1\">`CreditCardNumber`</ph>.","pos":[10207,10268],"source":" The example below adds one property named `CreditCardNumber`."},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Configuration.BehaviorExtensionElement.BehaviorType%2A&gt;</ph> property to return the type of the custom client credentials class created with the configuration element.","pos":[10278,10479],"source":"Override the <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.BehaviorType%2A> property to return the type of the custom client credentials class created with the configuration element."},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Configuration.BehaviorExtensionElement.CreateBehavior%2A&gt;</ph> method.","pos":[10489,10593],"source":"Override the <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.CreateBehavior%2A> method."},{"content":"The method is responsible for creating and returning an instance of the custom credential class based on the settings loaded from the configuration file.","pos":[10594,10747]},{"content":"Call the base <ph id=\"ph1\">&lt;xref:System.ServiceModel.Configuration.ClientCredentialsElement.ApplyConfiguration%28System.ServiceModel.Description.ClientCredentials%29&gt;</ph> method from this method to retrieve the system-provided credentials settings loaded into your custom client credentials instance.","pos":[10748,11031],"source":" Call the base <xref:System.ServiceModel.Configuration.ClientCredentialsElement.ApplyConfiguration%28System.ServiceModel.Description.ClientCredentials%29> method from this method to retrieve the system-provided credentials settings loaded into your custom client credentials instance."},{"content":"Optional.","pos":[11041,11050]},{"content":"If you added additional properties in step 2, you need to override the <ph id=\"ph1\">&lt;xref:System.Configuration.ConfigurationElement.Properties%2A&gt;</ph> property in order to register your additional configuration settings for the configuration framework to recognize them.","pos":[11051,11304],"source":" If you added additional properties in step 2, you need to override the <xref:System.Configuration.ConfigurationElement.Properties%2A> property in order to register your additional configuration settings for the configuration framework to recognize them."},{"content":"Combine your properties with the base class properties to allow the system-provided settings to be configured through this custom client credentials configuration element.","pos":[11305,11476]},{"pos":[11487,11753],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_CustomCredentials#7<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#7)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_CustomCredentials#7<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#7)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[c_CustomCredentials#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#7)]\n [!code-vb[c_CustomCredentials#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#7)]"},{"content":"Once you have the configuration handler class, it can be integrated into the <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> configuration framework.","pos":[11760,11917],"source":"Once you have the configuration handler class, it can be integrated into the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] configuration framework."},{"content":"That enables the custom client credentials to be used in the client endpoint behavior elements, as shown in the next procedure.","pos":[11918,12045]},{"pos":[12056,12158],"content":"To register and use a custom client credentials configuration handler in the application configuration","linkify":"To register and use a custom client credentials configuration handler in the application configuration","nodes":[{"content":"To register and use a custom client credentials configuration handler in the application configuration","pos":[0,102]}]},{"pos":[12168,12261],"content":"Add an &lt;<ph id=\"ph1\">`extensions`</ph>&gt; element and a &lt;<ph id=\"ph2\">`behaviorExtensions`</ph>&gt; element to the configuration file.","source":"Add an <`extensions`> element and a <`behaviorExtensions`> element to the configuration file."},{"pos":[12271,12385],"content":"Add an &lt;<ph id=\"ph1\">`add`</ph>&gt; element to the &lt;<ph id=\"ph2\">`behaviorExtensions`</ph>&gt; element and set the <ph id=\"ph3\">`name`</ph> attribute to an appropriate value.","source":"Add an <`add`> element to the <`behaviorExtensions`> element and set the `name` attribute to an appropriate value."},{"content":"Set the <ph id=\"ph1\">`type`</ph> attribute to the fully-qualified type name.","pos":[12395,12453],"source":"Set the `type` attribute to the fully-qualified type name."},{"content":"Also include the assembly name and other assembly attributes.","pos":[12454,12515]},{"content":"After registering your configuration handler, the custom credentials element can be used inside the same configuration file instead of the system-provided &lt;<ph id=\"ph1\">`clientCredentials`</ph>&gt; element.","pos":[12902,13087],"source":"After registering your configuration handler, the custom credentials element can be used inside the same configuration file instead of the system-provided <`clientCredentials`> element."},{"content":"You can use both the system-provided properties and any new properties that you have added to your configuration handler implementation.","pos":[13088,13224]},{"content":"The following example sets the value of a custom property using the <ph id=\"ph1\">`creditCardNumber`</ph> attribute.","pos":[13225,13322],"source":" The following example sets the value of a custom property using the `creditCardNumber` attribute."},{"pos":[13594,13633],"content":"To implement custom service credentials","linkify":"To implement custom service credentials","nodes":[{"content":"To implement custom service credentials","pos":[0,39]}]},{"content":"Define a new class derived from <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceCredentials&gt;</ph>.","pos":[13643,13733],"source":"Define a new class derived from <xref:System.ServiceModel.Description.ServiceCredentials>."},{"content":"Optional.","pos":[13743,13752]},{"content":"Add new properties to provide APIs for new credential values that are being added.","pos":[13753,13835]},{"content":"If you do not add new credential values, skip this step.","pos":[13836,13892]},{"content":"The following example adds an <ph id=\"ph1\">`AdditionalCertificate`</ph> property.","pos":[13893,13956],"source":" The following example adds an `AdditionalCertificate` property."},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A&gt;</ph> method.","pos":[13966,14079],"source":"Override the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method."},{"content":"This method is automatically called by the <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> infrastructure when the custom client credential is used.","pos":[14080,14236],"source":" This method is automatically called by the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] infrastructure when the custom client credential is used."},{"content":"The method is responsible for creating and returning an instance of an implementation of the <ph id=\"ph1\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenManager&gt;</ph> class (described in the next procedure).","pos":[14237,14429],"source":" The method is responsible for creating and returning an instance of an implementation of the <xref:System.IdentityModel.Selectors.SecurityTokenManager> class (described in the next procedure)."},{"content":"Optional.","pos":[14439,14448]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceCredentials.CloneCore%2A&gt;</ph> method.","pos":[14449,14540],"source":" Override the <xref:System.ServiceModel.Description.ServiceCredentials.CloneCore%2A> method."},{"content":"This is required only if adding new properties or internal fields to the custom client credentials implementation.","pos":[14541,14655]},{"pos":[14666,14932],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_CustomCredentials#4<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#4)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_CustomCredentials#4<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#4)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[c_CustomCredentials#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#4)]\n [!code-vb[c_CustomCredentials#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#4)]"},{"pos":[14943,14995],"content":"To implement a custom service security token manager","linkify":"To implement a custom service security token manager","nodes":[{"content":"To implement a custom service security token manager","pos":[0,52]}]},{"content":"Define a new class derived from the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager&gt;</ph> class.","pos":[15005,15122],"source":"Define a new class derived from the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class."},{"content":"Optional.","pos":[15132,15141]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%2A&gt;</ph> method if a custom <ph id=\"ph2\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenProvider&gt;</ph> implementation must be created.","pos":[15142,15355],"source":" Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenProvider> implementation must be created."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph>custom security token providers, see <bpt id=\"p1\">[</bpt>How to: Create a Custom Security Token Provider<ept id=\"p1\">](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)</ept>.","pos":[15356,15590],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)]custom security token providers, see [How to: Create a Custom Security Token Provider](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)."},{"content":"Optional.","pos":[15600,15609]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A&gt;</ph> method if a custom <ph id=\"ph2\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator&gt;</ph> implementation must be created.","pos":[15610,15833],"source":" Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> implementation must be created."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> custom security token authenticators, see <bpt id=\"p1\">[</bpt>How to: Create a Custom Security Token Authenticator<ept id=\"p1\">](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md)</ept> topic.","pos":[15834,16090],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] custom security token authenticators, see [How to: Create a Custom Security Token Authenticator](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md) topic."},{"content":"Optional.","pos":[16100,16109]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%28System.IdentityModel.Selectors.SecurityTokenVersion%29&gt;</ph> method if a custom <ph id=\"ph2\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenSerializer&gt;</ph> must be created.","pos":[16110,16366],"source":" Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%28System.IdentityModel.Selectors.SecurityTokenVersion%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> must be created."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> custom security tokens and custom security token serializers, see <bpt id=\"p1\">[</bpt>How to: Create a Custom Token<ept id=\"p1\">](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md)</ept>.","pos":[16367,16595],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] custom security tokens and custom security token serializers, see [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md)."},{"pos":[16606,16872],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_CustomCredentials#5<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#5)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_CustomCredentials#5<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#5)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[c_CustomCredentials#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#5)]\n [!code-vb[c_CustomCredentials#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#5)]"},{"pos":[16883,16938],"content":"To use custom service credentials from application code","linkify":"To use custom service credentials from application code","nodes":[{"content":"To use custom service credentials from application code","pos":[0,55]}]},{"content":"Create an instance of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph>.","pos":[16948,17013],"source":"Create an instance of the <xref:System.ServiceModel.ServiceHost>."},{"content":"Remove the system-provided service credentials behavior from the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A&gt;</ph> collection.","pos":[17023,17170],"source":"Remove the system-provided service credentials behavior from the <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A> collection."},{"content":"Create a new instance of the custom service credentials class and add it to the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A&gt;</ph> collection.","pos":[17180,17342],"source":"Create a new instance of the custom service credentials class and add it to the <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A> collection."},{"pos":[17353,17619],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_CustomCredentials#6<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#6)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_CustomCredentials#6<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#6)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[c_CustomCredentials#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#6)]\n [!code-vb[c_CustomCredentials#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#6)]"},{"content":"Add support for configuration using the steps described previously in the procedures \"<ph id=\"ph1\">`To create a configuration handler for custom client credentials`</ph>\" and \"<ph id=\"ph2\">`To register and use a custom client credentials configuration handler in the application configuration`</ph>.\" The only difference is to use the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Configuration.ServiceCredentialsElement&gt;</ph> class instead of the <ph id=\"ph4\">&lt;xref:System.ServiceModel.Configuration.ClientCredentialsElement&gt;</ph> class as a base class for the configuration handler.","pos":[17626,18131],"source":"Add support for configuration using the steps described previously in the procedures \"`To create a configuration handler for custom client credentials`\" and \"`To register and use a custom client credentials configuration handler in the application configuration`.\" The only difference is to use the <xref:System.ServiceModel.Configuration.ServiceCredentialsElement> class instead of the <xref:System.ServiceModel.Configuration.ClientCredentialsElement> class as a base class for the configuration handler."},{"content":"The custom service credential element can then be used wherever the system-provided <ph id=\"ph1\">`&lt;serviceCredentials&gt;`</ph> element is used.","pos":[18132,18255],"source":" The custom service credential element can then be used wherever the system-provided `<serviceCredentials>` element is used."},{"pos":[18264,18272],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\"> [</bpt>How to: Create a Custom Security Token Provider<ept id=\"p1\">](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)</ept><ph id=\"ph1\"> </ph>","pos":[18669,18812],"source":" [How to: Create a Custom Security Token Provider](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md) "},{"content":"<bpt id=\"p1\"> [</bpt>How to: Create a Custom Security Token Authenticator<ept id=\"p1\">](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md)</ept><ph id=\"ph1\"> </ph>","pos":[18815,18968],"source":" [How to: Create a Custom Security Token Authenticator](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md) "},{"content":"<bpt id=\"p1\"> [</bpt>How to: Create a Custom Token<ept id=\"p1\">](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md)</ept>","pos":[18971,19077],"source":" [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md)"}]}