{"content":"---\ntitle: \"Replay Attacks\"\nms.date: \"03/30/2017\"\nms.assetid: 7a17e040-93cd-4432-81b9-9f62fec78c8f\n---\n# Replay Attacks\nA *replay attack* occurs when an attacker copies a stream of messages between two parties and replays the stream to one or more of the parties. Unless mitigated, the computers subject to the attack process the stream as legitimate messages, resulting in a range of bad consequences, such as redundant orders of an item.  \n  \n## Bindings May Be Subject to Reflection Attacks  \n *Reflection attacks* are replays of messages back to a sender as if they came from the receiver as the reply. The standard *replay detection* in the Windows Communication Foundation (WCF) mechanism does not automatically handle this.  \n  \n Reflection attacks are mitigated by default because the WCF service model adds a signed message ID to request messages and expects a signed `relates-to` header on response messages. Consequently, the request message cannot be replayed as a response. In secure reliable message (RM) scenarios, reflection attacks are mitigated because:  \n  \n-   The create sequence and create sequence response message schemas are different.  \n  \n-   For simplex sequences, sequence messages the client sends cannot be replayed back to it because the client cannot understand such messages.  \n  \n-   For duplex sequences, the two sequence IDs must be unique. Thus, an outgoing sequence message cannot be replayed back as an incoming sequence message (all sequence headers and bodies are signed, too).  \n  \n The only bindings that are susceptible to reflection attacks are those without WS-Addressing: custom bindings that have WS-Addressing disabled and use the symmetric key-based security. The <xref:System.ServiceModel.BasicHttpBinding> does not use WS-Addressing by default, but it does not use symmetric key-based security in a way that allows it to be vulnerable to this attack.  \n  \n The mitigation for custom bindings is to not establish security context or to require WS-Addressing headers.  \n  \n## Web Farm: Attacker Replays Request to Multiple Nodes  \n A client uses a service that is implemented on a Web farm. An attacker replays a request that was sent to one node in the farm to another node in the farm. In addition, if a service is restarted, the replay cache is flushed, allowing an attacker to replay the request. (The cache contains used, previously seen message signature values and prevents replays so those signatures can be used only once. Replay caches are not shared across a Web farm.)  \n  \n Mitigations include:  \n  \n-   Use message mode security with stateful security context tokens (with or without secure conversation enabled). For more information, see [How to: Create a Security Context Token for a Secure Session](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md).  \n  \n-   Configure the service to use transport-level security.  \n  \n## See also\n\n- [Security Considerations](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)\n- [Information Disclosure](../../../../docs/framework/wcf/feature-details/information-disclosure.md)\n- [Elevation of Privilege](../../../../docs/framework/wcf/feature-details/elevation-of-privilege.md)\n- [Denial of Service](../../../../docs/framework/wcf/feature-details/denial-of-service.md)\n- [Tampering](../../../../docs/framework/wcf/feature-details/tampering.md)\n- [Unsupported Scenarios](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)\n","nodes":[{"pos":[4,98],"embed":true,"restype":"x-metadata","content":"title: \"Replay Attacks\"\nms.date: \"03/30/2017\"\nms.assetid: 7a17e040-93cd-4432-81b9-9f62fec78c8f","nodes":[{"content":"Replay Attacks","nodes":[{"pos":[0,14],"content":"Replay Attacks","nodes":[{"content":"Replay Attacks","pos":[0,14]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[105,119],"content":"Replay Attacks","linkify":"Replay Attacks","nodes":[{"content":"Replay Attacks","pos":[0,14]}]},{"content":"A <bpt id=\"p1\">*</bpt>replay attack<ept id=\"p1\">*</ept> occurs when an attacker copies a stream of messages between two parties and replays the stream to one or more of the parties.","pos":[120,263],"source":"A *replay attack* occurs when an attacker copies a stream of messages between two parties and replays the stream to one or more of the parties."},{"content":"Unless mitigated, the computers subject to the attack process the stream as legitimate messages, resulting in a range of bad consequences, such as redundant orders of an item.","pos":[264,439]},{"pos":[448,493],"content":"Bindings May Be Subject to Reflection Attacks","linkify":"Bindings May Be Subject to Reflection Attacks","nodes":[{"content":"Bindings May Be Subject to Reflection Attacks","pos":[0,45]}]},{"content":"<bpt id=\"p1\">*</bpt>Reflection attacks<ept id=\"p1\">*</ept> are replays of messages back to a sender as if they came from the receiver as the reply.","pos":[497,606],"source":"*Reflection attacks* are replays of messages back to a sender as if they came from the receiver as the reply."},{"content":"The standard <bpt id=\"p1\">*</bpt>replay detection<ept id=\"p1\">*</ept> in the Windows Communication Foundation (WCF) mechanism does not automatically handle this.","pos":[607,730],"source":" The standard *replay detection* in the Windows Communication Foundation (WCF) mechanism does not automatically handle this."},{"content":"Reflection attacks are mitigated by default because the WCF service model adds a signed message ID to request messages and expects a signed <ph id=\"ph1\">`relates-to`</ph> header on response messages.","pos":[737,918],"source":"Reflection attacks are mitigated by default because the WCF service model adds a signed message ID to request messages and expects a signed `relates-to` header on response messages."},{"content":"Consequently, the request message cannot be replayed as a response.","pos":[919,986]},{"content":"In secure reliable message (RM) scenarios, reflection attacks are mitigated because:","pos":[987,1071]},{"content":"The create sequence and create sequence response message schemas are different.","pos":[1081,1160]},{"content":"For simplex sequences, sequence messages the client sends cannot be replayed back to it because the client cannot understand such messages.","pos":[1170,1309]},{"content":"For duplex sequences, the two sequence IDs must be unique.","pos":[1319,1377]},{"content":"Thus, an outgoing sequence message cannot be replayed back as an incoming sequence message (all sequence headers and bodies are signed, too).","pos":[1378,1519]},{"content":"The only bindings that are susceptible to reflection attacks are those without WS-Addressing: custom bindings that have WS-Addressing disabled and use the symmetric key-based security.","pos":[1526,1710]},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.BasicHttpBinding&gt;</ph> does not use WS-Addressing by default, but it does not use symmetric key-based security in a way that allows it to be vulnerable to this attack.","pos":[1711,1903],"source":" The <xref:System.ServiceModel.BasicHttpBinding> does not use WS-Addressing by default, but it does not use symmetric key-based security in a way that allows it to be vulnerable to this attack."},{"content":"The mitigation for custom bindings is to not establish security context or to require WS-Addressing headers.","pos":[1910,2018]},{"pos":[2027,2079],"content":"Web Farm: Attacker Replays Request to Multiple Nodes","linkify":"Web Farm: Attacker Replays Request to Multiple Nodes","nodes":[{"content":"Web Farm: Attacker Replays Request to Multiple Nodes","pos":[0,52]}]},{"content":"A client uses a service that is implemented on a Web farm.","pos":[2083,2141]},{"content":"An attacker replays a request that was sent to one node in the farm to another node in the farm.","pos":[2142,2238]},{"content":"In addition, if a service is restarted, the replay cache is flushed, allowing an attacker to replay the request.","pos":[2239,2351]},{"content":"(The cache contains used, previously seen message signature values and prevents replays so those signatures can be used only once.","pos":[2352,2482]},{"content":"Replay caches are not shared across a Web farm.)","pos":[2483,2531]},{"content":"Mitigations include:","pos":[2538,2558]},{"content":"Use message mode security with stateful security context tokens (with or without secure conversation enabled).","pos":[2568,2678]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>How to: Create a Security Context Token for a Secure Session<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md)</ept>.","pos":[2679,2879],"source":" For more information, see [How to: Create a Security Context Token for a Secure Session](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md)."},{"content":"Configure the service to use transport-level security.","pos":[2889,2943]},{"pos":[2952,2960],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[2964,3071],"content":"<bpt id=\"p1\">[</bpt>Security Considerations<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)</ept>","source":"[Security Considerations](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)"},{"pos":[3074,3172],"content":"<bpt id=\"p1\">[</bpt>Information Disclosure<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/information-disclosure.md)</ept>","source":"[Information Disclosure](../../../../docs/framework/wcf/feature-details/information-disclosure.md)"},{"pos":[3175,3273],"content":"<bpt id=\"p1\">[</bpt>Elevation of Privilege<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/elevation-of-privilege.md)</ept>","source":"[Elevation of Privilege](../../../../docs/framework/wcf/feature-details/elevation-of-privilege.md)"},{"pos":[3276,3364],"content":"<bpt id=\"p1\">[</bpt>Denial of Service<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/denial-of-service.md)</ept>","source":"[Denial of Service](../../../../docs/framework/wcf/feature-details/denial-of-service.md)"},{"pos":[3367,3439],"content":"<bpt id=\"p1\">[</bpt>Tampering<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/tampering.md)</ept>","source":"[Tampering](../../../../docs/framework/wcf/feature-details/tampering.md)"},{"pos":[3442,3538],"content":"<bpt id=\"p1\">[</bpt>Unsupported Scenarios<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)</ept>","source":"[Unsupported Scenarios](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)"}]}