{"content":"---\ntitle: \"<alwaysFlowImpersonationPolicy> Element\"\nms.date: \"03/30/2017\"\nf1_keywords: \n  - \"http://schemas.microsoft.com/.NetConfiguration/v2.0#configuration/runtime/alwaysFlowImpersonationPolicy\"\n  - \"http://schemas.microsoft.com/.NetConfiguration/v2.0#alwaysFlowImpersonationPolicy\"\nhelpviewer_keywords: \n  - \"alwaysFlowImpersonationPolicy element\"\n  - \"<alwaysFlowImpersonationPolicy> element\"\nms.assetid: ee622801-9e46-470b-85ab-88c4b1dd2ee1\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\n---\n# \\<alwaysFlowImpersonationPolicy> Element\nSpecifies that the Windows identity always flows across asynchronous points, regardless of how impersonation was performed.  \n  \n \\<configuration>  \n\\<runtime>  \n\\<alwaysFlowImpersonationPolicy>  \n  \n## Syntax  \n  \n```xml  \n<alwaysFlowImpersonationPolicy    \n  enabled=\"true|false\"/>  \n```  \n  \n## Attributes and Elements  \n The following sections describe attributes, child elements, and parent elements.  \n  \n### Attributes  \n  \n|Attribute|Description|  \n|---------------|-----------------|  \n|`enabled`|Required attribute.<br /><br /> Indicates whether the Windows identity flows across asynchronous points.|  \n  \n## enabled Attribute  \n  \n|Value|Description|  \n|-----------|-----------------|  \n|`false`|The Windows identity does not flow across asynchronous points, unless the impersonation is performed through managed methods such as <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A>. This is the default.|  \n|`true`|The Windows identity always flows across asynchronous points, regardless of how impersonation was performed.|  \n  \n### Child Elements  \n None.  \n  \n### Parent Elements  \n  \n|Element|Description|  \n|-------------|-----------------|  \n|`configuration`|The root element in every configuration file used by the common language runtime and .NET Framework applications.|  \n|`runtime`|Contains information about assembly binding and garbage collection.|  \n  \n## Remarks  \n In the .NET Framework versions 1.0 and 1.1, the Windows identity does not flow across asynchronous points. In the .NET Framework version 2.0, there is an <xref:System.Threading.ExecutionContext> object that contains information about the currently executing thread, and flows it across asynchronous points within an application domain. The <xref:System.Security.Principal.WindowsIdentity> also flows as part of the information that flows across the asynchronous points, provided the impersonation was achieved using managed methods such as <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> and not through other means such as platform invoke to native methods. This element is used to specify that the Windows identity does flow across asynchronous points, regardless of how the impersonation was achieved.  \n  \n You can alter this default behavior in two other ways:  \n  \n1.  In managed code on a per-thread basis.  \n  \n     You can suppress the flow on a per-thread basis by modifying the <xref:System.Threading.ExecutionContext> and <xref:System.Security.SecurityContext> settings by using the <xref:System.Threading.ExecutionContext.SuppressFlow%2A?displayProperty=nameWithType>, <xref:System.Security.SecurityContext.SuppressFlowWindowsIdentity%2A?displayProperty=nameWithType>, or <xref:System.Security.SecurityContext.SuppressFlow%2A?displayProperty=nameWithType> method.  \n  \n2.  In the call to the unmanaged hosting interface to load the common language runtime (CLR).  \n  \n     If an unmanaged hosting interface (instead of a simple managed executable) is used to load the CLR, you can specify a special flag in the call to the [CorBindToRuntimeEx Function](../../../../../docs/framework/unmanaged-api/hosting/corbindtoruntimeex-function.md) function. To enable the compatibility mode for the entire process, set the `flags` parameter for [CorBindToRuntimeEx Function](../../../../../docs/framework/unmanaged-api/hosting/corbindtoruntimeex-function.md) to `STARTUP_ALWAYSFLOW_IMPERSONATION`.  \n  \n## Configuration File  \n In a .NET Framework application, this element can be used only in the application configuration file.  \n  \n For an ASP.NET application, the impersonation flow can be configured in the aspnet.config file found in the \\<Windows Folder>\\Microsoft.NET\\Framework\\vx.x.xxxx directory.  \n  \n ASP.NET by default disables the impersonation flow in the aspnet.config file by using the following configuration settings:  \n  \n```xml\n<configuration>  \n   <runtime>  \n      <legacyImpersonationPolicy enabled=\"true\"/>  \n      <alwaysFlowImpersonationPolicy enabled=\"false\"/>  \n   </runtime>  \n</configuration>  \n```  \n  \n In ASP.NET, if you want to allow the flow of impersonation instead, you must explicitly use the following configuration settings:  \n  \n```xml  \n<configuration>  \n   <runtime>  \n      <legacyImpersonationPolicy enabled=\"false\"/>  \n      <alwaysFlowImpersonationPolicy enabled=\"true\"/>  \n   </runtime>  \n</configuration>  \n```  \n  \n## Example  \n The following example shows how to specify that the Windows identity flows across asynchronous points, even when the impersonation is achieved through means other than managed methods.  \n  \n```xml  \n<configuration>  \n  <runtime>  \n    <alwaysFlowImpersonationPolicy enabled=\"true\"/>  \n  </runtime>  \n</configuration>  \n```  \n  \n## See also\n\n- [Runtime Settings Schema](../../../../../docs/framework/configure-apps/file-schema/runtime/index.md)\n- [Configuration File Schema](../../../../../docs/framework/configure-apps/file-schema/index.md)\n- [\\<legacyImpersonationPolicy> Element](../../../../../docs/framework/configure-apps/file-schema/runtime/legacyimpersonationpolicy-element.md)\n","nodes":[{"pos":[4,487],"embed":true,"restype":"x-metadata","content":"title: \"<alwaysFlowImpersonationPolicy> Element\"\nms.date: \"03/30/2017\"\nf1_keywords: \n  - \"http://schemas.microsoft.com/.NetConfiguration/v2.0#configuration/runtime/alwaysFlowImpersonationPolicy\"\n  - \"http://schemas.microsoft.com/.NetConfiguration/v2.0#alwaysFlowImpersonationPolicy\"\nhelpviewer_keywords: \n  - \"alwaysFlowImpersonationPolicy element\"\n  - \"<alwaysFlowImpersonationPolicy> element\"\nms.assetid: ee622801-9e46-470b-85ab-88c4b1dd2ee1\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"","nodes":[{"content":"<alwaysFlowImpersonationPolicy> Element","nodes":[{"pos":[0,39],"content":"<ph id=\"ph1\">&lt;alwaysFlowImpersonationPolicy&gt;</ph> Element","source":"<alwaysFlowImpersonationPolicy> Element"}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[494,534],"content":"\\<alwaysFlowImpersonationPolicy> Element","linkify":"\\<alwaysFlowImpersonationPolicy> Element","nodes":[{"content":"<ph id=\"ph1\">\\&lt;</ph>alwaysFlowImpersonationPolicy&gt; Element","pos":[0,40],"source":"\\<alwaysFlowImpersonationPolicy> Element"}]},{"content":"Specifies that the Windows identity always flows across asynchronous points, regardless of how impersonation was performed.","pos":[535,658]},{"content":"<ph id=\"ph1\">\\&lt;</ph>configuration&gt;","pos":[665,681],"source":"\\<configuration>"},{"content":"<ph id=\"ph1\">\\&lt;</ph>runtime&gt;","pos":[684,694],"source":"\\<runtime>"},{"content":"<ph id=\"ph1\">\\&lt;</ph>alwaysFlowImpersonationPolicy&gt;","pos":[697,729],"source":"\\<alwaysFlowImpersonationPolicy>"},{"pos":[738,744],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[833,856],"content":"Attributes and Elements","linkify":"Attributes and Elements","nodes":[{"content":"Attributes and Elements","pos":[0,23]}]},{"content":"The following sections describe attributes, child elements, and parent elements.","pos":[860,940]},{"pos":[950,960],"content":"Attributes","linkify":"Attributes","nodes":[{"content":"Attributes","pos":[0,10]}]},{"content":"Attribute","pos":[967,976]},{"content":"Description","pos":[977,988]},{"content":"Required attribute.","pos":[1041,1060]},{"content":"Indicates whether the Windows identity flows across asynchronous points.","pos":[1073,1145]},{"pos":[1155,1172],"content":"enabled Attribute","linkify":"enabled Attribute","nodes":[{"content":"enabled Attribute","pos":[0,17]}]},{"content":"Value","pos":[1179,1184]},{"content":"Description","pos":[1185,1196]},{"content":"The Windows identity does not flow across asynchronous points, unless the impersonation is performed through managed methods such as <ph id=\"ph1\">&lt;xref:System.Security.Principal.WindowsIdentity.Impersonate%2A&gt;</ph>.","pos":[1243,1440],"source":"The Windows identity does not flow across asynchronous points, unless the impersonation is performed through managed methods such as <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A>."},{"content":"This is the default.","pos":[1441,1461]},{"content":"The Windows identity always flows across asynchronous points, regardless of how impersonation was performed.","pos":[1473,1581]},{"pos":[1592,1606],"content":"Child Elements","linkify":"Child Elements","nodes":[{"content":"Child Elements","pos":[0,14]}]},{"content":"None.","pos":[1610,1615]},{"pos":[1625,1640],"content":"Parent Elements","linkify":"Parent Elements","nodes":[{"content":"Parent Elements","pos":[0,15]}]},{"content":"Element","pos":[1647,1654]},{"content":"Description","pos":[1655,1666]},{"content":"The root element in every configuration file used by the common language runtime and .NET Framework applications.","pos":[1723,1836]},{"content":"Contains information about assembly binding and garbage collection.","pos":[1851,1918]},{"pos":[1928,1935],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"In the .NET Framework versions 1.0 and 1.1, the Windows identity does not flow across asynchronous points.","pos":[1939,2045]},{"content":"In the .NET Framework version 2.0, there is an <ph id=\"ph1\">&lt;xref:System.Threading.ExecutionContext&gt;</ph> object that contains information about the currently executing thread, and flows it across asynchronous points within an application domain.","pos":[2046,2274],"source":" In the .NET Framework version 2.0, there is an <xref:System.Threading.ExecutionContext> object that contains information about the currently executing thread, and flows it across asynchronous points within an application domain."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Security.Principal.WindowsIdentity&gt;</ph> also flows as part of the information that flows across the asynchronous points, provided the impersonation was achieved using managed methods such as <ph id=\"ph2\">&lt;xref:System.Security.Principal.WindowsIdentity.Impersonate%2A&gt;</ph> and not through other means such as platform invoke to native methods.","pos":[2275,2613],"source":" The <xref:System.Security.Principal.WindowsIdentity> also flows as part of the information that flows across the asynchronous points, provided the impersonation was achieved using managed methods such as <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> and not through other means such as platform invoke to native methods."},{"content":"This element is used to specify that the Windows identity does flow across asynchronous points, regardless of how the impersonation was achieved.","pos":[2614,2759]},{"content":"You can alter this default behavior in two other ways:","pos":[2766,2820]},{"content":"In managed code on a per-thread basis.","pos":[2830,2868]},{"pos":[2879,3331],"content":"You can suppress the flow on a per-thread basis by modifying the <ph id=\"ph1\">&lt;xref:System.Threading.ExecutionContext&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Security.SecurityContext&gt;</ph> settings by using the <ph id=\"ph3\">&lt;xref:System.Threading.ExecutionContext.SuppressFlow%2A?displayProperty=nameWithType&gt;</ph>, <ph id=\"ph4\">&lt;xref:System.Security.SecurityContext.SuppressFlowWindowsIdentity%2A?displayProperty=nameWithType&gt;</ph>, or <ph id=\"ph5\">&lt;xref:System.Security.SecurityContext.SuppressFlow%2A?displayProperty=nameWithType&gt;</ph> method.","source":"You can suppress the flow on a per-thread basis by modifying the <xref:System.Threading.ExecutionContext> and <xref:System.Security.SecurityContext> settings by using the <xref:System.Threading.ExecutionContext.SuppressFlow%2A?displayProperty=nameWithType>, <xref:System.Security.SecurityContext.SuppressFlowWindowsIdentity%2A?displayProperty=nameWithType>, or <xref:System.Security.SecurityContext.SuppressFlow%2A?displayProperty=nameWithType> method."},{"content":"In the call to the unmanaged hosting interface to load the common language runtime (CLR).","pos":[3341,3430]},{"content":"If an unmanaged hosting interface (instead of a simple managed executable) is used to load the CLR, you can specify a special flag in the call to the <bpt id=\"p1\">[</bpt>CorBindToRuntimeEx Function<ept id=\"p1\">](../../../../../docs/framework/unmanaged-api/hosting/corbindtoruntimeex-function.md)</ept> function.","pos":[3441,3714],"source":"If an unmanaged hosting interface (instead of a simple managed executable) is used to load the CLR, you can specify a special flag in the call to the [CorBindToRuntimeEx Function](../../../../../docs/framework/unmanaged-api/hosting/corbindtoruntimeex-function.md) function."},{"content":"To enable the compatibility mode for the entire process, set the <ph id=\"ph1\">`flags`</ph> parameter for <bpt id=\"p1\">[</bpt>CorBindToRuntimeEx Function<ept id=\"p1\">](../../../../../docs/framework/unmanaged-api/hosting/corbindtoruntimeex-function.md)</ept> to <ph id=\"ph2\">`STARTUP_ALWAYSFLOW_IMPERSONATION`</ph>.","pos":[3715,3954],"source":" To enable the compatibility mode for the entire process, set the `flags` parameter for [CorBindToRuntimeEx Function](../../../../../docs/framework/unmanaged-api/hosting/corbindtoruntimeex-function.md) to `STARTUP_ALWAYSFLOW_IMPERSONATION`."},{"pos":[3963,3981],"content":"Configuration File","linkify":"Configuration File","nodes":[{"content":"Configuration File","pos":[0,18]}]},{"content":"In a .NET Framework application, this element can be used only in the application configuration file.","pos":[3985,4086]},{"content":"For an ASP.NET application, the impersonation flow can be configured in the aspnet.config file found in the <ph id=\"ph1\">\\&lt;</ph>Windows Folder&gt;\\Microsoft.NET\\Framework\\vx.x.xxxx directory.","pos":[4093,4263],"source":"For an ASP.NET application, the impersonation flow can be configured in the aspnet.config file found in the \\<Windows Folder>\\Microsoft.NET\\Framework\\vx.x.xxxx directory."},{"content":"ASP.NET by default disables the impersonation flow in the aspnet.config file by using the following configuration settings:","pos":[4270,4393]},{"content":"In ASP.NET, if you want to allow the flow of impersonation instead, you must explicitly use the following configuration settings:","pos":[4593,4722]},{"pos":[4926,4933],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following example shows how to specify that the Windows identity flows across asynchronous points, even when the impersonation is achieved through means other than managed methods.","pos":[4937,5121]},{"pos":[5268,5276],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[5280,5380],"content":"<bpt id=\"p1\">[</bpt>Runtime Settings Schema<ept id=\"p1\">](../../../../../docs/framework/configure-apps/file-schema/runtime/index.md)</ept>","source":"[Runtime Settings Schema](../../../../../docs/framework/configure-apps/file-schema/runtime/index.md)"},{"pos":[5383,5477],"content":"<bpt id=\"p1\">[</bpt>Configuration File Schema<ept id=\"p1\">](../../../../../docs/framework/configure-apps/file-schema/index.md)</ept>","source":"[Configuration File Schema](../../../../../docs/framework/configure-apps/file-schema/index.md)"},{"pos":[5480,5621],"content":"<bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>legacyImpersonationPolicy&gt; Element<ept id=\"p1\">](../../../../../docs/framework/configure-apps/file-schema/runtime/legacyimpersonationpolicy-element.md)</ept>","source":"[\\<legacyImpersonationPolicy> Element](../../../../../docs/framework/configure-apps/file-schema/runtime/legacyimpersonationpolicy-element.md)"}]}