{"content":"---\ntitle: \"Streaming Message Transfer\"\nms.date: \"03/30/2017\"\nms.assetid: 72a47a51-e5e7-4b76-b24a-299d51e0ae5a\n---\n# Streaming Message Transfer\nWindows Communication Foundation (WCF) transports support two modes for transferring messages:  \n  \n-   Buffered transfers hold the entire message in a memory buffer until the transfer is complete. A buffered message must be completely delivered before a receiver can read it.  \n  \n-   Streamed transfers expose the message as a stream. The receiver starts processing the message before it is completely delivered.  \n  \n-   Streamed transfers can improve the scalability of a service by eliminating the requirement for large memory buffers. Whether changing the transfer mode improves scalability depends on the size of the messages being transferred. Large message sizes favor using streamed transfers.  \n  \n By default, the HTTP, TCP/IP, and named pipe transports use buffered transfers. This document describes how to switch these transports from a buffered to streamed transfer mode and the consequences of doing so.  \n  \n## Enabling Streamed Transfers  \n Selecting between buffered and streamed transfer modes is done on the binding element of the transport. The binding element has a <xref:System.ServiceModel.TransferMode> property that can be set to `Buffered`, `Streamed`, `StreamedRequest`, or `StreamedResponse`. Setting the transfer mode to `Streamed` enables streaming communication in both directions. Setting the transfer mode to `StreamedRequest` or `StreamedResponse` enables streaming communication in the indicated direction only.  \n  \n The <xref:System.ServiceModel.BasicHttpBinding>, <xref:System.ServiceModel.NetTcpBinding>, and <xref:System.ServiceModel.NetNamedPipeBinding> bindings expose the <xref:System.ServiceModel.TransferMode> property. For other transports, you must create a custom binding to set the transfer mode.  \n  \n The decision to use either buffered or streamed transfers is a local decision of the endpoint. For HTTP transports, the transfer mode does not propagate across a connection, or to servers and other intermediaries. Setting the transfer mode is not reflected in the description of the service interface. After generating a client class for a service, you must edit the configuration file for services intended to be used with streamed transfers to set the mode. For TCP and named pipe transports, the transfer mode is propagated as a policy assertion.  \n  \n For code samples, see [How to: Enable Streaming](../../../../docs/framework/wcf/feature-details/how-to-enable-streaming.md).  \n  \n## Enabling Asynchronous Streaming  \n To enable asynchronous streaming, add the  <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior> endpoint behavior to the service host and set its <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.AsynchronousSendEnabled%2A> property to `true`.  \n  \n This version of WCF also adde the capability of true asynchronous streaming on the send side. This improves scalability of the service in scenarios where it is streaming messages to multiple clients some of which are slow in reading; possibly due to network congestion or are not reading at all. In these scenarios WCF no longer blocks individual threads on the service per client. This ensures that the service is able to process many more clients thereby improving the scalability of the service.  \n  \n## Restrictions on Streamed Transfers  \n Using the streamed transfer mode causes the run time to enforce additional restrictions.  \n  \n Operations that occur across a streamed transport can have a contract with at most one input or output parameter. That parameter corresponds to the entire body of the message and must be a <xref:System.ServiceModel.Channels.Message>, a derived type of <xref:System.IO.Stream>, or an <xref:System.Xml.Serialization.IXmlSerializable> implementation. Having a return value for an operation is equivalent to having an output parameter.  \n  \n Some WCF features, such as reliable messaging, transactions, and SOAP message-level security, rely on buffering messages for transmissions. Using these features may reduce or eliminate the performance benefits gained by using streaming. To secure a streamed transport, use transport-level security only or use transport-level security plus authentication-only message security.  \n  \n SOAP headers are always buffered, even when the transfer mode is set to streamed. The headers for a message must not exceed the size of the `MaxBufferSize` transport quota. For more information about this setting, see [Transport Quotas](../../../../docs/framework/wcf/feature-details/transport-quotas.md).  \n  \n## Differences Between Buffered and Streamed Transfers  \n Changing the transfer mode from buffered to streamed also changes the native channel shape of the TCP and named pipe transports. For buffered transfers, the native channel shape is <xref:System.ServiceModel.Channels.IDuplexSessionChannel>. For streamed transfers, the native channels are <xref:System.ServiceModel.Channels.IRequestChannel> and <xref:System.ServiceModel.Channels.IReplyChannel>. Changing the transfer mode in an existing application that uses these transports directly (that is, not through a service contract) requires changing the expected channel shape for channel factories and listeners.  \n  \n## See also\n\n- [How to: Enable Streaming](../../../../docs/framework/wcf/feature-details/how-to-enable-streaming.md)\n","nodes":[{"pos":[4,110],"embed":true,"restype":"x-metadata","content":"title: \"Streaming Message Transfer\"\nms.date: \"03/30/2017\"\nms.assetid: 72a47a51-e5e7-4b76-b24a-299d51e0ae5a","nodes":[{"content":"Streaming Message Transfer","nodes":[{"pos":[0,26],"content":"Streaming Message Transfer","nodes":[{"content":"Streaming Message Transfer","pos":[0,26]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[117,143],"content":"Streaming Message Transfer","linkify":"Streaming Message Transfer","nodes":[{"content":"Streaming Message Transfer","pos":[0,26]}]},{"content":"Windows Communication Foundation (WCF) transports support two modes for transferring messages:","pos":[144,238]},{"content":"Buffered transfers hold the entire message in a memory buffer until the transfer is complete.","pos":[248,341]},{"content":"A buffered message must be completely delivered before a receiver can read it.","pos":[342,420]},{"content":"Streamed transfers expose the message as a stream.","pos":[430,480]},{"content":"The receiver starts processing the message before it is completely delivered.","pos":[481,558]},{"content":"Streamed transfers can improve the scalability of a service by eliminating the requirement for large memory buffers.","pos":[568,684]},{"content":"Whether changing the transfer mode improves scalability depends on the size of the messages being transferred.","pos":[685,795]},{"content":"Large message sizes favor using streamed transfers.","pos":[796,847]},{"content":"By default, the HTTP, TCP/IP, and named pipe transports use buffered transfers.","pos":[854,933]},{"content":"This document describes how to switch these transports from a buffered to streamed transfer mode and the consequences of doing so.","pos":[934,1064]},{"pos":[1073,1100],"content":"Enabling Streamed Transfers","linkify":"Enabling Streamed Transfers","nodes":[{"content":"Enabling Streamed Transfers","pos":[0,27]}]},{"content":"Selecting between buffered and streamed transfer modes is done on the binding element of the transport.","pos":[1104,1207]},{"content":"The binding element has a <ph id=\"ph1\">&lt;xref:System.ServiceModel.TransferMode&gt;</ph> property that can be set to <ph id=\"ph2\">`Buffered`</ph>, <ph id=\"ph3\">`Streamed`</ph>, <ph id=\"ph4\">`StreamedRequest`</ph>, or <ph id=\"ph5\">`StreamedResponse`</ph>.","pos":[1208,1367],"source":" The binding element has a <xref:System.ServiceModel.TransferMode> property that can be set to `Buffered`, `Streamed`, `StreamedRequest`, or `StreamedResponse`."},{"content":"Setting the transfer mode to <ph id=\"ph1\">`Streamed`</ph> enables streaming communication in both directions.","pos":[1368,1459],"source":" Setting the transfer mode to `Streamed` enables streaming communication in both directions."},{"content":"Setting the transfer mode to <ph id=\"ph1\">`StreamedRequest`</ph> or <ph id=\"ph2\">`StreamedResponse`</ph> enables streaming communication in the indicated direction only.","pos":[1460,1593],"source":" Setting the transfer mode to `StreamedRequest` or `StreamedResponse` enables streaming communication in the indicated direction only."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.BasicHttpBinding&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.ServiceModel.NetTcpBinding&gt;</ph>, and <ph id=\"ph3\">&lt;xref:System.ServiceModel.NetNamedPipeBinding&gt;</ph> bindings expose the <ph id=\"ph4\">&lt;xref:System.ServiceModel.TransferMode&gt;</ph> property.","pos":[1600,1811],"source":"The <xref:System.ServiceModel.BasicHttpBinding>, <xref:System.ServiceModel.NetTcpBinding>, and <xref:System.ServiceModel.NetNamedPipeBinding> bindings expose the <xref:System.ServiceModel.TransferMode> property."},{"content":"For other transports, you must create a custom binding to set the transfer mode.","pos":[1812,1892]},{"content":"The decision to use either buffered or streamed transfers is a local decision of the endpoint.","pos":[1899,1993]},{"content":"For HTTP transports, the transfer mode does not propagate across a connection, or to servers and other intermediaries.","pos":[1994,2112]},{"content":"Setting the transfer mode is not reflected in the description of the service interface.","pos":[2113,2200]},{"content":"After generating a client class for a service, you must edit the configuration file for services intended to be used with streamed transfers to set the mode.","pos":[2201,2358]},{"content":"For TCP and named pipe transports, the transfer mode is propagated as a policy assertion.","pos":[2359,2448]},{"pos":[2455,2579],"content":"For code samples, see <bpt id=\"p1\">[</bpt>How to: Enable Streaming<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-enable-streaming.md)</ept>.","source":"For code samples, see [How to: Enable Streaming](../../../../docs/framework/wcf/feature-details/how-to-enable-streaming.md)."},{"pos":[2588,2619],"content":"Enabling Asynchronous Streaming","linkify":"Enabling Asynchronous Streaming","nodes":[{"content":"Enabling Asynchronous Streaming","pos":[0,31]}]},{"pos":[2623,2908],"content":"To enable asynchronous streaming, add the  <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior&gt;</ph> endpoint behavior to the service host and set its <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.AsynchronousSendEnabled%2A&gt;</ph> property to <ph id=\"ph3\">`true`</ph>.","source":"To enable asynchronous streaming, add the  <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior> endpoint behavior to the service host and set its <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.AsynchronousSendEnabled%2A> property to `true`."},{"content":"This version of WCF also adde the capability of true asynchronous streaming on the send side.","pos":[2915,3008]},{"content":"This improves scalability of the service in scenarios where it is streaming messages to multiple clients some of which are slow in reading; possibly due to network congestion or are not reading at all.","pos":[3009,3210]},{"content":"In these scenarios WCF no longer blocks individual threads on the service per client.","pos":[3211,3296]},{"content":"This ensures that the service is able to process many more clients thereby improving the scalability of the service.","pos":[3297,3413]},{"pos":[3422,3456],"content":"Restrictions on Streamed Transfers","linkify":"Restrictions on Streamed Transfers","nodes":[{"content":"Restrictions on Streamed Transfers","pos":[0,34]}]},{"content":"Using the streamed transfer mode causes the run time to enforce additional restrictions.","pos":[3460,3548]},{"content":"Operations that occur across a streamed transport can have a contract with at most one input or output parameter.","pos":[3555,3668]},{"content":"That parameter corresponds to the entire body of the message and must be a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.Message&gt;</ph>, a derived type of <ph id=\"ph2\">&lt;xref:System.IO.Stream&gt;</ph>, or an <ph id=\"ph3\">&lt;xref:System.Xml.Serialization.IXmlSerializable&gt;</ph> implementation.","pos":[3669,3902],"source":" That parameter corresponds to the entire body of the message and must be a <xref:System.ServiceModel.Channels.Message>, a derived type of <xref:System.IO.Stream>, or an <xref:System.Xml.Serialization.IXmlSerializable> implementation."},{"content":"Having a return value for an operation is equivalent to having an output parameter.","pos":[3903,3986]},{"content":"Some WCF features, such as reliable messaging, transactions, and SOAP message-level security, rely on buffering messages for transmissions.","pos":[3993,4132]},{"content":"Using these features may reduce or eliminate the performance benefits gained by using streaming.","pos":[4133,4229]},{"content":"To secure a streamed transport, use transport-level security only or use transport-level security plus authentication-only message security.","pos":[4230,4370]},{"content":"SOAP headers are always buffered, even when the transfer mode is set to streamed.","pos":[4377,4458]},{"content":"The headers for a message must not exceed the size of the <ph id=\"ph1\">`MaxBufferSize`</ph> transport quota.","pos":[4459,4549],"source":" The headers for a message must not exceed the size of the `MaxBufferSize` transport quota."},{"content":"For more information about this setting, see <bpt id=\"p1\">[</bpt>Transport Quotas<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/transport-quotas.md)</ept>.","pos":[4550,4682],"source":" For more information about this setting, see [Transport Quotas](../../../../docs/framework/wcf/feature-details/transport-quotas.md)."},{"pos":[4691,4742],"content":"Differences Between Buffered and Streamed Transfers","linkify":"Differences Between Buffered and Streamed Transfers","nodes":[{"content":"Differences Between Buffered and Streamed Transfers","pos":[0,51]}]},{"content":"Changing the transfer mode from buffered to streamed also changes the native channel shape of the TCP and named pipe transports.","pos":[4746,4874]},{"content":"For buffered transfers, the native channel shape is <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.IDuplexSessionChannel&gt;</ph>.","pos":[4875,4985],"source":" For buffered transfers, the native channel shape is <xref:System.ServiceModel.Channels.IDuplexSessionChannel>."},{"content":"For streamed transfers, the native channels are <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.IRequestChannel&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.IReplyChannel&gt;</ph>.","pos":[4986,5140],"source":" For streamed transfers, the native channels are <xref:System.ServiceModel.Channels.IRequestChannel> and <xref:System.ServiceModel.Channels.IReplyChannel>."},{"content":"Changing the transfer mode in an existing application that uses these transports directly (that is, not through a service contract) requires changing the expected channel shape for channel factories and listeners.","pos":[5141,5354]},{"pos":[5363,5371],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[5375,5476],"content":"<bpt id=\"p1\">[</bpt>How to: Enable Streaming<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-enable-streaming.md)</ept>","source":"[How to: Enable Streaming](../../../../docs/framework/wcf/feature-details/how-to-enable-streaming.md)"}]}