{"content":"---\ntitle: \"FILESTREAM Data\"\nms.date: \"03/30/2017\"\nms.assetid: bd8b845c-0f09-4295-b466-97ef106eefa8\n---\n\n# FILESTREAM Data\n\nThe FILESTREAM storage attribute is for binary (BLOB) data stored in a varbinary(max) column. Before FILESTREAM, storing binary data required special handling. Unstructured data, such as text documents, images and video, is often stored outside of the database, making it difficult to manage.\n\n> [!NOTE]\n> You must install the .NET Framework 3.5 SP1 (or later) to work with FILESTREAM data using SqlClient.\n\nSpecifying the FILESTREAM attribute on a varbinary(max) column causes SQL Server to store the data on the local NTFS file system instead of in the database file. Although it is stored separately, you can use the same [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] statements that are supported for working with varbinary(max) data that is stored in the database.\n\n## SqlClient Support for FILESTREAM\n\nThe [!INCLUDE[dnprdnshort](../../../../../includes/dnprdnshort-md.md)] Data Provider for SQL Server, <xref:System.Data.SqlClient>, supports reading and writing to FILESTREAM data using the <xref:System.Data.SqlTypes.SqlFileStream> class defined in the <xref:System.Data.SqlTypes> namespace. `SqlFileStream` inherits from the <xref:System.IO.Stream> class, which provides methods for reading and writing to streams of data. Reading from a stream transfers data from the stream into a data structure, such as an array of bytes. Writing transfers the data from the data structure into a stream.\n\n### Creating the SQL Server Table\n\nThe following [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] statements creates a table named employees and inserts a row of data. Once you have enabled FILESTREAM storage, you can use this table in conjunction with the code examples that follow. The links to resources in SQL Server Books Online are located at the end of this topic.\n\n```sql\nCREATE TABLE employees\n(\n  EmployeeId INT  NOT NULL  PRIMARY KEY,\n  Photo VARBINARY(MAX) FILESTREAM  NULL,\n  RowGuid UNIQUEIDENTIFIER  NOT NULL  ROWGUIDCOL\n  UNIQUE DEFAULT NEWID()\n)\nGO\nInsert into employees\nValues(1, 0x00, default)\nGO\n```\n\n### Example: Reading, Overwriting, and Inserting FILESTREAM Data\n\nThe following sample demonstrates how to read data from a FILESTREAM. The code gets the logical path to the file, setting the `FileAccess` to `Read` and the `FileOptions` to `SequentialScan`. The code then reads the bytes from the SqlFileStream into the buffer. The bytes are then written to the console window.\n\nThe sample also demonstrates how to write data to a FILESTREAM in which all existing data is overwritten. The code gets the logical path to the file and creates the `SqlFileStream`, setting the `FileAccess` to `Write` and the `FileOptions` to `SequentialScan`. A single byte is written to the `SqlFileStream`, replacing any data in the file.\n\nThe sample also demonstrates how to write data to a FILESTREAM by using the Seek method to append data to the end of the file. The code gets the logical path to the file and creates the `SqlFileStream`, setting the `FileAccess` to `ReadWrite` and the `FileOptions` to `SequentialScan`. The code uses the Seek method to seek to the end of the file, appending a single byte to the existing file.\n\n```csharp\nusing System;\nusing System.Data.SqlClient;\nusing System.Data.SqlTypes;\nusing System.Data;\nusing System.IO;\n\nnamespace FileStreamTest\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            SqlConnectionStringBuilder builder = new SqlConnectionStringBuilder(\"server=(local);integrated security=true;database=myDB\");\n            ReadFileStream(builder);\n            OverwriteFileStream(builder);\n            InsertFileStream(builder);\n\n            Console.WriteLine(\"Done\");\n        }\n\n        private static void ReadFileStream(SqlConnectionStringBuilder connStringBuilder)\n        {\n            using (SqlConnection connection = new SqlConnection(connStringBuilder.ToString()))\n            {\n                connection.Open();\n                SqlCommand command = new SqlCommand(\"SELECT TOP(1) Photo.PathName(), GET_FILESTREAM_TRANSACTION_CONTEXT() FROM employees\", connection);\n\n                SqlTransaction tran = connection.BeginTransaction(IsolationLevel.ReadCommitted);\n                command.Transaction = tran;\n\n                using (SqlDataReader reader = command.ExecuteReader())\n                {\n                    while (reader.Read())\n                    {\n                        // Get the pointer for the file\n                        string path = reader.GetString(0);\n                        byte[] transactionContext = reader.GetSqlBytes(1).Buffer;\n\n                        // Create the SqlFileStream\n                        using (Stream fileStream = new SqlFileStream(path, transactionContext, FileAccess.Read, FileOptions.SequentialScan, allocationSize: 0))\n                        {\n                            // Read the contents as bytes and write them to the console\n                            for (long index = 0; index < fileStream.Length; index++)\n                            {\n                                Console.WriteLine(fileStream.ReadByte());\n                            }\n                        }\n                    }\n                }\n                tran.Commit();\n            }\n        }\n\n        private static void OverwriteFileStream(SqlConnectionStringBuilder connStringBuilder)\n        {\n            using (SqlConnection connection = new SqlConnection(connStringBuilder.ToString()))\n            {\n                connection.Open();\n\n                SqlCommand command = new SqlCommand(\"SELECT TOP(1) Photo.PathName(), GET_FILESTREAM_TRANSACTION_CONTEXT() FROM employees\", connection);\n\n                SqlTransaction tran = connection.BeginTransaction(IsolationLevel.ReadCommitted);\n                command.Transaction = tran;\n\n                using (SqlDataReader reader = command.ExecuteReader())\n                {\n                    while (reader.Read())\n                    {\n                        // Get the pointer for file\n                        string path = reader.GetString(0);\n                        byte[] transactionContext = reader.GetSqlBytes(1).Buffer;\n\n                        // Create the SqlFileStream\n                        using (Stream fileStream = new SqlFileStream(path, transactionContext, FileAccess.Write, FileOptions.SequentialScan, allocationSize: 0))\n                        {\n                            // Write a single byte to the file. This will\n                            // replace any data in the file.\n                            fileStream.WriteByte(0x01);\n                        }\n                    }\n                }\n                tran.Commit();\n            }\n        }\n\n        private static void InsertFileStream(SqlConnectionStringBuilder connStringBuilder)\n        {\n            using (SqlConnection connection = new SqlConnection(connStringBuilder.ToString()))\n            {\n                connection.Open();\n\n                SqlCommand command = new SqlCommand(\"SELECT TOP(1) Photo.PathName(), GET_FILESTREAM_TRANSACTION_CONTEXT() FROM employees\", connection);\n\n                SqlTransaction tran = connection.BeginTransaction(IsolationLevel.ReadCommitted);\n                command.Transaction = tran;\n\n                using (SqlDataReader reader = command.ExecuteReader())\n                {\n                    while (reader.Read())\n                    {\n                        // Get the pointer for file\n                        string path = reader.GetString(0);\n                        byte[] transactionContext = reader.GetSqlBytes(1).Buffer;\n\n                        using (Stream fileStream = new SqlFileStream(path, transactionContext, FileAccess.ReadWrite, FileOptions.SequentialScan, allocationSize: 0))\n                        {\n                            // Seek to the end of the file\n                            fileStream.Seek(0, SeekOrigin.End);\n\n                            // Append a single byte\n                            fileStream.WriteByte(0x01);\n                        }\n                    }\n                }\n                tran.Commit();\n            }\n\n        }\n    }\n}\n```\n\nFor another sample, see [How to store and fetch binary data into a file stream column](https://www.codeproject.com/Articles/32216/How-to-store-and-fetch-binary-data-into-a-file-str).\n\n## Resources in SQL Server Books Online\n\nThe complete documentation for FILESTREAM is located in the following sections in SQL Server Books Online.\n\n|Topic|Description|\n|-----------|-----------------|\n|[FILESTREAM (SQL Server)](/sql/relational-databases/blob/filestream-sql-server)|Describes when to use FILESTREAM storage and how it integrates the SQL Server Database Engine with an NTFS file system.|\n|[Create Client Applications for FILESTREAM Data](/sql/relational-databases/blob/create-client-applications-for-filestream-data)|Describes the Windows API functions for working with FILESTREAM data.|\n|[FILESTREAM and Other SQL Server Features](/sql/relational-databases/blob/filestream-compatibility-with-other-sql-server-features)|Provides considerations, guidelines and limitations for using FILESTREAM data with other features of SQL Server.|\n\n## See also\n\n- [SQL Server Data Types and ADO.NET](../../../../../docs/framework/data/adonet/sql/sql-server-data-types.md)\n- [Retrieving and Modifying Data in ADO.NET](../../../../../docs/framework/data/adonet/retrieving-and-modifying-data.md)\n- [Code Access Security and ADO.NET](../../../../../docs/framework/data/adonet/code-access-security.md)\n- [SQL Server Binary and Large-Value Data](../../../../../docs/framework/data/adonet/sql/sql-server-binary-and-large-value-data.md)\n- [ADO.NET Overview](../../../../../docs/framework/data/adonet/ado-net-overview.md)\n","nodes":[{"pos":[4,99],"embed":true,"restype":"x-metadata","content":"title: \"FILESTREAM Data\"\nms.date: \"03/30/2017\"\nms.assetid: bd8b845c-0f09-4295-b466-97ef106eefa8","nodes":[{"content":"FILESTREAM Data","nodes":[{"pos":[0,15],"content":"FILESTREAM Data","nodes":[{"content":"FILESTREAM Data","pos":[0,15]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[107,122],"content":"FILESTREAM Data","linkify":"FILESTREAM Data","nodes":[{"content":"FILESTREAM Data","pos":[0,15]}]},{"content":"The FILESTREAM storage attribute is for binary (BLOB) data stored in a varbinary(max) column.","pos":[124,217]},{"content":"Before FILESTREAM, storing binary data required special handling.","pos":[218,283]},{"content":"Unstructured data, such as text documents, images and video, is often stored outside of the database, making it difficult to manage.","pos":[284,416]},{"pos":[420,530],"content":"[!NOTE]\nYou must install the .NET Framework 3.5 SP1 (or later) to work with FILESTREAM data using SqlClient.","leadings":["","> "],"nodes":[{"content":"You must install the .NET Framework 3.5 SP1 (or later) to work with FILESTREAM data using SqlClient.","pos":[8,108]}]},{"content":"Specifying the FILESTREAM attribute on a varbinary(max) column causes SQL Server to store the data on the local NTFS file system instead of in the database file.","pos":[532,693]},{"content":"Although it is stored separately, you can use the same <ph id=\"ph1\">[!INCLUDE[tsql](../../../../../includes/tsql-md.md)]</ph> statements that are supported for working with varbinary(max) data that is stored in the database.","pos":[694,900],"source":" Although it is stored separately, you can use the same [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] statements that are supported for working with varbinary(max) data that is stored in the database."},{"pos":[905,937],"content":"SqlClient Support for FILESTREAM","linkify":"SqlClient Support for FILESTREAM","nodes":[{"content":"SqlClient Support for FILESTREAM","pos":[0,32]}]},{"content":"The <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../../../includes/dnprdnshort-md.md)]</ph> Data Provider for SQL Server, <ph id=\"ph2\">&lt;xref:System.Data.SqlClient&gt;</ph>, supports reading and writing to FILESTREAM data using the <ph id=\"ph3\">&lt;xref:System.Data.SqlTypes.SqlFileStream&gt;</ph> class defined in the <ph id=\"ph4\">&lt;xref:System.Data.SqlTypes&gt;</ph> namespace.","pos":[939,1229],"source":"The [!INCLUDE[dnprdnshort](../../../../../includes/dnprdnshort-md.md)] Data Provider for SQL Server, <xref:System.Data.SqlClient>, supports reading and writing to FILESTREAM data using the <xref:System.Data.SqlTypes.SqlFileStream> class defined in the <xref:System.Data.SqlTypes> namespace."},{"content":"<ph id=\"ph1\">`SqlFileStream`</ph> inherits from the <ph id=\"ph2\">&lt;xref:System.IO.Stream&gt;</ph> class, which provides methods for reading and writing to streams of data.","pos":[1230,1361],"source":"`SqlFileStream` inherits from the <xref:System.IO.Stream> class, which provides methods for reading and writing to streams of data."},{"content":"Reading from a stream transfers data from the stream into a data structure, such as an array of bytes.","pos":[1362,1464]},{"content":"Writing transfers the data from the data structure into a stream.","pos":[1465,1530]},{"pos":[1536,1565],"content":"Creating the SQL Server Table","linkify":"Creating the SQL Server Table","nodes":[{"content":"Creating the SQL Server Table","pos":[0,29]}]},{"content":"The following <ph id=\"ph1\">[!INCLUDE[tsql](../../../../../includes/tsql-md.md)]</ph> statements creates a table named employees and inserts a row of data.","pos":[1567,1703],"source":"The following [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] statements creates a table named employees and inserts a row of data."},{"content":"Once you have enabled FILESTREAM storage, you can use this table in conjunction with the code examples that follow.","pos":[1704,1819]},{"content":"The links to resources in SQL Server Books Online are located at the end of this topic.","pos":[1820,1907]},{"pos":[2161,2221],"content":"Example: Reading, Overwriting, and Inserting FILESTREAM Data","linkify":"Example: Reading, Overwriting, and Inserting FILESTREAM Data","nodes":[{"content":"Example: Reading, Overwriting, and Inserting FILESTREAM Data","pos":[0,60]}]},{"content":"The following sample demonstrates how to read data from a FILESTREAM.","pos":[2223,2292]},{"content":"The code gets the logical path to the file, setting the <ph id=\"ph1\">`FileAccess`</ph> to <ph id=\"ph2\">`Read`</ph> and the <ph id=\"ph3\">`FileOptions`</ph> to <ph id=\"ph4\">`SequentialScan`</ph>.","pos":[2293,2414],"source":" The code gets the logical path to the file, setting the `FileAccess` to `Read` and the `FileOptions` to `SequentialScan`."},{"content":"The code then reads the bytes from the SqlFileStream into the buffer.","pos":[2415,2484]},{"content":"The bytes are then written to the console window.","pos":[2485,2534]},{"content":"The sample also demonstrates how to write data to a FILESTREAM in which all existing data is overwritten.","pos":[2536,2641]},{"content":"The code gets the logical path to the file and creates the <ph id=\"ph1\">`SqlFileStream`</ph>, setting the <ph id=\"ph2\">`FileAccess`</ph> to <ph id=\"ph3\">`Write`</ph> and the <ph id=\"ph4\">`FileOptions`</ph> to <ph id=\"ph5\">`SequentialScan`</ph>.","pos":[2642,2796],"source":" The code gets the logical path to the file and creates the `SqlFileStream`, setting the `FileAccess` to `Write` and the `FileOptions` to `SequentialScan`."},{"content":"A single byte is written to the <ph id=\"ph1\">`SqlFileStream`</ph>, replacing any data in the file.","pos":[2797,2877],"source":" A single byte is written to the `SqlFileStream`, replacing any data in the file."},{"content":"The sample also demonstrates how to write data to a FILESTREAM by using the Seek method to append data to the end of the file.","pos":[2879,3005]},{"content":"The code gets the logical path to the file and creates the <ph id=\"ph1\">`SqlFileStream`</ph>, setting the <ph id=\"ph2\">`FileAccess`</ph> to <ph id=\"ph3\">`ReadWrite`</ph> and the <ph id=\"ph4\">`FileOptions`</ph> to <ph id=\"ph5\">`SequentialScan`</ph>.","pos":[3006,3164],"source":" The code gets the logical path to the file and creates the `SqlFileStream`, setting the `FileAccess` to `ReadWrite` and the `FileOptions` to `SequentialScan`."},{"content":"The code uses the Seek method to seek to the end of the file, appending a single byte to the existing file.","pos":[3165,3272]},{"pos":[8245,8427],"content":"For another sample, see <bpt id=\"p1\">[</bpt>How to store and fetch binary data into a file stream column<ept id=\"p1\">](https://www.codeproject.com/Articles/32216/How-to-store-and-fetch-binary-data-into-a-file-str)</ept>.","source":"For another sample, see [How to store and fetch binary data into a file stream column](https://www.codeproject.com/Articles/32216/How-to-store-and-fetch-binary-data-into-a-file-str)."},{"pos":[8432,8468],"content":"Resources in SQL Server Books Online","linkify":"Resources in SQL Server Books Online","nodes":[{"content":"Resources in SQL Server Books Online","pos":[0,36]}]},{"content":"The complete documentation for FILESTREAM is located in the following sections in SQL Server Books Online.","pos":[8470,8576]},{"content":"Topic","pos":[8579,8584]},{"content":"Description","pos":[8585,8596]},{"pos":[8631,8710],"content":"<bpt id=\"p1\">[</bpt>FILESTREAM (SQL Server)<ept id=\"p1\">](/sql/relational-databases/blob/filestream-sql-server)</ept>","source":"[FILESTREAM (SQL Server)](/sql/relational-databases/blob/filestream-sql-server)"},{"content":"Describes when to use FILESTREAM storage and how it integrates the SQL Server Database Engine with an NTFS file system.","pos":[8711,8830]},{"pos":[8833,8960],"content":"<bpt id=\"p1\">[</bpt>Create Client Applications for FILESTREAM Data<ept id=\"p1\">](/sql/relational-databases/blob/create-client-applications-for-filestream-data)</ept>","source":"[Create Client Applications for FILESTREAM Data](/sql/relational-databases/blob/create-client-applications-for-filestream-data)"},{"content":"Describes the Windows API functions for working with FILESTREAM data.","pos":[8961,9030]},{"pos":[9033,9163],"content":"<bpt id=\"p1\">[</bpt>FILESTREAM and Other SQL Server Features<ept id=\"p1\">](/sql/relational-databases/blob/filestream-compatibility-with-other-sql-server-features)</ept>","source":"[FILESTREAM and Other SQL Server Features](/sql/relational-databases/blob/filestream-compatibility-with-other-sql-server-features)"},{"content":"Provides considerations, guidelines and limitations for using FILESTREAM data with other features of SQL Server.","pos":[9164,9276]},{"pos":[9282,9290],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[9294,9401],"content":"<bpt id=\"p1\">[</bpt>SQL Server Data Types and ADO.NET<ept id=\"p1\">](../../../../../docs/framework/data/adonet/sql/sql-server-data-types.md)</ept>","source":"[SQL Server Data Types and ADO.NET](../../../../../docs/framework/data/adonet/sql/sql-server-data-types.md)"},{"pos":[9404,9522],"content":"<bpt id=\"p1\">[</bpt>Retrieving and Modifying Data in ADO.NET<ept id=\"p1\">](../../../../../docs/framework/data/adonet/retrieving-and-modifying-data.md)</ept>","source":"[Retrieving and Modifying Data in ADO.NET](../../../../../docs/framework/data/adonet/retrieving-and-modifying-data.md)"},{"pos":[9525,9626],"content":"<bpt id=\"p1\">[</bpt>Code Access Security and ADO.NET<ept id=\"p1\">](../../../../../docs/framework/data/adonet/code-access-security.md)</ept>","source":"[Code Access Security and ADO.NET](../../../../../docs/framework/data/adonet/code-access-security.md)"},{"pos":[9629,9758],"content":"<bpt id=\"p1\">[</bpt>SQL Server Binary and Large-Value Data<ept id=\"p1\">](../../../../../docs/framework/data/adonet/sql/sql-server-binary-and-large-value-data.md)</ept>","source":"[SQL Server Binary and Large-Value Data](../../../../../docs/framework/data/adonet/sql/sql-server-binary-and-large-value-data.md)"},{"pos":[9761,9842],"content":"<bpt id=\"p1\">[</bpt>ADO.NET Overview<ept id=\"p1\">](../../../../../docs/framework/data/adonet/ado-net-overview.md)</ept>","source":"[ADO.NET Overview](../../../../../docs/framework/data/adonet/ado-net-overview.md)"}]}