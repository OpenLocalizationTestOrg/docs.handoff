{"content":"---\ntitle: \"SQLStoreExtensibility | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 5da1b5a3-f144-41ba-b9c4-02818b28b15d\ncaps.latest.revision: 11\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# SQLStoreExtensibility\nThis sample demonstrates the use and configuration of promoted properties in the SQL workflow instance store. The SQL workflow instance store is a SQL-based implementation of an instance store. It allows an instance to save its state and load its state to and from a SQL Server or SQL Server Express database. The store extensibility feature allows the user to define properties that are stored in the instance store. These properties are displayed in a promoted properties view that allows the user to query for them.  \n  \n This sample consists of a workflow that implements a counting service. Once the service's start method is invoked, the service counts from 0 to 29. The counter is incremented once every 2 seconds. After each count, the workflow persists. The current counter value is stored in the instance store as a promoted property.  \n  \n The Counting Workflow is self-hosted by a Workflow Service Host. The program's `Main` method performs the following actions:  \n  \n-   Creates an instance of the Workflow Service Host that hosts the Counting Workflow and defines the endpoints under which the Counting Workflow can be reached.  \n  \n-   Defines a SQL workflow instance store behavior, which is used to configure the SQL workflow instance store. The store is instructed to treat `CountStatus` as a promoted property.  \n  \n-   Creates a client that calls the start method of the counting workflow.  \n  \n Once the program is started, the counter automatically starts counting. Note that it might take a few seconds to load the instance and configure the SQL workflow instance store.  \n  \n To promote the counter value as a custom property, the following steps must be taken:  \n  \n1.  The class `CounterStatus` defines an instance extension of type <xref:System.Activities.Persistence.PersistenceParticipant>, which is used by activities to supply the state variables. `Count` is defined as a write-only value. When a workflow instance comes to a persistence point, the instance extension saves the `Count` property into the persistence data collection.  \n  \n2.  When creating the instance store, a new property, `CountStatus`, is defined through the `store.Promote()` method.  \n  \n3.  The workflow's `SaveCounter` activity assigns the current counter value to the `Count` status field.  \n  \n### To use this sample  \n  \n1.  Create the instance store database.  \n  \n    1.  Open a [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] command prompt.  \n  \n    2.  Navigate to the sample directory (\\WF\\Basic\\Persistence\\SqlStoreExtensibility\\CS) and run CreateInstanceStore.cmd in the [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] command prompt.  \n  \n        > [!WARNING]\n        >  The CreateInstanceStore.cmd script attempts to create the database on the default instance of SQL Server 2008 Express. If you want to install the database on a different instance, modify the script to do so.  \n  \n2.  Open [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] and load the SqlStoreExtensibility.sln solution and build it by pressing CTRL+SHIFT+B.  \n  \n    > [!WARNING]\n    >  If you installed the database on a non-default instance of SQL Server, update the connection string in the code prior to building the solution.  \n  \n3.  Run the sample with administrator privileges by navigating to the projectâ€™s bin directory (\\WF\\Basic\\Persistence\\SqlStoreExtensibility\\bin\\Debug) in [!INCLUDE[fileExplorer](../../../../includes/fileexplorer-md.md)], right-clicking SqlStoreExtensibility.exe and selecting **Run as Administrator**.  \n  \n### To verify the sample is working correctly  \n  \n1.  Use SQL Server Management Studio to view the contents of the instance table by selecting **Databases**, **InstanceStore**, and then **System.ServiceModel.Activities.DurableInstancing.InstanceTable** in the Object Explorer, right-click **System.ServiceModel.Activities.DurableInstancing.InstanceTable** and select **Select Top 1000 Rows**. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] SQL Server Management Studio, see [Introducing SQL Server Management Studio](http://go.microsoft.com/fwlink/?LinkId=165645)  \n  \n2.  Observe the workflow instances listed.  \n  \n3.  In a [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] command prompt, run the QueryInstanceStore.cmd script located in the sample directory (\\WF\\Basic\\Persistence\\SqlStoreExtensibility).  \n  \n4.  Observe the counter value displayed under **CountStatus**.  \n  \n5.  Run the script a few times to see the **CountStats** value change.  \n  \n6.  Press ENTER to terminate the workflow application.  \n  \n### To uninstall the sample  \n  \n1.  Remove the instance store database by running the RemoveInstanceStore.cmd script located in the sample directory (\\WF\\Basic\\Persistence\\SqlStoreExtensibility).  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Basic\\Persistence\\SQLStoreExtensibility`  \n  \n## See Also  \n [Workflow Persistence](../../../../docs/framework/windows-workflow-foundation/workflow-persistence.md)   \n [Workflow Services](../../../../docs/framework/wcf/feature-details/workflow-services.md)   \n [AppFabric Hosting and Persistence Samples](http://go.microsoft.com/fwlink/?LinkId=193961)","nodes":[{"pos":[4,309],"nodes":[{"content":"SQLStoreExtensibility | Microsoft Docs","nodes":[{"pos":[0,38],"content":"SQLStoreExtensibility | Microsoft Docs","nodes":[{"content":"SQLStoreExtensibility | Microsoft Docs","pos":[0,38]}]}],"pos":[6,47],"yaml":true}],"content":"title: \"SQLStoreExtensibility | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 5da1b5a3-f144-41ba-b9c4-02818b28b15d\ncaps.latest.revision: 11\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"","yamlblock":true},{"pos":[316,337],"content":"SQLStoreExtensibility","linkify":"SQLStoreExtensibility","nodes":[{"content":"SQLStoreExtensibility","pos":[0,21]}]},{"content":"This sample demonstrates the use and configuration of promoted properties in the SQL workflow instance store.","pos":[338,447]},{"content":"The SQL workflow instance store is a SQL-based implementation of an instance store.","pos":[448,531]},{"content":"It allows an instance to save its state and load its state to and from a SQL Server or SQL Server Express database.","pos":[532,647]},{"content":"The store extensibility feature allows the user to define properties that are stored in the instance store.","pos":[648,755]},{"content":"These properties are displayed in a promoted properties view that allows the user to query for them.","pos":[756,856]},{"content":"This sample consists of a workflow that implements a counting service.","pos":[863,933]},{"content":"Once the service's start method is invoked, the service counts from 0 to 29.","pos":[934,1010]},{"content":"The counter is incremented once every 2 seconds.","pos":[1011,1059]},{"content":"After each count, the workflow persists.","pos":[1060,1100]},{"content":"The current counter value is stored in the instance store as a promoted property.","pos":[1101,1182]},{"content":"The Counting Workflow is self-hosted by a Workflow Service Host.","pos":[1189,1253]},{"content":"The program's <ph id=\"ph1\">`Main`</ph> method performs the following actions:","pos":[1254,1313],"source":" The program's `Main` method performs the following actions:"},{"content":"Creates an instance of the Workflow Service Host that hosts the Counting Workflow and defines the endpoints under which the Counting Workflow can be reached.","pos":[1323,1480]},{"content":"Defines a SQL workflow instance store behavior, which is used to configure the SQL workflow instance store.","pos":[1490,1597]},{"content":"The store is instructed to treat <ph id=\"ph1\">`CountStatus`</ph> as a promoted property.","pos":[1598,1668],"source":" The store is instructed to treat `CountStatus` as a promoted property."},{"content":"Creates a client that calls the start method of the counting workflow.","pos":[1678,1748]},{"content":"Once the program is started, the counter automatically starts counting.","pos":[1755,1826]},{"content":"Note that it might take a few seconds to load the instance and configure the SQL workflow instance store.","pos":[1827,1932]},{"content":"To promote the counter value as a custom property, the following steps must be taken:","pos":[1939,2024]},{"content":"The class <ph id=\"ph1\">`CounterStatus`</ph> defines an instance extension of type <ph id=\"ph2\">&lt;xref:System.Activities.Persistence.PersistenceParticipant&gt;</ph>, which is used by activities to supply the state variables.","pos":[2034,2217],"source":"The class `CounterStatus` defines an instance extension of type <xref:System.Activities.Persistence.PersistenceParticipant>, which is used by activities to supply the state variables."},{"content":"<ph id=\"ph1\">`Count`</ph> is defined as a write-only value.","pos":[2218,2259],"source":"`Count` is defined as a write-only value."},{"content":"When a workflow instance comes to a persistence point, the instance extension saves the <ph id=\"ph1\">`Count`</ph> property into the persistence data collection.","pos":[2260,2402],"source":" When a workflow instance comes to a persistence point, the instance extension saves the `Count` property into the persistence data collection."},{"pos":[2412,2525],"content":"When creating the instance store, a new property, <ph id=\"ph1\">`CountStatus`</ph>, is defined through the <ph id=\"ph2\">`store.Promote()`</ph> method.","source":"When creating the instance store, a new property, `CountStatus`, is defined through the `store.Promote()` method."},{"pos":[2535,2635],"content":"The workflow's <ph id=\"ph1\">`SaveCounter`</ph> activity assigns the current counter value to the <ph id=\"ph2\">`Count`</ph> status field.","source":"The workflow's `SaveCounter` activity assigns the current counter value to the `Count` status field."},{"pos":[2645,2663],"content":"To use this sample","linkify":"To use this sample","nodes":[{"content":"To use this sample","pos":[0,18]}]},{"content":"Create the instance store database.","pos":[2673,2708]},{"pos":[2722,2798],"content":"Open a <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph> command prompt.","source":"Open a [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] command prompt."},{"pos":[2812,3002],"content":"Navigate to the sample directory (\\WF\\Basic\\Persistence\\SqlStoreExtensibility\\CS) and run CreateInstanceStore.cmd in the <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph> command prompt.","source":"Navigate to the sample directory (\\WF\\Basic\\Persistence\\SqlStoreExtensibility\\CS) and run CreateInstanceStore.cmd in the [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] command prompt."},{"pos":[3018,3247],"content":"[!WARNING]\nThe CreateInstanceStore.cmd script attempts to create the database on the default instance of SQL Server 2008 Express. If you want to install the database on a different instance, modify the script to do so.","leadings":["","        >  "],"nodes":[{"content":"The CreateInstanceStore.cmd script attempts to create the database on the default instance of SQL Server 2008 Express. If you want to install the database on a different instance, modify the script to do so.","pos":[11,218],"nodes":[{"content":"The CreateInstanceStore.cmd script attempts to create the database on the default instance of SQL Server 2008 Express.","pos":[0,118]},{"content":"If you want to install the database on a different instance, modify the script to do so.","pos":[119,207]}]}]},{"pos":[3257,3402],"content":"Open <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph> and load the SqlStoreExtensibility.sln solution and build it by pressing CTRL+SHIFT+B.","source":"Open [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] and load the SqlStoreExtensibility.sln solution and build it by pressing CTRL+SHIFT+B."},{"pos":[3414,3575],"content":"[!WARNING]\nIf you installed the database on a non-default instance of SQL Server, update the connection string in the code prior to building the solution.","leadings":["","    >  "],"nodes":[{"content":"If you installed the database on a non-default instance of SQL Server, update the connection string in the code prior to building the solution.","pos":[11,154]}]},{"pos":[3585,3881],"content":"Run the sample with administrator privileges by navigating to the projectâ€™s bin directory (\\WF\\Basic\\Persistence\\SqlStoreExtensibility\\bin\\Debug) in <ph id=\"ph1\">[!INCLUDE[fileExplorer](../../../../includes/fileexplorer-md.md)]</ph>, right-clicking SqlStoreExtensibility.exe and selecting <bpt id=\"p1\">**</bpt>Run as Administrator<ept id=\"p1\">**</ept>.","source":"Run the sample with administrator privileges by navigating to the projectâ€™s bin directory (\\WF\\Basic\\Persistence\\SqlStoreExtensibility\\bin\\Debug) in [!INCLUDE[fileExplorer](../../../../includes/fileexplorer-md.md)], right-clicking SqlStoreExtensibility.exe and selecting **Run as Administrator**."},{"pos":[3891,3932],"content":"To verify the sample is working correctly","linkify":"To verify the sample is working correctly","nodes":[{"content":"To verify the sample is working correctly","pos":[0,41]}]},{"content":"Use SQL Server Management Studio to view the contents of the instance table by selecting <bpt id=\"p1\">**</bpt>Databases<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>InstanceStore<ept id=\"p2\">**</ept>, and then <bpt id=\"p3\">**</bpt>System.ServiceModel.Activities.DurableInstancing.InstanceTable<ept id=\"p3\">**</ept> in the Object Explorer, right-click <bpt id=\"p4\">**</bpt>System.ServiceModel.Activities.DurableInstancing.InstanceTable<ept id=\"p4\">**</ept> and select <bpt id=\"p5\">**</bpt>Select Top 1000 Rows<ept id=\"p5\">**</ept>.","pos":[3942,4280],"source":"Use SQL Server Management Studio to view the contents of the instance table by selecting **Databases**, **InstanceStore**, and then **System.ServiceModel.Activities.DurableInstancing.InstanceTable** in the Object Explorer, right-click **System.ServiceModel.Activities.DurableInstancing.InstanceTable** and select **Select Top 1000 Rows**."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> SQL Server Management Studio, see <bpt id=\"p1\">[</bpt>Introducing SQL Server Management Studio<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=165645)</ept>","pos":[4281,4460],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] SQL Server Management Studio, see [Introducing SQL Server Management Studio](http://go.microsoft.com/fwlink/?LinkId=165645)"},{"content":"Observe the workflow instances listed.","pos":[4470,4508]},{"pos":[4518,4709],"content":"In a <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph> command prompt, run the QueryInstanceStore.cmd script located in the sample directory (\\WF\\Basic\\Persistence\\SqlStoreExtensibility).","source":"In a [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] command prompt, run the QueryInstanceStore.cmd script located in the sample directory (\\WF\\Basic\\Persistence\\SqlStoreExtensibility)."},{"pos":[4719,4777],"content":"Observe the counter value displayed under <bpt id=\"p1\">**</bpt>CountStatus<ept id=\"p1\">**</ept>.","source":"Observe the counter value displayed under **CountStatus**."},{"pos":[4787,4853],"content":"Run the script a few times to see the <bpt id=\"p1\">**</bpt>CountStats<ept id=\"p1\">**</ept> value change.","source":"Run the script a few times to see the **CountStats** value change."},{"content":"Press ENTER to terminate the workflow application.","pos":[4863,4913]},{"pos":[4923,4946],"content":"To uninstall the sample","linkify":"To uninstall the sample","nodes":[{"content":"To uninstall the sample","pos":[0,23]}]},{"content":"Remove the instance store database by running the RemoveInstanceStore.cmd script located in the sample directory (\\WF\\Basic\\Persistence\\SqlStoreExtensibility).","pos":[4956,5115]},{"pos":[5123,5255],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[14,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[0,53]},{"content":"Check for the following (default) directory before continuing.","pos":[54,116]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[5309,5635],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[5636,5686]},{"pos":[5781,5789],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Workflow Persistence<ept id=\"p1\">](../../../../docs/framework/windows-workflow-foundation/workflow-persistence.md)</ept><ph id=\"ph1\"> </ph>","pos":[5793,5896],"source":"[Workflow Persistence](../../../../docs/framework/windows-workflow-foundation/workflow-persistence.md) "},{"content":"<bpt id=\"p1\">[</bpt>Workflow Services<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/workflow-services.md)</ept><ph id=\"ph1\"> </ph>","pos":[5900,5989],"source":"[Workflow Services](../../../../docs/framework/wcf/feature-details/workflow-services.md) "},{"content":"<bpt id=\"p1\">[</bpt>AppFabric Hosting and Persistence Samples<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=193961)</ept>","pos":[5993,6083],"source":"[AppFabric Hosting and Persistence Samples](http://go.microsoft.com/fwlink/?LinkId=193961)"}]}