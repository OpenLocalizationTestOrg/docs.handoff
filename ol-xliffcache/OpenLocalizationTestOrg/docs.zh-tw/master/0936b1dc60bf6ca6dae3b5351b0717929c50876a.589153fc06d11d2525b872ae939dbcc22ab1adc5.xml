{"content":"---\ntitle: \"How to: Implement Callback Functions\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\n  - \"cpp\"\nhelpviewer_keywords: \n  - \"callback function, implementing\"\nms.assetid: e55b3712-b9ea-4453-bd9a-ad5cfa2f6bfa\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\n---\n# How to: Implement Callback Functions\nThe following procedure and example demonstrate how a managed application, using platform invoke, can print the handle value for each window on the local computer. Specifically, the procedure and example use the **EnumWindows** function to step through the list of windows and a managed callback function (named CallBack) to print the value of the window handle.  \n  \n### To implement a callback function  \n  \n1.  Look at the signature for the **EnumWindows** function before going further with the implementation. **EnumWindows** has the following signature:  \n  \n    ```  \n    BOOL EnumWindows(WNDENUMPROC lpEnumFunc, LPARAM lParam)  \n    ```  \n  \n     One clue that this function requires a callback is the presence of the **lpEnumFunc** argument. It is common to see the **lp** (long pointer) prefix combined with the **Func** suffix in the name of arguments that take a pointer to a callback function. For documentation about Win32 functions, see the Microsoft Platform SDK.  \n  \n2.  Create the managed callback function. The example declares a delegate type, called `CallBack`, which takes two arguments (**hwnd** and **lparam**). The first argument is a handle to the window; the second argument is application-defined. In this release, both arguments must be integers.  \n  \n     Callback functions generally return nonzero values to indicate success and zero to indicate failure. This example explicitly sets the return value to **true** to continue the enumeration.  \n  \n3.  Create a delegate and pass it as an argument to the **EnumWindows** function. Platform invoke converts the delegate to a familiar callback format automatically.  \n  \n4.  Ensure that the garbage collector does not reclaim the delegate before the callback function completes its work. When you pass a delegate as a parameter, or pass a delegate contained as a field in a structure, it remains uncollected for the duration of the call. So, as is the case in the following enumeration example, the callback function completes its work before the call returns and requires no additional action by the managed caller.  \n  \n     If, however, the callback function can be invoked after the call returns, the managed caller must take steps to ensure that the delegate remains uncollected until the callback function finishes. For detailed information about preventing garbage collection, see [Interop Marshaling](../../../docs/framework/interop/interop-marshaling.md) with Platform Invoke.  \n  \n## Example  \n  \n```vb  \nImports System  \nImports System.Runtime.InteropServices  \n  \nPublic Delegate Function CallBack( _  \nhwnd As Integer, lParam As Integer) As Boolean  \n  \nPublic Class EnumReportApp  \n  \n    Declare Function EnumWindows Lib \"user32\" ( _  \n       x As CallBack, y As Integer) As Integer  \n  \n    Public Shared Sub Main()  \n        EnumWindows(AddressOf EnumReportApp.Report, 0)  \n    End Sub 'Main  \n  \n    Public Shared Function Report(hwnd As Integer, lParam As Integer) _  \n    As Boolean  \n        Console.Write(\"Window handle is \")  \n        Console.WriteLine(hwnd)  \n        Return True  \n    End Function 'Report  \nEnd Class 'EnumReportApp  \n```  \n  \n```csharp  \nusing System;  \nusing System.Runtime.InteropServices;  \n  \npublic delegate bool CallBack(int hwnd, int lParam);  \n  \npublic class EnumReportApp  \n{  \n    [DllImport(\"user32\")]  \n    public static extern int EnumWindows(CallBack x, int y);   \n  \n    public static void Main()   \n    {  \n        CallBack myCallBack = new CallBack(EnumReportApp.Report);  \n        EnumWindows(myCallBack, 0);  \n    }  \n  \n    public static bool Report(int hwnd, int lParam)  \n    {   \n        Console.Write(\"Window handle is \");  \n        Console.WriteLine(hwnd);  \n        return true;  \n    }  \n}  \n```  \n  \n```cpp  \nusing namespace System;  \nusing namespace System::Runtime::InteropServices;  \n  \n// A delegate type.  \ndelegate bool CallBack(int hwnd, int lParam);  \n  \n// Managed type with the method to call.  \nref class EnumReport  \n{  \n// Report the window handle.  \npublic:  \n    [DllImport(\"user32\")]  \n    static int EnumWindows(CallBack^ x, int y);  \n  \n    static void Main()  \n    {  \n        EnumReport^ er = gcnew EnumReport;  \n        CallBack^ myCallBack = gcnew CallBack(&EnumReport::Report);  \n        EnumWindows(myCallBack, 0);  \n    }  \n  \n    static bool Report(int hwnd, int lParam)  \n    {  \n       Console::Write(L\"Window handle is \");  \n       Console::WriteLine(hwnd);  \n       return true;  \n    }  \n};  \n  \nint main()  \n{  \n    EnumReport::Main();  \n}  \n```  \n  \n## See also\n\n- [Callback Functions](../../../docs/framework/interop/callback-functions.md)\n- [Calling a DLL Function](../../../docs/framework/interop/calling-a-dll-function.md)\n","nodes":[{"pos":[4,264],"embed":true,"restype":"x-metadata","content":"title: \"How to: Implement Callback Functions\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\n  - \"cpp\"\nhelpviewer_keywords: \n  - \"callback function, implementing\"\nms.assetid: e55b3712-b9ea-4453-bd9a-ad5cfa2f6bfa\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"","nodes":[{"content":"How to: Implement Callback Functions","nodes":[{"pos":[0,36],"content":"How to: Implement Callback Functions","nodes":[{"content":"How to: Implement Callback Functions","pos":[0,36]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[271,307],"content":"How to: Implement Callback Functions","linkify":"How to: Implement Callback Functions","nodes":[{"content":"How to: Implement Callback Functions","pos":[0,36]}]},{"content":"The following procedure and example demonstrate how a managed application, using platform invoke, can print the handle value for each window on the local computer.","pos":[308,471]},{"content":"Specifically, the procedure and example use the <bpt id=\"p1\">**</bpt>EnumWindows<ept id=\"p1\">**</ept> function to step through the list of windows and a managed callback function (named CallBack) to print the value of the window handle.","pos":[472,670],"source":" Specifically, the procedure and example use the **EnumWindows** function to step through the list of windows and a managed callback function (named CallBack) to print the value of the window handle."},{"pos":[680,712],"content":"To implement a callback function","linkify":"To implement a callback function","nodes":[{"content":"To implement a callback function","pos":[0,32]}]},{"content":"Look at the signature for the <bpt id=\"p1\">**</bpt>EnumWindows<ept id=\"p1\">**</ept> function before going further with the implementation.","pos":[722,822],"source":"Look at the signature for the **EnumWindows** function before going further with the implementation."},{"content":"<bpt id=\"p1\">**</bpt>EnumWindows<ept id=\"p1\">**</ept> has the following signature:","pos":[823,867],"source":"**EnumWindows** has the following signature:"},{"content":"One clue that this function requires a callback is the presence of the <bpt id=\"p1\">**</bpt>lpEnumFunc<ept id=\"p1\">**</ept> argument.","pos":[963,1058],"source":"One clue that this function requires a callback is the presence of the **lpEnumFunc** argument."},{"content":"It is common to see the <bpt id=\"p1\">**</bpt>lp<ept id=\"p1\">**</ept> (long pointer) prefix combined with the <bpt id=\"p2\">**</bpt>Func<ept id=\"p2\">**</ept> suffix in the name of arguments that take a pointer to a callback function.","pos":[1059,1214],"source":" It is common to see the **lp** (long pointer) prefix combined with the **Func** suffix in the name of arguments that take a pointer to a callback function."},{"content":"For documentation about Win32 functions, see the Microsoft Platform SDK.","pos":[1215,1287]},{"content":"Create the managed callback function.","pos":[1297,1334]},{"content":"The example declares a delegate type, called <ph id=\"ph1\">`CallBack`</ph>, which takes two arguments (<bpt id=\"p1\">**</bpt>hwnd<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>lparam<ept id=\"p2\">**</ept>).","pos":[1335,1444],"source":" The example declares a delegate type, called `CallBack`, which takes two arguments (**hwnd** and **lparam**)."},{"content":"The first argument is a handle to the window; the second argument is application-defined.","pos":[1445,1534]},{"content":"In this release, both arguments must be integers.","pos":[1535,1584]},{"content":"Callback functions generally return nonzero values to indicate success and zero to indicate failure.","pos":[1595,1695]},{"content":"This example explicitly sets the return value to <bpt id=\"p1\">**</bpt>true<ept id=\"p1\">**</ept> to continue the enumeration.","pos":[1696,1782],"source":" This example explicitly sets the return value to **true** to continue the enumeration."},{"content":"Create a delegate and pass it as an argument to the <bpt id=\"p1\">**</bpt>EnumWindows<ept id=\"p1\">**</ept> function.","pos":[1792,1869],"source":"Create a delegate and pass it as an argument to the **EnumWindows** function."},{"content":"Platform invoke converts the delegate to a familiar callback format automatically.","pos":[1870,1952]},{"content":"Ensure that the garbage collector does not reclaim the delegate before the callback function completes its work.","pos":[1962,2074]},{"content":"When you pass a delegate as a parameter, or pass a delegate contained as a field in a structure, it remains uncollected for the duration of the call.","pos":[2075,2224]},{"content":"So, as is the case in the following enumeration example, the callback function completes its work before the call returns and requires no additional action by the managed caller.","pos":[2225,2403]},{"content":"If, however, the callback function can be invoked after the call returns, the managed caller must take steps to ensure that the delegate remains uncollected until the callback function finishes.","pos":[2414,2608]},{"content":"For detailed information about preventing garbage collection, see <bpt id=\"p1\">[</bpt>Interop Marshaling<ept id=\"p1\">](../../../docs/framework/interop/interop-marshaling.md)</ept> with Platform Invoke.","pos":[2609,2772],"source":" For detailed information about preventing garbage collection, see [Interop Marshaling](../../../docs/framework/interop/interop-marshaling.md) with Platform Invoke."},{"pos":[2781,2788],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"pos":[4845,4853],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[4857,4932],"content":"<bpt id=\"p1\">[</bpt>Callback Functions<ept id=\"p1\">](../../../docs/framework/interop/callback-functions.md)</ept>","source":"[Callback Functions](../../../docs/framework/interop/callback-functions.md)"},{"pos":[4935,5018],"content":"<bpt id=\"p1\">[</bpt>Calling a DLL Function<ept id=\"p1\">](../../../docs/framework/interop/calling-a-dll-function.md)</ept>","source":"[Calling a DLL Function](../../../docs/framework/interop/calling-a-dll-function.md)"}]}