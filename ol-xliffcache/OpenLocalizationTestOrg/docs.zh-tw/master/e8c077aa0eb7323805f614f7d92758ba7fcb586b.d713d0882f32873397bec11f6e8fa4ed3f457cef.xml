{"content":"---\ntitle: \"StackSnapshotCallback Function | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\napi_name: \n  - \"StackSnapshotCallback\"\napi_location: \n  - \"mscorwks.dll\"\napi_type: \n  - \"COM\"\nf1_keywords: \n  - \"StackSnapshotCallback\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"StackSnapshotCallback function [.NET Framework profiling]\"\nms.assetid: d0f235b2-91fe-4f82-b7d5-e5c64186eea8\ntopic_type: \n  - \"apiref\"\ncaps.latest.revision: 10\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"\n---\n# StackSnapshotCallback Function\nProvides the profiler with information about each managed frame and each run of unmanaged frames on the stack during a stack walk, which is initiated by the [ICorProfilerInfo2::DoStackSnapshot](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-dostacksnapshot-method.md) method.  \n  \n## Syntax  \n  \n```  \nHRESULT __stdcall StackSnapshotCallback (  \n    [in] FunctionID funcId,  \n    [in] UINT_PTR ip,  \n    [in] COR_PRF_FRAME_INFO frameInfo,  \n    [in] ULONG32 contextSize,  \n    [in] BYTE context[],  \n    [in] void *clientData  \n);  \n```  \n  \n#### Parameters  \n `funcId`  \n [in] If this value is zero, this callback is for a run of unmanaged frames; otherwise, it is the identifier of a managed function and this callback is for a managed frame.  \n  \n `ip`  \n [in] The value of the native code instruction pointer in the frame.  \n  \n `frameInfo`  \n [in] A `COR_PRF_FRAME_INFO` value that references information about the stack frame. This value is valid for use only during this callback.  \n  \n `contextSize`  \n [in] The size of the `CONTEXT` structure, which is referenced by the `context` parameter.  \n  \n `context`  \n [in] A pointer to a Win32 `CONTEXT` structure that represents the state of the CPU for this frame.  \n  \n The `context` parameter is valid only if the COR_PRF_SNAPSHOT_CONTEXT flag was passed in `ICorProfilerInfo2::DoStackSnapshot`.  \n  \n `clientData`  \n [in] A pointer to the client data, which is passed straight through from `ICorProfilerInfo2::DoStackSnapshot`.  \n  \n## Remarks  \n The `StackSnapshotCallback` function is implemented by the profiler writer. You must limit the complexity of work done in `StackSnapshotCallback`. For example, when using `ICorProfilerInfo2::DoStackSnapshot` in an asynchronous manner, the target thread may be holding locks. If code within `StackSnapshotCallback` requires the same locks, a deadlock could ensue.  \n  \n The `ICorProfilerInfo2::DoStackSnapshot` method calls the `StackSnapshotCallback` function once per managed frame or once per run of unmanaged frames. If `StackSnapshotCallback` is called for a run of unmanaged frames, the profiler may use the register context (referenced by the `context` parameter) to perform its own unmanaged stack walk. In this case, the Win32 `CONTEXT` structure represents the CPU state for the most recently pushed frame within the run of unmanaged frames. Although the Win32 `CONTEXT` structure includes values for all registers, you should rely only on the values of the stack pointer register, frame pointer register, instruction pointer register, and the nonvolatile (that is, preserved) integer registers.  \n  \n## Requirements  \n **Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md).  \n  \n **Header:** CorProf.idl  \n  \n **Library:** CorGuids.lib  \n  \n **.NET Framework Versions:** [!INCLUDE[net_current_v10plus](../../../../includes/net-current-v10plus-md.md)]  \n  \n## See Also  \n [DoStackSnapshot Method](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-dostacksnapshot-method.md)   \n [Profiling Global Static Functions](../../../../docs/framework/unmanaged-api/profiling/profiling-global-static-functions.md)","nodes":[{"pos":[4,625],"embed":true,"restype":"x-metadata","content":"title: \"StackSnapshotCallback Function | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"reference\"\napi_name: \n  - \"StackSnapshotCallback\"\napi_location: \n  - \"mscorwks.dll\"\napi_type: \n  - \"COM\"\nf1_keywords: \n  - \"StackSnapshotCallback\"\ndev_langs: \n  - \"C++\"\nhelpviewer_keywords: \n  - \"StackSnapshotCallback function [.NET Framework profiling]\"\nms.assetid: d0f235b2-91fe-4f82-b7d5-e5c64186eea8\ntopic_type: \n  - \"apiref\"\ncaps.latest.revision: 10\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"","nodes":[{"content":"StackSnapshotCallback Function | Microsoft Docs","nodes":[{"pos":[0,47],"content":"StackSnapshotCallback Function | Microsoft Docs","nodes":[{"content":"StackSnapshotCallback Function | Microsoft Docs","pos":[0,47]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[632,662],"content":"StackSnapshotCallback Function","linkify":"StackSnapshotCallback Function","nodes":[{"content":"StackSnapshotCallback Function","pos":[0,30]}]},{"pos":[663,960],"content":"Provides the profiler with information about each managed frame and each run of unmanaged frames on the stack during a stack walk, which is initiated by the <bpt id=\"p1\">[</bpt>ICorProfilerInfo2::DoStackSnapshot<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-dostacksnapshot-method.md)</ept> method.","source":"Provides the profiler with information about each managed frame and each run of unmanaged frames on the stack during a stack walk, which is initiated by the [ICorProfilerInfo2::DoStackSnapshot](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-dostacksnapshot-method.md) method."},{"pos":[969,975],"content":"Syntax","linkify":"Syntax","nodes":[{"content":"Syntax","pos":[0,6]}]},{"pos":[1232,1242],"content":"Parameters","linkify":"Parameters","nodes":[{"content":"Parameters","pos":[0,10]}]},{"content":"[in] If this value is zero, this callback is for a run of unmanaged frames; otherwise, it is the identifier of a managed function and this callback is for a managed frame.","pos":[1258,1429]},{"content":"[in] The value of the native code instruction pointer in the frame.","pos":[1444,1511]},{"content":"[in] A <ph id=\"ph1\">`COR_PRF_FRAME_INFO`</ph> value that references information about the stack frame.","pos":[1533,1617],"source":"[in] A `COR_PRF_FRAME_INFO` value that references information about the stack frame."},{"content":"This value is valid for use only during this callback.","pos":[1618,1672]},{"content":"[in] The size of the <ph id=\"ph1\">`CONTEXT`</ph> structure, which is referenced by the <ph id=\"ph2\">`context`</ph> parameter.","pos":[1696,1785],"source":"[in] The size of the `CONTEXT` structure, which is referenced by the `context` parameter."},{"content":"[in] A pointer to a Win32 <ph id=\"ph1\">`CONTEXT`</ph> structure that represents the state of the CPU for this frame.","pos":[1805,1903],"source":"[in] A pointer to a Win32 `CONTEXT` structure that represents the state of the CPU for this frame."},{"pos":[1910,2036],"content":"The <ph id=\"ph1\">`context`</ph> parameter is valid only if the COR_PRF_SNAPSHOT_CONTEXT flag was passed in <ph id=\"ph2\">`ICorProfilerInfo2::DoStackSnapshot`</ph>.","source":"The `context` parameter is valid only if the COR_PRF_SNAPSHOT_CONTEXT flag was passed in `ICorProfilerInfo2::DoStackSnapshot`."},{"content":"[in] A pointer to the client data, which is passed straight through from <ph id=\"ph1\">`ICorProfilerInfo2::DoStackSnapshot`</ph>.","pos":[2059,2169],"source":"[in] A pointer to the client data, which is passed straight through from `ICorProfilerInfo2::DoStackSnapshot`."},{"pos":[2178,2185],"content":"Remarks","linkify":"Remarks","nodes":[{"content":"Remarks","pos":[0,7]}]},{"content":"The <ph id=\"ph1\">`StackSnapshotCallback`</ph> function is implemented by the profiler writer.","pos":[2189,2264],"source":"The `StackSnapshotCallback` function is implemented by the profiler writer."},{"content":"You must limit the complexity of work done in <ph id=\"ph1\">`StackSnapshotCallback`</ph>.","pos":[2265,2335],"source":" You must limit the complexity of work done in `StackSnapshotCallback`."},{"content":"For example, when using <ph id=\"ph1\">`ICorProfilerInfo2::DoStackSnapshot`</ph> in an asynchronous manner, the target thread may be holding locks.","pos":[2336,2463],"source":" For example, when using `ICorProfilerInfo2::DoStackSnapshot` in an asynchronous manner, the target thread may be holding locks."},{"content":"If code within <ph id=\"ph1\">`StackSnapshotCallback`</ph> requires the same locks, a deadlock could ensue.","pos":[2464,2551],"source":" If code within `StackSnapshotCallback` requires the same locks, a deadlock could ensue."},{"content":"The <ph id=\"ph1\">`ICorProfilerInfo2::DoStackSnapshot`</ph> method calls the <ph id=\"ph2\">`StackSnapshotCallback`</ph> function once per managed frame or once per run of unmanaged frames.","pos":[2558,2708],"source":"The `ICorProfilerInfo2::DoStackSnapshot` method calls the `StackSnapshotCallback` function once per managed frame or once per run of unmanaged frames."},{"content":"If <ph id=\"ph1\">`StackSnapshotCallback`</ph> is called for a run of unmanaged frames, the profiler may use the register context (referenced by the <ph id=\"ph2\">`context`</ph> parameter) to perform its own unmanaged stack walk.","pos":[2709,2899],"source":" If `StackSnapshotCallback` is called for a run of unmanaged frames, the profiler may use the register context (referenced by the `context` parameter) to perform its own unmanaged stack walk."},{"content":"In this case, the Win32 <ph id=\"ph1\">`CONTEXT`</ph> structure represents the CPU state for the most recently pushed frame within the run of unmanaged frames.","pos":[2900,3039],"source":" In this case, the Win32 `CONTEXT` structure represents the CPU state for the most recently pushed frame within the run of unmanaged frames."},{"content":"Although the Win32 <ph id=\"ph1\">`CONTEXT`</ph> structure includes values for all registers, you should rely only on the values of the stack pointer register, frame pointer register, instruction pointer register, and the nonvolatile (that is, preserved) integer registers.","pos":[3040,3293],"source":" Although the Win32 `CONTEXT` structure includes values for all registers, you should rely only on the values of the stack pointer register, frame pointer register, instruction pointer register, and the nonvolatile (that is, preserved) integer registers."},{"pos":[3302,3314],"content":"Requirements","linkify":"Requirements","nodes":[{"content":"Requirements","pos":[0,12]}]},{"pos":[3318,3422],"content":"<bpt id=\"p1\">**</bpt>Platforms:<ept id=\"p1\">**</ept> See <bpt id=\"p2\">[</bpt>System Requirements<ept id=\"p2\">](../../../../docs/framework/get-started/system-requirements.md)</ept>.","source":"**Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md)."},{"pos":[3429,3452],"content":"<bpt id=\"p1\">**</bpt>Header:<ept id=\"p1\">**</ept> CorProf.idl","source":"**Header:** CorProf.idl"},{"pos":[3459,3484],"content":"<bpt id=\"p1\">**</bpt>Library:<ept id=\"p1\">**</ept> CorGuids.lib","source":"**Library:** CorGuids.lib"},{"pos":[3491,3599],"content":"<bpt id=\"p1\">**</bpt>.NET Framework Versions:<ept id=\"p1\">**</ept> <ph id=\"ph1\">[!INCLUDE[net_current_v10plus](../../../../includes/net-current-v10plus-md.md)]</ph>","source":"**.NET Framework Versions:** [!INCLUDE[net_current_v10plus](../../../../includes/net-current-v10plus-md.md)]"},{"pos":[3608,3616],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>DoStackSnapshot Method<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-dostacksnapshot-method.md)</ept><ph id=\"ph1\"> </ph>","pos":[3620,3741],"source":"[DoStackSnapshot Method](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-dostacksnapshot-method.md) "},{"content":"<bpt id=\"p1\">[</bpt>Profiling Global Static Functions<ept id=\"p1\">](../../../../docs/framework/unmanaged-api/profiling/profiling-global-static-functions.md)</ept>","pos":[3745,3869],"source":"[Profiling Global Static Functions](../../../../docs/framework/unmanaged-api/profiling/profiling-global-static-functions.md)"}]}