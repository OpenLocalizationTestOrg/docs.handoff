{"content":"---\ntitle: \"Weak References\"\nms.date: \"03/30/2017\"\nms.technology: dotnet-standard\nhelpviewer_keywords: \n  - \"weak references, short\"\n  - \"weak references, using\"\n  - \"weak references, long\"\n  - \"garbage collection, weak references\"\nms.assetid: 6a600fe5-3af3-4c64-82da-10a0a8e2d79b\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\n---\n# Weak References\nThe garbage collector cannot collect an object in use by an application while the application's code can reach that object. The application is said to have a strong reference to the object.  \n  \n A weak reference permits the garbage collector to collect the object while still allowing the application to access the object. A weak reference is valid only during the indeterminate amount of time until the object is collected when no strong references exist. When you use a weak reference, the application can still obtain a strong reference to the object, which prevents it from being collected. However, there is always the risk that the garbage collector will get to the object first before a strong reference is reestablished.  \n  \n Weak references are useful for objects that use a lot of memory, but can be recreated easily if they are reclaimed by garbage collection.  \n  \n Suppose a tree view in a Windows Forms application displays a complex hierarchical choice of options to the user. If the underlying data is large, keeping the tree in memory is inefficient when the user is involved with something else in the application.  \n  \n When the user switches away to another part of the application, you can use the <xref:System.WeakReference> class to create a weak reference to the tree and destroy all strong references. When the user switches back to the tree, the application attempts to obtain a strong reference to the tree and, if successful, avoids reconstructing the tree.  \n  \n To establish a weak reference with an object, you create a <xref:System.WeakReference> using the instance of the object to be tracked. You then set the <xref:System.WeakReference.Target%2A> property to that object and set the original reference to the object to `null`. For a code example, see <xref:System.WeakReference> in the class library.  \n  \n## Short and Long Weak References  \n You can create a short weak reference or a long weak reference:  \n  \n-   Short  \n  \n     The target of a short weak reference becomes `null` when the object is reclaimed by garbage collection. The weak reference is itself a managed object, and is subject to garbage collection just like any other managed object.  A short weak reference is the default constructor for <xref:System.WeakReference>.  \n  \n-   Long  \n  \n     A long weak reference is retained after the object's <xref:System.Object.Finalize%2A> method has been called. This allows the object to be recreated, but the state of the object remains unpredictable. To use a long reference, specify `true` in the <xref:System.WeakReference> constructor.  \n  \n     If the object's type does not have a <xref:System.Object.Finalize%2A> method, the short weak reference functionality applies and the weak reference is valid only until the target is collected, which can occur anytime after the finalizer is run.  \n  \n To establish a strong reference and use the object again, cast the <xref:System.WeakReference.Target%2A> property of a <xref:System.WeakReference> to the type of the object. If the <xref:System.WeakReference.Target%2A> property returns `null`, the object was collected; otherwise, you can continue to use the object because the application has regained a strong reference to it.  \n  \n## Guidelines for Using Weak References  \n Use long weak references only when necessary as the state of the object is unpredictable after finalization.  \n  \n Avoid using weak references to small objects because the pointer itself may be as large or larger.  \n  \n Avoid using weak references as an automatic solution to memory management problems. Instead, develop an effective caching policy for handling your application's objects.  \n  \n## See also\n\n- [Garbage Collection](../../../docs/standard/garbage-collection/index.md)\n","nodes":[{"pos":[4,320],"embed":true,"restype":"x-metadata","content":"title: \"Weak References\"\nms.date: \"03/30/2017\"\nms.technology: dotnet-standard\nhelpviewer_keywords: \n  - \"weak references, short\"\n  - \"weak references, using\"\n  - \"weak references, long\"\n  - \"garbage collection, weak references\"\nms.assetid: 6a600fe5-3af3-4c64-82da-10a0a8e2d79b\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"","nodes":[{"content":"Weak References","nodes":[{"pos":[0,15],"content":"Weak References","nodes":[{"content":"Weak References","pos":[0,15]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[327,342],"content":"Weak References","linkify":"Weak References","nodes":[{"content":"Weak References","pos":[0,15]}]},{"content":"The garbage collector cannot collect an object in use by an application while the application's code can reach that object.","pos":[343,466]},{"content":"The application is said to have a strong reference to the object.","pos":[467,532]},{"content":"A weak reference permits the garbage collector to collect the object while still allowing the application to access the object.","pos":[539,666]},{"content":"A weak reference is valid only during the indeterminate amount of time until the object is collected when no strong references exist.","pos":[667,800]},{"content":"When you use a weak reference, the application can still obtain a strong reference to the object, which prevents it from being collected.","pos":[801,938]},{"content":"However, there is always the risk that the garbage collector will get to the object first before a strong reference is reestablished.","pos":[939,1072]},{"content":"Weak references are useful for objects that use a lot of memory, but can be recreated easily if they are reclaimed by garbage collection.","pos":[1079,1216]},{"content":"Suppose a tree view in a Windows Forms application displays a complex hierarchical choice of options to the user.","pos":[1223,1336]},{"content":"If the underlying data is large, keeping the tree in memory is inefficient when the user is involved with something else in the application.","pos":[1337,1477]},{"content":"When the user switches away to another part of the application, you can use the <ph id=\"ph1\">&lt;xref:System.WeakReference&gt;</ph> class to create a weak reference to the tree and destroy all strong references.","pos":[1484,1671],"source":"When the user switches away to another part of the application, you can use the <xref:System.WeakReference> class to create a weak reference to the tree and destroy all strong references."},{"content":"When the user switches back to the tree, the application attempts to obtain a strong reference to the tree and, if successful, avoids reconstructing the tree.","pos":[1672,1830]},{"content":"To establish a weak reference with an object, you create a <ph id=\"ph1\">&lt;xref:System.WeakReference&gt;</ph> using the instance of the object to be tracked.","pos":[1837,1971],"source":"To establish a weak reference with an object, you create a <xref:System.WeakReference> using the instance of the object to be tracked."},{"content":"You then set the <ph id=\"ph1\">&lt;xref:System.WeakReference.Target%2A&gt;</ph> property to that object and set the original reference to the object to <ph id=\"ph2\">`null`</ph>.","pos":[1972,2106],"source":" You then set the <xref:System.WeakReference.Target%2A> property to that object and set the original reference to the object to `null`."},{"content":"For a code example, see <ph id=\"ph1\">&lt;xref:System.WeakReference&gt;</ph> in the class library.","pos":[2107,2180],"source":" For a code example, see <xref:System.WeakReference> in the class library."},{"pos":[2189,2219],"content":"Short and Long Weak References","linkify":"Short and Long Weak References","nodes":[{"content":"Short and Long Weak References","pos":[0,30]}]},{"content":"You can create a short weak reference or a long weak reference:","pos":[2223,2286]},{"content":"Short","pos":[2296,2301]},{"content":"The target of a short weak reference becomes <ph id=\"ph1\">`null`</ph> when the object is reclaimed by garbage collection.","pos":[2312,2415],"source":"The target of a short weak reference becomes `null` when the object is reclaimed by garbage collection."},{"content":"The weak reference is itself a managed object, and is subject to garbage collection just like any other managed object.","pos":[2416,2535]},{"content":"A short weak reference is the default constructor for <ph id=\"ph1\">&lt;xref:System.WeakReference&gt;</ph>.","pos":[2537,2619],"source":"  A short weak reference is the default constructor for <xref:System.WeakReference>."},{"content":"Long","pos":[2629,2633]},{"content":"A long weak reference is retained after the object's <ph id=\"ph1\">&lt;xref:System.Object.Finalize%2A&gt;</ph> method has been called.","pos":[2644,2753],"source":"A long weak reference is retained after the object's <xref:System.Object.Finalize%2A> method has been called."},{"content":"This allows the object to be recreated, but the state of the object remains unpredictable.","pos":[2754,2844]},{"content":"To use a long reference, specify <ph id=\"ph1\">`true`</ph> in the <ph id=\"ph2\">&lt;xref:System.WeakReference&gt;</ph> constructor.","pos":[2845,2932],"source":" To use a long reference, specify `true` in the <xref:System.WeakReference> constructor."},{"pos":[2943,3187],"content":"If the object's type does not have a <ph id=\"ph1\">&lt;xref:System.Object.Finalize%2A&gt;</ph> method, the short weak reference functionality applies and the weak reference is valid only until the target is collected, which can occur anytime after the finalizer is run.","source":"If the object's type does not have a <xref:System.Object.Finalize%2A> method, the short weak reference functionality applies and the weak reference is valid only until the target is collected, which can occur anytime after the finalizer is run."},{"content":"To establish a strong reference and use the object again, cast the <ph id=\"ph1\">&lt;xref:System.WeakReference.Target%2A&gt;</ph> property of a <ph id=\"ph2\">&lt;xref:System.WeakReference&gt;</ph> to the type of the object.","pos":[3194,3367],"source":"To establish a strong reference and use the object again, cast the <xref:System.WeakReference.Target%2A> property of a <xref:System.WeakReference> to the type of the object."},{"content":"If the <ph id=\"ph1\">&lt;xref:System.WeakReference.Target%2A&gt;</ph> property returns <ph id=\"ph2\">`null`</ph>, the object was collected; otherwise, you can continue to use the object because the application has regained a strong reference to it.","pos":[3368,3572],"source":" If the <xref:System.WeakReference.Target%2A> property returns `null`, the object was collected; otherwise, you can continue to use the object because the application has regained a strong reference to it."},{"pos":[3581,3617],"content":"Guidelines for Using Weak References","linkify":"Guidelines for Using Weak References","nodes":[{"content":"Guidelines for Using Weak References","pos":[0,36]}]},{"content":"Use long weak references only when necessary as the state of the object is unpredictable after finalization.","pos":[3621,3729]},{"content":"Avoid using weak references to small objects because the pointer itself may be as large or larger.","pos":[3736,3834]},{"content":"Avoid using weak references as an automatic solution to memory management problems.","pos":[3841,3924]},{"content":"Instead, develop an effective caching policy for handling your application's objects.","pos":[3925,4010]},{"pos":[4019,4027],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[4031,4103],"content":"<bpt id=\"p1\">[</bpt>Garbage Collection<ept id=\"p1\">](../../../docs/standard/garbage-collection/index.md)</ept>","source":"[Garbage Collection](../../../docs/standard/garbage-collection/index.md)"}]}