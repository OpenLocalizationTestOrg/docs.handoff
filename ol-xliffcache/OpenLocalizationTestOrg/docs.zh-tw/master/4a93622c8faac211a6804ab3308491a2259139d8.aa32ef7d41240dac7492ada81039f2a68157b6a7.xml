{"content":"---\ntitle: \"Advanced Format Selection | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: e02d9082-4d55-41d8-9329-98f6d1c77f06\ncaps.latest.revision: 9\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Advanced Format Selection\nThis sample demonstrates how to extend the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] REST programming model to support new outgoing response formats. In addition, the sample uses a T4 Template to return the response as an XHTML page, demonstrating how a view-style programming model can be implemented.  \n  \n## Sample Details  \n The sample consists of a simple service along with client code that makes requests to the service.  The service supports a single [WebGet] operation, which has the following method signature: `Message EchoListWithGet(string list);`  \n  \n When the client makes a request to the service, it provides a comma-separated list of items from the `list` query-string parameter and the service returns that same list in one of the following formats: XML, JSON, Atom, XHTML, or jpeg.  \n  \n The response format returned by the service is determined first by a `format` query-string parameter and second by an HTTP Accept header supplied with the request. If the value of `format` query-string parameter is one of the preceding formats, then the response is returned in that format. If the `format` query-string is not present, then the service iterates through the Accept header elements from the request and returns the format of the first content-type that the service supports.  \n  \n The return type of the operation is worth noting. The [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] REST programming model only natively supports XML and JSON response formats when an operation returns a type other than <xref:System.ServiceModel.Channels.Message>. However, when using <xref:System.ServiceModel.Channels.Message> as the return type, the developer has complete control over how the content of the message should be formatted.  \n  \n The sample uses the <xref:System.ServiceModel.Web.WebOperationContext.CreateXmlResponse%2A>, <xref:System.ServiceModel.Web.WebOperationContext.CreateJsonResponse%2A> and <xref:System.ServiceModel.Web.WebOperationContext.CreateAtom10Response%2A> methods to serialize the list of strings into XML, JSON, and ATOM messages respectively. For the jpeg response format, the <xref:System.ServiceModel.Web.WebOperationContext.CreateStreamResponse%2A> method is used and the image is saved to the stream. For the XHTML response, the <xref:System.ServiceModel.Web.WebOperationContext.CreateTextResponse%2A> is used along with a preprocessed T4 template, which consists of a .tt file and an auto-generated .cs file. The .tt file allows a developer to write a response in a template form that contains variables and control structures. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] T4, see [Generating Artifacts By Using Text Templates](http://go.microsoft.com/fwlink/?LinkId=166023).  \n  \n The sample consists of a self-hosted service and a client that runs within a console application. As the console application runs, the client makes requests to the service and writes the pertinent information from the responses to the console window.  \n  \n#### To run this sample  \n  \n1.  Open the solution for the Advanced Format Selection Sample. When launching [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], you should run as an administrator for the sample to execute successfully. Do this by right-clicking the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icon and choosing **Run as Administrator** from the context menu.  \n  \n2.  Press CTRL+SHIFT+B to build the solution and then press Ctrl-F5 to run the console application AdvancedFormatSelection project without debugging. The console window appears and provides the URI of the running service and the URI of the HTML help page for the running service.  \n  \n3.  As the sample runs, the client sends requests to the service and writes the responses to the console window. Notice the different formats of the responses: XML, JSON, Atom, and XHTML.  \n  \n4.  You are then prompted to browse to a URI in which you can request the response in a .jpeg format. Open a browser and browse to the given URI.  \n  \n5.  Press any key to terminate the sample.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Web\\AdvancedFormatSelection`  \n  \n## See Also","nodes":[{"pos":[12,54],"content":"Advanced Format Selection | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Advanced Format Selection | Microsoft Docs","pos":[0,42]}]},{"pos":[352,377],"content":"Advanced Format Selection","linkify":"Advanced Format Selection","nodes":[{"content":"Advanced Format Selection","pos":[0,25]}]},{"content":"This sample demonstrates how to extend the <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> REST programming model to support new outgoing response formats.","pos":[378,541],"source":"This sample demonstrates how to extend the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] REST programming model to support new outgoing response formats."},{"content":"In addition, the sample uses a T4 Template to return the response as an XHTML page, demonstrating how a view-style programming model can be implemented.","pos":[542,694]},{"pos":[703,717],"content":"Sample Details","linkify":"Sample Details","nodes":[{"content":"Sample Details","pos":[0,14]}]},{"content":"The sample consists of a simple service along with client code that makes requests to the service.","pos":[721,819]},{"content":"The service supports a single [WebGet] operation, which has the following method signature: <ph id=\"ph1\">`Message EchoListWithGet(string list);`</ph>","pos":[821,952],"source":"  The service supports a single [WebGet] operation, which has the following method signature: `Message EchoListWithGet(string list);`"},{"pos":[959,1194],"content":"When the client makes a request to the service, it provides a comma-separated list of items from the <ph id=\"ph1\">`list`</ph> query-string parameter and the service returns that same list in one of the following formats: XML, JSON, Atom, XHTML, or jpeg.","source":"When the client makes a request to the service, it provides a comma-separated list of items from the `list` query-string parameter and the service returns that same list in one of the following formats: XML, JSON, Atom, XHTML, or jpeg."},{"content":"The response format returned by the service is determined first by a <ph id=\"ph1\">`format`</ph> query-string parameter and second by an HTTP Accept header supplied with the request.","pos":[1201,1364],"source":"The response format returned by the service is determined first by a `format` query-string parameter and second by an HTTP Accept header supplied with the request."},{"content":"If the value of <ph id=\"ph1\">`format`</ph> query-string parameter is one of the preceding formats, then the response is returned in that format.","pos":[1365,1491],"source":" If the value of `format` query-string parameter is one of the preceding formats, then the response is returned in that format."},{"content":"If the <ph id=\"ph1\">`format`</ph> query-string is not present, then the service iterates through the Accept header elements from the request and returns the format of the first content-type that the service supports.","pos":[1492,1690],"source":" If the `format` query-string is not present, then the service iterates through the Accept header elements from the request and returns the format of the first content-type that the service supports."},{"content":"The return type of the operation is worth noting.","pos":[1697,1746]},{"content":"The <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> REST programming model only natively supports XML and JSON response formats when an operation returns a type other than <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.Message&gt;</ph>.","pos":[1747,1971],"source":" The [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] REST programming model only natively supports XML and JSON response formats when an operation returns a type other than <xref:System.ServiceModel.Channels.Message>."},{"content":"However, when using <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.Message&gt;</ph> as the return type, the developer has complete control over how the content of the message should be formatted.","pos":[1972,2147],"source":" However, when using <xref:System.ServiceModel.Channels.Message> as the return type, the developer has complete control over how the content of the message should be formatted."},{"content":"The sample uses the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.WebOperationContext.CreateXmlResponse%2A&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.ServiceModel.Web.WebOperationContext.CreateJsonResponse%2A&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.ServiceModel.Web.WebOperationContext.CreateAtom10Response%2A&gt;</ph> methods to serialize the list of strings into XML, JSON, and ATOM messages respectively.","pos":[2154,2487],"source":"The sample uses the <xref:System.ServiceModel.Web.WebOperationContext.CreateXmlResponse%2A>, <xref:System.ServiceModel.Web.WebOperationContext.CreateJsonResponse%2A> and <xref:System.ServiceModel.Web.WebOperationContext.CreateAtom10Response%2A> methods to serialize the list of strings into XML, JSON, and ATOM messages respectively."},{"content":"For the jpeg response format, the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.WebOperationContext.CreateStreamResponse%2A&gt;</ph> method is used and the image is saved to the stream.","pos":[2488,2649],"source":" For the jpeg response format, the <xref:System.ServiceModel.Web.WebOperationContext.CreateStreamResponse%2A> method is used and the image is saved to the stream."},{"content":"For the XHTML response, the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.WebOperationContext.CreateTextResponse%2A&gt;</ph> is used along with a preprocessed T4 template, which consists of a .tt file and an auto-generated .cs file.","pos":[2650,2858],"source":" For the XHTML response, the <xref:System.ServiceModel.Web.WebOperationContext.CreateTextResponse%2A> is used along with a preprocessed T4 template, which consists of a .tt file and an auto-generated .cs file."},{"content":"The .tt file allows a developer to write a response in a template form that contains variables and control structures.","pos":[2859,2977]},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> T4, see <bpt id=\"p1\">[</bpt>Generating Artifacts By Using Text Templates<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=166023)</ept>.","pos":[2978,3136],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] T4, see [Generating Artifacts By Using Text Templates](http://go.microsoft.com/fwlink/?LinkId=166023)."},{"content":"The sample consists of a self-hosted service and a client that runs within a console application.","pos":[3143,3240]},{"content":"As the console application runs, the client makes requests to the service and writes the pertinent information from the responses to the console window.","pos":[3241,3393]},{"pos":[3404,3422],"content":"To run this sample","linkify":"To run this sample","nodes":[{"content":"To run this sample","pos":[0,18]}]},{"content":"Open the solution for the Advanced Format Selection Sample.","pos":[3432,3491]},{"content":"When launching <ph id=\"ph1\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph>, you should run as an administrator for the sample to execute successfully.","pos":[3492,3654],"source":" When launching [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], you should run as an administrator for the sample to execute successfully."},{"content":"Do this by right-clicking the <ph id=\"ph1\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph> icon and choosing <bpt id=\"p1\">**</bpt>Run as Administrator<ept id=\"p1\">**</ept> from the context menu.","pos":[3655,3822],"source":" Do this by right-clicking the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icon and choosing **Run as Administrator** from the context menu."},{"content":"Press CTRL+SHIFT+B to build the solution and then press Ctrl-F5 to run the console application AdvancedFormatSelection project without debugging.","pos":[3832,3977]},{"content":"The console window appears and provides the URI of the running service and the URI of the HTML help page for the running service.","pos":[3978,4107]},{"content":"As the sample runs, the client sends requests to the service and writes the responses to the console window.","pos":[4117,4225]},{"content":"Notice the different formats of the responses: XML, JSON, Atom, and XHTML.","pos":[4226,4300]},{"content":"You are then prompted to browse to a URI in which you can request the response in a .jpeg format.","pos":[4310,4407]},{"content":"Open a browser and browse to the given URI.","pos":[4408,4451]},{"content":"Press any key to terminate the sample.","pos":[4461,4499]},{"pos":[4507,4639],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[4693,5019],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[5020,5070]},{"pos":[5160,5168],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]}]}