{"content":"---\ntitle: \"Discovery Binding Element Sample | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: af513015-85bf-417b-8729-1bdff77ff6d6\ncaps.latest.revision: 12\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Discovery Binding Element Sample\nThis sample demonstrates how to use the discovery client binding element to discover a service. This feature enables developers to add a discovery client channel to their existing client channel stack, making the programming model very intuitive. When the associated channel is opened, the address of the service is resolved using discovery. This sample consists of the following projects:  \n  \n-   **CalculatorService**: A discoverable [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service.  \n  \n-   **CalculatorClient**: A [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client application that uses the discovery client channel to search for and call the CalculatorService.  \n  \n-   **DynamicCalculatorClient**: A [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client application that uses a dynamic endpoint to search for and call the CalculatorService.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Discovery\\DiscoveryBindingElement`  \n  \n## CalculatorService  \n This project contains a simple calculator service that implements the `ICalculatorService` contract.  \n  \n The following App.config file is used to add a `<serviceDiscovery>` behavior in the service behaviors as well as the discovery endpoint.  \n  \n```  \n<system.serviceModel>  \n    <services>  \n      <service behaviorConfiguration=\"CalculatorBehavior\" name=\"Microsoft.Samples.Discovery.CalculatorService\">  \n        <endpoint name=\"udpDiscoveryEpt\" kind=\"udpDiscoveryEndpoint\" />  \n      </service>  \n    </services>  \n    <behaviors>  \n      <!--Enable discovery through configuration.-->  \n      <serviceBehaviors>  \n        <behavior name=\"CalculatorBehavior\">  \n          <serviceDiscovery>  \n          </serviceDiscovery>  \n        </behavior>  \n      </serviceBehaviors>  \n    </behaviors>  \n  </system.serviceModel>  \n```  \n  \n This makes the service and its endpoints discoverable. The CalculatorService is a self-hosted service that adds one endpoint using the NetTcpBinding binding. It also adds an `EndpointDiscoveryBehavior` to the endpoint and specifies a scope as shown in the following code.  \n  \n```  \n// Add a NET.TCP endpoint and add a scope to that endpoint.  \nServiceEndpoint netTcpEndpoint = serviceHost.AddServiceEndpoint(typeof(ICalculatorService), new NetTcpBinding(), netTcpAddress);  \nEndpointDiscoveryBehavior netTctEndpointBehavior = new EndpointDiscoveryBehavior();  \nnetTctEndpointBehavior.Scopes.Add(new Uri(\"ldap:///ou=engineering,o=exampleorg,c=us\"));  \nnetTcpEndpoint.Behaviors.Add(netTctEndpointBehavior);  \nserviceHost.Open();  \n```  \n  \n## CalculatorClient  \n This project contains a client implementation that sends messages to the CalculatorService. This program uses the `CreateCustomBindingWithDiscoveryElement()` method to create a custom binding that uses the Discovery Client Channel.  \n  \n```  \nstatic CustomBinding CreateCustomBindingWithDiscoveryElement()  \n {  \n      DiscoveryClientBindingElement discoveryBindingElement = new DiscoveryClientBindingElement();  \n  \n            // Provide the search criteria and the endpoint over which the probe is sent  \n            discoveryBindingElement.FindCriteria = new FindCriteria(typeof(ICalculatorService));  \n            discoveryBindingElement.DiscoveryEndpointProvider = new UdpDiscoveryEndpointProvider();  \n  \n            CustomBinding customBinding = new CustomBinding(new NetTcpBinding());  \n            // Insert DiscoveryClientBindingElement at the top of the BindingElement stack.  \n            // An exception is thrown if this binding element is not at the top  \n            customBinding.Elements.Insert(0, discoveryBindingElement);  \n  \n            return customBinding; }  \n```  \n  \n After the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> is instantiated, the developer specifies the criteria to use when searching for a service. In this case, the discovery find criterion is the `ICalculatorService` type. Additionally, the developer specifies a <xref:System.ServiceModel.Discovery.DiscoveryEndpointProvider> which returns a <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> that specifies where to look for the services. The <xref:System.ServiceModel.Discovery.DiscoveryEndpointProvider> returns a new <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> instance. [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][Using a Custom Binding with the Discovery Client Channel](../../../../docs/framework/wcf/feature-details/using-a-custom-binding-with-the-discovery-client-channel.md).  \n  \n```  \n// Extend DiscoveryEndpointProvider class to change the default DiscoveryEndpoint  \n    // to the DiscoveryClientBindingElement. The Discovery ClientChannel   \n    // uses this endpoint to send Probe message.  \n    public class UdpDiscoveryEndpointProvider : DiscoveryEndpointProvider  \n    {  \n        public override DiscoveryEndpoint GetDiscoveryEndpoint()  \n        {  \n            return new UdpDiscoveryEndpoint(DiscoveryVersion.WSDiscoveryApril2005);  \n        }  \n    }  \n```  \n  \n In this case, the client uses the UDP multicast mechanism defined by the Discovery protocol to search for services on the local subnet. The remainder of the method creates a custom binding and inserts the Discovery binding element at the top of the stack.  \n  \n> [!NOTE]\n>  The <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> must be placed on the top of the binding stack. Any <xref:System.ServiceModel.Channels.BindingElement> on top of <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> must make sure that the channel factory or channel it creates does not use the `EndpointAddress` or `Via` properties, because the actual address is found only at the Discovery client channel.  \n  \n Next, the `CalculatorClient` can be instantiated by passing in this custom binding as well as an endpoint address.  \n  \n```  \nCalculatorServiceClient client = new CalculatorServiceClient(CreateCustomBindingWithDiscoveryElement(), DiscoveryClientBindingElement.DiscoveryEndpointAddress);  \n```  \n  \n When using the Discovery Client Channel, the constant endpoint address specified previously is passed in. Now at runtime, the Discovery Client Channel finds the service specified by the find criteria and connects to it. For the service and the client to establish a connection, they must also have the same underlying binding stack.  \n  \n#### To use this sample  \n  \n1.  Open the solution in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)].  \n  \n2.  Build the solution.  \n  \n3.  Run the service application and each of the client applications.  \n  \n4.  Observe that the client was able to find the service without knowing its address.  \n  \n## See Also","nodes":[{"pos":[12,61],"content":"Discovery Binding Element Sample | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Discovery Binding Element Sample | Microsoft Docs","pos":[0,49]}]},{"pos":[360,392],"content":"Discovery Binding Element Sample","linkify":"Discovery Binding Element Sample","nodes":[{"content":"Discovery Binding Element Sample","pos":[0,32]}]},{"content":"This sample demonstrates how to use the discovery client binding element to discover a service.","pos":[393,488]},{"content":"This feature enables developers to add a discovery client channel to their existing client channel stack, making the programming model very intuitive.","pos":[489,639]},{"content":"When the associated channel is opened, the address of the service is resolved using discovery.","pos":[640,734]},{"content":"This sample consists of the following projects:","pos":[735,782]},{"pos":[792,894],"content":"<bpt id=\"p1\">**</bpt>CalculatorService<ept id=\"p1\">**</ept>: A discoverable <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> service.","source":"**CalculatorService**: A discoverable [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service."},{"pos":[904,1087],"content":"<bpt id=\"p1\">**</bpt>CalculatorClient<ept id=\"p1\">**</ept>: A <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> client application that uses the discovery client channel to search for and call the CalculatorService.","source":"**CalculatorClient**: A [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client application that uses the discovery client channel to search for and call the CalculatorService."},{"pos":[1097,1277],"content":"<bpt id=\"p1\">**</bpt>DynamicCalculatorClient<ept id=\"p1\">**</ept>: A <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> client application that uses a dynamic endpoint to search for and call the CalculatorService.","source":"**DynamicCalculatorClient**: A [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client application that uses a dynamic endpoint to search for and call the CalculatorService."},{"pos":[1285,1417],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[1471,1797],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[1798,1848]},{"pos":[1944,1961],"content":"CalculatorService","linkify":"CalculatorService","nodes":[{"content":"CalculatorService","pos":[0,17]}]},{"pos":[1965,2065],"content":"This project contains a simple calculator service that implements the <ph id=\"ph1\">`ICalculatorService`</ph> contract.","source":"This project contains a simple calculator service that implements the `ICalculatorService` contract."},{"pos":[2072,2208],"content":"The following App.config file is used to add a <ph id=\"ph1\">`&lt;serviceDiscovery&gt;`</ph> behavior in the service behaviors as well as the discovery endpoint.","source":"The following App.config file is used to add a `<serviceDiscovery>` behavior in the service behaviors as well as the discovery endpoint."},{"content":"This makes the service and its endpoints discoverable.","pos":[2802,2856]},{"content":"The CalculatorService is a self-hosted service that adds one endpoint using the NetTcpBinding binding.","pos":[2857,2959]},{"content":"It also adds an <ph id=\"ph1\">`EndpointDiscoveryBehavior`</ph> to the endpoint and specifies a scope as shown in the following code.","pos":[2960,3073],"source":" It also adds an `EndpointDiscoveryBehavior` to the endpoint and specifies a scope as shown in the following code."},{"pos":[3544,3560],"content":"CalculatorClient","linkify":"CalculatorClient","nodes":[{"content":"CalculatorClient","pos":[0,16]}]},{"content":"This project contains a client implementation that sends messages to the CalculatorService.","pos":[3564,3655]},{"content":"This program uses the <ph id=\"ph1\">`CreateCustomBindingWithDiscoveryElement()`</ph> method to create a custom binding that uses the Discovery Client Channel.","pos":[3656,3795],"source":" This program uses the `CreateCustomBindingWithDiscoveryElement()` method to create a custom binding that uses the Discovery Client Channel."},{"content":"After the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement&gt;</ph> is instantiated, the developer specifies the criteria to use when searching for a service.","pos":[4660,4827],"source":"After the <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> is instantiated, the developer specifies the criteria to use when searching for a service."},{"content":"In this case, the discovery find criterion is the <ph id=\"ph1\">`ICalculatorService`</ph> type.","pos":[4828,4904],"source":" In this case, the discovery find criterion is the `ICalculatorService` type."},{"content":"Additionally, the developer specifies a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryEndpointProvider&gt;</ph> which returns a <ph id=\"ph2\">&lt;xref:System.ServiceModel.Discovery.DiscoveryEndpoint&gt;</ph> that specifies where to look for the services.","pos":[4905,5125],"source":" Additionally, the developer specifies a <xref:System.ServiceModel.Discovery.DiscoveryEndpointProvider> which returns a <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> that specifies where to look for the services."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryEndpointProvider&gt;</ph> returns a new <ph id=\"ph2\">&lt;xref:System.ServiceModel.Discovery.DiscoveryEndpoint&gt;</ph> instance.","pos":[5126,5271],"source":" The <xref:System.ServiceModel.Discovery.DiscoveryEndpointProvider> returns a new <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> instance."},{"content":"<ph id=\"ph1\">[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]</ph><bpt id=\"p1\">[</bpt>Using a Custom Binding with the Discovery Client Channel<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/using-a-custom-binding-with-the-discovery-client-channel.md)</ept>.","pos":[5272,5498],"source":"[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][Using a Custom Binding with the Discovery Client Channel](../../../../docs/framework/wcf/feature-details/using-a-custom-binding-with-the-discovery-client-channel.md)."},{"content":"In this case, the client uses the UDP multicast mechanism defined by the Discovery protocol to search for services on the local subnet.","pos":[6000,6135]},{"content":"The remainder of the method creates a custom binding and inserts the Discovery binding element at the top of the stack.","pos":[6136,6255]},{"pos":[6263,6716],"content":"[!NOTE]\n The <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> must be placed on the top of the binding stack. Any <xref:System.ServiceModel.Channels.BindingElement> on top of <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> must make sure that the channel factory or channel it creates does not use the `EndpointAddress` or `Via` properties, because the actual address is found only at the Discovery client channel.","leadings":["","> "],"nodes":[{"content":" The <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> must be placed on the top of the binding stack. Any <xref:System.ServiceModel.Channels.BindingElement> on top of <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> must make sure that the channel factory or channel it creates does not use the `EndpointAddress` or `Via` properties, because the actual address is found only at the Discovery client channel.","pos":[8,451],"nodes":[{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement&gt;</ph> must be placed on the top of the binding stack.","pos":[1,119],"source":" The <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> must be placed on the top of the binding stack."},{"content":"Any <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.BindingElement&gt;</ph> on top of <ph id=\"ph2\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement&gt;</ph> must make sure that the channel factory or channel it creates does not use the <ph id=\"ph3\">`EndpointAddress`</ph> or <ph id=\"ph4\">`Via`</ph> properties, because the actual address is found only at the Discovery client channel.","pos":[120,443],"source":" Any <xref:System.ServiceModel.Channels.BindingElement> on top of <xref:System.ServiceModel.Discovery.DiscoveryClientBindingElement> must make sure that the channel factory or channel it creates does not use the `EndpointAddress` or `Via` properties, because the actual address is found only at the Discovery client channel."}]}]},{"pos":[6723,6837],"content":"Next, the <ph id=\"ph1\">`CalculatorClient`</ph> can be instantiated by passing in this custom binding as well as an endpoint address.","source":"Next, the `CalculatorClient` can be instantiated by passing in this custom binding as well as an endpoint address."},{"content":"When using the Discovery Client Channel, the constant endpoint address specified previously is passed in.","pos":[7022,7127]},{"content":"Now at runtime, the Discovery Client Channel finds the service specified by the find criteria and connects to it.","pos":[7128,7241]},{"content":"For the service and the client to establish a connection, they must also have the same underlying binding stack.","pos":[7242,7354]},{"pos":[7365,7383],"content":"To use this sample","linkify":"To use this sample","nodes":[{"content":"To use this sample","pos":[0,18]}]},{"pos":[7393,7486],"content":"Open the solution in <ph id=\"ph1\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph>.","source":"Open the solution in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]."},{"content":"Build the solution.","pos":[7496,7515]},{"content":"Run the service application and each of the client applications.","pos":[7525,7589]},{"content":"Observe that the client was able to find the service without knowing its address.","pos":[7599,7680]},{"pos":[7689,7697],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]}]}