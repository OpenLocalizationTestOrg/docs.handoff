{"content":"---\ntitle: \"Dynamic Update\"\nms.date: \"03/30/2017\"\nms.assetid: 8b6ef19b-9691-4b4b-824c-3c651a9db96e\n---\n\n# Dynamic Update\n\nDynamic update provides a mechanism for workflow application developers to update the workflow definition of a persisted workflow instance. This can be to implement a bug fix, new requirements, or to accommodate unexpected changes. This topic provides an overview of the dynamic update functionality introduced in [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].\n\n## Dynamic Update\n\nTo apply dynamic updates to a persisted workflow instance, a <xref:System.Activities.DynamicUpdate.DynamicUpdateMap> is created that contains instructions for the runtime that describe how to modify the persisted workflow instance to reflect the desired changes. Once the update map is created, it is applied to the desired persisted workflow instances. Once the dynamic update is applied, the workflow instance may be resumed using the new updated workflow definition. There are four steps required to create and apply an update map.\n\n1. [Prepare the workflow definition for dynamic update](dynamic-update.md#Prepare)\n\n2. [Update the workflow definition to reflect the desired changes](dynamic-update.md#Update)\n\n3. [Create the update map](dynamic-update.md#Create)\n\n4. [Apply the update map to the desired persisted workflow instances](dynamic-update.md#Apply)\n\n> [!NOTE]\n> Note that steps 1 through 3, which cover the creation of the update map, may be performed independently of applying the update. A common scenario that the workflow developer will create the update map offline, and then an administrator will apply the update at a later time.\n\nThis topic provides an overview of the dynamic update process of adding a new activity to a persisted instance of a compiled Xaml workflow.\n\n### <a name=\"Prepare\"></a> Prepare the workflow definition for dynamic update\n\nThe first step in the dynamic update process is to prepare the desired workflow definition for update. This is done by calling the <xref:System.Activities.DynamicUpdate.DynamicUpdateServices.PrepareForUpdate%2A?displayProperty=nameWithType> method and passing in the workflow definition to modify. This method validates and then walks the workflow tree to identify all of the objects such as public activities and variables that need to be tagged so they can be compared later with the modified workflow definition. When this is complete, the workflow tree is cloned and attached to the original workflow definition. When the update map is created, the updated version of the workflow definition is compared with the original workflow definition and the update map is generated based on the differences.\n\nTo prepare a Xaml workflow for dynamic update it may be loaded into an <xref:System.Activities.ActivityBuilder>, and then the <xref:System.Activities.ActivityBuilder> is passed into <xref:System.Activities.DynamicUpdate.DynamicUpdateServices.PrepareForUpdate%2A?displayProperty=nameWithType>.\n\n> [!NOTE]\n> For more information about working with serialized workflows and <xref:System.Activities.ActivityBuilder>, see [Serializing Workflows and Activities to and from XAML](serializing-workflows-and-activities-to-and-from-xaml.md).\n\nIn the following example, a `MortgageWorkflow` definition (that consists of a <xref:System.Activities.Statements.Sequence> with several child activities) is loaded into an <xref:System.Activities.ActivityBuilder>, and then prepared for dynamic update. After the method returns, the <xref:System.Activities.ActivityBuilder> contains the original workflow definition as well as a copy.\n\n```csharp\n// Load the MortgageWorkflow definition from Xaml into\n// an ActivityBuilder.\nXamlXmlReaderSettings readerSettings = new XamlXmlReaderSettings()\n{\n    LocalAssembly = Assembly.GetExecutingAssembly()\n};\n\nXamlXmlReader xamlReader = new XamlXmlReader(@\"C:\\WorkflowDefinitions\\MortgageWorkflow.xaml\",\n    readerSettings);\n\nActivityBuilder ab = XamlServices.Load(\n    ActivityXamlServices.CreateBuilderReader(xamlReader)) as ActivityBuilder;\n\n// Prepare the workflow definition for dynamic update.\nDynamicUpdateServices.PrepareForUpdate(ab);\n```\n\n> [!NOTE]\n> To download the sample code that accompanies this topic, see [Dynamic Update sample code](https://go.microsoft.com/fwlink/?LinkId=227905).\n\n### <a name=\"Update\"></a> Update the workflow definition to reflect the desired changes\n\nOnce the workflow definition has been prepared for updating, the desired changes can be made. You can add or remove activities, add, move or delete public variables, add or remove arguments, and make changes to the signature of activity delegates. You cannot remove a running activity or change the signature of a running delegate. These changes may be made using code, or in a re-hosted workflow designer. In the following example, a custom `VerifyAppraisal` activity is added to the Sequence that makes up the body of the `MortgageWorkflow` from the previous example.\n\n```csharp\n// Make desired changes to the definition. In this example, we are\n// inserting a new VerifyAppraisal activity as the 3rd child of the root Sequence.\nVerifyAppraisal va = new VerifyAppraisal\n{\n    Result = new VisualBasicReference<bool>(\"LoanCriteria\")\n};\n\n// Get the Sequence that makes up the body of the workflow.\nSequence s = ab.Implementation as Sequence;\n\n// Insert the new activity into the Sequence.\ns.Activities.Insert(2, va);\n```\n\n### <a name=\"Create\"></a> Create the update map\n\nOnce the workflow definition that was prepared for update has been modified, the update map can be created. To create a dynamic update map, the <xref:System.Activities.DynamicUpdate.DynamicUpdateServices.CreateUpdateMap%2A?displayProperty=nameWithType> method is invoked. This returns a <xref:System.Activities.DynamicUpdate.DynamicUpdateMap> that contains the information the runtime needs to modify a persisted workflow instance so that it may be loaded and resumed with the new workflow definition. In the following example, a dynamic map is created for the modified `MortgageWorkflow` definition from the previous example.\n\n```csharp\n// Create the update map.\nDynamicUpdateMap map = DynamicUpdateServices.CreateUpdateMap(ab);\n```\n\nThis update map can immediately be used to modify persisted workflow instances, or more typically it can be saved and the updates applied later. One way to save the update map is to serialize it to a file, as shown in the following example.\n\n```csharp\n// Serialize the update map to a file.\nDataContractSerializer serializer = new DataContractSerializer(typeof(DynamicUpdateMap));\nusing (FileStream fs = System.IO.File.Open(@\"C:\\WorkflowDefinitions\\MortgageWorkflow.map\", FileMode.Create))\n{\n    serializer.WriteObject(fs, map);\n}\n```\n\nWhen <xref:System.Activities.DynamicUpdate.DynamicUpdateServices.CreateUpdateMap%2A?displayProperty=nameWithType> returns, the cloned workflow definition and other dynamic update information that was added in the call to <xref:System.Activities.DynamicUpdate.DynamicUpdateServices.PrepareForUpdate%2A?displayProperty=nameWithType> is removed, and the modified workflow definition is ready to be saved so that it can be used later when resuming updated workflow instances. In the following example, the modified workflow definition is saved to `MortgageWorkflow_v1.1.xaml`.\n\n```csharp\n// Save the modified workflow definition.\nStreamWriter sw = File.CreateText(@\"C:\\WorkflowDefinitions\\MortgageWorkflow_v1.1.xaml\");\nXamlWriter xw = ActivityXamlServices.CreateBuilderWriter(new XamlXmlWriter(sw, new XamlSchemaContext()));\nXamlServices.Save(xw, ab);\nsw.Close();\n```\n\n### <a name=\"Apply\"></a> Apply the update map to the desired persisted workflow instances\n\nApplying the update map can be done at any time after creating it. It can be done right away using the <xref:System.Activities.DynamicUpdate.DynamicUpdateMap> instance that was returned by <xref:System.Activities.DynamicUpdate.DynamicUpdateServices.CreateUpdateMap%2A?displayProperty=nameWithType>, or it can be done later using a saved copy of the update map. To update a workflow instance, load it into a <xref:System.Activities.WorkflowApplicationInstance> using <xref:System.Activities.WorkflowApplication.GetInstance%2A?displayProperty=nameWithType>. Next, create a <xref:System.Activities.WorkflowApplication> using the updated workflow definition, and the desired <xref:System.Activities.WorkflowIdentity>. This <xref:System.Activities.WorkflowIdentity> may be different than the one that was used to persist the original workflow, and typically is in order to reflect that the persisted instance has been modified. Once the <xref:System.Activities.WorkflowApplication> is created, it is loaded using the overload of <xref:System.Activities.WorkflowApplication.Load%2A?displayProperty=nameWithType> that takes a <xref:System.Activities.DynamicUpdate.DynamicUpdateMap>, and then unloaded with a call to <xref:System.Activities.WorkflowApplication.Unload%2A?displayProperty=nameWithType>. This applies the dynamic update and persists the updated workflow instance.\n\n```csharp\n// Load the serialized update map.\nDynamicUpdateMap map;\nusing (FileStream fs = File.Open(@\"C:\\WorkflowDefinitions\\MortgageWorkflow.map\", FileMode.Open))\n{\n    DataContractSerializer serializer = new DataContractSerializer(typeof(DynamicUpdateMap));\n    object updateMap = serializer.ReadObject(fs);\n    if (updateMap == null)\n    {\n        throw new ApplicationException(\"DynamicUpdateMap is null.\");\n    }\n\n    map = (DynamicUpdateMap)updateMap;\n}\n\n// Retrieve a list of workflow instance ids that corresponds to the\n// workflow instances to update. This step is the responsibility of\n// the application developer.\nList<Guid> ids = GetPersistedWorkflowIds();\nforeach (Guid id in ids)\n{\n    // Get a proxy to the persisted workflow instance.\n    SqlWorkflowInstanceStore store = new SqlWorkflowInstanceStore(connectionString);\n    WorkflowApplicationInstance instance = WorkflowApplication.GetInstance(id, store);\n\n    // If desired, you can inspect the WorkflowIdentity of the instance\n    // using the DefinitionIdentity property to determine whether to apply\n    // the update.\n    Console.WriteLine(instance.DefinitionIdentity);\n\n    // Create a workflow application. You must specify the updated workflow definition, and\n    // you may provide an updated WorkflowIdentity if desired to reflect the update.\n    WorkflowIdentity identity = new WorkflowIdentity\n    {\n        Name = \"MortgageWorkflow v1.1\",\n        Version = new Version(1, 1, 0, 0)\n    };\n\n    // Load the persisted workflow instance using the updated workflow definition\n    // and with an updated WorkflowIdentity. In this example the MortgageWorkflow class\n    // contains the updated definition.\n    WorkflowApplication wfApp = new WorkflowApplication(new MortgageWorkflow(), identity);\n\n    // Apply the dynamic update on the loaded instance.\n    wfApp.Load(instance, map);\n\n    // Unload the updated instance.\n    wfApp.Unload();\n}\n```\n\n### Resuming an Updated Workflow Instance\n\nOnce dynamic update has been applied, the workflow instance may be resumed. Note that the new updated definition and <xref:System.Activities.WorkflowIdentity> must be used.\n\n> [!NOTE]\n> For more information about working with <xref:System.Activities.WorkflowApplication> and <xref:System.Activities.WorkflowIdentity>, see [Using WorkflowIdentity and Versioning](using-workflowidentity-and-versioning.md).\n\nIn the following example, the `MortgageWorkflow_v1.1.xaml` workflow from the previous example has been compiled, and is loaded and resumed using the updated workflow definition.\n\n```csharp\n// Load the persisted workflow instance using the updated workflow definition\n// and updated WorkflowIdentity.\nWorkflowIdentity identity = new WorkflowIdentity\n{\n    Name = \"MortgageWorkflow v1.1\",\n    Version = new Version(1, 1, 0, 0)\n};\n\nWorkflowApplication wfApp = new WorkflowApplication(new MortgageWorkflow(), identity);\n\n// Configure persistence and desired workflow event handlers.\n// (Omitted for brevity.)\nConfigureWorkflowApplication(wfApp);\n\n// Load the persisted workflow instance.\nwfApp.Load(InstanceId);\n\n// Resume the workflow.\n// wfApp.ResumeBookmark(...);\n```\n\n> [!NOTE]\n> To download the sample code that accompanies this topic, see [Dynamic Update sample code](https://go.microsoft.com/fwlink/?LinkId=227905).\n","nodes":[{"pos":[4,98],"embed":true,"restype":"x-metadata","content":"title: \"Dynamic Update\"\nms.date: \"03/30/2017\"\nms.assetid: 8b6ef19b-9691-4b4b-824c-3c651a9db96e","nodes":[{"content":"Dynamic Update","nodes":[{"pos":[0,14],"content":"Dynamic Update","nodes":[{"content":"Dynamic Update","pos":[0,14]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[106,120],"content":"Dynamic Update","linkify":"Dynamic Update","nodes":[{"content":"Dynamic Update","pos":[0,14]}]},{"content":"Dynamic update provides a mechanism for workflow application developers to update the workflow definition of a persisted workflow instance.","pos":[122,261]},{"content":"This can be to implement a bug fix, new requirements, or to accommodate unexpected changes.","pos":[262,353]},{"content":"This topic provides an overview of the dynamic update functionality introduced in <ph id=\"ph1\">[!INCLUDE[net_v45](../../../includes/net-v45-md.md)]</ph>.","pos":[354,489],"source":" This topic provides an overview of the dynamic update functionality introduced in [!INCLUDE[net_v45](../../../includes/net-v45-md.md)]."},{"pos":[494,508],"content":"Dynamic Update","linkify":"Dynamic Update","nodes":[{"content":"Dynamic Update","pos":[0,14]}]},{"content":"To apply dynamic updates to a persisted workflow instance, a <ph id=\"ph1\">&lt;xref:System.Activities.DynamicUpdate.DynamicUpdateMap&gt;</ph> is created that contains instructions for the runtime that describe how to modify the persisted workflow instance to reflect the desired changes.","pos":[510,772],"source":"To apply dynamic updates to a persisted workflow instance, a <xref:System.Activities.DynamicUpdate.DynamicUpdateMap> is created that contains instructions for the runtime that describe how to modify the persisted workflow instance to reflect the desired changes."},{"content":"Once the update map is created, it is applied to the desired persisted workflow instances.","pos":[773,863]},{"content":"Once the dynamic update is applied, the workflow instance may be resumed using the new updated workflow definition.","pos":[864,979]},{"content":"There are four steps required to create and apply an update map.","pos":[980,1044]},{"pos":[1049,1128],"content":"<bpt id=\"p1\">[</bpt>Prepare the workflow definition for dynamic update<ept id=\"p1\">](dynamic-update.md#Prepare)</ept>","source":"[Prepare the workflow definition for dynamic update](dynamic-update.md#Prepare)"},{"pos":[1133,1222],"content":"<bpt id=\"p1\">[</bpt>Update the workflow definition to reflect the desired changes<ept id=\"p1\">](dynamic-update.md#Update)</ept>","source":"[Update the workflow definition to reflect the desired changes](dynamic-update.md#Update)"},{"pos":[1227,1276],"content":"<bpt id=\"p1\">[</bpt>Create the update map<ept id=\"p1\">](dynamic-update.md#Create)</ept>","source":"[Create the update map](dynamic-update.md#Create)"},{"pos":[1281,1372],"content":"<bpt id=\"p1\">[</bpt>Apply the update map to the desired persisted workflow instances<ept id=\"p1\">](dynamic-update.md#Apply)</ept>","source":"[Apply the update map to the desired persisted workflow instances](dynamic-update.md#Apply)"},{"pos":[1376,1660],"content":"[!NOTE]\nNote that steps 1 through 3, which cover the creation of the update map, may be performed independently of applying the update. A common scenario that the workflow developer will create the update map offline, and then an administrator will apply the update at a later time.","leadings":["","> "],"nodes":[{"content":"Note that steps 1 through 3, which cover the creation of the update map, may be performed independently of applying the update. A common scenario that the workflow developer will create the update map offline, and then an administrator will apply the update at a later time.","pos":[8,282],"nodes":[{"content":"Note that steps 1 through 3, which cover the creation of the update map, may be performed independently of applying the update.","pos":[0,127]},{"content":"A common scenario that the workflow developer will create the update map offline, and then an administrator will apply the update at a later time.","pos":[128,274]}]}]},{"content":"This topic provides an overview of the dynamic update process of adding a new activity to a persisted instance of a compiled Xaml workflow.","pos":[1662,1801]},{"pos":[1807,1880],"content":"<bpt id=\"p1\">&lt;a name=\"Prepare\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Prepare the workflow definition for dynamic update","linkify":"<a name=\"Prepare\"></a> Prepare the workflow definition for dynamic update","source":"<a name=\"Prepare\"></a> Prepare the workflow definition for dynamic update"},{"content":"The first step in the dynamic update process is to prepare the desired workflow definition for update.","pos":[1882,1984]},{"content":"This is done by calling the <ph id=\"ph1\">&lt;xref:System.Activities.DynamicUpdate.DynamicUpdateServices.PrepareForUpdate%2A?displayProperty=nameWithType&gt;</ph> method and passing in the workflow definition to modify.","pos":[1985,2179],"source":" This is done by calling the <xref:System.Activities.DynamicUpdate.DynamicUpdateServices.PrepareForUpdate%2A?displayProperty=nameWithType> method and passing in the workflow definition to modify."},{"content":"This method validates and then walks the workflow tree to identify all of the objects such as public activities and variables that need to be tagged so they can be compared later with the modified workflow definition.","pos":[2180,2397]},{"content":"When this is complete, the workflow tree is cloned and attached to the original workflow definition.","pos":[2398,2498]},{"content":"When the update map is created, the updated version of the workflow definition is compared with the original workflow definition and the update map is generated based on the differences.","pos":[2499,2685]},{"pos":[2687,2979],"content":"To prepare a Xaml workflow for dynamic update it may be loaded into an <ph id=\"ph1\">&lt;xref:System.Activities.ActivityBuilder&gt;</ph>, and then the <ph id=\"ph2\">&lt;xref:System.Activities.ActivityBuilder&gt;</ph> is passed into <ph id=\"ph3\">&lt;xref:System.Activities.DynamicUpdate.DynamicUpdateServices.PrepareForUpdate%2A?displayProperty=nameWithType&gt;</ph>.","source":"To prepare a Xaml workflow for dynamic update it may be loaded into an <xref:System.Activities.ActivityBuilder>, and then the <xref:System.Activities.ActivityBuilder> is passed into <xref:System.Activities.DynamicUpdate.DynamicUpdateServices.PrepareForUpdate%2A?displayProperty=nameWithType>."},{"pos":[2983,3218],"content":"[!NOTE]\nFor more information about working with serialized workflows and <xref:System.Activities.ActivityBuilder>, see [Serializing Workflows and Activities to and from XAML](serializing-workflows-and-activities-to-and-from-xaml.md).","leadings":["","> "],"nodes":[{"content":"For more information about working with serialized workflows and <ph id=\"ph1\">&lt;xref:System.Activities.ActivityBuilder&gt;</ph>, see <bpt id=\"p1\">[</bpt>Serializing Workflows and Activities to and from XAML<ept id=\"p1\">](serializing-workflows-and-activities-to-and-from-xaml.md)</ept>.","pos":[8,233],"source":"For more information about working with serialized workflows and <xref:System.Activities.ActivityBuilder>, see [Serializing Workflows and Activities to and from XAML](serializing-workflows-and-activities-to-and-from-xaml.md)."}]},{"content":"In the following example, a <ph id=\"ph1\">`MortgageWorkflow`</ph> definition (that consists of a <ph id=\"ph2\">&lt;xref:System.Activities.Statements.Sequence&gt;</ph> with several child activities) is loaded into an <ph id=\"ph3\">&lt;xref:System.Activities.ActivityBuilder&gt;</ph>, and then prepared for dynamic update.","pos":[3220,3471],"source":"In the following example, a `MortgageWorkflow` definition (that consists of a <xref:System.Activities.Statements.Sequence> with several child activities) is loaded into an <xref:System.Activities.ActivityBuilder>, and then prepared for dynamic update."},{"content":"After the method returns, the <ph id=\"ph1\">&lt;xref:System.Activities.ActivityBuilder&gt;</ph> contains the original workflow definition as well as a copy.","pos":[3472,3603],"source":" After the method returns, the <xref:System.Activities.ActivityBuilder> contains the original workflow definition as well as a copy."},{"pos":[4159,4307],"content":"[!NOTE]\nTo download the sample code that accompanies this topic, see [Dynamic Update sample code](https://go.microsoft.com/fwlink/?LinkId=227905).","leadings":["","> "],"nodes":[{"content":"To download the sample code that accompanies this topic, see <bpt id=\"p1\">[</bpt>Dynamic Update sample code<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=227905)</ept>.","pos":[8,146],"source":"To download the sample code that accompanies this topic, see [Dynamic Update sample code](https://go.microsoft.com/fwlink/?LinkId=227905)."}]},{"pos":[4313,4396],"content":"<bpt id=\"p1\">&lt;a name=\"Update\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Update the workflow definition to reflect the desired changes","linkify":"<a name=\"Update\"></a> Update the workflow definition to reflect the desired changes","source":"<a name=\"Update\"></a> Update the workflow definition to reflect the desired changes"},{"content":"Once the workflow definition has been prepared for updating, the desired changes can be made.","pos":[4398,4491]},{"content":"You can add or remove activities, add, move or delete public variables, add or remove arguments, and make changes to the signature of activity delegates.","pos":[4492,4645]},{"content":"You cannot remove a running activity or change the signature of a running delegate.","pos":[4646,4729]},{"content":"These changes may be made using code, or in a re-hosted workflow designer.","pos":[4730,4804]},{"content":"In the following example, a custom <ph id=\"ph1\">`VerifyAppraisal`</ph> activity is added to the Sequence that makes up the body of the <ph id=\"ph2\">`MortgageWorkflow`</ph> from the previous example.","pos":[4805,4967],"source":" In the following example, a custom `VerifyAppraisal` activity is added to the Sequence that makes up the body of the `MortgageWorkflow` from the previous example."},{"pos":[5424,5467],"content":"<bpt id=\"p1\">&lt;a name=\"Create\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Create the update map","linkify":"<a name=\"Create\"></a> Create the update map","source":"<a name=\"Create\"></a> Create the update map"},{"content":"Once the workflow definition that was prepared for update has been modified, the update map can be created.","pos":[5469,5576]},{"content":"To create a dynamic update map, the <ph id=\"ph1\">&lt;xref:System.Activities.DynamicUpdate.DynamicUpdateServices.CreateUpdateMap%2A?displayProperty=nameWithType&gt;</ph> method is invoked.","pos":[5577,5740],"source":" To create a dynamic update map, the <xref:System.Activities.DynamicUpdate.DynamicUpdateServices.CreateUpdateMap%2A?displayProperty=nameWithType> method is invoked."},{"content":"This returns a <ph id=\"ph1\">&lt;xref:System.Activities.DynamicUpdate.DynamicUpdateMap&gt;</ph> that contains the information the runtime needs to modify a persisted workflow instance so that it may be loaded and resumed with the new workflow definition.","pos":[5741,5970],"source":" This returns a <xref:System.Activities.DynamicUpdate.DynamicUpdateMap> that contains the information the runtime needs to modify a persisted workflow instance so that it may be loaded and resumed with the new workflow definition."},{"content":"In the following example, a dynamic map is created for the modified <ph id=\"ph1\">`MortgageWorkflow`</ph> definition from the previous example.","pos":[5971,6095],"source":" In the following example, a dynamic map is created for the modified `MortgageWorkflow` definition from the previous example."},{"content":"This update map can immediately be used to modify persisted workflow instances, or more typically it can be saved and the updates applied later.","pos":[6204,6348]},{"content":"One way to save the update map is to serialize it to a file, as shown in the following example.","pos":[6349,6444]},{"content":"When <ph id=\"ph1\">&lt;xref:System.Activities.DynamicUpdate.DynamicUpdateServices.CreateUpdateMap%2A?displayProperty=nameWithType&gt;</ph> returns, the cloned workflow definition and other dynamic update information that was added in the call to <ph id=\"ph2\">&lt;xref:System.Activities.DynamicUpdate.DynamicUpdateServices.PrepareForUpdate%2A?displayProperty=nameWithType&gt;</ph> is removed, and the modified workflow definition is ready to be saved so that it can be used later when resuming updated workflow instances.","pos":[6740,7211],"source":"When <xref:System.Activities.DynamicUpdate.DynamicUpdateServices.CreateUpdateMap%2A?displayProperty=nameWithType> returns, the cloned workflow definition and other dynamic update information that was added in the call to <xref:System.Activities.DynamicUpdate.DynamicUpdateServices.PrepareForUpdate%2A?displayProperty=nameWithType> is removed, and the modified workflow definition is ready to be saved so that it can be used later when resuming updated workflow instances."},{"content":"In the following example, the modified workflow definition is saved to <ph id=\"ph1\">`MortgageWorkflow_v1.1.xaml`</ph>.","pos":[7212,7312],"source":" In the following example, the modified workflow definition is saved to `MortgageWorkflow_v1.1.xaml`."},{"pos":[7609,7694],"content":"<bpt id=\"p1\">&lt;a name=\"Apply\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Apply the update map to the desired persisted workflow instances","linkify":"<a name=\"Apply\"></a> Apply the update map to the desired persisted workflow instances","source":"<a name=\"Apply\"></a> Apply the update map to the desired persisted workflow instances"},{"content":"Applying the update map can be done at any time after creating it.","pos":[7696,7762]},{"content":"It can be done right away using the <ph id=\"ph1\">&lt;xref:System.Activities.DynamicUpdate.DynamicUpdateMap&gt;</ph> instance that was returned by <ph id=\"ph2\">&lt;xref:System.Activities.DynamicUpdate.DynamicUpdateServices.CreateUpdateMap%2A?displayProperty=nameWithType&gt;</ph>, or it can be done later using a saved copy of the update map.","pos":[7763,8056],"source":" It can be done right away using the <xref:System.Activities.DynamicUpdate.DynamicUpdateMap> instance that was returned by <xref:System.Activities.DynamicUpdate.DynamicUpdateServices.CreateUpdateMap%2A?displayProperty=nameWithType>, or it can be done later using a saved copy of the update map."},{"content":"To update a workflow instance, load it into a <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowApplicationInstance&gt;</ph> using <ph id=\"ph2\">&lt;xref:System.Activities.WorkflowApplication.GetInstance%2A?displayProperty=nameWithType&gt;</ph>.","pos":[8057,8251],"source":" To update a workflow instance, load it into a <xref:System.Activities.WorkflowApplicationInstance> using <xref:System.Activities.WorkflowApplication.GetInstance%2A?displayProperty=nameWithType>."},{"content":"Next, create a <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowApplication&gt;</ph> using the updated workflow definition, and the desired <ph id=\"ph2\">&lt;xref:System.Activities.WorkflowIdentity&gt;</ph>.","pos":[8252,8409],"source":" Next, create a <xref:System.Activities.WorkflowApplication> using the updated workflow definition, and the desired <xref:System.Activities.WorkflowIdentity>."},{"content":"This <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowIdentity&gt;</ph> may be different than the one that was used to persist the original workflow, and typically is in order to reflect that the persisted instance has been modified.","pos":[8410,8618],"source":" This <xref:System.Activities.WorkflowIdentity> may be different than the one that was used to persist the original workflow, and typically is in order to reflect that the persisted instance has been modified."},{"content":"Once the <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowApplication&gt;</ph> is created, it is loaded using the overload of <ph id=\"ph2\">&lt;xref:System.Activities.WorkflowApplication.Load%2A?displayProperty=nameWithType&gt;</ph> that takes a <ph id=\"ph3\">&lt;xref:System.Activities.DynamicUpdate.DynamicUpdateMap&gt;</ph>, and then unloaded with a call to <ph id=\"ph4\">&lt;xref:System.Activities.WorkflowApplication.Unload%2A?displayProperty=nameWithType&gt;</ph>.","pos":[8619,8989],"source":" Once the <xref:System.Activities.WorkflowApplication> is created, it is loaded using the overload of <xref:System.Activities.WorkflowApplication.Load%2A?displayProperty=nameWithType> that takes a <xref:System.Activities.DynamicUpdate.DynamicUpdateMap>, and then unloaded with a call to <xref:System.Activities.WorkflowApplication.Unload%2A?displayProperty=nameWithType>."},{"content":"This applies the dynamic update and persists the updated workflow instance.","pos":[8990,9065]},{"pos":[10995,11032],"content":"Resuming an Updated Workflow Instance","linkify":"Resuming an Updated Workflow Instance","nodes":[{"content":"Resuming an Updated Workflow Instance","pos":[0,37]}]},{"content":"Once dynamic update has been applied, the workflow instance may be resumed.","pos":[11034,11109]},{"content":"Note that the new updated definition and <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowIdentity&gt;</ph> must be used.","pos":[11110,11206],"source":" Note that the new updated definition and <xref:System.Activities.WorkflowIdentity> must be used."},{"pos":[11210,11438],"content":"[!NOTE]\nFor more information about working with <xref:System.Activities.WorkflowApplication> and <xref:System.Activities.WorkflowIdentity>, see [Using WorkflowIdentity and Versioning](using-workflowidentity-and-versioning.md).","leadings":["","> "],"nodes":[{"content":"For more information about working with <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowApplication&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Activities.WorkflowIdentity&gt;</ph>, see <bpt id=\"p1\">[</bpt>Using WorkflowIdentity and Versioning<ept id=\"p1\">](using-workflowidentity-and-versioning.md)</ept>.","pos":[8,226],"source":"For more information about working with <xref:System.Activities.WorkflowApplication> and <xref:System.Activities.WorkflowIdentity>, see [Using WorkflowIdentity and Versioning](using-workflowidentity-and-versioning.md)."}]},{"pos":[11440,11617],"content":"In the following example, the <ph id=\"ph1\">`MortgageWorkflow_v1.1.xaml`</ph> workflow from the previous example has been compiled, and is loaded and resumed using the updated workflow definition.","source":"In the following example, the `MortgageWorkflow_v1.1.xaml` workflow from the previous example has been compiled, and is loaded and resumed using the updated workflow definition."},{"pos":[12210,12358],"content":"[!NOTE]\nTo download the sample code that accompanies this topic, see [Dynamic Update sample code](https://go.microsoft.com/fwlink/?LinkId=227905).","leadings":["","> "],"nodes":[{"content":"To download the sample code that accompanies this topic, see <bpt id=\"p1\">[</bpt>Dynamic Update sample code<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=227905)</ept>.","pos":[8,146],"source":"To download the sample code that accompanies this topic, see [Dynamic Update sample code](https://go.microsoft.com/fwlink/?LinkId=227905)."}]}]}