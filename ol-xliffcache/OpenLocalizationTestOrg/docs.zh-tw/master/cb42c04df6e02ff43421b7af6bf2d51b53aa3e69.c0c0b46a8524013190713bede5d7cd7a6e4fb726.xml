{"content":"---\ntitle: \"disconnectedContext MDA\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"DisconnectedContext MDA\"\n  - \"MDAs (managed debugging assistants), disconnected context\"\n  - \"dead context\"\n  - \"transitioning disconnected apartment or context\"\n  - \"context disconnections\"\n  - \"managed debugging assistants (MDAs), disconnected context\"\nms.assetid: 1887d31d-7006-4491-93b3-68fd5b05f71d\nauthor: \"mairaw\"\nms.author: \"mairaw\"\n---\n# disconnectedContext MDA\nThe `disconnectedContext` managed debugging assistant (MDA) is activated when the CLR attempts to transition into a disconnected apartment or context while servicing a request concerning a COM object.  \n  \n## Symptoms  \n Calls made on a [Runtime Callable Wrapper](../../../docs/framework/interop/runtime-callable-wrapper.md) (RCW) are delivered to the underlying COM component in the current apartment or context instead of the one in which they exist. This can cause corruption and or data loss if the COM component is not multithreaded, as in the case of single-threaded apartment (STA) components. Alternatively, if the RCW is itself a proxy, the call might result in the throwing of a <xref:System.Runtime.InteropServices.COMException> with an HRESULT of RPC_E_WRONG_THREAD.  \n  \n## Cause  \n The OLE apartment or context has been shut down when the CLR attempts to transition into it. This is most commonly caused by STA apartments being shut down before all the COM components owned by the apartment were completely released This can occur as a result of an explicit call from user code on an RCW or while the CLR itself is manipulating the COM component, for example when the CLR is releasing the COM component when the associated RCW has been garbage collected.  \n  \n## Resolution  \n To avoid this problem, ensure the thread that owns the STA does not terminate before the application has finished with all the objects that live in the apartment. The same applies to contexts; ensure contexts are not shut down before the application is completely finished with any COM components that live inside the context.  \n  \n## Effect on the Runtime  \n This MDA has no effect on the CLR. It only reports data about the disconnected context.  \n  \n## Output  \n Reports the context cookie of the disconnected apartment or context.  \n  \n## Configuration  \n  \n```xml  \n<mdaConfig>  \n  <assistants>  \n    <disconnectedContext />  \n  </assistants>  \n</mdaConfig>  \n```  \n  \n## See also\n\n- <xref:System.Runtime.InteropServices.MarshalAsAttribute>\n- [Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)\n- [Interop Marshaling](../../../docs/framework/interop/interop-marshaling.md)\n","nodes":[{"pos":[4,426],"embed":true,"restype":"x-metadata","content":"title: \"disconnectedContext MDA\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"DisconnectedContext MDA\"\n  - \"MDAs (managed debugging assistants), disconnected context\"\n  - \"dead context\"\n  - \"transitioning disconnected apartment or context\"\n  - \"context disconnections\"\n  - \"managed debugging assistants (MDAs), disconnected context\"\nms.assetid: 1887d31d-7006-4491-93b3-68fd5b05f71d\nauthor: \"mairaw\"\nms.author: \"mairaw\"","nodes":[{"content":"disconnectedContext MDA","nodes":[{"pos":[0,23],"content":"disconnectedContext MDA","nodes":[{"content":"disconnectedContext MDA","pos":[0,23]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[433,456],"content":"disconnectedContext MDA","linkify":"disconnectedContext MDA","nodes":[{"content":"disconnectedContext MDA","pos":[0,23]}]},{"pos":[457,657],"content":"The <ph id=\"ph1\">`disconnectedContext`</ph> managed debugging assistant (MDA) is activated when the CLR attempts to transition into a disconnected apartment or context while servicing a request concerning a COM object.","source":"The `disconnectedContext` managed debugging assistant (MDA) is activated when the CLR attempts to transition into a disconnected apartment or context while servicing a request concerning a COM object."},{"pos":[666,674],"content":"Symptoms","linkify":"Symptoms","nodes":[{"content":"Symptoms","pos":[0,8]}]},{"content":"Calls made on a <bpt id=\"p1\">[</bpt>Runtime Callable Wrapper<ept id=\"p1\">](../../../docs/framework/interop/runtime-callable-wrapper.md)</ept> (RCW) are delivered to the underlying COM component in the current apartment or context instead of the one in which they exist.","pos":[678,909],"source":"Calls made on a [Runtime Callable Wrapper](../../../docs/framework/interop/runtime-callable-wrapper.md) (RCW) are delivered to the underlying COM component in the current apartment or context instead of the one in which they exist."},{"content":"This can cause corruption and or data loss if the COM component is not multithreaded, as in the case of single-threaded apartment (STA) components.","pos":[910,1057]},{"content":"Alternatively, if the RCW is itself a proxy, the call might result in the throwing of a <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.COMException&gt;</ph> with an HRESULT of RPC_E_WRONG_THREAD.","pos":[1058,1235],"source":" Alternatively, if the RCW is itself a proxy, the call might result in the throwing of a <xref:System.Runtime.InteropServices.COMException> with an HRESULT of RPC_E_WRONG_THREAD."},{"pos":[1244,1249],"content":"Cause","linkify":"Cause","nodes":[{"content":"Cause","pos":[0,5]}]},{"content":"The OLE apartment or context has been shut down when the CLR attempts to transition into it.","pos":[1253,1345]},{"content":"This is most commonly caused by STA apartments being shut down before all the COM components owned by the apartment were completely released This can occur as a result of an explicit call from user code on an RCW or while the CLR itself is manipulating the COM component, for example when the CLR is releasing the COM component when the associated RCW has been garbage collected.","pos":[1346,1725]},{"pos":[1734,1744],"content":"Resolution","linkify":"Resolution","nodes":[{"content":"Resolution","pos":[0,10]}]},{"content":"To avoid this problem, ensure the thread that owns the STA does not terminate before the application has finished with all the objects that live in the apartment.","pos":[1748,1910]},{"content":"The same applies to contexts; ensure contexts are not shut down before the application is completely finished with any COM components that live inside the context.","pos":[1911,2074]},{"pos":[2083,2104],"content":"Effect on the Runtime","linkify":"Effect on the Runtime","nodes":[{"content":"Effect on the Runtime","pos":[0,21]}]},{"content":"This MDA has no effect on the CLR.","pos":[2108,2142]},{"content":"It only reports data about the disconnected context.","pos":[2143,2195]},{"pos":[2204,2210],"content":"Output","linkify":"Output","nodes":[{"content":"Output","pos":[0,6]}]},{"content":"Reports the context cookie of the disconnected apartment or context.","pos":[2214,2282]},{"pos":[2291,2304],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"pos":[2425,2433],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[2496,2649],"content":"<bpt id=\"p1\">[</bpt>Diagnosing Errors with Managed Debugging Assistants<ept id=\"p1\">](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)</ept>","source":"[Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)"},{"pos":[2652,2727],"content":"<bpt id=\"p1\">[</bpt>Interop Marshaling<ept id=\"p1\">](../../../docs/framework/interop/interop-marshaling.md)</ept>","source":"[Interop Marshaling](../../../docs/framework/interop/interop-marshaling.md)"}]}