{"content":"---\ntitle: \"Discovery with Scopes Sample\"\nms.date: \"03/30/2017\"\nms.assetid: 6a37a754-6b8c-4ebe-bdf2-d4f0520271d5\n---\n# Discovery with Scopes Sample\nThis sample shows how to use scopes to categorize discoverable endpoints as well how to use <xref:System.ServiceModel.Discovery.DiscoveryClient> to perform an asynchronous search for endpoints. On the service, this sample shows how to customize discovery for each endpoint by adding an endpoint discovery behavior and using it to add a scope to the endpoint as well as controlling the endpoint’s discoverability. On the client, the sample goes over how clients can create a <xref:System.ServiceModel.Discovery.DiscoveryClient> and fine tune search parameters to include scopes by adding scopes to the <xref:System.ServiceModel.Discovery.FindCriteria>. This sample also shows how clients can restrict responses by adding a termination criterion.  \n  \n## Service Features  \n This project shows two service endpoints being added to a <xref:System.ServiceModel.ServiceHost>. Each endpoint has a <xref:System.ServiceModel.Discovery.EndpointDiscoveryBehavior> associated with it. This behavior is used to add URI scopes for both endpoints. Scopes are used to distinguish each of these endpoints so that the clients can fine tune the search. For the second endpoint, the discoverability can be disabled by setting the <xref:System.ServiceModel.Discovery.EndpointDiscoveryBehavior.Enabled%2A> property to `false`. This ensures that the discovery metadata associated with this endpoint is not sent as part of any discovery messages.  \n  \n## Client Features  \n The `FindCalculatorServiceAddress()` method shows how to use a <xref:System.ServiceModel.Discovery.DiscoveryClient> and pass in a <xref:System.ServiceModel.Discovery.FindCriteria> with two restrictions. A scope is added to the criteria and the <xref:System.ServiceModel.Discovery.FindCriteria.MaxResults%2A> property is set to 1. The scope limits the results to only the services that publish the same scope. Setting <xref:System.ServiceModel.Discovery.FindCriteria.MaxResults%2A> to 1 limits the responses the <xref:System.ServiceModel.Discovery.DiscoveryClient> waits for to, at most, 1 endpoint. The <xref:System.ServiceModel.Discovery.DiscoveryClient.Find%2A> call is a synchronous operation that blocks the thread until a timeout is reached or one endpoint is found.  \n  \n#### To use this sample  \n  \n1.  This sample uses HTTP endpoints and to run this sample, proper URL ACLs must be added. See [Configuring HTTP and HTTPS](https://go.microsoft.com/fwlink/?LinkId=70353) for details. Executing the following command at an elevated privilege should add the appropriate ACLs. You may want to substitute your Domain and Username for the following arguments if the command does not work as is: `netsh http add urlacl url=http://+:8000/ user=%DOMAIN%\\%UserName%`  \n  \n2.  Build the solution.  \n  \n3.  Run the service executable from the build directory.  \n  \n4.  Run the client executable. Note that the client is able to locate the service.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Discovery\\DiscoveryWithScopes`  \n","nodes":[{"pos":[4,112],"embed":true,"restype":"x-metadata","content":"title: \"Discovery with Scopes Sample\"\nms.date: \"03/30/2017\"\nms.assetid: 6a37a754-6b8c-4ebe-bdf2-d4f0520271d5","nodes":[{"content":"Discovery with Scopes Sample","nodes":[{"pos":[0,28],"content":"Discovery with Scopes Sample","nodes":[{"content":"Discovery with Scopes Sample","pos":[0,28]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[119,147],"content":"Discovery with Scopes Sample","linkify":"Discovery with Scopes Sample","nodes":[{"content":"Discovery with Scopes Sample","pos":[0,28]}]},{"content":"This sample shows how to use scopes to categorize discoverable endpoints as well how to use <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClient&gt;</ph> to perform an asynchronous search for endpoints.","pos":[148,341],"source":"This sample shows how to use scopes to categorize discoverable endpoints as well how to use <xref:System.ServiceModel.Discovery.DiscoveryClient> to perform an asynchronous search for endpoints."},{"content":"On the service, this sample shows how to customize discovery for each endpoint by adding an endpoint discovery behavior and using it to add a scope to the endpoint as well as controlling the endpoint’s discoverability.","pos":[342,560]},{"content":"On the client, the sample goes over how clients can create a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClient&gt;</ph> and fine tune search parameters to include scopes by adding scopes to the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Discovery.FindCriteria&gt;</ph>.","pos":[561,799],"source":" On the client, the sample goes over how clients can create a <xref:System.ServiceModel.Discovery.DiscoveryClient> and fine tune search parameters to include scopes by adding scopes to the <xref:System.ServiceModel.Discovery.FindCriteria>."},{"content":"This sample also shows how clients can restrict responses by adding a termination criterion.","pos":[800,892]},{"pos":[901,917],"content":"Service Features","linkify":"Service Features","nodes":[{"content":"Service Features","pos":[0,16]}]},{"content":"This project shows two service endpoints being added to a <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph>.","pos":[921,1018],"source":"This project shows two service endpoints being added to a <xref:System.ServiceModel.ServiceHost>."},{"content":"Each endpoint has a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.EndpointDiscoveryBehavior&gt;</ph> associated with it.","pos":[1019,1121],"source":" Each endpoint has a <xref:System.ServiceModel.Discovery.EndpointDiscoveryBehavior> associated with it."},{"content":"This behavior is used to add URI scopes for both endpoints.","pos":[1122,1181]},{"content":"Scopes are used to distinguish each of these endpoints so that the clients can fine tune the search.","pos":[1182,1282]},{"content":"For the second endpoint, the discoverability can be disabled by setting the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.EndpointDiscoveryBehavior.Enabled%2A&gt;</ph> property to <ph id=\"ph2\">`false`</ph>.","pos":[1283,1453],"source":" For the second endpoint, the discoverability can be disabled by setting the <xref:System.ServiceModel.Discovery.EndpointDiscoveryBehavior.Enabled%2A> property to `false`."},{"content":"This ensures that the discovery metadata associated with this endpoint is not sent as part of any discovery messages.","pos":[1454,1571]},{"pos":[1580,1595],"content":"Client Features","linkify":"Client Features","nodes":[{"content":"Client Features","pos":[0,15]}]},{"content":"The <ph id=\"ph1\">`FindCalculatorServiceAddress()`</ph> method shows how to use a <ph id=\"ph2\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClient&gt;</ph> and pass in a <ph id=\"ph3\">&lt;xref:System.ServiceModel.Discovery.FindCriteria&gt;</ph> with two restrictions.","pos":[1599,1801],"source":"The `FindCalculatorServiceAddress()` method shows how to use a <xref:System.ServiceModel.Discovery.DiscoveryClient> and pass in a <xref:System.ServiceModel.Discovery.FindCriteria> with two restrictions."},{"content":"A scope is added to the criteria and the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.FindCriteria.MaxResults%2A&gt;</ph> property is set to 1.","pos":[1802,1928],"source":" A scope is added to the criteria and the <xref:System.ServiceModel.Discovery.FindCriteria.MaxResults%2A> property is set to 1."},{"content":"The scope limits the results to only the services that publish the same scope.","pos":[1929,2007]},{"content":"Setting <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.FindCriteria.MaxResults%2A&gt;</ph> to 1 limits the responses the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClient&gt;</ph> waits for to, at most, 1 endpoint.","pos":[2008,2197],"source":" Setting <xref:System.ServiceModel.Discovery.FindCriteria.MaxResults%2A> to 1 limits the responses the <xref:System.ServiceModel.Discovery.DiscoveryClient> waits for to, at most, 1 endpoint."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryClient.Find%2A&gt;</ph> call is a synchronous operation that blocks the thread until a timeout is reached or one endpoint is found.","pos":[2198,2370],"source":" The <xref:System.ServiceModel.Discovery.DiscoveryClient.Find%2A> call is a synchronous operation that blocks the thread until a timeout is reached or one endpoint is found."},{"pos":[2381,2399],"content":"To use this sample","linkify":"To use this sample","nodes":[{"content":"To use this sample","pos":[0,18]}]},{"content":"This sample uses HTTP endpoints and to run this sample, proper URL ACLs must be added.","pos":[2409,2495]},{"content":"See <bpt id=\"p1\">[</bpt>Configuring HTTP and HTTPS<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=70353)</ept> for details.","pos":[2496,2588],"source":" See [Configuring HTTP and HTTPS](https://go.microsoft.com/fwlink/?LinkId=70353) for details."},{"content":"Executing the following command at an elevated privilege should add the appropriate ACLs.","pos":[2589,2678]},{"content":"You may want to substitute your Domain and Username for the following arguments if the command does not work as is: <ph id=\"ph1\">`netsh http add urlacl url=http://+:8000/ user=%DOMAIN%\\%UserName%`</ph>","pos":[2679,2862],"source":" You may want to substitute your Domain and Username for the following arguments if the command does not work as is: `netsh http add urlacl url=http://+:8000/ user=%DOMAIN%\\%UserName%`"},{"content":"Build the solution.","pos":[2872,2891]},{"content":"Run the service executable from the build directory.","pos":[2901,2953]},{"content":"Run the client executable.","pos":[2963,2989]},{"content":"Note that the client is able to locate the service.","pos":[2990,3041]},{"pos":[3049,3181],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[14,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[0,53]},{"content":"Check for the following (default) directory before continuing.","pos":[54,116]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[3235,3545],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[3546,3596]}]}