{"content":"---\ntitle: \"NAT Traversal using IPv6 and Teredo\"\nms.date: \"03/30/2017\"\nms.assetid: 568cd245-3300-49ef-a995-d81bf845d961\n---\n# NAT Traversal using IPv6 and Teredo\nEnhancements were made that provide support for Network Address Translation (NAT) traversal. These changes are designed for use with IPv6 and Teredo, but they are also applicable to other IP tunneling technologies. These enhancements affect classes in the <xref:System.Net> and related namespaces.  \n  \n These changes can affect client and server applications that plan to use IP tunneling technologies.  \n  \n The changes to support NAT traversal are available only for applications using .NET Framework version 4. These features are not available on earlier versions of the .NET Framework.  \n  \n## Overview  \n The Internet Protocol version 4 (IPv4) defined an IPv4 address as 32 bits long. As a result, IPv4 supports approximately 4 billion unique IP addresses (2^32). As the number of computers and network devices on the Internet expanded in the 1990s, the limits of the IPv4 address space became apparent.  \n  \n One of several techniques used to extend the lifetime of IPv4 has been to deploy NAT to allow a single unique public IP address to represent a large number of private IP addresses (private Intranet). The private IP addresses behind the NAT device share the single public IPv4 address. The NAT device may be a dedicated hardware device (an inexpensive Wireless Access Point and router, for example) or a computer running a service to provide NAT. A device or service for this public IP address translates IP network packets between the public Internet and the private Intranet.  \n  \n This scheme works well for client applications running on the private Intranet that send requests to other IP addresses (usually servers) on the Internet. The NAT device or server can keep a mapping of client requests so when a response is returned it knows where to send the response. But this scheme poses problems for applications running in the private Intranet behind the NAT device that want to provide services, listen for packets, and respond. This is particularly the case for peer-to-peer applications.  \n  \n The IPv6 protocol defined an IPv4 address as 128 bits long. As a result, IPv6 supports very a large IP address space of 3.2 x 10^38 unique addresses (2^128). With an address space of this size, it is possible for every device connected to the Internet to be given a unique address. But there are problems. Much of the world is still using only IPv4. In particular, many of the existing routers and wireless access points used by small companies, organizations, and households do not support IPv6. Also some Internet service providers that serve these customers either do not support or have not configured support for IPv6.  \n  \n Several IPv6 transition technologies have been developed to tunnel IPv6 addresses in an IPv4 packet. These technologies include 6to4, ISATAP, and Teredo tunnels that provide address assignment and host-to-host automatic tunneling for unicast IPv6 traffic when IPv6 hosts must traverse IP4 networks to reach other IPv6 networks. IPv6 packets are sent tunneled as IPv4 packets. Several tunneling techniques are being used that allow NAT traversal for IPv6 addresses through a NAT device.  \n  \n Teredo is one of the IPv6 transition technologies which brings IPv6 connectivity to IPv4 networks. Teredo is documented in RFC 4380 published by the Internet Engineering Task Force (IETF). Windows XP SP2 and later provide support for a virtual Teredo adapter which can provide a public IPv6 address in the range 2001:0::/32. This IPv6 address can be used to listen for incoming connections from the Internet and can be provided to IPv6 enabled clients that wish to connect to the listening service. This frees an application from worrying about how to address a computer behind a NAT device, since the application can just connect to it using its IPv6 Teredo address.  \n  \n## Enhancements to Support NAT Traversal and Teredo  \n Enhancements are added to the <xref:System.Net>, <xref:System.Net.NetworkInformation>, and <xref:System.Net.Sockets> namespaces for supporting NAT traversal using IPv6 and Teredo.  \n  \n Several methods are added to the <xref:System.Net.NetworkInformation.IPGlobalProperties?displayProperty=nameWithType> class to get the list of unicast IP addresses on the host. The <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A> method begins an asynchronous request to retrieve the stable unicast IP address table on the local computer. The <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A> method ends a pending asynchronous request to retrieve the stable unicast IP address table on the local computer. The <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A> method is a synchronous request to retrieve the stable unicast IP address table on the local computer, waiting until the address table stabilizes if necessary.  \n  \n The <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType> property can be used to determine if an <xref:System.Net.IPAddress> is an IPv6 Teredo address.  \n  \n Using these new <xref:System.Net.NetworkInformation.IPGlobalProperties> class methods in combination with the <xref:System.Net.IPAddress.IsIPv6Teredo%2A> property allows an application to easily find the Teredo address. An application normally only needs to know the local Teredo address if it is communicating this information to remote applications. For example, a peer-to-peer application might send all of its IPv6 addresses to a matchmaking server which can then forward them to others peers to enable direct communication.  \n  \n An application should normally set its listening service to listen on <xref:System.Net.IPAddress.IPv6Any?displayProperty=nameWithType> rather than on the local Teredo address. So if a remote client or peer has a direct IPv6 route to the host of the listening service, the client or peer can connect directly using IPv6 and not have to use Teredo to tunnel packets.  \n  \n For TCP applications, the <xref:System.Net.Sockets.TcpListener?displayProperty=nameWithType> class has an <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A> method to enable NAT traversal. For UDP applications, the <xref:System.Net.Sockets.UdpClient?displayProperty=nameWithType> class has an <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A> method to enable NAT traversal.  \n  \n For applications that use the <xref:System.Net.Sockets.Socket?displayProperty=nameWithType> and related classes, the <xref:System.Net.Sockets.Socket.GetSocketOption%2A> and <xref:System.Net.Sockets.Socket.SetSocketOption%2A> methods can be used with the <xref:System.Net.Sockets.SocketOptionName.IPProtectionLevel?displayProperty=nameWithType> socket option to query, enable, or disable NAT traversal.  \n  \n## See also\n\n- <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType>\n- <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A?displayProperty=nameWithType>\n- <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A?displayProperty=nameWithType>\n- <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A?displayProperty=nameWithType>\n- <xref:System.Net.Sockets.IPProtectionLevel?displayProperty=nameWithType>\n- <xref:System.Net.Sockets.Socket.SetIPProtectionLevel%2A?displayProperty=nameWithType>\n- <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A?displayProperty=nameWithType>\n- <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A?displayProperty=nameWithType>\n","nodes":[{"pos":[4,119],"embed":true,"restype":"x-metadata","content":"title: \"NAT Traversal using IPv6 and Teredo\"\nms.date: \"03/30/2017\"\nms.assetid: 568cd245-3300-49ef-a995-d81bf845d961","nodes":[{"content":"NAT Traversal using IPv6 and Teredo","nodes":[{"pos":[0,35],"content":"NAT Traversal using IPv6 and Teredo","nodes":[{"content":"NAT Traversal using IPv6 and Teredo","pos":[0,35]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[126,161],"content":"NAT Traversal using IPv6 and Teredo","linkify":"NAT Traversal using IPv6 and Teredo","nodes":[{"content":"NAT Traversal using IPv6 and Teredo","pos":[0,35]}]},{"content":"Enhancements were made that provide support for Network Address Translation (NAT) traversal.","pos":[162,254]},{"content":"These changes are designed for use with IPv6 and Teredo, but they are also applicable to other IP tunneling technologies.","pos":[255,376]},{"content":"These enhancements affect classes in the <ph id=\"ph1\">&lt;xref:System.Net&gt;</ph> and related namespaces.","pos":[377,459],"source":" These enhancements affect classes in the <xref:System.Net> and related namespaces."},{"content":"These changes can affect client and server applications that plan to use IP tunneling technologies.","pos":[466,565]},{"content":"The changes to support NAT traversal are available only for applications using .NET Framework version 4.","pos":[572,676]},{"content":"These features are not available on earlier versions of the .NET Framework.","pos":[677,752]},{"pos":[761,769],"content":"Overview","linkify":"Overview","nodes":[{"content":"Overview","pos":[0,8]}]},{"content":"The Internet Protocol version 4 (IPv4) defined an IPv4 address as 32 bits long.","pos":[773,852]},{"content":"As a result, IPv4 supports approximately 4 billion unique IP addresses (2^32).","pos":[853,931]},{"content":"As the number of computers and network devices on the Internet expanded in the 1990s, the limits of the IPv4 address space became apparent.","pos":[932,1071]},{"content":"One of several techniques used to extend the lifetime of IPv4 has been to deploy NAT to allow a single unique public IP address to represent a large number of private IP addresses (private Intranet).","pos":[1078,1277]},{"content":"The private IP addresses behind the NAT device share the single public IPv4 address.","pos":[1278,1362]},{"content":"The NAT device may be a dedicated hardware device (an inexpensive Wireless Access Point and router, for example) or a computer running a service to provide NAT.","pos":[1363,1523]},{"content":"A device or service for this public IP address translates IP network packets between the public Internet and the private Intranet.","pos":[1524,1654]},{"content":"This scheme works well for client applications running on the private Intranet that send requests to other IP addresses (usually servers) on the Internet.","pos":[1661,1815]},{"content":"The NAT device or server can keep a mapping of client requests so when a response is returned it knows where to send the response.","pos":[1816,1946]},{"content":"But this scheme poses problems for applications running in the private Intranet behind the NAT device that want to provide services, listen for packets, and respond.","pos":[1947,2112]},{"content":"This is particularly the case for peer-to-peer applications.","pos":[2113,2173]},{"content":"The IPv6 protocol defined an IPv4 address as 128 bits long.","pos":[2180,2239]},{"content":"As a result, IPv6 supports very a large IP address space of 3.2 x 10^38 unique addresses (2^128).","pos":[2240,2337]},{"content":"With an address space of this size, it is possible for every device connected to the Internet to be given a unique address.","pos":[2338,2461]},{"content":"But there are problems.","pos":[2462,2485]},{"content":"Much of the world is still using only IPv4.","pos":[2486,2529]},{"content":"In particular, many of the existing routers and wireless access points used by small companies, organizations, and households do not support IPv6.","pos":[2530,2676]},{"content":"Also some Internet service providers that serve these customers either do not support or have not configured support for IPv6.","pos":[2677,2803]},{"content":"Several IPv6 transition technologies have been developed to tunnel IPv6 addresses in an IPv4 packet.","pos":[2810,2910]},{"content":"These technologies include 6to4, ISATAP, and Teredo tunnels that provide address assignment and host-to-host automatic tunneling for unicast IPv6 traffic when IPv6 hosts must traverse IP4 networks to reach other IPv6 networks.","pos":[2911,3137]},{"content":"IPv6 packets are sent tunneled as IPv4 packets.","pos":[3138,3185]},{"content":"Several tunneling techniques are being used that allow NAT traversal for IPv6 addresses through a NAT device.","pos":[3186,3295]},{"content":"Teredo is one of the IPv6 transition technologies which brings IPv6 connectivity to IPv4 networks.","pos":[3302,3400]},{"content":"Teredo is documented in RFC 4380 published by the Internet Engineering Task Force (IETF).","pos":[3401,3490]},{"content":"Windows XP SP2 and later provide support for a virtual Teredo adapter which can provide a public IPv6 address in the range 2001:0::/32.","pos":[3491,3626]},{"content":"This IPv6 address can be used to listen for incoming connections from the Internet and can be provided to IPv6 enabled clients that wish to connect to the listening service.","pos":[3627,3800]},{"content":"This frees an application from worrying about how to address a computer behind a NAT device, since the application can just connect to it using its IPv6 Teredo address.","pos":[3801,3969]},{"pos":[3978,4026],"content":"Enhancements to Support NAT Traversal and Teredo","linkify":"Enhancements to Support NAT Traversal and Teredo","nodes":[{"content":"Enhancements to Support NAT Traversal and Teredo","pos":[0,48]}]},{"pos":[4030,4209],"content":"Enhancements are added to the <ph id=\"ph1\">&lt;xref:System.Net&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.Net.NetworkInformation&gt;</ph>, and <ph id=\"ph3\">&lt;xref:System.Net.Sockets&gt;</ph> namespaces for supporting NAT traversal using IPv6 and Teredo.","source":"Enhancements are added to the <xref:System.Net>, <xref:System.Net.NetworkInformation>, and <xref:System.Net.Sockets> namespaces for supporting NAT traversal using IPv6 and Teredo."},{"content":"Several methods are added to the <ph id=\"ph1\">&lt;xref:System.Net.NetworkInformation.IPGlobalProperties?displayProperty=nameWithType&gt;</ph> class to get the list of unicast IP addresses on the host.","pos":[4216,4392],"source":"Several methods are added to the <xref:System.Net.NetworkInformation.IPGlobalProperties?displayProperty=nameWithType> class to get the list of unicast IP addresses on the host."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A&gt;</ph> method begins an asynchronous request to retrieve the stable unicast IP address table on the local computer.","pos":[4393,4589],"source":" The <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A> method begins an asynchronous request to retrieve the stable unicast IP address table on the local computer."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A&gt;</ph> method ends a pending asynchronous request to retrieve the stable unicast IP address table on the local computer.","pos":[4590,4789],"source":" The <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A> method ends a pending asynchronous request to retrieve the stable unicast IP address table on the local computer."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A&gt;</ph> method is a synchronous request to retrieve the stable unicast IP address table on the local computer, waiting until the address table stabilizes if necessary.","pos":[4790,5032],"source":" The <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A> method is a synchronous request to retrieve the stable unicast IP address table on the local computer, waiting until the address table stabilizes if necessary."},{"pos":[5039,5210],"content":"The <ph id=\"ph1\">&lt;xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType&gt;</ph> property can be used to determine if an <ph id=\"ph2\">&lt;xref:System.Net.IPAddress&gt;</ph> is an IPv6 Teredo address.","source":"The <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType> property can be used to determine if an <xref:System.Net.IPAddress> is an IPv6 Teredo address."},{"content":"Using these new <ph id=\"ph1\">&lt;xref:System.Net.NetworkInformation.IPGlobalProperties&gt;</ph> class methods in combination with the <ph id=\"ph2\">&lt;xref:System.Net.IPAddress.IsIPv6Teredo%2A&gt;</ph> property allows an application to easily find the Teredo address.","pos":[5217,5436],"source":"Using these new <xref:System.Net.NetworkInformation.IPGlobalProperties> class methods in combination with the <xref:System.Net.IPAddress.IsIPv6Teredo%2A> property allows an application to easily find the Teredo address."},{"content":"An application normally only needs to know the local Teredo address if it is communicating this information to remote applications.","pos":[5437,5568]},{"content":"For example, a peer-to-peer application might send all of its IPv6 addresses to a matchmaking server which can then forward them to others peers to enable direct communication.","pos":[5569,5745]},{"content":"An application should normally set its listening service to listen on <ph id=\"ph1\">&lt;xref:System.Net.IPAddress.IPv6Any?displayProperty=nameWithType&gt;</ph> rather than on the local Teredo address.","pos":[5752,5927],"source":"An application should normally set its listening service to listen on <xref:System.Net.IPAddress.IPv6Any?displayProperty=nameWithType> rather than on the local Teredo address."},{"content":"So if a remote client or peer has a direct IPv6 route to the host of the listening service, the client or peer can connect directly using IPv6 and not have to use Teredo to tunnel packets.","pos":[5928,6116]},{"content":"For TCP applications, the <ph id=\"ph1\">&lt;xref:System.Net.Sockets.TcpListener?displayProperty=nameWithType&gt;</ph> class has an <ph id=\"ph2\">&lt;xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A&gt;</ph> method to enable NAT traversal.","pos":[6123,6319],"source":"For TCP applications, the <xref:System.Net.Sockets.TcpListener?displayProperty=nameWithType> class has an <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A> method to enable NAT traversal."},{"content":"For UDP applications, the <ph id=\"ph1\">&lt;xref:System.Net.Sockets.UdpClient?displayProperty=nameWithType&gt;</ph> class has an <ph id=\"ph2\">&lt;xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A&gt;</ph> method to enable NAT traversal.","pos":[6320,6512],"source":" For UDP applications, the <xref:System.Net.Sockets.UdpClient?displayProperty=nameWithType> class has an <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A> method to enable NAT traversal."},{"pos":[6519,6920],"content":"For applications that use the <ph id=\"ph1\">&lt;xref:System.Net.Sockets.Socket?displayProperty=nameWithType&gt;</ph> and related classes, the <ph id=\"ph2\">&lt;xref:System.Net.Sockets.Socket.GetSocketOption%2A&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.Net.Sockets.Socket.SetSocketOption%2A&gt;</ph> methods can be used with the <ph id=\"ph4\">&lt;xref:System.Net.Sockets.SocketOptionName.IPProtectionLevel?displayProperty=nameWithType&gt;</ph> socket option to query, enable, or disable NAT traversal.","source":"For applications that use the <xref:System.Net.Sockets.Socket?displayProperty=nameWithType> and related classes, the <xref:System.Net.Sockets.Socket.GetSocketOption%2A> and <xref:System.Net.Sockets.Socket.SetSocketOption%2A> methods can be used with the <xref:System.Net.Sockets.SocketOptionName.IPProtectionLevel?displayProperty=nameWithType> socket option to query, enable, or disable NAT traversal."},{"pos":[6929,6937],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]}]}