{"content":"---\ntitle: \"gcManagedToUnmanaged MDA\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"MDAs (managed debugging assistants), garbage collection\"\n  - \"GcManagedToUnmanaged MDA\"\n  - \"GC managed to unmanaged\"\n  - \"transitioning threads managed to unmanaged code\"\n  - \"threading [.NET Framework], garbage collection\"\n  - \"managed to unmanaged garbage collection\"\n  - \"managed debugging assistants (MDAs), garbage collection\"\n  - \"threading [.NET Framework], managed debugging assistants\"\n  - \"garbage collection, run-time errors\"\nms.assetid: 7417f837-805e-4fed-a430-ca919c8421dc\nauthor: \"mairaw\"\nms.author: \"mairaw\"\n---\n# gcManagedToUnmanaged MDA\nThe `gcManagedToUnmanaged` managed debugging assistant (MDA) causes a garbage collection whenever a thread transitions from managed to unmanaged code.  \n  \n## Symptoms  \n An unmanaged user component throws an access violation when trying to use a managed object that had been exposed to COM. The COM object appears to have been released. The access violation is nondeterministic.  \n  \n## Cause  \n If an unmanaged component is not reference counting a managed COM object correctly, then the runtime could collect a managed object exposed to COM when the unmanaged component still holds a reference to the object. The runtime calls <xref:System.Runtime.InteropServices.Marshal.Release%2A> during garbage collections, so if the user component uses the object before the garbage collection occurs, then it will not yet have been collected. This is the source of the nondeterminism.  \n  \n## Resolution  \n Enabling this assistant reduces the time between when the object is eligible for collection and <xref:System.Runtime.InteropServices.Marshal.Release%2A> is called, helping to track down which unmanaged component first tries to access the collected object.  \n  \n## Effect on the Runtime  \n Causes a garbage collection whenever a thread transitions from managed to unmanaged code.  \n  \n## Output  \n This MDA produces no output.  \n  \n## Configuration  \n  \n```xml  \n<mdaConfig>  \n  <assistants>  \n    <gcManagedToUnmanaged/>  \n  </assistants>  \n</mdaConfig>  \n```  \n  \n## See also\n\n- <xref:System.Runtime.InteropServices.MarshalAsAttribute>\n- [Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)\n- [Interop Marshaling](../../../docs/framework/interop/interop-marshaling.md)\n- [gcUnmanagedToManaged](../../../docs/framework/debug-trace-profile/gcunmanagedtomanaged-mda.md)\n","nodes":[{"pos":[4,610],"embed":true,"restype":"x-metadata","content":"title: \"gcManagedToUnmanaged MDA\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"MDAs (managed debugging assistants), garbage collection\"\n  - \"GcManagedToUnmanaged MDA\"\n  - \"GC managed to unmanaged\"\n  - \"transitioning threads managed to unmanaged code\"\n  - \"threading [.NET Framework], garbage collection\"\n  - \"managed to unmanaged garbage collection\"\n  - \"managed debugging assistants (MDAs), garbage collection\"\n  - \"threading [.NET Framework], managed debugging assistants\"\n  - \"garbage collection, run-time errors\"\nms.assetid: 7417f837-805e-4fed-a430-ca919c8421dc\nauthor: \"mairaw\"\nms.author: \"mairaw\"","nodes":[{"content":"gcManagedToUnmanaged MDA","nodes":[{"pos":[0,24],"content":"gcManagedToUnmanaged MDA","nodes":[{"content":"gcManagedToUnmanaged MDA","pos":[0,24]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[617,641],"content":"gcManagedToUnmanaged MDA","linkify":"gcManagedToUnmanaged MDA","nodes":[{"content":"gcManagedToUnmanaged MDA","pos":[0,24]}]},{"pos":[642,792],"content":"The <ph id=\"ph1\">`gcManagedToUnmanaged`</ph> managed debugging assistant (MDA) causes a garbage collection whenever a thread transitions from managed to unmanaged code.","source":"The `gcManagedToUnmanaged` managed debugging assistant (MDA) causes a garbage collection whenever a thread transitions from managed to unmanaged code."},{"pos":[801,809],"content":"Symptoms","linkify":"Symptoms","nodes":[{"content":"Symptoms","pos":[0,8]}]},{"content":"An unmanaged user component throws an access violation when trying to use a managed object that had been exposed to COM.","pos":[813,933]},{"content":"The COM object appears to have been released.","pos":[934,979]},{"content":"The access violation is nondeterministic.","pos":[980,1021]},{"pos":[1030,1035],"content":"Cause","linkify":"Cause","nodes":[{"content":"Cause","pos":[0,5]}]},{"content":"If an unmanaged component is not reference counting a managed COM object correctly, then the runtime could collect a managed object exposed to COM when the unmanaged component still holds a reference to the object.","pos":[1039,1253]},{"content":"The runtime calls <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.Marshal.Release%2A&gt;</ph> during garbage collections, so if the user component uses the object before the garbage collection occurs, then it will not yet have been collected.","pos":[1254,1477],"source":" The runtime calls <xref:System.Runtime.InteropServices.Marshal.Release%2A> during garbage collections, so if the user component uses the object before the garbage collection occurs, then it will not yet have been collected."},{"content":"This is the source of the nondeterminism.","pos":[1478,1519]},{"pos":[1528,1538],"content":"Resolution","linkify":"Resolution","nodes":[{"content":"Resolution","pos":[0,10]}]},{"pos":[1542,1797],"content":"Enabling this assistant reduces the time between when the object is eligible for collection and <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.Marshal.Release%2A&gt;</ph> is called, helping to track down which unmanaged component first tries to access the collected object.","source":"Enabling this assistant reduces the time between when the object is eligible for collection and <xref:System.Runtime.InteropServices.Marshal.Release%2A> is called, helping to track down which unmanaged component first tries to access the collected object."},{"pos":[1806,1827],"content":"Effect on the Runtime","linkify":"Effect on the Runtime","nodes":[{"content":"Effect on the Runtime","pos":[0,21]}]},{"content":"Causes a garbage collection whenever a thread transitions from managed to unmanaged code.","pos":[1831,1920]},{"pos":[1929,1935],"content":"Output","linkify":"Output","nodes":[{"content":"Output","pos":[0,6]}]},{"content":"This MDA produces no output.","pos":[1939,1967]},{"pos":[1976,1989],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"pos":[2110,2118],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[2181,2334],"content":"<bpt id=\"p1\">[</bpt>Diagnosing Errors with Managed Debugging Assistants<ept id=\"p1\">](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)</ept>","source":"[Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)"},{"pos":[2337,2412],"content":"<bpt id=\"p1\">[</bpt>Interop Marshaling<ept id=\"p1\">](../../../docs/framework/interop/interop-marshaling.md)</ept>","source":"[Interop Marshaling](../../../docs/framework/interop/interop-marshaling.md)"},{"pos":[2415,2510],"content":"<bpt id=\"p1\">[</bpt>gcUnmanagedToManaged<ept id=\"p1\">](../../../docs/framework/debug-trace-profile/gcunmanagedtomanaged-mda.md)</ept>","source":"[gcUnmanagedToManaged](../../../docs/framework/debug-trace-profile/gcunmanagedtomanaged-mda.md)"}]}