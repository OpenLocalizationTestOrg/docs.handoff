{"content":"---\ntitle: \"WCF Services and Event Tracing for Windows\"\nms.date: \"03/30/2017\"\nms.assetid: eda4355d-0bd0-4dc9-80a2-d2c832152272\n---\n# WCF Services and Event Tracing for Windows\nThis sample demonstrates how to use the analytic tracing in Windows Communication Foundation (WCF) to emit events in Event Tracing for Windows (ETW). The analytic traces are events emitted at key points in the WCF stack that allow troubleshooting of WCF services in production environment.\n\n Analytic trace in WCF services is tracing that can be turned on in a production environment with minimal impact on performance. These traces are emitted as events to an ETW session.\n\n This sample includes a basic WCF service in which events are emitted from the service to the event log, which can be viewed using Event Viewer. It is also possible to start a dedicated ETW session that listens for events from the WCF service. The sample includes a script to create a dedicated ETW session that stores events in a binary file that can be read using Event Viewer.\n\n#### To use this sample\n\n1.  Using Visual Studio 2012, open the EtwAnalyticTraceSample.sln solution file.\n\n2.  To build the solution, press CTRL+SHIFT+B.\n\n3.  To run the solution, press CTRL+F5.\n\n     In the Web browser, click **Calculator.svc**. The URI of the WSDL document for the service should appear in the browser. Copy that URI.\n\n     By default, the service starts listening for requests on port 1378 `http://localhost:1378/Calculator.svc`.\n\n4.  Run the WCF test client (WcfTestClient.exe).\n\n     The WCF test client (WcfTestClient.exe) is located at `\\<Visual Studio 2012 Install Dir>\\Common7\\IDE\\WcfTestClient.exe`.  The default Visual Studio 2012 install dir is `C:\\Program Files\\Microsoft Visual Studio 10.0`.\n\n5.  Within the WCF test client, add the service by selecting **File**, and then **Add Service**.\n\n     Add the endpoint address in the input box. The default is `http://localhost:1378/Calculator.svc`.\n\n6.  Open the Event Viewer application.\n\n     Before invoking the service, start Event Viewer and ensure that the event log is listening for tracking events emitted from the WCF service.\n\n7.  From the **Start** menu, select **Administrative Tools**, and then **Event Viewer**.  Enable the **Analytic** and **Debug** logs.\n\n8.  In the tree view in Event Viewer, navigate to **Event Viewer**, **Applications and Services Logs**, **Microsoft**, **Windows**, and then **Application Server-Applications**. Right-click **Application Server-Applications**, select **View**, and then **Show Analytic and Debug Logs**.\n\n     Ensure that the **Show Analytic and Debug Logs** option is checked.\n\n9. Enable the **Analytic** log.\n\n     In the tree view in Event Viewer, navigate to **Event Viewer**, **Applications and Services Logs**, **Microsoft**, **Windows**, and then **Application Server-Applications**. Right-click **Analytic** and select **Enable Log**.\n\n#### To test the service\n\n1.  Switch back to WCF test client and double-click `Divide` and keep the default values, which specify a denominator of 0.\n\n     If the denominator is 0, then the service throws a fault.\n\n2.  Observe the events emitted from the service.\n\n     Switch back to Event Viewer and navigate to **Event Viewer**, **Applications and Services Logs**, **Microsoft**, **Windows**, and then **Application Server-Applications**. Right-click **Analytic** and select **Refresh**.\n\n     The WCF analytic trace events are displayed in the event viewer. Notice that because a fault was thrown by the service an error trace event is displayed in the event viewer.\n\n3.  Repeat steps 1 and 2, but with valid inputs. The value of the `N2` parameter can be any number other than 0.\n\n     Refresh the analytic channel to view the WCF events do not include any error events.\n\n The sample demonstrates the analytic trace events emitted from a WCF service.\n\n#### To cleanup (Optional)\n\n1.  Open Event Viewer.\n\n2.  Navigate to **Event Viewer**, **Applications and Services Logs**, **Microsoft**, **Windows**, and then **Application-Server-Applications**. Right-click **Analytic** and select **Disable Log**.\n\n3.  Navigate to **Event Viewer**, **Applications and Services Logs**, **Microsoft**, **Windows**, and then **Application-Server-Applications**. Right-click **Analytic** and select **Clear Log**.\n\n4.  Choose the **Clear** option to clear the events.\n\n> [!IMPORTANT]\n>  The samples may already be installed on your computer. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Management\\ETWTracing`  \n  \n## See also\n\n- [AppFabric Monitoring Samples](https://go.microsoft.com/fwlink/?LinkId=193959)\n","nodes":[{"pos":[4,126],"embed":true,"restype":"x-metadata","content":"title: \"WCF Services and Event Tracing for Windows\"\nms.date: \"03/30/2017\"\nms.assetid: eda4355d-0bd0-4dc9-80a2-d2c832152272","nodes":[{"content":"WCF Services and Event Tracing for Windows","nodes":[{"pos":[0,42],"content":"WCF Services and Event Tracing for Windows","nodes":[{"content":"WCF Services and Event Tracing for Windows","pos":[0,42]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[133,175],"content":"WCF Services and Event Tracing for Windows","linkify":"WCF Services and Event Tracing for Windows","nodes":[{"content":"WCF Services and Event Tracing for Windows","pos":[0,42]}]},{"content":"This sample demonstrates how to use the analytic tracing in Windows Communication Foundation (WCF) to emit events in Event Tracing for Windows (ETW).","pos":[176,325]},{"content":"The analytic traces are events emitted at key points in the WCF stack that allow troubleshooting of WCF services in production environment.","pos":[326,465]},{"content":"Analytic trace in WCF services is tracing that can be turned on in a production environment with minimal impact on performance.","pos":[468,595]},{"content":"These traces are emitted as events to an ETW session.","pos":[596,649]},{"content":"This sample includes a basic WCF service in which events are emitted from the service to the event log, which can be viewed using Event Viewer.","pos":[652,795]},{"content":"It is also possible to start a dedicated ETW session that listens for events from the WCF service.","pos":[796,894]},{"content":"The sample includes a script to create a dedicated ETW session that stores events in a binary file that can be read using Event Viewer.","pos":[895,1030]},{"pos":[1037,1055],"content":"To use this sample","linkify":"To use this sample","nodes":[{"content":"To use this sample","pos":[0,18]}]},{"content":"Using Visual Studio 2012, open the EtwAnalyticTraceSample.sln solution file.","pos":[1061,1137]},{"content":"To build the solution, press CTRL+SHIFT+B.","pos":[1143,1185]},{"content":"To run the solution, press CTRL+F5.","pos":[1191,1226]},{"content":"In the Web browser, click <bpt id=\"p1\">**</bpt>Calculator.svc<ept id=\"p1\">**</ept>.","pos":[1233,1278],"source":"In the Web browser, click **Calculator.svc**."},{"content":"The URI of the WSDL document for the service should appear in the browser.","pos":[1279,1353]},{"content":"Copy that URI.","pos":[1354,1368]},{"pos":[1375,1481],"content":"By default, the service starts listening for requests on port 1378 <ph id=\"ph1\">`http://localhost:1378/Calculator.svc`</ph>.","source":"By default, the service starts listening for requests on port 1378 `http://localhost:1378/Calculator.svc`."},{"content":"Run the WCF test client (WcfTestClient.exe).","pos":[1487,1531]},{"content":"The WCF test client (WcfTestClient.exe) is located at <ph id=\"ph1\">`\\&lt;Visual Studio 2012 Install Dir&gt;\\Common7\\IDE\\WcfTestClient.exe`</ph>.","pos":[1538,1658],"source":"The WCF test client (WcfTestClient.exe) is located at `\\<Visual Studio 2012 Install Dir>\\Common7\\IDE\\WcfTestClient.exe`."},{"content":"The default Visual Studio 2012 install dir is <ph id=\"ph1\">`C:\\Program Files\\Microsoft Visual Studio 10.0`</ph>.","pos":[1660,1754],"source":"  The default Visual Studio 2012 install dir is `C:\\Program Files\\Microsoft Visual Studio 10.0`."},{"pos":[1760,1852],"content":"Within the WCF test client, add the service by selecting <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept>, and then <bpt id=\"p2\">**</bpt>Add Service<ept id=\"p2\">**</ept>.","source":"Within the WCF test client, add the service by selecting **File**, and then **Add Service**."},{"content":"Add the endpoint address in the input box.","pos":[1859,1901]},{"content":"The default is <ph id=\"ph1\">`http://localhost:1378/Calculator.svc`</ph>.","pos":[1902,1956],"source":" The default is `http://localhost:1378/Calculator.svc`."},{"content":"Open the Event Viewer application.","pos":[1962,1996]},{"content":"Before invoking the service, start Event Viewer and ensure that the event log is listening for tracking events emitted from the WCF service.","pos":[2003,2143]},{"content":"From the <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept> menu, select <bpt id=\"p2\">**</bpt>Administrative Tools<ept id=\"p2\">**</ept>, and then <bpt id=\"p3\">**</bpt>Event Viewer<ept id=\"p3\">**</ept>.","pos":[2149,2233],"source":"From the **Start** menu, select **Administrative Tools**, and then **Event Viewer**."},{"content":"Enable the <bpt id=\"p1\">**</bpt>Analytic<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Debug<ept id=\"p2\">**</ept> logs.","pos":[2235,2278],"source":"  Enable the **Analytic** and **Debug** logs."},{"content":"In the tree view in Event Viewer, navigate to <bpt id=\"p1\">**</bpt>Event Viewer<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Applications and Services Logs<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Microsoft<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>Windows<ept id=\"p4\">**</ept>, and then <bpt id=\"p5\">**</bpt>Application Server-Applications<ept id=\"p5\">**</ept>.","pos":[2284,2457],"source":"In the tree view in Event Viewer, navigate to **Event Viewer**, **Applications and Services Logs**, **Microsoft**, **Windows**, and then **Application Server-Applications**."},{"content":"Right-click <bpt id=\"p1\">**</bpt>Application Server-Applications<ept id=\"p1\">**</ept>, select <bpt id=\"p2\">**</bpt>View<ept id=\"p2\">**</ept>, and then <bpt id=\"p3\">**</bpt>Show Analytic and Debug Logs<ept id=\"p3\">**</ept>.","pos":[2458,2566],"source":" Right-click **Application Server-Applications**, select **View**, and then **Show Analytic and Debug Logs**."},{"pos":[2573,2640],"content":"Ensure that the <bpt id=\"p1\">**</bpt>Show Analytic and Debug Logs<ept id=\"p1\">**</ept> option is checked.","source":"Ensure that the **Show Analytic and Debug Logs** option is checked."},{"pos":[2645,2673],"content":"Enable the <bpt id=\"p1\">**</bpt>Analytic<ept id=\"p1\">**</ept> log.","source":"Enable the **Analytic** log."},{"content":"In the tree view in Event Viewer, navigate to <bpt id=\"p1\">**</bpt>Event Viewer<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Applications and Services Logs<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Microsoft<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>Windows<ept id=\"p4\">**</ept>, and then <bpt id=\"p5\">**</bpt>Application Server-Applications<ept id=\"p5\">**</ept>.","pos":[2680,2853],"source":"In the tree view in Event Viewer, navigate to **Event Viewer**, **Applications and Services Logs**, **Microsoft**, **Windows**, and then **Application Server-Applications**."},{"content":"Right-click <bpt id=\"p1\">**</bpt>Analytic<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Enable Log<ept id=\"p2\">**</ept>.","pos":[2854,2905],"source":" Right-click **Analytic** and select **Enable Log**."},{"pos":[2912,2931],"content":"To test the service","linkify":"To test the service","nodes":[{"content":"To test the service","pos":[0,19]}]},{"pos":[2937,3056],"content":"Switch back to WCF test client and double-click <ph id=\"ph1\">`Divide`</ph> and keep the default values, which specify a denominator of 0.","source":"Switch back to WCF test client and double-click `Divide` and keep the default values, which specify a denominator of 0."},{"content":"If the denominator is 0, then the service throws a fault.","pos":[3063,3120]},{"content":"Observe the events emitted from the service.","pos":[3126,3170]},{"content":"Switch back to Event Viewer and navigate to <bpt id=\"p1\">**</bpt>Event Viewer<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Applications and Services Logs<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Microsoft<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>Windows<ept id=\"p4\">**</ept>, and then <bpt id=\"p5\">**</bpt>Application Server-Applications<ept id=\"p5\">**</ept>.","pos":[3177,3348],"source":"Switch back to Event Viewer and navigate to **Event Viewer**, **Applications and Services Logs**, **Microsoft**, **Windows**, and then **Application Server-Applications**."},{"content":"Right-click <bpt id=\"p1\">**</bpt>Analytic<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Refresh<ept id=\"p2\">**</ept>.","pos":[3349,3397],"source":" Right-click **Analytic** and select **Refresh**."},{"content":"The WCF analytic trace events are displayed in the event viewer.","pos":[3404,3468]},{"content":"Notice that because a fault was thrown by the service an error trace event is displayed in the event viewer.","pos":[3469,3577]},{"content":"Repeat steps 1 and 2, but with valid inputs.","pos":[3583,3627]},{"content":"The value of the <ph id=\"ph1\">`N2`</ph> parameter can be any number other than 0.","pos":[3628,3691],"source":" The value of the `N2` parameter can be any number other than 0."},{"content":"Refresh the analytic channel to view the WCF events do not include any error events.","pos":[3698,3782]},{"content":"The sample demonstrates the analytic trace events emitted from a WCF service.","pos":[3785,3862]},{"pos":[3869,3890],"content":"To cleanup (Optional)","linkify":"To cleanup (Optional)","nodes":[{"content":"To cleanup (Optional)","pos":[0,21]}]},{"content":"Open Event Viewer.","pos":[3896,3914]},{"content":"Navigate to <bpt id=\"p1\">**</bpt>Event Viewer<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Applications and Services Logs<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Microsoft<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>Windows<ept id=\"p4\">**</ept>, and then <bpt id=\"p5\">**</bpt>Application-Server-Applications<ept id=\"p5\">**</ept>.","pos":[3920,4059],"source":"Navigate to **Event Viewer**, **Applications and Services Logs**, **Microsoft**, **Windows**, and then **Application-Server-Applications**."},{"content":"Right-click <bpt id=\"p1\">**</bpt>Analytic<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Disable Log<ept id=\"p2\">**</ept>.","pos":[4060,4112],"source":" Right-click **Analytic** and select **Disable Log**."},{"content":"Navigate to <bpt id=\"p1\">**</bpt>Event Viewer<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Applications and Services Logs<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Microsoft<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>Windows<ept id=\"p4\">**</ept>, and then <bpt id=\"p5\">**</bpt>Application-Server-Applications<ept id=\"p5\">**</ept>.","pos":[4118,4257],"source":"Navigate to **Event Viewer**, **Applications and Services Logs**, **Microsoft**, **Windows**, and then **Application-Server-Applications**."},{"content":"Right-click <bpt id=\"p1\">**</bpt>Analytic<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Clear Log<ept id=\"p2\">**</ept>.","pos":[4258,4308],"source":" Right-click **Analytic** and select **Clear Log**."},{"pos":[4314,4362],"content":"Choose the <bpt id=\"p1\">**</bpt>Clear<ept id=\"p1\">**</ept> option to clear the events.","source":"Choose the **Clear** option to clear the events."},{"pos":[4366,4499],"content":"[!IMPORTANT]\n The samples may already be installed on your computer. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your computer. Check for the following (default) directory before continuing.","pos":[14,131],"nodes":[{"content":"The samples may already be installed on your computer.","pos":[0,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[4553,4863],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[4864,4914]},{"pos":[4998,5006],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[5010,5088],"content":"<bpt id=\"p1\">[</bpt>AppFabric Monitoring Samples<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=193959)</ept>","source":"[AppFabric Monitoring Samples](https://go.microsoft.com/fwlink/?LinkId=193959)"}]}