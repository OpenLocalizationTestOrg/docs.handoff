<?xml version="1.0"?>
<xliff version="1.2" xmlns="urn:oasis:names:tc:xliff:document:1.2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:oasis:names:tc:xliff:document:1.2 xliff-core-1.2-transitional.xsd">
  <file datatype="xml" original="index.md" source-language="en-US" target-language="zh-tw">
    <header>
      <tool tool-id="mdxliff" tool-name="mdxliff" tool-version="1.0-0a91294" tool-company="Microsoft" />
      <xliffext:olfilehash xmlns:xliffext="urn:microsoft:content:schema:xliffextensions">31c5b386d707aa49cd36d536f1c8b419eb74a658</xliffext:olfilehash>
      <xliffext:olfilepath xmlns:xliffext="urn:microsoft:content:schema:xliffextensions">docs\framework\wcf\diagnostics\performance-counters\index.md</xliffext:olfilepath>
      <xliffext:oltranslationpriority xmlns:xliffext="urn:microsoft:content:schema:xliffextensions">net-med-mt</xliffext:oltranslationpriority>
      <xliffext:oltranslationtype xmlns:xliffext="urn:microsoft:content:schema:xliffextensions">MT</xliffext:oltranslationtype>
      <xliffext:olskeletonhash xmlns:xliffext="urn:microsoft:content:schema:xliffextensions">5eb71811885fbbb1011d4f5f8b538d92aa7601b1</xliffext:olskeletonhash>
      <xliffext:olxliffhash xmlns:xliffext="urn:microsoft:content:schema:xliffextensions">16cea07219203cca1376be3af41a3820d128f2ed</xliffext:olxliffhash>
    </header>
    <body>
      <group id="content" extype="content">
        <trans-unit id="101" translate="yes" xml:space="preserve" restype="x-metadata">
          <source>WCF Performance Counters</source>
        </trans-unit>
        <trans-unit id="102" translate="yes" xml:space="preserve">
          <source>WCF Performance Counters</source>
        </trans-unit>
        <trans-unit id="103" translate="yes" xml:space="preserve">
          <source>Windows Communication Foundation (WCF) includes a large set of performance counters to help you gauge your application's performance.</source>
        </trans-unit>
        <trans-unit id="104" translate="yes" xml:space="preserve">
          <source>Enabling Performance Counters</source>
        </trans-unit>
        <trans-unit id="105" translate="yes" xml:space="preserve">
          <source>You can enable performance counters for a WCF service through the app.config configuration file of the WCF service as follows:</source>
        </trans-unit>
        <trans-unit id="106" translate="yes" xml:space="preserve">
          <source>The <ph id="ph1">`performanceCounters`</ph> attribute can be set to enable a specific type of performance counters.</source>
        </trans-unit>
        <trans-unit id="107" translate="yes" xml:space="preserve">
          <source>Valid values are</source>
        </trans-unit>
        <trans-unit id="108" translate="yes" xml:space="preserve">
          <source>All: All category counters (ServiceModelService, ServiceModelEndpoint and ServiceModelOperation) are enabled.</source>
        </trans-unit>
        <trans-unit id="109" translate="yes" xml:space="preserve">
          <source>ServiceOnly: Only ServiceModelService category counters are enabled.</source>
        </trans-unit>
        <trans-unit id="110" translate="yes" xml:space="preserve">
          <source>This is the default value.</source>
        </trans-unit>
        <trans-unit id="111" translate="yes" xml:space="preserve">
          <source>Off: ServiceModel* performance counters are disabled.</source>
        </trans-unit>
        <trans-unit id="112" translate="yes" xml:space="preserve">
          <source>If you want to enable performance counters for all WCF applications, you can place the configuration settings in the Machine.config file.</source>
        </trans-unit>
        <trans-unit id="113" translate="yes" xml:space="preserve">
          <source>Please see the <bpt id="p1">**</bpt>Increasing Memory Size for Performance Counters<ept id="p1">**</ept> section below for more information on configuring sufficient memory for performance counters on your machine.</source>
        </trans-unit>
        <trans-unit id="114" translate="yes" xml:space="preserve">
          <source>If you use WCF extensibility points such as custom operation invokers, you should also emit your own performance counters.</source>
        </trans-unit>
        <trans-unit id="115" translate="yes" xml:space="preserve">
          <source>This is because if you implement an extensibility point, WCF may no longer emit the standard performance counter data in the default path.</source>
        </trans-unit>
        <trans-unit id="116" translate="yes" xml:space="preserve">
          <source>If you do not implement manual performance counter support, you may not see the performance counter data you expect.</source>
        </trans-unit>
        <trans-unit id="117" translate="yes" xml:space="preserve">
          <source>You can also enable performance counters in your code as follows,</source>
        </trans-unit>
        <trans-unit id="118" translate="yes" xml:space="preserve">
          <source>Viewing Performance Data</source>
        </trans-unit>
        <trans-unit id="119" translate="yes" xml:space="preserve">
          <source>To view data captured by the performance counters, you can use the Performance Monitor (Perfmon.exe) that comes with Windows.</source>
        </trans-unit>
        <trans-unit id="120" translate="yes" xml:space="preserve">
          <source>You can launch this tool by going to <bpt id="p1">**</bpt>Start<ept id="p1">**</ept>, and click <bpt id="p2">**</bpt>Run<ept id="p2">**</ept> and type <ph id="ph1">`perfmon.exe`</ph> in the dialog box.</source>
        </trans-unit>
        <trans-unit id="121" translate="yes" xml:space="preserve">
          <source>Performance counter instances may be released before the last messages have been processed by the endpoint dispatcher.</source>
        </trans-unit>
        <trans-unit id="122" translate="yes" xml:space="preserve">
          <source>This can result in performance data not being captured for a few messages.</source>
        </trans-unit>
        <trans-unit id="123" translate="yes" xml:space="preserve">
          <source>Increasing Memory Size for Performance Counters</source>
        </trans-unit>
        <trans-unit id="124" translate="yes" xml:space="preserve">
          <source>WCF uses separate shared memory for its performance counter categories.</source>
        </trans-unit>
        <trans-unit id="125" translate="yes" xml:space="preserve">
          <source>By default, separate shared memory is set to a quarter the size of global performance counter memory.</source>
        </trans-unit>
        <trans-unit id="126" translate="yes" xml:space="preserve">
          <source>The default global performance counter memory is 524,288 bytes.</source>
        </trans-unit>
        <trans-unit id="127" translate="yes" xml:space="preserve">
          <source>Therefore, the three WCF performance counter categories have a default size of approximately 128KB each.</source>
        </trans-unit>
        <trans-unit id="128" translate="yes" xml:space="preserve">
          <source>Depending upon the runtime characteristics of the WCF applications on a machine, performance counter memory may be exhausted.</source>
        </trans-unit>
        <trans-unit id="129" translate="yes" xml:space="preserve">
          <source>When this happens, WCF writes an error to the application event log.</source>
        </trans-unit>
        <trans-unit id="130" translate="yes" xml:space="preserve">
          <source>The content of the error states that a performance counter was not loaded, and the entry contains the exception "System.InvalidOperationException: Custom counters file view is out of memory."</source>
        </trans-unit>
        <trans-unit id="131" translate="yes" xml:space="preserve">
          <source>If tracing is enabled at the error level, this failure is also traced.</source>
        </trans-unit>
        <trans-unit id="132" translate="yes" xml:space="preserve">
          <source>If performance counter memory is exhausted, continuing to run your WCF applications with performance counters enabled could result in performance degradation.</source>
        </trans-unit>
        <trans-unit id="133" translate="yes" xml:space="preserve">
          <source>If you are an administrator of the machine, you should configure it to allocate enough memory to support the maximum number of performance counters that can exist at any time.</source>
        </trans-unit>
        <trans-unit id="134" translate="yes" xml:space="preserve">
          <source>You can change the amount of performance counter memory for WCF categories in the registry.</source>
        </trans-unit>
        <trans-unit id="135" translate="yes" xml:space="preserve">
          <source>To do so, you need to add a new DWORD value named <ph id="ph1">`FileMappingSize`</ph> to the three following locations, and set it to the desired value in bytes.</source>
        </trans-unit>
        <trans-unit id="136" translate="yes" xml:space="preserve">
          <source>Reboot your machine so that these changes are taken into effect.</source>
        </trans-unit>
        <trans-unit id="137" translate="yes" xml:space="preserve">
          <source>HKLM\System\CurrentControlSet\Services\ServiceModelEndpoint 4.0.0.0\Performance</source>
        </trans-unit>
        <trans-unit id="138" translate="yes" xml:space="preserve">
          <source>HKLM\System\CurrentControlSet\Services\ServiceModelOperation 4.0.0.0\Performance</source>
        </trans-unit>
        <trans-unit id="139" translate="yes" xml:space="preserve">
          <source>HKLM\System\CurrentControlSet\Services\ServiceModelService 4.0.0.0\Performance</source>
        </trans-unit>
        <trans-unit id="140" translate="yes" xml:space="preserve">
          <source>When a large number of objects (for example, ServiceHost) are disposed of but waiting to be garbage-collected, the <ph id="ph1">`PrivateBytes`</ph> performance counter will register an unusually high number.</source>
        </trans-unit>
        <trans-unit id="141" translate="yes" xml:space="preserve">
          <source>To resolve this problem, you can either add your own application-specific counters, or use the <ph id="ph1">`performanceCounters`</ph> attribute to enable only service-level counters.</source>
        </trans-unit>
        <trans-unit id="142" translate="yes" xml:space="preserve">
          <source>Types of Performance Counters</source>
        </trans-unit>
        <trans-unit id="143" translate="yes" xml:space="preserve">
          <source>Performance counters are scoped to three different levels: Service, Endpoint and Operation.</source>
        </trans-unit>
        <trans-unit id="144" translate="yes" xml:space="preserve">
          <source>You can use WMI to retrieve the name of a performance counter instance.</source>
        </trans-unit>
        <trans-unit id="145" translate="yes" xml:space="preserve">
          <source>For example,</source>
        </trans-unit>
        <trans-unit id="146" translate="yes" xml:space="preserve">
          <source>Service counter instance name can be obtained through WMI <bpt id="p1">[</bpt>Service<ept id="p1">](../../../../../docs/framework/wcf/diagnostics/wmi/service.md)</ept> instance's "CounterInstanceName" property.</source>
        </trans-unit>
        <trans-unit id="147" translate="yes" xml:space="preserve">
          <source>Endpoint counter instance name can be obtained through WMI <bpt id="p1">[</bpt>Endpoint<ept id="p1">](../../../../../docs/framework/wcf/diagnostics/wmi/endpoint.md)</ept> instance's "CounterInstanceName" property.</source>
        </trans-unit>
        <trans-unit id="148" translate="yes" xml:space="preserve">
          <source>Operation counter instance name can be obtained through WMI <bpt id="p1">[</bpt>Endpoint<ept id="p1">](../../../../../docs/framework/wcf/diagnostics/wmi/endpoint.md)</ept> instance's "GetOperationCounterInstanceName" method.</source>
        </trans-unit>
        <trans-unit id="149" translate="yes" xml:space="preserve">
          <source>For more information on WMI, see <bpt id="p1">[</bpt>Using Windows Management Instrumentation for Diagnostics<ept id="p1">](../../../../../docs/framework/wcf/diagnostics/wmi/index.md)</ept>.</source>
        </trans-unit>
        <trans-unit id="150" translate="yes" xml:space="preserve">
          <source>Service performance counters</source>
        </trans-unit>
        <trans-unit id="151" translate="yes" xml:space="preserve">
          <source>Service performance counters measure the service behavior as a whole and can be used to diagnose the performance of the whole service.</source>
        </trans-unit>
        <trans-unit id="152" translate="yes" xml:space="preserve">
          <source>They can be found under the <ph id="ph1">`ServiceModelService 4.0.0.0`</ph> performance object when viewing with Performance Monitor.</source>
        </trans-unit>
        <trans-unit id="153" translate="yes" xml:space="preserve">
          <source>The instances are named using the following pattern:</source>
        </trans-unit>
        <trans-unit id="154" translate="yes" xml:space="preserve">
          <source>A counter in a service scope is aggregated from counter in a collection of endpoints.</source>
        </trans-unit>
        <trans-unit id="155" translate="yes" xml:space="preserve">
          <source>Performance counters for service instance creation are incremented when a new InstanceContext is created.</source>
        </trans-unit>
        <trans-unit id="156" translate="yes" xml:space="preserve">
          <source>Note that a new InstanceContext is created even when you receive a non-activating message (with an existing service), or when you connect to an instance from one session, end the session, and then reconnect from another session.</source>
        </trans-unit>
        <trans-unit id="157" translate="yes" xml:space="preserve">
          <source>Endpoint performance counters</source>
        </trans-unit>
        <trans-unit id="158" translate="yes" xml:space="preserve">
          <source>Endpoint performance counters enable you to look at data reflecting how an endpoint is accepting messages.</source>
        </trans-unit>
        <trans-unit id="159" translate="yes" xml:space="preserve">
          <source>They can be found under the <ph id="ph1">`ServiceModelEndpoint 4.0.0.0`</ph> performance object when viewing using the Performance Monitor.</source>
        </trans-unit>
        <trans-unit id="160" translate="yes" xml:space="preserve">
          <source>The instances are named using the following pattern:</source>
        </trans-unit>
        <trans-unit id="161" translate="yes" xml:space="preserve">
          <source>The data is similar to what is collected for individual operations, but is only aggregated across the endpoint.</source>
        </trans-unit>
        <trans-unit id="162" translate="yes" xml:space="preserve">
          <source>A counter in an endpoint scope is aggregated from counters in a collection of operations.</source>
        </trans-unit>
        <trans-unit id="163" translate="yes" xml:space="preserve">
          <source>If two endpoints have identical contract names and addresses, they are mapped to the same counter instance.</source>
        </trans-unit>
        <trans-unit id="164" translate="yes" xml:space="preserve">
          <source>Operation performance counters</source>
        </trans-unit>
        <trans-unit id="165" translate="yes" xml:space="preserve">
          <source>Operation performance counters are found under the <ph id="ph1">`ServiceModelOperation 4.0.0.0`</ph> performance object when viewing with the Performance Monitor.</source>
        </trans-unit>
        <trans-unit id="166" translate="yes" xml:space="preserve">
          <source>Each operation has an individual instance.</source>
        </trans-unit>
        <trans-unit id="167" translate="yes" xml:space="preserve">
          <source>That is, if a given contract has 10 operations, 10 operation counter instances are associated with that contract.</source>
        </trans-unit>
        <trans-unit id="168" translate="yes" xml:space="preserve">
          <source>The object instances are named using the following pattern:</source>
        </trans-unit>
        <trans-unit id="169" translate="yes" xml:space="preserve">
          <source>This counter enables you to measure how the call is being used and how well the operation is performing.</source>
        </trans-unit>
        <trans-unit id="170" translate="yes" xml:space="preserve">
          <source>When counters are visible at multiple scopes, data gathered from a higher scope are aggregated with data from lower scopes.</source>
        </trans-unit>
        <trans-unit id="171" translate="yes" xml:space="preserve">
          <source>For example, <ph id="ph1">`Calls`</ph> at an endpoint represents the sum of all operation calls within the endpoint; <ph id="ph2">`Calls`</ph> at a service represents the sum of all calls to all endpoints within the service.</source>
        </trans-unit>
        <trans-unit id="172" translate="yes" xml:space="preserve">
          <source>If you have duplicate operation names on a contract, you only get one counter instances for both operations.</source>
        </trans-unit>
        <trans-unit id="173" translate="yes" xml:space="preserve">
          <source>Programming the WCF Performance Counters</source>
        </trans-unit>
        <trans-unit id="174" translate="yes" xml:space="preserve">
          <source>Several files are installed in the SDK install folder so that you can access the WCF performance counters programmatically.</source>
        </trans-unit>
        <trans-unit id="175" translate="yes" xml:space="preserve">
          <source>These files are listed as follows.</source>
        </trans-unit>
        <trans-unit id="176" translate="yes" xml:space="preserve">
          <source>_ServiceModelEndpointPerfCounters.vrg</source>
        </trans-unit>
        <trans-unit id="177" translate="yes" xml:space="preserve">
          <source>_ServiceModelOperationPerfCounters.vrg</source>
        </trans-unit>
        <trans-unit id="178" translate="yes" xml:space="preserve">
          <source>_ServiceModelServicePerfCounters.vrg</source>
        </trans-unit>
        <trans-unit id="179" translate="yes" xml:space="preserve">
          <source>_SMSvcHostPerfCounters.vrg</source>
        </trans-unit>
        <trans-unit id="180" translate="yes" xml:space="preserve">
          <source>_TransactionBridgePerfCounters.vrg</source>
        </trans-unit>
        <trans-unit id="181" translate="yes" xml:space="preserve">
          <source>For more information on how to access the counters programmatically, see <bpt id="p1">[</bpt>Performance Counter Programming Architecture<ept id="p1">](https://go.microsoft.com/fwlink/?LinkId=95179)</ept>.</source>
        </trans-unit>
        <trans-unit id="182" translate="yes" xml:space="preserve">
          <source>See also</source>
        </trans-unit>
        <trans-unit id="183" translate="yes" xml:space="preserve">
          <source><bpt id="p1">[</bpt>Administration and Diagnostics<ept id="p1">](../../../../../docs/framework/wcf/diagnostics/index.md)</ept></source>
        </trans-unit>
      </group>
    </body>
  </file>
</xliff>