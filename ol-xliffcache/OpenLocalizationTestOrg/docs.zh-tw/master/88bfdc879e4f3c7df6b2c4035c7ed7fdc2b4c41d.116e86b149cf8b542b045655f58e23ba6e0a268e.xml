{"content":"---\ntitle: \"Service: Channel listeners and channels\"\nms.date: \"03/30/2017\"\nms.assetid: 8ccbe0e8-7e55-441d-80de-5765f67542fa\n---\n# Service: Channel listeners and channels\n\nThere are three categories of channel objects: channels, channel listeners, and channel factories. Channels are the interface between the application and the channel stack. Channel listeners are responsible for creating channels on the receive (or listen) side, typically in response to a new incoming message or connection. Channel factories are responsible for creating channels on the send side to initiate communication with an endpoint.\n\n## Channel listeners and channels\n\nChannel listeners are responsible for creating channels and receiving messages from the layer below or from the network. Received messages are delivered to the layer above using a channel that is created by the channel listener.\n\nThe following diagram illustrates the process of receiving messages and delivering them to the layer above.\n\n![Channel listeners and channels](./media/wcfc-wcfchannelsigure1highlevelc.gif \"wcfc_WCFChannelsigure1HighLevelc\")\n\nA channel listener receiving messages and delivering to the layer above through channels.\n\nThe process can be conceptually modeled as a queue inside each channel although the implementation may not actually use a queue. The channel listener is responsible for receiving messages from the layer below or the network and putting them in the queue. The channel is responsible for getting messages from the queue and handing them to the layer above when that layer asks for a message, for example by calling `Receive` on the channel.\n\nWCF provides base class helpers for this process. (For a diagram of the channel helper classes discussed in this article, see [Channel Model Overview](channel-model-overview.md).)\n\n- The <xref:System.ServiceModel.Channels.CommunicationObject> class implements <xref:System.ServiceModel.ICommunicationObject> and enforces the state machine described in step 2 of [Developing Channels](developing-channels.md).\n\n- The <xref:System.ServiceModel.Channels.ChannelManagerBase> class implements <xref:System.ServiceModel.Channels.CommunicationObject> and provides a unified base class for <xref:System.ServiceModel.Channels.ChannelFactoryBase> and <xref:System.ServiceModel.Channels.ChannelListenerBase>. The <xref:System.ServiceModel.Channels.ChannelManagerBase> class works in conjunction with <xref:System.ServiceModel.Channels.ChannelBase>, which is a base class that implements <xref:System.ServiceModel.Channels.IChannel>.\n\n- The <xref:System.ServiceModel.Channels.ChannelFactoryBase> class implements <xref:System.ServiceModel.Channels.ChannelManagerBase> and <xref:System.ServiceModel.Channels.IChannelFactory> and consolidates the `CreateChannel` overloads into one `OnCreateChannel` abstract method.\n\n- The <xref:System.ServiceModel.Channels.ChannelListenerBase> class implements <xref:System.ServiceModel.Channels.IChannelListener>. It takes care of basic state management.\n\nThe following discussion is based upon the [Transport: UDP](../../../../docs/framework/wcf/samples/transport-udp.md) sample.\n\n## Creating a channel listener\n\nThe `UdpChannelListener` that the sample implements derives from the <xref:System.ServiceModel.Channels.ChannelListenerBase> class. It uses a single UDP socket to receive datagrams. The `OnOpen` method receives data using the UDP socket in an asynchronous loop. The data are then converted into messages using the message encoding system:\n\n```csharp\nmessage = UdpConstants.MessageEncoder.ReadMessage(\n  new ArraySegment<byte>(buffer, 0, count),\n  bufferManager\n);\n```\n\nBecause the same datagram channel represents messages that arrive from a number of sources, the `UdpChannelListener` is a singleton listener. There is at most one active <xref:System.ServiceModel.Channels.IChannel> associated with this listener at a time. The sample generates another one only if a channel that is returned by the <xref:System.ServiceModel.Channels.ChannelListenerBase%601.AcceptChannel%2A> method is subsequently disposed. When a message is received, it's enqueued into this singleton channel.\n\n### UdpInputChannel\n\nThe `UdpInputChannel` class implements <xref:System.ServiceModel.Channels.IInputChannel>. It consists of a queue of incoming messages that is populated by the `UdpChannelListener`'s socket. These messages are dequeued by the <xref:System.ServiceModel.Channels.IInputChannel.Receive%2A> method.\n","nodes":[{"pos":[4,123],"embed":true,"restype":"x-metadata","content":"title: \"Service: Channel listeners and channels\"\nms.date: \"03/30/2017\"\nms.assetid: 8ccbe0e8-7e55-441d-80de-5765f67542fa","nodes":[{"content":"Service: Channel listeners and channels","nodes":[{"pos":[0,39],"content":"Service: Channel listeners and channels","nodes":[{"content":"Service: Channel listeners and channels","pos":[0,39]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[130,169],"content":"Service: Channel listeners and channels","linkify":"Service: Channel listeners and channels","nodes":[{"content":"Service: Channel listeners and channels","pos":[0,39]}]},{"content":"There are three categories of channel objects: channels, channel listeners, and channel factories.","pos":[171,269]},{"content":"Channels are the interface between the application and the channel stack.","pos":[270,343]},{"content":"Channel listeners are responsible for creating channels on the receive (or listen) side, typically in response to a new incoming message or connection.","pos":[344,495]},{"content":"Channel factories are responsible for creating channels on the send side to initiate communication with an endpoint.","pos":[496,612]},{"pos":[617,647],"content":"Channel listeners and channels","linkify":"Channel listeners and channels","nodes":[{"content":"Channel listeners and channels","pos":[0,30]}]},{"content":"Channel listeners are responsible for creating channels and receiving messages from the layer below or from the network.","pos":[649,769]},{"content":"Received messages are delivered to the layer above using a channel that is created by the channel listener.","pos":[770,877]},{"content":"The following diagram illustrates the process of receiving messages and delivering them to the layer above.","pos":[879,986]},{"pos":[988,1102],"content":"<bpt id=\"p1\">![</bpt>Channel listeners and channels<ept id=\"p1\">]</ept><bpt id=\"p2\">(./media/wcfc-wcfchannelsigure1highlevelc.gif \"</bpt>wcfc_WCFChannelsigure1HighLevelc<ept id=\"p2\">\")</ept>","source":"![Channel listeners and channels](./media/wcfc-wcfchannelsigure1highlevelc.gif \"wcfc_WCFChannelsigure1HighLevelc\")"},{"content":"A channel listener receiving messages and delivering to the layer above through channels.","pos":[1104,1193]},{"content":"The process can be conceptually modeled as a queue inside each channel although the implementation may not actually use a queue.","pos":[1195,1323]},{"content":"The channel listener is responsible for receiving messages from the layer below or the network and putting them in the queue.","pos":[1324,1449]},{"content":"The channel is responsible for getting messages from the queue and handing them to the layer above when that layer asks for a message, for example by calling <ph id=\"ph1\">`Receive`</ph> on the channel.","pos":[1450,1633],"source":" The channel is responsible for getting messages from the queue and handing them to the layer above when that layer asks for a message, for example by calling `Receive` on the channel."},{"content":"WCF provides base class helpers for this process.","pos":[1635,1684]},{"content":"(For a diagram of the channel helper classes discussed in this article, see <bpt id=\"p1\">[</bpt>Channel Model Overview<ept id=\"p1\">](channel-model-overview.md)</ept>.)","pos":[1685,1814],"source":" (For a diagram of the channel helper classes discussed in this article, see [Channel Model Overview](channel-model-overview.md).)"},{"pos":[1818,2043],"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.CommunicationObject&gt;</ph> class implements <ph id=\"ph2\">&lt;xref:System.ServiceModel.ICommunicationObject&gt;</ph> and enforces the state machine described in step 2 of <bpt id=\"p1\">[</bpt>Developing Channels<ept id=\"p1\">](developing-channels.md)</ept>.","source":"The <xref:System.ServiceModel.Channels.CommunicationObject> class implements <xref:System.ServiceModel.ICommunicationObject> and enforces the state machine described in step 2 of [Developing Channels](developing-channels.md)."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.ChannelManagerBase&gt;</ph> class implements <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.CommunicationObject&gt;</ph> and provides a unified base class for <ph id=\"ph3\">&lt;xref:System.ServiceModel.Channels.ChannelFactoryBase&gt;</ph> and <ph id=\"ph4\">&lt;xref:System.ServiceModel.Channels.ChannelListenerBase&gt;</ph>.","pos":[2047,2332],"source":"The <xref:System.ServiceModel.Channels.ChannelManagerBase> class implements <xref:System.ServiceModel.Channels.CommunicationObject> and provides a unified base class for <xref:System.ServiceModel.Channels.ChannelFactoryBase> and <xref:System.ServiceModel.Channels.ChannelListenerBase>."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.ChannelManagerBase&gt;</ph> class works in conjunction with <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.ChannelBase&gt;</ph>, which is a base class that implements <ph id=\"ph3\">&lt;xref:System.ServiceModel.Channels.IChannel&gt;</ph>.","pos":[2333,2556],"source":" The <xref:System.ServiceModel.Channels.ChannelManagerBase> class works in conjunction with <xref:System.ServiceModel.Channels.ChannelBase>, which is a base class that implements <xref:System.ServiceModel.Channels.IChannel>."},{"pos":[2560,2837],"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.ChannelFactoryBase&gt;</ph> class implements <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.ChannelManagerBase&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.ServiceModel.Channels.IChannelFactory&gt;</ph> and consolidates the <ph id=\"ph4\">`CreateChannel`</ph> overloads into one <ph id=\"ph5\">`OnCreateChannel`</ph> abstract method.","source":"The <xref:System.ServiceModel.Channels.ChannelFactoryBase> class implements <xref:System.ServiceModel.Channels.ChannelManagerBase> and <xref:System.ServiceModel.Channels.IChannelFactory> and consolidates the `CreateChannel` overloads into one `OnCreateChannel` abstract method."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.ChannelListenerBase&gt;</ph> class implements <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.IChannelListener&gt;</ph>.","pos":[2841,2971],"source":"The <xref:System.ServiceModel.Channels.ChannelListenerBase> class implements <xref:System.ServiceModel.Channels.IChannelListener>."},{"content":"It takes care of basic state management.","pos":[2972,3012]},{"pos":[3014,3138],"content":"The following discussion is based upon the <bpt id=\"p1\">[</bpt>Transport: UDP<ept id=\"p1\">](../../../../docs/framework/wcf/samples/transport-udp.md)</ept> sample.","source":"The following discussion is based upon the [Transport: UDP](../../../../docs/framework/wcf/samples/transport-udp.md) sample."},{"pos":[3143,3170],"content":"Creating a channel listener","linkify":"Creating a channel listener","nodes":[{"content":"Creating a channel listener","pos":[0,27]}]},{"content":"The <ph id=\"ph1\">`UdpChannelListener`</ph> that the sample implements derives from the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.ChannelListenerBase&gt;</ph> class.","pos":[3172,3303],"source":"The `UdpChannelListener` that the sample implements derives from the <xref:System.ServiceModel.Channels.ChannelListenerBase> class."},{"content":"It uses a single UDP socket to receive datagrams.","pos":[3304,3353]},{"content":"The <ph id=\"ph1\">`OnOpen`</ph> method receives data using the UDP socket in an asynchronous loop.","pos":[3354,3433],"source":" The `OnOpen` method receives data using the UDP socket in an asynchronous loop."},{"content":"The data are then converted into messages using the message encoding system:","pos":[3434,3510]},{"content":"Because the same datagram channel represents messages that arrive from a number of sources, the <ph id=\"ph1\">`UdpChannelListener`</ph> is a singleton listener.","pos":[3641,3782],"source":"Because the same datagram channel represents messages that arrive from a number of sources, the `UdpChannelListener` is a singleton listener."},{"content":"There is at most one active <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.IChannel&gt;</ph> associated with this listener at a time.","pos":[3783,3896],"source":" There is at most one active <xref:System.ServiceModel.Channels.IChannel> associated with this listener at a time."},{"content":"The sample generates another one only if a channel that is returned by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.ChannelListenerBase%601.AcceptChannel%2A&gt;</ph> method is subsequently disposed.","pos":[3897,4081],"source":" The sample generates another one only if a channel that is returned by the <xref:System.ServiceModel.Channels.ChannelListenerBase%601.AcceptChannel%2A> method is subsequently disposed."},{"content":"When a message is received, it's enqueued into this singleton channel.","pos":[4082,4152]},{"pos":[4158,4173],"content":"UdpInputChannel","linkify":"UdpInputChannel","nodes":[{"content":"UdpInputChannel","pos":[0,15]}]},{"content":"The <ph id=\"ph1\">`UdpInputChannel`</ph> class implements <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.IInputChannel&gt;</ph>.","pos":[4175,4264],"source":"The `UdpInputChannel` class implements <xref:System.ServiceModel.Channels.IInputChannel>."},{"content":"It consists of a queue of incoming messages that is populated by the <ph id=\"ph1\">`UdpChannelListener`</ph>'s socket.","pos":[4265,4364],"source":" It consists of a queue of incoming messages that is populated by the `UdpChannelListener`'s socket."},{"content":"These messages are dequeued by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.IInputChannel.Receive%2A&gt;</ph> method.","pos":[4365,4468],"source":" These messages are dequeued by the <xref:System.ServiceModel.Channels.IInputChannel.Receive%2A> method."}]}