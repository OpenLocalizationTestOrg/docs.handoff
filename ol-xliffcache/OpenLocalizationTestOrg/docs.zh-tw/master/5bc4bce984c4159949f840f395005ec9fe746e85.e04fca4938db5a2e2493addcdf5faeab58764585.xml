{"content":"---\ntitle: \"How to: Enable Streaming\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 6ca2cf4b-c7a1-49d8-a79b-843a90556ba4\n---\n# How to: Enable Streaming\nWindows Communication Foundation (WCF) can send messages using either buffered or streamed transfers. In the default buffered-transfer mode, a message must be completely delivered before a receiver can read it. In streaming transfer mode, the receiver can begin to process the message before it is completely delivered. The streaming mode is useful when the information that is passed is lengthy and can be processed serially. Streaming mode is also useful when the message is too large to be entirely buffered.  \n  \n To enable streaming, define the `OperationContract` appropriately and enable streaming at the transport level.  \n  \n### To stream data  \n  \n1.  To stream data, the `OperationContract` for the service must satisfy two requirements:  \n  \n    1.  The parameter that holds the data to be streamed must be the only parameter in the method. For example, if the input message is the one to be streamed, the operation must have exactly one input parameter. Similarly, if the output message is to be streamed, the operation must have either exactly one output parameter or a return value.  \n  \n    2.  At least one of the types of the parameter and return value must be either <xref:System.IO.Stream>, <xref:System.ServiceModel.Channels.Message>, or <xref:System.Xml.Serialization.IXmlSerializable>.  \n  \n     The following is an example of a contract for streamed data.  \n  \n     [!code-csharp[c_HowTo_EnableStreaming#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#1)]\n     [!code-vb[c_HowTo_EnableStreaming#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#1)]  \n  \n     The `GetStream` operation receives some buffered input data as a `string`, which is buffered, and returns a `Stream`, which is streamed. Conversely `UploadStream` takes in a `Stream` (streamed) and returns a `bool` (buffered). `EchoStream` takes and returns `Stream` and is an example of an operation whose input and output messages are both streamed. Finally, `GetReversedStream` takes no inputs and returns a `Stream` (streamed).  \n  \n2.  Streaming must be enabled on the binding. You set a `TransferMode` property, which can take one of the following values:  \n  \n    1.  `Buffered`,  \n  \n    2.  `Streamed`, which enables streaming communication in both directions.  \n  \n    3.  `StreamedRequest`, which enables streaming the request only.  \n  \n    4.  `StreamedResponse`, which enables streaming the response only.  \n  \n     The `BasicHttpBinding` exposes the `TransferMode` property on the binding, as does `NetTcpBinding` and `NetNamedPipeBinding`. The `TransferMode` property can also be set on the transport binding element and used in a custom binding.  \n  \n     The following samples show how to set `TransferMode` by code and by changing the configuration file. The samples also both set the `maxReceivedMessageSize` property to 64 MB, which places a cap on the maximum allowable size of messages on receive. The default `maxReceivedMessageSize` is 64 KB, which is usually too low for streaming scenarios. Set this quota setting as appropriate depending on the maximum size of messages your application expects to receive. Also note that `maxBufferSize` controls the maximum size that is buffered, and set it appropriately.  \n  \n    1.  The following configuration snippet from the sample shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.  \n  \n         [!code-xml[c_HowTo_EnableStreaming#103](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/common/app.config#103)]   \n  \n    2.  The following code snippet shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.  \n  \n         [!code-csharp[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#2)]\n         [!code-vb[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#2)]  \n  \n    3.  The following code snippet shows setting the `TransferMode` property to streaming on a custom TCP binding.  \n  \n         [!code-csharp[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#3)]\n         [!code-vb[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#3)]  \n  \n3.  The operations `GetStream`, `UploadStream`, and `EchoStream` all deal with sending data directly from a file or saving received data directly to a file. The following code is for `GetStream`.  \n  \n     [!code-csharp[c_HowTo_EnableStreaming#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#4)]\n     [!code-vb[c_HowTo_EnableStreaming#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#4)]  \n  \n### Writing a custom stream  \n  \n1.  To do special processing on each chunk of a data stream as it is being sent or received, derive a custom stream class from <xref:System.IO.Stream>. As an example of a custom stream, the following code contains a `GetReversedStream` method and a `ReverseStream` class-.  \n  \n     `GetReversedStream` creates and returns a new instance of `ReverseStream`. The actual processing happens as the system reads from the `ReverseStream` object. The `ReverseStream.Read` method reads a chunk of bytes from the underlying file, reverses them, then returns the reversed bytes. This method does not reverse the entire file content; it reverses one chunk of bytes at a time. This example shows how you can perform stream processing as the content is being read to or written from the stream.  \n  \n     [!code-csharp[c_HowTo_EnableStreaming#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#2)]\n     [!code-vb[c_HowTo_EnableStreaming#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#2)]  \n  \n## See also\n\n- [Large Data and Streaming](../../../../docs/framework/wcf/feature-details/large-data-and-streaming.md)\n- [Stream](../../../../docs/framework/wcf/samples/stream.md)\n","nodes":[{"pos":[4,142],"embed":true,"restype":"x-metadata","content":"title: \"How to: Enable Streaming\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 6ca2cf4b-c7a1-49d8-a79b-843a90556ba4","nodes":[{"content":"How to: Enable Streaming","nodes":[{"pos":[0,24],"content":"How to: Enable Streaming","nodes":[{"content":"How to: Enable Streaming","pos":[0,24]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[149,173],"content":"How to: Enable Streaming","linkify":"How to: Enable Streaming","nodes":[{"content":"How to: Enable Streaming","pos":[0,24]}]},{"content":"Windows Communication Foundation (WCF) can send messages using either buffered or streamed transfers.","pos":[174,275]},{"content":"In the default buffered-transfer mode, a message must be completely delivered before a receiver can read it.","pos":[276,384]},{"content":"In streaming transfer mode, the receiver can begin to process the message before it is completely delivered.","pos":[385,493]},{"content":"The streaming mode is useful when the information that is passed is lengthy and can be processed serially.","pos":[494,600]},{"content":"Streaming mode is also useful when the message is too large to be entirely buffered.","pos":[601,685]},{"pos":[692,802],"content":"To enable streaming, define the <ph id=\"ph1\">`OperationContract`</ph> appropriately and enable streaming at the transport level.","source":"To enable streaming, define the `OperationContract` appropriately and enable streaming at the transport level."},{"pos":[812,826],"content":"To stream data","linkify":"To stream data","nodes":[{"content":"To stream data","pos":[0,14]}]},{"pos":[836,922],"content":"To stream data, the <ph id=\"ph1\">`OperationContract`</ph> for the service must satisfy two requirements:","source":"To stream data, the `OperationContract` for the service must satisfy two requirements:"},{"content":"The parameter that holds the data to be streamed must be the only parameter in the method.","pos":[936,1026]},{"content":"For example, if the input message is the one to be streamed, the operation must have exactly one input parameter.","pos":[1027,1140]},{"content":"Similarly, if the output message is to be streamed, the operation must have either exactly one output parameter or a return value.","pos":[1141,1271]},{"pos":[1285,1482],"content":"At least one of the types of the parameter and return value must be either <ph id=\"ph1\">&lt;xref:System.IO.Stream&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.Message&gt;</ph>, or <ph id=\"ph3\">&lt;xref:System.Xml.Serialization.IXmlSerializable&gt;</ph>.","source":"At least one of the types of the parameter and return value must be either <xref:System.IO.Stream>, <xref:System.ServiceModel.Channels.Message>, or <xref:System.Xml.Serialization.IXmlSerializable>."},{"content":"The following is an example of a contract for streamed data.","pos":[1493,1553]},{"pos":[1564,1839],"content":"[!code-csharp[c_HowTo_EnableStreaming#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#1)]\n[!code-vb[c_HowTo_EnableStreaming#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#1)]","leadings":["","     "],"nodes":[]},{"content":"The <ph id=\"ph1\">`GetStream`</ph> operation receives some buffered input data as a <ph id=\"ph2\">`string`</ph>, which is buffered, and returns a <ph id=\"ph3\">`Stream`</ph>, which is streamed.","pos":[1850,1986],"source":"The `GetStream` operation receives some buffered input data as a `string`, which is buffered, and returns a `Stream`, which is streamed."},{"content":"Conversely <ph id=\"ph1\">`UploadStream`</ph> takes in a <ph id=\"ph2\">`Stream`</ph> (streamed) and returns a <ph id=\"ph3\">`bool`</ph> (buffered).","pos":[1987,2076],"source":" Conversely `UploadStream` takes in a `Stream` (streamed) and returns a `bool` (buffered)."},{"content":"<ph id=\"ph1\">`EchoStream`</ph> takes and returns <ph id=\"ph2\">`Stream`</ph> and is an example of an operation whose input and output messages are both streamed.","pos":[2077,2201],"source":"`EchoStream` takes and returns `Stream` and is an example of an operation whose input and output messages are both streamed."},{"content":"Finally, <ph id=\"ph1\">`GetReversedStream`</ph> takes no inputs and returns a <ph id=\"ph2\">`Stream`</ph> (streamed).","pos":[2202,2281],"source":" Finally, `GetReversedStream` takes no inputs and returns a `Stream` (streamed)."},{"content":"Streaming must be enabled on the binding.","pos":[2291,2332]},{"content":"You set a <ph id=\"ph1\">`TransferMode`</ph> property, which can take one of the following values:","pos":[2333,2411],"source":" You set a `TransferMode` property, which can take one of the following values:"},{"pos":[2425,2436],"content":"<ph id=\"ph1\">`Buffered`</ph>,","source":"`Buffered`,"},{"pos":[2450,2519],"content":"<ph id=\"ph1\">`Streamed`</ph>, which enables streaming communication in both directions.","source":"`Streamed`, which enables streaming communication in both directions."},{"pos":[2533,2593],"content":"<ph id=\"ph1\">`StreamedRequest`</ph>, which enables streaming the request only.","source":"`StreamedRequest`, which enables streaming the request only."},{"pos":[2607,2669],"content":"<ph id=\"ph1\">`StreamedResponse`</ph>, which enables streaming the response only.","source":"`StreamedResponse`, which enables streaming the response only."},{"content":"The <ph id=\"ph1\">`BasicHttpBinding`</ph> exposes the <ph id=\"ph2\">`TransferMode`</ph> property on the binding, as does <ph id=\"ph3\">`NetTcpBinding`</ph> and <ph id=\"ph4\">`NetNamedPipeBinding`</ph>.","pos":[2680,2805],"source":"The `BasicHttpBinding` exposes the `TransferMode` property on the binding, as does `NetTcpBinding` and `NetNamedPipeBinding`."},{"content":"The <ph id=\"ph1\">`TransferMode`</ph> property can also be set on the transport binding element and used in a custom binding.","pos":[2806,2912],"source":" The `TransferMode` property can also be set on the transport binding element and used in a custom binding."},{"content":"The following samples show how to set <ph id=\"ph1\">`TransferMode`</ph> by code and by changing the configuration file.","pos":[2923,3023],"source":"The following samples show how to set `TransferMode` by code and by changing the configuration file."},{"content":"The samples also both set the <ph id=\"ph1\">`maxReceivedMessageSize`</ph> property to 64 MB, which places a cap on the maximum allowable size of messages on receive.","pos":[3024,3170],"source":" The samples also both set the `maxReceivedMessageSize` property to 64 MB, which places a cap on the maximum allowable size of messages on receive."},{"content":"The default <ph id=\"ph1\">`maxReceivedMessageSize`</ph> is 64 KB, which is usually too low for streaming scenarios.","pos":[3171,3267],"source":" The default `maxReceivedMessageSize` is 64 KB, which is usually too low for streaming scenarios."},{"content":"Set this quota setting as appropriate depending on the maximum size of messages your application expects to receive.","pos":[3268,3384]},{"content":"Also note that <ph id=\"ph1\">`maxBufferSize`</ph> controls the maximum size that is buffered, and set it appropriately.","pos":[3385,3485],"source":" Also note that `maxBufferSize` controls the maximum size that is buffered, and set it appropriately."},{"pos":[3499,3658],"content":"The following configuration snippet from the sample shows setting the <ph id=\"ph1\">`TransferMode`</ph> property to streaming on the <ph id=\"ph2\">`basicHttpBinding`</ph> and a custom HTTP binding.","source":"The following configuration snippet from the sample shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding."},{"pos":[3827,3961],"content":"The following code snippet shows setting the <ph id=\"ph1\">`TransferMode`</ph> property to streaming on the <ph id=\"ph2\">`basicHttpBinding`</ph> and a custom HTTP binding.","source":"The following code snippet shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding."},{"pos":[3976,4317],"content":"[!code-csharp[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#2)]\n [!code-vb[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#2)]","leadings":["","        "],"nodes":[]},{"pos":[4331,4437],"content":"The following code snippet shows setting the <ph id=\"ph1\">`TransferMode`</ph> property to streaming on a custom TCP binding.","source":"The following code snippet shows setting the `TransferMode` property to streaming on a custom TCP binding."},{"pos":[4452,4793],"content":"[!code-csharp[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#3)]\n [!code-vb[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#3)]","leadings":["","        "],"nodes":[]},{"content":"The operations <ph id=\"ph1\">`GetStream`</ph>, <ph id=\"ph2\">`UploadStream`</ph>, and <ph id=\"ph3\">`EchoStream`</ph> all deal with sending data directly from a file or saving received data directly to a file.","pos":[4803,4955],"source":"The operations `GetStream`, `UploadStream`, and `EchoStream` all deal with sending data directly from a file or saving received data directly to a file."},{"content":"The following code is for <ph id=\"ph1\">`GetStream`</ph>.","pos":[4956,4994],"source":" The following code is for `GetStream`."},{"pos":[5005,5280],"content":"[!code-csharp[c_HowTo_EnableStreaming#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#4)]\n [!code-vb[c_HowTo_EnableStreaming#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#4)]","leadings":["","    "],"nodes":[]},{"pos":[5290,5313],"content":"Writing a custom stream","linkify":"Writing a custom stream","nodes":[{"content":"Writing a custom stream","pos":[0,23]}]},{"content":"To do special processing on each chunk of a data stream as it is being sent or received, derive a custom stream class from <ph id=\"ph1\">&lt;xref:System.IO.Stream&gt;</ph>.","pos":[5323,5470],"source":"To do special processing on each chunk of a data stream as it is being sent or received, derive a custom stream class from <xref:System.IO.Stream>."},{"content":"As an example of a custom stream, the following code contains a <ph id=\"ph1\">`GetReversedStream`</ph> method and a <ph id=\"ph2\">`ReverseStream`</ph> class-.","pos":[5471,5591],"source":" As an example of a custom stream, the following code contains a `GetReversedStream` method and a `ReverseStream` class-."},{"content":"<ph id=\"ph1\">`GetReversedStream`</ph> creates and returns a new instance of <ph id=\"ph2\">`ReverseStream`</ph>.","pos":[5602,5676],"source":"`GetReversedStream` creates and returns a new instance of `ReverseStream`."},{"content":"The actual processing happens as the system reads from the <ph id=\"ph1\">`ReverseStream`</ph> object.","pos":[5677,5759],"source":" The actual processing happens as the system reads from the `ReverseStream` object."},{"content":"The <ph id=\"ph1\">`ReverseStream.Read`</ph> method reads a chunk of bytes from the underlying file, reverses them, then returns the reversed bytes.","pos":[5760,5888],"source":" The `ReverseStream.Read` method reads a chunk of bytes from the underlying file, reverses them, then returns the reversed bytes."},{"content":"This method does not reverse the entire file content; it reverses one chunk of bytes at a time.","pos":[5889,5984]},{"content":"This example shows how you can perform stream processing as the content is being read to or written from the stream.","pos":[5985,6101]},{"pos":[6112,6387],"content":"[!code-csharp[c_HowTo_EnableStreaming#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#2)]\n [!code-vb[c_HowTo_EnableStreaming#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#2)]","leadings":["","    "],"nodes":[]},{"pos":[6396,6404],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6408,6510],"content":"<bpt id=\"p1\">[</bpt>Large Data and Streaming<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/large-data-and-streaming.md)</ept>","source":"[Large Data and Streaming](../../../../docs/framework/wcf/feature-details/large-data-and-streaming.md)"},{"pos":[6513,6571],"content":"<bpt id=\"p1\">[</bpt>Stream<ept id=\"p1\">](../../../../docs/framework/wcf/samples/stream.md)</ept>","source":"[Stream](../../../../docs/framework/wcf/samples/stream.md)"}]}