{"content":"---\ntitle: \"Writing a Windows Store App that consumes an OData Service | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework-oob\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 9917a0e9-ec93-49e5-a366-fd39b892eb8b\ncaps.latest.revision: 4\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Writing a Windows Store App that consumes an OData Service\nWindows 8 introduces a new type of application: the Windows Store app. Windows Store apps have a brand new look and feel, run on a variety of devices, and are made available on the Windows Store. This topic describes how to write a Windows Store app that consumes an OData service, specifically the NetFlix Catalog OData service. For more information about Windows Store Apps, please read [Getting Started with Windows Store apps](http://msdn.microsoft.com/library/windows/apps/br211386.aspx).  \n  \n## Prerequisites  \n  \n1.  [Microsoft Windows 8](http://go.microsoft.com/fwlink/p/?LinkId=266654)  \n  \n2.  [Microsoft Visual Studio 2012](http://go.microsoft.com/fwlink/p/?LinkId=266655)  \n  \n3.  [WCF Data Services](http://msdn.microsoft.com/data/bb931106)  \n  \n#### Creating the default Windows Store Grid Application  \n  \n1.  Create a new Windows Store Grid Application using C# and XAML. Name the application OData.WindowsStore.NetflixDemo:  \n  \n     ![New Project Dialog](../../../../docs/framework/data/wcf/media/win8clientcreatenewproject.png \"Win8ClientCreateNewProject\")  \n  \n2.  Open the Package.appxmanifest and enter a friendly name in the Display name text box. This specifies the application name used with the Windows 8 search functionality.  \n  \n     ![Application manifest file](../../../../docs/framework/data/wcf/media/appxmanifest.png \"appxmanifest\")  \n  \n3.  Enter a friendly name in the \\<AppName> element in the App.xaml file. This sets the application name that is displayed when the application is launched:  \n  \n     ![App.xaml file](../../../../docs/framework/data/wcf/media/appxaml.png \"appxaml\")  \n  \n4.  Build and launch the application. You first see the application’s splash screen. The screenshot below displays the default splash screen. The image used is stored in the project’s Assets folder.  \n  \n     ![The default app splash screen](../../../../docs/framework/data/wcf/media/defualtappsplash.png \"defualtAppSplash\")  \n  \n     Then the application will be displayed.  \n  \n     ![The default application](../../../../docs/framework/data/wcf/media/defaultapplication.png \"DefaultApplication\")  \n  \n     The default application defines a set of classes in SampleDataSource.cs: SampleDataGroup and SampleDataItem, both of which are derived from SampleDataCommon, which itself is derived from BindableBase. SampleDataGroup and SampleDataItem are bound to the default GridView. SampleDataSource.cs is located in the DataModel folder within the NetflixDemo project. The application displays a grouped collection. Each group contains any number of items, represented by SampleDataGroup and SampleDataItem, respectively. In the previous screen shot you can see a group called Group Title 1 and all of the items in the group displayed together.  \n  \n     The main page of the application is GroupedItemsPage.xaml. It contains a GridView that displays the sample data created by the SampleDataSource.cs class. The GroupedItemsPage is loaded by the App.xaml.cs in a call to rootFrame.Navigate:  \n  \n    ```csharp  \n    if (!rootFrame.Navigate(typeof(GroupedItemsPage), \"AllGroups\"))  \n    {  \n        throw new Exception(\"Failed to create initial page\");  \n    }  \n  \n    ```  \n  \n     This causes the GroupedItemsPage to be instantiated and it’s LoadState method is called. LoadState causes the static SampleDataSource instance to be created, which creates a collection of SampleDataGroup objects. Each SampleDataGroup object contains a collection of SampleDataItem objects. LoadState stores the collection of SampleDataGroup objects in the DefaultViewModel:  \n  \n    ```csharp  \n    protected override void LoadState(Object navigationParameter, Dictionary<String, Object> pageState)  \n    {  \n        var sampleDataGroups = SampleDataSource.GetGroups((String)navigationParameter);  \n        this.DefaultViewModel[\"Groups\"] = sampleDataGroups;  \n    }  \n  \n    ```  \n  \n     The DefaultViewModel is then bound to the GridView. This is referenced in the GroupedItemsPage.xaml file when configuring the data binding.  \n  \n    ```cpp  \n    <CollectionViewSource  \n                x:Name=\"groupedItemsViewSource\"  \n                Source=\"{Binding Groups}\"  \n                IsSourceGrouped=\"true\"  \n                ItemsPath=\"TopItems\"  \n                d:Source=\"{Binding AllGroups, Source={d:DesignInstance Type=data:SampleDataSource, IsDesignTimeCreatable=True}}\"/>  \n  \n    ```  \n  \n     The CollectionViewSource is used as a proxy for handling grouped collections. When binding occurs, it iterates through the collection of SampleDataGroup objects to populate the GridView.  The ItemsPath attribute tells the CollectionViewSource what property on each SampleDataGroup object to use to find the SampleDataItems it contains. In this case each SampleDataGroup object contains a TopItems collection of SampleDataItem objects.  \n  \n     For the Netflix application, movies are grouped by genre. So the application displays a number of genres and a list of movies within that genre.  \n  \n#### Add a Service Reference to the Netflix OData Service  \n  \n1.  Before we can make any calls to the Netflix OData service we need to add a service reference. Right-click the project in the Solution Explorer and select Add Service Reference…  \n  \n     ![Add Service Reference Dialog](../../../../docs/framework/data/wcf/media/addservicereferenceodata.png \"AddServiceReferenceOData\")  \n  \n2.  Enter the URL for the Netflix OData service in the Address bar and click Go. Set the Namespace of the service reference to Netflix and click OK.  \n  \n     ![Add Service Reference Error](../../../../docs/framework/data/wcf/media/addservicereferenceerror.png \"AddServiceReferenceError\")  \n  \n    > [!NOTE]\n    >  If you have not yet installed [WCF Data Services Tools for Windows Store Apps](http://go.microsoft.com/fwlink/p/?LinkId=266652), you will be prompted with a message such as the one above. You will need to download and install the tools referenced in the link to continue.  \n  \n Adding a service reference generates strongly typed classes that WCF Data Services will use to parse the OData returned by the Netflix OData service. The classes defined in SampleDataSource.cs can be bound to the GridView so we need to transfer the data from the generated OData client classes into the bindable classes defined in SampleDataSource.cs.  In order to do this, we need to make some changes to the data model defined in SampleDataSource.cs.  \n  \n#### Update the data model for the application  \n  \n1.  Replace the existing code in SampleDataSource.cs with the code from [this gist](https://gist.github.com/3419288). The updated code adds a LoadMovies method (to the SampleDataSource class)  that performs a query against the Netflix OData service and populates a list of genres (allGroups) and within each genre a list of movies. The SampleDataGroup class is used to represent a genre and the SampleDataItem class is used to represent a movie.  \n  \n    ```csharp  \n    public static async void LoadMovies()  \n    {  \n        IEnumerable<Title> titles = await ((DataServiceQuery<Title>)Context.Titles  \n            .Expand(\"Genres,AudioFormats,AudioFormats/Language,Awards,Cast\")  \n            .Where(t => t.Rating == \"PG\")  \n            .OrderByDescending(t => t.ReleaseYear)  \n            .Take(300)).ExecuteAsync();  \n  \n        foreach (Title title in titles)  \n        {  \n            foreach (Genre netflixGenre in title.Genres)  \n            {  \n                SampleDataGroup genre = GetGroup(netflixGenre.Name);  \n                if (genre == null)  \n                {  \n                    genre = new SampleDataGroup(netflixGenre.Name, netflixGenre.Name, String.Empty, title.BoxArt.LargeUrl, String.Empty);  \n                    Instance.AllGroups.Add(genre);  \n                }  \n                var content = new StringBuilder();  \n                // Write additional things to content here if you want them to display in the item detail.  \n                genre.Items.Add(new SampleDataItem(title.Id, title.Name, String.Format(\"{0}rnrn{1} ({2})\", title.Synopsis, title.Rating, title.ReleaseYear), title.BoxArt.HighDefinitionUrl ?? title.BoxArt.LargeUrl, \"Description\", content.ToString()));  \n            }  \n        }  \n    }  \n  \n    ```  \n  \n     The [Task-based Asynchronous Pattern](http://go.microsoft.com/fwlink/p/?LinkId=266651) (TAP) is used to asynchronously get 300 (Take) recent (OrderByDescending) PG-rated (Where) movies back from Netflix. The rest of the code constructs SimpleDataItems and SimpleDataGroups from the entities that were returned in the OData feed.  \n  \n     The SampleDataSource class also implements a simple search method. In this case, it does a simple in-memory search of the loaded movies.  \n  \n    ```csharp  \n    public static IEnumerable<SampleDataItem> Search(string searchString)  \n    {  \n            var regex = new Regex(searchString, RegexOptions.CultureInvariant | RegexOptions.IgnoreCase | RegexOptions.IgnorePatternWhitespace);  \n            return Instance.AllGroups  \n                .SelectMany(g => g.Items)  \n                .Where(m => regex.IsMatch(m.Title) || regex.IsMatch(m.Subtitle))  \n                    .Distinct(new SampleDataItemComparer());  \n    }  \n  \n    ```  \n  \n     Also in SampleDataSource.cs a class called ExtensionMethods is defined. Each of these extension methods uses the TAP pattern to allow the SampleDataSource to execute an OData query without blocking the UI. For example, the following code uses the Task.Factory.FromAsync method to implement TAP.  \n  \n    ```csharp  \n    public static async Task<IEnumerable<T>> ExecuteAsync<T>(this DataServiceQuery<T> query)  \n    {  \n        return await Task.Factory.FromAsync<IEnumerable<T>>(query.BeginExecute(null, null), query.EndExecute);  \n    }  \n  \n    ```  \n  \n     As in the default application, the main page of the application is GroupedItemsPage. This time, however, it displays the movies retrieved from Netflix grouped by genre.  When the GroupedItemsPage is instantiated, its LoadState method is called. LoadState causes the static SampleDataSource instance to be created, making a call to the Netflix OData service as discussed previously. LoadState stores the collection of genres (SampleDataGroup objects) in the DefaultViewModel:  \n  \n    ```csharp  \n    protected override void LoadState(Object navigationParameter, Dictionary<String, Object> pageState)  \n    {  \n  \n        var sampleDataGroups = SampleDataSource.GetGroups((String)navigationParameter);  \n        this.DefaultViewModel[\"Groups\"] = sampleDataGroups;  \n    }  \n    ```  \n  \n     As described previously, the DefaultViewModel is then used to bind the data to the GridView.  \n  \n#### Add a search contract to allow the application to participate in Windows search  \n  \n1.  Add a search contract to the application. This allows the application to integrate with the Windows 8 search experience. Name the search contract SearchResultsPage.xaml  \n  \n     ![Add a search contract](../../../../docs/framework/data/wcf/media/addsearchcontract.png \"AddSearchContract\")  \n  \n2.  Modify line 58 of SearchResultsPage.xaml.cs by removing the embedded quotes around queryText.  \n  \n    ```csharp  \n    // Communicate results through the view model  \n    this.DefaultViewModel[\"QueryText\"] = queryText;  \n    this.DefaultViewModel[\"Filters\"] = filterList;  \n    this.DefaultViewModel[\"ShowFilters\"] = filterList.Count > 1;  \n  \n    ```  \n  \n3.  Insert the following two lines of code at line 81 in SearchResultsPage.xaml.cs to retrieve the search results.  \n  \n    ```csharp  \n    // TODO: Respond to the change in active filter by setting this.DefaultViewModel[\"Results\"]  \n                    //       to a collection of items with bindable Image, Title, Subtitle, and Description properties  \n                    var searchValue = (string)this.DefaultViewModel[\"QueryText\"];  \n                    this.DefaultViewModel[\"Results\"] = new List<SampleDataItem>(SampleDataSource.Search(searchValue));  \n  \n    ```  \n  \n When a user invokes Windows search, types in a search term and then touches the Netflix Demo app icon in the search bar, the LoadState method of the SearchResultsPage is executed. The navigation parameter sent to LoadState contains the query text. Next the Filter_SelectionChanged method is called which then calls the Search method on the SampleDataSource class. The results are returned and displayed in the SearchResultsPage.xaml page.  \n  \n```csharp  \n/// <summary>  \n        /// Invoked when a filter is selected using the ComboBox in snapped view state.  \n        /// </summary>  \n        /// <param name=\"sender\">The ComboBox instance.</param>  \n        /// <param name=\"e\">Event data describing how the selected filter was changed.</param>  \n        void Filter_SelectionChanged(object sender, SelectionChangedEventArgs e)  \n        {  \n            // Determine what filter was selected  \n            var selectedFilter = e.AddedItems.FirstOrDefault() as Filter;  \n            if (selectedFilter != null)  \n            {  \n                // Mirror the results into the corresponding Filter object to allow the  \n                // RadioButton representation used when not snapped to reflect the change  \n                selectedFilter.Active = true;  \n  \n                // TODO: Respond to the change in active filter by setting this.DefaultViewModel[\"Results\"]  \n                //       to a collection of items with bindable Image, Title, Subtitle, and Description properties  \n                var searchValue = (string)this.DefaultViewModel[\"QueryText\"];  \n                this.DefaultViewModel[\"Results\"] = new List<SampleDataItem>(SampleDataSource.Search(searchValue));  \n  \n                // Ensure results are found  \n                object results;  \n                ICollection resultsCollection;  \n                if (this.DefaultViewModel.TryGetValue(\"Results\", out results) &&  \n                    (resultsCollection = results as ICollection) != null &&  \n                    resultsCollection.Count != 0)  \n                {  \n                    VisualStateManager.GoToState(this, \"ResultsFound\", true);  \n                    return;  \n                }  \n            }  \n  \n            // Display informational text when there are no search results.  \n            VisualStateManager.GoToState(this, \"NoResultsFound\", true);  \n        }  \n```  \n  \n For more information on integrating search into an application see, [Search: integrating into the Windows 8 search experience](http://go.microsoft.com/fwlink/p/?LinkId=266650).  \n  \n## Run the application  \n Launch the application by pressing F5. Note that it will take a few seconds to load the images upon application launch. Also, your first search attempt may not return any results. In a real-world application, you would want to deal with both of these issues.  \n  \n The application calls the Netflix OData service, receives the data in the generated OData client classes and then transfers that data to bindable data classes (SampleDataSource, SampleDataGroup, and SampleDataItem). It uses these bindable classes to bind the data to the GridView. If you are unfamiliar with how XAML databinding works see [How to group items in a list or grid (Windows Store apps using C#/VB/C++ and XAML)](http://msdn.microsoft.com/library/windows/apps/xaml/hh780627).\n","nodes":[{"pos":[12,87],"content":"Writing a Windows Store App that consumes an OData Service | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Writing a Windows Store App that consumes an OData Service | Microsoft Docs","pos":[0,75]}]},{"pos":[389,447],"content":"Writing a Windows Store App that consumes an OData Service","linkify":"Writing a Windows Store App that consumes an OData Service","nodes":[{"content":"Writing a Windows Store App that consumes an OData Service","pos":[0,58]}]},{"content":"Windows 8 introduces a new type of application: the Windows Store app.","pos":[448,518]},{"content":"Windows Store apps have a brand new look and feel, run on a variety of devices, and are made available on the Windows Store.","pos":[519,643]},{"content":"This topic describes how to write a Windows Store app that consumes an OData service, specifically the NetFlix Catalog OData service.","pos":[644,777]},{"content":"For more information about Windows Store Apps, please read <bpt id=\"p1\">[</bpt>Getting Started with Windows Store apps<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/apps/br211386.aspx)</ept>.","pos":[778,941],"source":" For more information about Windows Store Apps, please read [Getting Started with Windows Store apps](http://msdn.microsoft.com/library/windows/apps/br211386.aspx)."},{"pos":[950,963],"content":"Prerequisites","linkify":"Prerequisites","nodes":[{"content":"Prerequisites","pos":[0,13]}]},{"pos":[973,1043],"content":"<bpt id=\"p1\">[</bpt>Microsoft Windows 8<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=266654)</ept>","source":"[Microsoft Windows 8](http://go.microsoft.com/fwlink/p/?LinkId=266654)"},{"pos":[1053,1132],"content":"<bpt id=\"p1\">[</bpt>Microsoft Visual Studio 2012<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=266655)</ept>","source":"[Microsoft Visual Studio 2012](http://go.microsoft.com/fwlink/p/?LinkId=266655)"},{"pos":[1142,1202],"content":"<bpt id=\"p1\">[</bpt>WCF Data Services<ept id=\"p1\">](http://msdn.microsoft.com/data/bb931106)</ept>","source":"[WCF Data Services](http://msdn.microsoft.com/data/bb931106)"},{"pos":[1213,1264],"content":"Creating the default Windows Store Grid Application","linkify":"Creating the default Windows Store Grid Application","nodes":[{"content":"Creating the default Windows Store Grid Application","pos":[0,51]}]},{"content":"Create a new Windows Store Grid Application using C# and XAML.","pos":[1274,1336]},{"content":"Name the application OData.WindowsStore.NetflixDemo:","pos":[1337,1389]},{"pos":[1400,1524],"content":"<bpt id=\"p1\">![</bpt>New Project Dialog<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/data/wcf/media/win8clientcreatenewproject.png \"</bpt>Win8ClientCreateNewProject<ept id=\"p2\">\")</ept>","source":"![New Project Dialog](../../../../docs/framework/data/wcf/media/win8clientcreatenewproject.png \"Win8ClientCreateNewProject\")"},{"content":"Open the Package.appxmanifest and enter a friendly name in the Display name text box.","pos":[1534,1619]},{"content":"This specifies the application name used with the Windows 8 search functionality.","pos":[1620,1701]},{"pos":[1712,1815],"content":"<bpt id=\"p1\">![</bpt>Application manifest file<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/data/wcf/media/appxmanifest.png \"</bpt>appxmanifest<ept id=\"p2\">\")</ept>","source":"![Application manifest file](../../../../docs/framework/data/wcf/media/appxmanifest.png \"appxmanifest\")"},{"content":"Enter a friendly name in the <ph id=\"ph1\">\\&lt;</ph>AppName&gt; element in the App.xaml file.","pos":[1825,1894],"source":"Enter a friendly name in the \\<AppName> element in the App.xaml file."},{"content":"This sets the application name that is displayed when the application is launched:","pos":[1895,1977]},{"pos":[1988,2069],"content":"<bpt id=\"p1\">![</bpt>App.xaml file<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/data/wcf/media/appxaml.png \"</bpt>appxaml<ept id=\"p2\">\")</ept>","source":"![App.xaml file](../../../../docs/framework/data/wcf/media/appxaml.png \"appxaml\")"},{"content":"Build and launch the application.","pos":[2079,2112]},{"content":"You first see the application’s splash screen.","pos":[2113,2159]},{"content":"The screenshot below displays the default splash screen.","pos":[2160,2216]},{"content":"The image used is stored in the project’s Assets folder.","pos":[2217,2273]},{"pos":[2284,2399],"content":"<bpt id=\"p1\">![</bpt>The default app splash screen<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/data/wcf/media/defualtappsplash.png \"</bpt>defualtAppSplash<ept id=\"p2\">\")</ept>","source":"![The default app splash screen](../../../../docs/framework/data/wcf/media/defualtappsplash.png \"defualtAppSplash\")"},{"content":"Then the application will be displayed.","pos":[2410,2449]},{"pos":[2460,2573],"content":"<bpt id=\"p1\">![</bpt>The default application<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/data/wcf/media/defaultapplication.png \"</bpt>DefaultApplication<ept id=\"p2\">\")</ept>","source":"![The default application](../../../../docs/framework/data/wcf/media/defaultapplication.png \"DefaultApplication\")"},{"content":"The default application defines a set of classes in SampleDataSource.cs: SampleDataGroup and SampleDataItem, both of which are derived from SampleDataCommon, which itself is derived from BindableBase.","pos":[2584,2784]},{"content":"SampleDataGroup and SampleDataItem are bound to the default GridView.","pos":[2785,2854]},{"content":"SampleDataSource.cs is located in the DataModel folder within the NetflixDemo project.","pos":[2855,2941]},{"content":"The application displays a grouped collection.","pos":[2942,2988]},{"content":"Each group contains any number of items, represented by SampleDataGroup and SampleDataItem, respectively.","pos":[2989,3094]},{"content":"In the previous screen shot you can see a group called Group Title 1 and all of the items in the group displayed together.","pos":[3095,3217]},{"content":"The main page of the application is GroupedItemsPage.xaml.","pos":[3228,3286]},{"content":"It contains a GridView that displays the sample data created by the SampleDataSource.cs class.","pos":[3287,3381]},{"content":"The GroupedItemsPage is loaded by the App.xaml.cs in a call to rootFrame.Navigate:","pos":[3382,3464]},{"content":"This causes the GroupedItemsPage to be instantiated and it’s LoadState method is called.","pos":[3657,3745]},{"content":"LoadState causes the static SampleDataSource instance to be created, which creates a collection of SampleDataGroup objects.","pos":[3746,3869]},{"content":"Each SampleDataGroup object contains a collection of SampleDataItem objects.","pos":[3870,3946]},{"content":"LoadState stores the collection of SampleDataGroup objects in the DefaultViewModel:","pos":[3947,4030]},{"content":"The DefaultViewModel is then bound to the GridView.","pos":[4347,4398]},{"content":"This is referenced in the GroupedItemsPage.xaml file when configuring the data binding.","pos":[4399,4486]},{"content":"The CollectionViewSource is used as a proxy for handling grouped collections.","pos":[4861,4938]},{"content":"When binding occurs, it iterates through the collection of SampleDataGroup objects to populate the GridView.","pos":[4939,5047]},{"content":"The ItemsPath attribute tells the CollectionViewSource what property on each SampleDataGroup object to use to find the SampleDataItems it contains.","pos":[5049,5196]},{"content":"In this case each SampleDataGroup object contains a TopItems collection of SampleDataItem objects.","pos":[5197,5295]},{"content":"For the Netflix application, movies are grouped by genre.","pos":[5306,5363]},{"content":"So the application displays a number of genres and a list of movies within that genre.","pos":[5364,5450]},{"pos":[5461,5513],"content":"Add a Service Reference to the Netflix OData Service","linkify":"Add a Service Reference to the Netflix OData Service","nodes":[{"content":"Add a Service Reference to the Netflix OData Service","pos":[0,52]}]},{"content":"Before we can make any calls to the Netflix OData service we need to add a service reference.","pos":[5523,5616]},{"content":"Right-click the project in the Solution Explorer and select Add Service Reference…","pos":[5617,5699]},{"pos":[5710,5840],"content":"<bpt id=\"p1\">![</bpt>Add Service Reference Dialog<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/data/wcf/media/addservicereferenceodata.png \"</bpt>AddServiceReferenceOData<ept id=\"p2\">\")</ept>","source":"![Add Service Reference Dialog](../../../../docs/framework/data/wcf/media/addservicereferenceodata.png \"AddServiceReferenceOData\")"},{"content":"Enter the URL for the Netflix OData service in the Address bar and click Go.","pos":[5850,5926]},{"content":"Set the Namespace of the service reference to Netflix and click OK.","pos":[5927,5994]},{"pos":[6005,6134],"content":"<bpt id=\"p1\">![</bpt>Add Service Reference Error<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/data/wcf/media/addservicereferenceerror.png \"</bpt>AddServiceReferenceError<ept id=\"p2\">\")</ept>","source":"![Add Service Reference Error](../../../../docs/framework/data/wcf/media/addservicereferenceerror.png \"AddServiceReferenceError\")"},{"pos":[6146,6432],"content":"[!NOTE]\nIf you have not yet installed [WCF Data Services Tools for Windows Store Apps](http://go.microsoft.com/fwlink/p/?LinkId=266652), you will be prompted with a message such as the one above. You will need to download and install the tools referenced in the link to continue.","leadings":["","    >  "],"nodes":[{"content":"If you have not yet installed [WCF Data Services Tools for Windows Store Apps](http://go.microsoft.com/fwlink/p/?LinkId=266652), you will be prompted with a message such as the one above. You will need to download and install the tools referenced in the link to continue.","pos":[8,279],"nodes":[{"content":"If you have not yet installed <bpt id=\"p1\">[</bpt>WCF Data Services Tools for Windows Store Apps<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=266652)</ept>, you will be prompted with a message such as the one above.","pos":[0,187],"source":"If you have not yet installed [WCF Data Services Tools for Windows Store Apps](http://go.microsoft.com/fwlink/p/?LinkId=266652), you will be prompted with a message such as the one above."},{"content":"You will need to download and install the tools referenced in the link to continue.","pos":[188,271]}]}]},{"content":"Adding a service reference generates strongly typed classes that WCF Data Services will use to parse the OData returned by the Netflix OData service.","pos":[6439,6588]},{"content":"The classes defined in SampleDataSource.cs can be bound to the GridView so we need to transfer the data from the generated OData client classes into the bindable classes defined in SampleDataSource.cs.","pos":[6589,6790]},{"content":"In order to do this, we need to make some changes to the data model defined in SampleDataSource.cs.","pos":[6792,6891]},{"pos":[6902,6943],"content":"Update the data model for the application","linkify":"Update the data model for the application","nodes":[{"content":"Update the data model for the application","pos":[0,41]}]},{"content":"Replace the existing code in SampleDataSource.cs with the code from <bpt id=\"p1\">[</bpt>this gist<ept id=\"p1\">](https://gist.github.com/3419288)</ept>.","pos":[6953,7066],"source":"Replace the existing code in SampleDataSource.cs with the code from [this gist](https://gist.github.com/3419288)."},{"content":"The updated code adds a LoadMovies method (to the SampleDataSource class)  that performs a query against the Netflix OData service and populates a list of genres (allGroups) and within each genre a list of movies.","pos":[7067,7280]},{"content":"The SampleDataGroup class is used to represent a genre and the SampleDataItem class is used to represent a movie.","pos":[7281,7394]},{"content":"The <bpt id=\"p1\">[</bpt>Task-based Asynchronous Pattern<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=266651)</ept> (TAP) is used to asynchronously get 300 (Take) recent (OrderByDescending) PG-rated (Where) movies back from Netflix.","pos":[8716,8919],"source":"The [Task-based Asynchronous Pattern](http://go.microsoft.com/fwlink/p/?LinkId=266651) (TAP) is used to asynchronously get 300 (Take) recent (OrderByDescending) PG-rated (Where) movies back from Netflix."},{"content":"The rest of the code constructs SimpleDataItems and SimpleDataGroups from the entities that were returned in the OData feed.","pos":[8920,9044]},{"content":"The SampleDataSource class also implements a simple search method.","pos":[9055,9121]},{"content":"In this case, it does a simple in-memory search of the loaded movies.","pos":[9122,9191]},{"content":"Also in SampleDataSource.cs a class called ExtensionMethods is defined.","pos":[9703,9774]},{"content":"Each of these extension methods uses the TAP pattern to allow the SampleDataSource to execute an OData query without blocking the UI.","pos":[9775,9908]},{"content":"For example, the following code uses the Task.Factory.FromAsync method to implement TAP.","pos":[9909,9997]},{"content":"As in the default application, the main page of the application is GroupedItemsPage.","pos":[10264,10348]},{"content":"This time, however, it displays the movies retrieved from Netflix grouped by genre.","pos":[10349,10432]},{"content":"When the GroupedItemsPage is instantiated, its LoadState method is called.","pos":[10434,10508]},{"content":"LoadState causes the static SampleDataSource instance to be created, making a call to the Netflix OData service as discussed previously.","pos":[10509,10645]},{"content":"LoadState stores the collection of genres (SampleDataGroup objects) in the DefaultViewModel:","pos":[10646,10738]},{"content":"As described previously, the DefaultViewModel is then used to bind the data to the GridView.","pos":[11055,11147]},{"pos":[11158,11237],"content":"Add a search contract to allow the application to participate in Windows search","linkify":"Add a search contract to allow the application to participate in Windows search","nodes":[{"content":"Add a search contract to allow the application to participate in Windows search","pos":[0,79]}]},{"content":"Add a search contract to the application.","pos":[11247,11288]},{"content":"This allows the application to integrate with the Windows 8 search experience.","pos":[11289,11367]},{"content":"Name the search contract SearchResultsPage.xaml","pos":[11368,11415]},{"pos":[11426,11535],"content":"<bpt id=\"p1\">![</bpt>Add a search contract<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/data/wcf/media/addsearchcontract.png \"</bpt>AddSearchContract<ept id=\"p2\">\")</ept>","source":"![Add a search contract](../../../../docs/framework/data/wcf/media/addsearchcontract.png \"AddSearchContract\")"},{"content":"Modify line 58 of SearchResultsPage.xaml.cs by removing the embedded quotes around queryText.","pos":[11545,11638]},{"content":"Insert the following two lines of code at line 81 in SearchResultsPage.xaml.cs to retrieve the search results.","pos":[11906,12016]},{"content":"When a user invokes Windows search, types in a search term and then touches the Netflix Demo app icon in the search bar, the LoadState method of the SearchResultsPage is executed.","pos":[12479,12658]},{"content":"The navigation parameter sent to LoadState contains the query text.","pos":[12659,12726]},{"content":"Next the Filter_SelectionChanged method is called which then calls the Search method on the SampleDataSource class.","pos":[12727,12842]},{"content":"The results are returned and displayed in the SearchResultsPage.xaml page.","pos":[12843,12917]},{"pos":[14855,15031],"content":"For more information on integrating search into an application see, <bpt id=\"p1\">[</bpt>Search: integrating into the Windows 8 search experience<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=266650)</ept>.","source":"For more information on integrating search into an application see, [Search: integrating into the Windows 8 search experience](http://go.microsoft.com/fwlink/p/?LinkId=266650)."},{"pos":[15040,15059],"content":"Run the application","linkify":"Run the application","nodes":[{"content":"Run the application","pos":[0,19]}]},{"content":"Launch the application by pressing F5.","pos":[15063,15101]},{"content":"Note that it will take a few seconds to load the images upon application launch.","pos":[15102,15182]},{"content":"Also, your first search attempt may not return any results.","pos":[15183,15242]},{"content":"In a real-world application, you would want to deal with both of these issues.","pos":[15243,15321]},{"content":"The application calls the Netflix OData service, receives the data in the generated OData client classes and then transfers that data to bindable data classes (SampleDataSource, SampleDataGroup, and SampleDataItem).","pos":[15328,15543]},{"content":"It uses these bindable classes to bind the data to the GridView.","pos":[15544,15608]},{"content":"If you are unfamiliar with how XAML databinding works see <bpt id=\"p1\">[</bpt>How to group items in a list or grid (Windows Store apps using C#/VB/C++ and XAML)<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/apps/xaml/hh780627)</ept>.","pos":[15609,15814],"source":" If you are unfamiliar with how XAML databinding works see [How to group items in a list or grid (Windows Store apps using C#/VB/C++ and XAML)](http://msdn.microsoft.com/library/windows/apps/xaml/hh780627)."}]}