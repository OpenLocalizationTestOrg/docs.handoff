{"content":"---\ntitle: \"Error handling in asynchronous activities\"\nms.date: \"03/30/2017\"\nms.assetid: e8f8ce2b-50c9-4e44-b187-030e0cf30a5d\n---\n# Error handling in asynchronous activities\nProviding error handling in an <xref:System.Activities.AsyncCodeActivity> involves routing the error through the activity’s callback system. This topic describes how to get an error that is thrown in an asynchronous operation back to the host, using the SendMail activity sample.  \n  \n## Returning an error thrown in an asynchronous activity back to the host  \n Routing an error in an asynchronous operation back to the host in the SendMail activity sample involves the following steps:  \n  \n-   Add an Exception property to the `SendMailAsyncResult` class.  \n  \n-   Copy the thrown error to that property in the `SendCompleted` event handler.  \n  \n-   Throw the exception in the `EndExecute` event handler.  \n  \n The resulting code is as follows.  \n  \n```csharp  \nclass SendMailAsyncResult : IAsyncResult  \n        {  \n            …  \n            public Exception Error { get; set; }   \n            …  \n            void SendCompleted(object sender, AsyncCompletedEventArgs e)  \n            {  \n                Error = e.Error;  \n                this.asyncWaitHandle.Set();  \n                callback(this);  \n            }  \n         }  \n  \n    public sealed class SendMail: AsyncCodeActivity  \n    {  \n         …  \n        protected override void EndExecute(AsyncCodeActivityContext context, IAsyncResult result)  \n        {  \n            SendMailAsyncResult sendMailResult = result as SendMailAsyncResult;  \n            if (sendMailResult != null && sendMailResult.Error != null)  \n                throw sendMailResult.Error;   \n        }  \n    }  \n```\n","nodes":[{"pos":[4,125],"embed":true,"restype":"x-metadata","content":"title: \"Error handling in asynchronous activities\"\nms.date: \"03/30/2017\"\nms.assetid: e8f8ce2b-50c9-4e44-b187-030e0cf30a5d","nodes":[{"content":"Error handling in asynchronous activities","nodes":[{"pos":[0,41],"content":"Error handling in asynchronous activities","nodes":[{"content":"Error handling in asynchronous activities","pos":[0,41]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[132,173],"content":"Error handling in asynchronous activities","linkify":"Error handling in asynchronous activities","nodes":[{"content":"Error handling in asynchronous activities","pos":[0,41]}]},{"content":"Providing error handling in an <ph id=\"ph1\">&lt;xref:System.Activities.AsyncCodeActivity&gt;</ph> involves routing the error through the activity’s callback system.","pos":[174,314],"source":"Providing error handling in an <xref:System.Activities.AsyncCodeActivity> involves routing the error through the activity’s callback system."},{"content":"This topic describes how to get an error that is thrown in an asynchronous operation back to the host, using the SendMail activity sample.","pos":[315,453]},{"pos":[462,532],"content":"Returning an error thrown in an asynchronous activity back to the host","linkify":"Returning an error thrown in an asynchronous activity back to the host","nodes":[{"content":"Returning an error thrown in an asynchronous activity back to the host","pos":[0,70]}]},{"content":"Routing an error in an asynchronous operation back to the host in the SendMail activity sample involves the following steps:","pos":[536,660]},{"pos":[670,731],"content":"Add an Exception property to the <ph id=\"ph1\">`SendMailAsyncResult`</ph> class.","source":"Add an Exception property to the `SendMailAsyncResult` class."},{"pos":[741,817],"content":"Copy the thrown error to that property in the <ph id=\"ph1\">`SendCompleted`</ph> event handler.","source":"Copy the thrown error to that property in the `SendCompleted` event handler."},{"pos":[827,881],"content":"Throw the exception in the <ph id=\"ph1\">`EndExecute`</ph> event handler.","source":"Throw the exception in the `EndExecute` event handler."},{"content":"The resulting code is as follows.","pos":[888,921]}]}