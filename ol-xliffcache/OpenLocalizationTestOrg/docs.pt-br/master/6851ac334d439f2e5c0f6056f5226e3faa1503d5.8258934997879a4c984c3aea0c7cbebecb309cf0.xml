{"content":"---\ntitle: \"Composition Analysis Tool (Mefx)\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"Composition Analysis Tool [MEF]\"\n  - \"MEF, Composition Analysis Tool\"\n  - \"Mefx [MEF], Composition Analysis Tool\"\nms.assetid: c48a7f93-83bb-4a06-aea0-d8e7bd1502ad\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\n---\n# Composition Analysis Tool (Mefx)\nThe Composition Analysis Tool (Mefx) is a command-line application that analyzes library (.dll) and application (.exe) files containing Managed Extensibility Framework (MEF) parts. The primary purpose of Mefx is to provide developers a way to diagnose composition failures in their MEF applications without the requirement to add cumbersome tracing code to the application itself. It can also be useful to help understand parts from a library provided by a third party. This topic describes how to use Mefx and provides a reference for its syntax.  \n  \n<a name=\"getting_mefx\"></a>   \n## Getting Mefx  \n Mefx is available on GitHub at [Managed Extensibility Framework](https://github.com/MicrosoftArchive/mef/releases/tag/4.0). Simply download and unzip the tool.  \n  \n<a name=\"basic_syntax\"></a>   \n## Basic Syntax  \n Mefx is invoked from the command line in the following format:  \n  \n```  \nmefx [files and directories] [action] [options]  \n```  \n  \n The first set of arguments specify the files and directories from which to load parts for analysis. Specify a file with the `/file:` switch, and a directory with the `/directory:` switch. You can specify multiple files or directories, as shown in the following example:  \n  \n```  \nmefx /file:MyAddIn.dll /directory:Program\\AddIns [action...]  \n```  \n  \n> [!NOTE]\n>  Each .dll or .exe should only be loaded one time. If a file is loaded multiple times, the tool may return incorrect information.  \n  \n After the list of files and directories, you must specify a command, and any options for that command.  \n  \n<a name=\"listing_available_parts\"></a>   \n## Listing Available Parts  \n Use the `/parts` action to list all the parts declared in the files loaded. The result is a simple list of part names.  \n  \n```  \nmefx /file:MyAddIn.dll /parts  \nMyAddIn.AddIn  \nMyAddIn.MemberPart  \n```  \n  \n For more information about the parts, use the `/verbose` option. This will output more information for all available parts. To get more information about a single part, use the `/type` action instead of `/parts`.  \n  \n```  \nmefx /file:MyAddIn.dll /type:MyAddIn.AddIn /verbose  \n[Part] MyAddIn.MemberPart from: AssemblyCatalog (Assembly=\" MyAddIn, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\")  \n  [Export] MyAddIn.MemberPart (ContractName=\" MyAddIn.MemberPart\")  \n```  \n  \n<a name=\"listing_imports_and_exports\"></a>   \n## Listing Imports and Exports  \n The `/imports` and `/exports` actions will list all the imported parts and all the exported parts, respectively. You can also list the parts that import or export a particular type by using the `/importers` or `/exporters` actions.  \n  \n```  \nmefx /file:MyAddIn.dll /importers:MyAddin.MemberPart  \nMyAddin.AddIn  \n```  \n  \n You can also apply the `/verbose` option to these actions.  \n  \n<a name=\"finding_rejected_parts\"></a>   \n## Finding Rejected Parts  \n Once it has loaded the available parts, Mefx uses the MEF composition engine to compose them. Parts that cannot be successfully composed are referred to as *rejected*. To list all the rejected parts, use the `/rejected` action.  \n  \n You can use the `/verbose` option with the `/rejected` action to print detailed information about rejected parts. In the following example, the `ClassLibrary1` DLL contains the `AddIn` part, which imports the `MemberPart` and `ChainOne` parts. `ChainOne` imports `ChainTwo`, but `ChainTwo` does not exist. This means that `ChainOne` is rejected, which causes `AddIn` to be rejected.  \n  \n```  \nmefx /file:ClassLibrary1.dll /rejected /verbose  \n```  \n  \n The following shows the complete output of the previous command:  \n  \n```  \n[Part] ClassLibrary1.AddIn from: AssemblyCatalog (Assembly=\"ClassLibrary1, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\")  \n  [Export] ClassLibrary1.AddIn (ContractName=\"ClassLibrary1.AddIn\")  \n  [Import] ClassLibrary1.AddIn.memberPart (ContractName=\"ClassLibrary1.MemberPart\")  \n    [SatisfiedBy] ClassLibrary1.MemberPart (ContractName=\"ClassLibrary1.MemberPart\") from: ClassLibrary1.MemberPart from: AssemblyCatalog (Assembly=\"ClassLibrar  \ny1, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\")  \n  [Import] ClassLibrary1.AddIn.chain (ContractName=\"ClassLibrary1.ChainOne\")  \n    [Exception] System.ComponentModel.Composition.ImportCardinalityMismatchException: No valid exports were found that match the constraint '((exportDefinition.ContractName == \"ClassLibrary1.ChainOne\") AndAlso (exportDefinition.Metadata.ContainsKey(\"ExportTypeIdentity\") AndAlso \"ClassLibrary1.ChainOne\".Equals(exportDefinition.Metadata.get_Item(\"ExportTypeIdentity\"))))', invalid exports may have been rejected.  \n   at System.ComponentModel.Composition.Hosting.ExportProvider.GetExports(ImportDefinition definition, AtomicComposition atomicComposition)  \n   at Microsoft.ComponentModel.Composition.Diagnostics.CompositionInfo.AnalyzeImportDefinition(ExportProvider host, IEnumerable`1 availableParts, ImportDefinition id)  \n    [Unsuitable] ClassLibrary1.ChainOne (ContractName=\"ClassLibrary1.ChainOne\")  \nfrom: ClassLibrary1.ChainOne from: AssemblyCatalog (Assembly=\"ClassLibrary1, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\")  \n      [Because] PartDefinitionIsRejected, The part providing the export is rejected because of other issues.  \n  \n[Part] ClassLibrary1.ChainOne from: AssemblyCatalog (Assembly=\"ClassLibrary1, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null\")  \n  [Primary Rejection]  \n  [Export] ClassLibrary1.ChainOne (ContractName=\"ClassLibrary1.ChainOne\")  \n  [Import] ClassLibrary1.ChainOne.chain (ContractName=\"ClassLibrary1.ChainTwo\")  \n    [Exception] System.ComponentModel.Composition.ImportCardinalityMismatchException: No valid exports were found that match the constraint '((exportDefinition.ContractName == \"ClassLibrary1.ChainTwo\") AndAlso (exportDefinition.Metadata.ContainsKey(\"ExportTypeIdentity\") AndAlso \"ClassLibrary1.ChainTwo\".Equals(exportDefinition.Metadata.get_Item(\"ExportTypeIdentity\"))))', invalid exports may have been rejected.  \n   at System.ComponentModel.Composition.Hosting.ExportProvider.GetExports(ImportDefinition definition, AtomicComposition atomicComposition)  \n   at Microsoft.ComponentModel.Composition.Diagnostics.CompositionInfo.AnalyzeImportDefinition(ExportProvider host, IEnumerable`1 availableParts, ImportDefinition id)  \n```  \n  \n The interesting information is contained in the `[Exception]` and `[Unsuitable]` results. The `[Exception]` result provides information about why a part was rejected. The `[Unsuitable]` result indicates why an otherwise-matching part could not be used to fill an import; in this case, because that part was itself rejected for missing imports.  \n  \n<a name=\"analyzing_primary_causes\"></a>   \n## Analyzing Primary Causes  \n If several parts are linked in a long dependency chain, a problem involving a part near the bottom may cause the entire chain to be rejected. Diagnosing these problems can be difficult because the root cause of the failure is not always obvious. To help with the problem, you can use the `/causes` action, which attempts to find the root cause of any cascading rejection.  \n  \n Using the `/causes` action on the previous example would list only information for `ChainOne`, whose unfilled import is the root cause of the rejection of `AddIn`. The `/causes` action can be used in both normal and `/verbose` options.  \n  \n> [!NOTE]\n>  In most cases, Mefx will be able to diagnose the root cause of a cascading failure. However, in cases where parts are added programmatically to a container, cases involving hierarchical containers, or cases involving custom `ExportProvider` implementations, Mefx will not be able to diagnose the cause. In general, the previously described cases should be avoided where possible, as failures are generally difficult to diagnose.  \n  \n<a name=\"white_lists\"></a>   \n## White Lists  \n The `/whitelist` option enables you to specify a text file that lists parts that are expected to be rejected. Unexpected rejections will then be flagged. This can be useful when you analyze an incomplete library, or a sub-library that is missing some dependencies. The `/whitelist` option can be applied to the `/rejected` or `/causes` actions.  \n  \n Consider a file named test.txt that contains the text \"ClassLibrary1.ChainOne\". If you run the `/rejected` action with the `/whitelist` option on the previous example, it will produce the following output:  \n  \n```  \nmefx /file:ClassLibrary1.dll /rejected /whitelist:test.txt  \n[Unexpected] ClassLibrary1.AddIn  \nClassLibrary1.ChainOne  \n```\n","nodes":[{"pos":[4,297],"embed":true,"restype":"x-metadata","content":"title: \"Composition Analysis Tool (Mefx)\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"Composition Analysis Tool [MEF]\"\n  - \"MEF, Composition Analysis Tool\"\n  - \"Mefx [MEF], Composition Analysis Tool\"\nms.assetid: c48a7f93-83bb-4a06-aea0-d8e7bd1502ad\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"","nodes":[{"content":"Composition Analysis Tool (Mefx)","nodes":[{"pos":[0,32],"content":"Composition Analysis Tool (Mefx)","nodes":[{"content":"Composition Analysis Tool (Mefx)","pos":[0,32]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[304,336],"content":"Composition Analysis Tool (Mefx)","linkify":"Composition Analysis Tool (Mefx)","nodes":[{"content":"Composition Analysis Tool (Mefx)","pos":[0,32]}]},{"content":"The Composition Analysis Tool (Mefx) is a command-line application that analyzes library (.dll) and application (.exe) files containing Managed Extensibility Framework (MEF) parts.","pos":[337,517]},{"content":"The primary purpose of Mefx is to provide developers a way to diagnose composition failures in their MEF applications without the requirement to add cumbersome tracing code to the application itself.","pos":[518,717]},{"content":"It can also be useful to help understand parts from a library provided by a third party.","pos":[718,806]},{"content":"This topic describes how to use Mefx and provides a reference for its syntax.","pos":[807,884]},{"pos":[924,936],"content":"Getting Mefx","linkify":"Getting Mefx","nodes":[{"content":"Getting Mefx","pos":[0,12]}]},{"content":"Mefx is available on GitHub at <bpt id=\"p1\">[</bpt>Managed Extensibility Framework<ept id=\"p1\">](https://github.com/MicrosoftArchive/mef/releases/tag/4.0)</ept>.","pos":[940,1063],"source":"Mefx is available on GitHub at [Managed Extensibility Framework](https://github.com/MicrosoftArchive/mef/releases/tag/4.0)."},{"content":"Simply download and unzip the tool.","pos":[1064,1099]},{"pos":[1139,1151],"content":"Basic Syntax","linkify":"Basic Syntax","nodes":[{"content":"Basic Syntax","pos":[0,12]}]},{"content":"Mefx is invoked from the command line in the following format:","pos":[1155,1217]},{"content":"The first set of arguments specify the files and directories from which to load parts for analysis.","pos":[1289,1388]},{"content":"Specify a file with the <ph id=\"ph1\">`/file:`</ph> switch, and a directory with the <ph id=\"ph2\">`/directory:`</ph> switch.","pos":[1389,1476],"source":" Specify a file with the `/file:` switch, and a directory with the `/directory:` switch."},{"content":"You can specify multiple files or directories, as shown in the following example:","pos":[1477,1558]},{"pos":[1644,1783],"content":"[!NOTE]\n Each .dll or .exe should only be loaded one time. If a file is loaded multiple times, the tool may return incorrect information.","leadings":["","> "],"nodes":[{"content":"Each .dll or .exe should only be loaded one time. If a file is loaded multiple times, the tool may return incorrect information.","pos":[9,137],"nodes":[{"content":"Each .dll or .exe should only be loaded one time.","pos":[0,49]},{"content":"If a file is loaded multiple times, the tool may return incorrect information.","pos":[50,128]}]}]},{"content":"After the list of files and directories, you must specify a command, and any options for that command.","pos":[1790,1892]},{"pos":[1943,1966],"content":"Listing Available Parts","linkify":"Listing Available Parts","nodes":[{"content":"Listing Available Parts","pos":[0,23]}]},{"content":"Use the <ph id=\"ph1\">`/parts`</ph> action to list all the parts declared in the files loaded.","pos":[1970,2045],"source":"Use the `/parts` action to list all the parts declared in the files loaded."},{"content":"The result is a simple list of part names.","pos":[2046,2088]},{"content":"For more information about the parts, use the <ph id=\"ph1\">`/verbose`</ph> option.","pos":[2179,2243],"source":"For more information about the parts, use the `/verbose` option."},{"content":"This will output more information for all available parts.","pos":[2244,2302]},{"content":"To get more information about a single part, use the <ph id=\"ph1\">`/type`</ph> action instead of <ph id=\"ph2\">`/parts`</ph>.","pos":[2303,2391],"source":" To get more information about a single part, use the `/type` action instead of `/parts`."},{"pos":[2711,2738],"content":"Listing Imports and Exports","linkify":"Listing Imports and Exports","nodes":[{"content":"Listing Imports and Exports","pos":[0,27]}]},{"content":"The <ph id=\"ph1\">`/imports`</ph> and <ph id=\"ph2\">`/exports`</ph> actions will list all the imported parts and all the exported parts, respectively.","pos":[2742,2854],"source":"The `/imports` and `/exports` actions will list all the imported parts and all the exported parts, respectively."},{"content":"You can also list the parts that import or export a particular type by using the <ph id=\"ph1\">`/importers`</ph> or <ph id=\"ph2\">`/exporters`</ph> actions.","pos":[2855,2973],"source":" You can also list the parts that import or export a particular type by using the `/importers` or `/exporters` actions."},{"pos":[3066,3124],"content":"You can also apply the <ph id=\"ph1\">`/verbose`</ph> option to these actions.","source":"You can also apply the `/verbose` option to these actions."},{"pos":[3174,3196],"content":"Finding Rejected Parts","linkify":"Finding Rejected Parts","nodes":[{"content":"Finding Rejected Parts","pos":[0,22]}]},{"content":"Once it has loaded the available parts, Mefx uses the MEF composition engine to compose them.","pos":[3200,3293]},{"content":"Parts that cannot be successfully composed are referred to as <bpt id=\"p1\">*</bpt>rejected<ept id=\"p1\">*</ept>.","pos":[3294,3367],"source":" Parts that cannot be successfully composed are referred to as *rejected*."},{"content":"To list all the rejected parts, use the <ph id=\"ph1\">`/rejected`</ph> action.","pos":[3368,3427],"source":" To list all the rejected parts, use the `/rejected` action."},{"content":"You can use the <ph id=\"ph1\">`/verbose`</ph> option with the <ph id=\"ph2\">`/rejected`</ph> action to print detailed information about rejected parts.","pos":[3434,3547],"source":"You can use the `/verbose` option with the `/rejected` action to print detailed information about rejected parts."},{"content":"In the following example, the <ph id=\"ph1\">`ClassLibrary1`</ph> DLL contains the <ph id=\"ph2\">`AddIn`</ph> part, which imports the <ph id=\"ph3\">`MemberPart`</ph> and <ph id=\"ph4\">`ChainOne`</ph> parts.","pos":[3548,3677],"source":" In the following example, the `ClassLibrary1` DLL contains the `AddIn` part, which imports the `MemberPart` and `ChainOne` parts."},{"content":"<ph id=\"ph1\">`ChainOne`</ph> imports <ph id=\"ph2\">`ChainTwo`</ph>, but <ph id=\"ph3\">`ChainTwo`</ph> does not exist.","pos":[3678,3739],"source":"`ChainOne` imports `ChainTwo`, but `ChainTwo` does not exist."},{"content":"This means that <ph id=\"ph1\">`ChainOne`</ph> is rejected, which causes <ph id=\"ph2\">`AddIn`</ph> to be rejected.","pos":[3740,3816],"source":" This means that `ChainOne` is rejected, which causes `AddIn` to be rejected."},{"content":"The following shows the complete output of the previous command:","pos":[3888,3952]},{"content":"The interesting information is contained in the <ph id=\"ph1\">`[Exception]`</ph> and <ph id=\"ph2\">`[Unsuitable]`</ph> results.","pos":[6668,6757],"source":"The interesting information is contained in the `[Exception]` and `[Unsuitable]` results."},{"content":"The <ph id=\"ph1\">`[Exception]`</ph> result provides information about why a part was rejected.","pos":[6758,6834],"source":" The `[Exception]` result provides information about why a part was rejected."},{"content":"The <ph id=\"ph1\">`[Unsuitable]`</ph> result indicates why an otherwise-matching part could not be used to fill an import; in this case, because that part was itself rejected for missing imports.","pos":[6835,7011],"source":" The `[Unsuitable]` result indicates why an otherwise-matching part could not be used to fill an import; in this case, because that part was itself rejected for missing imports."},{"pos":[7063,7087],"content":"Analyzing Primary Causes","linkify":"Analyzing Primary Causes","nodes":[{"content":"Analyzing Primary Causes","pos":[0,24]}]},{"content":"If several parts are linked in a long dependency chain, a problem involving a part near the bottom may cause the entire chain to be rejected.","pos":[7091,7232]},{"content":"Diagnosing these problems can be difficult because the root cause of the failure is not always obvious.","pos":[7233,7336]},{"content":"To help with the problem, you can use the <ph id=\"ph1\">`/causes`</ph> action, which attempts to find the root cause of any cascading rejection.","pos":[7337,7462],"source":" To help with the problem, you can use the `/causes` action, which attempts to find the root cause of any cascading rejection."},{"content":"Using the <ph id=\"ph1\">`/causes`</ph> action on the previous example would list only information for <ph id=\"ph2\">`ChainOne`</ph>, whose unfilled import is the root cause of the rejection of <ph id=\"ph3\">`AddIn`</ph>.","pos":[7469,7632],"source":"Using the `/causes` action on the previous example would list only information for `ChainOne`, whose unfilled import is the root cause of the rejection of `AddIn`."},{"content":"The <ph id=\"ph1\">`/causes`</ph> action can be used in both normal and <ph id=\"ph2\">`/verbose`</ph> options.","pos":[7633,7704],"source":" The `/causes` action can be used in both normal and `/verbose` options."},{"pos":[7712,8151],"content":"[!NOTE]\n In most cases, Mefx will be able to diagnose the root cause of a cascading failure. However, in cases where parts are added programmatically to a container, cases involving hierarchical containers, or cases involving custom `ExportProvider` implementations, Mefx will not be able to diagnose the cause. In general, the previously described cases should be avoided where possible, as failures are generally difficult to diagnose.","leadings":["","> "],"nodes":[{"content":"In most cases, Mefx will be able to diagnose the root cause of a cascading failure. However, in cases where parts are added programmatically to a container, cases involving hierarchical containers, or cases involving custom `ExportProvider` implementations, Mefx will not be able to diagnose the cause. In general, the previously described cases should be avoided where possible, as failures are generally difficult to diagnose.","pos":[9,437],"nodes":[{"content":"In most cases, Mefx will be able to diagnose the root cause of a cascading failure.","pos":[0,83]},{"content":"However, in cases where parts are added programmatically to a container, cases involving hierarchical containers, or cases involving custom <ph id=\"ph1\">`ExportProvider`</ph> implementations, Mefx will not be able to diagnose the cause.","pos":[84,302],"source":" However, in cases where parts are added programmatically to a container, cases involving hierarchical containers, or cases involving custom `ExportProvider` implementations, Mefx will not be able to diagnose the cause."},{"content":"In general, the previously described cases should be avoided where possible, as failures are generally difficult to diagnose.","pos":[303,428]}]}]},{"pos":[8190,8201],"content":"White Lists","linkify":"White Lists","nodes":[{"content":"White Lists","pos":[0,11]}]},{"content":"The <ph id=\"ph1\">`/whitelist`</ph> option enables you to specify a text file that lists parts that are expected to be rejected.","pos":[8205,8314],"source":"The `/whitelist` option enables you to specify a text file that lists parts that are expected to be rejected."},{"content":"Unexpected rejections will then be flagged.","pos":[8315,8358]},{"content":"This can be useful when you analyze an incomplete library, or a sub-library that is missing some dependencies.","pos":[8359,8469]},{"content":"The <ph id=\"ph1\">`/whitelist`</ph> option can be applied to the <ph id=\"ph2\">`/rejected`</ph> or <ph id=\"ph3\">`/causes`</ph> actions.","pos":[8470,8549],"source":" The `/whitelist` option can be applied to the `/rejected` or `/causes` actions."},{"content":"Consider a file named test.txt that contains the text \"ClassLibrary1.ChainOne\".","pos":[8556,8635]},{"content":"If you run the <ph id=\"ph1\">`/rejected`</ph> action with the <ph id=\"ph2\">`/whitelist`</ph> option on the previous example, it will produce the following output:","pos":[8636,8761],"source":" If you run the `/rejected` action with the `/whitelist` option on the previous example, it will produce the following output:"}]}