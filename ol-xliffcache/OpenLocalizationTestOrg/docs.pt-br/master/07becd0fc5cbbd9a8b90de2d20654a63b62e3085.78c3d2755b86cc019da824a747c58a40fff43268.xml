{"content":"---\ntitle: \"WS 2007 Federation HTTP Binding\"\nms.date: \"03/30/2017\"\nms.assetid: 91c1b477-a96e-4bf5-9330-5e9312113371\n---\n# WS 2007 Federation HTTP Binding\nThis sample demonstrates the use of <xref:System.ServiceModel.WS2007FederationHttpBinding>, a standard binding that you can use to build federated scenarios that support version 1.3 of the WS-Trust specification.  \n  \n> [!NOTE]\n>  The setup procedure and build instructions for this sample are located at the end of this topic.  \n  \n The sample consists of a console-based client program (Client.exe), a console-based security token service program (Securitytokenservice.exe), and a console-based service program (Service.exe). The service implements a contract that defines a request/reply communication pattern. The contract is defined by the `ICalculator` interface, which exposes math operations (`Add`, `Subtract`, `Multiply`, and `Divide`). The client obtains a security token from the Security Token Service (STS) and makes synchronous requests to the service for a given math operation. The service then replies with the result. Client activity is visible in the console window.  \n  \n The sample makes the `ICalculator` contract available using the `ws2007FederationHttpBinding` element. The configuration of this binding on the client is shown in the following code.  \n  \n```xml  \n<bindings>  \n  <ws2007FederationHttpBinding>  \n    <binding name=\"ServiceFed\" >  \n      <security mode =\"Message\">  \n        <message issuedKeyType =\"SymmetricKey\"  \n                 issuedTokenType =\"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1\" >  \n          <!-- Endpoint address and binding for Security Token Service -->  \n          <issuer address =\"http://localhost:8000/sts/windows\"   \n                  binding =\"ws2007HttpBinding\" />                \n        </message>  \n      </security>  \n    </binding>  \n  </ws2007FederationHttpBinding>  \n</bindings>  \n```  \n  \n On the [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-element-of-ws2007federationhttpbinding.md), the `security` value specifies which security mode should be used. In this sample, `message` security is used, which is why the [\\<message>](../../../../docs/framework/configure-apps/file-schema/wcf/message-element-of-ws2007federationhttpbinding.md) is specified inside the [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-element-of-ws2007federationhttpbinding.md). The [\\<issuer>](../../../../docs/framework/configure-apps/file-schema/wcf/issuer.md) element inside the [\\<message>](../../../../docs/framework/configure-apps/file-schema/wcf/message-element-of-ws2007federationhttpbinding.md) specifies the address and binding for the STS that issues a security token to the client so that the client can authenticate to the `ICalculator` service.  \n  \n The configuration of this binding on the service is shown in the following code.  \n  \n```xml  \n<bindings>  \n  <ws2007FederationHttpBinding>  \n    <binding name=\"ServiceFed\" >  \n      <security mode =\"Message\">  \n        <message issuedKeyType =\"SymmetricKey\"  \n                 issuedTokenType =\"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1\" >  \n          <!-- Metadata address for Security Token Service -->  \n          <issuerMetadata address =\"http://localhost:8000/sts/mex\" >  \n            <identity>  \n              <certificateReference storeLocation =\"CurrentUser\"   \n                                    storeName=\"TrustedPeople\"   \n                                    x509FindType =\"FindBySubjectDistinguishedName\"   \n                                    findValue =\"CN=STS\" />  \n            </identity>  \n          </issuerMetadata>  \n        </message>  \n      </security>  \n    </binding>  \n  </ws2007FederationHttpBinding>  \n</bindings>  \n```  \n  \n On the [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-element-of-ws2007federationhttpbinding.md), the `security` value specifies which security mode should be used. In this sample, `message` security is used, which is why the [\\<message>](../../../../docs/framework/configure-apps/file-schema/wcf/message-element-of-ws2007federationhttpbinding.md) is specified inside the [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-element-of-ws2007federationhttpbinding.md). The [\\<issuerMetadata>](../../../../docs/framework/configure-apps/file-schema/wcf/issuermetadata.md) element of `ws2007FederationHttpBinding` inside the [\\<message>](../../../../docs/framework/configure-apps/file-schema/wcf/message-element-of-ws2007federationhttpbinding.md) specifies the address and identity for an endpoint that can be used to retrieve metadata for the STS.  \n  \n The behavior for the service is shown in the following code.  \n  \n```xml  \n<behaviors>  \n  <serviceBehaviors>  \n    <behavior name =\"ServiceBehaviour\" >  \n      <serviceDebug includeExceptionDetailInFaults =\"true\"/>  \n      <serviceMetadata httpGetEnabled =\"true\"/>  \n      <serviceCredentials>  \n        <issuedTokenAuthentication>  \n          <knownCertificates>  \n            <add storeLocation =\"LocalMachine\"  \n                 storeName=\"TrustedPeople\"  \n                 x509FindType=\"FindBySubjectDistinguishedName\"  \n                 findValue=\"CN=STS\" />  \n          </knownCertificates>  \n        </issuedTokenAuthentication>  \n        <serviceCertificate storeLocation =\"LocalMachine\"  \n                            storeName =\"My\"  \n                            x509FindType =\"FindBySubjectDistinguishedName\"  \n                            findValue =\"CN=localhost\"/>  \n      </serviceCredentials>  \n    </behavior>  \n  </serviceBehaviors>  \n</behaviors>  \n```  \n  \n The [\\<issuedTokenAuthentication>](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtokenauthentication-of-servicecredentials.md)> allows the service to specify constraints on the tokens it allows clients to present during authentication. This configuration specifies that tokens signed by a certificate whose subject name is CN=STS are accepted by the service.  \n  \n STS makes a single endpoint available using the standard <xref:System.ServiceModel.WS2007HttpBinding>. The service responds to requests from clients for tokens. If the client is authenticated using a Windows account, the service issues a token that contains the client's user name as a claim. As part of creating the token, STS signs the token using the private key associated with the CN=STS certificate. In addition, it creates a symmetric key and encrypts it using the public key associated with the CN=localhost certificate. In returning the token to the client, STS also returns the symmetric key. The client presents the issued token to the `ICalculator` service and proves that it knows the symmetric key by signing the message with that key.  \n  \n When you run the sample, the request for the security token is shown in the STS console window. The operation's requests and responses are displayed in the client and service console windows. Press ENTER in any of the console windows to shut down the application.  \n\n```\nAdd(100,15.99) = 115.99\nSubtract(145,76.54) = 68.46\nMultiply(9,81.25) = 731.25\nDivide(22,7) = 3.14285714285714\nPress <ENTER> to terminate client.\n```\n\n The Setup.bat file included with this sample allows you to configure the server and STS with the relevant certificates to run a self-hosted application. The batch file creates two certificates in the LocalMachine/TrustedPeople certificate store. The first certificate has a subject name of CN=STS and is used by STS to sign the security tokens that it issues to the client. The second certificate has a subject name of CN=localhost and is used by STS to encrypt a key in a way that the service can decrypt.  \n  \n### To set up, build, and run the sample  \n  \n1.  Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).  \n  \n2.  Open a Developer Command Prompt for Visual Studio with administrator privileges and run the Setup.bat file to create the required certificates.  \n  \n This batch file uses Certmgr.exe and Makecert.exe, which are distributed with the Windows SDK. However, you must run Setup.bat from within a Visual Studio  command prompt to enable the script to find these tools.  \n  \n1.  To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).  \n  \n2.  To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md). If you are using [!INCLUDE[windowsver](../../../../includes/windowsver-md.md)], you must run Service.exe, Client.exe, and SecurityTokenService.exe with elevated privileges (right-click the files and then click **Run as administrator**).  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your computer. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Binding\\WS\\WS2007FederationHttp`  \n","nodes":[{"pos":[4,115],"embed":true,"restype":"x-metadata","content":"title: \"WS 2007 Federation HTTP Binding\"\nms.date: \"03/30/2017\"\nms.assetid: 91c1b477-a96e-4bf5-9330-5e9312113371","nodes":[{"content":"WS 2007 Federation HTTP Binding","nodes":[{"pos":[0,31],"content":"WS 2007 Federation HTTP Binding","nodes":[{"content":"WS 2007 Federation HTTP Binding","pos":[0,31]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[122,153],"content":"WS 2007 Federation HTTP Binding","linkify":"WS 2007 Federation HTTP Binding","nodes":[{"content":"WS 2007 Federation HTTP Binding","pos":[0,31]}]},{"pos":[154,366],"content":"This sample demonstrates the use of <ph id=\"ph1\">&lt;xref:System.ServiceModel.WS2007FederationHttpBinding&gt;</ph>, a standard binding that you can use to build federated scenarios that support version 1.3 of the WS-Trust specification.","source":"This sample demonstrates the use of <xref:System.ServiceModel.WS2007FederationHttpBinding>, a standard binding that you can use to build federated scenarios that support version 1.3 of the WS-Trust specification."},{"pos":[374,481],"content":"[!NOTE]\n The setup procedure and build instructions for this sample are located at the end of this topic.","leadings":["","> "],"nodes":[{"content":"The setup procedure and build instructions for this sample are located at the end of this topic.","pos":[9,105]}]},{"content":"The sample consists of a console-based client program (Client.exe), a console-based security token service program (Securitytokenservice.exe), and a console-based service program (Service.exe).","pos":[488,681]},{"content":"The service implements a contract that defines a request/reply communication pattern.","pos":[682,767]},{"content":"The contract is defined by the <ph id=\"ph1\">`ICalculator`</ph> interface, which exposes math operations (<ph id=\"ph2\">`Add`</ph>, <ph id=\"ph3\">`Subtract`</ph>, <ph id=\"ph4\">`Multiply`</ph>, and <ph id=\"ph5\">`Divide`</ph>).","pos":[768,900],"source":" The contract is defined by the `ICalculator` interface, which exposes math operations (`Add`, `Subtract`, `Multiply`, and `Divide`)."},{"content":"The client obtains a security token from the Security Token Service (STS) and makes synchronous requests to the service for a given math operation.","pos":[901,1048]},{"content":"The service then replies with the result.","pos":[1049,1090]},{"content":"Client activity is visible in the console window.","pos":[1091,1140]},{"content":"The sample makes the <ph id=\"ph1\">`ICalculator`</ph> contract available using the <ph id=\"ph2\">`ws2007FederationHttpBinding`</ph> element.","pos":[1147,1249],"source":"The sample makes the `ICalculator` contract available using the `ws2007FederationHttpBinding` element."},{"content":"The configuration of this binding on the client is shown in the following code.","pos":[1250,1329]},{"content":"On the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>security&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/security-element-of-ws2007federationhttpbinding.md)</ept>, the <ph id=\"ph2\">`security`</ph> value specifies which security mode should be used.","pos":[1949,2147],"source":"On the [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-element-of-ws2007federationhttpbinding.md), the `security` value specifies which security mode should be used."},{"content":"In this sample, <ph id=\"ph1\">`message`</ph> security is used, which is why the <bpt id=\"p1\">[</bpt><ph id=\"ph2\">\\&lt;</ph>message&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/message-element-of-ws2007federationhttpbinding.md)</ept> is specified inside the <bpt id=\"p2\">[</bpt><ph id=\"ph3\">\\&lt;</ph>security&gt;<ept id=\"p2\">](../../../../docs/framework/configure-apps/file-schema/wcf/security-element-of-ws2007federationhttpbinding.md)</ept>.","pos":[2148,2479],"source":" In this sample, `message` security is used, which is why the [\\<message>](../../../../docs/framework/configure-apps/file-schema/wcf/message-element-of-ws2007federationhttpbinding.md) is specified inside the [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-element-of-ws2007federationhttpbinding.md)."},{"content":"The <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>issuer&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/issuer.md)</ept> element inside the <bpt id=\"p2\">[</bpt><ph id=\"ph2\">\\&lt;</ph>message&gt;<ept id=\"p2\">](../../../../docs/framework/configure-apps/file-schema/wcf/message-element-of-ws2007federationhttpbinding.md)</ept> specifies the address and binding for the STS that issues a security token to the client so that the client can authenticate to the <ph id=\"ph3\">`ICalculator`</ph> service.","pos":[2480,2860],"source":" The [\\<issuer>](../../../../docs/framework/configure-apps/file-schema/wcf/issuer.md) element inside the [\\<message>](../../../../docs/framework/configure-apps/file-schema/wcf/message-element-of-ws2007federationhttpbinding.md) specifies the address and binding for the STS that issues a security token to the client so that the client can authenticate to the `ICalculator` service."},{"content":"The configuration of this binding on the service is shown in the following code.","pos":[2867,2947]},{"content":"On the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>security&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/security-element-of-ws2007federationhttpbinding.md)</ept>, the <ph id=\"ph2\">`security`</ph> value specifies which security mode should be used.","pos":[3855,4053],"source":"On the [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-element-of-ws2007federationhttpbinding.md), the `security` value specifies which security mode should be used."},{"content":"In this sample, <ph id=\"ph1\">`message`</ph> security is used, which is why the <bpt id=\"p1\">[</bpt><ph id=\"ph2\">\\&lt;</ph>message&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/message-element-of-ws2007federationhttpbinding.md)</ept> is specified inside the <bpt id=\"p2\">[</bpt><ph id=\"ph3\">\\&lt;</ph>security&gt;<ept id=\"p2\">](../../../../docs/framework/configure-apps/file-schema/wcf/security-element-of-ws2007federationhttpbinding.md)</ept>.","pos":[4054,4385],"source":" In this sample, `message` security is used, which is why the [\\<message>](../../../../docs/framework/configure-apps/file-schema/wcf/message-element-of-ws2007federationhttpbinding.md) is specified inside the [\\<security>](../../../../docs/framework/configure-apps/file-schema/wcf/security-element-of-ws2007federationhttpbinding.md)."},{"content":"The <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>issuerMetadata&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/issuermetadata.md)</ept> element of <ph id=\"ph2\">`ws2007FederationHttpBinding`</ph> inside the <bpt id=\"p2\">[</bpt><ph id=\"ph3\">\\&lt;</ph>message&gt;<ept id=\"p2\">](../../../../docs/framework/configure-apps/file-schema/wcf/message-element-of-ws2007federationhttpbinding.md)</ept> specifies the address and identity for an endpoint that can be used to retrieve metadata for the STS.","pos":[4386,4762],"source":" The [\\<issuerMetadata>](../../../../docs/framework/configure-apps/file-schema/wcf/issuermetadata.md) element of `ws2007FederationHttpBinding` inside the [\\<message>](../../../../docs/framework/configure-apps/file-schema/wcf/message-element-of-ws2007federationhttpbinding.md) specifies the address and identity for an endpoint that can be used to retrieve metadata for the STS."},{"content":"The behavior for the service is shown in the following code.","pos":[4769,4829]},{"content":"The <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>issuedTokenAuthentication&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtokenauthentication-of-servicecredentials.md)</ept>&gt; allows the service to specify constraints on the tokens it allows clients to present during authentication.","pos":[5746,5999],"source":"The [\\<issuedTokenAuthentication>](../../../../docs/framework/configure-apps/file-schema/wcf/issuedtokenauthentication-of-servicecredentials.md)> allows the service to specify constraints on the tokens it allows clients to present during authentication."},{"content":"This configuration specifies that tokens signed by a certificate whose subject name is CN=STS are accepted by the service.","pos":[6000,6122]},{"content":"STS makes a single endpoint available using the standard <ph id=\"ph1\">&lt;xref:System.ServiceModel.WS2007HttpBinding&gt;</ph>.","pos":[6129,6231],"source":"STS makes a single endpoint available using the standard <xref:System.ServiceModel.WS2007HttpBinding>."},{"content":"The service responds to requests from clients for tokens.","pos":[6232,6289]},{"content":"If the client is authenticated using a Windows account, the service issues a token that contains the client's user name as a claim.","pos":[6290,6421]},{"content":"As part of creating the token, STS signs the token using the private key associated with the CN=STS certificate.","pos":[6422,6534]},{"content":"In addition, it creates a symmetric key and encrypts it using the public key associated with the CN=localhost certificate.","pos":[6535,6657]},{"content":"In returning the token to the client, STS also returns the symmetric key.","pos":[6658,6731]},{"content":"The client presents the issued token to the <ph id=\"ph1\">`ICalculator`</ph> service and proves that it knows the symmetric key by signing the message with that key.","pos":[6732,6878],"source":" The client presents the issued token to the `ICalculator` service and proves that it knows the symmetric key by signing the message with that key."},{"content":"When you run the sample, the request for the security token is shown in the STS console window.","pos":[6885,6980]},{"content":"The operation's requests and responses are displayed in the client and service console windows.","pos":[6981,7076]},{"content":"Press ENTER in any of the console windows to shut down the application.","pos":[7077,7148]},{"content":"The Setup.bat file included with this sample allows you to configure the server and STS with the relevant certificates to run a self-hosted application.","pos":[7308,7460]},{"content":"The batch file creates two certificates in the LocalMachine/TrustedPeople certificate store.","pos":[7461,7553]},{"content":"The first certificate has a subject name of CN=STS and is used by STS to sign the security tokens that it issues to the client.","pos":[7554,7681]},{"content":"The second certificate has a subject name of CN=localhost and is used by STS to encrypt a key in a way that the service can decrypt.","pos":[7682,7814]},{"pos":[7824,7860],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[7870,8069],"content":"Ensure that you have performed the <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"content":"Open a Developer Command Prompt for Visual Studio with administrator privileges and run the Setup.bat file to create the required certificates.","pos":[8079,8222]},{"content":"This batch file uses Certmgr.exe and Makecert.exe, which are distributed with the Windows SDK.","pos":[8229,8323]},{"content":"However, you must run Setup.bat from within a Visual Studio  command prompt to enable the script to find these tools.","pos":[8324,8441]},{"pos":[8451,8660],"content":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"content":"To run the sample in a single- or cross-computer configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","pos":[8670,8879],"source":"To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"content":"If you are using <ph id=\"ph1\">[!INCLUDE[windowsver](../../../../includes/windowsver-md.md)]</ph>, you must run Service.exe, Client.exe, and SecurityTokenService.exe with elevated privileges (right-click the files and then click <bpt id=\"p1\">**</bpt>Run as administrator<ept id=\"p1\">**</ept>).","pos":[8880,9116],"source":" If you are using [!INCLUDE[windowsver](../../../../includes/windowsver-md.md)], you must run Service.exe, Client.exe, and SecurityTokenService.exe with elevated privileges (right-click the files and then click **Run as administrator**)."},{"pos":[9124,9257],"content":"[!IMPORTANT]\n The samples may already be installed on your computer. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your computer. Check for the following (default) directory before continuing.","pos":[14,131],"nodes":[{"content":"The samples may already be installed on your computer.","pos":[0,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[9311,9621],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[9622,9672]}]}