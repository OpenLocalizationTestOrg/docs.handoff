{"content":"---\ntitle: \"Custom Message Encoder: Custom Text Encoder - WCF\"\nms.date: \"03/30/2017\"\nms.assetid: 68ff5c74-3d33-4b44-bcae-e1d2f5dea0de\n---\n# Custom Message Encoder: Custom Text Encoder\n\nThis sample demonstrates how to implement a custom text message encoder using Windows Communication Foundation (WCF).\n\n> [!WARNING]\n> The samples may already be installed on your machine. Check for the following (default) directory before continuing.\n> \n> `<InstallDrive>:\\WF_WCF_Samples`\n> \n> If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.\n> \n> `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Extensibility\\MessageEncoder\\Text`\n\nThe <xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement> of WCF supports only the UTF-8, UTF-16 and big-endian Unicode encodings. The custom text message encoder in this sample supports all platform-supported character encodings that may be required for interoperability. The sample consists of a client console program (.exe), a service library (.dll) hosted by Internet Information Services (IIS), and a text message encoder library (.dll). The service implements a contract that defines a request-reply communication pattern. The contract is defined by the `ICalculator` interface, which exposes math operations (Add, Subtract, Multiply, and Divide). The client makes synchronous requests to a given math operation and the service replies with the result. Both client and service uses the `CustomTextMessageEncoder` instead of the default <xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement>.\n\nThe custom encoder implementation consists of a message encoder factory, a message encoder, a message encoding binding element and a configuration handler, and demonstrates the following:\n\n- Building a custom encoder and encoder factory.\n\n- Creating a binding element for a custom encoder.\n\n- Using the custom binding configuration for integrating custom binding elements.\n\n- Developing a custom configuration handler to allow file configuration of a custom binding element.\n\n## To set up, build, and run the sample\n\n1.  Install [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] 4.0 using the following command.\n\n    ```\n    %windir%\\Microsoft.NET\\Framework\\v4.0.XXXXX\\aspnet_regiis.exe /i /enable\n    ```\n\n2.  Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).\n\n3.  To build the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).\n\n4.  To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).\n\n## Message Encoder Factory and the Message Encoder\n\nWhen the <xref:System.ServiceModel.ServiceHost> or the client channel is opened, the design time component `CustomTextMessageBindingElement` creates the `CustomTextMessageEncoderFactory`. The factory creates the `CustomTextMessageEncoder`. The message encoder operates both in the streaming mode and the buffered mode. It uses the <xref:System.Xml.XmlReader> and <xref:System.Xml.XmlWriter> to read and write the messages respectively. As opposed to the optimized XML readers and writers of WCF that support only UTF-8, UTF-16 and big-endian Unicode, these readers and writers support all platform-supported encoding.\n\nThe following code example shows the CustomTextMessageEncoder.\n\n```csharp\npublic class CustomTextMessageEncoder : MessageEncoder\n{\n    private CustomTextMessageEncoderFactory factory;\n    private XmlWriterSettings writerSettings;\n    private string contentType;\n\n    public CustomTextMessageEncoder(CustomTextMessageEncoderFactory factory)\n    {\n        this.factory = factory;\n\n        this.writerSettings = new XmlWriterSettings();\n        this.writerSettings.Encoding = Encoding.GetEncoding(factory.CharSet);\n        this.contentType = $\"{this.factory.MediaType}; charset={this.writerSettings.Encoding.HeaderName}\";\n    }\n\n    public override string ContentType\n    {\n        get\n        {\n            return this.contentType;\n        }\n    }\n\n    public override string MediaType\n    {\n        get \n        {\n            return factory.MediaType;\n        }\n    }\n\n    public override MessageVersion MessageVersion\n    {\n        get \n        {\n            return this.factory.MessageVersion;\n        }\n    }\n\n    public override Message ReadMessage(ArraySegment<byte> buffer, BufferManager bufferManager, string contentType)\n    {   \n        byte[] msgContents = new byte[buffer.Count];\n        Array.Copy(buffer.Array, buffer.Offset, msgContents, 0, msgContents.Length);\n        bufferManager.ReturnBuffer(buffer.Array);\n\n        MemoryStream stream = new MemoryStream(msgContents);\n        return ReadMessage(stream, int.MaxValue);\n    }\n\n    public override Message ReadMessage(Stream stream, int maxSizeOfHeaders, string contentType)\n    {\n        XmlReader reader = XmlReader.Create(stream);\n        return Message.CreateMessage(reader, maxSizeOfHeaders, this.MessageVersion);\n    }\n\n    public override ArraySegment<byte> WriteMessage(Message message, int maxMessageSize, BufferManager bufferManager, int messageOffset)\n    {\n        MemoryStream stream = new MemoryStream();\n        XmlWriter writer = XmlWriter.Create(stream, this.writerSettings);\n        message.WriteMessage(writer);\n        writer.Close();\n\n        byte[] messageBytes = stream.GetBuffer();\n        int messageLength = (int)stream.Position;\n        stream.Close();\n\n        int totalLength = messageLength + messageOffset;\n        byte[] totalBytes = bufferManager.TakeBuffer(totalLength);\n        Array.Copy(messageBytes, 0, totalBytes, messageOffset, messageLength);\n\n        ArraySegment<byte> byteArray = new ArraySegment<byte>(totalBytes, messageOffset, messageLength);\n        return byteArray;\n    }\n\n    public override void WriteMessage(Message message, Stream stream)\n    {\n        XmlWriter writer = XmlWriter.Create(stream, this.writerSettings);\n        message.WriteMessage(writer);\n        writer.Close();\n    }\n}\n```\n\nThe following code example shows how to build the message encoder factory.\n\n```csharp\npublic class CustomTextMessageEncoderFactory : MessageEncoderFactory\n{\n    private MessageEncoder encoder;\n    private MessageVersion version;\n    private string mediaType;\n    private string charSet;\n\n    internal CustomTextMessageEncoderFactory(string mediaType, string charSet,\n        MessageVersion version)\n    {\n        this.version = version;\n        this.mediaType = mediaType;\n        this.charSet = charSet;\n        this.encoder = new CustomTextMessageEncoder(this);\n    }\n\n    public override MessageEncoder Encoder\n    {\n        get \n        { \n            return this.encoder;\n        }\n    }\n\n    public override MessageVersion MessageVersion\n    {\n        get \n        { \n            return this.version;\n        }\n    }\n\n    internal string MediaType\n    {\n        get\n        {\n            return this.mediaType;\n        }\n    }\n\n    internal string CharSet\n    {\n        get\n        {\n            return this.charSet;\n        }\n    }\n}\n```\n\n## Message Encoding Binding Element\n\nThe binding elements allow the configuration of the WCF run-time stack. To use the custom message encoder in a WCF application, a binding element is required that creates the message encoder factory with the appropriate settings at the appropriate level in the run-time stack.\n\nThe `CustomTextMessageBindingElement` derives from the <xref:System.ServiceModel.Channels.BindingElement> base class and inherits from the <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> class. This allows other WCF components to recognize this binding element as being a message encoding binding element. The implementation of <xref:System.ServiceModel.Channels.MessageEncodingBindingElement.CreateMessageEncoderFactory%2A> returns an instance of the matching message encoder factory with appropriate settings.\n\nThe `CustomTextMessageBindingElement` exposes settings for `MessageVersion`, `ContentType`, and `Encoding` through properties. The encoder supports both Soap11Addressing and Soap12Addressing1 versions. The default is Soap11Addressing1. The default value of the `ContentType` is \"text/xml\". The `Encoding` property allows you to set the value of the desired character encoding. The sample client and service uses the ISO-8859-1 (Latin1) character encoding, which is not supported by the <xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement> of WCF.\n\nThe following code shows how to programmatically create the binding using the custom text message encoder.\n\n```csharp\nICollection<BindingElement> bindingElements = new List<BindingElement>();\nHttpTransportBindingElement httpBindingElement = new HttpTransportBindingElement();\nCustomTextMessageBindingElement textBindingElement = new CustomTextMessageBindingElement();\nbindingElements.Add(textBindingElement);\nbindingElements.Add(httpBindingElement);\nCustomBinding binding = new CustomBinding(bindingElements);\n```\n\n## Adding Metadata Support to the Message Encoding Binding Element\n\nAny type that derives from <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> is responsible for updating the version of the SOAP binding in the WSDL document generated for the service. This is done by implementing the `ExportEndpoint` method on the <xref:System.ServiceModel.Description.IWsdlExportExtension> interface and then modifying the generated WSDL. In this sample, the `CustomTextMessageBindingElement` uses the WSDL export logic from the `TextMessageEncodingBindingElement`.\n\nFor this sample, the client configuration is hand configured. You cannot use Svcutil.exe to generate the client configuration because the `CustomTextMessageBindingElement` does not export a policy assertion to describe its behavior. You should generally implement the <xref:System.ServiceModel.Description.IPolicyExportExtension> interface on a custom binding element to export a custom policy assertion that describes the behavior or capability implemented by the binding element. For an example of how to export a policy assertion for a custom binding element, see the [Transport: UDP](../../../../docs/framework/wcf/samples/transport-udp.md) sample.\n\n## Message Encoding Binding Configuration Handler\nThe previous section shows how to use the custom text message encoder programmatically. The `CustomTextMessageEncodingBindingSection` implements a configuration handler that allows you to specify the use of a custom text message encoder within a configuration file. The `CustomTextMessageEncodingBindingSection` class derives from the <xref:System.ServiceModel.Configuration.BindingElementExtensionElement> class. The `BindingElementType` property informs the configuration system of the type of binding element to create for this section.\n\nAll of the settings defined by `CustomTextMessageBindingElement` are exposed as the properties in the `CustomTextMessageEncodingBindingSection`. The <xref:System.Configuration.ConfigurationPropertyAttribute> assists in mapping the configuration element attributes to the properties and setting default values if the attribute is not set. After the values from configuration are loaded and applied to the properties of the type, the <xref:System.ServiceModel.Configuration.BindingElementExtensionElement.CreateBindingElement%2A> method is called, which converts the properties into a concrete instance of a binding element.\n\nThis configuration handler maps to the following representation in the App.config or Web.config for the service or client.\n\n```xml\n<customTextMessageEncoding encoding=\"utf-8\" contentType=\"text/xml\" messageVersion=\"Soap11Addressing1\" />\n```\n\nThe sample uses the ISO-8859-1 encoding.\n\nTo use this configuration handler it must be registered using the following configuration element.\n\n```xml\n<extensions>\n    <bindingElementExtensions>\n        <add name=\"customTextMessageEncoding\" type=\" \nMicrosoft.ServiceModel.Samples.CustomTextMessageEncodingBindingSection, \n                  CustomTextMessageEncoder\" />\n    </bindingElementExtensions>\n</extensions>\n```\n","nodes":[{"pos":[4,133],"embed":true,"restype":"x-metadata","content":"title: \"Custom Message Encoder: Custom Text Encoder - WCF\"\nms.date: \"03/30/2017\"\nms.assetid: 68ff5c74-3d33-4b44-bcae-e1d2f5dea0de","nodes":[{"content":"Custom Message Encoder: Custom Text Encoder - WCF","nodes":[{"pos":[0,49],"content":"Custom Message Encoder: Custom Text Encoder - WCF","nodes":[{"content":"Custom Message Encoder: Custom Text Encoder - WCF","pos":[0,49]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[140,183],"content":"Custom Message Encoder: Custom Text Encoder","linkify":"Custom Message Encoder: Custom Text Encoder","nodes":[{"content":"Custom Message Encoder: Custom Text Encoder","pos":[0,43]}]},{"content":"This sample demonstrates how to implement a custom text message encoder using Windows Communication Foundation (WCF).","pos":[185,302]},{"pos":[306,435],"content":"[!WARNING]\nThe samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[11,127],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[0,53]},{"content":"Check for the following (default) directory before continuing.","pos":[54,116]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[479,789],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[790,840]},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement&gt;</ph> of WCF supports only the UTF-8, UTF-16 and big-endian Unicode encodings.","pos":[918,1064],"source":"The <xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement> of WCF supports only the UTF-8, UTF-16 and big-endian Unicode encodings."},{"content":"The custom text message encoder in this sample supports all platform-supported character encodings that may be required for interoperability.","pos":[1065,1206]},{"content":"The sample consists of a client console program (.exe), a service library (.dll) hosted by Internet Information Services (IIS), and a text message encoder library (.dll).","pos":[1207,1377]},{"content":"The service implements a contract that defines a request-reply communication pattern.","pos":[1378,1463]},{"content":"The contract is defined by the <ph id=\"ph1\">`ICalculator`</ph> interface, which exposes math operations (Add, Subtract, Multiply, and Divide).","pos":[1464,1588],"source":" The contract is defined by the `ICalculator` interface, which exposes math operations (Add, Subtract, Multiply, and Divide)."},{"content":"The client makes synchronous requests to a given math operation and the service replies with the result.","pos":[1589,1693]},{"content":"Both client and service uses the <ph id=\"ph1\">`CustomTextMessageEncoder`</ph> instead of the default <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement&gt;</ph>.","pos":[1694,1847],"source":" Both client and service uses the `CustomTextMessageEncoder` instead of the default <xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement>."},{"content":"The custom encoder implementation consists of a message encoder factory, a message encoder, a message encoding binding element and a configuration handler, and demonstrates the following:","pos":[1849,2036]},{"content":"Building a custom encoder and encoder factory.","pos":[2040,2086]},{"content":"Creating a binding element for a custom encoder.","pos":[2090,2138]},{"content":"Using the custom binding configuration for integrating custom binding elements.","pos":[2142,2221]},{"content":"Developing a custom configuration handler to allow file configuration of a custom binding element.","pos":[2225,2323]},{"pos":[2328,2364],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[2370,2468],"content":"Install <ph id=\"ph1\">[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]</ph> 4.0 using the following command.","source":"Install [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] 4.0 using the following command."},{"pos":[2568,2767],"content":"Ensure that you have performed the <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"pos":[2773,2943],"content":"To build the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"pos":[2949,3157],"content":"To run the sample in a single- or cross-machine configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"pos":[3162,3209],"content":"Message Encoder Factory and the Message Encoder","linkify":"Message Encoder Factory and the Message Encoder","nodes":[{"content":"Message Encoder Factory and the Message Encoder","pos":[0,47]}]},{"content":"When the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> or the client channel is opened, the design time component <ph id=\"ph2\">`CustomTextMessageBindingElement`</ph> creates the <ph id=\"ph3\">`CustomTextMessageEncoderFactory`</ph>.","pos":[3211,3398],"source":"When the <xref:System.ServiceModel.ServiceHost> or the client channel is opened, the design time component `CustomTextMessageBindingElement` creates the `CustomTextMessageEncoderFactory`."},{"content":"The factory creates the <ph id=\"ph1\">`CustomTextMessageEncoder`</ph>.","pos":[3399,3450],"source":" The factory creates the `CustomTextMessageEncoder`."},{"content":"The message encoder operates both in the streaming mode and the buffered mode.","pos":[3451,3529]},{"content":"It uses the <ph id=\"ph1\">&lt;xref:System.Xml.XmlReader&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Xml.XmlWriter&gt;</ph> to read and write the messages respectively.","pos":[3530,3646],"source":" It uses the <xref:System.Xml.XmlReader> and <xref:System.Xml.XmlWriter> to read and write the messages respectively."},{"content":"As opposed to the optimized XML readers and writers of WCF that support only UTF-8, UTF-16 and big-endian Unicode, these readers and writers support all platform-supported encoding.","pos":[3647,3828]},{"content":"The following code example shows the CustomTextMessageEncoder.","pos":[3830,3892]},{"content":"The following code example shows how to build the message encoder factory.","pos":[6544,6618]},{"pos":[7593,7625],"content":"Message Encoding Binding Element","linkify":"Message Encoding Binding Element","nodes":[{"content":"Message Encoding Binding Element","pos":[0,32]}]},{"content":"The binding elements allow the configuration of the WCF run-time stack.","pos":[7627,7698]},{"content":"To use the custom message encoder in a WCF application, a binding element is required that creates the message encoder factory with the appropriate settings at the appropriate level in the run-time stack.","pos":[7699,7903]},{"content":"The <ph id=\"ph1\">`CustomTextMessageBindingElement`</ph> derives from the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.BindingElement&gt;</ph> base class and inherits from the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Channels.MessageEncodingBindingElement&gt;</ph> class.","pos":[7905,8116],"source":"The `CustomTextMessageBindingElement` derives from the <xref:System.ServiceModel.Channels.BindingElement> base class and inherits from the <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> class."},{"content":"This allows other WCF components to recognize this binding element as being a message encoding binding element.","pos":[8117,8228]},{"content":"The implementation of <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.MessageEncodingBindingElement.CreateMessageEncoderFactory%2A&gt;</ph> returns an instance of the matching message encoder factory with appropriate settings.","pos":[8229,8434],"source":" The implementation of <xref:System.ServiceModel.Channels.MessageEncodingBindingElement.CreateMessageEncoderFactory%2A> returns an instance of the matching message encoder factory with appropriate settings."},{"content":"The <ph id=\"ph1\">`CustomTextMessageBindingElement`</ph> exposes settings for <ph id=\"ph2\">`MessageVersion`</ph>, <ph id=\"ph3\">`ContentType`</ph>, and <ph id=\"ph4\">`Encoding`</ph> through properties.","pos":[8436,8562],"source":"The `CustomTextMessageBindingElement` exposes settings for `MessageVersion`, `ContentType`, and `Encoding` through properties."},{"content":"The encoder supports both Soap11Addressing and Soap12Addressing1 versions.","pos":[8563,8637]},{"content":"The default is Soap11Addressing1.","pos":[8638,8671]},{"content":"The default value of the <ph id=\"ph1\">`ContentType`</ph> is \"text/xml\".","pos":[8672,8725],"source":" The default value of the `ContentType` is \"text/xml\"."},{"content":"The <ph id=\"ph1\">`Encoding`</ph> property allows you to set the value of the desired character encoding.","pos":[8726,8812],"source":" The `Encoding` property allows you to set the value of the desired character encoding."},{"content":"The sample client and service uses the ISO-8859-1 (Latin1) character encoding, which is not supported by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement&gt;</ph> of WCF.","pos":[8813,8999],"source":" The sample client and service uses the ISO-8859-1 (Latin1) character encoding, which is not supported by the <xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement> of WCF."},{"content":"The following code shows how to programmatically create the binding using the custom text message encoder.","pos":[9001,9107]},{"pos":[9519,9582],"content":"Adding Metadata Support to the Message Encoding Binding Element","linkify":"Adding Metadata Support to the Message Encoding Binding Element","nodes":[{"content":"Adding Metadata Support to the Message Encoding Binding Element","pos":[0,63]}]},{"content":"Any type that derives from <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.MessageEncodingBindingElement&gt;</ph> is responsible for updating the version of the SOAP binding in the WSDL document generated for the service.","pos":[9584,9784],"source":"Any type that derives from <xref:System.ServiceModel.Channels.MessageEncodingBindingElement> is responsible for updating the version of the SOAP binding in the WSDL document generated for the service."},{"content":"This is done by implementing the <ph id=\"ph1\">`ExportEndpoint`</ph> method on the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.IWsdlExportExtension&gt;</ph> interface and then modifying the generated WSDL.","pos":[9785,9957],"source":" This is done by implementing the `ExportEndpoint` method on the <xref:System.ServiceModel.Description.IWsdlExportExtension> interface and then modifying the generated WSDL."},{"content":"In this sample, the <ph id=\"ph1\">`CustomTextMessageBindingElement`</ph> uses the WSDL export logic from the <ph id=\"ph2\">`TextMessageEncodingBindingElement`</ph>.","pos":[9958,10084],"source":" In this sample, the `CustomTextMessageBindingElement` uses the WSDL export logic from the `TextMessageEncodingBindingElement`."},{"content":"For this sample, the client configuration is hand configured.","pos":[10086,10147]},{"content":"You cannot use Svcutil.exe to generate the client configuration because the <ph id=\"ph1\">`CustomTextMessageBindingElement`</ph> does not export a policy assertion to describe its behavior.","pos":[10148,10318],"source":" You cannot use Svcutil.exe to generate the client configuration because the `CustomTextMessageBindingElement` does not export a policy assertion to describe its behavior."},{"content":"You should generally implement the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.IPolicyExportExtension&gt;</ph> interface on a custom binding element to export a custom policy assertion that describes the behavior or capability implemented by the binding element.","pos":[10319,10567],"source":" You should generally implement the <xref:System.ServiceModel.Description.IPolicyExportExtension> interface on a custom binding element to export a custom policy assertion that describes the behavior or capability implemented by the binding element."},{"content":"For an example of how to export a policy assertion for a custom binding element, see the <bpt id=\"p1\">[</bpt>Transport: UDP<ept id=\"p1\">](../../../../docs/framework/wcf/samples/transport-udp.md)</ept> sample.","pos":[10568,10738],"source":" For an example of how to export a policy assertion for a custom binding element, see the [Transport: UDP](../../../../docs/framework/wcf/samples/transport-udp.md) sample."},{"pos":[10743,10789],"content":"Message Encoding Binding Configuration Handler","linkify":"Message Encoding Binding Configuration Handler","nodes":[{"content":"Message Encoding Binding Configuration Handler","pos":[0,46]}]},{"content":"The previous section shows how to use the custom text message encoder programmatically.","pos":[10790,10877]},{"content":"The <ph id=\"ph1\">`CustomTextMessageEncodingBindingSection`</ph> implements a configuration handler that allows you to specify the use of a custom text message encoder within a configuration file.","pos":[10878,11055],"source":" The `CustomTextMessageEncodingBindingSection` implements a configuration handler that allows you to specify the use of a custom text message encoder within a configuration file."},{"content":"The <ph id=\"ph1\">`CustomTextMessageEncodingBindingSection`</ph> class derives from the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Configuration.BindingElementExtensionElement&gt;</ph> class.","pos":[11056,11203],"source":" The `CustomTextMessageEncodingBindingSection` class derives from the <xref:System.ServiceModel.Configuration.BindingElementExtensionElement> class."},{"content":"The <ph id=\"ph1\">`BindingElementType`</ph> property informs the configuration system of the type of binding element to create for this section.","pos":[11204,11329],"source":" The `BindingElementType` property informs the configuration system of the type of binding element to create for this section."},{"content":"All of the settings defined by <ph id=\"ph1\">`CustomTextMessageBindingElement`</ph> are exposed as the properties in the <ph id=\"ph2\">`CustomTextMessageEncodingBindingSection`</ph>.","pos":[11331,11475],"source":"All of the settings defined by `CustomTextMessageBindingElement` are exposed as the properties in the `CustomTextMessageEncodingBindingSection`."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Configuration.ConfigurationPropertyAttribute&gt;</ph> assists in mapping the configuration element attributes to the properties and setting default values if the attribute is not set.","pos":[11476,11668],"source":" The <xref:System.Configuration.ConfigurationPropertyAttribute> assists in mapping the configuration element attributes to the properties and setting default values if the attribute is not set."},{"content":"After the values from configuration are loaded and applied to the properties of the type, the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Configuration.BindingElementExtensionElement.CreateBindingElement%2A&gt;</ph> method is called, which converts the properties into a concrete instance of a binding element.","pos":[11669,11953],"source":" After the values from configuration are loaded and applied to the properties of the type, the <xref:System.ServiceModel.Configuration.BindingElementExtensionElement.CreateBindingElement%2A> method is called, which converts the properties into a concrete instance of a binding element."},{"content":"This configuration handler maps to the following representation in the App.config or Web.config for the service or client.","pos":[11955,12077]},{"content":"The sample uses the ISO-8859-1 encoding.","pos":[12196,12236]},{"content":"To use this configuration handler it must be registered using the following configuration element.","pos":[12238,12336]}]}