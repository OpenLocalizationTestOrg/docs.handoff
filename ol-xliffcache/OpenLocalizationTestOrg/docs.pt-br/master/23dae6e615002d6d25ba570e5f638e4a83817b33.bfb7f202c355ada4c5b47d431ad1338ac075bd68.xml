{"content":"---\ntitle: \"How to: Control Serialization of Derived Classes | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\n  - \"CSharp\"\n  - \"C++\"\n  - \"jsharp\"\nms.assetid: caa92596-9e15-4d91-acbe-56911ef47a84\ncaps.latest.revision: 3\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# How to: Control Serialization of Derived Classes\nUsing the **XmlElementAttribute** attribute to change the name of an XML element is not the only way to customize object serialization. You can also customize the XML stream by deriving from an existing class and instructing the <xref:System.Xml.Serialization.XmlSerializer> instance how to serialize the new class.  \n  \n For example, given a `Book` class, you can derive from it and create an `ExpandedBook` class that has a few more properties. However, you must instruct the **XmlSerializer** to accept the derived type when serializing or deserializing. This can be done by creating a <xref:System.Xml.Serialization.XmlElementAttribute> instance and setting its **Type** property to the derived class type. Add the **XmlElementAttribute** to a <xref:System.Xml.Serialization.XmlAttributes> instance. Then add the **XmlAttributes** to a <xref:System.Xml.Serialization.XmlAttributeOverrides> instance, specifying the type being overridden and the name of the member that accepts the derived class. This is shown in the following example.  \n  \n## Example  \n  \n```vb  \nPublic Class Orders  \n    public Books() As Book  \nEnd Class     \n  \nPublic Class Book  \n    public ISBN As String   \nEnd Class  \n  \nPublic Class ExpandedBook  \n    Inherits Book  \n    public NewEdition As Boolean  \nEnd Class  \n  \nPublic Class Run  \n    Shared Sub Main()  \n        Dim t As Run = New Run()  \n        t.SerializeObject(\"Book.xml\")  \n        t.DeserializeObject(\"Book.xml\")  \n    End Sub  \n  \n    Public Sub SerializeObject(filename As String)  \n        ' Each overridden field, property, or type requires   \n        ' an XmlAttributes instance.   \n        Dim attrs As XmlAttributes = New XmlAttributes()  \n  \n        ' Creates an XmlElementAttribute instance to override the   \n        ' field that returns Book objects. The overridden field  \n        ' returns Expanded objects instead.  \n        Dim attr As XmlElementAttribute = _  \n        New XmlElementAttribute()  \n        attr.ElementName = \"NewBook\"  \n        attr.Type = GetType(ExpandedBook)  \n  \n        ' Adds the element to the collection of elements.  \n        attrs.XmlElements.Add(attr)  \n  \n        ' Creates the XmlAttributeOverrides.  \n        Dim attrOverrides As XmlAttributeOverrides = _  \n        New XmlAttributeOverrides()  \n  \n        ' Adds the type of the class that contains the overridden   \n        ' member, as well as the XmlAttributes instance to override it   \n        ' with, to the XmlAttributeOverrides instance.   \n        attrOverrides.Add(GetType(Orders), \"Books\", attrs)  \n  \n        ' Creates the XmlSerializer using the XmlAttributeOverrides.  \n        Dim s As XmlSerializer  = _  \n        New XmlSerializer(GetType(Orders), attrOverrides)  \n  \n        ' Writing the file requires a TextWriter instance.  \n        Dim writer As TextWriter = New StreamWriter(filename)  \n  \n        ' Creates the object to be serialized.  \n        Dim myOrders As Orders = New Orders()  \n  \n        ' Creates an object of the derived type.  \n        Dim b As ExpandedBook = New ExpandedBook()  \n        b.ISBN= \"123456789\"  \n        b.NewEdition = True  \n        myOrders.Books = New ExpandedBook(){b}  \n  \n        ' Serializes the object.  \n        s.Serialize(writer,myOrders)  \n        writer.Close()  \n    End Sub  \n  \n    Public Sub DeserializeObject(filename As String)  \n        Dim attrOverrides As XmlAttributeOverrides = _  \n        New XmlAttributeOverrides()  \n        Dim attrs As XmlAttributes = New XmlAttributes()  \n  \n        ' Creates an XmlElementAttribute to override the   \n        ' field that returns Book objects. The overridden field  \n        ' returns Expanded objects instead.   \n        Dim attr As XmlElementAttribute = _  \n        New XmlElementAttribute()  \n        attr.ElementName = \"NewBook\"  \n        attr.Type = GetType(ExpandedBook)  \n  \n        ' Adds the XmlElementAttribute to the collection of objects.  \n        attrs.XmlElements.Add(attr)  \n  \n        attrOverrides.Add(GetType(Orders), \"Books\", attrs)  \n  \n        ' Creates the XmlSerializer using the XmlAttributeOverrides.  \n        Dim s As XmlSerializer = _  \n        New XmlSerializer(GetType(Orders), attrOverrides)  \n  \n        Dim fs As FileStream = New FileStream(filename, FileMode.Open)  \n        Dim myOrders As Orders = CType( s.Deserialize(fs), Orders)  \n        Console.WriteLine(\"ExpandedBook:\")  \n  \n        ' The difference between deserializing the overridden   \n        ' XML document and serializing it is this: To read the derived   \n        ' object values, you must declare an object of the derived type   \n        ' and cast the returned object to it.   \n        Dim expanded As ExpandedBook   \n        Dim b As Book  \n        for each b  in myOrders.Books  \n            expanded = CType(b, ExpandedBook)  \n            Console.WriteLine(expanded.ISBN)  \n            Console.WriteLine(expanded.NewEdition)  \n        Next  \n    End Sub  \nEnd Class  \n```  \n  \n```csharp  \npublic class Orders  \n{  \n    public Book[] Books;  \n}      \n  \npublic class Book  \n{  \n    public string ISBN;  \n}  \n  \npublic class ExpandedBook:Book  \n{  \n    public bool NewEdition;  \n}  \n  \npublic class Run  \n{  \n    public void SerializeObject(string filename)  \n    {  \n        // Each overridden field, property, or type requires   \n        // an XmlAttributes instance.  \n        XmlAttributes attrs = new XmlAttributes();  \n  \n        // Creates an XmlElementAttribute instance to override the   \n        // field that returns Book objects. The overridden field  \n        // returns Expanded objects instead.  \n        XmlElementAttribute attr = new XmlElementAttribute();  \n        attr.ElementName = \"NewBook\";  \n        attr.Type = typeof(ExpandedBook);  \n  \n        // Adds the element to the collection of elements.  \n        attrs.XmlElements.Add(attr);  \n  \n        // Creates the XmlAttributeOverrides instance.  \n        XmlAttributeOverrides attrOverrides = new XmlAttributeOverrides();  \n  \n        // Adds the type of the class that contains the overridden   \n        // member, as well as the XmlAttributes instance to override it   \n        // with, to the XmlAttributeOverrides.  \n        attrOverrides.Add(typeof(Orders), \"Books\", attrs);  \n  \n        // Creates the XmlSerializer using the XmlAttributeOverrides.  \n        XmlSerializer s =   \n        new XmlSerializer(typeof(Orders), attrOverrides);  \n  \n        // Writing the file requires a TextWriter instance.  \n        TextWriter writer = new StreamWriter(filename);  \n  \n        // Creates the object to be serialized.  \n        Orders myOrders = new Orders();  \n  \n        // Creates an object of the derived type.  \n        ExpandedBook b = new ExpandedBook();  \n        b.ISBN= \"123456789\";  \n        b.NewEdition = true;  \n        myOrders.Books = new ExpandedBook[]{b};  \n  \n        // Serializes the object.  \n        s.Serialize(writer,myOrders);  \n        writer.Close();  \n    }  \n  \n    public void DeserializeObject(string filename)  \n    {  \n        XmlAttributeOverrides attrOverrides =   \n            new XmlAttributeOverrides();  \n        XmlAttributes attrs = new XmlAttributes();  \n  \n        // Creates an XmlElementAttribute to override the   \n        // field that returns Book objects. The overridden field  \n        // returns Expanded objects instead.  \n        XmlElementAttribute attr = new XmlElementAttribute();  \n        attr.ElementName = \"NewBook\";  \n        attr.Type = typeof(ExpandedBook);  \n  \n        // Adds the XmlElementAttribute to the collection of objects.  \n        attrs.XmlElements.Add(attr);  \n  \n        attrOverrides.Add(typeof(Orders), \"Books\", attrs);  \n  \n        // Creates the XmlSerializer using the XmlAttributeOverrides.  \n        XmlSerializer s =   \n        new XmlSerializer(typeof(Orders), attrOverrides);  \n  \n        FileStream fs = new FileStream(filename, FileMode.Open);  \n        Orders myOrders = (Orders) s.Deserialize(fs);  \n        Console.WriteLine(\"ExpandedBook:\");  \n  \n        // The difference between deserializing the overridden   \n        // XML document and serializing it is this: To read the derived   \n        // object values, you must declare an object of the derived type   \n        // and cast the returned object to it.  \n        ExpandedBook expanded;  \n        foreach(Book b in myOrders.Books)   \n        {  \n            expanded = (ExpandedBook)b;  \n            Console.WriteLine(  \n            expanded.ISBN + \"\\n\" +   \n            expanded.NewEdition);  \n        }  \n    }  \n}  \n  \n```  \n  \n## See Also  \n <xref:System.Xml.Serialization.XmlSerializer>   \n <xref:System.Xml.Serialization.XmlElementAttribute>   \n <xref:System.Xml.Serialization.XmlAttributes>   \n <xref:System.Xml.Serialization.XmlAttributeOverrides>   \n [XML and SOAP Serialization](../../../docs/framework/serialization/xml-and-soap-serialization.md)   \n [How to: Serialize an Object](../../../docs/framework/serialization/how-to-serialize-an-object.md)   \n [How to: Specify an Alternate Element Name for an XML Stream](../../../docs/framework/serialization/how-to-specify-an-alternate-element-name-for-an-xml-stream.md)","nodes":[{"pos":[12,77],"content":"How to: Control Serialization of Derived Classes | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"How to: Control Serialization of Derived Classes | Microsoft Docs","pos":[0,65]}]},{"pos":[399,447],"content":"How to: Control Serialization of Derived Classes","linkify":"How to: Control Serialization of Derived Classes","nodes":[{"content":"How to: Control Serialization of Derived Classes","pos":[0,48]}]},{"content":"Using the <bpt id=\"p1\">**</bpt>XmlElementAttribute<ept id=\"p1\">**</ept> attribute to change the name of an XML element is not the only way to customize object serialization.","pos":[448,583],"source":"Using the **XmlElementAttribute** attribute to change the name of an XML element is not the only way to customize object serialization."},{"content":"You can also customize the XML stream by deriving from an existing class and instructing the <ph id=\"ph1\">&lt;xref:System.Xml.Serialization.XmlSerializer&gt;</ph> instance how to serialize the new class.","pos":[584,763],"source":" You can also customize the XML stream by deriving from an existing class and instructing the <xref:System.Xml.Serialization.XmlSerializer> instance how to serialize the new class."},{"content":"For example, given a <ph id=\"ph1\">`Book`</ph> class, you can derive from it and create an <ph id=\"ph2\">`ExpandedBook`</ph> class that has a few more properties.","pos":[770,894],"source":"For example, given a `Book` class, you can derive from it and create an `ExpandedBook` class that has a few more properties."},{"content":"However, you must instruct the <bpt id=\"p1\">**</bpt>XmlSerializer<ept id=\"p1\">**</ept> to accept the derived type when serializing or deserializing.","pos":[895,1005],"source":" However, you must instruct the **XmlSerializer** to accept the derived type when serializing or deserializing."},{"content":"This can be done by creating a <ph id=\"ph1\">&lt;xref:System.Xml.Serialization.XmlElementAttribute&gt;</ph> instance and setting its <bpt id=\"p1\">**</bpt>Type<ept id=\"p1\">**</ept> property to the derived class type.","pos":[1006,1158],"source":" This can be done by creating a <xref:System.Xml.Serialization.XmlElementAttribute> instance and setting its **Type** property to the derived class type."},{"content":"Add the <bpt id=\"p1\">**</bpt>XmlElementAttribute<ept id=\"p1\">**</ept> to a <ph id=\"ph1\">&lt;xref:System.Xml.Serialization.XmlAttributes&gt;</ph> instance.","pos":[1159,1251],"source":" Add the **XmlElementAttribute** to a <xref:System.Xml.Serialization.XmlAttributes> instance."},{"content":"Then add the <bpt id=\"p1\">**</bpt>XmlAttributes<ept id=\"p1\">**</ept> to a <ph id=\"ph1\">&lt;xref:System.Xml.Serialization.XmlAttributeOverrides&gt;</ph> instance, specifying the type being overridden and the name of the member that accepts the derived class.","pos":[1252,1447],"source":" Then add the **XmlAttributes** to a <xref:System.Xml.Serialization.XmlAttributeOverrides> instance, specifying the type being overridden and the name of the member that accepts the derived class."},{"content":"This is shown in the following example.","pos":[1448,1487]},{"pos":[1496,1503],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"pos":[8974,8982],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\"> [</bpt>XML and SOAP Serialization<ept id=\"p1\">](../../../docs/framework/serialization/xml-and-soap-serialization.md)</ept><ph id=\"ph1\"> </ph>","pos":[9199,9298],"source":" [XML and SOAP Serialization](../../../docs/framework/serialization/xml-and-soap-serialization.md) "},{"content":"<bpt id=\"p1\"> [</bpt>How to: Serialize an Object<ept id=\"p1\">](../../../docs/framework/serialization/how-to-serialize-an-object.md)</ept><ph id=\"ph1\"> </ph>","pos":[9301,9401],"source":" [How to: Serialize an Object](../../../docs/framework/serialization/how-to-serialize-an-object.md) "},{"content":"<bpt id=\"p1\"> [</bpt>How to: Specify an Alternate Element Name for an XML Stream<ept id=\"p1\">](../../../docs/framework/serialization/how-to-specify-an-alternate-element-name-for-an-xml-stream.md)</ept>","pos":[9404,9567],"source":" [How to: Specify an Alternate Element Name for an XML Stream](../../../docs/framework/serialization/how-to-specify-an-alternate-element-name-for-an-xml-stream.md)"}]}