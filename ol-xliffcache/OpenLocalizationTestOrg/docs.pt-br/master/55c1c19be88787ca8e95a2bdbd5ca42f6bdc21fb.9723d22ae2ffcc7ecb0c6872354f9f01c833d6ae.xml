{"content":"---\ntitle: \"Absolute Delay | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: b483139a-39bb-4560-8003-8969a8fc2cd1\ncaps.latest.revision: 3\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Absolute Delay\nThe main scenario for this sample is to delay until a specified <xref:System.DateTime> using durable timers in a workflow application. This is different from using the built-in <xref:System.Activities.Statements.Delay> activity as this will only allow you to delay for a given <xref:System.TimeSpan> (or number of minutes/seconds).  \n  \n Some real-life scenarios in which you may want to make this distinction include the following:  \n  \n1.  You want to delay sending a mail for 30 seconds to make sure you didn’t make any errors.  \n  \n2.  You are working overtime and want to delay all of your mails until normal business hours (such as 8 am).  \n  \n## Demonstrates  \n  \n1.  <xref:System.Activities.Statements.DurableTimerExtension> for implementing Absolute Delay  \n  \n2.  Setting up persistence using <xref:System.Activities.WorkflowApplication> for Durable Timers  \n  \n3.  Use of <xref:System.Activities.NativeActivity%601> for using Extensibility points  \n  \n4.  Use of <xref:System.Activities.CodeActivity%601> in the SendEmail activity  \n  \n5.  <xref:System.Activities.Statements.Delay>  \n  \n6.  XAML-only workflow  \n  \n This sample demonstrates how to create a custom activity which takes in a <xref:System.DateTime> and uses durable timers to register the delay duration. When using durable timers, you must use a <xref:System.Activities.NativeActivity> to create a bookmark, as you will need to register this bookmark with the timer extension. In this sample, when the durable timer expires, the `OnTimerExpired` method will be called. Make sure that you are adding the timer extension in the <xref:System.Activities.NativeActivity%601.CacheMetadata%2A> event to ensure you are providing the runtime with this information. The only other implementation detail is that you will need to implement logic to convert from <xref:System.DateTime> to <xref:System.TimeSpan>, as durable timers only take in a <xref:System.DateTime>. Do note that there is a small lapse in accuracy by doing  \n  \n> [!NOTE]\n>  There is a small loss of accuracy by converting from <xref:System.DateTime> to <xref:System.TimeSpan>.  \n  \n This sample also demonstrates how to turn on persistence for a <xref:System.Activities.WorkflowApplication>. For this particular sample, we will be using durable timers in which the workflow data will be unloaded into the persistence database during the idle time while waiting for timer to expire. This implementation can also be used for other persistence actions. This sample shows how to set up the persistence connection string with SQL Server, and how to create the instance store in order to persist the data for workflow instances. Logic is provided on how to resume the workflow once an event is raised which makes the workflow instance runnable.  \n  \n As you step through this sample, you will see the time in which the built-in delay begins and completes, which in turn will cause an e-mail message to be sent. From there, the AbsoluteDelay activity will halt until a specified <xref:System.DateTime> (or 0 seconds if the <xref:System.DateTime> has expired) which in turn will send out an email upon expiration. This will show the two different use cases of the built-in <xref:System.Activities.Statements.Delay> functionality versus using an AbsoluteDelay activity.  \n  \n#### To set up, build, and run the sample  \n  \n1.  Ensure you have SQL Server Express (or higher) installed on your machine  \n  \n2.  Run setup.cmd (from WF/Basic/Services/AbsoluteDelay/CS) in a [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] command prompt to create the AbsoluteDelaySampleDB database, create the persistence schema and create the persistence logic.  \n  \n3.  Open the solution in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].  \n  \n4.  Specify the Duration in the Delay activity.  \n  \n5.  Specify the ExpirationTime in the AbsoluteDelay activity.  \n  \n6.  Update the SendMailTo, SendMailFrom, SendMailSubject, SendMailBody, and SmtpHost fields in the SendMail activity.  \n  \n    > [!NOTE]\n    >  If you do not enter a valid SMTP host, the application will throw a SMTP exception.  \n  \n7.  Build the solution by selecting **Build**, **Build Solution**.  \n  \n8.  Run the solution by pressing **F5**.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Basic\\Services\\AbsoluteDelay`","nodes":[{"pos":[12,43],"content":"Absolute Delay | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Absolute Delay | Microsoft Docs","pos":[0,31]}]},{"pos":[308,322],"content":"Absolute Delay","linkify":"Absolute Delay","nodes":[{"content":"Absolute Delay","pos":[0,14]}]},{"content":"The main scenario for this sample is to delay until a specified <ph id=\"ph1\">&lt;xref:System.DateTime&gt;</ph> using durable timers in a workflow application.","pos":[323,457],"source":"The main scenario for this sample is to delay until a specified <xref:System.DateTime> using durable timers in a workflow application."},{"content":"This is different from using the built-in <ph id=\"ph1\">&lt;xref:System.Activities.Statements.Delay&gt;</ph> activity as this will only allow you to delay for a given <ph id=\"ph2\">&lt;xref:System.TimeSpan&gt;</ph> (or number of minutes/seconds).","pos":[458,654],"source":" This is different from using the built-in <xref:System.Activities.Statements.Delay> activity as this will only allow you to delay for a given <xref:System.TimeSpan> (or number of minutes/seconds)."},{"content":"Some real-life scenarios in which you may want to make this distinction include the following:","pos":[661,755]},{"content":"You want to delay sending a mail for 30 seconds to make sure you didn’t make any errors.","pos":[765,853]},{"content":"You are working overtime and want to delay all of your mails until normal business hours (such as 8 am).","pos":[863,967]},{"pos":[976,988],"content":"Demonstrates","linkify":"Demonstrates","nodes":[{"content":"Demonstrates","pos":[0,12]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Statements.DurableTimerExtension&gt;</ph> for implementing Absolute Delay","pos":[998,1087],"source":"<xref:System.Activities.Statements.DurableTimerExtension> for implementing Absolute Delay"},{"content":"Setting up persistence using <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowApplication&gt;</ph> for Durable Timers","pos":[1097,1189],"source":"Setting up persistence using <xref:System.Activities.WorkflowApplication> for Durable Timers"},{"content":"Use of <ph id=\"ph1\">&lt;xref:System.Activities.NativeActivity%601&gt;</ph> for using Extensibility points","pos":[1199,1280],"source":"Use of <xref:System.Activities.NativeActivity%601> for using Extensibility points"},{"content":"Use of <ph id=\"ph1\">&lt;xref:System.Activities.CodeActivity%601&gt;</ph> in the SendEmail activity","pos":[1290,1364],"source":"Use of <xref:System.Activities.CodeActivity%601> in the SendEmail activity"},{"content":"XAML-only workflow","pos":[1425,1443]},{"content":"This sample demonstrates how to create a custom activity which takes in a <ph id=\"ph1\">&lt;xref:System.DateTime&gt;</ph> and uses durable timers to register the delay duration.","pos":[1450,1602],"source":"This sample demonstrates how to create a custom activity which takes in a <xref:System.DateTime> and uses durable timers to register the delay duration."},{"content":"When using durable timers, you must use a <ph id=\"ph1\">&lt;xref:System.Activities.NativeActivity&gt;</ph> to create a bookmark, as you will need to register this bookmark with the timer extension.","pos":[1603,1775],"source":" When using durable timers, you must use a <xref:System.Activities.NativeActivity> to create a bookmark, as you will need to register this bookmark with the timer extension."},{"content":"In this sample, when the durable timer expires, the <ph id=\"ph1\">`OnTimerExpired`</ph> method will be called.","pos":[1776,1867],"source":" In this sample, when the durable timer expires, the `OnTimerExpired` method will be called."},{"content":"Make sure that you are adding the timer extension in the <ph id=\"ph1\">&lt;xref:System.Activities.NativeActivity%601.CacheMetadata%2A&gt;</ph> event to ensure you are providing the runtime with this information.","pos":[1868,2054],"source":" Make sure that you are adding the timer extension in the <xref:System.Activities.NativeActivity%601.CacheMetadata%2A> event to ensure you are providing the runtime with this information."},{"content":"The only other implementation detail is that you will need to implement logic to convert from <ph id=\"ph1\">&lt;xref:System.DateTime&gt;</ph> to <ph id=\"ph2\">&lt;xref:System.TimeSpan&gt;</ph>, as durable timers only take in a <ph id=\"ph3\">&lt;xref:System.DateTime&gt;</ph>.","pos":[2055,2255],"source":" The only other implementation detail is that you will need to implement logic to convert from <xref:System.DateTime> to <xref:System.TimeSpan>, as durable timers only take in a <xref:System.DateTime>."},{"content":"Do note that there is a small lapse in accuracy by doing","pos":[2256,2312]},{"pos":[2320,2433],"content":"[!NOTE]\n There is a small loss of accuracy by converting from <xref:System.DateTime> to <xref:System.TimeSpan>.","leadings":["","> "],"nodes":[{"content":"There is a small loss of accuracy by converting from <ph id=\"ph1\">&lt;xref:System.DateTime&gt;</ph> to <ph id=\"ph2\">&lt;xref:System.TimeSpan&gt;</ph>.","pos":[9,111],"source":" There is a small loss of accuracy by converting from <xref:System.DateTime> to <xref:System.TimeSpan>."}]},{"content":"This sample also demonstrates how to turn on persistence for a <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowApplication&gt;</ph>.","pos":[2440,2548],"source":"This sample also demonstrates how to turn on persistence for a <xref:System.Activities.WorkflowApplication>."},{"content":"For this particular sample, we will be using durable timers in which the workflow data will be unloaded into the persistence database during the idle time while waiting for timer to expire.","pos":[2549,2738]},{"content":"This implementation can also be used for other persistence actions.","pos":[2739,2806]},{"content":"This sample shows how to set up the persistence connection string with SQL Server, and how to create the instance store in order to persist the data for workflow instances.","pos":[2807,2979]},{"content":"Logic is provided on how to resume the workflow once an event is raised which makes the workflow instance runnable.","pos":[2980,3095]},{"content":"As you step through this sample, you will see the time in which the built-in delay begins and completes, which in turn will cause an e-mail message to be sent.","pos":[3102,3261]},{"content":"From there, the AbsoluteDelay activity will halt until a specified <ph id=\"ph1\">&lt;xref:System.DateTime&gt;</ph> (or 0 seconds if the <ph id=\"ph2\">&lt;xref:System.DateTime&gt;</ph> has expired) which in turn will send out an email upon expiration.","pos":[3262,3462],"source":" From there, the AbsoluteDelay activity will halt until a specified <xref:System.DateTime> (or 0 seconds if the <xref:System.DateTime> has expired) which in turn will send out an email upon expiration."},{"content":"This will show the two different use cases of the built-in <ph id=\"ph1\">&lt;xref:System.Activities.Statements.Delay&gt;</ph> functionality versus using an AbsoluteDelay activity.","pos":[3463,3617],"source":" This will show the two different use cases of the built-in <xref:System.Activities.Statements.Delay> functionality versus using an AbsoluteDelay activity."},{"pos":[3628,3664],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"content":"Ensure you have SQL Server Express (or higher) installed on your machine","pos":[3674,3746]},{"pos":[3756,3995],"content":"Run setup.cmd (from WF/Basic/Services/AbsoluteDelay/CS) in a <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph> command prompt to create the AbsoluteDelaySampleDB database, create the persistence schema and create the persistence logic.","source":"Run setup.cmd (from WF/Basic/Services/AbsoluteDelay/CS) in a [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] command prompt to create the AbsoluteDelaySampleDB database, create the persistence schema and create the persistence logic."},{"pos":[4005,4080],"content":"Open the solution in <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph>.","source":"Open the solution in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]."},{"content":"Specify the Duration in the Delay activity.","pos":[4090,4133]},{"content":"Specify the ExpirationTime in the AbsoluteDelay activity.","pos":[4143,4200]},{"content":"Update the SendMailTo, SendMailFrom, SendMailSubject, SendMailBody, and SmtpHost fields in the SendMail activity.","pos":[4210,4323]},{"pos":[4335,4433],"content":"[!NOTE]\nIf you do not enter a valid SMTP host, the application will throw a SMTP exception.","leadings":["","    >  "],"nodes":[{"content":"If you do not enter a valid SMTP host, the application will throw a SMTP exception.","pos":[8,91]}]},{"pos":[4443,4505],"content":"Build the solution by selecting <bpt id=\"p1\">**</bpt>Build<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Build Solution<ept id=\"p2\">**</ept>.","source":"Build the solution by selecting **Build**, **Build Solution**."},{"pos":[4515,4551],"content":"Run the solution by pressing <bpt id=\"p1\">**</bpt>F5<ept id=\"p1\">**</ept>.","source":"Run the solution by pressing **F5**."},{"pos":[4559,4691],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[4745,5071],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[5072,5122]}]}