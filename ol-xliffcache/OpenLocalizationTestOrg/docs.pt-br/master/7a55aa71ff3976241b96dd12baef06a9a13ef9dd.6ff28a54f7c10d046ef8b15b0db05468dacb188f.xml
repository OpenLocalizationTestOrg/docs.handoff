{"content":"---\ntitle: \"Entity References are Expanded and Not Preserved\"\nms.date: \"03/30/2017\"\nms.technology: dotnet-standard\nms.assetid: ffd97806-ab43-4538-8de2-5828bfbbde57\nauthor: \"mairaw\"\nms.author: \"mairaw\"\n---\n# Entity References are Expanded and Not Preserved\nWhen the entity reference is expanded and replaced by the text it represents, the **XmlEntityReference** node is not created. Instead, the entity declaration is parsed, and nodes created from the content in the declaration are copied in the place of the **XmlEntityReference**. Therefore, in the `&publisher;` example, the `&publisher;` is not saved, but instead, an **XmlText** node is created.  \n  \n ![expanded tree structure](../../../../docs/standard/data/xml/media/xmlentityref-expanded-nodes.gif \"xmlentityref_expanded_nodes\")  \nTree structure for entity references that are expanded  \n  \n Character entities such as `B` or `<` are not preserved. Instead, they are always expanded and represented as text nodes.  \n  \n To preserve **XmlEntityReference** nodes and child nodes of the entity reference attached to it, set the **EntityHandling** flag to **ExpandCharEntities**. Otherwise, leave the **EntityHandling** flag at the default, which is to **ExpandEntities**. In this case, you will not see entity reference nodes in the DOM. The nodes are replaced by the nodes that are copies of the child nodes of the entity declaration.  \n  \n One side effect of not preserving entity references is that when the document is saved and passed on to another application, the receiving application does not know that the nodes were generated by an entity reference. However, when entity references are preserved, a receiving application sees an entity reference and reads the child nodes. It is apparent that the child nodes represent the information that was in the entity declaration. For example, the DOM theoretically has the following structure if entity references are preserved.  \n  \n XmlElement: publisher  \n  \n XmlEntityReference: `&publisher;`  \n  \n XmlText: Microsoft Press  \n  \n If entity references are expanded in the DOM, which is the default method, the structure has this type of tree:  \n  \n XmlElement: publisher  \n  \n XmlText: Microsoft Press  \n  \n Notice that the entity reference node is gone, and the receiving application cannot tell that the **XmlText** node containing \"Microsoft Press\" was created from an entity declaration.  \n  \n If you use a reader that cannot resolve entities, the **Load** method throws an exception when it encounters an entity reference.  \n  \n## See also\n\n- [XML Document Object Model (DOM)](../../../../docs/standard/data/xml/xml-document-object-model-dom.md)\n","nodes":[{"pos":[4,200],"embed":true,"restype":"x-metadata","content":"title: \"Entity References are Expanded and Not Preserved\"\nms.date: \"03/30/2017\"\nms.technology: dotnet-standard\nms.assetid: ffd97806-ab43-4538-8de2-5828bfbbde57\nauthor: \"mairaw\"\nms.author: \"mairaw\"","nodes":[{"content":"Entity References are Expanded and Not Preserved","nodes":[{"pos":[0,48],"content":"Entity References are Expanded and Not Preserved","nodes":[{"content":"Entity References are Expanded and Not Preserved","pos":[0,48]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[207,255],"content":"Entity References are Expanded and Not Preserved","linkify":"Entity References are Expanded and Not Preserved","nodes":[{"content":"Entity References are Expanded and Not Preserved","pos":[0,48]}]},{"content":"When the entity reference is expanded and replaced by the text it represents, the <bpt id=\"p1\">**</bpt>XmlEntityReference<ept id=\"p1\">**</ept> node is not created.","pos":[256,381],"source":"When the entity reference is expanded and replaced by the text it represents, the **XmlEntityReference** node is not created."},{"content":"Instead, the entity declaration is parsed, and nodes created from the content in the declaration are copied in the place of the <bpt id=\"p1\">**</bpt>XmlEntityReference<ept id=\"p1\">**</ept>.","pos":[382,533],"source":" Instead, the entity declaration is parsed, and nodes created from the content in the declaration are copied in the place of the **XmlEntityReference**."},{"content":"Therefore, in the <ph id=\"ph1\">`&amp;publisher;`</ph> example, the <ph id=\"ph2\">`&amp;publisher;`</ph> is not saved, but instead, an <bpt id=\"p1\">**</bpt>XmlText<ept id=\"p1\">**</ept> node is created.","pos":[534,651],"source":" Therefore, in the `&publisher;` example, the `&publisher;` is not saved, but instead, an **XmlText** node is created."},{"content":"<bpt id=\"p1\">![</bpt>expanded tree structure<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/standard/data/xml/media/xmlentityref-expanded-nodes.gif \"</bpt>xmlentityref_expanded_nodes<ept id=\"p2\">\")</ept>","pos":[658,788],"source":"![expanded tree structure](../../../../docs/standard/data/xml/media/xmlentityref-expanded-nodes.gif \"xmlentityref_expanded_nodes\")"},{"content":"Tree structure for entity references that are expanded","pos":[791,845]},{"content":"Character entities such as <ph id=\"ph1\">`B`</ph> or <ph id=\"ph2\">`&lt;`</ph> are not preserved.","pos":[852,908],"source":"Character entities such as `B` or `<` are not preserved."},{"content":"Instead, they are always expanded and represented as text nodes.","pos":[909,973]},{"content":"To preserve <bpt id=\"p1\">**</bpt>XmlEntityReference<ept id=\"p1\">**</ept> nodes and child nodes of the entity reference attached to it, set the <bpt id=\"p2\">**</bpt>EntityHandling<ept id=\"p2\">**</ept> flag to <bpt id=\"p3\">**</bpt>ExpandCharEntities<ept id=\"p3\">**</ept>.","pos":[980,1135],"source":"To preserve **XmlEntityReference** nodes and child nodes of the entity reference attached to it, set the **EntityHandling** flag to **ExpandCharEntities**."},{"content":"Otherwise, leave the <bpt id=\"p1\">**</bpt>EntityHandling<ept id=\"p1\">**</ept> flag at the default, which is to <bpt id=\"p2\">**</bpt>ExpandEntities<ept id=\"p2\">**</ept>.","pos":[1136,1228],"source":" Otherwise, leave the **EntityHandling** flag at the default, which is to **ExpandEntities**."},{"content":"In this case, you will not see entity reference nodes in the DOM.","pos":[1229,1294]},{"content":"The nodes are replaced by the nodes that are copies of the child nodes of the entity declaration.","pos":[1295,1392]},{"content":"One side effect of not preserving entity references is that when the document is saved and passed on to another application, the receiving application does not know that the nodes were generated by an entity reference.","pos":[1399,1617]},{"content":"However, when entity references are preserved, a receiving application sees an entity reference and reads the child nodes.","pos":[1618,1740]},{"content":"It is apparent that the child nodes represent the information that was in the entity declaration.","pos":[1741,1838]},{"content":"For example, the DOM theoretically has the following structure if entity references are preserved.","pos":[1839,1937]},{"content":"XmlElement: publisher","pos":[1944,1965]},{"pos":[1972,2005],"content":"XmlEntityReference: <ph id=\"ph1\">`&amp;publisher;`</ph>","source":"XmlEntityReference: `&publisher;`"},{"content":"XmlText: Microsoft Press","pos":[2012,2036]},{"content":"If entity references are expanded in the DOM, which is the default method, the structure has this type of tree:","pos":[2043,2154]},{"content":"XmlElement: publisher","pos":[2161,2182]},{"content":"XmlText: Microsoft Press","pos":[2189,2213]},{"pos":[2220,2403],"content":"Notice that the entity reference node is gone, and the receiving application cannot tell that the <bpt id=\"p1\">**</bpt>XmlText<ept id=\"p1\">**</ept> node containing \"Microsoft Press\" was created from an entity declaration.","source":"Notice that the entity reference node is gone, and the receiving application cannot tell that the **XmlText** node containing \"Microsoft Press\" was created from an entity declaration."},{"pos":[2410,2539],"content":"If you use a reader that cannot resolve entities, the <bpt id=\"p1\">**</bpt>Load<ept id=\"p1\">**</ept> method throws an exception when it encounters an entity reference.","source":"If you use a reader that cannot resolve entities, the **Load** method throws an exception when it encounters an entity reference."},{"pos":[2548,2556],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[2560,2662],"content":"<bpt id=\"p1\">[</bpt>XML Document Object Model (DOM)<ept id=\"p1\">](../../../../docs/standard/data/xml/xml-document-object-model-dom.md)</ept>","source":"[XML Document Object Model (DOM)](../../../../docs/standard/data/xml/xml-document-object-model-dom.md)"}]}