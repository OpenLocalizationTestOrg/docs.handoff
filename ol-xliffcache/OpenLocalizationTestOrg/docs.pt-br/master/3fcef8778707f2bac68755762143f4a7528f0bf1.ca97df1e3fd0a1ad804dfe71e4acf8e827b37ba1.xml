{"content":"---\ntitle: \"WCF Data Services Protocol Implementation Details\"\nms.date: \"03/30/2017\"\nms.assetid: 712d689b-fada-4cbb-bcdb-d65a3ef83b4c\n---\n# WCF Data Services Protocol Implementation Details\n## OData Protocol Implementation Details  \n The [!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)] requires that a data service that implements the protocol provide a certain minimum set of functionalities. These functionalities are described in the protocol documents in terms of \"should\" and \"must.\" Other optional functionality is described in terms of \"may.\" This topic describes these optional functionalities that are not currently implemented by [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]. For more information, see [OData Protocol Documentation](https://go.microsoft.com/fwlink/?LinkID=184554).  \n  \n### Support for the $format Query Option  \n The [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] protocol supports both JavaScript Notation (JSON) and Atom feeds, and [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] provides the `$format` system query option to allow a client to request the format of the response feed. This system query option, if supported by the data service, must override the value of the Accept header of the request. [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] supports returning both JSON and Atom feeds. However, the default implementation does not support the `$format` query option and uses only the value of the Accept header to determine the format of the response. There are cases when your data service may need to support the `$format` query option, such as when clients cannot set the Accept header. To support these scenarios, you must extend your data service to handle this option in the URI. You can add this functionality to your data service by downloading the [JSONP and URL-controlled format support for ADO.NET Data Services](https://go.microsoft.com/fwlink/?LinkId=208228) sample project from the MSDN Code Gallery web site and adding it to your data service project. This sample removes the `$format` query option and changes the Accept header to `application/json`. When you include the sample project and adding the `JSONPSupportBehaviorAttribute` to your data service class enables the service to handle the `$format` query option `$format=json`. Further customization of this sample project is required to also handle `$format=atom` or other custom formats.  \n  \n## WCF Data Services Behaviors  \n The following [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] behaviors are not explicitly defined by the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] protocol:  \n  \n### Default Sorting Behavior  \n When a query request that is sent to the data service includes a `$top` or `$skip` system query option and does not include the `$orderby` system query option, the returned feed is sorted by the key properties, in ascending order. This is because ordering is required to ensure the correct paging of results. To do this, the data service adds an ordering expression to the query. This behavior also occurs when server-driven paging is enabled in the data service. For more information, see [Configuring the Data Service](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md).To control the ordering of the returned feed, you should include `$orderby` in the query URI.  \n  \n## See also\n\n- [Defining WCF Data Services](../../../../docs/framework/data/wcf/defining-wcf-data-services.md)\n- [WCF Data Services Client Library](../../../../docs/framework/data/wcf/wcf-data-services-client-library.md)\n","nodes":[{"pos":[4,133],"embed":true,"restype":"x-metadata","content":"title: \"WCF Data Services Protocol Implementation Details\"\nms.date: \"03/30/2017\"\nms.assetid: 712d689b-fada-4cbb-bcdb-d65a3ef83b4c","nodes":[{"content":"WCF Data Services Protocol Implementation Details","nodes":[{"pos":[0,49],"content":"WCF Data Services Protocol Implementation Details","nodes":[{"content":"WCF Data Services Protocol Implementation Details","pos":[0,49]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[140,189],"content":"WCF Data Services Protocol Implementation Details","linkify":"WCF Data Services Protocol Implementation Details","nodes":[{"content":"WCF Data Services Protocol Implementation Details","pos":[0,49]}]},{"pos":[193,230],"content":"OData Protocol Implementation Details","linkify":"OData Protocol Implementation Details","nodes":[{"content":"OData Protocol Implementation Details","pos":[0,37]}]},{"content":"The <ph id=\"ph1\">[!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)]</ph> requires that a data service that implements the protocol provide a certain minimum set of functionalities.","pos":[234,409],"source":"The [!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)] requires that a data service that implements the protocol provide a certain minimum set of functionalities."},{"content":"These functionalities are described in the protocol documents in terms of \"should\" and \"must.\"","pos":[410,504]},{"content":"Other optional functionality is described in terms of \"may.\"","pos":[505,565]},{"content":"This topic describes these optional functionalities that are not currently implemented by <ph id=\"ph1\">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]</ph>.","pos":[566,716],"source":" This topic describes these optional functionalities that are not currently implemented by [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>OData Protocol Documentation<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkID=184554)</ept>.","pos":[717,822],"source":" For more information, see [OData Protocol Documentation](https://go.microsoft.com/fwlink/?LinkID=184554)."},{"pos":[832,868],"content":"Support for the $format Query Option","linkify":"Support for the $format Query Option","nodes":[{"content":"Support for the $format Query Option","pos":[0,36]}]},{"content":"The <ph id=\"ph1\">[!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]</ph> protocol supports both JavaScript Notation (JSON) and Atom feeds, and <ph id=\"ph2\">[!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]</ph> provides the <ph id=\"ph3\">`$format`</ph> system query option to allow a client to request the format of the response feed.","pos":[872,1182],"source":"The [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] protocol supports both JavaScript Notation (JSON) and Atom feeds, and [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] provides the `$format` system query option to allow a client to request the format of the response feed."},{"content":"This system query option, if supported by the data service, must override the value of the Accept header of the request.","pos":[1183,1303]},{"content":"<ph id=\"ph1\">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]</ph> supports returning both JSON and Atom feeds.","pos":[1304,1408],"source":"[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] supports returning both JSON and Atom feeds."},{"content":"However, the default implementation does not support the <ph id=\"ph1\">`$format`</ph> query option and uses only the value of the Accept header to determine the format of the response.","pos":[1409,1574],"source":" However, the default implementation does not support the `$format` query option and uses only the value of the Accept header to determine the format of the response."},{"content":"There are cases when your data service may need to support the <ph id=\"ph1\">`$format`</ph> query option, such as when clients cannot set the Accept header.","pos":[1575,1712],"source":" There are cases when your data service may need to support the `$format` query option, such as when clients cannot set the Accept header."},{"content":"To support these scenarios, you must extend your data service to handle this option in the URI.","pos":[1713,1808]},{"content":"You can add this functionality to your data service by downloading the <bpt id=\"p1\">[</bpt>JSONP and URL-controlled format support for ADO.NET Data Services<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=208228)</ept> sample project from the MSDN Code Gallery web site and adding it to your data service project.","pos":[1809,2090],"source":" You can add this functionality to your data service by downloading the [JSONP and URL-controlled format support for ADO.NET Data Services](https://go.microsoft.com/fwlink/?LinkId=208228) sample project from the MSDN Code Gallery web site and adding it to your data service project."},{"content":"This sample removes the <ph id=\"ph1\">`$format`</ph> query option and changes the Accept header to <ph id=\"ph2\">`application/json`</ph>.","pos":[2091,2190],"source":" This sample removes the `$format` query option and changes the Accept header to `application/json`."},{"content":"When you include the sample project and adding the <ph id=\"ph1\">`JSONPSupportBehaviorAttribute`</ph> to your data service class enables the service to handle the <ph id=\"ph2\">`$format`</ph> query option <ph id=\"ph3\">`$format=json`</ph>.","pos":[2191,2373],"source":" When you include the sample project and adding the `JSONPSupportBehaviorAttribute` to your data service class enables the service to handle the `$format` query option `$format=json`."},{"content":"Further customization of this sample project is required to also handle <ph id=\"ph1\">`$format=atom`</ph> or other custom formats.","pos":[2374,2485],"source":" Further customization of this sample project is required to also handle `$format=atom` or other custom formats."},{"pos":[2494,2521],"content":"WCF Data Services Behaviors","linkify":"WCF Data Services Behaviors","nodes":[{"content":"WCF Data Services Behaviors","pos":[0,27]}]},{"pos":[2525,2718],"content":"The following <ph id=\"ph1\">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]</ph> behaviors are not explicitly defined by the <ph id=\"ph2\">[!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]</ph> protocol:","source":"The following [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] behaviors are not explicitly defined by the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] protocol:"},{"pos":[2728,2752],"content":"Default Sorting Behavior","linkify":"Default Sorting Behavior","nodes":[{"content":"Default Sorting Behavior","pos":[0,24]}]},{"content":"When a query request that is sent to the data service includes a <ph id=\"ph1\">`$top`</ph> or <ph id=\"ph2\">`$skip`</ph> system query option and does not include the <ph id=\"ph3\">`$orderby`</ph> system query option, the returned feed is sorted by the key properties, in ascending order.","pos":[2756,2986],"source":"When a query request that is sent to the data service includes a `$top` or `$skip` system query option and does not include the `$orderby` system query option, the returned feed is sorted by the key properties, in ascending order."},{"content":"This is because ordering is required to ensure the correct paging of results.","pos":[2987,3064]},{"content":"To do this, the data service adds an ordering expression to the query.","pos":[3065,3135]},{"content":"This behavior also occurs when server-driven paging is enabled in the data service.","pos":[3136,3219]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Configuring the Data Service<ept id=\"p1\">](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md)</ept>.To control the ordering of the returned feed, you should include <ph id=\"ph1\">`$orderby`</ph> in the query URI.","pos":[3220,3457],"source":" For more information, see [Configuring the Data Service](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md).To control the ordering of the returned feed, you should include `$orderby` in the query URI."},{"pos":[3466,3474],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[3478,3573],"content":"<bpt id=\"p1\">[</bpt>Defining WCF Data Services<ept id=\"p1\">](../../../../docs/framework/data/wcf/defining-wcf-data-services.md)</ept>","source":"[Defining WCF Data Services](../../../../docs/framework/data/wcf/defining-wcf-data-services.md)"},{"pos":[3576,3683],"content":"<bpt id=\"p1\">[</bpt>WCF Data Services Client Library<ept id=\"p1\">](../../../../docs/framework/data/wcf/wcf-data-services-client-library.md)</ept>","source":"[WCF Data Services Client Library](../../../../docs/framework/data/wcf/wcf-data-services-client-library.md)"}]}