{"content":"---\ntitle: \"Using the ModelItem Editing Context\"\nms.date: \"03/30/2017\"\nms.assetid: 7f9f1ea5-0147-4079-8eca-be94f00d3aa1\n---\n# Using the ModelItem Editing Context\nThe <xref:System.Activities.Presentation.Model.ModelItem> editing context is the object that the host application uses to communicate with the designer. <xref:System.Activities.Presentation.EditingContext> exposes two methods, <xref:System.Activities.Presentation.EditingContext.Items%2A> and <xref:System.Activities.Presentation.EditingContext.Services%2A>, which can be used  \n  \n## The Items collection  \n The <xref:System.Activities.Presentation.EditingContext.Items%2A> collection is used to access data that is shared between the host and the designer, or data that is available to all designers. This collection has the following capabilities, accessed via the <xref:System.Activities.Presentation.ContextItemManager> class:  \n  \n1.  <xref:System.Activities.Presentation.ContextItemManager.GetValue%2A>  \n  \n2.  <xref:System.Activities.Presentation.ContextItemManager.Subscribe%2A>  \n  \n3.  <xref:System.Activities.Presentation.ContextItemManager.Unsubscribe%2A>  \n  \n4.  <xref:System.Activities.Presentation.ContextItemManager.SetValue%2A>  \n  \n## The Services collection  \n The <xref:System.Activities.Presentation.EditingContext.Services%2A> collection is used to access services that the designer uses to interact with the host, or services that all designers use. This collection has the following methods of note:  \n  \n1.  <xref:System.Activities.Presentation.ServiceManager.Publish%2A>  \n  \n2.  <xref:System.Activities.Presentation.ServiceManager.Subscribe%2A>  \n  \n3.  <xref:System.Activities.Presentation.ServiceManager.Unsubscribe%2A>  \n  \n4.  <xref:System.Activities.Presentation.ServiceManager.GetService%2A>  \n  \n## Assigning a designer an activity  \n To specify which designer an activity uses, the Designer attribute is used.  \n  \n```  \n[Designer(typeof(MyClassDesigner))]  \npublic sealed class MyClass : CodeActivity  \n{  \n```  \n  \n## Creating a service  \n To create a service that serves as a conduit of information between the designer and the host, an interface and an implementation must be created. The interface is used by the <xref:System.Activities.Presentation.ServiceManager.Publish%2A> method to define the members of the service, and the implementation contains the logic for the service. In the following code example, a service interface and implementation are created.  \n  \n```  \npublic interface IMyService  \n    {  \n        IEnumerable<string> GetValues(string DisplayName);  \n    }  \n  \n    public class MyServiceImpl : IMyService  \n    {  \n        public IEnumerable<string> GetValues(string DisplayName)  \n        {  \n            return new string[]  {   \n                DisplayName + \" One\",   \n                DisplayName + \" Two\",  \n                \"Three \" + DisplayName  \n            } ;  \n        }  \n    }  \n```  \n  \n## Publishing a service  \n For a designer to consume a service, it must first be published by the host using the <xref:System.Activities.Presentation.ServiceManager.Publish%2A> method.  \n  \n```  \nthis.Context.Services.Publish<IMyService>(new MyServiceImpl);  \n```  \n  \n## Subscribing to a service  \n The designer obtains access to the service using the <xref:System.Activities.Presentation.ServiceManager.Subscribe%2A> method in the <xref:System.Activities.Presentation.WorkflowViewElement.OnModelItemChanged%2A> method. The following code snippet demonstrates how to subscribe to a service.  \n  \n```  \nprotected override void OnModelItemChanged(object newItem)  \n{  \n    if (!subscribed)  \n    {  \n        this.Context.Services.Subscribe<IMyService>(  \n            servInstance =>  \n            {  \n                listBox1.ItemsSource = servInstance.GetValues(this.ModelItem.Properties[\"DisplayName\"].ComputedValue.ToString());  \n            }  \n            );  \n        subscribed = true;   \n    }  \n}  \n```  \n  \n## Sharing data using the Items collection  \n Using the Items collection is similar to using the Services collection, except that <xref:System.Activities.Presentation.ContextItemManager.SetValue%2A> is used instead of Publish. This collection is more appropriate for sharing simple data between the designers and the host, rather than complex functionality.  \n  \n## EditingContext host items and services  \n The .NET Framework provides a number of built-in items and services accessed through the editing context.  \n  \n Items:  \n  \n-   <xref:System.Activities.Presentation.Hosting.AssemblyContextControlItem>: Manages the list of referenced local assemblies that will be used inside the workflow for controls (such as the expression editor).  \n  \n-   <xref:System.Activities.Presentation.Hosting.ReadOnlyState>: Indicates whether the designer is in a read-only state.  \n  \n-   <xref:System.Activities.Presentation.View.Selection>: Defines the collection of objects that are currently selected.  \n  \n-   <xref:System.Activities.Presentation.Hosting.WorkflowCommandExtensionItem>:  \n  \n-   <xref:System.Activities.Presentation.WorkflowFileItem>: Provides information on the file that the current editing session is based on.  \n  \n Services:  \n  \n-   <xref:System.Activities.Presentation.Model.AttachedPropertiesService>: Allows properties to be added to the current instance, using <xref:System.Activities.Presentation.Model.AttachedPropertiesService.AddProperty%2A>.  \n  \n-   <xref:System.Activities.Presentation.View.DesignerView>: Allows access to the properties of the designer canvas.  \n  \n-   <xref:System.Activities.Presentation.IActivityToolboxService>: Allows the contents of the toolbox to be updated.  \n  \n-   <xref:System.Activities.Presentation.Hosting.ICommandService>: Used to integrate designer commands (such as Context Menu) with custom-provided service implementations.  \n  \n-   <xref:System.Activities.Presentation.Debug.IDesignerDebugView>: Provides functionality for the designer debugger.  \n  \n-   <xref:System.Activities.Presentation.View.IExpressionEditorService>: Provides access to the Expression Editor dialog.  \n  \n-   <xref:System.Activities.Presentation.IIntegratedHelpService>: Provides the designer with integrated help functionality.  \n  \n-   <xref:System.Activities.Presentation.Validation.IValidationErrorService>: Provides access to validation errors using <xref:System.Activities.Presentation.Validation.IValidationErrorService.ShowValidationErrors%2A>.  \n  \n-   <xref:System.Activities.Presentation.IWorkflowDesignerStorageService>: Provides an internal service to store and retrieve data. This service is used internally by the .NET Framework, and is not intended for external use.  \n  \n-   <xref:System.Activities.Presentation.IXamlLoadErrorService>: Provides access to the XAML load error collection using <xref:System.Activities.Presentation.IXamlLoadErrorService.ShowXamlLoadErrors%2A>.  \n  \n-   <xref:System.Activities.Presentation.Services.ModelService>: Used by the designer to interact with the model of the workflow being edited.  \n  \n-   <xref:System.Activities.Presentation.Model.ModelTreeManager>: Provides access to the root of the model item tree using <xref:System.Activities.Presentation.Model.ModelItem.Root%2A>.  \n  \n-   <xref:System.Activities.Presentation.UndoEngine>: Provides undo and redo functionality.  \n  \n-   <xref:System.Activities.Presentation.Services.ViewService>: Maps visual elements to underlying model items.  \n  \n-   <xref:System.Activities.Presentation.View.ViewStateService>: Stores view states for model items.  \n  \n-   <xref:System.Activities.Presentation.View.VirtualizedContainerService>: Used to customize the virtual container UI behavior.  \n  \n-   <xref:System.Activities.Presentation.Hosting.WindowHelperService>: Used to register and unregister delegates for event notifications. Also allows a window owner to be set.\n","nodes":[{"pos":[4,119],"embed":true,"restype":"x-metadata","content":"title: \"Using the ModelItem Editing Context\"\nms.date: \"03/30/2017\"\nms.assetid: 7f9f1ea5-0147-4079-8eca-be94f00d3aa1","nodes":[{"content":"Using the ModelItem Editing Context","nodes":[{"pos":[0,35],"content":"Using the ModelItem Editing Context","nodes":[{"content":"Using the ModelItem Editing Context","pos":[0,35]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[126,161],"content":"Using the ModelItem Editing Context","linkify":"Using the ModelItem Editing Context","nodes":[{"content":"Using the ModelItem Editing Context","pos":[0,35]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Activities.Presentation.Model.ModelItem&gt;</ph> editing context is the object that the host application uses to communicate with the designer.","pos":[162,314],"source":"The <xref:System.Activities.Presentation.Model.ModelItem> editing context is the object that the host application uses to communicate with the designer."},{"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.EditingContext&gt;</ph> exposes two methods, <ph id=\"ph2\">&lt;xref:System.Activities.Presentation.EditingContext.Items%2A&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.Activities.Presentation.EditingContext.Services%2A&gt;</ph>, which can be used","pos":[315,538],"source":"<xref:System.Activities.Presentation.EditingContext> exposes two methods, <xref:System.Activities.Presentation.EditingContext.Items%2A> and <xref:System.Activities.Presentation.EditingContext.Services%2A>, which can be used"},{"pos":[547,567],"content":"The Items collection","linkify":"The Items collection","nodes":[{"content":"The Items collection","pos":[0,20]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Activities.Presentation.EditingContext.Items%2A&gt;</ph> collection is used to access data that is shared between the host and the designer, or data that is available to all designers.","pos":[571,764],"source":"The <xref:System.Activities.Presentation.EditingContext.Items%2A> collection is used to access data that is shared between the host and the designer, or data that is available to all designers."},{"content":"This collection has the following capabilities, accessed via the <ph id=\"ph1\">&lt;xref:System.Activities.Presentation.ContextItemManager&gt;</ph> class:","pos":[765,893],"source":" This collection has the following capabilities, accessed via the <xref:System.Activities.Presentation.ContextItemManager> class:"},{"pos":[1218,1241],"content":"The Services collection","linkify":"The Services collection","nodes":[{"content":"The Services collection","pos":[0,23]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Activities.Presentation.EditingContext.Services%2A&gt;</ph> collection is used to access services that the designer uses to interact with the host, or services that all designers use.","pos":[1245,1437],"source":"The <xref:System.Activities.Presentation.EditingContext.Services%2A> collection is used to access services that the designer uses to interact with the host, or services that all designers use."},{"content":"This collection has the following methods of note:","pos":[1438,1488]},{"pos":[1798,1830],"content":"Assigning a designer an activity","linkify":"Assigning a designer an activity","nodes":[{"content":"Assigning a designer an activity","pos":[0,32]}]},{"content":"To specify which designer an activity uses, the Designer attribute is used.","pos":[1834,1909]},{"pos":[2020,2038],"content":"Creating a service","linkify":"Creating a service","nodes":[{"content":"Creating a service","pos":[0,18]}]},{"content":"To create a service that serves as a conduit of information between the designer and the host, an interface and an implementation must be created.","pos":[2042,2188]},{"content":"The interface is used by the <ph id=\"ph1\">&lt;xref:System.Activities.Presentation.ServiceManager.Publish%2A&gt;</ph> method to define the members of the service, and the implementation contains the logic for the service.","pos":[2189,2385],"source":" The interface is used by the <xref:System.Activities.Presentation.ServiceManager.Publish%2A> method to define the members of the service, and the implementation contains the logic for the service."},{"content":"In the following code example, a service interface and implementation are created.","pos":[2386,2468]},{"pos":[2933,2953],"content":"Publishing a service","linkify":"Publishing a service","nodes":[{"content":"Publishing a service","pos":[0,20]}]},{"pos":[2957,3114],"content":"For a designer to consume a service, it must first be published by the host using the <ph id=\"ph1\">&lt;xref:System.Activities.Presentation.ServiceManager.Publish%2A&gt;</ph> method.","source":"For a designer to consume a service, it must first be published by the host using the <xref:System.Activities.Presentation.ServiceManager.Publish%2A> method."},{"pos":[3202,3226],"content":"Subscribing to a service","linkify":"Subscribing to a service","nodes":[{"content":"Subscribing to a service","pos":[0,24]}]},{"content":"The designer obtains access to the service using the <ph id=\"ph1\">&lt;xref:System.Activities.Presentation.ServiceManager.Subscribe%2A&gt;</ph> method in the <ph id=\"ph2\">&lt;xref:System.Activities.Presentation.WorkflowViewElement.OnModelItemChanged%2A&gt;</ph> method.","pos":[3230,3450],"source":"The designer obtains access to the service using the <xref:System.Activities.Presentation.ServiceManager.Subscribe%2A> method in the <xref:System.Activities.Presentation.WorkflowViewElement.OnModelItemChanged%2A> method."},{"content":"The following code snippet demonstrates how to subscribe to a service.","pos":[3451,3521]},{"pos":[3949,3988],"content":"Sharing data using the Items collection","linkify":"Sharing data using the Items collection","nodes":[{"content":"Sharing data using the Items collection","pos":[0,39]}]},{"content":"Using the Items collection is similar to using the Services collection, except that <ph id=\"ph1\">&lt;xref:System.Activities.Presentation.ContextItemManager.SetValue%2A&gt;</ph> is used instead of Publish.","pos":[3992,4172],"source":"Using the Items collection is similar to using the Services collection, except that <xref:System.Activities.Presentation.ContextItemManager.SetValue%2A> is used instead of Publish."},{"content":"This collection is more appropriate for sharing simple data between the designers and the host, rather than complex functionality.","pos":[4173,4303]},{"pos":[4312,4350],"content":"EditingContext host items and services","linkify":"EditingContext host items and services","nodes":[{"content":"EditingContext host items and services","pos":[0,38]}]},{"content":"The .NET Framework provides a number of built-in items and services accessed through the editing context.","pos":[4354,4459]},{"content":"Items:","pos":[4466,4472]},{"pos":[4482,4687],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.Hosting.AssemblyContextControlItem&gt;</ph>: Manages the list of referenced local assemblies that will be used inside the workflow for controls (such as the expression editor).","source":"<xref:System.Activities.Presentation.Hosting.AssemblyContextControlItem>: Manages the list of referenced local assemblies that will be used inside the workflow for controls (such as the expression editor)."},{"pos":[4697,4813],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.Hosting.ReadOnlyState&gt;</ph>: Indicates whether the designer is in a read-only state.","source":"<xref:System.Activities.Presentation.Hosting.ReadOnlyState>: Indicates whether the designer is in a read-only state."},{"pos":[4823,4939],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.View.Selection&gt;</ph>: Defines the collection of objects that are currently selected.","source":"<xref:System.Activities.Presentation.View.Selection>: Defines the collection of objects that are currently selected."},{"pos":[4949,5024],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.Hosting.WorkflowCommandExtensionItem&gt;</ph>:","source":"<xref:System.Activities.Presentation.Hosting.WorkflowCommandExtensionItem>:"},{"pos":[5034,5168],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.WorkflowFileItem&gt;</ph>: Provides information on the file that the current editing session is based on.","source":"<xref:System.Activities.Presentation.WorkflowFileItem>: Provides information on the file that the current editing session is based on."},{"content":"Services:","pos":[5175,5184]},{"pos":[5194,5411],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.Model.AttachedPropertiesService&gt;</ph>: Allows properties to be added to the current instance, using <ph id=\"ph2\">&lt;xref:System.Activities.Presentation.Model.AttachedPropertiesService.AddProperty%2A&gt;</ph>.","source":"<xref:System.Activities.Presentation.Model.AttachedPropertiesService>: Allows properties to be added to the current instance, using <xref:System.Activities.Presentation.Model.AttachedPropertiesService.AddProperty%2A>."},{"pos":[5421,5533],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.View.DesignerView&gt;</ph>: Allows access to the properties of the designer canvas.","source":"<xref:System.Activities.Presentation.View.DesignerView>: Allows access to the properties of the designer canvas."},{"pos":[5543,5655],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.IActivityToolboxService&gt;</ph>: Allows the contents of the toolbox to be updated.","source":"<xref:System.Activities.Presentation.IActivityToolboxService>: Allows the contents of the toolbox to be updated."},{"pos":[5665,5832],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.Hosting.ICommandService&gt;</ph>: Used to integrate designer commands (such as Context Menu) with custom-provided service implementations.","source":"<xref:System.Activities.Presentation.Hosting.ICommandService>: Used to integrate designer commands (such as Context Menu) with custom-provided service implementations."},{"pos":[5842,5955],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.Debug.IDesignerDebugView&gt;</ph>: Provides functionality for the designer debugger.","source":"<xref:System.Activities.Presentation.Debug.IDesignerDebugView>: Provides functionality for the designer debugger."},{"pos":[5965,6082],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.View.IExpressionEditorService&gt;</ph>: Provides access to the Expression Editor dialog.","source":"<xref:System.Activities.Presentation.View.IExpressionEditorService>: Provides access to the Expression Editor dialog."},{"pos":[6092,6211],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.IIntegratedHelpService&gt;</ph>: Provides the designer with integrated help functionality.","source":"<xref:System.Activities.Presentation.IIntegratedHelpService>: Provides the designer with integrated help functionality."},{"pos":[6221,6435],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.Validation.IValidationErrorService&gt;</ph>: Provides access to validation errors using <ph id=\"ph2\">&lt;xref:System.Activities.Presentation.Validation.IValidationErrorService.ShowValidationErrors%2A&gt;</ph>.","source":"<xref:System.Activities.Presentation.Validation.IValidationErrorService>: Provides access to validation errors using <xref:System.Activities.Presentation.Validation.IValidationErrorService.ShowValidationErrors%2A>."},{"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.IWorkflowDesignerStorageService&gt;</ph>: Provides an internal service to store and retrieve data.","pos":[6445,6572],"source":"<xref:System.Activities.Presentation.IWorkflowDesignerStorageService>: Provides an internal service to store and retrieve data."},{"content":"This service is used internally by the .NET Framework, and is not intended for external use.","pos":[6573,6665]},{"pos":[6675,6874],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.IXamlLoadErrorService&gt;</ph>: Provides access to the XAML load error collection using <ph id=\"ph2\">&lt;xref:System.Activities.Presentation.IXamlLoadErrorService.ShowXamlLoadErrors%2A&gt;</ph>.","source":"<xref:System.Activities.Presentation.IXamlLoadErrorService>: Provides access to the XAML load error collection using <xref:System.Activities.Presentation.IXamlLoadErrorService.ShowXamlLoadErrors%2A>."},{"pos":[6884,7022],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.Services.ModelService&gt;</ph>: Used by the designer to interact with the model of the workflow being edited.","source":"<xref:System.Activities.Presentation.Services.ModelService>: Used by the designer to interact with the model of the workflow being edited."},{"pos":[7032,7213],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.Model.ModelTreeManager&gt;</ph>: Provides access to the root of the model item tree using <ph id=\"ph2\">&lt;xref:System.Activities.Presentation.Model.ModelItem.Root%2A&gt;</ph>.","source":"<xref:System.Activities.Presentation.Model.ModelTreeManager>: Provides access to the root of the model item tree using <xref:System.Activities.Presentation.Model.ModelItem.Root%2A>."},{"pos":[7223,7310],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.UndoEngine&gt;</ph>: Provides undo and redo functionality.","source":"<xref:System.Activities.Presentation.UndoEngine>: Provides undo and redo functionality."},{"pos":[7320,7427],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.Services.ViewService&gt;</ph>: Maps visual elements to underlying model items.","source":"<xref:System.Activities.Presentation.Services.ViewService>: Maps visual elements to underlying model items."},{"pos":[7437,7533],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.View.ViewStateService&gt;</ph>: Stores view states for model items.","source":"<xref:System.Activities.Presentation.View.ViewStateService>: Stores view states for model items."},{"pos":[7543,7667],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.View.VirtualizedContainerService&gt;</ph>: Used to customize the virtual container UI behavior.","source":"<xref:System.Activities.Presentation.View.VirtualizedContainerService>: Used to customize the virtual container UI behavior."},{"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Presentation.Hosting.WindowHelperService&gt;</ph>: Used to register and unregister delegates for event notifications.","pos":[7677,7810],"source":"<xref:System.Activities.Presentation.Hosting.WindowHelperService>: Used to register and unregister delegates for event notifications."},{"content":"Also allows a window owner to be set.","pos":[7811,7848]}]}