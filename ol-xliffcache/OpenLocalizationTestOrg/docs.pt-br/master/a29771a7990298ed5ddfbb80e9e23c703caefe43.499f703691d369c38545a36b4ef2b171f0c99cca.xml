{"content":"---\ntitle: \"How to: Write a Simple Parallel.ForEach Loop | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"foreach, parallel version\"\n  - \"parallel programming, foreach\"\nms.assetid: cb5fab92-1c19-499e-ae91-8b7525dd875f\ncaps.latest.revision: 19\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# How to: Write a Simple Parallel.ForEach Loop\nThis example shows how to use a <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=fullName> loop to enable data parallelism over any <xref:System.Collections.IEnumerable?displayProperty=fullName> or <xref:System.Collections.Generic.IEnumerable%601?displayProperty=fullName> data source.  \n  \n> [!NOTE]\n>  This documentation uses lambda expressions to define delegates in PLINQ. If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).  \n  \n## Example  \n [!code-csharp[TPL_Parallel#03](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_parallel/cs/simpleforeach.cs#03)]\n [!code-vb[TPL_Parallel#03](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_parallel/vb/simpleforeach.vb#03)]  \n  \n A <xref:System.Threading.Tasks.Parallel.ForEach%2A> loop works like a <xref:System.Threading.Tasks.Parallel.For%2A> loop. The source collection is partitioned and the work is scheduled on multiple threads based on the system environment. The more processors on the system, the faster the parallel method runs. For some source collections, a sequential loop may be faster, depending on the size of the source, and the kind of work being performed. For more information about performance, see [Potential Pitfalls in Data and Task Parallelism](../../../docs/standard/parallel-programming/potential-pitfalls-in-data-and-task-parallelism.md)  \n  \n For more information about parallel loops, see [How to: Write a Simple Parallel.For Loop](../../../docs/standard/parallel-programming/how-to-write-a-simple-parallel-for-loop.md).  \n  \n To use <xref:System.Threading.Tasks.Parallel.ForEach%2A> with a non-generic collection, you can use the <xref:System.Linq.Enumerable.Cast%2A> extension method to convert the collection to a generic collection, as shown in the following example:  \n  \n [!code-csharp[TPL_Parallel#07](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_parallel/cs/nongeneric.cs#07)]\n [!code-vb[TPL_Parallel#07](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_parallel/vb/nongeneric.vb#07)]  \n  \n You can also use Parallel LINQ (PLINQ) to parallelize processing of <xref:System.Collections.Generic.IEnumerable%601> data sources. PLINQ enables you to use declarative query syntax to express the loop behavior. For more information, see [Parallel LINQ (PLINQ)](../../../docs/standard/parallel-programming/parallel-linq-plinq.md).  \n  \n## Compiling the Code  \n  \n-   Copy and paste this code into a [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] 2010 Console Application project.  \n  \n-   Add a reference to System.Drawing.dll  \n  \n-   Press F5  \n  \n## See Also  \n [Data Parallelism](../../../docs/standard/parallel-programming/data-parallelism-task-parallel-library.md)   \n [Parallel Programming](../../../docs/standard/parallel-programming/index.md)   \n [Parallel LINQ (PLINQ)](../../../docs/standard/parallel-programming/parallel-linq-plinq.md)","nodes":[{"pos":[4,448],"nodes":[{"content":"How to: Write a Simple Parallel.ForEach Loop | Microsoft Docs","nodes":[{"pos":[0,61],"content":"How to: Write a Simple Parallel.ForEach Loop | Microsoft Docs","nodes":[{"content":"How to: Write a Simple Parallel.ForEach Loop | Microsoft Docs","pos":[0,61]}]}],"pos":[6,70],"yaml":true}],"content":"title: \"How to: Write a Simple Parallel.ForEach Loop | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"foreach, parallel version\"\n  - \"parallel programming, foreach\"\nms.assetid: cb5fab92-1c19-499e-ae91-8b7525dd875f\ncaps.latest.revision: 19\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"","yamlblock":true},{"pos":[455,499],"content":"How to: Write a Simple Parallel.ForEach Loop","linkify":"How to: Write a Simple Parallel.ForEach Loop","nodes":[{"content":"How to: Write a Simple Parallel.ForEach Loop","pos":[0,44]}]},{"content":"This example shows how to use a <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=fullName&gt;</ph> loop to enable data parallelism over any <ph id=\"ph2\">&lt;xref:System.Collections.IEnumerable?displayProperty=fullName&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.Collections.Generic.IEnumerable%601?displayProperty=fullName&gt;</ph> data source.","pos":[500,801],"source":"This example shows how to use a <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=fullName> loop to enable data parallelism over any <xref:System.Collections.IEnumerable?displayProperty=fullName> or <xref:System.Collections.Generic.IEnumerable%601?displayProperty=fullName> data source."},{"pos":[809,1090],"content":"[!NOTE]\n This documentation uses lambda expressions to define delegates in PLINQ. If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).","leadings":["","> "],"nodes":[{"content":"This documentation uses lambda expressions to define delegates in PLINQ. If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).","pos":[9,279],"nodes":[{"content":"This documentation uses lambda expressions to define delegates in PLINQ.","pos":[0,72]},{"content":"If you are not familiar with lambda expressions in C# or Visual Basic, see <bpt id=\"p1\">[</bpt>Lambda Expressions in PLINQ and TPL<ept id=\"p1\">](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md)</ept>.","pos":[73,270],"source":" If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md)."}]}]},{"pos":[1099,1106],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"pos":[1110,1349],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPL_Parallel#03<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_parallel/cs/simpleforeach.cs#03)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPL_Parallel#03<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_parallel/vb/simpleforeach.vb#03)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[TPL_Parallel#03](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_parallel/cs/simpleforeach.cs#03)]\n [!code-vb[TPL_Parallel#03](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_parallel/vb/simpleforeach.vb#03)]"},{"content":"A <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Parallel.ForEach%2A&gt;</ph> loop works like a <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Parallel.For%2A&gt;</ph> loop.","pos":[1356,1477],"source":"A <xref:System.Threading.Tasks.Parallel.ForEach%2A> loop works like a <xref:System.Threading.Tasks.Parallel.For%2A> loop."},{"content":"The source collection is partitioned and the work is scheduled on multiple threads based on the system environment.","pos":[1478,1593]},{"content":"The more processors on the system, the faster the parallel method runs.","pos":[1594,1665]},{"content":"For some source collections, a sequential loop may be faster, depending on the size of the source, and the kind of work being performed.","pos":[1666,1802]},{"content":"For more information about performance, see <bpt id=\"p1\">[</bpt>Potential Pitfalls in Data and Task Parallelism<ept id=\"p1\">](../../../docs/standard/parallel-programming/potential-pitfalls-in-data-and-task-parallelism.md)</ept>","pos":[1803,1992],"source":" For more information about performance, see [Potential Pitfalls in Data and Task Parallelism](../../../docs/standard/parallel-programming/potential-pitfalls-in-data-and-task-parallelism.md)"},{"pos":[1999,2177],"content":"For more information about parallel loops, see <bpt id=\"p1\">[</bpt>How to: Write a Simple Parallel.For Loop<ept id=\"p1\">](../../../docs/standard/parallel-programming/how-to-write-a-simple-parallel-for-loop.md)</ept>.","source":"For more information about parallel loops, see [How to: Write a Simple Parallel.For Loop](../../../docs/standard/parallel-programming/how-to-write-a-simple-parallel-for-loop.md)."},{"content":"To use <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Parallel.ForEach%2A&gt;</ph> with a non-generic collection, you can use the <ph id=\"ph2\">&lt;xref:System.Linq.Enumerable.Cast%2A&gt;</ph> extension method to convert the collection to a generic collection, as shown in the following example:","pos":[2184,2428],"source":"To use <xref:System.Threading.Tasks.Parallel.ForEach%2A> with a non-generic collection, you can use the <xref:System.Linq.Enumerable.Cast%2A> extension method to convert the collection to a generic collection, as shown in the following example:"},{"pos":[2435,2668],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPL_Parallel#07<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_parallel/cs/nongeneric.cs#07)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPL_Parallel#07<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_parallel/vb/nongeneric.vb#07)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[TPL_Parallel#07](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_parallel/cs/nongeneric.cs#07)]\n [!code-vb[TPL_Parallel#07](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_parallel/vb/nongeneric.vb#07)]"},{"content":"You can also use Parallel LINQ (PLINQ) to parallelize processing of <ph id=\"ph1\">&lt;xref:System.Collections.Generic.IEnumerable%601&gt;</ph> data sources.","pos":[2675,2806],"source":"You can also use Parallel LINQ (PLINQ) to parallelize processing of <xref:System.Collections.Generic.IEnumerable%601> data sources."},{"content":"PLINQ enables you to use declarative query syntax to express the loop behavior.","pos":[2807,2886]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Parallel LINQ (PLINQ)<ept id=\"p1\">](../../../docs/standard/parallel-programming/parallel-linq-plinq.md)</ept>.","pos":[2887,3005],"source":" For more information, see [Parallel LINQ (PLINQ)](../../../docs/standard/parallel-programming/parallel-linq-plinq.md)."},{"pos":[3014,3032],"content":"Compiling the Code","linkify":"Compiling the Code","nodes":[{"content":"Compiling the Code","pos":[0,18]}]},{"pos":[3042,3158],"content":"Copy and paste this code into a <ph id=\"ph1\">[!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]</ph> 2010 Console Application project.","source":"Copy and paste this code into a [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] 2010 Console Application project."},{"content":"Add a reference to System.Drawing.dll","pos":[3168,3205]},{"content":"Press F5","pos":[3215,3223]},{"pos":[3232,3240],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Data Parallelism<ept id=\"p1\">](../../../docs/standard/parallel-programming/data-parallelism-task-parallel-library.md)</ept><ph id=\"ph1\"> </ph>","pos":[3244,3350],"source":"[Data Parallelism](../../../docs/standard/parallel-programming/data-parallelism-task-parallel-library.md) "},{"content":"<bpt id=\"p1\">[</bpt>Parallel Programming<ept id=\"p1\">](../../../docs/standard/parallel-programming/index.md)</ept><ph id=\"ph1\"> </ph>","pos":[3354,3431],"source":"[Parallel Programming](../../../docs/standard/parallel-programming/index.md) "},{"content":"<bpt id=\"p1\">[</bpt>Parallel LINQ (PLINQ)<ept id=\"p1\">](../../../docs/standard/parallel-programming/parallel-linq-plinq.md)</ept>","pos":[3435,3526],"source":"[Parallel LINQ (PLINQ)](../../../docs/standard/parallel-programming/parallel-linq-plinq.md)"}]}