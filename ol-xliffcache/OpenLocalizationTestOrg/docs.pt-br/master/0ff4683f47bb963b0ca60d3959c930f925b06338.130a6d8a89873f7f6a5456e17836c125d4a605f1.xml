{"content":"---\ntitle: \"Workflow Security | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"programming [WF], workflow security\"\nms.assetid: d712a566-f435-44c0-b8c0-49298e84b114\ncaps.latest.revision: 13\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Workflow Security\n[!INCLUDE[wf](../../../includes/wf-md.md)] is integrated with several different technologies, such as Microsoft SQL Server and [!INCLUDE[indigo1](../../../includes/indigo1-md.md)]. Interacting with these technologies may introduce security issues into your workflow if done improperly.  \n  \n## Persistence Security Concerns  \n  \n1.  Workflows that use a <xref:System.Activities.Statements.Delay> activity and persistence need to be reactivated by a service. Windows AppFabric uses the Workflow Management Service (WMS) to reactivate workflows with expired timers. WMS creates a <xref:System.ServiceModel.WorkflowServiceHost> to host the reactivated workflow. If the WMS service is stopped, persisted workflows will not be reactivated when their timers expire.  \n  \n2.  Access to durable instancing should be protected against malicious entities external to the application domain. In addition, developers should ensure that malicious code can't be executed in the same application domain as the durable instancing code.  \n  \n3.  Durable instancing should not be run with elevated (Administrator) permissions.  \n  \n4.  Data being processed outside the application domain should be protected.  \n  \n5.  Applications that require security isolation should not share the same instance of the schema abstraction. Such applications should use different store providers, or store providers configured to use different store instantiations.  \n  \n## SQL Server Security Concerns  \n  \n-   When large numbers of child activities, locations, bookmarks, host extensions, or scopes are used, or when bookmarks with very large payloads are used, memory can be exhausted, or undue amounts of database space can be allocated during persistence. This can be mitigated by using object-level and database-level security.  \n  \n-   When using <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore>, the instance store must be secured. [!INCLUDE[crdefault](../../../includes/crdefault-md.md)][SQL Server Best Practices](http://go.microsoft.com/fwlink/?LinkId=164972).  \n  \n-   Sensitive data in the instance store should be encrypted. [!INCLUDE[crdefault](../../../includes/crdefault-md.md)][SQL Security Encryption](http://go.microsoft.com/fwlink/?LinkId=164976).  \n  \n-   Since the database connection string is often included in a configuration file, windows-level security (ACL) should be used to ensure that the configuration file (Web.Config usually) is secure, and that login and password information are not included in the connection string. Windows authentication should be used between the database and the web server instead.  \n  \n## Considerations for WorkflowServiceHost  \n  \n-   [!INCLUDE[indigo1](../../../includes/indigo1-md.md)] endpoints used in workflows should be secured. [!INCLUDE[crdefault](../../../includes/crdefault-md.md)][WCF Security Overview](http://go.microsoft.com/fwlink/?LinkID=164975).  \n  \n-   Host-level authorization can be implemented by using <xref:System.ServiceModel.ServiceAuthorizationManager>. See [How To: Create a Custom Authorization Manager for a Service](http://go.microsoft.com/fwlink/?LinkId=192228) for details. This is also demonstrated in the following sample: [Securing Workflow Services](../../../docs/framework/windows-workflow-foundation/samples/securing-workflow-services.md).  \n  \n-   The ServiceSecurityContext for the incoming message is also available from within workflow by accessing OperationContext.  See [Accessing OperationContext from a Workflow Service](../../../docs/framework/wcf/feature-details/accessing-operationcontext-from-a-workflow-service.md) for details.  \n  \n## WF Security Pack CTP  \n The Microsoft WF Security Pack CTP 1 is the first community technology preview (CTP) release of a set of activities and their implementation based on [Windows Workflow Foundation](http://msdn.microsoft.com/netframework/aa663328.aspx)in [.NET Framework 4](http://msdn.microsoft.com/netframework/default.aspx) (WF 4) and the [Windows Identity Foundation (WIF)](http://msdn.microsoft.com/security/aa570351.aspx).  The Microsoft WF Security Pack CTP 1 contains both activities and their designers which illustrate how to easily enable various security-related scenarios using workflow, including:  \n  \n1.  Impersonating a client identity in the workflow  \n  \n2.  In-workflow authorization, such as PrincipalPermission and validation of Claims  \n  \n3.  Authenticated messaging using ClientCredentials specified in the workflow, such as username/password or a token retrieved from a Security Token Service (STS)  \n  \n4.  Flowing a client security token to a back-end service (claims-based delegation) using WS-Trust ActAs  \n  \n For more information and to download the WF Security Pack CTP, see: [WF Security Pack CTP](http://wf.codeplex.com/releases/view/48114)","nodes":[{"pos":[4,369],"embed":true,"restype":"x-metadata","content":"title: \"Workflow Security | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"programming [WF], workflow security\"\nms.assetid: d712a566-f435-44c0-b8c0-49298e84b114\ncaps.latest.revision: 13\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"","nodes":[{"content":"Workflow Security | Microsoft Docs","nodes":[{"pos":[0,34],"content":"Workflow Security | Microsoft Docs","nodes":[{"content":"Workflow Security | Microsoft Docs","pos":[0,34]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[376,393],"content":"Workflow Security","linkify":"Workflow Security","nodes":[{"content":"Workflow Security","pos":[0,17]}]},{"content":"is integrated with several different technologies, such as Microsoft SQL Server and <ph id=\"ph1\">[!INCLUDE[indigo1](../../../includes/indigo1-md.md)]</ph>.","pos":[437,574],"source":" is integrated with several different technologies, such as Microsoft SQL Server and [!INCLUDE[indigo1](../../../includes/indigo1-md.md)]."},{"content":"Interacting with these technologies may introduce security issues into your workflow if done improperly.","pos":[575,679]},{"pos":[688,717],"content":"Persistence Security Concerns","linkify":"Persistence Security Concerns","nodes":[{"content":"Persistence Security Concerns","pos":[0,29]}]},{"content":"Workflows that use a <ph id=\"ph1\">&lt;xref:System.Activities.Statements.Delay&gt;</ph> activity and persistence need to be reactivated by a service.","pos":[727,851],"source":"Workflows that use a <xref:System.Activities.Statements.Delay> activity and persistence need to be reactivated by a service."},{"content":"Windows AppFabric uses the Workflow Management Service (WMS) to reactivate workflows with expired timers.","pos":[852,957]},{"content":"WMS creates a <ph id=\"ph1\">&lt;xref:System.ServiceModel.WorkflowServiceHost&gt;</ph> to host the reactivated workflow.","pos":[958,1052],"source":" WMS creates a <xref:System.ServiceModel.WorkflowServiceHost> to host the reactivated workflow."},{"content":"If the WMS service is stopped, persisted workflows will not be reactivated when their timers expire.","pos":[1053,1153]},{"content":"Access to durable instancing should be protected against malicious entities external to the application domain.","pos":[1163,1274]},{"content":"In addition, developers should ensure that malicious code can't be executed in the same application domain as the durable instancing code.","pos":[1275,1413]},{"content":"Durable instancing should not be run with elevated (Administrator) permissions.","pos":[1423,1502]},{"content":"Data being processed outside the application domain should be protected.","pos":[1512,1584]},{"content":"Applications that require security isolation should not share the same instance of the schema abstraction.","pos":[1594,1700]},{"content":"Such applications should use different store providers, or store providers configured to use different store instantiations.","pos":[1701,1825]},{"pos":[1834,1862],"content":"SQL Server Security Concerns","linkify":"SQL Server Security Concerns","nodes":[{"content":"SQL Server Security Concerns","pos":[0,28]}]},{"content":"When large numbers of child activities, locations, bookmarks, host extensions, or scopes are used, or when bookmarks with very large payloads are used, memory can be exhausted, or undue amounts of database space can be allocated during persistence.","pos":[1872,2120]},{"content":"This can be mitigated by using object-level and database-level security.","pos":[2121,2193]},{"content":"When using <ph id=\"ph1\">&lt;xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore&gt;</ph>, the instance store must be secured.","pos":[2203,2318],"source":"When using <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore>, the instance store must be secured."},{"content":"<ph id=\"ph1\">[!INCLUDE[crdefault](../../../includes/crdefault-md.md)]</ph><bpt id=\"p1\">[</bpt>SQL Server Best Practices<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=164972)</ept>.","pos":[2319,2450],"source":"[!INCLUDE[crdefault](../../../includes/crdefault-md.md)][SQL Server Best Practices](http://go.microsoft.com/fwlink/?LinkId=164972)."},{"content":"Sensitive data in the instance store should be encrypted.","pos":[2460,2517]},{"content":"<ph id=\"ph1\">[!INCLUDE[crdefault](../../../includes/crdefault-md.md)]</ph><bpt id=\"p1\">[</bpt>SQL Security Encryption<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=164976)</ept>.","pos":[2518,2647],"source":"[!INCLUDE[crdefault](../../../includes/crdefault-md.md)][SQL Security Encryption](http://go.microsoft.com/fwlink/?LinkId=164976)."},{"content":"Since the database connection string is often included in a configuration file, windows-level security (ACL) should be used to ensure that the configuration file (Web.Config usually) is secure, and that login and password information are not included in the connection string.","pos":[2657,2933]},{"content":"Windows authentication should be used between the database and the web server instead.","pos":[2934,3020]},{"pos":[3029,3067],"content":"Considerations for WorkflowServiceHost","linkify":"Considerations for WorkflowServiceHost","nodes":[{"content":"Considerations for WorkflowServiceHost","pos":[0,38]}]},{"content":"endpoints used in workflows should be secured.","pos":[3130,3176]},{"content":"<ph id=\"ph1\">[!INCLUDE[crdefault](../../../includes/crdefault-md.md)]</ph><bpt id=\"p1\">[</bpt>WCF Security Overview<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkID=164975)</ept>.","pos":[3177,3304],"source":"[!INCLUDE[crdefault](../../../includes/crdefault-md.md)][WCF Security Overview](http://go.microsoft.com/fwlink/?LinkID=164975)."},{"content":"Host-level authorization can be implemented by using <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceAuthorizationManager&gt;</ph>.","pos":[3314,3422],"source":"Host-level authorization can be implemented by using <xref:System.ServiceModel.ServiceAuthorizationManager>."},{"content":"See <bpt id=\"p1\">[</bpt>How To: Create a Custom Authorization Manager for a Service<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=192228)</ept> for details.","pos":[3423,3548],"source":" See [How To: Create a Custom Authorization Manager for a Service](http://go.microsoft.com/fwlink/?LinkId=192228) for details."},{"content":"This is also demonstrated in the following sample: <bpt id=\"p1\">[</bpt>Securing Workflow Services<ept id=\"p1\">](../../../docs/framework/windows-workflow-foundation/samples/securing-workflow-services.md)</ept>.","pos":[3549,3720],"source":" This is also demonstrated in the following sample: [Securing Workflow Services](../../../docs/framework/windows-workflow-foundation/samples/securing-workflow-services.md)."},{"content":"The ServiceSecurityContext for the incoming message is also available from within workflow by accessing OperationContext.","pos":[3730,3851]},{"content":"See <bpt id=\"p1\">[</bpt>Accessing OperationContext from a Workflow Service<ept id=\"p1\">](../../../docs/framework/wcf/feature-details/accessing-operationcontext-from-a-workflow-service.md)</ept> for details.","pos":[3853,4021],"source":"  See [Accessing OperationContext from a Workflow Service](../../../docs/framework/wcf/feature-details/accessing-operationcontext-from-a-workflow-service.md) for details."},{"pos":[4030,4050],"content":"WF Security Pack CTP","linkify":"WF Security Pack CTP","nodes":[{"content":"WF Security Pack CTP","pos":[0,20]}]},{"content":"The Microsoft WF Security Pack CTP 1 is the first community technology preview (CTP) release of a set of activities and their implementation based on <bpt id=\"p1\">[</bpt>Windows Workflow Foundation<ept id=\"p1\">](http://msdn.microsoft.com/netframework/aa663328.aspx)</ept>in <bpt id=\"p2\">[</bpt>.NET Framework 4<ept id=\"p2\">](http://msdn.microsoft.com/netframework/default.aspx)</ept> (WF 4) and the <bpt id=\"p3\">[</bpt>Windows Identity Foundation (WIF)<ept id=\"p3\">](http://msdn.microsoft.com/security/aa570351.aspx)</ept>.","pos":[4054,4463],"source":"The Microsoft WF Security Pack CTP 1 is the first community technology preview (CTP) release of a set of activities and their implementation based on [Windows Workflow Foundation](http://msdn.microsoft.com/netframework/aa663328.aspx)in [.NET Framework 4](http://msdn.microsoft.com/netframework/default.aspx) (WF 4) and the [Windows Identity Foundation (WIF)](http://msdn.microsoft.com/security/aa570351.aspx)."},{"content":"The Microsoft WF Security Pack CTP 1 contains both activities and their designers which illustrate how to easily enable various security-related scenarios using workflow, including:","pos":[4465,4646]},{"content":"Impersonating a client identity in the workflow","pos":[4656,4703]},{"content":"In-workflow authorization, such as PrincipalPermission and validation of Claims","pos":[4713,4792]},{"content":"Authenticated messaging using ClientCredentials specified in the workflow, such as username/password or a token retrieved from a Security Token Service (STS)","pos":[4802,4959]},{"content":"Flowing a client security token to a back-end service (claims-based delegation) using WS-Trust ActAs","pos":[4969,5069]},{"pos":[5076,5210],"content":"For more information and to download the WF Security Pack CTP, see: <bpt id=\"p1\">[</bpt>WF Security Pack CTP<ept id=\"p1\">](http://wf.codeplex.com/releases/view/48114)</ept>","source":"For more information and to download the WF Security Pack CTP, see: [WF Security Pack CTP](http://wf.codeplex.com/releases/view/48114)"}]}