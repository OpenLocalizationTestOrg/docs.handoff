{"content":"---\ntitle: \"Buffered Receive | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 9d46d9b9-96c9-4531-9695-ab526b4d704a\ncaps.latest.revision: 7\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Buffered Receive\nThis sample demonstrates how to set up and configure the buffered receive feature in [!INCLUDE[wf](../../../../includes/wf-md.md)]. Buffered receive allows the workflow author to create a workflow without having to worry about the order in which messages are received. The buffered receive feature buffers messages locally and delivers them when the workflow is ready to receive them.  \n  \n## Demonstrates  \n Out-of-order message processing using buffered receive with messaging activities.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Basic\\Services\\BufferedReceive`  \n  \n## Discussion  \n In this sample, a [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] service is implemented using [!INCLUDE[wf1](../../../../includes/wf1-md.md)] and has a sequence of <xref:System.ServiceModel.Activities.Receive> activities. This workflow models a simple loan approval process where the workflow expects three notifications for a loan to be approved. A [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] client application sends three correlated notifications in the reverse order of what the service expects. Because the buffered receive feature is turned on at the service, each out-of-order message is buffered at the service and processed as the workflow becomes ready to receive it.  \n  \n The buffered receive feature requires <xref:System.ServiceModel.Activities.ReceiveContent> support from the binding, therefore the service uses <xref:System.ServiceModel.NetMsmqBinding>. No special configuration is required for the binding, so the defaults are used.  \n  \n```  \n<endpoint address =\"net.msmq://localhost/private/LoanService/Service1.xamlx\"  \n                  binding=\"netMsmqBinding\"  \n                  contract=\"ILoanService\"/>  \n  \n```  \n  \n The service also exposes metadata for the service using <xref:System.ServiceModel.Description.ServiceMetadataBehavior>.  \n  \n Similarly, the client endpoint is configured using <xref:System.ServiceModel.NetMsmqBinding>. The client code and configuration is generated by using the **Add Service Reference** feature of [!INCLUDE[vs_current_short](../../../../includes/vs-current-short-md.md)]. The following example is the generated client endpoint in the App.config file.  \n  \n```  \n<endpoint address=\"net.msmq://localhost/private/LoanService/Service1.xamlx\"  \n                binding=\"netMsmqBinding\" bindingConfiguration=\"NetMsmqBinding_ILoanService\"  \n                contract=\"ServiceReference1.ILoanService\" name=\"NetMsmqBinding_ILoanService\" />  \n  \n```  \n  \n This sample requires that the following Windows components are enabled:  \n  \n1.  [!INCLUDE[iis60](../../../../includes/iis60-md.md)]  \n  \n2.  [!INCLUDE[iis60](../../../../includes/iis60-md.md)] Management Compatibility, Metabase, and Configuration Compatibility  \n  \n3.  World Wide Web Services, Application Development Features, and ASP.NET  \n  \n4.  Microsoft Message Queues (MSMQ) Server  \n  \n#### To set up, and build the sample  \n  \n1.  At a [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] command prompt, register ASP.NET by typing `aspnet_regiis –I` and press ENTER.  \n  \n2.  Run [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] as an Administrator.  \n  \n3.  Open LoanService.sln.  \n  \n4.  When asked if you would like to create the virtual directories for the LoanService project, select **Yes**.  \n  \n#### To set up the service queues  \n  \n1.  Press F5 to run the LoanClient application that creates the queues and activates the service defined in Service1.xamlx.  \n  \n2.  Open the **Computer Management** console by running Compmgmt.msc from a command prompt.  \n  \n3.  In the **Computer Management** console, expand **Service**, **Applications**, **Message Queuing**, **Private Queues**.  \n  \n4.  Right-click the loanservice/service1.xamlx queue and select **Properties**.  \n  \n5.  Select the **Security** tab, and add **Everyone Receives Message**, **Peek Message** and **Send Message** permissions.  \n  \n6.  Open the [!INCLUDE[iis60](../../../../includes/iis60-md.md)] Manager.  \n  \n7.  Browse to **Server**, **Sites**, **Default Web site**, **Private**, **LoanService** and select **Advanced Options**  \n  \n8.  Change the **Enabled Protocols** to be **http**, **net.msmq**.  \n  \n#### To run the sample  \n  \n1.  Browse to http://localhost/private/loanservice/service1.xamlx to ensure that the service is running.  \n  \n2.  Press F5 to run the LoanClient application. Once the workflow is complete, an out.txt file should be saved to C:\\Inbox that contains the result of the message exchange.  \n  \n#### To clean up  \n  \n1.  Open the **Computer Management** console by running Compmgmt.msc from a command prompt.  \n  \n2.  Expand **Service** and **Applications**, **Message Queuing**, **Private Queues**.  \n  \n3.  Delete the loanservice/service1.xamlx queue.  \n  \n4.  Remove the C:\\Inbox directory.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Basic\\Services\\BufferedReceive`","nodes":[{"pos":[4,303],"embed":true,"restype":"x-metadata","content":"title: \"Buffered Receive | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 9d46d9b9-96c9-4531-9695-ab526b4d704a\ncaps.latest.revision: 7\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"","nodes":[{"content":"Buffered Receive | Microsoft Docs","nodes":[{"pos":[0,33],"content":"Buffered Receive | Microsoft Docs","nodes":[{"content":"Buffered Receive | Microsoft Docs","pos":[0,33]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[310,326],"content":"Buffered Receive","linkify":"Buffered Receive","nodes":[{"content":"Buffered Receive","pos":[0,16]}]},{"content":"This sample demonstrates how to set up and configure the buffered receive feature in <ph id=\"ph1\">[!INCLUDE[wf](../../../../includes/wf-md.md)]</ph>.","pos":[327,458],"source":"This sample demonstrates how to set up and configure the buffered receive feature in [!INCLUDE[wf](../../../../includes/wf-md.md)]."},{"content":"Buffered receive allows the workflow author to create a workflow without having to worry about the order in which messages are received.","pos":[459,595]},{"content":"The buffered receive feature buffers messages locally and delivers them when the workflow is ready to receive them.","pos":[596,711]},{"pos":[720,732],"content":"Demonstrates","linkify":"Demonstrates","nodes":[{"content":"Demonstrates","pos":[0,12]}]},{"content":"Out-of-order message processing using buffered receive with messaging activities.","pos":[736,817]},{"pos":[825,957],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[14,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[0,53]},{"content":"Check for the following (default) directory before continuing.","pos":[54,116]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[1011,1337],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[1338,1388]},{"pos":[1474,1484],"content":"Discussion","linkify":"Discussion","nodes":[{"content":"Discussion","pos":[0,10]}]},{"content":"In this sample, a <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> service is implemented using <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> and has a sequence of <ph id=\"ph3\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph> activities.","pos":[1488,1718],"source":"In this sample, a [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] service is implemented using [!INCLUDE[wf1](../../../../includes/wf1-md.md)] and has a sequence of <xref:System.ServiceModel.Activities.Receive> activities."},{"content":"This workflow models a simple loan approval process where the workflow expects three notifications for a loan to be approved.","pos":[1719,1844]},{"content":"A <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> client application sends three correlated notifications in the reverse order of what the service expects.","pos":[1845,2008],"source":" A [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] client application sends three correlated notifications in the reverse order of what the service expects."},{"content":"Because the buffered receive feature is turned on at the service, each out-of-order message is buffered at the service and processed as the workflow becomes ready to receive it.","pos":[2009,2186]},{"content":"The buffered receive feature requires <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.ReceiveContent&gt;</ph> support from the binding, therefore the service uses <ph id=\"ph2\">&lt;xref:System.ServiceModel.NetMsmqBinding&gt;</ph>.","pos":[2193,2379],"source":"The buffered receive feature requires <xref:System.ServiceModel.Activities.ReceiveContent> support from the binding, therefore the service uses <xref:System.ServiceModel.NetMsmqBinding>."},{"content":"No special configuration is required for the binding, so the defaults are used.","pos":[2380,2459]},{"content":"The service also exposes metadata for the service using <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceMetadataBehavior&gt;</ph>.","pos":[2654,2773],"source":"The service also exposes metadata for the service using <xref:System.ServiceModel.Description.ServiceMetadataBehavior>."},{"content":"Similarly, the client endpoint is configured using <ph id=\"ph1\">&lt;xref:System.ServiceModel.NetMsmqBinding&gt;</ph>.","pos":[2780,2873],"source":"Similarly, the client endpoint is configured using <xref:System.ServiceModel.NetMsmqBinding>."},{"content":"The client code and configuration is generated by using the <bpt id=\"p1\">**</bpt>Add Service Reference<ept id=\"p1\">**</ept> feature of <ph id=\"ph1\">[!INCLUDE[vs_current_short](../../../../includes/vs-current-short-md.md)]</ph>.","pos":[2874,3045],"source":" The client code and configuration is generated by using the **Add Service Reference** feature of [!INCLUDE[vs_current_short](../../../../includes/vs-current-short-md.md)]."},{"content":"The following example is the generated client endpoint in the App.config file.","pos":[3046,3124]},{"content":"This sample requires that the following Windows components are enabled:","pos":[3419,3490]},{"pos":[3613,3680],"content":"Management Compatibility, Metabase, and Configuration Compatibility"},{"content":"World Wide Web Services, Application Development Features, and ASP.NET","pos":[3690,3760]},{"content":"Microsoft Message Queues (MSMQ) Server","pos":[3770,3808]},{"pos":[3819,3850],"content":"To set up, and build the sample","linkify":"To set up, and build the sample","nodes":[{"content":"To set up, and build the sample","pos":[0,31]}]},{"pos":[3860,3997],"content":"At a <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph> command prompt, register ASP.NET by typing <ph id=\"ph2\">`aspnet_regiis –I`</ph> and press ENTER.","source":"At a [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] command prompt, register ASP.NET by typing `aspnet_regiis –I` and press ENTER."},{"pos":[4007,4085],"content":"Run <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph> as an Administrator.","source":"Run [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] as an Administrator."},{"content":"Open LoanService.sln.","pos":[4095,4116]},{"pos":[4126,4233],"content":"When asked if you would like to create the virtual directories for the LoanService project, select <bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>.","source":"When asked if you would like to create the virtual directories for the LoanService project, select **Yes**."},{"pos":[4244,4272],"content":"To set up the service queues","linkify":"To set up the service queues","nodes":[{"content":"To set up the service queues","pos":[0,28]}]},{"content":"Press F5 to run the LoanClient application that creates the queues and activates the service defined in Service1.xamlx.","pos":[4282,4401]},{"pos":[4411,4498],"content":"Open the <bpt id=\"p1\">**</bpt>Computer Management<ept id=\"p1\">**</ept> console by running Compmgmt.msc from a command prompt.","source":"Open the **Computer Management** console by running Compmgmt.msc from a command prompt."},{"pos":[4508,4626],"content":"In the <bpt id=\"p1\">**</bpt>Computer Management<ept id=\"p1\">**</ept> console, expand <bpt id=\"p2\">**</bpt>Service<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Applications<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>Message Queuing<ept id=\"p4\">**</ept>, <bpt id=\"p5\">**</bpt>Private Queues<ept id=\"p5\">**</ept>.","source":"In the **Computer Management** console, expand **Service**, **Applications**, **Message Queuing**, **Private Queues**."},{"pos":[4636,4711],"content":"Right-click the loanservice/service1.xamlx queue and select <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>.","source":"Right-click the loanservice/service1.xamlx queue and select **Properties**."},{"pos":[4721,4839],"content":"Select the <bpt id=\"p1\">**</bpt>Security<ept id=\"p1\">**</ept> tab, and add <bpt id=\"p2\">**</bpt>Everyone Receives Message<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Peek Message<ept id=\"p3\">**</ept> and <bpt id=\"p4\">**</bpt>Send Message<ept id=\"p4\">**</ept> permissions.","source":"Select the **Security** tab, and add **Everyone Receives Message**, **Peek Message** and **Send Message** permissions."},{"pos":[4849,4918],"content":"Open the <ph id=\"ph1\">[!INCLUDE[iis60](../../../../includes/iis60-md.md)]</ph> Manager.","source":"Open the [!INCLUDE[iis60](../../../../includes/iis60-md.md)] Manager."},{"pos":[4928,5043],"content":"Browse to <bpt id=\"p1\">**</bpt>Server<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Sites<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Default Web site<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>Private<ept id=\"p4\">**</ept>, <bpt id=\"p5\">**</bpt>LoanService<ept id=\"p5\">**</ept> and select <bpt id=\"p6\">**</bpt>Advanced Options<ept id=\"p6\">**</ept>","source":"Browse to **Server**, **Sites**, **Default Web site**, **Private**, **LoanService** and select **Advanced Options**"},{"pos":[5053,5115],"content":"Change the <bpt id=\"p1\">**</bpt>Enabled Protocols<ept id=\"p1\">**</ept> to be <bpt id=\"p2\">**</bpt>http<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>net.msmq<ept id=\"p3\">**</ept>.","source":"Change the **Enabled Protocols** to be **http**, **net.msmq**."},{"pos":[5126,5143],"content":"To run the sample","linkify":"To run the sample","nodes":[{"content":"To run the sample","pos":[0,17]}]},{"content":"Browse to http://localhost/private/loanservice/service1.xamlx to ensure that the service is running.","pos":[5153,5253]},{"content":"Press F5 to run the LoanClient application.","pos":[5263,5306]},{"content":"Once the workflow is complete, an out.txt file should be saved to C:\\Inbox that contains the result of the message exchange.","pos":[5307,5431]},{"pos":[5442,5453],"content":"To clean up","linkify":"To clean up","nodes":[{"content":"To clean up","pos":[0,11]}]},{"pos":[5463,5550],"content":"Open the <bpt id=\"p1\">**</bpt>Computer Management<ept id=\"p1\">**</ept> console by running Compmgmt.msc from a command prompt.","source":"Open the **Computer Management** console by running Compmgmt.msc from a command prompt."},{"pos":[5560,5641],"content":"Expand <bpt id=\"p1\">**</bpt>Service<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Applications<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Message Queuing<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>Private Queues<ept id=\"p4\">**</ept>.","source":"Expand **Service** and **Applications**, **Message Queuing**, **Private Queues**."},{"content":"Delete the loanservice/service1.xamlx queue.","pos":[5651,5695]},{"content":"Remove the C:\\Inbox directory.","pos":[5705,5735]},{"pos":[5743,5875],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[14,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[0,53]},{"content":"Check for the following (default) directory before continuing.","pos":[54,116]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[5929,6255],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[6256,6306]}]}