{"content":"---\ntitle: \"Automatic Format Selection | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: dab51e56-8517-4a6a-bb54-b55b15ab37bb\ncaps.latest.revision: 8\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Automatic Format Selection\nThis sample demonstrates how to enable automatic format selection (XML or JSON) with the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] REST programming model, as well as how to explicitly set the format in the operation code.  \n  \n## Sample Details  \n The sample consists of a service along with client code that makes requests to the service. The service supports a single HTTP `GET` operation (`EchoWithGet`) and a single HTTP `POST` operation (`EchoWithPost`). Both operations expect a string and then return the string in the response. With the `GET` operation, the string is provided in a URI query-string parameter. With the `POST` operation, the string is provided in the body of the request, serialized in XML. The service is able to return responses in either XML or JSON, utilizing the new automatic format selection and imperative format selection features in [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)].  \n  \n In the sample, automatic format selection is enabled using the App.config file. On the default Web HTTP endpoint, the `automaticFormatSelectionEnabled` attribute has been given a value of `true`. With automatic format selection enabled, the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] infrastructure selects the most appropriate response format (XML or JSON) given the HTTP Accept or Content-Type headers of the request. The developer is not required to provide any additional code or configuration other than setting the `automaticFormatSelectionEnabled` attribute to `true` to use this new feature. In the client code in Program.cs, requests are sent to both the `GET` and `POST` operations of the service with the HTTP Accept header specified as either \"application/xml\" or \"application/json\" and the service returns a response in that respective format.  \n  \n Also in the `GET` operation, imperative format selection is used. The `GET` operation checks for an optional `format` query-string parameter and if present, sets the response format on the <xref:System.ServiceModel.Web.WebOperationContext.OutgoingResponse%2A> property. Imperatively setting the response format in this way overrides the automatic format selection done by the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] infrastructure.  \n  \n The sample consists of a self-hosted service and a client that runs within a console application. As the console application runs, the client makes requests to the service and writes the pertinent information from the responses to the console window.  \n  \n#### To use this sample  \n  \n1.  Open the solution for the Automatic Format Selection Sample. When launching [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], you must run as an administrator for the sample to execute successfully. Do this by right-clicking the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icon and select **Run as Administrator** from the context menu.  \n  \n2.  Press CTRL+SHIFT+B to build the solution and then press Ctrl+F5 to run the console application AutomaticFormatSelection project. The console window appears and provides the URI of the running service and the URI of the HTML help page for the running service.  \n  \n3.  As the sample runs, the client sends requests to the service and writes the responses to the console window. Notice the different formats of the responses in XML and JSON.  \n  \n4.  Press any key to terminate the sample.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Web\\AutomaticFormatSelection`  \n  \n## See Also","nodes":[{"pos":[12,55],"content":"Automatic Format Selection | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Automatic Format Selection | Microsoft Docs","pos":[0,43]}]},{"pos":[353,379],"content":"Automatic Format Selection","linkify":"Automatic Format Selection","nodes":[{"content":"Automatic Format Selection","pos":[0,26]}]},{"pos":[380,615],"content":"This sample demonstrates how to enable automatic format selection (XML or JSON) with the <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> REST programming model, as well as how to explicitly set the format in the operation code.","source":"This sample demonstrates how to enable automatic format selection (XML or JSON) with the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] REST programming model, as well as how to explicitly set the format in the operation code."},{"pos":[624,638],"content":"Sample Details","linkify":"Sample Details","nodes":[{"content":"Sample Details","pos":[0,14]}]},{"content":"The sample consists of a service along with client code that makes requests to the service.","pos":[642,733]},{"content":"The service supports a single HTTP <ph id=\"ph1\">`GET`</ph> operation (<ph id=\"ph2\">`EchoWithGet`</ph>) and a single HTTP <ph id=\"ph3\">`POST`</ph> operation (<ph id=\"ph4\">`EchoWithPost`</ph>).","pos":[734,853],"source":" The service supports a single HTTP `GET` operation (`EchoWithGet`) and a single HTTP `POST` operation (`EchoWithPost`)."},{"content":"Both operations expect a string and then return the string in the response.","pos":[854,929]},{"content":"With the <ph id=\"ph1\">`GET`</ph> operation, the string is provided in a URI query-string parameter.","pos":[930,1011],"source":" With the `GET` operation, the string is provided in a URI query-string parameter."},{"content":"With the <ph id=\"ph1\">`POST`</ph> operation, the string is provided in the body of the request, serialized in XML.","pos":[1012,1108],"source":" With the `POST` operation, the string is provided in the body of the request, serialized in XML."},{"content":"The service is able to return responses in either XML or JSON, utilizing the new automatic format selection and imperative format selection features in <ph id=\"ph1\">[!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)]</ph>.","pos":[1109,1327],"source":" The service is able to return responses in either XML or JSON, utilizing the new automatic format selection and imperative format selection features in [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)]."},{"content":"In the sample, automatic format selection is enabled using the App.config file.","pos":[1334,1413]},{"content":"On the default Web HTTP endpoint, the <ph id=\"ph1\">`automaticFormatSelectionEnabled`</ph> attribute has been given a value of <ph id=\"ph2\">`true`</ph>.","pos":[1414,1529],"source":" On the default Web HTTP endpoint, the `automaticFormatSelectionEnabled` attribute has been given a value of `true`."},{"content":"With automatic format selection enabled, the <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> infrastructure selects the most appropriate response format (XML or JSON) given the HTTP Accept or Content-Type headers of the request.","pos":[1530,1766],"source":" With automatic format selection enabled, the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] infrastructure selects the most appropriate response format (XML or JSON) given the HTTP Accept or Content-Type headers of the request."},{"content":"The developer is not required to provide any additional code or configuration other than setting the <ph id=\"ph1\">`automaticFormatSelectionEnabled`</ph> attribute to <ph id=\"ph2\">`true`</ph> to use this new feature.","pos":[1767,1946],"source":" The developer is not required to provide any additional code or configuration other than setting the `automaticFormatSelectionEnabled` attribute to `true` to use this new feature."},{"content":"In the client code in Program.cs, requests are sent to both the <ph id=\"ph1\">`GET`</ph> and <ph id=\"ph2\">`POST`</ph> operations of the service with the HTTP Accept header specified as either \"application/xml\" or \"application/json\" and the service returns a response in that respective format.","pos":[1947,2203],"source":" In the client code in Program.cs, requests are sent to both the `GET` and `POST` operations of the service with the HTTP Accept header specified as either \"application/xml\" or \"application/json\" and the service returns a response in that respective format."},{"content":"Also in the <ph id=\"ph1\">`GET`</ph> operation, imperative format selection is used.","pos":[2210,2275],"source":"Also in the `GET` operation, imperative format selection is used."},{"content":"The <ph id=\"ph1\">`GET`</ph> operation checks for an optional <ph id=\"ph2\">`format`</ph> query-string parameter and if present, sets the response format on the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Web.WebOperationContext.OutgoingResponse%2A&gt;</ph> property.","pos":[2276,2479],"source":" The `GET` operation checks for an optional `format` query-string parameter and if present, sets the response format on the <xref:System.ServiceModel.Web.WebOperationContext.OutgoingResponse%2A> property."},{"content":"Imperatively setting the response format in this way overrides the automatic format selection done by the <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> infrastructure.","pos":[2480,2657],"source":" Imperatively setting the response format in this way overrides the automatic format selection done by the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] infrastructure."},{"content":"The sample consists of a self-hosted service and a client that runs within a console application.","pos":[2664,2761]},{"content":"As the console application runs, the client makes requests to the service and writes the pertinent information from the responses to the console window.","pos":[2762,2914]},{"pos":[2925,2943],"content":"To use this sample","linkify":"To use this sample","nodes":[{"content":"To use this sample","pos":[0,18]}]},{"content":"Open the solution for the Automatic Format Selection Sample.","pos":[2953,3013]},{"content":"When launching <ph id=\"ph1\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph>, you must run as an administrator for the sample to execute successfully.","pos":[3014,3174],"source":" When launching [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], you must run as an administrator for the sample to execute successfully."},{"content":"Do this by right-clicking the <ph id=\"ph1\">[!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)]</ph> icon and select <bpt id=\"p1\">**</bpt>Run as Administrator<ept id=\"p1\">**</ept> from the context menu.","pos":[3175,3340],"source":" Do this by right-clicking the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icon and select **Run as Administrator** from the context menu."},{"content":"Press CTRL+SHIFT+B to build the solution and then press Ctrl+F5 to run the console application AutomaticFormatSelection project.","pos":[3350,3478]},{"content":"The console window appears and provides the URI of the running service and the URI of the HTML help page for the running service.","pos":[3479,3608]},{"content":"As the sample runs, the client sends requests to the service and writes the responses to the console window.","pos":[3618,3726]},{"content":"Notice the different formats of the responses in XML and JSON.","pos":[3727,3789]},{"content":"Press any key to terminate the sample.","pos":[3799,3837]},{"pos":[3845,3977],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[4031,4357],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[4358,4408]},{"pos":[4499,4507],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]}]}