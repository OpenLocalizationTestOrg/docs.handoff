{"content":"---\ntitle: Reducing Package Dependencies with project.json\ndescription: Reducing Package Dependencies with project.json\nkeywords: .NET, .NET Core\nauthor: cartermp\nms.author: mairaw\nms.date: 06/20/2016\nms.topic: article\nms.prod: .net-core\nms.devlang: dotnet\nms.assetid: 916251e3-87f9-4eee-81ec-94076215e6fa\n---\n\n# Reducing Package Dependencies with project.json\n\nThis article covers what you need to know about reducing your package dependencies when authoring `project.json` libraries. By the end of this article, you will learn how to compose your library such that it only uses the dependencies it needs. \n\n## Why it's Important\n\n.NET Core is a product made up of NuGet packages.  An essential package is the [.NET Standard Library metapackage](https://www.nuget.org/packages/NETStandard.Library), which is a NuGet package composed of other packages.  It provides you with the set of packages that are guaranteed to work on multiple .NET implementations, such as .NET Framework, .NET Core and Xamarin/Mono.\n\nHowever, there's a good chance that your library won't use every single package it contains.  When authoring a library and distributing it over NuGet, it's a best practice to \"trim\" your dependencies down to only the packages you actually use.  This results in a smaller overall footprint for NuGet packages.\n\n## How to do it\n\nCurrently, there is no official `dotnet` command which trims package references.  Instead, you'll have to do it manually.  The general process looks like the following:\n\n1. Reference `NETStandard.Library` version `1.6.0` in a `dependencies` section of your `project.json`.\n2. Restore packages with `dotnet restore` from the command line.\n3. Inspect the `project.lock.json` file and find the `NETSTandard.Library` section.  It's near the beginning of the file.\n4. Copy all of the listed packages under `dependencies`.\n5. Remove the `.NETStandard.Library` reference and replace it with the copied packages.\n6. Remove references to packages you don't need.\n\nYou can find out which packages you don't need by one of the following ways:\n\n1. Trial and error.  This involves removing a package, restoring, seeing if your library still compiles, and repeating this process.\n2. Using a tool such as [ILSpy](http://ilspy.net) or [.NET Reflector](http://www.red-gate.com/products/dotnet-development/reflector) to peek at references to see what your code is actually using.  You can then remove packages which don't correspond to types you're using.\n\n## Example \n\nImagine that you wrote a library which provided additional functionality to generic collection types.  Such a library would need to depend on packages such as `System.Collections`, but may not at all depend on packages such as `System.Net.Http`.  As such, it would be good to trim package dependencies down to only what this library required!\n\nTo trim this library, you start with the `project.json` file and add a reference to `NETStandard.Library` version `1.6.0`.\n\n```json\n{\n    \"version\":\"1.0.0\",\n    \"dependencies\":{\n        \"NETStandard.Library\":\"1.6.0\"\n    },\n    \"frameworks\": {\n        \"netstandard1.0\": {}\n     }\n}\n```\n\nNext, you restore packages with `dotnet restore`, inspect the `project.lock.json` file, and find all the packages restored for `NETSTandard.Library`.\n\nHere's what the relevant section in the `project.lock.json` file looks like when targeting `netstandard1.0`:\n\n```json\n\"NETStandard.Library/1.6.0\":{\n    \"type\": \"package\",\n    \"dependencies\": {\n        \"Microsoft.NETCore.Platforms\": \"1.0.1\",\n        \"Microsoft.NETCore.Runtime\": \"1.0.2\",\n        \"System.Collections\": \"4.0.11\",\n        \"System.Diagnostics.Debug\": \"4.0.11\",\n        \"System.Diagnostics.Tools\": \"4.0.1\",\n        \"System.Globalization\": \"4.0.11\",\n        \"System.IO\": \"4.1.0\",\n        \"System.Linq\": \"4.1.0\",\n        \"System.Net.Primitives\": \"4.0.11\",\n        \"System.ObjectModel\": \"4.0.12\",\n        \"System.Reflection\": \"4.1.0\",\n        \"System.Reflection.Extensions\": \"4.0.1\",\n        \"System.Reflection.Primitives\": \"4.0.1\",\n        \"System.Resources.ResourceManager\": \"4.0.1\",\n        \"System.Runtime\": \"4.1.0\",\n        \"System.Runtime.Extensions\": \"4.1.0\",\n        \"System.Text.Encoding\": \"4.0.11\",\n        \"System.Text.Encoding.Extensions\": \"4.0.11\",\n        \"System.Text.RegularExpressions\": \"4.1.0\",\n        \"System.Threading\": \"4.0.11\",\n        \"System.Threading.Tasks\": \"4.0.11\",\n        \"System.Xml.ReaderWriter\": \"4.0.11\",\n        \"System.Xml.XDocument\": \"4.0.11\"\n    }\n}\n```\n\nNext, copy over the package references into the `dependencies` section of the library's `project.json` file, replacing the `NETStandard.Library` reference:\n\n```json\n{\n    \"version\":\"1.0.0\",\n    \"dependencies\":{\n        \"Microsoft.NETCore.Platforms\": \"1.0.1\",\n        \"Microsoft.NETCore.Runtime\": \"1.0.2\",\n        \"System.Collections\": \"4.0.11\",\n        \"System.Diagnostics.Debug\": \"4.0.11\",\n        \"System.Diagnostics.Tools\": \"4.0.1\",\n        \"System.Globalization\": \"4.0.11\",\n        \"System.IO\": \"4.1.0\",\n        \"System.Linq\": \"4.1.0\",\n        \"System.Net.Primitives\": \"4.0.11\",\n        \"System.ObjectModel\": \"4.0.12\",\n        \"System.Reflection\": \"4.1.0\",\n        \"System.Reflection.Extensions\": \"4.0.1\",\n        \"System.Reflection.Primitives\": \"4.0.1\",\n        \"System.Resources.ResourceManager\": \"4.0.1\",\n        \"System.Runtime\": \"4.1.0\",\n        \"System.Runtime.Extensions\": \"4.1.0\",\n        \"System.Text.Encoding\": \"4.0.11\",\n        \"System.Text.Encoding.Extensions\": \"4.0.11\",\n        \"System.Text.RegularExpressions\": \"4.1.0\",\n        \"System.Threading\": \"4.0.11\",\n        \"System.Threading.Tasks\": \"4.0.11\",\n        \"System.Xml.ReaderWriter\": \"4.0.11\",\n        \"System.Xml.XDocument\": \"4.0.11\"\n    },\n    \"frameworks\":{\n        \"netstandard1.0\": {}\n    }\n}\n```\n\nThat's quite a lot of packages, many of which which certainly aren't necessary for extending collection types.  You can either remove packages manually or use a tool such as [ILSpy](http://ilspy.net) or [.NET Reflector](http://www.red-gate.com/products/dotnet-development/reflector) to identify which packages your code actually uses.\n\nHere's what a trimmed package could look like:\n\n```json\n{\n    \"dependencies\":{\n        \"Microsoft.NETCore.Platforms\": \"1.0.1\",\n        \"Microsoft.NETCore.Runtime\": \"1.0.2\",\n        \"System.Collections\": \"4.0.11\",\n        \"System.Linq\": \"4.1.0\",\n        \"System.Runtime\": \"4.1.0\",\n        \"System.Runtime.Extensions\": \"4.1.0\",\n        \"System.Runtime.Handles\": \"4.0.1\",\n        \"System.Runtime.InteropServices\": \"4.1.0\",\n        \"System.Runtime.InteropServices.RuntimeInformation\": \"4.0.0\",\n        \"System.Threading.Tasks\": \"4.0.11\"\n    },\n    \"frameworks\":{\n        \"netstandard1.0\": {}\n     }\n}\n```\n\nNow, it has a smaller footprint than if it had depended on the `NETStandard.Library` metapackage.\n","nodes":[{"pos":[11,58],"content":"Reducing Package Dependencies with project.json","needQuote":true,"needEscape":true,"nodes":[{"content":"Reducing Package Dependencies with project.json","pos":[0,47]}]},{"pos":[72,119],"content":"Reducing Package Dependencies with project.json","needQuote":true,"needEscape":true,"nodes":[{"content":"Reducing Package Dependencies with project.json","pos":[0,47]}]},{"pos":[130,145],"content":".NET, .NET Core","needQuote":true,"needEscape":true,"nodes":[{"content":".NET, .NET Core","pos":[0,15]}]},{"pos":[313,360],"content":"Reducing Package Dependencies with project.json","linkify":"Reducing Package Dependencies with project.json","nodes":[{"content":"Reducing Package Dependencies with project.json","pos":[0,47]}]},{"content":"This article covers what you need to know about reducing your package dependencies when authoring <ph id=\"ph1\">`project.json`</ph> libraries.","pos":[362,485],"source":"This article covers what you need to know about reducing your package dependencies when authoring `project.json` libraries."},{"content":"By the end of this article, you will learn how to compose your library such that it only uses the dependencies it needs.","pos":[486,606]},{"pos":[612,630],"content":"Why it's Important","linkify":"Why it's Important","nodes":[{"content":"Why it's Important","pos":[0,18]}]},{"content":".NET Core is a product made up of NuGet packages.","pos":[632,681]},{"content":"An essential package is the <bpt id=\"p1\">[</bpt>.NET Standard Library metapackage<ept id=\"p1\">](https://www.nuget.org/packages/NETStandard.Library)</ept>, which is a NuGet package composed of other packages.","pos":[683,852],"source":"  An essential package is the [.NET Standard Library metapackage](https://www.nuget.org/packages/NETStandard.Library), which is a NuGet package composed of other packages."},{"content":"It provides you with the set of packages that are guaranteed to work on multiple .NET implementations, such as .NET Framework, .NET Core and Xamarin/Mono.","pos":[854,1008]},{"content":"However, there's a good chance that your library won't use every single package it contains.","pos":[1010,1102]},{"content":"When authoring a library and distributing it over NuGet, it's a best practice to \"trim\" your dependencies down to only the packages you actually use.","pos":[1104,1253]},{"content":"This results in a smaller overall footprint for NuGet packages.","pos":[1255,1318]},{"pos":[1323,1335],"content":"How to do it","linkify":"How to do it","nodes":[{"content":"How to do it","pos":[0,12]}]},{"content":"Currently, there is no official <ph id=\"ph1\">`dotnet`</ph> command which trims package references.","pos":[1337,1417],"source":"Currently, there is no official `dotnet` command which trims package references."},{"content":"Instead, you'll have to do it manually.","pos":[1419,1458]},{"content":"The general process looks like the following:","pos":[1460,1505]},{"pos":[1510,1609],"content":"Reference <ph id=\"ph1\">`NETStandard.Library`</ph> version <ph id=\"ph2\">`1.6.0`</ph> in a <ph id=\"ph3\">`dependencies`</ph> section of your <ph id=\"ph4\">`project.json`</ph>.","source":"Reference `NETStandard.Library` version `1.6.0` in a `dependencies` section of your `project.json`."},{"pos":[1613,1674],"content":"Restore packages with <ph id=\"ph1\">`dotnet restore`</ph> from the command line.","source":"Restore packages with `dotnet restore` from the command line."},{"content":"Inspect the <ph id=\"ph1\">`project.lock.json`</ph> file and find the <ph id=\"ph2\">`NETSTandard.Library`</ph> section.","pos":[1678,1758],"source":"Inspect the `project.lock.json` file and find the `NETSTandard.Library` section."},{"content":"It's near the beginning of the file.","pos":[1760,1796]},{"pos":[1800,1853],"content":"Copy all of the listed packages under <ph id=\"ph1\">`dependencies`</ph>.","source":"Copy all of the listed packages under `dependencies`."},{"pos":[1857,1941],"content":"Remove the <ph id=\"ph1\">`.NETStandard.Library`</ph> reference and replace it with the copied packages.","source":"Remove the `.NETStandard.Library` reference and replace it with the copied packages."},{"content":"Remove references to packages you don't need.","pos":[1945,1990]},{"content":"You can find out which packages you don't need by one of the following ways:","pos":[1992,2068]},{"content":"Trial and error.","pos":[2073,2089]},{"content":"This involves removing a package, restoring, seeing if your library still compiles, and repeating this process.","pos":[2091,2202]},{"content":"Using a tool such as <bpt id=\"p1\">[</bpt>ILSpy<ept id=\"p1\">](http://ilspy.net)</ept> or <bpt id=\"p2\">[</bpt>.NET Reflector<ept id=\"p2\">](http://www.red-gate.com/products/dotnet-development/reflector)</ept> to peek at references to see what your code is actually using.","pos":[2206,2398],"source":"Using a tool such as [ILSpy](http://ilspy.net) or [.NET Reflector](http://www.red-gate.com/products/dotnet-development/reflector) to peek at references to see what your code is actually using."},{"content":"You can then remove packages which don't correspond to types you're using.","pos":[2400,2474]},{"pos":[2479,2486],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"Imagine that you wrote a library which provided additional functionality to generic collection types.","pos":[2489,2590]},{"content":"Such a library would need to depend on packages such as <ph id=\"ph1\">`System.Collections`</ph>, but may not at all depend on packages such as <ph id=\"ph2\">`System.Net.Http`</ph>.","pos":[2592,2734],"source":"  Such a library would need to depend on packages such as `System.Collections`, but may not at all depend on packages such as `System.Net.Http`."},{"content":"As such, it would be good to trim package dependencies down to only what this library required!","pos":[2736,2831]},{"pos":[2833,2955],"content":"To trim this library, you start with the <ph id=\"ph1\">`project.json`</ph> file and add a reference to <ph id=\"ph2\">`NETStandard.Library`</ph> version <ph id=\"ph3\">`1.6.0`</ph>.","source":"To trim this library, you start with the `project.json` file and add a reference to `NETStandard.Library` version `1.6.0`."},{"pos":[3119,3268],"content":"Next, you restore packages with <ph id=\"ph1\">`dotnet restore`</ph>, inspect the <ph id=\"ph2\">`project.lock.json`</ph> file, and find all the packages restored for <ph id=\"ph3\">`NETSTandard.Library`</ph>.","source":"Next, you restore packages with `dotnet restore`, inspect the `project.lock.json` file, and find all the packages restored for `NETSTandard.Library`."},{"pos":[3270,3378],"content":"Here's what the relevant section in the <ph id=\"ph1\">`project.lock.json`</ph> file looks like when targeting <ph id=\"ph2\">`netstandard1.0`</ph>:","source":"Here's what the relevant section in the `project.lock.json` file looks like when targeting `netstandard1.0`:"},{"pos":[4472,4627],"content":"Next, copy over the package references into the <ph id=\"ph1\">`dependencies`</ph> section of the library's <ph id=\"ph2\">`project.json`</ph> file, replacing the <ph id=\"ph3\">`NETStandard.Library`</ph> reference:","source":"Next, copy over the package references into the `dependencies` section of the library's `project.json` file, replacing the `NETStandard.Library` reference:"},{"content":"That's quite a lot of packages, many of which which certainly aren't necessary for extending collection types.","pos":[5747,5857]},{"content":"You can either remove packages manually or use a tool such as <bpt id=\"p1\">[</bpt>ILSpy<ept id=\"p1\">](http://ilspy.net)</ept> or <bpt id=\"p2\">[</bpt>.NET Reflector<ept id=\"p2\">](http://www.red-gate.com/products/dotnet-development/reflector)</ept> to identify which packages your code actually uses.","pos":[5859,6081],"source":"  You can either remove packages manually or use a tool such as [ILSpy](http://ilspy.net) or [.NET Reflector](http://www.red-gate.com/products/dotnet-development/reflector) to identify which packages your code actually uses."},{"content":"Here's what a trimmed package could look like:","pos":[6083,6129]},{"pos":[6685,6782],"content":"Now, it has a smaller footprint than if it had depended on the <ph id=\"ph1\">`NETStandard.Library`</ph> metapackage.","source":"Now, it has a smaller footprint than if it had depended on the `NETStandard.Library` metapackage."}]}