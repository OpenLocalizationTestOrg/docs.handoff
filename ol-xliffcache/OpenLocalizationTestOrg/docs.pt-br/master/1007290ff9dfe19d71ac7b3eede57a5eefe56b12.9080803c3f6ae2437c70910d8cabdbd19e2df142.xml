{"content":"---\ntitle: \"Walkthrough: Creating a Dataflow Pipeline | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: dotnet-standard\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"dataflow pipelines, creating with TPL\"\n  - \"Task Parallel Library, dataflows\"\n  - \"TPL dataflow library, creating dataflow pipeline\"\nms.assetid: 69308f82-aa22-4ac5-833d-e748533b58e8\ncaps.latest.revision: 11\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# Walkthrough: Creating a Dataflow Pipeline\nAlthough you can use the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Receive%2A?displayProperty=fullName>, <xref:System.Threading.Tasks.Dataflow.DataflowBlock.ReceiveAsync%2A?displayProperty=fullName>, and <xref:System.Threading.Tasks.Dataflow.DataflowBlock.TryReceive%2A?displayProperty=fullName> methods to receive messages from source blocks, you can also connect message blocks to form a *dataflow pipeline*. A dataflow pipeline is a series of components, or *dataflow blocks*, each of which performs a specific task that contributes to a larger goal. Every dataflow block in a dataflow pipeline performs work when it receives a message from another dataflow block. An analogy to this is an assembly line for automobile manufacturing. As each vehicle passes through the assembly line, one station assembles the frame, the next one installs the engine, and so on. Because an assembly line enables multiple vehicles to be assembled at the same time, it provides better throughput than assembling complete vehicles one at a time.  \n  \n> [!TIP]\n>  The TPL Dataflow Library (<xref:System.Threading.Tasks.Dataflow?displayProperty=fullName> namespace) is not distributed with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)]. To install the <xref:System.Threading.Tasks.Dataflow> namespace, open your project in [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], choose **Manage NuGet Packages** from the Project menu, and search online for the `Microsoft.Tpl.Dataflow` package.  \n  \n This document demonstrates a dataflow pipeline that downloads the book *The Iliad of Homer* from a website and searches the text to match individual words with words that reverse the first word's characters. The formation of the dataflow pipeline in this document consists of the following steps:  \n  \n1.  Create the dataflow blocks that participate in the pipeline.  \n  \n2.  Connect each dataflow block to the next block in the pipeline. Each block receives as input the output of the previous block in the pipeline.  \n  \n3.  For each dataflow block, create a continuation task that sets the next block to the completed state after the previous block finishes.  \n  \n4.  Post data to the head of the pipeline.  \n  \n5.  Mark the head of the pipeline as completed.  \n  \n6.  Wait for the pipeline to complete all work.  \n  \n## Prerequisites  \n Read [Dataflow](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md) before you start this walkthrough.  \n  \n## Creating a Console Application  \n In [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], create a [!INCLUDE[csprcs](../../../includes/csprcs-md.md)] or [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] Console Application project. Add a reference to System.Threading.Tasks.Dataflow.dll.  \n  \n Alternatively, create a file and name it `ReverseWords.cs` (`ReverseWords.vb` for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), and then run the following command in a Visual Studio Command Prompt window to compile the project.  \n  \n [!INCLUDE[csprcs](../../../includes/csprcs-md.md)]  \n  \n **csc.exe /r:System.Threading.Tasks.Dataflow.dll ReverseWords.cs**  \n  \n [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]  \n  \n **vbc.exe /r:System.Threading.Tasks.Dataflow.dll ReverseWords.vb**  \n  \n Add the following code to your project to create the basic application.  \n  \n [!code-csharp[TPLDataflow_Palindromes#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#2)]\n [!code-vb[TPLDataflow_Palindromes#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#2)]  \n  \n## Creating the Dataflow Blocks  \n Add the following code to the `Main` method to create the dataflow blocks that participate in the pipeline. The table that follows summarizes the role of each member of the pipeline.  \n  \n [!code-csharp[TPLDataflow_Palindromes#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#3)]\n [!code-vb[TPLDataflow_Palindromes#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#3)]  \n  \n|Member|Type|Description|  \n|------------|----------|-----------------|  \n|`downloadString`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|Downloads the book text from the Web.|  \n|`createWordList`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|Separates the book text into an array of words.|  \n|`filterWordList`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|Removes short words from the word array, orders the resulting words alphabetically, and remove duplicates.|  \n|`findReversedWords`|<xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>|Finds all words in the filtered word array collection whose reverse also occurs in the word array.|  \n|`printReversedWords`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|Displays words and the corresponding reverse words to the console.|  \n  \n Although you could combine multiple steps in the dataflow pipeline in this example into one step, the example illustrates the concept of composing multiple independent dataflow tasks to perform a larger task. The example uses <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> to enable each member of the pipeline to perform an operation on its input data and send the results to the next step in the pipeline. The `findReversedWords` member of the pipeline is a <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> object because it produces multiple independent outputs for each input. The tail of the pipeline, `printReversedWords`, is a <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object because it performs an action on its input, and does not produce a result.  \n  \n## Forming the Pipeline  \n Add the following code to connect each block to the next block in the pipeline.  \n  \n When you call the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.LinkTo%2A> method to connect a source dataflow block to a target dataflow block, the source dataflow block propagates data to the target block as data becomes available.  \n  \n [!code-csharp[TPLDataflow_Palindromes#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#4)]\n [!code-vb[TPLDataflow_Palindromes#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#4)]  \n  \n## Creating the Completion Tasks  \n Add the following code to enable each dataflow block to perform a final action after it processes all data.  \n  \n [!code-csharp[TPLDataflow_Palindromes#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#5)]\n [!code-vb[TPLDataflow_Palindromes#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#5)]  \n  \n To propagate completion through the pipeline, each completion task sets the next dataflow block to the completed state. For example, when the head of the pipeline is set to the completed state, it processes any remaining buffered messages and then runs its completion task, which sets the second member of the pipeline to the completed state. The second member of the pipeline in turn processes any remaining buffered messages and then runs its completion task, which sets the third member of the pipeline to the completed state. This process continues until all members of the pipeline finish. This example uses the `delegate` keyword (`Function` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) to define the continuation tasks.  \n  \n## Posting Data to the Pipeline  \n Add the following code to post the URL of the book *The Iliad of Homer* to the head of the dataflow pipeline.  \n  \n [!code-csharp[TPLDataflow_Palindromes#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#6)]\n [!code-vb[TPLDataflow_Palindromes#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#6)]  \n  \n This example uses <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A?displayProperty=fullName> to synchronously send data to the head of the pipeline. Use the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A?displayProperty=fullName> method when you must asynchronously send data to a dataflow node.  \n  \n## Completing Pipeline Activity  \n Add the following code to mark the head of the pipeline as completed. The head of the pipeline runs its continuation task after it processes all buffered messages. This continuation task propagates the completed state through the pipeline.  \n  \n [!code-csharp[TPLDataflow_Palindromes#7](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#7)]\n [!code-vb[TPLDataflow_Palindromes#7](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#7)]  \n  \n This example sends one URL through the dataflow pipeline to be processed. If you send more than one input through a pipeline, call the <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A?displayProperty=fullName> method after you submit all the input. You can omit this step if your application has no well-defined point at which data is no longer available or the application does not have to wait for the pipeline to finish.  \n  \n## Waiting for the Pipeline to Finish  \n Add the following code to wait for the pipeline to finish. Because this example uses continuation tasks to propagate completion through the pipeline, the overall operation is finished when the tail of the pipeline finishes.  \n  \n [!code-csharp[TPLDataflow_Palindromes#8](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#8)]\n [!code-vb[TPLDataflow_Palindromes#8](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#8)]  \n  \n You can wait for dataflow completion from any thread or from multiple threads at the same time.  \n  \n## The Complete Example  \n The following example shows the complete code for this walkthrough.  \n  \n [!code-csharp[TPLDataflow_Palindromes#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#1)]\n [!code-vb[TPLDataflow_Palindromes#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#1)]  \n  \n## Next Steps  \n This example sends one URL to process through the dataflow pipeline. If you send more than one input value through a pipeline, you can introduce a form of parallelism into your application that resembles how parts might move through an automobile factory. When the first member of the pipeline sends its result to the second member, it can process another item in parallel as the second member processes the first result.  \n  \n The parallelism that is achieved by using dataflow pipelines is known as *coarse-grained parallelism* because it typically consists of fewer, larger tasks. You can also use a more *fine-grained parallelism* of smaller, short-running tasks in a dataflow pipeline. In this example, the `findReversedWords` member of the pipeline uses the <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=fullName> method to process multiple items in the work list in parallel. The use of fine-grained parallelism in a coarse-grained pipeline can improve overall throughput.  \n  \n You can also connect a source dataflow block to multiple target blocks to create a *dataflow network*. The overloaded version of the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.LinkTo%2A> method takes a <xref:System.Predicate%601> object that defines whether the target block accepts each message based on its value. Most dataflow block types that act as sources offer messages to all connected target blocks, in the order in which they were connected, until one of the blocks accepts that message. By using this filtering mechanism, you can create systems of connected dataflow blocks that direct certain data through one path and other data through another path. For an example that uses filtering to create a dataflow network, see [Walkthrough: Using Dataflow in a Windows Forms Application](../../../docs/standard/parallel-programming/walkthrough-using-dataflow-in-a-windows-forms-application.md).  \n  \n## See Also  \n [Dataflow](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)","nodes":[{"pos":[12,70],"content":"Walkthrough: Creating a Dataflow Pipeline | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Walkthrough: Creating a Dataflow Pipeline | Microsoft Docs","pos":[0,58]}]},{"pos":[522,563],"content":"Walkthrough: Creating a Dataflow Pipeline","linkify":"Walkthrough: Creating a Dataflow Pipeline","nodes":[{"content":"Walkthrough: Creating a Dataflow Pipeline","pos":[0,41]}]},{"content":"Although you can use the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow.DataflowBlock.Receive%2A?displayProperty=fullName&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Dataflow.DataflowBlock.ReceiveAsync%2A?displayProperty=fullName&gt;</ph>, and <ph id=\"ph3\">&lt;xref:System.Threading.Tasks.Dataflow.DataflowBlock.TryReceive%2A?displayProperty=fullName&gt;</ph> methods to receive messages from source blocks, you can also connect message blocks to form a <bpt id=\"p1\">*</bpt>dataflow pipeline<ept id=\"p1\">*</ept>.","pos":[564,984],"source":"Although you can use the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Receive%2A?displayProperty=fullName>, <xref:System.Threading.Tasks.Dataflow.DataflowBlock.ReceiveAsync%2A?displayProperty=fullName>, and <xref:System.Threading.Tasks.Dataflow.DataflowBlock.TryReceive%2A?displayProperty=fullName> methods to receive messages from source blocks, you can also connect message blocks to form a *dataflow pipeline*."},{"content":"A dataflow pipeline is a series of components, or <bpt id=\"p1\">*</bpt>dataflow blocks<ept id=\"p1\">*</ept>, each of which performs a specific task that contributes to a larger goal.","pos":[985,1127],"source":" A dataflow pipeline is a series of components, or *dataflow blocks*, each of which performs a specific task that contributes to a larger goal."},{"content":"Every dataflow block in a dataflow pipeline performs work when it receives a message from another dataflow block.","pos":[1128,1241]},{"content":"An analogy to this is an assembly line for automobile manufacturing.","pos":[1242,1310]},{"content":"As each vehicle passes through the assembly line, one station assembles the frame, the next one installs the engine, and so on.","pos":[1311,1438]},{"content":"Because an assembly line enables multiple vehicles to be assembled at the same time, it provides better throughput than assembling complete vehicles one at a time.","pos":[1439,1602]},{"pos":[1610,2070],"content":"[!TIP]\n The TPL Dataflow Library (<xref:System.Threading.Tasks.Dataflow?displayProperty=fullName> namespace) is not distributed with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)]. To install the <xref:System.Threading.Tasks.Dataflow> namespace, open your project in [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], choose **Manage NuGet Packages** from the Project menu, and search online for the `Microsoft.Tpl.Dataflow` package.","leadings":["","> "],"nodes":[{"content":" The TPL Dataflow Library (<xref:System.Threading.Tasks.Dataflow?displayProperty=fullName> namespace) is not distributed with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)]. To install the <xref:System.Threading.Tasks.Dataflow> namespace, open your project in [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], choose **Manage NuGet Packages** from the Project menu, and search online for the `Microsoft.Tpl.Dataflow` package.","pos":[7,458],"nodes":[{"content":"The TPL Dataflow Library (<ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow?displayProperty=fullName&gt;</ph> namespace) is not distributed with the <ph id=\"ph2\">[!INCLUDE[net_v45](../../../includes/net-v45-md.md)]</ph>.","pos":[1,183],"source":" The TPL Dataflow Library (<xref:System.Threading.Tasks.Dataflow?displayProperty=fullName> namespace) is not distributed with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)]."},{"content":"To install the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow&gt;</ph> namespace, open your project in <ph id=\"ph2\">[!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)]</ph>, choose <bpt id=\"p1\">**</bpt>Manage NuGet Packages<ept id=\"p1\">**</ept> from the Project menu, and search online for the <ph id=\"ph3\">`Microsoft.Tpl.Dataflow`</ph> package.","pos":[184,451],"source":" To install the <xref:System.Threading.Tasks.Dataflow> namespace, open your project in [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], choose **Manage NuGet Packages** from the Project menu, and search online for the `Microsoft.Tpl.Dataflow` package."}]}]},{"content":"This document demonstrates a dataflow pipeline that downloads the book <bpt id=\"p1\">*</bpt>The Iliad of Homer<ept id=\"p1\">*</ept> from a website and searches the text to match individual words with words that reverse the first word's characters.","pos":[2077,2284],"source":"This document demonstrates a dataflow pipeline that downloads the book *The Iliad of Homer* from a website and searches the text to match individual words with words that reverse the first word's characters."},{"content":"The formation of the dataflow pipeline in this document consists of the following steps:","pos":[2285,2373]},{"content":"Create the dataflow blocks that participate in the pipeline.","pos":[2383,2443]},{"content":"Connect each dataflow block to the next block in the pipeline.","pos":[2453,2515]},{"content":"Each block receives as input the output of the previous block in the pipeline.","pos":[2516,2594]},{"content":"For each dataflow block, create a continuation task that sets the next block to the completed state after the previous block finishes.","pos":[2604,2738]},{"content":"Post data to the head of the pipeline.","pos":[2748,2786]},{"content":"Mark the head of the pipeline as completed.","pos":[2796,2839]},{"content":"Wait for the pipeline to complete all work.","pos":[2849,2892]},{"pos":[2901,2914],"content":"Prerequisites","linkify":"Prerequisites","nodes":[{"content":"Prerequisites","pos":[0,13]}]},{"pos":[2918,3047],"content":"Read <bpt id=\"p1\">[</bpt>Dataflow<ept id=\"p1\">](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)</ept> before you start this walkthrough.","source":"Read [Dataflow](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md) before you start this walkthrough."},{"pos":[3056,3086],"content":"Creating a Console Application","linkify":"Creating a Console Application","nodes":[{"content":"Creating a Console Application","pos":[0,30]}]},{"content":"In <ph id=\"ph1\">[!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]</ph>, create a <ph id=\"ph2\">[!INCLUDE[csprcs](../../../includes/csprcs-md.md)]</ph> or <ph id=\"ph3\">[!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]</ph> Console Application project.","pos":[3090,3287],"source":"In [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], create a [!INCLUDE[csprcs](../../../includes/csprcs-md.md)] or [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] Console Application project."},{"content":"Add a reference to System.Threading.Tasks.Dataflow.dll.","pos":[3288,3343]},{"pos":[3350,3584],"content":"Alternatively, create a file and name it <ph id=\"ph1\">`ReverseWords.cs`</ph> (<ph id=\"ph2\">`ReverseWords.vb`</ph> for <ph id=\"ph3\">[!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]</ph>), and then run the following command in a Visual Studio Command Prompt window to compile the project.","source":"Alternatively, create a file and name it `ReverseWords.cs` (`ReverseWords.vb` for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), and then run the following command in a Visual Studio Command Prompt window to compile the project."},{"pos":[3648,3714],"content":"<bpt id=\"p1\">**</bpt>csc.exe /r:System.Threading.Tasks.Dataflow.dll ReverseWords.cs<ept id=\"p1\">**</ept>","source":"**csc.exe /r:System.Threading.Tasks.Dataflow.dll ReverseWords.cs**"},{"pos":[3778,3844],"content":"<bpt id=\"p1\">**</bpt>vbc.exe /r:System.Threading.Tasks.Dataflow.dll ReverseWords.vb<ept id=\"p1\">**</ept>","source":"**vbc.exe /r:System.Threading.Tasks.Dataflow.dll ReverseWords.vb**"},{"content":"Add the following code to your project to create the basic application.","pos":[3851,3922]},{"pos":[3929,4220],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPLDataflow_Palindromes#2<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#2)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPLDataflow_Palindromes#2<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#2)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[TPLDataflow_Palindromes#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#2)]\n [!code-vb[TPLDataflow_Palindromes#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#2)]"},{"pos":[4229,4257],"content":"Creating the Dataflow Blocks","linkify":"Creating the Dataflow Blocks","nodes":[{"content":"Creating the Dataflow Blocks","pos":[0,28]}]},{"content":"Add the following code to the <ph id=\"ph1\">`Main`</ph> method to create the dataflow blocks that participate in the pipeline.","pos":[4261,4368],"source":"Add the following code to the `Main` method to create the dataflow blocks that participate in the pipeline."},{"content":"The table that follows summarizes the role of each member of the pipeline.","pos":[4369,4443]},{"pos":[4450,4741],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPLDataflow_Palindromes#3<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#3)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPLDataflow_Palindromes#3<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#3)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[TPLDataflow_Palindromes#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#3)]\n [!code-vb[TPLDataflow_Palindromes#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#3)]"},{"content":"Member","pos":[4748,4754]},{"content":"Type","pos":[4755,4759]},{"content":"Description","pos":[4760,4771]},{"content":"Downloads the book text from the Web.","pos":[4897,4934]},{"content":"Separates the book text into an array of words.","pos":[5014,5061]},{"content":"Removes short words from the word array, orders the resulting words alphabetically, and remove duplicates.","pos":[5141,5247]},{"content":"Finds all words in the filtered word array collection whose reverse also occurs in the word array.","pos":[5334,5432]},{"content":"Displays words and the corresponding reverse words to the console.","pos":[5513,5579]},{"content":"Although you could combine multiple steps in the dataflow pipeline in this example into one step, the example illustrates the concept of composing multiple independent dataflow tasks to perform a larger task.","pos":[5587,5795]},{"content":"The example uses <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow.TransformBlock%602&gt;</ph> to enable each member of the pipeline to perform an operation on its input data and send the results to the next step in the pipeline.","pos":[5796,6005],"source":" The example uses <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> to enable each member of the pipeline to perform an operation on its input data and send the results to the next step in the pipeline."},{"content":"The <ph id=\"ph1\">`findReversedWords`</ph> member of the pipeline is a <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602&gt;</ph> object because it produces multiple independent outputs for each input.","pos":[6006,6191],"source":" The `findReversedWords` member of the pipeline is a <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> object because it produces multiple independent outputs for each input."},{"content":"The tail of the pipeline, <ph id=\"ph1\">`printReversedWords`</ph>, is a <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Dataflow.ActionBlock%601&gt;</ph> object because it performs an action on its input, and does not produce a result.","pos":[6192,6381],"source":" The tail of the pipeline, `printReversedWords`, is a <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object because it performs an action on its input, and does not produce a result."},{"pos":[6390,6410],"content":"Forming the Pipeline","linkify":"Forming the Pipeline","nodes":[{"content":"Forming the Pipeline","pos":[0,20]}]},{"content":"Add the following code to connect each block to the next block in the pipeline.","pos":[6414,6493]},{"content":"When you call the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow.DataflowBlock.LinkTo%2A&gt;</ph> method to connect a source dataflow block to a target dataflow block, the source dataflow block propagates data to the target block as data becomes available.","pos":[6500,6739],"source":"When you call the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.LinkTo%2A> method to connect a source dataflow block to a target dataflow block, the source dataflow block propagates data to the target block as data becomes available."},{"pos":[6746,7037],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPLDataflow_Palindromes#4<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#4)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPLDataflow_Palindromes#4<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#4)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[TPLDataflow_Palindromes#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#4)]\n [!code-vb[TPLDataflow_Palindromes#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#4)]"},{"pos":[7046,7075],"content":"Creating the Completion Tasks","linkify":"Creating the Completion Tasks","nodes":[{"content":"Creating the Completion Tasks","pos":[0,29]}]},{"content":"Add the following code to enable each dataflow block to perform a final action after it processes all data.","pos":[7079,7186]},{"pos":[7193,7484],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPLDataflow_Palindromes#5<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#5)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPLDataflow_Palindromes#5<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#5)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[TPLDataflow_Palindromes#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#5)]\n [!code-vb[TPLDataflow_Palindromes#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#5)]"},{"content":"To propagate completion through the pipeline, each completion task sets the next dataflow block to the completed state.","pos":[7491,7610]},{"content":"For example, when the head of the pipeline is set to the completed state, it processes any remaining buffered messages and then runs its completion task, which sets the second member of the pipeline to the completed state.","pos":[7611,7833]},{"content":"The second member of the pipeline in turn processes any remaining buffered messages and then runs its completion task, which sets the third member of the pipeline to the completed state.","pos":[7834,8020]},{"content":"This process continues until all members of the pipeline finish.","pos":[8021,8085]},{"content":"This example uses the <ph id=\"ph1\">`delegate`</ph> keyword (<ph id=\"ph2\">`Function`</ph> in <ph id=\"ph3\">[!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]</ph>) to define the continuation tasks.","pos":[8086,8227],"source":" This example uses the `delegate` keyword (`Function` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) to define the continuation tasks."},{"pos":[8236,8264],"content":"Posting Data to the Pipeline","linkify":"Posting Data to the Pipeline","nodes":[{"content":"Posting Data to the Pipeline","pos":[0,28]}]},{"pos":[8268,8377],"content":"Add the following code to post the URL of the book <bpt id=\"p1\">*</bpt>The Iliad of Homer<ept id=\"p1\">*</ept> to the head of the dataflow pipeline.","source":"Add the following code to post the URL of the book *The Iliad of Homer* to the head of the dataflow pipeline."},{"pos":[8384,8675],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPLDataflow_Palindromes#6<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#6)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPLDataflow_Palindromes#6<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#6)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[TPLDataflow_Palindromes#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#6)]\n [!code-vb[TPLDataflow_Palindromes#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#6)]"},{"content":"This example uses <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A?displayProperty=fullName&gt;</ph> to synchronously send data to the head of the pipeline.","pos":[8682,8841],"source":"This example uses <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A?displayProperty=fullName> to synchronously send data to the head of the pipeline."},{"content":"Use the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A?displayProperty=fullName&gt;</ph> method when you must asynchronously send data to a dataflow node.","pos":[8842,9006],"source":" Use the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A?displayProperty=fullName> method when you must asynchronously send data to a dataflow node."},{"pos":[9015,9043],"content":"Completing Pipeline Activity","linkify":"Completing Pipeline Activity","nodes":[{"content":"Completing Pipeline Activity","pos":[0,28]}]},{"content":"Add the following code to mark the head of the pipeline as completed.","pos":[9047,9116]},{"content":"The head of the pipeline runs its continuation task after it processes all buffered messages.","pos":[9117,9210]},{"content":"This continuation task propagates the completed state through the pipeline.","pos":[9211,9286]},{"pos":[9293,9584],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPLDataflow_Palindromes#7<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#7)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPLDataflow_Palindromes#7<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#7)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[TPLDataflow_Palindromes#7](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#7)]\n [!code-vb[TPLDataflow_Palindromes#7](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#7)]"},{"content":"This example sends one URL through the dataflow pipeline to be processed.","pos":[9591,9664]},{"content":"If you send more than one input through a pipeline, call the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A?displayProperty=fullName&gt;</ph> method after you submit all the input.","pos":[9665,9855],"source":" If you send more than one input through a pipeline, call the <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A?displayProperty=fullName> method after you submit all the input."},{"content":"You can omit this step if your application has no well-defined point at which data is no longer available or the application does not have to wait for the pipeline to finish.","pos":[9856,10030]},{"pos":[10039,10073],"content":"Waiting for the Pipeline to Finish","linkify":"Waiting for the Pipeline to Finish","nodes":[{"content":"Waiting for the Pipeline to Finish","pos":[0,34]}]},{"content":"Add the following code to wait for the pipeline to finish.","pos":[10077,10135]},{"content":"Because this example uses continuation tasks to propagate completion through the pipeline, the overall operation is finished when the tail of the pipeline finishes.","pos":[10136,10300]},{"pos":[10307,10598],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPLDataflow_Palindromes#8<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#8)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPLDataflow_Palindromes#8<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#8)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[TPLDataflow_Palindromes#8](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#8)]\n [!code-vb[TPLDataflow_Palindromes#8](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#8)]"},{"content":"You can wait for dataflow completion from any thread or from multiple threads at the same time.","pos":[10605,10700]},{"pos":[10709,10729],"content":"The Complete Example","linkify":"The Complete Example","nodes":[{"content":"The Complete Example","pos":[0,20]}]},{"content":"The following example shows the complete code for this walkthrough.","pos":[10733,10800]},{"pos":[10807,11098],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>TPLDataflow_Palindromes#1<ept id=\"p2\">](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#1)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>TPLDataflow_Palindromes#1<ept id=\"p4\">](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#1)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[TPLDataflow_Palindromes#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#1)]\n [!code-vb[TPLDataflow_Palindromes#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#1)]"},{"pos":[11107,11117],"content":"Next Steps","linkify":"Next Steps","nodes":[{"content":"Next Steps","pos":[0,10]}]},{"content":"This example sends one URL to process through the dataflow pipeline.","pos":[11121,11189]},{"content":"If you send more than one input value through a pipeline, you can introduce a form of parallelism into your application that resembles how parts might move through an automobile factory.","pos":[11190,11376]},{"content":"When the first member of the pipeline sends its result to the second member, it can process another item in parallel as the second member processes the first result.","pos":[11377,11542]},{"content":"The parallelism that is achieved by using dataflow pipelines is known as <bpt id=\"p1\">*</bpt>coarse-grained parallelism<ept id=\"p1\">*</ept> because it typically consists of fewer, larger tasks.","pos":[11549,11704],"source":"The parallelism that is achieved by using dataflow pipelines is known as *coarse-grained parallelism* because it typically consists of fewer, larger tasks."},{"content":"You can also use a more <bpt id=\"p1\">*</bpt>fine-grained parallelism<ept id=\"p1\">*</ept> of smaller, short-running tasks in a dataflow pipeline.","pos":[11705,11811],"source":" You can also use a more *fine-grained parallelism* of smaller, short-running tasks in a dataflow pipeline."},{"content":"In this example, the <ph id=\"ph1\">`findReversedWords`</ph> member of the pipeline uses the <ph id=\"ph2\">&lt;xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=fullName&gt;</ph> method to process multiple items in the work list in parallel.","pos":[11812,12022],"source":" In this example, the `findReversedWords` member of the pipeline uses the <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=fullName> method to process multiple items in the work list in parallel."},{"content":"The use of fine-grained parallelism in a coarse-grained pipeline can improve overall throughput.","pos":[12023,12119]},{"content":"You can also connect a source dataflow block to multiple target blocks to create a <bpt id=\"p1\">*</bpt>dataflow network<ept id=\"p1\">*</ept>.","pos":[12126,12228],"source":"You can also connect a source dataflow block to multiple target blocks to create a *dataflow network*."},{"content":"The overloaded version of the <ph id=\"ph1\">&lt;xref:System.Threading.Tasks.Dataflow.DataflowBlock.LinkTo%2A&gt;</ph> method takes a <ph id=\"ph2\">&lt;xref:System.Predicate%601&gt;</ph> object that defines whether the target block accepts each message based on its value.","pos":[12229,12450],"source":" The overloaded version of the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.LinkTo%2A> method takes a <xref:System.Predicate%601> object that defines whether the target block accepts each message based on its value."},{"content":"Most dataflow block types that act as sources offer messages to all connected target blocks, in the order in which they were connected, until one of the blocks accepts that message.","pos":[12451,12632]},{"content":"By using this filtering mechanism, you can create systems of connected dataflow blocks that direct certain data through one path and other data through another path.","pos":[12633,12798]},{"content":"For an example that uses filtering to create a dataflow network, see <bpt id=\"p1\">[</bpt>Walkthrough: Using Dataflow in a Windows Forms Application<ept id=\"p1\">](../../../docs/standard/parallel-programming/walkthrough-using-dataflow-in-a-windows-forms-application.md)</ept>.","pos":[12799,13035],"source":" For an example that uses filtering to create a dataflow network, see [Walkthrough: Using Dataflow in a Windows Forms Application](../../../docs/standard/parallel-programming/walkthrough-using-dataflow-in-a-windows-forms-application.md)."},{"pos":[13044,13052],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[13056,13145],"content":"<bpt id=\"p1\">[</bpt>Dataflow<ept id=\"p1\">](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)</ept>","source":"[Dataflow](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)"}]}