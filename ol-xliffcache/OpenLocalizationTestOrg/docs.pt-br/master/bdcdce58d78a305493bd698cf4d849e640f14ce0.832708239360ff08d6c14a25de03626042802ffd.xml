{"content":"---\ntitle: \"Database Mirroring in SQL Server\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 89befaff-bb46-4290-8382-e67cdb0e3de9\n---\n# Database Mirroring in SQL Server\nDatabase mirroring in SQL Server allows you to keep a copy, or mirror, of a SQL Server database on a standby server. Mirroring ensures that two separate copies of the data exist at all times, providing high availability and complete data redundancy. The .NET Data Provider for SQL Server provides implicit support for database mirroring, so that the developer does not need to take any action or write any code once it has been configured for a SQL Server database. In addition, the <xref:System.Data.SqlClient.SqlConnection> object supports an explicit connection mode that allows supplying the name of a failover partner server in the <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.  \n  \n The following simplified sequence of events occurs for a <xref:System.Data.SqlClient.SqlConnection> object that targets a database configured for mirroring:  \n  \n1.  The client application successfully connects to the principal database, and the server sends back the name of the partner server, which is then cached on the client.  \n  \n2.  If the server containing the principal database fails or connectivity is interrupted, connection and transaction state is lost. The client application attempts to re-establish a connection to the principal database and fails.  \n  \n3.  The client application then transparently attempts to establish a connection to the mirror database on the partner server. If it succeeds, the connection is redirected to the mirror database, which then becomes the new principal database.  \n  \n## Specifying the Failover Partner in the Connection String  \n If you supply the name of a failover partner server in the connection string, the client will transparently attempt a connection with the failover partner if the principal database is unavailable when the client application first connects.  \n  \n```  \n\";Failover Partner=PartnerServerName\"  \n```  \n  \n If you omit the name of the failover partner server and the principal database is unavailable when the client application first connects then a <xref:System.Data.SqlClient.SqlException> is raised.  \n  \n When a <xref:System.Data.SqlClient.SqlConnection> is successfully opened, the failover partner name is returned by the server and supersedes any values supplied in the connection string.  \n  \n> [!NOTE]\n>  You must explicitly specify the initial catalog or database name in the connection string for database mirroring scenarios. If the client receives failover information on a connection that doesn't have an explicitly specified initial catalog or database, the failover information is not cached and the application does not attempt to fail over if the principal server fails. If a connection string has a value for the failover partner, but no value for the initial catalog or database, an `InvalidArgumentException` is raised.  \n  \n## Retrieving the Current Server Name  \n In the event of a failover, you can retrieve the name of the server to which the current connection is actually connected by using the <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> property of a <xref:System.Data.SqlClient.SqlConnection> object. The following code fragment retrieves the name of the active server, assuming that the connection variable references an open <xref:System.Data.SqlClient.SqlConnection>.  \n  \n When a failover event occurs and the connection is switched to the mirror server, the **DataSource** property is updated to reflect the mirror name.  \n  \n```vb  \nDim activeServer As String = connection.DataSource  \n```  \n  \n```csharp  \nstring activeServer = connection.DataSource;  \n```  \n  \n## SqlClient Mirroring Behavior  \n The client always tries to connect to the current principal server. If it fails, it tries the failover partner. If the mirror database has already been switched to the principal role on the partner server, the connection succeeds and the new principal-mirror mapping is sent to the client and cached for the lifetime of the calling <xref:System.AppDomain>. It is not stored in persistent storage and is not available for subsequent connections in a different **AppDomain** or process. However, it is available for subsequent connections within the same **AppDomain**. Note that another **AppDomain** or process running on the same or a different computer always has its pool of connections, and those connections are not reset. In that case, if the primary database goes down, each process or **AppDomain** fails once, and the pool is automatically cleared.  \n  \n> [!NOTE]\n>  Mirroring support on the server is configured on a per-database basis. If data manipulation operations are executed against other databases not included in the principal/mirror set, either by using multipart names or by changing the current database, the changes to these other databases do not propagate in the event of failure. No error is generated when data is modified in a database that is not mirrored. The developer must evaluate the possible impact of such operations.  \n  \n## Database Mirroring Resources  \n For conceptual documentation and information on configuring, deploying and administering mirroring, see the following resources in SQL Server documentation.  \n  \n|Resource|Description|  \n|--------------|-----------------|  \n|[Database Mirroring](/sql/database-engine/database-mirroring/database-mirroring-sql-server)|Describes how to set up and configure mirroring in SQL Server.|  \n  \n## See also\n\n- [ADO.NET Managed Providers and DataSet Developer Center](https://go.microsoft.com/fwlink/?LinkId=217917)\n","nodes":[{"pos":[4,150],"embed":true,"restype":"x-metadata","content":"title: \"Database Mirroring in SQL Server\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nms.assetid: 89befaff-bb46-4290-8382-e67cdb0e3de9","nodes":[{"content":"Database Mirroring in SQL Server","nodes":[{"pos":[0,32],"content":"Database Mirroring in SQL Server","nodes":[{"content":"Database Mirroring in SQL Server","pos":[0,32]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[157,189],"content":"Database Mirroring in SQL Server","linkify":"Database Mirroring in SQL Server","nodes":[{"content":"Database Mirroring in SQL Server","pos":[0,32]}]},{"content":"Database mirroring in SQL Server allows you to keep a copy, or mirror, of a SQL Server database on a standby server.","pos":[190,306]},{"content":"Mirroring ensures that two separate copies of the data exist at all times, providing high availability and complete data redundancy.","pos":[307,439]},{"content":"The .NET Data Provider for SQL Server provides implicit support for database mirroring, so that the developer does not need to take any action or write any code once it has been configured for a SQL Server database.","pos":[440,655]},{"content":"In addition, the <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlConnection&gt;</ph> object supports an explicit connection mode that allows supplying the name of a failover partner server in the <ph id=\"ph2\">&lt;xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A&gt;</ph>.","pos":[656,890],"source":" In addition, the <xref:System.Data.SqlClient.SqlConnection> object supports an explicit connection mode that allows supplying the name of a failover partner server in the <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>."},{"pos":[897,1053],"content":"The following simplified sequence of events occurs for a <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlConnection&gt;</ph> object that targets a database configured for mirroring:","source":"The following simplified sequence of events occurs for a <xref:System.Data.SqlClient.SqlConnection> object that targets a database configured for mirroring:"},{"content":"The client application successfully connects to the principal database, and the server sends back the name of the partner server, which is then cached on the client.","pos":[1063,1228]},{"content":"If the server containing the principal database fails or connectivity is interrupted, connection and transaction state is lost.","pos":[1238,1365]},{"content":"The client application attempts to re-establish a connection to the principal database and fails.","pos":[1366,1463]},{"content":"The client application then transparently attempts to establish a connection to the mirror database on the partner server.","pos":[1473,1595]},{"content":"If it succeeds, the connection is redirected to the mirror database, which then becomes the new principal database.","pos":[1596,1711]},{"pos":[1720,1776],"content":"Specifying the Failover Partner in the Connection String","linkify":"Specifying the Failover Partner in the Connection String","nodes":[{"content":"Specifying the Failover Partner in the Connection String","pos":[0,56]}]},{"content":"If you supply the name of a failover partner server in the connection string, the client will transparently attempt a connection with the failover partner if the principal database is unavailable when the client application first connects.","pos":[1780,2019]},{"pos":[2081,2277],"content":"If you omit the name of the failover partner server and the principal database is unavailable when the client application first connects then a <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlException&gt;</ph> is raised.","source":"If you omit the name of the failover partner server and the principal database is unavailable when the client application first connects then a <xref:System.Data.SqlClient.SqlException> is raised."},{"pos":[2284,2470],"content":"When a <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlConnection&gt;</ph> is successfully opened, the failover partner name is returned by the server and supersedes any values supplied in the connection string.","source":"When a <xref:System.Data.SqlClient.SqlConnection> is successfully opened, the failover partner name is returned by the server and supersedes any values supplied in the connection string."},{"pos":[2478,3015],"content":"[!NOTE]\n You must explicitly specify the initial catalog or database name in the connection string for database mirroring scenarios. If the client receives failover information on a connection that doesn't have an explicitly specified initial catalog or database, the failover information is not cached and the application does not attempt to fail over if the principal server fails. If a connection string has a value for the failover partner, but no value for the initial catalog or database, an `InvalidArgumentException` is raised.","leadings":["","> "],"nodes":[{"content":"You must explicitly specify the initial catalog or database name in the connection string for database mirroring scenarios. If the client receives failover information on a connection that doesn't have an explicitly specified initial catalog or database, the failover information is not cached and the application does not attempt to fail over if the principal server fails. If a connection string has a value for the failover partner, but no value for the initial catalog or database, an `InvalidArgumentException` is raised.","pos":[9,535],"nodes":[{"content":"You must explicitly specify the initial catalog or database name in the connection string for database mirroring scenarios.","pos":[0,123]},{"content":"If the client receives failover information on a connection that doesn't have an explicitly specified initial catalog or database, the failover information is not cached and the application does not attempt to fail over if the principal server fails.","pos":[124,374]},{"content":"If a connection string has a value for the failover partner, but no value for the initial catalog or database, an <ph id=\"ph1\">`InvalidArgumentException`</ph> is raised.","pos":[375,526],"source":" If a connection string has a value for the failover partner, but no value for the initial catalog or database, an `InvalidArgumentException` is raised."}]}]},{"pos":[3024,3058],"content":"Retrieving the Current Server Name","linkify":"Retrieving the Current Server Name","nodes":[{"content":"Retrieving the Current Server Name","pos":[0,34]}]},{"content":"In the event of a failover, you can retrieve the name of the server to which the current connection is actually connected by using the <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlConnection.DataSource%2A&gt;</ph> property of a <ph id=\"ph2\">&lt;xref:System.Data.SqlClient.SqlConnection&gt;</ph> object.","pos":[3062,3318],"source":"In the event of a failover, you can retrieve the name of the server to which the current connection is actually connected by using the <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> property of a <xref:System.Data.SqlClient.SqlConnection> object."},{"content":"The following code fragment retrieves the name of the active server, assuming that the connection variable references an open <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlConnection&gt;</ph>.","pos":[3319,3488],"source":" The following code fragment retrieves the name of the active server, assuming that the connection variable references an open <xref:System.Data.SqlClient.SqlConnection>."},{"pos":[3495,3643],"content":"When a failover event occurs and the connection is switched to the mirror server, the <bpt id=\"p1\">**</bpt>DataSource<ept id=\"p1\">**</ept> property is updated to reflect the mirror name.","source":"When a failover event occurs and the connection is switched to the mirror server, the **DataSource** property is updated to reflect the mirror name."},{"pos":[3790,3818],"content":"SqlClient Mirroring Behavior","linkify":"SqlClient Mirroring Behavior","nodes":[{"content":"SqlClient Mirroring Behavior","pos":[0,28]}]},{"content":"The client always tries to connect to the current principal server.","pos":[3822,3889]},{"content":"If it fails, it tries the failover partner.","pos":[3890,3933]},{"content":"If the mirror database has already been switched to the principal role on the partner server, the connection succeeds and the new principal-mirror mapping is sent to the client and cached for the lifetime of the calling <ph id=\"ph1\">&lt;xref:System.AppDomain&gt;</ph>.","pos":[3934,4178],"source":" If the mirror database has already been switched to the principal role on the partner server, the connection succeeds and the new principal-mirror mapping is sent to the client and cached for the lifetime of the calling <xref:System.AppDomain>."},{"content":"It is not stored in persistent storage and is not available for subsequent connections in a different <bpt id=\"p1\">**</bpt>AppDomain<ept id=\"p1\">**</ept> or process.","pos":[4179,4306],"source":" It is not stored in persistent storage and is not available for subsequent connections in a different **AppDomain** or process."},{"content":"However, it is available for subsequent connections within the same <bpt id=\"p1\">**</bpt>AppDomain<ept id=\"p1\">**</ept>.","pos":[4307,4389],"source":" However, it is available for subsequent connections within the same **AppDomain**."},{"content":"Note that another <bpt id=\"p1\">**</bpt>AppDomain<ept id=\"p1\">**</ept> or process running on the same or a different computer always has its pool of connections, and those connections are not reset.","pos":[4390,4549],"source":" Note that another **AppDomain** or process running on the same or a different computer always has its pool of connections, and those connections are not reset."},{"content":"In that case, if the primary database goes down, each process or <bpt id=\"p1\">**</bpt>AppDomain<ept id=\"p1\">**</ept> fails once, and the pool is automatically cleared.","pos":[4550,4679],"source":" In that case, if the primary database goes down, each process or **AppDomain** fails once, and the pool is automatically cleared."},{"pos":[4687,5175],"content":"[!NOTE]\n Mirroring support on the server is configured on a per-database basis. If data manipulation operations are executed against other databases not included in the principal/mirror set, either by using multipart names or by changing the current database, the changes to these other databases do not propagate in the event of failure. No error is generated when data is modified in a database that is not mirrored. The developer must evaluate the possible impact of such operations.","leadings":["","> "],"nodes":[{"content":"Mirroring support on the server is configured on a per-database basis. If data manipulation operations are executed against other databases not included in the principal/mirror set, either by using multipart names or by changing the current database, the changes to these other databases do not propagate in the event of failure. No error is generated when data is modified in a database that is not mirrored. The developer must evaluate the possible impact of such operations.","pos":[9,486],"nodes":[{"content":"Mirroring support on the server is configured on a per-database basis.","pos":[0,70]},{"content":"If data manipulation operations are executed against other databases not included in the principal/mirror set, either by using multipart names or by changing the current database, the changes to these other databases do not propagate in the event of failure.","pos":[71,329]},{"content":"No error is generated when data is modified in a database that is not mirrored.","pos":[330,409]},{"content":"The developer must evaluate the possible impact of such operations.","pos":[410,477]}]}]},{"pos":[5184,5212],"content":"Database Mirroring Resources","linkify":"Database Mirroring Resources","nodes":[{"content":"Database Mirroring Resources","pos":[0,28]}]},{"content":"For conceptual documentation and information on configuring, deploying and administering mirroring, see the following resources in SQL Server documentation.","pos":[5216,5372]},{"content":"Resource","pos":[5379,5387]},{"content":"Description","pos":[5388,5399]},{"pos":[5441,5532],"content":"<bpt id=\"p1\">[</bpt>Database Mirroring<ept id=\"p1\">](/sql/database-engine/database-mirroring/database-mirroring-sql-server)</ept>","source":"[Database Mirroring](/sql/database-engine/database-mirroring/database-mirroring-sql-server)"},{"content":"Describes how to set up and configure mirroring in SQL Server.","pos":[5533,5595]},{"pos":[5605,5613],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[5617,5721],"content":"<bpt id=\"p1\">[</bpt>ADO.NET Managed Providers and DataSet Developer Center<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=217917)</ept>","source":"[ADO.NET Managed Providers and DataSet Developer Center](https://go.microsoft.com/fwlink/?LinkId=217917)"}]}