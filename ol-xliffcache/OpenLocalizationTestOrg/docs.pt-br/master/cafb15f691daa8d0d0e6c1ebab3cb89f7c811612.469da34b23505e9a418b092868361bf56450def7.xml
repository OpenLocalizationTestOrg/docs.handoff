{"content":"---\ntitle: \"Marshaling Different Types of Arrays\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"marshaling, Arrays sample\"\n  - \"data marshaling, Arrays sample\"\nms.assetid: c5ac9920-5b6e-4dc9-bf2d-1f6f8ad3b0bf\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\n---\n# Marshaling Different Types of Arrays\nAn array is a reference type in managed code that contains one or more elements of the same type. Although arrays are reference types, they are passed as In parameters to unmanaged functions. This behavior is inconsistent with way managed arrays are passed to managed objects, which is as In/Out parameters. For additional details, see [Copying and Pinning](copying-and-pinning.md).  \n  \n The following table lists marshaling options for arrays and describes their usage.  \n  \n|Array|Description|  \n|-----------|-----------------|  \n|Of integers by value.|Passes an array of integers as an In parameter.|  \n|Of integers by reference.|Passes an array of integers as an In/Out parameter.|  \n|Of integers by value (two-dimensional).|Passes a matrix of integers as an In parameter.|  \n|Of strings by value.|Passes an array of strings as an In parameter.|  \n|Of structures with integers.|Passes an array of structures that contain integers as an In parameter.|  \n|Of structures with strings.|Passes an array of structures that contain only strings as an In/Out parameter. Members of the array can be changed.|  \n  \n## Example  \n This sample demonstrates how to pass the following types of arrays:  \n  \n-   Array of integers by value.  \n  \n-   Array of integers by reference, which can be resized.  \n  \n-   Multidimensional array (matrix) of integers by value.  \n  \n-   Array of strings by value.  \n  \n-   Array of structures with integers.  \n  \n-   Array of structures with strings.  \n  \n Unless an array is explicitly marshaled by reference, the default behavior marshals the array as an In parameter. You can change this behavior by applying the <xref:System.Runtime.InteropServices.InAttribute> and <xref:System.Runtime.InteropServices.OutAttribute> attributes explicitly.  \n  \n The Arrays sample uses the following unmanaged functions, shown with their original function declaration:  \n  \n-   **TestArrayOfInts** exported from PinvokeLib.dll.  \n  \n    ```  \n    int TestArrayOfInts(int* pArray, int pSize);  \n    ```  \n  \n-   **TestRefArrayOfInts** exported from PinvokeLib.dll.  \n  \n    ```  \n    int TestRefArrayOfInts(int** ppArray, int* pSize);  \n    ```  \n  \n-   **TestMatrixOfInts** exported from PinvokeLib.dll.  \n  \n    ```  \n    int TestMatrixOfInts(int pMatrix[][COL_DIM], int row);  \n    ```  \n  \n-   **TestArrayOfStrings** exported from PinvokeLib.dll.  \n  \n    ```  \n    int TestArrayOfStrings(char** ppStrArray, int size);  \n    ```  \n  \n-   **TestArrayOfStructs** exported from PinvokeLib.dll.  \n  \n    ```  \n    int TestArrayOfStructs(MYPOINT* pPointArray, int size);  \n    ```  \n  \n-   **TestArrayOfStructs2** exported from PinvokeLib.dll.  \n  \n    ```  \n    int TestArrayOfStructs2 (MYPERSON* pPersonArray, int size);  \n    ```  \n  \n [PinvokeLib.dll](marshaling-data-with-platform-invoke.md#pinvokelibdll) is a custom unmanaged library that contains implementations for the previously listed functions and two structure variables, **MYPOINT** and **MYPERSON**. The structures contain the following elements:  \n  \n```  \ntypedef struct _MYPOINT  \n{  \n   int x;   \n   int y;   \n} MYPOINT;  \n  \ntypedef struct _MYPERSON  \n{  \n   char* first;   \n   char* last;   \n} MYPERSON;  \n```  \n  \n In this sample, the `MyPoint` and `MyPerson` structures contain embedded types. The <xref:System.Runtime.InteropServices.StructLayoutAttribute> attribute is set to ensure that the members are arranged in memory sequentially, in the order in which they appear.  \n  \n The `LibWrap` class contains a set of methods called by the `App` class. For specific details about passing arrays, see the comments in the following sample. An array, which is a reference type, is passed as an In parameter by default. For the caller to receive the results, **InAttribute** and **OutAttribute** must be applied explicitly to the argument containing the array.  \n  \n### Declaring Prototypes  \n [!code-csharp[Conceptual.Interop.Marshaling#31](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.interop.marshaling/cs/arrays.cs#31)]\n [!code-vb[Conceptual.Interop.Marshaling#31](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.interop.marshaling/vb/arrays.vb#31)]  \n  \n### Calling Functions  \n [!code-csharp[Conceptual.Interop.Marshaling#32](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.interop.marshaling/cs/arrays.cs#32)]\n [!code-vb[Conceptual.Interop.Marshaling#32](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.interop.marshaling/vb/arrays.vb#32)]  \n  \n## See also\n\n- [Platform invoke data types](marshaling-data-with-platform-invoke.md#platform-invoke-data-types)\n- [Creating Prototypes in Managed Code](creating-prototypes-in-managed-code.md)\n","nodes":[{"pos":[4,285],"embed":true,"restype":"x-metadata","content":"title: \"Marshaling Different Types of Arrays\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"marshaling, Arrays sample\"\n  - \"data marshaling, Arrays sample\"\nms.assetid: c5ac9920-5b6e-4dc9-bf2d-1f6f8ad3b0bf\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"","nodes":[{"content":"Marshaling Different Types of Arrays","nodes":[{"pos":[0,36],"content":"Marshaling Different Types of Arrays","nodes":[{"content":"Marshaling Different Types of Arrays","pos":[0,36]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[292,328],"content":"Marshaling Different Types of Arrays","linkify":"Marshaling Different Types of Arrays","nodes":[{"content":"Marshaling Different Types of Arrays","pos":[0,36]}]},{"content":"An array is a reference type in managed code that contains one or more elements of the same type.","pos":[329,426]},{"content":"Although arrays are reference types, they are passed as In parameters to unmanaged functions.","pos":[427,520]},{"content":"This behavior is inconsistent with way managed arrays are passed to managed objects, which is as In/Out parameters.","pos":[521,636]},{"content":"For additional details, see <bpt id=\"p1\">[</bpt>Copying and Pinning<ept id=\"p1\">](copying-and-pinning.md)</ept>.","pos":[637,711],"source":" For additional details, see [Copying and Pinning](copying-and-pinning.md)."},{"content":"The following table lists marshaling options for arrays and describes their usage.","pos":[718,800]},{"content":"Array","pos":[807,812]},{"content":"Description","pos":[813,824]},{"content":"Of integers by value.","pos":[863,884]},{"content":"Passes an array of integers as an In parameter.","pos":[885,932]},{"content":"Of integers by reference.","pos":[937,962]},{"content":"Passes an array of integers as an In/Out parameter.","pos":[963,1014]},{"content":"Of integers by value (two-dimensional).","pos":[1019,1058]},{"content":"Passes a matrix of integers as an In parameter.","pos":[1059,1106]},{"content":"Of strings by value.","pos":[1111,1131]},{"content":"Passes an array of strings as an In parameter.","pos":[1132,1178]},{"content":"Of structures with integers.","pos":[1183,1211]},{"content":"Passes an array of structures that contain integers as an In parameter.","pos":[1212,1283]},{"content":"Of structures with strings.","pos":[1288,1315]},{"content":"Passes an array of structures that contain only strings as an In/Out parameter.","pos":[1316,1395]},{"content":"Members of the array can be changed.","pos":[1396,1432]},{"pos":[1442,1449],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"This sample demonstrates how to pass the following types of arrays:","pos":[1453,1520]},{"content":"Array of integers by value.","pos":[1530,1557]},{"content":"Array of integers by reference, which can be resized.","pos":[1567,1620]},{"content":"Multidimensional array (matrix) of integers by value.","pos":[1630,1683]},{"content":"Array of strings by value.","pos":[1693,1719]},{"content":"Array of structures with integers.","pos":[1729,1763]},{"content":"Array of structures with strings.","pos":[1773,1806]},{"content":"Unless an array is explicitly marshaled by reference, the default behavior marshals the array as an In parameter.","pos":[1813,1926]},{"content":"You can change this behavior by applying the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.InAttribute&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Runtime.InteropServices.OutAttribute&gt;</ph> attributes explicitly.","pos":[1927,2099],"source":" You can change this behavior by applying the <xref:System.Runtime.InteropServices.InAttribute> and <xref:System.Runtime.InteropServices.OutAttribute> attributes explicitly."},{"content":"The Arrays sample uses the following unmanaged functions, shown with their original function declaration:","pos":[2106,2211]},{"pos":[2221,2270],"content":"<bpt id=\"p1\">**</bpt>TestArrayOfInts<ept id=\"p1\">**</ept> exported from PinvokeLib.dll.","source":"**TestArrayOfInts** exported from PinvokeLib.dll."},{"pos":[2354,2406],"content":"<bpt id=\"p1\">**</bpt>TestRefArrayOfInts<ept id=\"p1\">**</ept> exported from PinvokeLib.dll.","source":"**TestRefArrayOfInts** exported from PinvokeLib.dll."},{"pos":[2496,2546],"content":"<bpt id=\"p1\">**</bpt>TestMatrixOfInts<ept id=\"p1\">**</ept> exported from PinvokeLib.dll.","source":"**TestMatrixOfInts** exported from PinvokeLib.dll."},{"pos":[2640,2692],"content":"<bpt id=\"p1\">**</bpt>TestArrayOfStrings<ept id=\"p1\">**</ept> exported from PinvokeLib.dll.","source":"**TestArrayOfStrings** exported from PinvokeLib.dll."},{"pos":[2784,2836],"content":"<bpt id=\"p1\">**</bpt>TestArrayOfStructs<ept id=\"p1\">**</ept> exported from PinvokeLib.dll.","source":"**TestArrayOfStructs** exported from PinvokeLib.dll."},{"pos":[2931,2984],"content":"<bpt id=\"p1\">**</bpt>TestArrayOfStructs2<ept id=\"p1\">**</ept> exported from PinvokeLib.dll.","source":"**TestArrayOfStructs2** exported from PinvokeLib.dll."},{"content":"<bpt id=\"p1\">[</bpt>PinvokeLib.dll<ept id=\"p1\">](marshaling-data-with-platform-invoke.md#pinvokelibdll)</ept> is a custom unmanaged library that contains implementations for the previously listed functions and two structure variables, <bpt id=\"p2\">**</bpt>MYPOINT<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>MYPERSON<ept id=\"p3\">**</ept>.","pos":[3080,3306],"source":"[PinvokeLib.dll](marshaling-data-with-platform-invoke.md#pinvokelibdll) is a custom unmanaged library that contains implementations for the previously listed functions and two structure variables, **MYPOINT** and **MYPERSON**."},{"content":"The structures contain the following elements:","pos":[3307,3353]},{"content":"In this sample, the <ph id=\"ph1\">`MyPoint`</ph> and <ph id=\"ph2\">`MyPerson`</ph> structures contain embedded types.","pos":[3529,3608],"source":"In this sample, the `MyPoint` and `MyPerson` structures contain embedded types."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.StructLayoutAttribute&gt;</ph> attribute is set to ensure that the members are arranged in memory sequentially, in the order in which they appear.","pos":[3609,3788],"source":" The <xref:System.Runtime.InteropServices.StructLayoutAttribute> attribute is set to ensure that the members are arranged in memory sequentially, in the order in which they appear."},{"content":"The <ph id=\"ph1\">`LibWrap`</ph> class contains a set of methods called by the <ph id=\"ph2\">`App`</ph> class.","pos":[3795,3867],"source":"The `LibWrap` class contains a set of methods called by the `App` class."},{"content":"For specific details about passing arrays, see the comments in the following sample.","pos":[3868,3952]},{"content":"An array, which is a reference type, is passed as an In parameter by default.","pos":[3953,4030]},{"content":"For the caller to receive the results, <bpt id=\"p1\">**</bpt>InAttribute<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>OutAttribute<ept id=\"p2\">**</ept> must be applied explicitly to the argument containing the array.","pos":[4031,4171],"source":" For the caller to receive the results, **InAttribute** and **OutAttribute** must be applied explicitly to the argument containing the array."},{"pos":[4181,4201],"content":"Declaring Prototypes","linkify":"Declaring Prototypes","nodes":[{"content":"Declaring Prototypes","pos":[0,20]}]},{"pos":[4506,4523],"content":"Calling Functions","linkify":"Calling Functions","nodes":[{"content":"Calling Functions","pos":[0,17]}]},{"pos":[4827,4835],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[4839,4935],"content":"<bpt id=\"p1\">[</bpt>Platform invoke data types<ept id=\"p1\">](marshaling-data-with-platform-invoke.md#platform-invoke-data-types)</ept>","source":"[Platform invoke data types](marshaling-data-with-platform-invoke.md#platform-invoke-data-types)"},{"pos":[4938,5015],"content":"<bpt id=\"p1\">[</bpt>Creating Prototypes in Managed Code<ept id=\"p1\">](creating-prototypes-in-managed-code.md)</ept>","source":"[Creating Prototypes in Managed Code](creating-prototypes-in-managed-code.md)"}]}