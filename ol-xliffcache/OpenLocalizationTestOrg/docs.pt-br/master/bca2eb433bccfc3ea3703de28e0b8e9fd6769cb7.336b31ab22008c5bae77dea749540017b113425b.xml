{"content":"---\ntitle: \"invalidGCHandleCookie MDA | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\n  - \"CSharp\"\n  - \"C++\"\n  - \"jsharp\"\nhelpviewer_keywords: \n  - \"MDAs (managed debugging assistants), invalid cookies\"\n  - \"cookies, invalid\"\n  - \"managed debugging assistants (MDAs), invalid cookies\"\n  - \"InvalidGCHandleCookie MDA\"\n  - \"invalid cookies\"\nms.assetid: 613ad742-3c11-401d-a6b3-893ceb8de4f8\ncaps.latest.revision: 8\nauthor: \"mairaw\"\nms.author: \"mairaw\"\nmanager: \"wpickett\"\n---\n# invalidGCHandleCookie MDA\nThe `invalidGCHandleCookie` managed debugging assistant (MDA) is activated when a conversion from an invalid <xref:System.IntPtr> cookie to a <xref:System.Runtime.InteropServices.GCHandle> is attempted.  \n  \n## Symptoms  \n Undefined behavior such as access violations and memory corruption while attempting to use or retrieve a <xref:System.Runtime.InteropServices.GCHandle> from an <xref:System.IntPtr>.  \n  \n## Cause  \n The cookie is probably invalid because it was not originally created from a <xref:System.Runtime.InteropServices.GCHandle>, represents a <xref:System.Runtime.InteropServices.GCHandle> that has already been freed, is a cookie to a <xref:System.Runtime.InteropServices.GCHandle> in a different application domain, or was marshaled to native code as a <xref:System.Runtime.InteropServices.GCHandle> but passed back into the CLR as an <xref:System.IntPtr>, where a cast was attempted.  \n  \n## Resolution  \n Specify a valid <xref:System.IntPtr> cookie for the <xref:System.Runtime.InteropServices.GCHandle>.  \n  \n## Effect on the Runtime  \n When this MDA is enabled, the debugger is no longer able to trace the roots back to their objects because the cookie values passed back are different from the ones returned when the MDA is not enabled.  \n  \n## Output  \n The invalid <xref:System.IntPtr> cookie value is reported.  \n  \n## Configuration  \n  \n```  \n<mdaConfig>  \n  <assistants>  \n    <invalidGCHandleCookie />  \n  </assistants>  \n</mdaConfig>  \n```  \n  \n## See Also  \n <xref:System.Runtime.InteropServices.GCHandle.FromIntPtr%2A>   \n <xref:System.Runtime.InteropServices.GCHandle>   \n [Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)","nodes":[{"pos":[12,54],"content":"invalidGCHandleCookie MDA | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"invalidGCHandleCookie MDA | Microsoft Docs","pos":[0,42]}]},{"pos":[628,653],"content":"invalidGCHandleCookie MDA","linkify":"invalidGCHandleCookie MDA","nodes":[{"content":"invalidGCHandleCookie MDA","pos":[0,25]}]},{"pos":[654,856],"content":"The <ph id=\"ph1\">`invalidGCHandleCookie`</ph> managed debugging assistant (MDA) is activated when a conversion from an invalid <ph id=\"ph2\">&lt;xref:System.IntPtr&gt;</ph> cookie to a <ph id=\"ph3\">&lt;xref:System.Runtime.InteropServices.GCHandle&gt;</ph> is attempted.","source":"The `invalidGCHandleCookie` managed debugging assistant (MDA) is activated when a conversion from an invalid <xref:System.IntPtr> cookie to a <xref:System.Runtime.InteropServices.GCHandle> is attempted."},{"pos":[865,873],"content":"Symptoms","linkify":"Symptoms","nodes":[{"content":"Symptoms","pos":[0,8]}]},{"content":"Undefined behavior such as access violations and memory corruption while attempting to use or retrieve a <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.GCHandle&gt;</ph> from an <ph id=\"ph2\">&lt;xref:System.IntPtr&gt;</ph>.","pos":[877,1058],"source":"Undefined behavior such as access violations and memory corruption while attempting to use or retrieve a <xref:System.Runtime.InteropServices.GCHandle> from an <xref:System.IntPtr>."},{"pos":[1067,1072],"content":"Cause","linkify":"Cause","nodes":[{"content":"Cause","pos":[0,5]}]},{"content":"The cookie is probably invalid because it was not originally created from a <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.GCHandle&gt;</ph>, represents a <ph id=\"ph2\">&lt;xref:System.Runtime.InteropServices.GCHandle&gt;</ph> that has already been freed, is a cookie to a <ph id=\"ph3\">&lt;xref:System.Runtime.InteropServices.GCHandle&gt;</ph> in a different application domain, or was marshaled to native code as a <ph id=\"ph4\">&lt;xref:System.Runtime.InteropServices.GCHandle&gt;</ph> but passed back into the CLR as an <ph id=\"ph5\">&lt;xref:System.IntPtr&gt;</ph>, where a cast was attempted.","pos":[1076,1556],"source":"The cookie is probably invalid because it was not originally created from a <xref:System.Runtime.InteropServices.GCHandle>, represents a <xref:System.Runtime.InteropServices.GCHandle> that has already been freed, is a cookie to a <xref:System.Runtime.InteropServices.GCHandle> in a different application domain, or was marshaled to native code as a <xref:System.Runtime.InteropServices.GCHandle> but passed back into the CLR as an <xref:System.IntPtr>, where a cast was attempted."},{"pos":[1565,1575],"content":"Resolution","linkify":"Resolution","nodes":[{"content":"Resolution","pos":[0,10]}]},{"content":"Specify a valid <ph id=\"ph1\">&lt;xref:System.IntPtr&gt;</ph> cookie for the <ph id=\"ph2\">&lt;xref:System.Runtime.InteropServices.GCHandle&gt;</ph>.","pos":[1579,1678],"source":"Specify a valid <xref:System.IntPtr> cookie for the <xref:System.Runtime.InteropServices.GCHandle>."},{"pos":[1687,1708],"content":"Effect on the Runtime","linkify":"Effect on the Runtime","nodes":[{"content":"Effect on the Runtime","pos":[0,21]}]},{"content":"When this MDA is enabled, the debugger is no longer able to trace the roots back to their objects because the cookie values passed back are different from the ones returned when the MDA is not enabled.","pos":[1712,1913]},{"pos":[1922,1928],"content":"Output","linkify":"Output","nodes":[{"content":"Output","pos":[0,6]}]},{"content":"The invalid <ph id=\"ph1\">&lt;xref:System.IntPtr&gt;</ph> cookie value is reported.","pos":[1932,1990],"source":"The invalid <xref:System.IntPtr> cookie value is reported."},{"pos":[1999,2012],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"pos":[2132,2140],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.GCHandle.FromIntPtr%2A&gt;</ph>","pos":[2144,2204],"source":"<xref:System.Runtime.InteropServices.GCHandle.FromIntPtr%2A> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.GCHandle&gt;</ph>","pos":[2209,2255],"source":" <xref:System.Runtime.InteropServices.GCHandle> "},{"content":"<bpt id=\"p1\"> [</bpt>Diagnosing Errors with Managed Debugging Assistants<ept id=\"p1\">](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)</ept>","pos":[2259,2413],"source":" [Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)"}]}