{"content":"---\ntitle: \"How to: Create a Service That Returns Arbitrary Data Using The WCF Web HTTP Programming Model | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 0283955a-b4ae-458d-ad9e-6fbb6f529e3d\ncaps.latest.revision: 11\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# How to: Create a Service That Returns Arbitrary Data Using The WCF Web HTTP Programming Model\nSometimes developers must have full control of how data is returned from a service operation. This is the case when a service operation must return data in a format not supported by [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]. This topic discusses using the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] WEB HTTP Programming Model to create such a service. This service has one operation that returns a stream.  \n  \n### To implement the service contract  \n  \n1.  Define the service contract. The contract is called `IImageServer` and has one method called `GetImage` that returns a <xref:System.IO.Stream>.  \n  \n    ```  \n    [ServiceContract]  \n        public interface IImageServer  \n        {  \n            [WebGet]  \n            Stream GetImage(int width, int height);  \n        }  \n    ```  \n  \n     Because the method returns a <xref:System.IO.Stream>, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] assumes that the operation has complete control over the bytes that are returned from the service operation and it applies no formatting to the data that is returned.  \n  \n2.  Implement the service contract. The contract has only one operation (`GetImage`). This method generates a bitmap and then save it to a <xref:System.IO.MemoryStream> in .jpg format. The operation then returns that stream to the caller.  \n  \n    ```  \n    public class Service : IImageServer  \n       {  \n           public Stream GetImage(int width, int height)  \n           {  \n               Bitmap bitmap = new Bitmap(width, height);  \n               for (int i = 0; i < bitmap.Width; i++)  \n               {  \n                   for (int j = 0; j < bitmap.Height; j++)  \n                   {  \n                       bitmap.SetPixel(i, j, (Math.Abs(i - j) < 2) ? Color.Blue : Color.Yellow);  \n                   }  \n               }  \n               MemoryStream ms = new MemoryStream();  \n               bitmap.Save(ms, System.Drawing.Imaging.ImageFormat.Jpeg);  \n               ms.Position = 0;  \n               WebOperationContext.Current.OutgoingResponse.ContentType = \"image/jpeg\";  \n               return ms;  \n           }  \n       }  \n    ```  \n  \n     Notice the second to last line of code: `WebOperationContext.Current.OutgoingResponse.ContentType = \"image/jpeg\";`  \n  \n     This sets the content type header to `\"image/jpeg\"`. Although this sample shows how to return a .jpg file, it can be modified to return any type of data that is required, in any format. The operation must retrieve or generate the data and then write it to a stream.  \n  \n### To host the service  \n  \n1.  Create a console application to host the service.  \n  \n    ```  \n    class Program  \n    {  \n        static void Main(string[] args)  \n        {  \n        }   \n    }  \n    ```  \n  \n2.  Create a variable to hold the base address for the service within the `Main` method.  \n  \n    ```  \n    string baseAddress = \"http://\" + Environment.MachineName + \":8000/Service\";  \n    ```  \n  \n3.  Create a <xref:System.ServiceModel.ServiceHost> instance for the service specifying the service class and the base address.  \n  \n    ```  \n    ServiceHost host = new ServiceHost(typeof(Service), new Uri(baseAddress));  \n  \n    ```  \n  \n4.  Add an endpoint using the <xref:System.ServiceModel.WebHttpBinding> and the <xref:System.ServiceModel.Description.WebHttpBehavior>.  \n  \n    ```  \n    host.AddServiceEndpoint(typeof(IImageServer), new WebHttpBinding(), \"\").Behaviors.Add(new WebHttpBehavior());  \n  \n    ```  \n  \n5.  Open the service host.  \n  \n    ```  \n    host.Open()  \n    ```  \n  \n6.  Wait until the user presses ENTER to terminate the service.  \n  \n    ```  \n    Console.WriteLine(\"Service is running\");  \n    Console.Write(\"Press ENTER to close the host\");  \n    Console.ReadLine();  \n    host.Close();  \n  \n    ```  \n  \n### To call the raw service using Internet Explorer  \n  \n1.  Run the service, you should see the following output from the service. `Service is running Press ENTER to close the host`  \n  \n2.  Open Internet Explorer and type in `http://localhost:8000/Service/GetImage?width=50&height=40` you should see a yellow rectangle with a blue diagonal line through the center.  \n  \n## Example  \n The following is a complete listing of the code for this topic.  \n  \n```  \nusing System;  \nusing System.Collections.Generic;  \nusing System.Text;  \nusing System.ServiceModel;  \nusing System.ServiceModel.Web;  \nusing System.ServiceModel.Description;  \nusing System.IO;  \nusing System.Drawing;  \n  \nnamespace RawImageService  \n{  \n    // Define the service contract  \n    [ServiceContract]  \n    public interface IImageServer  \n    {  \n        [WebGet]  \n        Stream GetImage(int width, int height);  \n    }  \n  \n    // implement the service contract  \n    public class Service : IImageServer  \n    {  \n        public Stream GetImage(int width, int height)  \n        {  \n            // Although this method returns a jpeg, it can be  \n            // modified to return any data you want within the stream  \n            Bitmap bitmap = new Bitmap(width, height);  \n            for (int i = 0; i < bitmap.Width; i++)  \n            {  \n                for (int j = 0; j < bitmap.Height; j++)  \n                {  \n                    bitmap.SetPixel(i, j, (Math.Abs(i - j) < 2) ? Color.Blue : Color.Yellow);  \n                }  \n            }  \n            MemoryStream ms = new MemoryStream();  \n            bitmap.Save(ms, System.Drawing.Imaging.ImageFormat.Jpeg);  \n            ms.Position = 0;  \n            WebOperationContext.Current.OutgoingResponse.ContentType = \"image/jpeg\";  \n            return ms;  \n        }  \n    }  \n  \n    class Program  \n    {  \n        static void Main(string[] args)  \n        {  \n            string baseAddress = \"http://\" + Environment.MachineName + \":8000/Service\";  \n            ServiceHost host = new ServiceHost(typeof(Service), new Uri(baseAddress));  \n            host.AddServiceEndpoint(typeof(IImageServer), new WebHttpBinding(), \"\").Behaviors.Add(new WebHttpBehavior());  \n            host.Open();  \n            Console.WriteLine(\"Service is running\");  \n            Console.Write(\"Press ENTER to close the host\");  \n            Console.ReadLine();  \n            host.Close();  \n  \n        }  \n    }  \n}  \n  \n```  \n  \n## Compiling the Code  \n  \n-   When compiling the sample code reference System.ServiceModel.dll and System.ServiceModel.Web.dll.  \n  \n## See Also  \n [WCF Web HTTP Programming Model](../../../../docs/framework/wcf/feature-details/wcf-web-http-programming-model.md)","nodes":[{"pos":[12,122],"content":"How to: Create a Service That Returns Arbitrary Data Using The WCF Web HTTP Programming Model | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"How to: Create a Service That Returns Arbitrary Data Using The WCF Web HTTP Programming Model | Microsoft Docs","pos":[0,110]}]},{"pos":[421,514],"content":"How to: Create a Service That Returns Arbitrary Data Using The WCF Web HTTP Programming Model","linkify":"How to: Create a Service That Returns Arbitrary Data Using The WCF Web HTTP Programming Model","nodes":[{"content":"How to: Create a Service That Returns Arbitrary Data Using The WCF Web HTTP Programming Model","pos":[0,93]}]},{"content":"Sometimes developers must have full control of how data is returned from a service operation.","pos":[515,608]},{"content":"This is the case when a service operation must return data in a format not supported by <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph>.","pos":[609,753],"source":" This is the case when a service operation must return data in a format not supported by [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]."},{"content":"This topic discusses using the <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> WEB HTTP Programming Model to create such a service.","pos":[754,893],"source":" This topic discusses using the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] WEB HTTP Programming Model to create such a service."},{"content":"This service has one operation that returns a stream.","pos":[894,947]},{"pos":[957,990],"content":"To implement the service contract","linkify":"To implement the service contract","nodes":[{"content":"To implement the service contract","pos":[0,33]}]},{"content":"Define the service contract.","pos":[1000,1028]},{"content":"The contract is called <ph id=\"ph1\">`IImageServer`</ph> and has one method called <ph id=\"ph2\">`GetImage`</ph> that returns a <ph id=\"ph3\">&lt;xref:System.IO.Stream&gt;</ph>.","pos":[1029,1143],"source":" The contract is called `IImageServer` and has one method called `GetImage` that returns a <xref:System.IO.Stream>."},{"pos":[1342,1618],"content":"Because the method returns a <ph id=\"ph1\">&lt;xref:System.IO.Stream&gt;</ph>, <ph id=\"ph2\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> assumes that the operation has complete control over the bytes that are returned from the service operation and it applies no formatting to the data that is returned.","source":"Because the method returns a <xref:System.IO.Stream>, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] assumes that the operation has complete control over the bytes that are returned from the service operation and it applies no formatting to the data that is returned."},{"content":"Implement the service contract.","pos":[1628,1659]},{"content":"The contract has only one operation (<ph id=\"ph1\">`GetImage`</ph>).","pos":[1660,1709],"source":" The contract has only one operation (`GetImage`)."},{"content":"This method generates a bitmap and then save it to a <ph id=\"ph1\">&lt;xref:System.IO.MemoryStream&gt;</ph> in .jpg format.","pos":[1710,1808],"source":" This method generates a bitmap and then save it to a <xref:System.IO.MemoryStream> in .jpg format."},{"content":"The operation then returns that stream to the caller.","pos":[1809,1862]},{"pos":[2691,2805],"content":"Notice the second to last line of code: <ph id=\"ph1\">`WebOperationContext.Current.OutgoingResponse.ContentType = \"image/jpeg\";`</ph>","source":"Notice the second to last line of code: `WebOperationContext.Current.OutgoingResponse.ContentType = \"image/jpeg\";`"},{"content":"This sets the content type header to <ph id=\"ph1\">`\"image/jpeg\"`</ph>.","pos":[2816,2868],"source":"This sets the content type header to `\"image/jpeg\"`."},{"content":"Although this sample shows how to return a .jpg file, it can be modified to return any type of data that is required, in any format.","pos":[2869,3001]},{"content":"The operation must retrieve or generate the data and then write it to a stream.","pos":[3002,3081]},{"pos":[3091,3110],"content":"To host the service","linkify":"To host the service","nodes":[{"content":"To host the service","pos":[0,19]}]},{"content":"Create a console application to host the service.","pos":[3120,3169]},{"pos":[3305,3389],"content":"Create a variable to hold the base address for the service within the <ph id=\"ph1\">`Main`</ph> method.","source":"Create a variable to hold the base address for the service within the `Main` method."},{"content":"Create a <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> instance for the service specifying the service class and the base address.","pos":[3504,3627],"source":"Create a <xref:System.ServiceModel.ServiceHost> instance for the service specifying the service class and the base address."},{"content":"Add an endpoint using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.WebHttpBinding&gt;</ph> and the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.WebHttpBehavior&gt;</ph>.","pos":[3744,3875],"source":"Add an endpoint using the <xref:System.ServiceModel.WebHttpBinding> and the <xref:System.ServiceModel.Description.WebHttpBehavior>."},{"content":"Open the service host.","pos":[4027,4049]},{"content":"Wait until the user presses ENTER to terminate the service.","pos":[4100,4159]},{"pos":[4342,4389],"content":"To call the raw service using Internet Explorer","linkify":"To call the raw service using Internet Explorer","nodes":[{"content":"To call the raw service using Internet Explorer","pos":[0,47]}]},{"content":"Run the service, you should see the following output from the service.","pos":[4399,4469]},{"pos":[4530,4704],"content":"Open Internet Explorer and type in <ph id=\"ph1\">`http://localhost:8000/Service/GetImage?width=50&amp;height=40`</ph> you should see a yellow rectangle with a blue diagonal line through the center.","source":"Open Internet Explorer and type in `http://localhost:8000/Service/GetImage?width=50&height=40` you should see a yellow rectangle with a blue diagonal line through the center."},{"pos":[4713,4720],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The following is a complete listing of the code for this topic.","pos":[4724,4787]},{"pos":[6791,6809],"content":"Compiling the Code","linkify":"Compiling the Code","nodes":[{"content":"Compiling the Code","pos":[0,18]}]},{"content":"When compiling the sample code reference System.ServiceModel.dll and System.ServiceModel.Web.dll.","pos":[6819,6916]},{"pos":[6925,6933],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"pos":[6937,7051],"content":"<bpt id=\"p1\">[</bpt>WCF Web HTTP Programming Model<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/wcf-web-http-programming-model.md)</ept>","source":"[WCF Web HTTP Programming Model](../../../../docs/framework/wcf/feature-details/wcf-web-http-programming-model.md)"}]}