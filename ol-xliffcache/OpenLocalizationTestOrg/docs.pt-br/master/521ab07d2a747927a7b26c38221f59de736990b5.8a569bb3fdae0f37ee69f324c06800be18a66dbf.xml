{"content":"---\ntitle: \"ASP.NET Compatibility\"\nms.date: \"03/30/2017\"\nms.assetid: c8b51f1e-c096-4c42-ad99-0519887bbbc5\n---\n# ASP.NET Compatibility\nThis sample demonstrates how to enable ASP.NET Compatibility mode in Windows Communication Foundation (WCF). Services running in ASP.NET Compatibility mode participate fully in the ASP.NET application pipeline and can make use of ASP.NET features such as file/URL authorization, session state, and the <xref:System.Web.HttpContext> class. The <xref:System.Web.HttpContext> class allows access to cookies, sessions, and other ASP.NET features. This mode requires that the bindings use the HTTP transport and the service itself must be hosted in IIS.  \n  \n In this sample, the client is a console application (an executable) and the service is hosted in Internet Information Services (IIS).  \n  \n> [!NOTE]\n>  The set-up procedure and build instructions for this sample are located at the end of this topic.  \n  \nThis sample requires a [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)] application pool in order to run. To create a new application pool, or to modify the default application pool, follow these steps.  \n\n1.  Open **Control Panel**.  Open the **Administrative Tools** applet under the **System and Security** heading. Open the **Internet Information Services (IIS) Manager** applet.  \n\n2.  Expand the treeview in the **Connections** pane. Select the **Application Pools** node.  \n\n3.  To set the default application pool to use [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)] (which may cause incompatibility problems with existing sites), right-click the **DefaultAppPool** list item and select **Basic Settings…**. Set the **.Net Framework Version** pull-down to **.Net Framework v4.0.30128** (or later).  \n\n4.  To create a new application pool that uses [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)] (to preserve compatibility for other applications), right-click the **Application Pools** node and select **Add Application Pool…**. Name the new application pool, and set the **.Net Framework Version** pull-down to **.Net Framework v4.0.30128** (or later). After running the setup steps below, right-click the **ServiceModelSamples** application and select **Manage Application**, **Advanced Settings…**. Set the **Application Pool** to the new application pool.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your computer. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Services\\Hosting\\WebHost\\ASPNetCompatibility`  \n  \n This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md), which implements a calculator service. The `ICalculator` contract has been modified as the `ICalculatorSession` contract to allow a set of operations to be performed, while keeping a running result.  \n  \n```csharp  \n[ServiceContract(Namespace=\"http://Microsoft.ServiceModel.Samples\")]  \npublic interface ICalculatorSession  \n{  \n    [OperationContract]  \n    void Clear();  \n    [OperationContract]  \n    void AddTo(double n);  \n    [OperationContract]  \n    void SubtractFrom(double n);  \n    [OperationContract]  \n    void MultiplyBy(double n);  \n    [OperationContract]  \n    void DivideBy(double n);  \n    [OperationContract]  \n    double Result();  \n}  \n```  \n  \n The service maintains state, using the feature, for each client as multiple service operations are called to perform a calculation. The client can retrieve the current result by calling `Result` and can clear the result to zero by calling `Clear`.  \n  \n The service uses the ASP.NET session to store the result for each client session. This allows the service to maintain the running result for each client across multiple calls to the service.  \n  \n> [!NOTE]\n> ASP.NET session state and WCF sessions are very different things. See [Session](../../../../docs/framework/wcf/samples/session.md) for details on WCF sessions.\n  \n The service has an intimate dependency on ASP.NET session state and requires ASP.NET compatibility mode to function correctly. These requirements are expressed declaratively by applying the `AspNetCompatibilityRequirements` attribute.  \n  \n```csharp  \n[AspNetCompatibilityRequirements(RequirementsMode =  \n                       AspNetCompatibilityRequirementsMode.Required)]  \npublic class CalculatorService : ICalculatorSession  \n{  \n    double Result  \n    {  // store result in AspNet Session  \n       get {  \n          if (HttpContext.Current.Session[\"Result\"] != null)  \n             return (double)HttpContext.Current.Session[\"Result\"];  \n          return 0.0D;  \n       }  \n       set  \n       {  \n          HttpContext.Current.Session[\"Result\"] = value;  \n       }  \n    }  \n    public void Clear()  \n    {  \n        Result = 0.0D;  \n    }  \n    public void AddTo(double n)  \n    {  \n        Result += n;  \n    }  \n    public void SubtractFrom(double n)  \n    {  \n        Result -= n;  \n    }  \n    public void MultiplyBy(double n)  \n    {  \n        Result *= n;  \n    }  \n    public void DivideBy(double n)  \n    {  \n        Result /= n;  \n    }  \n    public double Result()  \n    {  \n        return Result;  \n    }  \n}  \n```\n  \n When you run the sample, the operation requests and responses are displayed in the client console window. Press ENTER in the client window to shut down the client.  \n  \n```console\n0, + 100, - 50, * 17.65, / 2 = 441.25  \nPress <ENTER> to terminate client.  \n```  \n  \n### To set up, build, and run the sample  \n  \n1.  Be sure you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).  \n  \n2.  To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).  \n  \n3.  After the solution has been built, run Setup.bat to set up the ServiceModelSamples Application in [!INCLUDE[iisver](../../../../includes/iisver-md.md)]. The ServiceModelSamples directory should now appear as an [!INCLUDE[iisver](../../../../includes/iisver-md.md)] Application.  \n  \n4.  To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).  \n  \n## See also\n\n- [AppFabric Hosting and Persistence Samples](https://go.microsoft.com/fwlink/?LinkId=193961)\n","nodes":[{"pos":[4,105],"embed":true,"restype":"x-metadata","content":"title: \"ASP.NET Compatibility\"\nms.date: \"03/30/2017\"\nms.assetid: c8b51f1e-c096-4c42-ad99-0519887bbbc5","nodes":[{"content":"ASP.NET Compatibility","nodes":[{"pos":[0,21],"content":"ASP.NET Compatibility","nodes":[{"content":"ASP.NET Compatibility","pos":[0,21]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[112,133],"content":"ASP.NET Compatibility","linkify":"ASP.NET Compatibility","nodes":[{"content":"ASP.NET Compatibility","pos":[0,21]}]},{"content":"This sample demonstrates how to enable ASP.NET Compatibility mode in Windows Communication Foundation (WCF).","pos":[134,242]},{"content":"Services running in ASP.NET Compatibility mode participate fully in the ASP.NET application pipeline and can make use of ASP.NET features such as file/URL authorization, session state, and the <ph id=\"ph1\">&lt;xref:System.Web.HttpContext&gt;</ph> class.","pos":[243,472],"source":" Services running in ASP.NET Compatibility mode participate fully in the ASP.NET application pipeline and can make use of ASP.NET features such as file/URL authorization, session state, and the <xref:System.Web.HttpContext> class."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Web.HttpContext&gt;</ph> class allows access to cookies, sessions, and other ASP.NET features.","pos":[473,576],"source":" The <xref:System.Web.HttpContext> class allows access to cookies, sessions, and other ASP.NET features."},{"content":"This mode requires that the bindings use the HTTP transport and the service itself must be hosted in IIS.","pos":[577,682]},{"content":"In this sample, the client is a console application (an executable) and the service is hosted in Internet Information Services (IIS).","pos":[689,822]},{"pos":[830,938],"content":"[!NOTE]\n The set-up procedure and build instructions for this sample are located at the end of this topic.","leadings":["","> "],"nodes":[{"content":"The set-up procedure and build instructions for this sample are located at the end of this topic.","pos":[9,106]}]},{"content":"This sample requires a <ph id=\"ph1\">[!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)]</ph> application pool in order to run.","pos":[944,1066],"source":"This sample requires a [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)] application pool in order to run."},{"content":"To create a new application pool, or to modify the default application pool, follow these steps.","pos":[1067,1163]},{"content":"Open <bpt id=\"p1\">**</bpt>Control Panel<ept id=\"p1\">**</ept>.","pos":[1171,1194],"source":"Open **Control Panel**."},{"content":"Open the <bpt id=\"p1\">**</bpt>Administrative Tools<ept id=\"p1\">**</ept> applet under the <bpt id=\"p2\">**</bpt>System and Security<ept id=\"p2\">**</ept> heading.","pos":[1196,1279],"source":"  Open the **Administrative Tools** applet under the **System and Security** heading."},{"content":"Open the <bpt id=\"p1\">**</bpt>Internet Information Services (IIS) Manager<ept id=\"p1\">**</ept> applet.","pos":[1280,1344],"source":" Open the **Internet Information Services (IIS) Manager** applet."},{"content":"Expand the treeview in the <bpt id=\"p1\">**</bpt>Connections<ept id=\"p1\">**</ept> pane.","pos":[1352,1400],"source":"Expand the treeview in the **Connections** pane."},{"content":"Select the <bpt id=\"p1\">**</bpt>Application Pools<ept id=\"p1\">**</ept> node.","pos":[1401,1439],"source":" Select the **Application Pools** node."},{"content":"To set the default application pool to use <ph id=\"ph1\">[!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)]</ph> (which may cause incompatibility problems with existing sites), right-click the <bpt id=\"p1\">**</bpt>DefaultAppPool<ept id=\"p1\">**</ept> list item and select <bpt id=\"p2\">**</bpt>Basic Settings…<ept id=\"p2\">**</ept>.","pos":[1447,1696],"source":"To set the default application pool to use [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)] (which may cause incompatibility problems with existing sites), right-click the **DefaultAppPool** list item and select **Basic Settings…**."},{"content":"Set the <bpt id=\"p1\">**</bpt>.Net Framework Version<ept id=\"p1\">**</ept> pull-down to <bpt id=\"p2\">**</bpt>.Net Framework v4.0.30128<ept id=\"p2\">**</ept> (or later).","pos":[1697,1786],"source":" Set the **.Net Framework Version** pull-down to **.Net Framework v4.0.30128** (or later)."},{"content":"To create a new application pool that uses <ph id=\"ph1\">[!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)]</ph> (to preserve compatibility for other applications), right-click the <bpt id=\"p1\">**</bpt>Application Pools<ept id=\"p1\">**</ept> node and select <bpt id=\"p2\">**</bpt>Add Application Pool…<ept id=\"p2\">**</ept>.","pos":[1794,2035],"source":"To create a new application pool that uses [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)] (to preserve compatibility for other applications), right-click the **Application Pools** node and select **Add Application Pool…**."},{"content":"Name the new application pool, and set the <bpt id=\"p1\">**</bpt>.Net Framework Version<ept id=\"p1\">**</ept> pull-down to <bpt id=\"p2\">**</bpt>.Net Framework v4.0.30128<ept id=\"p2\">**</ept> (or later).","pos":[2036,2160],"source":" Name the new application pool, and set the **.Net Framework Version** pull-down to **.Net Framework v4.0.30128** (or later)."},{"content":"After running the setup steps below, right-click the <bpt id=\"p1\">**</bpt>ServiceModelSamples<ept id=\"p1\">**</ept> application and select <bpt id=\"p2\">**</bpt>Manage Application<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Advanced Settings…<ept id=\"p3\">**</ept>.","pos":[2161,2308],"source":" After running the setup steps below, right-click the **ServiceModelSamples** application and select **Manage Application**, **Advanced Settings…**."},{"content":"Set the <bpt id=\"p1\">**</bpt>Application Pool<ept id=\"p1\">**</ept> to the new application pool.","pos":[2309,2366],"source":" Set the **Application Pool** to the new application pool."},{"pos":[2374,2507],"content":"[!IMPORTANT]\n The samples may already be installed on your computer. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your computer. Check for the following (default) directory before continuing.","pos":[14,131],"nodes":[{"content":"The samples may already be installed on your computer.","pos":[0,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[2561,2871],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[2872,2922]},{"content":"This sample is based on the <bpt id=\"p1\">[</bpt>Getting Started<ept id=\"p1\">](../../../../docs/framework/wcf/samples/getting-started-sample.md)</ept>, which implements a calculator service.","pos":[3027,3178],"source":"This sample is based on the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md), which implements a calculator service."},{"content":"The <ph id=\"ph1\">`ICalculator`</ph> contract has been modified as the <ph id=\"ph2\">`ICalculatorSession`</ph> contract to allow a set of operations to be performed, while keeping a running result.","pos":[3179,3338],"source":" The `ICalculator` contract has been modified as the `ICalculatorSession` contract to allow a set of operations to be performed, while keeping a running result."},{"content":"The service maintains state, using the feature, for each client as multiple service operations are called to perform a calculation.","pos":[3809,3940]},{"content":"The client can retrieve the current result by calling <ph id=\"ph1\">`Result`</ph> and can clear the result to zero by calling <ph id=\"ph2\">`Clear`</ph>.","pos":[3941,4056],"source":" The client can retrieve the current result by calling `Result` and can clear the result to zero by calling `Clear`."},{"content":"The service uses the ASP.NET session to store the result for each client session.","pos":[4063,4144]},{"content":"This allows the service to maintain the running result for each client across multiple calls to the service.","pos":[4145,4253]},{"pos":[4261,4430],"content":"[!NOTE]\nASP.NET session state and WCF sessions are very different things. See [Session](../../../../docs/framework/wcf/samples/session.md) for details on WCF sessions.","leadings":["","> "],"nodes":[{"content":"ASP.NET session state and WCF sessions are very different things. See [Session](../../../../docs/framework/wcf/samples/session.md) for details on WCF sessions.","pos":[8,167],"nodes":[{"content":"ASP.NET session state and WCF sessions are very different things.","pos":[0,65]},{"content":"See <bpt id=\"p1\">[</bpt>Session<ept id=\"p1\">](../../../../docs/framework/wcf/samples/session.md)</ept> for details on WCF sessions.","pos":[66,159],"source":" See [Session](../../../../docs/framework/wcf/samples/session.md) for details on WCF sessions."}]}]},{"content":"The service has an intimate dependency on ASP.NET session state and requires ASP.NET compatibility mode to function correctly.","pos":[4435,4561]},{"content":"These requirements are expressed declaratively by applying the <ph id=\"ph1\">`AspNetCompatibilityRequirements`</ph> attribute.","pos":[4562,4669],"source":" These requirements are expressed declaratively by applying the `AspNetCompatibilityRequirements` attribute."},{"content":"When you run the sample, the operation requests and responses are displayed in the client console window.","pos":[5675,5780]},{"content":"Press ENTER in the client window to shut down the client.","pos":[5781,5838]},{"pos":[5945,5981],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[5991,6186],"content":"Be sure you have performed the <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Be sure you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"pos":[6196,6405],"content":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"content":"After the solution has been built, run Setup.bat to set up the ServiceModelSamples Application in <ph id=\"ph1\">[!INCLUDE[iisver](../../../../includes/iisver-md.md)]</ph>.","pos":[6415,6567],"source":"After the solution has been built, run Setup.bat to set up the ServiceModelSamples Application in [!INCLUDE[iisver](../../../../includes/iisver-md.md)]."},{"content":"The ServiceModelSamples directory should now appear as an <ph id=\"ph1\">[!INCLUDE[iisver](../../../../includes/iisver-md.md)]</ph> Application.","pos":[6568,6692],"source":" The ServiceModelSamples directory should now appear as an [!INCLUDE[iisver](../../../../includes/iisver-md.md)] Application."},{"pos":[6702,6911],"content":"To run the sample in a single- or cross-computer configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a single- or cross-computer configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"pos":[6920,6928],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6932,7023],"content":"<bpt id=\"p1\">[</bpt>AppFabric Hosting and Persistence Samples<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=193961)</ept>","source":"[AppFabric Hosting and Persistence Samples](https://go.microsoft.com/fwlink/?LinkId=193961)"}]}