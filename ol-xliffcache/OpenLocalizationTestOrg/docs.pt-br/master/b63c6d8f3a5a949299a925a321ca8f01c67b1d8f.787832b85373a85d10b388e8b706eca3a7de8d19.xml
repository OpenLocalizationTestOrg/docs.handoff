{"content":"---\ntitle: \"Service Operations (WCF Data Services)\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"service operations [WCF Data Services]\"\n  - \"WCF Data Services, service operations\"\nms.assetid: 583a690a-e60f-4990-8991-d6efce069d76\n---\n# Service Operations (WCF Data Services)\n[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] enables you to define service operations on a data service to expose methods on the server. Like other data service resources, service operations are addressed by URIs. Service operations enable you to expose business logic in a data service, such as to implement validation logic, to apply role-based security, or to expose specialized querying capabilities. Service operations are methods added to the data service class that derives from <xref:System.Data.Services.DataService%601>. Like all other data service resources, you can supply parameters to the service operation method. For example, the following service operation URI (based on the [quickstart](../../../../docs/framework/data/wcf/quickstart-wcf-data-services.md) data service) passes the value `London` to the `city` parameter:  \n  \n```  \nhttp://localhost:12345/Northwind.svc/GetOrdersByCity?city='London'  \n```  \n  \n The definition for this service operation is as follows:  \n  \n [!code-csharp[Astoria Northwind Service#ServiceOperationDef](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind service/cs/northwind2.svc.cs#serviceoperationdef)]\n [!code-vb[Astoria Northwind Service#ServiceOperationDef](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind service/vb/northwind2.svc.vb#serviceoperationdef)]  \n  \n You can use the <xref:System.Data.Services.DataService%601.CurrentDataSource%2A> of the <xref:System.Data.Services.DataService%601> to directly access the data source that the data service is using. For more information, see [How to: Define a Service Operation](../../../../docs/framework/data/wcf/how-to-define-a-service-operation-wcf-data-services.md).  \n  \n For information on how to call a service operation from a .NET Framework client application, see [Calling Service Operations](../../../../docs/framework/data/wcf/calling-service-operations-wcf-data-services.md).  \n  \n## Service Operation Requirements  \n The following requirements apply when defining service operations on the data service. If a method does not meet these requirements, it will not be exposed as a service operation for the data service.  \n  \n-   The operation must be a public instance method that is a member of the data service class.  \n  \n-   The operation method may only accept input parameters. Data sent in the message body cannot be accessed by the data service.  \n  \n-   If parameters are defined, the type of each parameter must be a primitive type. Any data of a non-primitive type must be serialized and passed into a string parameter.  \n  \n-   The method must return one of the following:  \n  \n    -   `void` (`Nothing` in Visual Basic)  \n  \n    -   <xref:System.Collections.Generic.IEnumerable%601>  \n  \n    -   <xref:System.Linq.IQueryable%601>  \n  \n    -   An entity type in the data model that the data service exposes.  \n  \n    -   A primitive class such as integer or string.  \n  \n-   In order to support query options such as sorting, paging, and filtering, service operation methods should return <xref:System.Linq.IQueryable%601>. Requests to service operations that include query options are rejected for operations that only return <xref:System.Collections.Generic.IEnumerable%601>.  \n  \n-   In order to support accessing related entities by using navigation properties, the service operation must return <xref:System.Linq.IQueryable%601>.  \n  \n-   The method must be annotated with the `[WebGet]` or `[WebInvoke]` attribute.  \n  \n    -   `[WebGet]` enables the method to be invoked by using a GET request.  \n  \n    -   `[WebInvoke(Method = \"POST\")]` enables the method to be invoked by using a POST request. Other <xref:System.ServiceModel.Web.WebInvokeAttribute> methods are not supported.  \n  \n-   A service operation may be annotated with the <xref:System.Data.Services.SingleResultAttribute> that specifies that the return value from the method is a single entity rather than a collection of entities. This distinction dictates the resulting serialization of the response and the manner in which additional navigation property traversals are represented in the URI. For example, when using AtomPub serialization, a single resource type instance is represented as an entry element and a set of instances as a feed element.  \n  \n## Addressing Service Operations  \n You can address service operations by placing the name of the method in the first path segment of a URI. As an example, the following URI accesses a `GetOrdersByState` operation that returns an <xref:System.Linq.IQueryable%601> collection of `Orders` objects.  \n  \n```  \nhttp://localhost:12345/Northwind.svc/GetOrdersByState?state='CA'&includeItems=true  \n```  \n  \n When calling a service operation, parameters are supplied as query options. The previous service operation accepts both a string parameter `state` and a Boolean parameter `includeItems` that indicates whether to include related `Order_Detail` objects in the response.  \n  \n The following are valid return types for a service operation:  \n  \n|Valid Return Types|URI Rules|  \n|------------------------|---------------|  \n|`void` (`Nothing` in Visual Basic)<br /><br /> -or-<br /><br /> Entity types<br /><br /> -or-<br /><br /> Primitive types|The URI must be a single path segment that is the name of the service operation. Query options are not allowed.|  \n|<xref:System.Collections.Generic.IEnumerable%601>|The URI must be a single path segment that is the name of the service operation. Because the result type is not an <xref:System.Linq.IQueryable%601> type, query options are not allowed.|  \n|<xref:System.Linq.IQueryable%601>|Query path segments in addition to the path that is the name of the service operation are allowed. Query options are also allowed.|  \n  \n Additional path segments or query options may be added to the URI depending on the return type of the service operation. For example, the following URI accesses a `GetOrdersByCity` operation that returns an <xref:System.Linq.IQueryable%601> collection of `Orders` objects, ordered by `RequiredDate` in descending order, along with the related `Order_Details` objects:  \n  \n```  \nhttp://localhost:12345/Northwind.svc/GetOrdersByCity?city='London'&$expand=Order_Details&$orderby=RequiredDate desc  \n```  \n  \n## Service Operations Access Control  \n Service-wide visibility of service operations is controlled by the <xref:System.Data.Services.IDataServiceConfiguration.SetServiceOperationAccessRule%2A> method on the <xref:System.Data.Services.IDataServiceConfiguration> class in much the same way that entity set visibility is controlled by using the <xref:System.Data.Services.IDataServiceConfiguration.SetEntitySetAccessRule%2A> method. For example, the following line of code in the data service definition enables access to the `CustomersByCity` service operation.  \n  \n [!code-csharp[Astoria Northwind Service#ServiceOperationConfig](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind service/cs/northwind2.svc.cs#serviceoperationconfig)]\n [!code-vb[Astoria Northwind Service#ServiceOperationConfig](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind service/vb/northwind2.svc.vb#serviceoperationconfig)]  \n  \n> [!NOTE]\n>  If a service operation has a return type that has been hidden by restricting access on the underlying entity sets, then the service operation will not be available to client applications.  \n  \n For more information, see [How to: Define a Service Operation](../../../../docs/framework/data/wcf/how-to-define-a-service-operation-wcf-data-services.md).  \n  \n## Raising Exceptions  \n We recommend that you use the <xref:System.Data.Services.DataServiceException> class whenever you raise an exception in the data service execution. This is because the data service runtime knows how to map properties of this exception object correctly to the HTTP response message. When you raise a <xref:System.Data.Services.DataServiceException> in a service operation, the returned exception is wrapped in a <xref:System.Reflection.TargetInvocationException>. To return the base <xref:System.Data.Services.DataServiceException> without the enclosing <xref:System.Reflection.TargetInvocationException>, you must override the <xref:System.Data.Services.DataService%601.HandleException%2A> method in the <xref:System.Data.Services.DataService%601>, extract the <xref:System.Data.Services.DataServiceException> from the <xref:System.Reflection.TargetInvocationException>, and return it as the top-level error, as in the following example:  \n  \n [!code-csharp[Astoria Northwind Service#HandleExceptions](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria northwind service/cs/northwind2.svc.cs#handleexceptions)]\n [!code-vb[Astoria Northwind Service#HandleExceptions](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria northwind service/vb/northwind2.svc.vb#handleexceptions)]  \n  \n## See also\n\n- [Interceptors](../../../../docs/framework/data/wcf/interceptors-wcf-data-services.md)\n","nodes":[{"pos":[4,267],"embed":true,"restype":"x-metadata","content":"title: \"Service Operations (WCF Data Services)\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"service operations [WCF Data Services]\"\n  - \"WCF Data Services, service operations\"\nms.assetid: 583a690a-e60f-4990-8991-d6efce069d76","nodes":[{"content":"Service Operations (WCF Data Services)","nodes":[{"pos":[0,38],"content":"Service Operations (WCF Data Services)","nodes":[{"content":"Service Operations (WCF Data Services)","pos":[0,38]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[274,312],"content":"Service Operations (WCF Data Services)","linkify":"Service Operations (WCF Data Services)","nodes":[{"content":"Service Operations (WCF Data Services)","pos":[0,38]}]},{"content":"<ph id=\"ph1\">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]</ph> enables you to define service operations on a data service to expose methods on the server.","pos":[313,464],"source":"[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] enables you to define service operations on a data service to expose methods on the server."},{"content":"Like other data service resources, service operations are addressed by URIs.","pos":[465,541]},{"content":"Service operations enable you to expose business logic in a data service, such as to implement validation logic, to apply role-based security, or to expose specialized querying capabilities.","pos":[542,732]},{"content":"Service operations are methods added to the data service class that derives from <ph id=\"ph1\">&lt;xref:System.Data.Services.DataService%601&gt;</ph>.","pos":[733,858],"source":" Service operations are methods added to the data service class that derives from <xref:System.Data.Services.DataService%601>."},{"content":"Like all other data service resources, you can supply parameters to the service operation method.","pos":[859,956]},{"content":"For example, the following service operation URI (based on the <bpt id=\"p1\">[</bpt>quickstart<ept id=\"p1\">](../../../../docs/framework/data/wcf/quickstart-wcf-data-services.md)</ept> data service) passes the value <ph id=\"ph1\">`London`</ph> to the <ph id=\"ph2\">`city`</ph> parameter:","pos":[957,1166],"source":" For example, the following service operation URI (based on the [quickstart](../../../../docs/framework/data/wcf/quickstart-wcf-data-services.md) data service) passes the value `London` to the `city` parameter:"},{"content":"The definition for this service operation is as follows:","pos":[1257,1313]},{"content":"You can use the <ph id=\"ph1\">&lt;xref:System.Data.Services.DataService%601.CurrentDataSource%2A&gt;</ph> of the <ph id=\"ph2\">&lt;xref:System.Data.Services.DataService%601&gt;</ph> to directly access the data source that the data service is using.","pos":[1694,1892],"source":"You can use the <xref:System.Data.Services.DataService%601.CurrentDataSource%2A> of the <xref:System.Data.Services.DataService%601> to directly access the data source that the data service is using."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>How to: Define a Service Operation<ept id=\"p1\">](../../../../docs/framework/data/wcf/how-to-define-a-service-operation-wcf-data-services.md)</ept>.","pos":[1893,2048],"source":" For more information, see [How to: Define a Service Operation](../../../../docs/framework/data/wcf/how-to-define-a-service-operation-wcf-data-services.md)."},{"pos":[2055,2266],"content":"For information on how to call a service operation from a .NET Framework client application, see <bpt id=\"p1\">[</bpt>Calling Service Operations<ept id=\"p1\">](../../../../docs/framework/data/wcf/calling-service-operations-wcf-data-services.md)</ept>.","source":"For information on how to call a service operation from a .NET Framework client application, see [Calling Service Operations](../../../../docs/framework/data/wcf/calling-service-operations-wcf-data-services.md)."},{"pos":[2275,2305],"content":"Service Operation Requirements","linkify":"Service Operation Requirements","nodes":[{"content":"Service Operation Requirements","pos":[0,30]}]},{"content":"The following requirements apply when defining service operations on the data service.","pos":[2309,2395]},{"content":"If a method does not meet these requirements, it will not be exposed as a service operation for the data service.","pos":[2396,2509]},{"content":"The operation must be a public instance method that is a member of the data service class.","pos":[2519,2609]},{"content":"The operation method may only accept input parameters.","pos":[2619,2673]},{"content":"Data sent in the message body cannot be accessed by the data service.","pos":[2674,2743]},{"content":"If parameters are defined, the type of each parameter must be a primitive type.","pos":[2753,2832]},{"content":"Any data of a non-primitive type must be serialized and passed into a string parameter.","pos":[2833,2920]},{"content":"The method must return one of the following:","pos":[2930,2974]},{"pos":[2988,3022],"content":"<ph id=\"ph1\">`void`</ph> (<ph id=\"ph2\">`Nothing`</ph> in Visual Basic)","source":"`void` (`Nothing` in Visual Basic)"},{"content":"An entity type in the data model that the data service exposes.","pos":[3146,3209]},{"content":"A primitive class such as integer or string.","pos":[3223,3267]},{"content":"In order to support query options such as sorting, paging, and filtering, service operation methods should return <ph id=\"ph1\">&lt;xref:System.Linq.IQueryable%601&gt;</ph>.","pos":[3277,3425],"source":"In order to support query options such as sorting, paging, and filtering, service operation methods should return <xref:System.Linq.IQueryable%601>."},{"content":"Requests to service operations that include query options are rejected for operations that only return <ph id=\"ph1\">&lt;xref:System.Collections.Generic.IEnumerable%601&gt;</ph>.","pos":[3426,3579],"source":" Requests to service operations that include query options are rejected for operations that only return <xref:System.Collections.Generic.IEnumerable%601>."},{"pos":[3589,3736],"content":"In order to support accessing related entities by using navigation properties, the service operation must return <ph id=\"ph1\">&lt;xref:System.Linq.IQueryable%601&gt;</ph>.","source":"In order to support accessing related entities by using navigation properties, the service operation must return <xref:System.Linq.IQueryable%601>."},{"pos":[3746,3822],"content":"The method must be annotated with the <ph id=\"ph1\">`[WebGet]`</ph> or <ph id=\"ph2\">`[WebInvoke]`</ph> attribute.","source":"The method must be annotated with the `[WebGet]` or `[WebInvoke]` attribute."},{"pos":[3836,3903],"content":"<ph id=\"ph1\">`[WebGet]`</ph> enables the method to be invoked by using a GET request.","source":"`[WebGet]` enables the method to be invoked by using a GET request."},{"content":"<ph id=\"ph1\">`[WebInvoke(Method = \"POST\")]`</ph> enables the method to be invoked by using a POST request.","pos":[3917,4005],"source":"`[WebInvoke(Method = \"POST\")]` enables the method to be invoked by using a POST request."},{"content":"Other <ph id=\"ph1\">&lt;xref:System.ServiceModel.Web.WebInvokeAttribute&gt;</ph> methods are not supported.","pos":[4006,4088],"source":" Other <xref:System.ServiceModel.Web.WebInvokeAttribute> methods are not supported."},{"content":"A service operation may be annotated with the <ph id=\"ph1\">&lt;xref:System.Data.Services.SingleResultAttribute&gt;</ph> that specifies that the return value from the method is a single entity rather than a collection of entities.","pos":[4098,4303],"source":"A service operation may be annotated with the <xref:System.Data.Services.SingleResultAttribute> that specifies that the return value from the method is a single entity rather than a collection of entities."},{"content":"This distinction dictates the resulting serialization of the response and the manner in which additional navigation property traversals are represented in the URI.","pos":[4304,4467]},{"content":"For example, when using AtomPub serialization, a single resource type instance is represented as an entry element and a set of instances as a feed element.","pos":[4468,4623]},{"pos":[4632,4661],"content":"Addressing Service Operations","linkify":"Addressing Service Operations","nodes":[{"content":"Addressing Service Operations","pos":[0,29]}]},{"content":"You can address service operations by placing the name of the method in the first path segment of a URI.","pos":[4665,4769]},{"content":"As an example, the following URI accesses a <ph id=\"ph1\">`GetOrdersByState`</ph> operation that returns an <ph id=\"ph2\">&lt;xref:System.Linq.IQueryable%601&gt;</ph> collection of <ph id=\"ph3\">`Orders`</ph> objects.","pos":[4770,4924],"source":" As an example, the following URI accesses a `GetOrdersByState` operation that returns an <xref:System.Linq.IQueryable%601> collection of `Orders` objects."},{"content":"When calling a service operation, parameters are supplied as query options.","pos":[5031,5106]},{"content":"The previous service operation accepts both a string parameter <ph id=\"ph1\">`state`</ph> and a Boolean parameter <ph id=\"ph2\">`includeItems`</ph> that indicates whether to include related <ph id=\"ph3\">`Order_Detail`</ph> objects in the response.","pos":[5107,5298],"source":" The previous service operation accepts both a string parameter `state` and a Boolean parameter `includeItems` that indicates whether to include related `Order_Detail` objects in the response."},{"content":"The following are valid return types for a service operation:","pos":[5305,5366]},{"content":"Valid Return Types","pos":[5373,5391]},{"content":"URI Rules","pos":[5392,5401]},{"content":"<ph id=\"ph1\">`void`</ph> (<ph id=\"ph2\">`Nothing`</ph> in Visual Basic)","pos":[5451,5485],"source":"`void` (`Nothing` in Visual Basic)"},{"content":"-or-","pos":[5498,5502]},{"content":"Entity types","pos":[5515,5527]},{"content":"-or-","pos":[5540,5544]},{"content":"Primitive types","pos":[5557,5572]},{"content":"The URI must be a single path segment that is the name of the service operation.","pos":[5573,5653]},{"content":"Query options are not allowed.","pos":[5654,5684]},{"content":"The URI must be a single path segment that is the name of the service operation.","pos":[5739,5819]},{"content":"Because the result type is not an <ph id=\"ph1\">&lt;xref:System.Linq.IQueryable%601&gt;</ph> type, query options are not allowed.","pos":[5820,5924],"source":" Because the result type is not an <xref:System.Linq.IQueryable%601> type, query options are not allowed."},{"content":"Query path segments in addition to the path that is the name of the service operation are allowed.","pos":[5963,6061]},{"content":"Query options are also allowed.","pos":[6062,6093]},{"content":"Additional path segments or query options may be added to the URI depending on the return type of the service operation.","pos":[6101,6221]},{"content":"For example, the following URI accesses a <ph id=\"ph1\">`GetOrdersByCity`</ph> operation that returns an <ph id=\"ph2\">&lt;xref:System.Linq.IQueryable%601&gt;</ph> collection of <ph id=\"ph3\">`Orders`</ph> objects, ordered by <ph id=\"ph4\">`RequiredDate`</ph> in descending order, along with the related <ph id=\"ph5\">`Order_Details`</ph> objects:","pos":[6222,6468],"source":" For example, the following URI accesses a `GetOrdersByCity` operation that returns an <xref:System.Linq.IQueryable%601> collection of `Orders` objects, ordered by `RequiredDate` in descending order, along with the related `Order_Details` objects:"},{"pos":[6610,6643],"content":"Service Operations Access Control","linkify":"Service Operations Access Control","nodes":[{"content":"Service Operations Access Control","pos":[0,33]}]},{"content":"Service-wide visibility of service operations is controlled by the <ph id=\"ph1\">&lt;xref:System.Data.Services.IDataServiceConfiguration.SetServiceOperationAccessRule%2A&gt;</ph> method on the <ph id=\"ph2\">&lt;xref:System.Data.Services.IDataServiceConfiguration&gt;</ph> class in much the same way that entity set visibility is controlled by using the <ph id=\"ph3\">&lt;xref:System.Data.Services.IDataServiceConfiguration.SetEntitySetAccessRule%2A&gt;</ph> method.","pos":[6647,7037],"source":"Service-wide visibility of service operations is controlled by the <xref:System.Data.Services.IDataServiceConfiguration.SetServiceOperationAccessRule%2A> method on the <xref:System.Data.Services.IDataServiceConfiguration> class in much the same way that entity set visibility is controlled by using the <xref:System.Data.Services.IDataServiceConfiguration.SetEntitySetAccessRule%2A> method."},{"content":"For example, the following line of code in the data service definition enables access to the <ph id=\"ph1\">`CustomersByCity`</ph> service operation.","pos":[7038,7167],"source":" For example, the following line of code in the data service definition enables access to the `CustomersByCity` service operation."},{"pos":[7561,7759],"content":"[!NOTE]\n If a service operation has a return type that has been hidden by restricting access on the underlying entity sets, then the service operation will not be available to client applications.","leadings":["","> "],"nodes":[{"content":"If a service operation has a return type that has been hidden by restricting access on the underlying entity sets, then the service operation will not be available to client applications.","pos":[9,196]}]},{"pos":[7766,7921],"content":"For more information, see <bpt id=\"p1\">[</bpt>How to: Define a Service Operation<ept id=\"p1\">](../../../../docs/framework/data/wcf/how-to-define-a-service-operation-wcf-data-services.md)</ept>.","source":"For more information, see [How to: Define a Service Operation](../../../../docs/framework/data/wcf/how-to-define-a-service-operation-wcf-data-services.md)."},{"pos":[7930,7948],"content":"Raising Exceptions","linkify":"Raising Exceptions","nodes":[{"content":"Raising Exceptions","pos":[0,18]}]},{"content":"We recommend that you use the <ph id=\"ph1\">&lt;xref:System.Data.Services.DataServiceException&gt;</ph> class whenever you raise an exception in the data service execution.","pos":[7952,8099],"source":"We recommend that you use the <xref:System.Data.Services.DataServiceException> class whenever you raise an exception in the data service execution."},{"content":"This is because the data service runtime knows how to map properties of this exception object correctly to the HTTP response message.","pos":[8100,8233]},{"content":"When you raise a <ph id=\"ph1\">&lt;xref:System.Data.Services.DataServiceException&gt;</ph> in a service operation, the returned exception is wrapped in a <ph id=\"ph2\">&lt;xref:System.Reflection.TargetInvocationException&gt;</ph>.","pos":[8234,8414],"source":" When you raise a <xref:System.Data.Services.DataServiceException> in a service operation, the returned exception is wrapped in a <xref:System.Reflection.TargetInvocationException>."},{"content":"To return the base <ph id=\"ph1\">&lt;xref:System.Data.Services.DataServiceException&gt;</ph> without the enclosing <ph id=\"ph2\">&lt;xref:System.Reflection.TargetInvocationException&gt;</ph>, you must override the <ph id=\"ph3\">&lt;xref:System.Data.Services.DataService%601.HandleException%2A&gt;</ph> method in the <ph id=\"ph4\">&lt;xref:System.Data.Services.DataService%601&gt;</ph>, extract the <ph id=\"ph5\">&lt;xref:System.Data.Services.DataServiceException&gt;</ph> from the <ph id=\"ph6\">&lt;xref:System.Reflection.TargetInvocationException&gt;</ph>, and return it as the top-level error, as in the following example:","pos":[8415,8889],"source":" To return the base <xref:System.Data.Services.DataServiceException> without the enclosing <xref:System.Reflection.TargetInvocationException>, you must override the <xref:System.Data.Services.DataService%601.HandleException%2A> method in the <xref:System.Data.Services.DataService%601>, extract the <xref:System.Data.Services.DataServiceException> from the <xref:System.Reflection.TargetInvocationException>, and return it as the top-level error, as in the following example:"},{"pos":[9260,9268],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[9272,9357],"content":"<bpt id=\"p1\">[</bpt>Interceptors<ept id=\"p1\">](../../../../docs/framework/data/wcf/interceptors-wcf-data-services.md)</ept>","source":"[Interceptors](../../../../docs/framework/data/wcf/interceptors-wcf-data-services.md)"}]}