{"content":"---\ntitle: \"Data Contract Surrogates\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"data contracts [WCF], surrogates\"\nms.assetid: 8c31134c-46c5-4ed7-94af-bab0ac0dfce5\n---\n# Data Contract Surrogates\nThe data contract *surrogate* is an advanced feature built upon the Data Contract model. This feature is designed to be used for type customization and substitution in situations where users want to change how a type is serialized, deserialized or projected into metadata. Some scenarios where a surrogate may be used is when a data contract has not been specified for the type, fields and properties are not marked with the <xref:System.Runtime.Serialization.DataMemberAttribute> attribute or users wish to dynamically create schema variations.  \n  \n Serialization and deserialization are accomplished with the data contract surrogate when using <xref:System.Runtime.Serialization.DataContractSerializer> to convert from .NET Framework to a suitable format, such as XML. Data contract surrogate can also be used to modify the metadata exported for types, when producing metadata representations such as XML Schema Documents (XSD). Upon import, code is created from metadata and the surrogate can be used in this case to customize the generated code as well.  \n  \n## How the Surrogate Works  \n A surrogate works by mapping one type (the \"original\" type) to another type (the \"surrogated\" type). The following example shows the original type `Inventory` and a new surrogate `InventorySurrogated` type. The `Inventory` type is not serializable but the `InventorySurrogated` type is:  \n  \n [!code-csharp[C_IDataContractSurrogate#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#1)]  \n  \n Because a data contract has not been defined for this class, convert the class to a surrogate class with a data contract. The surrogated class is shown in the following example:  \n  \n [!code-csharp[C_IDataContractSurrogate#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#2)]  \n  \n## Implementing the IDataContractSurrogate  \n To use the data contract surrogate, implement the <xref:System.Runtime.Serialization.IDataContractSurrogate> interface.  \n  \n The following is an overview of each method of <xref:System.Runtime.Serialization.IDataContractSurrogate> with a possible implementation.  \n  \n### GetDataContractType  \n The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method maps one type to another. This method is required for serialization, deserialization, import, and export.  \n  \n The first task is defining what types will be mapped to other types. For example:  \n  \n [!code-csharp[C_IDataContractSurrogate#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#3)]  \n  \n-   On serialization, the mapping returned by this method is subsequently used to transform the original instance to a surrogated instance by calling the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method.  \n  \n-   On deserialization, the mapping returned by this method is used by the serializer to deserialize into an instance of the surrogate type. It subsequently calls <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> to transform the surrogated instance into an instance of the original type.  \n  \n-   On export, the surrogate type returned by this method is reflected to get the data contract to use for generating metadata.  \n  \n-   On import, the initial type is changed to a surrogate type that is reflected to get the data contract to use for purposes like referencing support.  \n  \n The <xref:System.Type> parameter is the type of the object that is being serialized, deserialized, imported, or exported. The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method must return the input type if the surrogate does not handle the type. Otherwise, return the appropriate surrogated type. If several surrogate types exist, numerous mappings can be defined in this method.  \n  \n The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method is not called for built-in data contract primitives, such as <xref:System.Int32> or <xref:System.String>. For other types, such as arrays, user-defined types, and other data structures, this method will be called for each type.  \n  \n In the previous example, the method checks if the `type` parameter and `Inventory` are comparable. If so, the method maps it to `InventorySurrogated`. Whenever a serialization, deserialization, import schema, or export schema is called, this function is called first to determine the mapping between types.  \n  \n### GetObjectToSerialize Method  \n The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method converts the original type instance to the surrogated type instance. The method is required for serialization.  \n  \n The next step is to define the way the physical data will be mapped from the original instance to the surrogate by implementing the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method. For example:  \n  \n [!code-csharp[C_IDataContractSurrogate#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#4)]  \n  \n The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method is called when an object is serialized. This method transfers data from the original type to the fields of the surrogated type. Fields can be directly mapped to surrogate fields, or manipulations of the original data may be stored in the surrogate. Some possible uses include: directly mapping the fields, performing operations on the data to be stored in the surrogated fields, or storing the XML of the original type in the surrogated field.  \n  \n The `targetType` parameter refers to the declared type of the member. This parameter is the surrogated type returned by the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method. The serializer does not enforce that the object returned is assignable to this type. The `obj` parameter is the object to serialize, and will be converted to its surrogate if necessary. This method must return the input object if the surrogated does not handle the object. Otherwise, the new surrogate object will be returned. The surrogate is not called if the object is null. Numerous surrogate mappings for different instances may be defined within this method.  \n  \n When creating a <xref:System.Runtime.Serialization.DataContractSerializer>, you can instruct it to preserve object references. (For more information, see [Serialization and Deserialization](../../../../docs/framework/wcf/feature-details/serialization-and-deserialization.md).) This is done by setting the `preserveObjectReferences` parameter in its constructor to `true`. In that case, the surrogate is called only once for an object since all subsequent serializations just write the reference into the stream. If `preserveObjectReferences` is set to `false`, then the surrogate is called every time an instance is encountered.  \n  \n If the type of the instance serialized differs from the declared type, type information is written into the stream, for example, `xsi:type` to allow the instance to be deserialized at the other end. This process occurs whether the object is surrogated or not.  \n  \n The example above converts the data of the `Inventory` instance to that of `InventorySurrogated`. It checks the type of the object and performs the necessary manipulations to convert to the surrogated type. In this case, the fields of the `Inventory` class are directly copied over to the `InventorySurrogated` class fields.  \n  \n### GetDeserializedObject Method  \n The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> method converts the surrogated type instance to the original type instance. It is required for deserialization.  \n  \n The next task is to define the way the physical data will be mapped from the surrogate instance to the original. For example:  \n  \n [!code-csharp[C_IDataContractSurrogate#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#5)]  \n  \n This method is called only during the deserialization of an object. It provides reverse data mapping for the deserialization from the surrogate type back to its original type. Similar to the `GetObjectToSerialize` method, some possible uses may be to directly exchange field data, perform operations on the data, and store XML data. When  deserializing, you may not always obtain the exact data values from original due to manipulations in the data conversion.  \n  \n The `targetType` parameter refers to the declared type of the member. This parameter is the surrogated type returned by the `GetDataContractType` method. The `obj` parameter refers to the object that has been deserialized. The object can be converted back to its original type if it is surrogated. This method returns the input object if the surrogate does not handle the object. Otherwise, the deserialized object will be returned once its conversion has been completed. If several surrogate types exist, you may provide data conversion from surrogate to primary type for each by indicating each type and its conversion.  \n  \n When returning an object, the internal object tables are updated with the object returned by this surrogate. Any subsequent references to an instance will obtain the surrogated instance from the object tables.  \n  \n The previous example converts objects of type `InventorySurrogated` back to the initial type `Inventory`. In this case, data is directly transferred back from `InventorySurrogated` to its corresponding fields in `Inventory`. Because there are no data manipulations, the each of the member fields will contain the same values as before the serialization.  \n  \n### GetCustomDataToExport Method  \n When exporting a schema, the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> method is optional. It is used to insert additional data or hints into the exported schema. Additional data can be inserted at the member level or type level. For example:  \n  \n [!code-csharp[C_IDataContractSurrogate#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#6)]  \n  \n This method (with two overloads) enables the inclusion of extra information into the metadata either at the member or type level. It is possible to include hints about whether a member is public or private, and comments which would be preserved throughout the export and import of the schema. Such information would be lost without this method. This method does not cause the insertion or deletion of members or types, but rather adds additional data to the schemas at either of these levels.  \n  \n The method is overloaded and can take either a `Type` (`clrtype` parameter) or <xref:System.Reflection.MemberInfo> (`memberInfo` parameter). The second parameter is always a `Type` (`dataContractType` parameter). This method is called for every member and type of the surrogated `dataContractType` type.  \n  \n Either of these overloads must return either `null` or a serializable object. A non-null object will be serialized as annotation into the exported schema. For the `Type` overload, each type that is exported to schema is sent to this method in the first parameter along with the surrogated type as the `dataContractType` parameter. For the `MemberInfo` overload, each member that is exported to schema sends its information as the `memberInfo` parameter with the surrogated type in the second parameter.  \n  \n#### GetCustomDataToExport Method (Type, Type)  \n The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Type%2CSystem.Type%29?displayProperty=nameWithType> method is called during schema export for every type definition. The method adds information to the types within the schema when exporting. Each type defined is sent to this method to determine whether there is any additional data that needs to be included in the schema.  \n  \n#### GetCustomDataToExport Method (MemberInfo, Type)  \n The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Reflection.MemberInfo%2CSystem.Type%29?displayProperty=nameWithType> is called during export for every member in the types that are exported. This function enables you to customize any comments for the members that will be included in the schema upon export. The information for every member within the class is sent to this method to check whether any additional data need to be added in the schema.  \n  \n The example above searches through the `dataContractType` for each member of the surrogate. It then returns the appropriate access modifier for each field. Without this customization, the default value for access modifiers is public. Therefore, all members would be defined as public in the code generated using the exported schema no matter what their actual access restrictions are. When not using this implementation, the member `numpens` would be public in the exported schema even though it was defined in the surrogate as private. Through the use of this method, in the exported schema, the access modifier can be generated as private.  \n  \n### GetReferencedTypeOnImport Method  \n This method maps the <xref:System.Type> of the surrogate to the original type. This method is optional for schema importation.  \n  \n When creating a surrogate that imports a schema and generates code for it, the next task is to define the type of a surrogate instance to its original type.  \n  \n If the generated code needs to reference an existing user type, this is done by implementing the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> method.  \n  \n When importing a schema, this method is called for every type declaration to map the surrogated data contract to a type. The string parameters `typeName` and `typeNamespace` define the name and namespace of the surrogated type. The return value for <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> is used to determine whether a new type needs to be generated. This method must return either a valid type or null. For valid types, the type returned will be used as a referenced type in the generated code. If null is returned, no type will be referenced and a new type must be created. If several surrogates exist, it is possible to perform the mapping for each surrogate type back to its initial type.  \n  \n The `customData` parameter is the object originally returned from <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A>. This `customData` is used when surrogate authors want to insert extra data/hints into the metadata to use during import to generate code.  \n  \n### ProcessImportedType Method  \n The <xref:System.Runtime.Serialization.IDataContractSurrogate.ProcessImportedType%2A> method customizes any type created from schema importation. This method is optional.  \n  \n When importing a schema, this method allows for any imported type and compilation information to be customized. For example:  \n  \n [!code-csharp[C_IDataContractSurrogate#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#7)]  \n  \n During import, this method is called for every type generated. Change the specified <xref:System.CodeDom.CodeTypeDeclaration> or modify the <xref:System.CodeDom.CodeCompileUnit>. This includes changing the name, members, attributes, and many other properties of the `CodeTypeDeclaration`. By processing the `CodeCompileUnit`, it is possible to modify the directives, namespaces, referenced assemblies, and several other aspects.  \n  \n The `CodeTypeDeclaration` parameter contains the code DOM type declaration. The `CodeCompileUnit` parameter allows for modification for processing the code.  Returning `null` results in the type declaration being discarded. Conversely, when returning a `CodeTypeDeclaration`, the modifications are preserved.  \n  \n If custom data is inserted during metadata export, it needs to be provided to the user during import so that it can be used. This custom data can be used for programming model hints, or other comments. Each `CodeTypeDeclaration` and <xref:System.CodeDom.CodeTypeMember> instance includes custom data as the <xref:System.CodeDom.CodeObject.UserData%2A> property, cast to the `IDataContractSurrogate` type.  \n  \n The example above performs some changes on the schema imported. The code preserves private members of the original type by using a surrogate. The default access modifier when importing a schema is `public`. Therefore, all members of the surrogate schema will be public unless modified, as in this example. During export, custom data is inserted into the metadata about which members are private. The example looks up the custom data, checks whether the access modifier is private, and then modifies the appropriate member to be private by setting its attributes. Without this customization, the `numpens` member would be defined as public instead of private.  \n  \n### GetKnownCustomDataTypes Method  \n This method obtains custom data types defined from the schema. The method is optional for schema importation.  \n  \n The method is called at the beginning of schema export and import. The method returns the custom data types used in the schema exported or imported. The method is passed a <xref:System.Collections.ObjectModel.Collection%601> (the `customDataTypes` parameter), which is a collection of types. The method should add additional known types to this collection. The known custom data types are needed to enable serialization and deserialization of custom data using the <xref:System.Runtime.Serialization.DataContractSerializer>. For more information, see [Data Contract Known Types](../../../../docs/framework/wcf/feature-details/data-contract-known-types.md).  \n  \n## Implementing a Surrogate  \n To use the data contract surrogate within WCF, you must follow a few special procedures.  \n  \n### To Use a Surrogate for Serialization and Deserialization  \n Use the <xref:System.Runtime.Serialization.DataContractSerializer> to perform serialization and deserialization of data with the surrogate. The <xref:System.Runtime.Serialization.DataContractSerializer> is created by the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>. The surrogate must also be specified.  \n  \n##### To implement serialization and deserialization  \n  \n1.  Create an instance of the <xref:System.ServiceModel.ServiceHost> for your service. For complete instructions, see [Basic WCF Programming](../../../../docs/framework/wcf/basic-wcf-programming.md).  \n  \n2.  For every <xref:System.ServiceModel.Description.ServiceEndpoint> of the specified service host, find its <xref:System.ServiceModel.Description.OperationDescription>.  \n  \n3.  Search through the operation behaviors to determine if an instance of the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found.  \n  \n4.  If a <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found, set its <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> property to a new instance of the surrogate. If no <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found, then create a new instance and set the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> member of the new behavior to a new instance of the surrogate.  \n  \n5.  Finally, add this new behavior to the current operation behaviors, as shown in the following example:  \n  \n     [!code-csharp[C_IDataContractSurrogate#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#8)]  \n  \n### To Use a Surrogate for Metadata Import  \n When importing metadata like WSDL and XSD to generate client-side code, the surrogate needs to be added to the component responsible for generating code from XSD schema, <xref:System.Runtime.Serialization.XsdDataContractImporter>. To do this, directly modify the <xref:System.ServiceModel.Description.WsdlImporter> used to import metadata.  \n  \n##### To implement a surrogate for metadata importation  \n  \n1.  Import the metadata using the <xref:System.ServiceModel.Description.WsdlImporter> class.  \n  \n2.  Use the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method to check whether an <xref:System.Runtime.Serialization.XsdDataContractImporter> has been defined.  \n  \n3.  If the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method returns `false`, create a new <xref:System.Runtime.Serialization.XsdDataContractImporter> and set its <xref:System.Runtime.Serialization.XsdDataContractImporter.Options%2A> property to a new instance of the <xref:System.Runtime.Serialization.ImportOptions> class. Otherwise, use the importer returned by the `out` parameter of the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method.  \n  \n4.  If the <xref:System.Runtime.Serialization.XsdDataContractImporter> has no <xref:System.Runtime.Serialization.ImportOptions> defined, then set the property to be a new instance of the <xref:System.Runtime.Serialization.ImportOptions> class.  \n  \n5.  Set the <xref:System.Runtime.Serialization.ImportOptions.DataContractSurrogate%2A> property of the <xref:System.Runtime.Serialization.ImportOptions> of the <xref:System.Runtime.Serialization.XsdDataContractImporter> to a new instance of the surrogate.  \n  \n6.  Add the <xref:System.Runtime.Serialization.XsdDataContractImporter> to the collection returned by the <xref:System.ServiceModel.Description.MetadataExporter.State%2A> property of the <xref:System.ServiceModel.Description.WsdlImporter> (inherited from the <xref:System.ServiceModel.Description.MetadataExporter> class.)  \n  \n7.  Use the <xref:System.ServiceModel.Description.WsdlImporter.ImportAllContracts%2A> method of the <xref:System.ServiceModel.Description.WsdlImporter> to import all of the data contracts within the schema. During the last step, code is generated from the schemas loaded by calling into the surrogate.  \n  \n     [!code-csharp[C_IDataContractSurrogate#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#9)]  \n  \n### To Use a surrogate for Metadata Export  \n By default, when exporting metadata from WCF for a service, both WSDL and XSD schema needs to be generated. The surrogate needs to be added to the component responsible for generating XSD schema for data contract types, <xref:System.Runtime.Serialization.XsdDataContractExporter>. To do this, either use a behavior that implements <xref:System.ServiceModel.Description.IWsdlExportExtension> to modify the <xref:System.ServiceModel.Description.WsdlExporter>, or directly modify the <xref:System.ServiceModel.Description.WsdlExporter> used to export metadata.  \n  \n##### To use a surrogate for metadata export  \n  \n1.  Create a new <xref:System.ServiceModel.Description.WsdlExporter> or use the `wsdlExporter` parameter passed to the <xref:System.ServiceModel.Description.IWsdlExportExtension.ExportContract%2A> method.  \n  \n2.  Use the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> function to check whether an <xref:System.Runtime.Serialization.XsdDataContractExporter> has been defined.  \n  \n3.  If <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> returns `false`, create a new <xref:System.Runtime.Serialization.XsdDataContractExporter> with the generated XML schemas from the <xref:System.ServiceModel.Description.WsdlExporter>, and add it to the collection returned by the <xref:System.ServiceModel.Description.MetadataExporter.State%2A> property of the <xref:System.ServiceModel.Description.WsdlExporter>. Otherwise, use the exporter returned by the `out` parameter of the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method.  \n  \n4.  If the <xref:System.Runtime.Serialization.XsdDataContractExporter> has no <xref:System.Runtime.Serialization.ExportOptions> defined, then set the <xref:System.Runtime.Serialization.XsdDataContractExporter.Options%2A> property to a new instance of the <xref:System.Runtime.Serialization.ExportOptions> class.  \n  \n5.  Set the <xref:System.Runtime.Serialization.ExportOptions.DataContractSurrogate%2A> property of the <xref:System.Runtime.Serialization.ExportOptions> of the <xref:System.Runtime.Serialization.XsdDataContractExporter> to a new instance of the surrogate. Subsequent steps for exporting metadata do not require any changes.  \n  \n     [!code-csharp[C_IDataContractSurrogate#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#10)]  \n  \n## See also\n\n- <xref:System.Runtime.Serialization.DataContractSerializer>\n- <xref:System.Runtime.Serialization.IDataContractSurrogate>\n- <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>\n- <xref:System.Runtime.Serialization.ImportOptions>\n- <xref:System.Runtime.Serialization.ExportOptions>\n- [Using Data Contracts](../../../../docs/framework/wcf/feature-details/using-data-contracts.md)\n","nodes":[{"pos":[4,169],"embed":true,"restype":"x-metadata","content":"title: \"Data Contract Surrogates\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"data contracts [WCF], surrogates\"\nms.assetid: 8c31134c-46c5-4ed7-94af-bab0ac0dfce5","nodes":[{"content":"Data Contract Surrogates","nodes":[{"pos":[0,24],"content":"Data Contract Surrogates","nodes":[{"content":"Data Contract Surrogates","pos":[0,24]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[176,200],"content":"Data Contract Surrogates","linkify":"Data Contract Surrogates","nodes":[{"content":"Data Contract Surrogates","pos":[0,24]}]},{"content":"The data contract <bpt id=\"p1\">*</bpt>surrogate<ept id=\"p1\">*</ept> is an advanced feature built upon the Data Contract model.","pos":[201,289],"source":"The data contract *surrogate* is an advanced feature built upon the Data Contract model."},{"content":"This feature is designed to be used for type customization and substitution in situations where users want to change how a type is serialized, deserialized or projected into metadata.","pos":[290,473]},{"content":"Some scenarios where a surrogate may be used is when a data contract has not been specified for the type, fields and properties are not marked with the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.DataMemberAttribute&gt;</ph> attribute or users wish to dynamically create schema variations.","pos":[474,746],"source":" Some scenarios where a surrogate may be used is when a data contract has not been specified for the type, fields and properties are not marked with the <xref:System.Runtime.Serialization.DataMemberAttribute> attribute or users wish to dynamically create schema variations."},{"content":"Serialization and deserialization are accomplished with the data contract surrogate when using <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.DataContractSerializer&gt;</ph> to convert from .NET Framework to a suitable format, such as XML.","pos":[753,972],"source":"Serialization and deserialization are accomplished with the data contract surrogate when using <xref:System.Runtime.Serialization.DataContractSerializer> to convert from .NET Framework to a suitable format, such as XML."},{"content":"Data contract surrogate can also be used to modify the metadata exported for types, when producing metadata representations such as XML Schema Documents (XSD).","pos":[973,1132]},{"content":"Upon import, code is created from metadata and the surrogate can be used in this case to customize the generated code as well.","pos":[1133,1259]},{"pos":[1268,1291],"content":"How the Surrogate Works","linkify":"How the Surrogate Works","nodes":[{"content":"How the Surrogate Works","pos":[0,23]}]},{"content":"A surrogate works by mapping one type (the \"original\" type) to another type (the \"surrogated\" type).","pos":[1295,1395]},{"content":"The following example shows the original type <ph id=\"ph1\">`Inventory`</ph> and a new surrogate <ph id=\"ph2\">`InventorySurrogated`</ph> type.","pos":[1396,1501],"source":" The following example shows the original type `Inventory` and a new surrogate `InventorySurrogated` type."},{"content":"The <ph id=\"ph1\">`Inventory`</ph> type is not serializable but the <ph id=\"ph2\">`InventorySurrogated`</ph> type is:","pos":[1502,1581],"source":" The `Inventory` type is not serializable but the `InventorySurrogated` type is:"},{"content":"Because a data contract has not been defined for this class, convert the class to a surrogate class with a data contract.","pos":[1730,1851]},{"content":"The surrogated class is shown in the following example:","pos":[1852,1907]},{"pos":[2058,2097],"content":"Implementing the IDataContractSurrogate","linkify":"Implementing the IDataContractSurrogate","nodes":[{"content":"Implementing the IDataContractSurrogate","pos":[0,39]}]},{"pos":[2101,2220],"content":"To use the data contract surrogate, implement the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate&gt;</ph> interface.","source":"To use the data contract surrogate, implement the <xref:System.Runtime.Serialization.IDataContractSurrogate> interface."},{"pos":[2227,2364],"content":"The following is an overview of each method of <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate&gt;</ph> with a possible implementation.","source":"The following is an overview of each method of <xref:System.Runtime.Serialization.IDataContractSurrogate> with a possible implementation."},{"pos":[2374,2393],"content":"GetDataContractType","linkify":"GetDataContractType","nodes":[{"content":"GetDataContractType","pos":[0,19]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A&gt;</ph> method maps one type to another.","pos":[2397,2515],"source":"The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method maps one type to another."},{"content":"This method is required for serialization, deserialization, import, and export.","pos":[2516,2595]},{"content":"The first task is defining what types will be mapped to other types.","pos":[2602,2670]},{"content":"For example:","pos":[2671,2683]},{"pos":[2835,3075],"content":"On serialization, the mapping returned by this method is subsequently used to transform the original instance to a surrogated instance by calling the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A&gt;</ph> method.","source":"On serialization, the mapping returned by this method is subsequently used to transform the original instance to a surrogated instance by calling the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method."},{"content":"On deserialization, the mapping returned by this method is used by the serializer to deserialize into an instance of the surrogate type.","pos":[3085,3221]},{"content":"It subsequently calls <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A&gt;</ph> to transform the surrogated instance into an instance of the original type.","pos":[3222,3403],"source":" It subsequently calls <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> to transform the surrogated instance into an instance of the original type."},{"content":"On export, the surrogate type returned by this method is reflected to get the data contract to use for generating metadata.","pos":[3413,3536]},{"content":"On import, the initial type is changed to a surrogate type that is reflected to get the data contract to use for purposes like referencing support.","pos":[3546,3693]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Type&gt;</ph> parameter is the type of the object that is being serialized, deserialized, imported, or exported.","pos":[3700,3821],"source":"The <xref:System.Type> parameter is the type of the object that is being serialized, deserialized, imported, or exported."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A&gt;</ph> method must return the input type if the surrogate does not handle the type.","pos":[3822,3984],"source":" The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method must return the input type if the surrogate does not handle the type."},{"content":"Otherwise, return the appropriate surrogated type.","pos":[3985,4035]},{"content":"If several surrogate types exist, numerous mappings can be defined in this method.","pos":[4036,4118]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A&gt;</ph> method is not called for built-in data contract primitives, such as <ph id=\"ph2\">&lt;xref:System.Int32&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.String&gt;</ph>.","pos":[4125,4323],"source":"The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method is not called for built-in data contract primitives, such as <xref:System.Int32> or <xref:System.String>."},{"content":"For other types, such as arrays, user-defined types, and other data structures, this method will be called for each type.","pos":[4324,4445]},{"content":"In the previous example, the method checks if the <ph id=\"ph1\">`type`</ph> parameter and <ph id=\"ph2\">`Inventory`</ph> are comparable.","pos":[4452,4550],"source":"In the previous example, the method checks if the `type` parameter and `Inventory` are comparable."},{"content":"If so, the method maps it to <ph id=\"ph1\">`InventorySurrogated`</ph>.","pos":[4551,4602],"source":" If so, the method maps it to `InventorySurrogated`."},{"content":"Whenever a serialization, deserialization, import schema, or export schema is called, this function is called first to determine the mapping between types.","pos":[4603,4758]},{"pos":[4768,4795],"content":"GetObjectToSerialize Method","linkify":"GetObjectToSerialize Method","nodes":[{"content":"GetObjectToSerialize Method","pos":[0,27]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A&gt;</ph> method converts the original type instance to the surrogated type instance.","pos":[4799,4961],"source":"The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method converts the original type instance to the surrogated type instance."},{"content":"The method is required for serialization.","pos":[4962,5003]},{"content":"The next step is to define the way the physical data will be mapped from the original instance to the surrogate by implementing the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A&gt;</ph> method.","pos":[5010,5232],"source":"The next step is to define the way the physical data will be mapped from the original instance to the surrogate by implementing the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method."},{"content":"For example:","pos":[5233,5245]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A&gt;</ph> method is called when an object is serialized.","pos":[5394,5527],"source":"The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method is called when an object is serialized."},{"content":"This method transfers data from the original type to the fields of the surrogated type.","pos":[5528,5615]},{"content":"Fields can be directly mapped to surrogate fields, or manipulations of the original data may be stored in the surrogate.","pos":[5616,5736]},{"content":"Some possible uses include: directly mapping the fields, performing operations on the data to be stored in the surrogated fields, or storing the XML of the original type in the surrogated field.","pos":[5737,5931]},{"content":"The <ph id=\"ph1\">`targetType`</ph> parameter refers to the declared type of the member.","pos":[5938,6007],"source":"The `targetType` parameter refers to the declared type of the member."},{"content":"This parameter is the surrogated type returned by the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A&gt;</ph> method.","pos":[6008,6151],"source":" This parameter is the surrogated type returned by the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method."},{"content":"The serializer does not enforce that the object returned is assignable to this type.","pos":[6152,6236]},{"content":"The <ph id=\"ph1\">`obj`</ph> parameter is the object to serialize, and will be converted to its surrogate if necessary.","pos":[6237,6337],"source":" The `obj` parameter is the object to serialize, and will be converted to its surrogate if necessary."},{"content":"This method must return the input object if the surrogated does not handle the object.","pos":[6338,6424]},{"content":"Otherwise, the new surrogate object will be returned.","pos":[6425,6478]},{"content":"The surrogate is not called if the object is null.","pos":[6479,6529]},{"content":"Numerous surrogate mappings for different instances may be defined within this method.","pos":[6530,6616]},{"content":"When creating a <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.DataContractSerializer&gt;</ph>, you can instruct it to preserve object references.","pos":[6623,6749],"source":"When creating a <xref:System.Runtime.Serialization.DataContractSerializer>, you can instruct it to preserve object references."},{"content":"(For more information, see <bpt id=\"p1\">[</bpt>Serialization and Deserialization<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/serialization-and-deserialization.md)</ept>.) This is done by setting the <ph id=\"ph1\">`preserveObjectReferences`</ph> parameter in its constructor to <ph id=\"ph2\">`true`</ph>.","pos":[6750,6994],"source":" (For more information, see [Serialization and Deserialization](../../../../docs/framework/wcf/feature-details/serialization-and-deserialization.md).) This is done by setting the `preserveObjectReferences` parameter in its constructor to `true`."},{"content":"In that case, the surrogate is called only once for an object since all subsequent serializations just write the reference into the stream.","pos":[6995,7134]},{"content":"If <ph id=\"ph1\">`preserveObjectReferences`</ph> is set to <ph id=\"ph2\">`false`</ph>, then the surrogate is called every time an instance is encountered.","pos":[7135,7251],"source":" If `preserveObjectReferences` is set to `false`, then the surrogate is called every time an instance is encountered."},{"content":"If the type of the instance serialized differs from the declared type, type information is written into the stream, for example, <ph id=\"ph1\">`xsi:type`</ph> to allow the instance to be deserialized at the other end.","pos":[7258,7456],"source":"If the type of the instance serialized differs from the declared type, type information is written into the stream, for example, `xsi:type` to allow the instance to be deserialized at the other end."},{"content":"This process occurs whether the object is surrogated or not.","pos":[7457,7517]},{"content":"The example above converts the data of the <ph id=\"ph1\">`Inventory`</ph> instance to that of <ph id=\"ph2\">`InventorySurrogated`</ph>.","pos":[7524,7621],"source":"The example above converts the data of the `Inventory` instance to that of `InventorySurrogated`."},{"content":"It checks the type of the object and performs the necessary manipulations to convert to the surrogated type.","pos":[7622,7730]},{"content":"In this case, the fields of the <ph id=\"ph1\">`Inventory`</ph> class are directly copied over to the <ph id=\"ph2\">`InventorySurrogated`</ph> class fields.","pos":[7731,7848],"source":" In this case, the fields of the `Inventory` class are directly copied over to the `InventorySurrogated` class fields."},{"pos":[7858,7886],"content":"GetDeserializedObject Method","linkify":"GetDeserializedObject Method","nodes":[{"content":"GetDeserializedObject Method","pos":[0,28]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A&gt;</ph> method converts the surrogated type instance to the original type instance.","pos":[7890,8053],"source":"The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> method converts the surrogated type instance to the original type instance."},{"content":"It is required for deserialization.","pos":[8054,8089]},{"content":"The next task is to define the way the physical data will be mapped from the surrogate instance to the original.","pos":[8096,8208]},{"content":"For example:","pos":[8209,8221]},{"content":"This method is called only during the deserialization of an object.","pos":[8370,8437]},{"content":"It provides reverse data mapping for the deserialization from the surrogate type back to its original type.","pos":[8438,8545]},{"content":"Similar to the <ph id=\"ph1\">`GetObjectToSerialize`</ph> method, some possible uses may be to directly exchange field data, perform operations on the data, and store XML data.","pos":[8546,8702],"source":" Similar to the `GetObjectToSerialize` method, some possible uses may be to directly exchange field data, perform operations on the data, and store XML data."},{"content":"When  deserializing, you may not always obtain the exact data values from original due to manipulations in the data conversion.","pos":[8703,8830]},{"content":"The <ph id=\"ph1\">`targetType`</ph> parameter refers to the declared type of the member.","pos":[8837,8906],"source":"The `targetType` parameter refers to the declared type of the member."},{"content":"This parameter is the surrogated type returned by the <ph id=\"ph1\">`GetDataContractType`</ph> method.","pos":[8907,8990],"source":" This parameter is the surrogated type returned by the `GetDataContractType` method."},{"content":"The <ph id=\"ph1\">`obj`</ph> parameter refers to the object that has been deserialized.","pos":[8991,9059],"source":" The `obj` parameter refers to the object that has been deserialized."},{"content":"The object can be converted back to its original type if it is surrogated.","pos":[9060,9134]},{"content":"This method returns the input object if the surrogate does not handle the object.","pos":[9135,9216]},{"content":"Otherwise, the deserialized object will be returned once its conversion has been completed.","pos":[9217,9308]},{"content":"If several surrogate types exist, you may provide data conversion from surrogate to primary type for each by indicating each type and its conversion.","pos":[9309,9458]},{"content":"When returning an object, the internal object tables are updated with the object returned by this surrogate.","pos":[9465,9573]},{"content":"Any subsequent references to an instance will obtain the surrogated instance from the object tables.","pos":[9574,9674]},{"content":"The previous example converts objects of type <ph id=\"ph1\">`InventorySurrogated`</ph> back to the initial type <ph id=\"ph2\">`Inventory`</ph>.","pos":[9681,9786],"source":"The previous example converts objects of type `InventorySurrogated` back to the initial type `Inventory`."},{"content":"In this case, data is directly transferred back from <ph id=\"ph1\">`InventorySurrogated`</ph> to its corresponding fields in <ph id=\"ph2\">`Inventory`</ph>.","pos":[9787,9905],"source":" In this case, data is directly transferred back from `InventorySurrogated` to its corresponding fields in `Inventory`."},{"content":"Because there are no data manipulations, the each of the member fields will contain the same values as before the serialization.","pos":[9906,10034]},{"pos":[10044,10072],"content":"GetCustomDataToExport Method","linkify":"GetCustomDataToExport Method","nodes":[{"content":"GetCustomDataToExport Method","pos":[0,28]}]},{"content":"When exporting a schema, the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A&gt;</ph> method is optional.","pos":[10076,10208],"source":"When exporting a schema, the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> method is optional."},{"content":"It is used to insert additional data or hints into the exported schema.","pos":[10209,10280]},{"content":"Additional data can be inserted at the member level or type level.","pos":[10281,10347]},{"content":"For example:","pos":[10348,10360]},{"content":"This method (with two overloads) enables the inclusion of extra information into the metadata either at the member or type level.","pos":[10509,10638]},{"content":"It is possible to include hints about whether a member is public or private, and comments which would be preserved throughout the export and import of the schema.","pos":[10639,10801]},{"content":"Such information would be lost without this method.","pos":[10802,10853]},{"content":"This method does not cause the insertion or deletion of members or types, but rather adds additional data to the schemas at either of these levels.","pos":[10854,11001]},{"content":"The method is overloaded and can take either a <ph id=\"ph1\">`Type`</ph> (<ph id=\"ph2\">`clrtype`</ph> parameter) or <ph id=\"ph3\">&lt;xref:System.Reflection.MemberInfo&gt;</ph> (<ph id=\"ph4\">`memberInfo`</ph> parameter).","pos":[11008,11148],"source":"The method is overloaded and can take either a `Type` (`clrtype` parameter) or <xref:System.Reflection.MemberInfo> (`memberInfo` parameter)."},{"content":"The second parameter is always a <ph id=\"ph1\">`Type`</ph> (<ph id=\"ph2\">`dataContractType`</ph> parameter).","pos":[11149,11220],"source":" The second parameter is always a `Type` (`dataContractType` parameter)."},{"content":"This method is called for every member and type of the surrogated <ph id=\"ph1\">`dataContractType`</ph> type.","pos":[11221,11311],"source":" This method is called for every member and type of the surrogated `dataContractType` type."},{"content":"Either of these overloads must return either <ph id=\"ph1\">`null`</ph> or a serializable object.","pos":[11318,11395],"source":"Either of these overloads must return either `null` or a serializable object."},{"content":"A non-null object will be serialized as annotation into the exported schema.","pos":[11396,11472]},{"content":"For the <ph id=\"ph1\">`Type`</ph> overload, each type that is exported to schema is sent to this method in the first parameter along with the surrogated type as the <ph id=\"ph2\">`dataContractType`</ph> parameter.","pos":[11473,11648],"source":" For the `Type` overload, each type that is exported to schema is sent to this method in the first parameter along with the surrogated type as the `dataContractType` parameter."},{"content":"For the <ph id=\"ph1\">`MemberInfo`</ph> overload, each member that is exported to schema sends its information as the <ph id=\"ph2\">`memberInfo`</ph> parameter with the surrogated type in the second parameter.","pos":[11649,11820],"source":" For the `MemberInfo` overload, each member that is exported to schema sends its information as the `memberInfo` parameter with the surrogated type in the second parameter."},{"pos":[11831,11872],"content":"GetCustomDataToExport Method (Type, Type)","linkify":"GetCustomDataToExport Method (Type, Type)","nodes":[{"content":"GetCustomDataToExport Method (Type, Type)","pos":[0,41]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Type%2CSystem.Type%29?displayProperty=nameWithType&gt;</ph> method is called during schema export for every type definition.","pos":[11876,12085],"source":"The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Type%2CSystem.Type%29?displayProperty=nameWithType> method is called during schema export for every type definition."},{"content":"The method adds information to the types within the schema when exporting.","pos":[12086,12160]},{"content":"Each type defined is sent to this method to determine whether there is any additional data that needs to be included in the schema.","pos":[12161,12292]},{"pos":[12303,12350],"content":"GetCustomDataToExport Method (MemberInfo, Type)","linkify":"GetCustomDataToExport Method (MemberInfo, Type)","nodes":[{"content":"GetCustomDataToExport Method (MemberInfo, Type)","pos":[0,47]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Reflection.MemberInfo%2CSystem.Type%29?displayProperty=nameWithType&gt;</ph> is called during export for every member in the types that are exported.","pos":[12354,12588],"source":"The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Reflection.MemberInfo%2CSystem.Type%29?displayProperty=nameWithType> is called during export for every member in the types that are exported."},{"content":"This function enables you to customize any comments for the members that will be included in the schema upon export.","pos":[12589,12705]},{"content":"The information for every member within the class is sent to this method to check whether any additional data need to be added in the schema.","pos":[12706,12847]},{"content":"The example above searches through the <ph id=\"ph1\">`dataContractType`</ph> for each member of the surrogate.","pos":[12854,12945],"source":"The example above searches through the `dataContractType` for each member of the surrogate."},{"content":"It then returns the appropriate access modifier for each field.","pos":[12946,13009]},{"content":"Without this customization, the default value for access modifiers is public.","pos":[13010,13087]},{"content":"Therefore, all members would be defined as public in the code generated using the exported schema no matter what their actual access restrictions are.","pos":[13088,13238]},{"content":"When not using this implementation, the member <ph id=\"ph1\">`numpens`</ph> would be public in the exported schema even though it was defined in the surrogate as private.","pos":[13239,13390],"source":" When not using this implementation, the member `numpens` would be public in the exported schema even though it was defined in the surrogate as private."},{"content":"Through the use of this method, in the exported schema, the access modifier can be generated as private.","pos":[13391,13495]},{"pos":[13505,13537],"content":"GetReferencedTypeOnImport Method","linkify":"GetReferencedTypeOnImport Method","nodes":[{"content":"GetReferencedTypeOnImport Method","pos":[0,32]}]},{"content":"This method maps the <ph id=\"ph1\">&lt;xref:System.Type&gt;</ph> of the surrogate to the original type.","pos":[13541,13619],"source":"This method maps the <xref:System.Type> of the surrogate to the original type."},{"content":"This method is optional for schema importation.","pos":[13620,13667]},{"content":"When creating a surrogate that imports a schema and generates code for it, the next task is to define the type of a surrogate instance to its original type.","pos":[13674,13830]},{"pos":[13837,14029],"content":"If the generated code needs to reference an existing user type, this is done by implementing the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A&gt;</ph> method.","source":"If the generated code needs to reference an existing user type, this is done by implementing the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> method."},{"content":"When importing a schema, this method is called for every type declaration to map the surrogated data contract to a type.","pos":[14036,14156]},{"content":"The string parameters <ph id=\"ph1\">`typeName`</ph> and <ph id=\"ph2\">`typeNamespace`</ph> define the name and namespace of the surrogated type.","pos":[14157,14263],"source":" The string parameters `typeName` and `typeNamespace` define the name and namespace of the surrogated type."},{"content":"The return value for <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A&gt;</ph> is used to determine whether a new type needs to be generated.","pos":[14264,14435],"source":" The return value for <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> is used to determine whether a new type needs to be generated."},{"content":"This method must return either a valid type or null.","pos":[14436,14488]},{"content":"For valid types, the type returned will be used as a referenced type in the generated code.","pos":[14489,14580]},{"content":"If null is returned, no type will be referenced and a new type must be created.","pos":[14581,14660]},{"content":"If several surrogates exist, it is possible to perform the mapping for each surrogate type back to its initial type.","pos":[14661,14777]},{"content":"The <ph id=\"ph1\">`customData`</ph> parameter is the object originally returned from <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A&gt;</ph>.","pos":[14784,14934],"source":"The `customData` parameter is the object originally returned from <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A>."},{"content":"This <ph id=\"ph1\">`customData`</ph> is used when surrogate authors want to insert extra data/hints into the metadata to use during import to generate code.","pos":[14935,15072],"source":" This `customData` is used when surrogate authors want to insert extra data/hints into the metadata to use during import to generate code."},{"pos":[15082,15108],"content":"ProcessImportedType Method","linkify":"ProcessImportedType Method","nodes":[{"content":"ProcessImportedType Method","pos":[0,26]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate.ProcessImportedType%2A&gt;</ph> method customizes any type created from schema importation.","pos":[15112,15257],"source":"The <xref:System.Runtime.Serialization.IDataContractSurrogate.ProcessImportedType%2A> method customizes any type created from schema importation."},{"content":"This method is optional.","pos":[15258,15282]},{"content":"When importing a schema, this method allows for any imported type and compilation information to be customized.","pos":[15289,15400]},{"content":"For example:","pos":[15401,15413]},{"content":"During import, this method is called for every type generated.","pos":[15562,15624]},{"content":"Change the specified <ph id=\"ph1\">&lt;xref:System.CodeDom.CodeTypeDeclaration&gt;</ph> or modify the <ph id=\"ph2\">&lt;xref:System.CodeDom.CodeCompileUnit&gt;</ph>.","pos":[15625,15740],"source":" Change the specified <xref:System.CodeDom.CodeTypeDeclaration> or modify the <xref:System.CodeDom.CodeCompileUnit>."},{"content":"This includes changing the name, members, attributes, and many other properties of the <ph id=\"ph1\">`CodeTypeDeclaration`</ph>.","pos":[15741,15850],"source":" This includes changing the name, members, attributes, and many other properties of the `CodeTypeDeclaration`."},{"content":"By processing the <ph id=\"ph1\">`CodeCompileUnit`</ph>, it is possible to modify the directives, namespaces, referenced assemblies, and several other aspects.","pos":[15851,15990],"source":" By processing the `CodeCompileUnit`, it is possible to modify the directives, namespaces, referenced assemblies, and several other aspects."},{"content":"The <ph id=\"ph1\">`CodeTypeDeclaration`</ph> parameter contains the code DOM type declaration.","pos":[15997,16072],"source":"The `CodeTypeDeclaration` parameter contains the code DOM type declaration."},{"content":"The <ph id=\"ph1\">`CodeCompileUnit`</ph> parameter allows for modification for processing the code.","pos":[16073,16153],"source":" The `CodeCompileUnit` parameter allows for modification for processing the code."},{"content":"Returning <ph id=\"ph1\">`null`</ph> results in the type declaration being discarded.","pos":[16155,16220],"source":"  Returning `null` results in the type declaration being discarded."},{"content":"Conversely, when returning a <ph id=\"ph1\">`CodeTypeDeclaration`</ph>, the modifications are preserved.","pos":[16221,16305],"source":" Conversely, when returning a `CodeTypeDeclaration`, the modifications are preserved."},{"content":"If custom data is inserted during metadata export, it needs to be provided to the user during import so that it can be used.","pos":[16312,16436]},{"content":"This custom data can be used for programming model hints, or other comments.","pos":[16437,16513]},{"content":"Each <ph id=\"ph1\">`CodeTypeDeclaration`</ph> and <ph id=\"ph2\">&lt;xref:System.CodeDom.CodeTypeMember&gt;</ph> instance includes custom data as the <ph id=\"ph3\">&lt;xref:System.CodeDom.CodeObject.UserData%2A&gt;</ph> property, cast to the <ph id=\"ph4\">`IDataContractSurrogate`</ph> type.","pos":[16514,16716],"source":" Each `CodeTypeDeclaration` and <xref:System.CodeDom.CodeTypeMember> instance includes custom data as the <xref:System.CodeDom.CodeObject.UserData%2A> property, cast to the `IDataContractSurrogate` type."},{"content":"The example above performs some changes on the schema imported.","pos":[16723,16786]},{"content":"The code preserves private members of the original type by using a surrogate.","pos":[16787,16864]},{"content":"The default access modifier when importing a schema is <ph id=\"ph1\">`public`</ph>.","pos":[16865,16929],"source":" The default access modifier when importing a schema is `public`."},{"content":"Therefore, all members of the surrogate schema will be public unless modified, as in this example.","pos":[16930,17028]},{"content":"During export, custom data is inserted into the metadata about which members are private.","pos":[17029,17118]},{"content":"The example looks up the custom data, checks whether the access modifier is private, and then modifies the appropriate member to be private by setting its attributes.","pos":[17119,17285]},{"content":"Without this customization, the <ph id=\"ph1\">`numpens`</ph> member would be defined as public instead of private.","pos":[17286,17381],"source":" Without this customization, the `numpens` member would be defined as public instead of private."},{"pos":[17391,17421],"content":"GetKnownCustomDataTypes Method","linkify":"GetKnownCustomDataTypes Method","nodes":[{"content":"GetKnownCustomDataTypes Method","pos":[0,30]}]},{"content":"This method obtains custom data types defined from the schema.","pos":[17425,17487]},{"content":"The method is optional for schema importation.","pos":[17488,17534]},{"content":"The method is called at the beginning of schema export and import.","pos":[17541,17607]},{"content":"The method returns the custom data types used in the schema exported or imported.","pos":[17608,17689]},{"content":"The method is passed a <ph id=\"ph1\">&lt;xref:System.Collections.ObjectModel.Collection%601&gt;</ph> (the <ph id=\"ph2\">`customDataTypes`</ph> parameter), which is a collection of types.","pos":[17690,17832],"source":" The method is passed a <xref:System.Collections.ObjectModel.Collection%601> (the `customDataTypes` parameter), which is a collection of types."},{"content":"The method should add additional known types to this collection.","pos":[17833,17897]},{"content":"The known custom data types are needed to enable serialization and deserialization of custom data using the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.DataContractSerializer&gt;</ph>.","pos":[17898,18065],"source":" The known custom data types are needed to enable serialization and deserialization of custom data using the <xref:System.Runtime.Serialization.DataContractSerializer>."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Data Contract Known Types<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/data-contract-known-types.md)</ept>.","pos":[18066,18197],"source":" For more information, see [Data Contract Known Types](../../../../docs/framework/wcf/feature-details/data-contract-known-types.md)."},{"pos":[18206,18230],"content":"Implementing a Surrogate","linkify":"Implementing a Surrogate","nodes":[{"content":"Implementing a Surrogate","pos":[0,24]}]},{"content":"To use the data contract surrogate within WCF, you must follow a few special procedures.","pos":[18234,18322]},{"pos":[18332,18388],"content":"To Use a Surrogate for Serialization and Deserialization","linkify":"To Use a Surrogate for Serialization and Deserialization","nodes":[{"content":"To Use a Surrogate for Serialization and Deserialization","pos":[0,56]}]},{"content":"Use the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.DataContractSerializer&gt;</ph> to perform serialization and deserialization of data with the surrogate.","pos":[18392,18531],"source":"Use the <xref:System.Runtime.Serialization.DataContractSerializer> to perform serialization and deserialization of data with the surrogate."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.DataContractSerializer&gt;</ph> is created by the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior&gt;</ph>.","pos":[18532,18692],"source":" The <xref:System.Runtime.Serialization.DataContractSerializer> is created by the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>."},{"content":"The surrogate must also be specified.","pos":[18693,18730]},{"pos":[18742,18788],"content":"To implement serialization and deserialization","linkify":"To implement serialization and deserialization","nodes":[{"content":"To implement serialization and deserialization","pos":[0,46]}]},{"content":"Create an instance of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> for your service.","pos":[18798,18880],"source":"Create an instance of the <xref:System.ServiceModel.ServiceHost> for your service."},{"content":"For complete instructions, see <bpt id=\"p1\">[</bpt>Basic WCF Programming<ept id=\"p1\">](../../../../docs/framework/wcf/basic-wcf-programming.md)</ept>.","pos":[18881,18993],"source":" For complete instructions, see [Basic WCF Programming](../../../../docs/framework/wcf/basic-wcf-programming.md)."},{"pos":[19003,19168],"content":"For every <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceEndpoint&gt;</ph> of the specified service host, find its <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.OperationDescription&gt;</ph>.","source":"For every <xref:System.ServiceModel.Description.ServiceEndpoint> of the specified service host, find its <xref:System.ServiceModel.Description.OperationDescription>."},{"pos":[19178,19340],"content":"Search through the operation behaviors to determine if an instance of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior&gt;</ph> is found.","source":"Search through the operation behaviors to determine if an instance of the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found."},{"content":"If a <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior&gt;</ph> is found, set its <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A&gt;</ph> property to a new instance of the surrogate.","pos":[19350,19600],"source":"If a <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found, set its <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> property to a new instance of the surrogate."},{"content":"If no <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior&gt;</ph> is found, then create a new instance and set the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A&gt;</ph> member of the new behavior to a new instance of the surrogate.","pos":[19601,19901],"source":" If no <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found, then create a new instance and set the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> member of the new behavior to a new instance of the surrogate."},{"content":"Finally, add this new behavior to the current operation behaviors, as shown in the following example:","pos":[19911,20012]},{"pos":[20168,20206],"content":"To Use a Surrogate for Metadata Import","linkify":"To Use a Surrogate for Metadata Import","nodes":[{"content":"To Use a Surrogate for Metadata Import","pos":[0,38]}]},{"content":"When importing metadata like WSDL and XSD to generate client-side code, the surrogate needs to be added to the component responsible for generating code from XSD schema, <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.XsdDataContractImporter&gt;</ph>.","pos":[20210,20440],"source":"When importing metadata like WSDL and XSD to generate client-side code, the surrogate needs to be added to the component responsible for generating code from XSD schema, <xref:System.Runtime.Serialization.XsdDataContractImporter>."},{"content":"To do this, directly modify the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.WsdlImporter&gt;</ph> used to import metadata.","pos":[20441,20549],"source":" To do this, directly modify the <xref:System.ServiceModel.Description.WsdlImporter> used to import metadata."},{"pos":[20561,20610],"content":"To implement a surrogate for metadata importation","linkify":"To implement a surrogate for metadata importation","nodes":[{"content":"To implement a surrogate for metadata importation","pos":[0,49]}]},{"pos":[20620,20708],"content":"Import the metadata using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.WsdlImporter&gt;</ph> class.","source":"Import the metadata using the <xref:System.ServiceModel.Description.WsdlImporter> class."},{"pos":[20718,20894],"content":"Use the <ph id=\"ph1\">&lt;xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A&gt;</ph> method to check whether an <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.XsdDataContractImporter&gt;</ph> has been defined.","source":"Use the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method to check whether an <xref:System.Runtime.Serialization.XsdDataContractImporter> has been defined."},{"content":"If the <ph id=\"ph1\">&lt;xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A&gt;</ph> method returns <ph id=\"ph2\">`false`</ph>, create a new <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.XsdDataContractImporter&gt;</ph> and set its <ph id=\"ph4\">&lt;xref:System.Runtime.Serialization.XsdDataContractImporter.Options%2A&gt;</ph> property to a new instance of the <ph id=\"ph5\">&lt;xref:System.Runtime.Serialization.ImportOptions&gt;</ph> class.","pos":[20904,21245],"source":"If the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method returns `false`, create a new <xref:System.Runtime.Serialization.XsdDataContractImporter> and set its <xref:System.Runtime.Serialization.XsdDataContractImporter.Options%2A> property to a new instance of the <xref:System.Runtime.Serialization.ImportOptions> class."},{"content":"Otherwise, use the importer returned by the <ph id=\"ph1\">`out`</ph> parameter of the <ph id=\"ph2\">&lt;xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A&gt;</ph> method.","pos":[21246,21384],"source":" Otherwise, use the importer returned by the `out` parameter of the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method."},{"pos":[21394,21633],"content":"If the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.XsdDataContractImporter&gt;</ph> has no <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.ImportOptions&gt;</ph> defined, then set the property to be a new instance of the <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.ImportOptions&gt;</ph> class.","source":"If the <xref:System.Runtime.Serialization.XsdDataContractImporter> has no <xref:System.Runtime.Serialization.ImportOptions> defined, then set the property to be a new instance of the <xref:System.Runtime.Serialization.ImportOptions> class."},{"pos":[21643,21894],"content":"Set the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.ImportOptions.DataContractSurrogate%2A&gt;</ph> property of the <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.ImportOptions&gt;</ph> of the <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.XsdDataContractImporter&gt;</ph> to a new instance of the surrogate.","source":"Set the <xref:System.Runtime.Serialization.ImportOptions.DataContractSurrogate%2A> property of the <xref:System.Runtime.Serialization.ImportOptions> of the <xref:System.Runtime.Serialization.XsdDataContractImporter> to a new instance of the surrogate."},{"pos":[21904,22222],"content":"Add the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.XsdDataContractImporter&gt;</ph> to the collection returned by the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.MetadataExporter.State%2A&gt;</ph> property of the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Description.WsdlImporter&gt;</ph> (inherited from the <ph id=\"ph4\">&lt;xref:System.ServiceModel.Description.MetadataExporter&gt;</ph> class.)","source":"Add the <xref:System.Runtime.Serialization.XsdDataContractImporter> to the collection returned by the <xref:System.ServiceModel.Description.MetadataExporter.State%2A> property of the <xref:System.ServiceModel.Description.WsdlImporter> (inherited from the <xref:System.ServiceModel.Description.MetadataExporter> class.)"},{"content":"Use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.WsdlImporter.ImportAllContracts%2A&gt;</ph> method of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.WsdlImporter&gt;</ph> to import all of the data contracts within the schema.","pos":[22232,22434],"source":"Use the <xref:System.ServiceModel.Description.WsdlImporter.ImportAllContracts%2A> method of the <xref:System.ServiceModel.Description.WsdlImporter> to import all of the data contracts within the schema."},{"content":"During the last step, code is generated from the schemas loaded by calling into the surrogate.","pos":[22435,22529]},{"pos":[22685,22723],"content":"To Use a surrogate for Metadata Export","linkify":"To Use a surrogate for Metadata Export","nodes":[{"content":"To Use a surrogate for Metadata Export","pos":[0,38]}]},{"content":"By default, when exporting metadata from WCF for a service, both WSDL and XSD schema needs to be generated.","pos":[22727,22834]},{"content":"The surrogate needs to be added to the component responsible for generating XSD schema for data contract types, <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.XsdDataContractExporter&gt;</ph>.","pos":[22835,23007],"source":" The surrogate needs to be added to the component responsible for generating XSD schema for data contract types, <xref:System.Runtime.Serialization.XsdDataContractExporter>."},{"content":"To do this, either use a behavior that implements <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.IWsdlExportExtension&gt;</ph> to modify the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.WsdlExporter&gt;</ph>, or directly modify the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Description.WsdlExporter&gt;</ph> used to export metadata.","pos":[23008,23284],"source":" To do this, either use a behavior that implements <xref:System.ServiceModel.Description.IWsdlExportExtension> to modify the <xref:System.ServiceModel.Description.WsdlExporter>, or directly modify the <xref:System.ServiceModel.Description.WsdlExporter> used to export metadata."},{"pos":[23296,23334],"content":"To use a surrogate for metadata export","linkify":"To use a surrogate for metadata export","nodes":[{"content":"To use a surrogate for metadata export","pos":[0,38]}]},{"pos":[23344,23544],"content":"Create a new <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.WsdlExporter&gt;</ph> or use the <ph id=\"ph2\">`wsdlExporter`</ph> parameter passed to the <ph id=\"ph3\">&lt;xref:System.ServiceModel.Description.IWsdlExportExtension.ExportContract%2A&gt;</ph> method.","source":"Create a new <xref:System.ServiceModel.Description.WsdlExporter> or use the `wsdlExporter` parameter passed to the <xref:System.ServiceModel.Description.IWsdlExportExtension.ExportContract%2A> method."},{"pos":[23554,23732],"content":"Use the <ph id=\"ph1\">&lt;xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A&gt;</ph> function to check whether an <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.XsdDataContractExporter&gt;</ph> has been defined.","source":"Use the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> function to check whether an <xref:System.Runtime.Serialization.XsdDataContractExporter> has been defined."},{"content":"If <ph id=\"ph1\">&lt;xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A&gt;</ph> returns <ph id=\"ph2\">`false`</ph>, create a new <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.XsdDataContractExporter&gt;</ph> with the generated XML schemas from the <ph id=\"ph4\">&lt;xref:System.ServiceModel.Description.WsdlExporter&gt;</ph>, and add it to the collection returned by the <ph id=\"ph5\">&lt;xref:System.ServiceModel.Description.MetadataExporter.State%2A&gt;</ph> property of the <ph id=\"ph6\">&lt;xref:System.ServiceModel.Description.WsdlExporter&gt;</ph>.","pos":[23742,24170],"source":"If <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> returns `false`, create a new <xref:System.Runtime.Serialization.XsdDataContractExporter> with the generated XML schemas from the <xref:System.ServiceModel.Description.WsdlExporter>, and add it to the collection returned by the <xref:System.ServiceModel.Description.MetadataExporter.State%2A> property of the <xref:System.ServiceModel.Description.WsdlExporter>."},{"content":"Otherwise, use the exporter returned by the <ph id=\"ph1\">`out`</ph> parameter of the <ph id=\"ph2\">&lt;xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A&gt;</ph> method.","pos":[24171,24309],"source":" Otherwise, use the exporter returned by the `out` parameter of the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method."},{"pos":[24319,24626],"content":"If the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.XsdDataContractExporter&gt;</ph> has no <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.ExportOptions&gt;</ph> defined, then set the <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.XsdDataContractExporter.Options%2A&gt;</ph> property to a new instance of the <ph id=\"ph4\">&lt;xref:System.Runtime.Serialization.ExportOptions&gt;</ph> class.","source":"If the <xref:System.Runtime.Serialization.XsdDataContractExporter> has no <xref:System.Runtime.Serialization.ExportOptions> defined, then set the <xref:System.Runtime.Serialization.XsdDataContractExporter.Options%2A> property to a new instance of the <xref:System.Runtime.Serialization.ExportOptions> class."},{"content":"Set the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.ExportOptions.DataContractSurrogate%2A&gt;</ph> property of the <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.ExportOptions&gt;</ph> of the <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.XsdDataContractExporter&gt;</ph> to a new instance of the surrogate.","pos":[24636,24887],"source":"Set the <xref:System.Runtime.Serialization.ExportOptions.DataContractSurrogate%2A> property of the <xref:System.Runtime.Serialization.ExportOptions> of the <xref:System.Runtime.Serialization.XsdDataContractExporter> to a new instance of the surrogate."},{"content":"Subsequent steps for exporting metadata do not require any changes.","pos":[24888,24955]},{"pos":[25112,25120],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[25431,25525],"content":"<bpt id=\"p1\">[</bpt>Using Data Contracts<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/using-data-contracts.md)</ept>","source":"[Using Data Contracts](../../../../docs/framework/wcf/feature-details/using-data-contracts.md)"}]}