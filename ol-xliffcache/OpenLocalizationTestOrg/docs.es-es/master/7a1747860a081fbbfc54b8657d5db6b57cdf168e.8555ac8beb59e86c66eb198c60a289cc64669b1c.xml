{"content":"---\ntitle: \"Integrating with COM+ Applications Overview\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"Windows Communication Foundation, COM+ integration\"\n  - \"WCF, COM+ integration\"\nms.assetid: e481e48f-7096-40eb-9f20-7f0098412941\n---\n# Integrating with COM+ Applications Overview\nWindows Communication Foundation (WCF) provides a rich environment for creating distributed applications. If you are already using component-based application logic hosted in COM+, you can use WCF to extend your existing logic rather than having to rewrite it. A common scenario is when you want to expose existing COM+ or Enterprise Services business logic through Web Services.  \n  \n When an interface on a COM+ component is exposed as a Web service, the specification and contract of these services are determined by an automatic mapping that is performed at application initialization time. The following list shows the conceptual model for this mapping:  \n  \n-   One service is defined for each exposed COM class.  \n  \n-   The contract for the service is derived directly from the selected component's interface definition with the possibility of method exclusion defined in configuration.  \n  \n-   The operations in that contract are derived directly from the methods on the component's interface definition.  \n  \n-   The parameters for those operations are derived directly from the COM interoperability type that corresponds to the component's method parameters.  \n  \n Default addresses and transport bindings for the service are provided in a service configuration file, but these can be reconfigured as required.  \n  \n> [!NOTE]\n>  The contracts for the exposed Web services remain constant as long as the COM+ interfaces and configuration remain unchanged. A modification to several interfaces does not automatically update the available services and requires re-running the COM+ Service Model Configuration tool (ComSvcConfig.exe).  \n  \n The authentication and authorization requirements of the COM+ application and its components continue to be enforced when used as a Web service.  \n  \n If the caller initiates a Web service transaction, components marked as transactional enlist within that transaction scope.  \n  \n The following steps are required to expose a COM+ component's interface as a Web service without modifying the component:  \n  \n1.  Determine whether the COM+ component's interface can be exposed as a Web service.  \n  \n2.  Select an appropriate hosting mode.  \n  \n3.  Use the COM+ Service Model Configuration tool (ComSvcConfig.exe) to add a Web service for the interface. For more information about how to use ComSvcConfig.exe, see [How to: Use the COM+ Service Model Configuration Tool](../../../../docs/framework/wcf/feature-details/how-to-use-the-com-service-model-configuration-tool.md).  \n  \n4.  Configure any additional service settings in the application configuration file. For more information about how to configure a component, see [How to: Configure COM+ Service Settings](../../../../docs/framework/wcf/feature-details/how-to-configure-com-service-settings.md).  \n  \n## Supported Interfaces  \n There are some restrictions on the type of interfaces that can be exposed as a Web service. The following types of interfaces are not supported:  \n  \n-   Interfaces that pass object references as parameters - the following limited object reference approach is described in the Limited Object Reference Support section.  \n  \n-   Interfaces that pass types that are not compatible with the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] COM interoperability conversions.  \n  \n-   Interfaces for applications that have application pooling enabled when hosted by COM+.  \n  \n-   Interfaces of components that are marked as private to the application.  \n  \n-   COM+ infrastructure interfaces.  \n  \n-   Interfaces from the system application.  \n  \n-   Interfaces from Enterprise Services components that have not been added to the global assembly cache.  \n  \n### Limited Object Reference Support  \n Because a number of deployed COM+ components do use objects by reference parameters, such as returning an ADO Recordset object, COM+ integration includes limited support for object reference parameters. The support is limited to objects that implement the `IPersistStream` COM interface. This includes ADO Recordset objects and can be implemented for application specific COM objects.  \n  \n To enable this support, the ComSvcConfig.exe tool provides the **allowreferences** switch that disables the regular method signature parameter and checks that the tool runs to ensure that object reference parameters are not being used. In addition, the object types that you pass as parameters must be named and identified within the <`persistableTypes`> configuration element that is a child of the <`comContract`> element.  \n  \n When this feature is used, the COM+ integration service uses the `IPersistStream` interface to serialize or deserialize the object instance. If the object instance does not support `IPersistStream`, an exception is thrown.  \n  \n Within a client application, the methods on the <xref:System.ServiceModel.ComIntegration.PersistStreamTypeWrapper> object can be used to pass an object in to a service and similarly to retrieve an object.  \n  \n> [!NOTE]\n>  Due to the custom and platform-specific nature of the serialization approach, this is best suited for use between WCF clients and WCF services.  \n  \n## Selecting the Hosting Mode  \n COM+ exposes Web services in one of the following hosting modes:  \n  \n-   COM+-hosted  \n  \n     The Web service is hosted within the application's dedicated COM+ server process (Dllhost.exe). This mode requires the application to be explicitly started before it can receive Web service requests. The COM+ options \"Run as an NT Service\" or \"Leave running when idle\" can be used to prevent idle shutdown of the application and its services. This mode provides both Web service and DCOM access to the server application.  \n  \n-   Web-hosted  \n  \n     The Web service is hosted within a Web server worker process. This mode does not require COM+ to be active when the initial request is received. If the application is not active when this request is received, it is automatically activated prior to processing the request. This mode also provides both Web service and DCOM access to the server application, but causes a process hop for Web service requests. This typically requires the client to enable impersonation. In WCF, this can be done with the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property of the <xref:System.ServiceModel.Security.WindowsClientCredential> class, which is accessed as a property of the generic <xref:System.ServiceModel.ChannelFactory%601> class, as well as the <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation> enumeration value.  \n  \n-   Web-hosted in-process  \n  \n     The Web service and the COM+ application logic are hosted within the Web server worker process. This provides automatic activation of the Web-hosted mode without causing a process hop for Web service requests. The disadvantage is that the server application cannot be accessed through DCOM.  \n  \n### Security Considerations  \n Like other WCF services, the security settings for the exposed service are administered through configuration settings for the WCF channel. Traditional DCOM security settings such as the DCOM machine-wide permissions settings are not enforced. To enforce COM+ application roles, \"component-level access checks\" authorization must be enabled for the component.  \n  \n The use of a non-secured binding can leave communication open to tampering or information disclosure. To prevent this, it is recommended that you use a secured binding.  \n  \n For the COM+-hosted and Web-hosted modes, client applications must permit the server process to impersonate the client user. This can be done in WCF clients by setting the impersonation level to <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>.  \n  \n With Internet Information Services (IIS) or Windows Process Activation Service (WAS) using the HTTP transport, the Httpcfg.exe tool can be used to reserve a transport endpoint address. In other configurations, it is important to protect against rogue services that act as the intended service. To prevent a rogue service from starting at the desired endpoint, the legitimate service can be configured to run as an NT service. This enables the legitimate service to claim the endpoint address prior to any rogue services.  \n  \n When exposing a COM+ application with configured COM+ roles as a Web-hosted service, the \"Launch IIS Process Account\" must be added to one of the applicationâ€™s roles. This account, typically with the name IWAM_machinename, must be added to enable clean shutdown of objects after use. The account should not be granted any additional permissions.  \n  \n The COM+ process recycling features cannot be used on integrated applications. If the application is configured to use process recycling and the components are running in a COM+ hosted process, the service fails to start. This requirement does not include services using the Web-hosted in-process mode because the process recycling settings are not applied.  \n  \n## See also\n\n- [Integrating with COM Applications Overview](../../../../docs/framework/wcf/feature-details/integrating-with-com-applications-overview.md)\n","nodes":[{"pos":[4,234],"embed":true,"restype":"x-metadata","content":"title: \"Integrating with COM+ Applications Overview\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"Windows Communication Foundation, COM+ integration\"\n  - \"WCF, COM+ integration\"\nms.assetid: e481e48f-7096-40eb-9f20-7f0098412941","nodes":[{"content":"Integrating with COM+ Applications Overview","nodes":[{"pos":[0,43],"content":"Integrating with COM+ Applications Overview","nodes":[{"content":"Integrating with COM+ Applications Overview","pos":[0,43]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[241,284],"content":"Integrating with COM+ Applications Overview","linkify":"Integrating with COM+ Applications Overview","nodes":[{"content":"Integrating with COM+ Applications Overview","pos":[0,43]}]},{"content":"Windows Communication Foundation (WCF) provides a rich environment for creating distributed applications.","pos":[285,390]},{"content":"If you are already using component-based application logic hosted in COM+, you can use WCF to extend your existing logic rather than having to rewrite it.","pos":[391,545]},{"content":"A common scenario is when you want to expose existing COM+ or Enterprise Services business logic through Web Services.","pos":[546,664]},{"content":"When an interface on a COM+ component is exposed as a Web service, the specification and contract of these services are determined by an automatic mapping that is performed at application initialization time.","pos":[671,879]},{"content":"The following list shows the conceptual model for this mapping:","pos":[880,943]},{"content":"One service is defined for each exposed COM class.","pos":[953,1003]},{"content":"The contract for the service is derived directly from the selected component's interface definition with the possibility of method exclusion defined in configuration.","pos":[1013,1179]},{"content":"The operations in that contract are derived directly from the methods on the component's interface definition.","pos":[1189,1299]},{"content":"The parameters for those operations are derived directly from the COM interoperability type that corresponds to the component's method parameters.","pos":[1309,1455]},{"content":"Default addresses and transport bindings for the service are provided in a service configuration file, but these can be reconfigured as required.","pos":[1462,1607]},{"pos":[1615,1927],"content":"[!NOTE]\n The contracts for the exposed Web services remain constant as long as the COM+ interfaces and configuration remain unchanged. A modification to several interfaces does not automatically update the available services and requires re-running the COM+ Service Model Configuration tool (ComSvcConfig.exe).","leadings":["","> "],"nodes":[{"content":"The contracts for the exposed Web services remain constant as long as the COM+ interfaces and configuration remain unchanged. A modification to several interfaces does not automatically update the available services and requires re-running the COM+ Service Model Configuration tool (ComSvcConfig.exe).","pos":[9,310],"nodes":[{"content":"The contracts for the exposed Web services remain constant as long as the COM+ interfaces and configuration remain unchanged.","pos":[0,125]},{"content":"A modification to several interfaces does not automatically update the available services and requires re-running the COM+ Service Model Configuration tool (ComSvcConfig.exe).","pos":[126,301]}]}]},{"content":"The authentication and authorization requirements of the COM+ application and its components continue to be enforced when used as a Web service.","pos":[1934,2078]},{"content":"If the caller initiates a Web service transaction, components marked as transactional enlist within that transaction scope.","pos":[2085,2208]},{"content":"The following steps are required to expose a COM+ component's interface as a Web service without modifying the component:","pos":[2215,2336]},{"content":"Determine whether the COM+ component's interface can be exposed as a Web service.","pos":[2346,2427]},{"content":"Select an appropriate hosting mode.","pos":[2437,2472]},{"content":"Use the COM+ Service Model Configuration tool (ComSvcConfig.exe) to add a Web service for the interface.","pos":[2482,2586]},{"content":"For more information about how to use ComSvcConfig.exe, see <bpt id=\"p1\">[</bpt>How to: Use the COM+ Service Model Configuration Tool<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-use-the-com-service-model-configuration-tool.md)</ept>.","pos":[2587,2806],"source":" For more information about how to use ComSvcConfig.exe, see [How to: Use the COM+ Service Model Configuration Tool](../../../../docs/framework/wcf/feature-details/how-to-use-the-com-service-model-configuration-tool.md)."},{"content":"Configure any additional service settings in the application configuration file.","pos":[2816,2896]},{"content":"For more information about how to configure a component, see <bpt id=\"p1\">[</bpt>How to: Configure COM+ Service Settings<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-configure-com-service-settings.md)</ept>.","pos":[2897,3089],"source":" For more information about how to configure a component, see [How to: Configure COM+ Service Settings](../../../../docs/framework/wcf/feature-details/how-to-configure-com-service-settings.md)."},{"pos":[3098,3118],"content":"Supported Interfaces","linkify":"Supported Interfaces","nodes":[{"content":"Supported Interfaces","pos":[0,20]}]},{"content":"There are some restrictions on the type of interfaces that can be exposed as a Web service.","pos":[3122,3213]},{"content":"The following types of interfaces are not supported:","pos":[3214,3266]},{"content":"Interfaces that pass object references as parameters - the following limited object reference approach is described in the Limited Object Reference Support section.","pos":[3276,3440]},{"pos":[3450,3607],"content":"Interfaces that pass types that are not compatible with the <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> COM interoperability conversions.","source":"Interfaces that pass types that are not compatible with the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] COM interoperability conversions."},{"content":"Interfaces for applications that have application pooling enabled when hosted by COM+.","pos":[3617,3703]},{"content":"Interfaces of components that are marked as private to the application.","pos":[3713,3784]},{"content":"COM+ infrastructure interfaces.","pos":[3794,3825]},{"content":"Interfaces from the system application.","pos":[3835,3874]},{"content":"Interfaces from Enterprise Services components that have not been added to the global assembly cache.","pos":[3884,3985]},{"pos":[3995,4027],"content":"Limited Object Reference Support","linkify":"Limited Object Reference Support","nodes":[{"content":"Limited Object Reference Support","pos":[0,32]}]},{"content":"Because a number of deployed COM+ components do use objects by reference parameters, such as returning an ADO Recordset object, COM+ integration includes limited support for object reference parameters.","pos":[4031,4233]},{"content":"The support is limited to objects that implement the <ph id=\"ph1\">`IPersistStream`</ph> COM interface.","pos":[4234,4318],"source":" The support is limited to objects that implement the `IPersistStream` COM interface."},{"content":"This includes ADO Recordset objects and can be implemented for application specific COM objects.","pos":[4319,4415]},{"content":"To enable this support, the ComSvcConfig.exe tool provides the <bpt id=\"p1\">**</bpt>allowreferences<ept id=\"p1\">**</ept> switch that disables the regular method signature parameter and checks that the tool runs to ensure that object reference parameters are not being used.","pos":[4422,4657],"source":"To enable this support, the ComSvcConfig.exe tool provides the **allowreferences** switch that disables the regular method signature parameter and checks that the tool runs to ensure that object reference parameters are not being used."},{"content":"In addition, the object types that you pass as parameters must be named and identified within the &lt;<ph id=\"ph1\">`persistableTypes`</ph>&gt; configuration element that is a child of the &lt;<ph id=\"ph2\">`comContract`</ph>&gt; element.","pos":[4658,4846],"source":" In addition, the object types that you pass as parameters must be named and identified within the <`persistableTypes`> configuration element that is a child of the <`comContract`> element."},{"content":"When this feature is used, the COM+ integration service uses the <ph id=\"ph1\">`IPersistStream`</ph> interface to serialize or deserialize the object instance.","pos":[4853,4993],"source":"When this feature is used, the COM+ integration service uses the `IPersistStream` interface to serialize or deserialize the object instance."},{"content":"If the object instance does not support <ph id=\"ph1\">`IPersistStream`</ph>, an exception is thrown.","pos":[4994,5075],"source":" If the object instance does not support `IPersistStream`, an exception is thrown."},{"pos":[5082,5286],"content":"Within a client application, the methods on the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ComIntegration.PersistStreamTypeWrapper&gt;</ph> object can be used to pass an object in to a service and similarly to retrieve an object.","source":"Within a client application, the methods on the <xref:System.ServiceModel.ComIntegration.PersistStreamTypeWrapper> object can be used to pass an object in to a service and similarly to retrieve an object."},{"pos":[5294,5448],"content":"[!NOTE]\n Due to the custom and platform-specific nature of the serialization approach, this is best suited for use between WCF clients and WCF services.","leadings":["","> "],"nodes":[{"content":"Due to the custom and platform-specific nature of the serialization approach, this is best suited for use between WCF clients and WCF services.","pos":[9,152]}]},{"pos":[5457,5483],"content":"Selecting the Hosting Mode","linkify":"Selecting the Hosting Mode","nodes":[{"content":"Selecting the Hosting Mode","pos":[0,26]}]},{"content":"COM+ exposes Web services in one of the following hosting modes:","pos":[5487,5551]},{"content":"COM+-hosted","pos":[5561,5572]},{"content":"The Web service is hosted within the application's dedicated COM+ server process (Dllhost.exe).","pos":[5583,5678]},{"content":"This mode requires the application to be explicitly started before it can receive Web service requests.","pos":[5679,5782]},{"content":"The COM+ options \"Run as an NT Service\" or \"Leave running when idle\" can be used to prevent idle shutdown of the application and its services.","pos":[5783,5925]},{"content":"This mode provides both Web service and DCOM access to the server application.","pos":[5926,6004]},{"content":"Web-hosted","pos":[6014,6024]},{"content":"The Web service is hosted within a Web server worker process.","pos":[6035,6096]},{"content":"This mode does not require COM+ to be active when the initial request is received.","pos":[6097,6179]},{"content":"If the application is not active when this request is received, it is automatically activated prior to processing the request.","pos":[6180,6306]},{"content":"This mode also provides both Web service and DCOM access to the server application, but causes a process hop for Web service requests.","pos":[6307,6441]},{"content":"This typically requires the client to enable impersonation.","pos":[6442,6501]},{"content":"In WCF, this can be done with the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A&gt;</ph> property of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.WindowsClientCredential&gt;</ph> class, which is accessed as a property of the generic <ph id=\"ph3\">&lt;xref:System.ServiceModel.ChannelFactory%601&gt;</ph> class, as well as the <ph id=\"ph4\">&lt;xref:System.Security.Principal.TokenImpersonationLevel.Impersonation&gt;</ph> enumeration value.","pos":[6502,6912],"source":" In WCF, this can be done with the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property of the <xref:System.ServiceModel.Security.WindowsClientCredential> class, which is accessed as a property of the generic <xref:System.ServiceModel.ChannelFactory%601> class, as well as the <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation> enumeration value."},{"content":"Web-hosted in-process","pos":[6922,6943]},{"content":"The Web service and the COM+ application logic are hosted within the Web server worker process.","pos":[6954,7049]},{"content":"This provides automatic activation of the Web-hosted mode without causing a process hop for Web service requests.","pos":[7050,7163]},{"content":"The disadvantage is that the server application cannot be accessed through DCOM.","pos":[7164,7244]},{"pos":[7254,7277],"content":"Security Considerations","linkify":"Security Considerations","nodes":[{"content":"Security Considerations","pos":[0,23]}]},{"content":"Like other WCF services, the security settings for the exposed service are administered through configuration settings for the WCF channel.","pos":[7281,7420]},{"content":"Traditional DCOM security settings such as the DCOM machine-wide permissions settings are not enforced.","pos":[7421,7524]},{"content":"To enforce COM+ application roles, \"component-level access checks\" authorization must be enabled for the component.","pos":[7525,7640]},{"content":"The use of a non-secured binding can leave communication open to tampering or information disclosure.","pos":[7647,7748]},{"content":"To prevent this, it is recommended that you use a secured binding.","pos":[7749,7815]},{"content":"For the COM+-hosted and Web-hosted modes, client applications must permit the server process to impersonate the client user.","pos":[7822,7946]},{"content":"This can be done in WCF clients by setting the impersonation level to <ph id=\"ph1\">&lt;xref:System.Security.Principal.TokenImpersonationLevel.Impersonation&gt;</ph>.","pos":[7947,8088],"source":" This can be done in WCF clients by setting the impersonation level to <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>."},{"content":"With Internet Information Services (IIS) or Windows Process Activation Service (WAS) using the HTTP transport, the Httpcfg.exe tool can be used to reserve a transport endpoint address.","pos":[8095,8279]},{"content":"In other configurations, it is important to protect against rogue services that act as the intended service.","pos":[8280,8388]},{"content":"To prevent a rogue service from starting at the desired endpoint, the legitimate service can be configured to run as an NT service.","pos":[8389,8520]},{"content":"This enables the legitimate service to claim the endpoint address prior to any rogue services.","pos":[8521,8615]},{"content":"When exposing a COM+ application with configured COM+ roles as a Web-hosted service, the \"Launch IIS Process Account\" must be added to one of the applicationâ€™s roles.","pos":[8622,8788]},{"content":"This account, typically with the name IWAM_machinename, must be added to enable clean shutdown of objects after use.","pos":[8789,8905]},{"content":"The account should not be granted any additional permissions.","pos":[8906,8967]},{"content":"The COM+ process recycling features cannot be used on integrated applications.","pos":[8974,9052]},{"content":"If the application is configured to use process recycling and the components are running in a COM+ hosted process, the service fails to start.","pos":[9053,9195]},{"content":"This requirement does not include services using the Web-hosted in-process mode because the process recycling settings are not applied.","pos":[9196,9331]},{"pos":[9340,9348],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[9352,9490],"content":"<bpt id=\"p1\">[</bpt>Integrating with COM Applications Overview<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/integrating-with-com-applications-overview.md)</ept>","source":"[Integrating with COM Applications Overview](../../../../docs/framework/wcf/feature-details/integrating-with-com-applications-overview.md)"}]}