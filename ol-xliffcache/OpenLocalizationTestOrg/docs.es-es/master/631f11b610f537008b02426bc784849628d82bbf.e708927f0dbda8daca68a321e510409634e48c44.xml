{"content":"---\ntitle: \"Thread Pooling (C#) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"2015-07-20\"\nms.prod: .net\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-csharp\"\n\nms.topic: \"article\"\ndev_langs: \n  - \"CSharp\"\nms.assetid: 98ae68c1-ace8-44b9-9317-8920ac9ef2b6\ncaps.latest.revision: 5\nauthor: \"BillWagner\"\nms.author: \"wiwagn\"\n\ntranslation.priority.mt: \n  - \"cs-cz\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"tr-tr\"\n---\n# Thread Pooling (C#)\nA *thread pool* is a collection of threads that can be used to perform several tasks in the background. (See [Threading (C#)](../../../../csharp/programming-guide/concepts/threading/index.md) for background information.) This leaves the primary thread free to perform other tasks asynchronously.  \n  \n Thread pools are often employed in server applications. Each incoming request is assigned to a thread from the thread pool, so that the request can be processed asynchronously, without tying up the primary thread or delaying the processing of subsequent requests.  \n  \n Once a thread in the pool completes its task, it is returned to a queue of waiting threads, where it can be reused. This reuse enables applications to avoid the cost of creating a new thread for each task.  \n  \n Thread pools typically have a maximum number of threads. If all the threads are busy, additional tasks are put in queue until they can be serviced as threads become available.  \n  \n You can implement your own thread pool, but it is easier to use the thread pool provided by the .NET Framework through the <xref:System.Threading.ThreadPool> class.  \n  \n With thread pooling, you call the <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=fullName> method with a delegate for the procedure you want to run, and C# creates the thread and runs your procedure.  \n  \n## Thread Pooling Example  \n The following example shows how you can use thread pooling to start several tasks.  \n  \n```csharp  \npublic void DoWork()  \n{  \n    // Queue a task.  \n    System.Threading.ThreadPool.QueueUserWorkItem(  \n        new System.Threading.WaitCallback(SomeLongTask));  \n    // Queue another task.  \n    System.Threading.ThreadPool.QueueUserWorkItem(  \n        new System.Threading.WaitCallback(AnotherLongTask));  \n}  \n  \nprivate void SomeLongTask(Object state)  \n{  \n    // Insert code to perform a long task.  \n}  \n  \nprivate void AnotherLongTask(Object state)  \n{  \n    // Insert code to perform a long task.  \n}  \n```  \n  \n One advantage of thread pooling is that you can pass arguments in a state object to the task procedure. If the procedure you are calling requires more than one argument, you can cast a structure or an instance of a class into an `Object` data type.  \n  \n## Thread Pool Parameters and Return Values  \n Returning values from a thread-pool thread is not straightforward. The standard way of returning values from a function call is not allowed because `Sub` procedures are the only type of procedure that can be queued to a thread pool. One way you can provide parameters and return values is by wrapping the parameters, return values, and methods in a wrapper class as described in [Parameters and Return Values for Multithreaded Procedures (C#)](../../../../csharp/programming-guide/concepts/threading/parameters-and-return-values-for-multithreaded-procedures.md).  \n  \n An easer way to provide parameters and return values is by using the optional `ByVal` state object variable of the <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A> method. If you use this variable to pass a reference to an instance of a class, the members of the instance can be modified by the thread-pool thread and used as return values.  \n  \n At first it may not be obvious that you can modify an object referred to by a variable that is passed by value. You can do this because only the object reference is passed by value. When you make changes to members of the object referred to by the object reference, the changes apply to the actual class instance.  \n  \n Structures cannot be used to return values inside state objects. Because structures are value types, changes that the asynchronous process makes do not change the members of the original structure. Use structures to provide parameters when return values are not needed.  \n  \n## See Also  \n <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A>   \n <xref:System.Threading>   \n <xref:System.Threading.ThreadPool>   \n [How to: Use a Thread Pool (C#)](../../../../csharp/programming-guide/concepts/threading/how-to-use-a-thread-pool.md)   \n [Threading (C#)](../../../../csharp/programming-guide/concepts/threading/index.md)   \n [Multithreaded Applications (C#)](../../../../csharp/programming-guide/concepts/threading/multithreaded-applications.md)   \n [Thread Synchronization (C#)](../../../../csharp/programming-guide/concepts/threading/thread-synchronization.md)","nodes":[{"pos":[4,400],"nodes":[{"content":"Thread Pooling (C#) | Microsoft Docs","nodes":[{"pos":[0,36],"content":"Thread Pooling (C#) | Microsoft Docs","nodes":[{"content":"Thread Pooling (C#) | Microsoft Docs","pos":[0,36]}]}],"pos":[6,45],"yaml":true}],"content":"title: \"Thread Pooling (C#) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"2015-07-20\"\nms.prod: .net\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-csharp\"\n\nms.topic: \"article\"\ndev_langs: \n  - \"CSharp\"\nms.assetid: 98ae68c1-ace8-44b9-9317-8920ac9ef2b6\ncaps.latest.revision: 5\nauthor: \"BillWagner\"\nms.author: \"wiwagn\"\n\ntranslation.priority.mt: \n  - \"cs-cz\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"tr-tr\"","yamlblock":true},{"pos":[407,426],"content":"Thread Pooling (C#)","linkify":"Thread Pooling (C#)","nodes":[{"content":"Thread Pooling (C#)","pos":[0,19]}]},{"content":"A <bpt id=\"p1\">*</bpt>thread pool<ept id=\"p1\">*</ept> is a collection of threads that can be used to perform several tasks in the background.","pos":[427,530],"source":"A *thread pool* is a collection of threads that can be used to perform several tasks in the background."},{"content":"(See <bpt id=\"p1\">[</bpt>Threading (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/threading/index.md)</ept> for background information.) This leaves the primary thread free to perform other tasks asynchronously.","pos":[531,722],"source":" (See [Threading (C#)](../../../../csharp/programming-guide/concepts/threading/index.md) for background information.) This leaves the primary thread free to perform other tasks asynchronously."},{"content":"Thread pools are often employed in server applications.","pos":[729,784]},{"content":"Each incoming request is assigned to a thread from the thread pool, so that the request can be processed asynchronously, without tying up the primary thread or delaying the processing of subsequent requests.","pos":[785,992]},{"content":"Once a thread in the pool completes its task, it is returned to a queue of waiting threads, where it can be reused.","pos":[999,1114]},{"content":"This reuse enables applications to avoid the cost of creating a new thread for each task.","pos":[1115,1204]},{"content":"Thread pools typically have a maximum number of threads.","pos":[1211,1267]},{"content":"If all the threads are busy, additional tasks are put in queue until they can be serviced as threads become available.","pos":[1268,1386]},{"content":"You can implement your own thread pool, but it is easier to use the thread pool provided by the .NET Framework through the <ph id=\"ph1\">&lt;xref:System.Threading.ThreadPool&gt;</ph> class.","pos":[1393,1557],"source":"You can implement your own thread pool, but it is easier to use the thread pool provided by the .NET Framework through the <xref:System.Threading.ThreadPool> class."},{"content":"With thread pooling, you call the <ph id=\"ph1\">&lt;xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=fullName&gt;</ph> method with a delegate for the procedure you want to run, and C# creates the thread and runs your procedure.","pos":[1564,1787],"source":"With thread pooling, you call the <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=fullName> method with a delegate for the procedure you want to run, and C# creates the thread and runs your procedure."},{"pos":[1796,1818],"content":"Thread Pooling Example","linkify":"Thread Pooling Example","nodes":[{"content":"Thread Pooling Example","pos":[0,22]}]},{"content":"The following example shows how you can use thread pooling to start several tasks.","pos":[1822,1904]},{"content":"One advantage of thread pooling is that you can pass arguments in a state object to the task procedure.","pos":[2443,2546]},{"content":"If the procedure you are calling requires more than one argument, you can cast a structure or an instance of a class into an <ph id=\"ph1\">`Object`</ph> data type.","pos":[2547,2691],"source":" If the procedure you are calling requires more than one argument, you can cast a structure or an instance of a class into an `Object` data type."},{"pos":[2700,2740],"content":"Thread Pool Parameters and Return Values","linkify":"Thread Pool Parameters and Return Values","nodes":[{"content":"Thread Pool Parameters and Return Values","pos":[0,40]}]},{"content":"Returning values from a thread-pool thread is not straightforward.","pos":[2744,2810]},{"content":"The standard way of returning values from a function call is not allowed because <ph id=\"ph1\">`Sub`</ph> procedures are the only type of procedure that can be queued to a thread pool.","pos":[2811,2976],"source":" The standard way of returning values from a function call is not allowed because `Sub` procedures are the only type of procedure that can be queued to a thread pool."},{"content":"One way you can provide parameters and return values is by wrapping the parameters, return values, and methods in a wrapper class as described in <bpt id=\"p1\">[</bpt>Parameters and Return Values for Multithreaded Procedures (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/threading/parameters-and-return-values-for-multithreaded-procedures.md)</ept>.","pos":[2977,3306],"source":" One way you can provide parameters and return values is by wrapping the parameters, return values, and methods in a wrapper class as described in [Parameters and Return Values for Multithreaded Procedures (C#)](../../../../csharp/programming-guide/concepts/threading/parameters-and-return-values-for-multithreaded-procedures.md)."},{"content":"An easer way to provide parameters and return values is by using the optional <ph id=\"ph1\">`ByVal`</ph> state object variable of the <ph id=\"ph2\">&lt;xref:System.Threading.ThreadPool.QueueUserWorkItem%2A&gt;</ph> method.","pos":[3313,3491],"source":"An easer way to provide parameters and return values is by using the optional `ByVal` state object variable of the <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A> method."},{"content":"If you use this variable to pass a reference to an instance of a class, the members of the instance can be modified by the thread-pool thread and used as return values.","pos":[3492,3660]},{"content":"At first it may not be obvious that you can modify an object referred to by a variable that is passed by value.","pos":[3667,3778]},{"content":"You can do this because only the object reference is passed by value.","pos":[3779,3848]},{"content":"When you make changes to members of the object referred to by the object reference, the changes apply to the actual class instance.","pos":[3849,3980]},{"content":"Structures cannot be used to return values inside state objects.","pos":[3987,4051]},{"content":"Because structures are value types, changes that the asynchronous process makes do not change the members of the original structure.","pos":[4052,4184]},{"content":"Use structures to provide parameters when return values are not needed.","pos":[4185,4256]},{"pos":[4265,4273],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.ThreadPool.QueueUserWorkItem%2A&gt;</ph>","pos":[4277,4332],"source":"<xref:System.Threading.ThreadPool.QueueUserWorkItem%2A> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading&gt;</ph>","pos":[4337,4360],"source":"<xref:System.Threading> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Threading.ThreadPool&gt;</ph>","pos":[4365,4399],"source":"<xref:System.Threading.ThreadPool> "},{"content":"<bpt id=\"p1\">[</bpt>How to: Use a Thread Pool (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/threading/how-to-use-a-thread-pool.md)</ept><ph id=\"ph1\"> </ph>","pos":[4404,4522],"source":"[How to: Use a Thread Pool (C#)](../../../../csharp/programming-guide/concepts/threading/how-to-use-a-thread-pool.md) "},{"content":"<bpt id=\"p1\">[</bpt>Threading (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/threading/index.md)</ept><ph id=\"ph1\"> </ph>","pos":[4526,4609],"source":"[Threading (C#)](../../../../csharp/programming-guide/concepts/threading/index.md) "},{"content":"<bpt id=\"p1\">[</bpt>Multithreaded Applications (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/threading/multithreaded-applications.md)</ept><ph id=\"ph1\"> </ph>","pos":[4613,4734],"source":"[Multithreaded Applications (C#)](../../../../csharp/programming-guide/concepts/threading/multithreaded-applications.md) "},{"content":"<bpt id=\"p1\">[</bpt>Thread Synchronization (C#)<ept id=\"p1\">](../../../../csharp/programming-guide/concepts/threading/thread-synchronization.md)</ept>","pos":[4738,4850],"source":"[Thread Synchronization (C#)](../../../../csharp/programming-guide/concepts/threading/thread-synchronization.md)"}]}