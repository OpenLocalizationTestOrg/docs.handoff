{"content":"---\ntitle: \"Mitigation: Grid Control&#39;s Space Allocation to Star-columns | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"04/07/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"retargeting changes\"\n  - \".NET Framework 4.7 retargeting changes\"\n  - \"WPF retargeting changes\"\n  - \"Grid control retargeting changes\"\nms.assetid: 707c064d-85e9-4ea1-aefb-e42b60b88679\ncaps.latest.revision: 4\nauthor: \"rpetrusha\"\nms.author: \"ronpet\"\nmanager: \"wpickett\"\n---\n# Mitigation: Grid Control&#39;s Space Allocation to Star-columns\n\nStarting with applications that the .NET Framework 4.7, WPF replaces the algorithm that the <xref:System.Windows.Controls.Grid> control uses to allocate space to \\*-columns. \n\n## What's changed\n\nThe new algorithm fixes several bugs present in the old algorithm:\n\n1. Total allocation to columns can exceed the Grid's width. This can occur when allocating space to a column whose proportional share is less than its minimum size. The algorithm allocates the minimum size, which decreases the space available to other columns. If there are no \\*-columns left to allocate, the total allocation will be too large.\n\n1. Total allocation can fall short of the Grid's width. This is the dual problem to #1, arising when allocating to a column whose proportional share is greater than its maximum size, with no \\*-columns left to take up the slack.\n\n1. Two \\*-columns can receive allocations not proportional to their -weights. This is a milder version of #1/#2, arising when allocating to *-columns A, B, and C (in that order), where B's proportional share violates its min (or max) constraint. As above, this changes the space available to column C, who gets less (or more) proportional allocation than A did,\n\n1. Columns with extremely large weights (> 10^298) are all treated as if they had weight 10^298. Proportional differences between them (and between columns with slightly smaller weights) are not honored.\n\n1. Columns with infinite weights are not handled correctly. [Actually you can't set a weight to Infinity, but this is an artificial restriction. The allocation code was trying to handle it, but doing a bad job.]\n\n1. Several minor problems while avoiding overflow, underflow, loss of precision and similar floating-point issues.\n\n1. Adjustments for layout rounding are incorrect at sufficiently high DPI.\n\nThe new algorithm produces results that meet the following criteria:\n\nA. The actual width assigned to a *-column is never less than its minimum width nor greater than its maximum width.\n\nB. Each -column that is not assigned its minimum or maximum width is assigned a width proportional to its -weight. To be precise, if two columns are declared with width x and y respectively, and if neither column receives its minimum or maximum width, the actual widths v and w assigned to the columns are in the same proportion: v / w == x / y.\n\nC. The total width allocated to \"proportional\" \\*-columns is equal to the space available after allocating to the constrained columns (fixed, auto, and \\*-columns that are allocated their min or max width). This might be zero, for instance if the sum of the minimum widths exceeds the Grid's availbable width.\n\nD. All these statements are to be interpreted with respect to the \"ideal\" layout. When layout rounding is in effect, the actual widths can differ from the ideal widths by as much as one pixel.\n\nThe old algorithm honored (A) but failed to honor the other criteria in the cases outlined above.\n\nEverything said about columns and widths in this topic applies as well to rows and heights.\n\n## Impact\n\nThe new algorithm changes the actual width assigned to \\*-columns in a number of cases:\n\n- When one or more \\*-columns also have a minimum or maximum width that overrides the proportional allocation for that column. (The minimum width can derive from an explicit <xref:System.Windows.FrameworkElement.MinWidth%2A> declaration, or from an implicit minimum obtained from the column's content. The maximum width can only be defined explicitly, from a <xref:System.Windows.FrameworkElement.MaxWidth%2A> declaration.)\n\n- When one or more \\*-columns declare an extremely large \\*-weight, greater than 10^298.\n\n- When the \\*-weights are sufficiently different to encounter floating-point instability (overflow, underflow, loss of precision).\n\n- When layout rounding is enabled, and the effective display DPI is sufficiently high.\n\nIn the first two cases, the widths produced by the new algorithm can be significantly different from those produced by the old algorithm; in the last case, the difference will be at most one or two pixels.\n\n## Mitigation\n\nBy default, apps that target versions of the .NET Framework starting with the .NET Framework 4.7 will use the new algorithm, while apps that target the .NET Framework 4.6.2 or earlier versions will use the old algorithm.\n\nTo override the default, use the following configuration setting:\n\n```xml\n<runtime>\n    <AppContextSwitchOverrides value=\"Switch.System.Windows.Controls.Grid.StarDefinitionsCanExceedAvailableSpace=true\" /> \n</runtime>\n```\n\nThe value 'true' selects the old algorithm, and 'false' selects the new algorithm.\n\n## See also\n[Retargeting Changes in the .NET Framework 4.7](../../../docs/framework/migration-guide/retargeting-changes-in-the-net-framework-4-7.md)\n","nodes":[{"pos":[12,92],"content":"Mitigation: Grid Control&#39;s Space Allocation to Star-columns | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Mitigation: Grid Control&amp;#39;s Space Allocation to Star-columns | Microsoft Docs","pos":[0,80],"source":"Mitigation: Grid Control&#39;s Space Allocation to Star-columns | Microsoft Docs"}]},{"pos":[524,587],"content":"Mitigation: Grid Control&#39;s Space Allocation to Star-columns","linkify":"Mitigation: Grid Control&#39;s Space Allocation to Star-columns","nodes":[{"content":"Mitigation: Grid Control&amp;#39;s Space Allocation to Star-columns","pos":[0,63],"source":"Mitigation: Grid Control&#39;s Space Allocation to Star-columns"}]},{"content":"Starting with applications that the .NET Framework 4.7, WPF replaces the algorithm that the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.Grid&gt;</ph> control uses to allocate space to <ph id=\"ph2\">\\*</ph>-columns.","pos":[589,762],"source":"Starting with applications that the .NET Framework 4.7, WPF replaces the algorithm that the <xref:System.Windows.Controls.Grid> control uses to allocate space to \\*-columns."},{"pos":[768,782],"content":"What's changed","linkify":"What's changed","nodes":[{"content":"What's changed","pos":[0,14]}]},{"content":"The new algorithm fixes several bugs present in the old algorithm:","pos":[784,850]},{"content":"Total allocation to columns can exceed the Grid's width.","pos":[855,911]},{"content":"This can occur when allocating space to a column whose proportional share is less than its minimum size.","pos":[912,1016]},{"content":"The algorithm allocates the minimum size, which decreases the space available to other columns.","pos":[1017,1112]},{"content":"If there are no <ph id=\"ph1\">\\*</ph>-columns left to allocate, the total allocation will be too large.","pos":[1113,1197],"source":" If there are no \\*-columns left to allocate, the total allocation will be too large."},{"content":"Total allocation can fall short of the Grid's width.","pos":[1202,1254]},{"content":"This is the dual problem to #1, arising when allocating to a column whose proportional share is greater than its maximum size, with no <ph id=\"ph1\">\\*</ph>-columns left to take up the slack.","pos":[1255,1427],"source":" This is the dual problem to #1, arising when allocating to a column whose proportional share is greater than its maximum size, with no \\*-columns left to take up the slack."},{"content":"Two <ph id=\"ph1\">\\*</ph>-columns can receive allocations not proportional to their -weights.","pos":[1432,1506],"source":"Two \\*-columns can receive allocations not proportional to their -weights."},{"content":"This is a milder version of #1/#2, arising when allocating to *-columns A, B, and C (in that order), where B's proportional share violates its min (or max) constraint.","pos":[1507,1674]},{"content":"As above, this changes the space available to column C, who gets less (or more) proportional allocation than A did,","pos":[1675,1790]},{"content":"Columns with extremely large weights (&gt; 10^298) are all treated as if they had weight 10^298.","pos":[1795,1888],"source":"Columns with extremely large weights (> 10^298) are all treated as if they had weight 10^298."},{"content":"Proportional differences between them (and between columns with slightly smaller weights) are not honored.","pos":[1889,1995]},{"content":"Columns with infinite weights are not handled correctly.","pos":[2000,2056]},{"content":"[Actually you can't set a weight to Infinity, but this is an artificial restriction.","pos":[2057,2141]},{"content":"The allocation code was trying to handle it, but doing a bad job.]","pos":[2142,2208]},{"content":"Several minor problems while avoiding overflow, underflow, loss of precision and similar floating-point issues.","pos":[2213,2324]},{"content":"Adjustments for layout rounding are incorrect at sufficiently high DPI.","pos":[2329,2400]},{"content":"The new algorithm produces results that meet the following criteria:","pos":[2402,2470]},{"content":"A.","pos":[2472,2474]},{"content":"The actual width assigned to a *-column is never less than its minimum width nor greater than its maximum width.","pos":[2475,2587]},{"content":"B.","pos":[2589,2591]},{"content":"Each -column that is not assigned its minimum or maximum width is assigned a width proportional to its -weight.","pos":[2592,2703]},{"content":"To be precise, if two columns are declared with width x and y respectively, and if neither column receives its minimum or maximum width, the actual widths v and w assigned to the columns are in the same proportion: v / w == x / y.","pos":[2704,2934]},{"content":"C.","pos":[2936,2938]},{"content":"The total width allocated to \"proportional\" <ph id=\"ph1\">\\*</ph>-columns is equal to the space available after allocating to the constrained columns (fixed, auto, and <ph id=\"ph2\">\\*</ph>-columns that are allocated their min or max width).","pos":[2939,3142],"source":" The total width allocated to \"proportional\" \\*-columns is equal to the space available after allocating to the constrained columns (fixed, auto, and \\*-columns that are allocated their min or max width)."},{"content":"This might be zero, for instance if the sum of the minimum widths exceeds the Grid's availbable width.","pos":[3143,3245]},{"content":"D.","pos":[3247,3249]},{"content":"All these statements are to be interpreted with respect to the \"ideal\" layout.","pos":[3250,3328]},{"content":"When layout rounding is in effect, the actual widths can differ from the ideal widths by as much as one pixel.","pos":[3329,3439]},{"content":"The old algorithm honored (A) but failed to honor the other criteria in the cases outlined above.","pos":[3441,3538]},{"content":"Everything said about columns and widths in this topic applies as well to rows and heights.","pos":[3540,3631]},{"pos":[3636,3642],"content":"Impact","linkify":"Impact","nodes":[{"content":"Impact","pos":[0,6]}]},{"content":"The new algorithm changes the actual width assigned to <ph id=\"ph1\">\\*</ph>-columns in a number of cases:","pos":[3644,3731],"source":"The new algorithm changes the actual width assigned to \\*-columns in a number of cases:"},{"content":"When one or more <ph id=\"ph1\">\\*</ph>-columns also have a minimum or maximum width that overrides the proportional allocation for that column.","pos":[3735,3859],"source":"When one or more \\*-columns also have a minimum or maximum width that overrides the proportional allocation for that column."},{"content":"(The minimum width can derive from an explicit <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement.MinWidth%2A&gt;</ph> declaration, or from an implicit minimum obtained from the column's content.","pos":[3860,4034],"source":" (The minimum width can derive from an explicit <xref:System.Windows.FrameworkElement.MinWidth%2A> declaration, or from an implicit minimum obtained from the column's content."},{"content":"The maximum width can only be defined explicitly, from a <ph id=\"ph1\">&lt;xref:System.Windows.FrameworkElement.MaxWidth%2A&gt;</ph> declaration.)","pos":[4035,4156],"source":" The maximum width can only be defined explicitly, from a <xref:System.Windows.FrameworkElement.MaxWidth%2A> declaration.)"},{"content":"When one or more <ph id=\"ph1\">\\*</ph>-columns declare an extremely large <ph id=\"ph2\">\\*</ph>-weight, greater than 10^298.","pos":[4160,4246],"source":"When one or more \\*-columns declare an extremely large \\*-weight, greater than 10^298."},{"content":"When the <ph id=\"ph1\">\\*</ph>-weights are sufficiently different to encounter floating-point instability (overflow, underflow, loss of precision).","pos":[4250,4378],"source":"When the \\*-weights are sufficiently different to encounter floating-point instability (overflow, underflow, loss of precision)."},{"content":"When layout rounding is enabled, and the effective display DPI is sufficiently high.","pos":[4382,4466]},{"content":"In the first two cases, the widths produced by the new algorithm can be significantly different from those produced by the old algorithm; in the last case, the difference will be at most one or two pixels.","pos":[4468,4673]},{"pos":[4678,4688],"content":"Mitigation","linkify":"Mitigation","nodes":[{"content":"Mitigation","pos":[0,10]}]},{"content":"By default, apps that target versions of the .NET Framework starting with the .NET Framework 4.7 will use the new algorithm, while apps that target the .NET Framework 4.6.2 or earlier versions will use the old algorithm.","pos":[4690,4910]},{"content":"To override the default, use the following configuration setting:","pos":[4912,4977]},{"content":"The value 'true' selects the old algorithm, and 'false' selects the new algorithm.","pos":[5135,5217]},{"pos":[5222,5230],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[5231,5367],"content":"<bpt id=\"p1\">[</bpt>Retargeting Changes in the .NET Framework 4.7<ept id=\"p1\">](../../../docs/framework/migration-guide/retargeting-changes-in-the-net-framework-4-7.md)</ept>","source":"[Retargeting Changes in the .NET Framework 4.7](../../../docs/framework/migration-guide/retargeting-changes-in-the-net-framework-4-7.md)"}]}