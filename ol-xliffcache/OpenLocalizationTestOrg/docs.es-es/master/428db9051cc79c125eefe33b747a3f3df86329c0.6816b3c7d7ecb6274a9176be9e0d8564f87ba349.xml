{"content":"---\ntitle: \"Walkthrough: Calling Windows APIs (Visual Basic) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"2015-07-20\"\nms.prod: .net\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-visual-basic\"\n\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\nhelpviewer_keywords: \n  - \"DLLs, calling\"\n  - \"Windows API, walkthroughs\"\n  - \"platform invoke, walkthroughs\"\n  - \"API calls, walkthroughs [Visual Basic]\"\n  - \"Windows API, calling\"\n  - \"walkthroughs [Visual Basic], API calls\"\n  - \"DllImport attribute, calling Windows API\"\n  - \"Declare statement, declaring DLL functions\"\nms.assetid: 9280ca96-7a93-47a3-8d01-6d01be0657cb\ncaps.latest.revision: 20\nauthor: dotnet-bot\nms.author: dotnetcontent\n\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"\n---\n# Walkthrough: Calling Windows APIs (Visual Basic)\nWindows APIs are dynamic-link libraries (DLLs) that are part of the Windows operating system. You use them to perform tasks when it is difficult to write equivalent procedures of your own. For example, Windows provides a function named `FlashWindowEx` that lets you make the title bar for an application alternate between light and dark shades.  \n  \n The advantage of using Windows APIs in your code is that they can save development time because they contain dozens of useful functions that are already written and waiting to be used. The disadvantage is that Windows APIs can be difficult to work with and unforgiving when things go wrong.  \n  \n Windows APIs represent a special category of interoperability. Windows APIs do not use managed code, do not have built-in type libraries, and use data types that are different than those used with Visual Studio. Because of these differences, and because Windows APIs are not COM objects, interoperability with Windows APIs and the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] is performed using platform invoke, or PInvoke. Platform invoke is a service that enables managed code to call unmanaged functions implemented in DLLs. For more information, see [Consuming Unmanaged DLL Functions](../../../framework/interop/consuming-unmanaged-dll-functions.md). You can use PInvoke in [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] by using either the `Declare` statement or applying the `DllImport` attribute to an empty procedure.  \n  \n Windows API calls were an important part of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] programming in the past, but are seldom necessary with [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)]. Whenever possible, you should use managed code from the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] to perform tasks, instead of Windows API calls. This walkthrough provides information for those situations in which using Windows APIs is necessary.  \n  \n[!INCLUDE[note_settings_general](../../../csharp/language-reference/compiler-messages/includes/note_settings_general_md.md)]  \n  \n## API Calls Using Declare  \n The most common way to call Windows APIs is by using the `Declare` statement.  \n  \n#### To declare a DLL procedure  \n  \n1.  Determine the name of the function you want to call, plus its arguments, argument types, and return value, as well as the name and location of the DLL that contains it.  \n  \n    > [!NOTE]\n    >  For complete information about the Windows APIs, see the Win32 SDK documentation in the Platform SDK Windows API. For more information about the constants that Windows APIs use, examine the header files such as Windows.h included with the Platform SDK.  \n  \n2.  Open a new Windows Application project by clicking **New** on the **File** menu, and then clicking **Project**. The **New Project** dialog box appears.  \n  \n3.  Select **Windows Application** from the list of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] project templates. The new project is displayed.  \n  \n4.  Add the following `Declare` function either to the class or module in which you want to use the DLL:  \n  \n     [!code-vb[VbVbalrInterop#9](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_1.vb)]  \n  \n### Parts of the Declare Statement  \n The `Declare` statement includes the following elements.  \n  \n#### Auto modifier  \n The `Auto` modifier instructs the runtime to convert the string based on the method name according to common language runtime rules (or alias name if specified).  \n  \n#### Lib and Alias keywords  \n The name following the `Function` keyword is the name your program uses to access the imported function. It can be the same as the real name of the function you are calling, or you can use any valid procedure name and then employ the `Alias` keyword to specify the real name of the function you are calling.  \n  \n Specify the `Lib` keyword, followed by the name and location of the DLL that contains the function you are calling. You do not need to specify the path for files located in the Windows system directories.  \n  \n Use the `Alias` keyword if the name of the function you are calling is not a valid [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] procedure name, or conflicts with the name of other items in your application. `Alias` indicates the true name of the function being called.  \n  \n#### Argument and Data Type Declarations  \n Declare the arguments and their data types. This part can be challenging because the data types that Windows uses do not correspond to Visual Studio data types. [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] does a lot of the work for you by converting arguments to compatible data types, a process called *marshaling*. You can explicitly control how arguments are marshaled by using the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute defined in the <xref:System.Runtime.InteropServices> namespace.  \n  \n> [!NOTE]\n>  Previous versions of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] allowed you to declare parameters `As Any`, meaning that data of any data type could be used. [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] requires that you use a specific data type for all `Declare` statements.  \n  \n#### Windows API Constants  \n Some arguments are combinations of constants. For example, the `MessageBox` API shown in this walkthrough accepts an integer argument called `Typ` that controls how the message box is displayed. You can determine the numeric value of these constants by examining the `#define` statements in the file WinUser.h. The numeric values are generally shown in hexadecimal, so you may want to use a calculator to add them and convert to decimal. For example, if you want to combine the constants for the exclamation style `MB_ICONEXCLAMATION` 0x00000030 and the Yes/No style `MB_YESNO` 0x00000004, you can add the numbers and get a result of 0x00000034, or 52 decimal. Although you can use the decimal result directly, it is better to declare these values as constants in your application and combine them using the `Or` operator.  \n  \n###### To declare constants for Windows API calls  \n  \n1.  Consult the documentation for the Windows function you are calling. Determine the name of the constants it uses and the name of the .h file that contains the numeric values for these constants.  \n  \n2.  Use a text editor, such as Notepad, to view the contents of the header (.h) file, and find the values associated with the constants you are using. For example, the `MessageBox` API uses the constant `MB_ICONQUESTION` to show a question mark in the message box. The definition for `MB_ICONQUESTION` is in WinUser.h and appears as follows:  \n  \n     `#define MB_ICONQUESTION             0x00000020L`  \n  \n3.  Add equivalent `Const` statements to your class or module to make these constants available to your application. For example:  \n  \n     [!code-vb[VbVbalrInterop#11](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_2.vb)]  \n  \n###### To call the DLL procedure  \n  \n1.  Add a button named `Button1` to the startup form for your project, and then double-click it to view its code. The event handler for the button is displayed.  \n  \n2.  Add code to the `Click` event handler for the button you added, to call the procedure and provide the appropriate arguments:  \n  \n     [!code-vb[VbVbalrInterop#12](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_3.vb)]  \n  \n3.  Run the project by pressing F5. The message box is displayed with both **Yes** and **No** response buttons. Click either one.  \n  \n#### Data Marshaling  \n [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] automatically converts the data types of parameters and return values for Windows API calls, but you can use the `MarshalAs` attribute to explicitly specify unmanaged data types that an API expects. For more information about interop marshaling, see [Interop Marshaling](../../../framework/interop/interop-marshaling.md).  \n  \n###### To use Declare and MarshalAs in an API call  \n  \n1.  Determine the name of the function you want to call, plus its arguments, data types, and return value.  \n  \n2.  To simplify access to the `MarshalAs` attribute, add an `Imports` statement to the top of the code for the class or module, as in the following example:  \n  \n     [!code-vb[VbVbalrInterop#13](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_4.vb)]  \n  \n3.  Add a function prototype for the imported function to the class or module you are using, and apply the `MarshalAs` attribute to the parameters or return value. In the following example, an API call that expects the type `void*` is marshaled as `AsAny`:  \n  \n     [!code-vb[VbVbalrInterop#14](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_5.vb)]  \n  \n## API Calls Using DllImport  \n The `DllImport` attribute provides a second way to call functions in DLLs without type libraries. `DllImport` is roughly equivalent to using a `Declare` statement but provides more control over how functions are called.  \n  \n You can use `DllImport` with most Windows API calls as long as the call refers to a shared (sometimes called *static*) method. You cannot use methods that require an instance of a class. Unlike `Declare` statements, `DllImport` calls cannot use the `MarshalAs` attribute.  \n  \n#### To call a Windows API using the DllImport attribute  \n  \n1.  Open a new Windows Application project by clicking **New** on the **File** menu, and then clicking **Project**. The **New Project** dialog box appears.  \n  \n2.  Select **Windows Application** from the list of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] project templates. The new project is displayed.  \n  \n3.  Add a button named `Button2` to the startup form.  \n  \n4.  Double-click `Button2` to open the code view for the form.  \n  \n5.  To simplify access to `DllImport`, add an `Imports` statement to the top of the code for the startup form class:  \n  \n     [!code-vb[VbVbalrInterop#13](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_4.vb)]  \n  \n6.  Declare an empty function preceding the `End Class` statement for the form, and name the function `MoveFile`.  \n  \n7.  Apply the `Public` and `Shared` modifiers to the function declaration and set parameters for `MoveFile` based on the arguments the Windows API function uses:  \n  \n     [!code-vb[VbVbalrInterop#16](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_6.vb)]  \n  \n     Your function can have any valid procedure name; the `DllImport` attribute specifies the name in the DLL. It also handles interoperability marshaling for the parameters and return values, so you can choose Visual Studio data types that are similar to the data types the API uses.  \n  \n8.  Apply the `DllImport` attribute to the empty function. The first parameter is the name and location of the DLL containing the function you are calling. You do not need to specify the path for files located in the Windows system directories. The second parameter is a named argument that specifies the name of the function in the Windows API. In this example, the `DllImport` attribute forces calls to `MoveFile` to be forwarded to `MoveFileW` in KERNEL32.DLL. The `MoveFileW` method copies a file from the path `src` to the path `dst`.  \n  \n     [!code-vb[VbVbalrInterop#17](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_7.vb)]  \n  \n9. Add code to the `Button2_Click` event handler to call the function:  \n  \n     [!code-vb[VbVbalrInterop#18](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_8.vb)]  \n  \n10. Create a file named Test.txt and place it in the C:\\Tmp directory on your hard drive. Create the Tmp directory if necessary.  \n  \n11. Press F5 to start the application. The main form appears.  \n  \n12. Click **Button2**. The message \"The file was moved successfully\" is displayed if the file can be moved.  \n  \n## See Also  \n <xref:System.Runtime.InteropServices.DllImportAttribute>   \n <xref:System.Runtime.InteropServices.MarshalAsAttribute>   \n [Declare Statement](../../../visual-basic/language-reference/statements/declare-statement.md)   \n [Auto](../../../visual-basic/language-reference/modifiers/auto.md)   \n [Alias](../../../visual-basic/language-reference/statements/alias-clause.md)   \n [COM Interop](../../../visual-basic/programming-guide/com-interop/index.md)   \n [Creating Prototypes in Managed Code](../../../framework/interop/creating-prototypes-in-managed-code.md)   \n [Marshaling a Delegate as a Callback Method](../../../framework/interop/marshaling-a-delegate-as-a-callback-method.md)","nodes":[{"pos":[4,866],"embed":true,"restype":"x-metadata","content":"title: \"Walkthrough: Calling Windows APIs (Visual Basic) | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"2015-07-20\"\nms.prod: .net\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"devlang-visual-basic\"\n\nms.topic: \"article\"\ndev_langs: \n  - \"VB\"\nhelpviewer_keywords: \n  - \"DLLs, calling\"\n  - \"Windows API, walkthroughs\"\n  - \"platform invoke, walkthroughs\"\n  - \"API calls, walkthroughs [Visual Basic]\"\n  - \"Windows API, calling\"\n  - \"walkthroughs [Visual Basic], API calls\"\n  - \"DllImport attribute, calling Windows API\"\n  - \"Declare statement, declaring DLL functions\"\nms.assetid: 9280ca96-7a93-47a3-8d01-6d01be0657cb\ncaps.latest.revision: 20\nauthor: dotnet-bot\nms.author: dotnetcontent\n\ntranslation.priority.ht: \n  - \"cs-cz\"\n  - \"de-de\"\n  - \"es-es\"\n  - \"fr-fr\"\n  - \"it-it\"\n  - \"ja-jp\"\n  - \"ko-kr\"\n  - \"pl-pl\"\n  - \"pt-br\"\n  - \"ru-ru\"\n  - \"tr-tr\"\n  - \"zh-cn\"\n  - \"zh-tw\"","nodes":[{"content":"Walkthrough: Calling Windows APIs (Visual Basic) | Microsoft Docs","nodes":[{"pos":[0,65],"content":"Walkthrough: Calling Windows APIs (Visual Basic) | Microsoft Docs","nodes":[{"content":"Walkthrough: Calling Windows APIs (Visual Basic) | Microsoft Docs","pos":[0,65]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[873,921],"content":"Walkthrough: Calling Windows APIs (Visual Basic)","linkify":"Walkthrough: Calling Windows APIs (Visual Basic)","nodes":[{"content":"Walkthrough: Calling Windows APIs (Visual Basic)","pos":[0,48]}]},{"content":"Windows APIs are dynamic-link libraries (DLLs) that are part of the Windows operating system.","pos":[922,1015]},{"content":"You use them to perform tasks when it is difficult to write equivalent procedures of your own.","pos":[1016,1110]},{"content":"For example, Windows provides a function named <ph id=\"ph1\">`FlashWindowEx`</ph> that lets you make the title bar for an application alternate between light and dark shades.","pos":[1111,1266],"source":" For example, Windows provides a function named `FlashWindowEx` that lets you make the title bar for an application alternate between light and dark shades."},{"content":"The advantage of using Windows APIs in your code is that they can save development time because they contain dozens of useful functions that are already written and waiting to be used.","pos":[1273,1457]},{"content":"The disadvantage is that Windows APIs can be difficult to work with and unforgiving when things go wrong.","pos":[1458,1563]},{"content":"Windows APIs represent a special category of interoperability.","pos":[1570,1632]},{"content":"Windows APIs do not use managed code, do not have built-in type libraries, and use data types that are different than those used with Visual Studio.","pos":[1633,1781]},{"content":"Because of these differences, and because Windows APIs are not COM objects, interoperability with Windows APIs and the <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)]</ph> is performed using platform invoke, or PInvoke.","pos":[1782,2032],"source":" Because of these differences, and because Windows APIs are not COM objects, interoperability with Windows APIs and the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] is performed using platform invoke, or PInvoke."},{"content":"Platform invoke is a service that enables managed code to call unmanaged functions implemented in DLLs.","pos":[2033,2136]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Consuming Unmanaged DLL Functions<ept id=\"p1\">](../../../framework/interop/consuming-unmanaged-dll-functions.md)</ept>.","pos":[2137,2264],"source":" For more information, see [Consuming Unmanaged DLL Functions](../../../framework/interop/consuming-unmanaged-dll-functions.md)."},{"content":"You can use PInvoke in <ph id=\"ph1\">[!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]</ph> by using either the <ph id=\"ph2\">`Declare`</ph> statement or applying the <ph id=\"ph3\">`DllImport`</ph> attribute to an empty procedure.","pos":[2265,2478],"source":" You can use PInvoke in [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] by using either the `Declare` statement or applying the `DllImport` attribute to an empty procedure."},{"content":"Windows API calls were an important part of <ph id=\"ph1\">[!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]</ph> programming in the past, but are seldom necessary with <ph id=\"ph2\">[!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)]</ph>.","pos":[2485,2787],"source":"Windows API calls were an important part of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] programming in the past, but are seldom necessary with [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)]."},{"content":"Whenever possible, you should use managed code from the <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)]</ph> to perform tasks, instead of Windows API calls.","pos":[2788,2975],"source":" Whenever possible, you should use managed code from the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] to perform tasks, instead of Windows API calls."},{"content":"This walkthrough provides information for those situations in which using Windows APIs is necessary.","pos":[2976,3076]},{"pos":[3215,3238],"content":"API Calls Using Declare","linkify":"API Calls Using Declare","nodes":[{"content":"API Calls Using Declare","pos":[0,23]}]},{"pos":[3242,3319],"content":"The most common way to call Windows APIs is by using the <ph id=\"ph1\">`Declare`</ph> statement.","source":"The most common way to call Windows APIs is by using the `Declare` statement."},{"pos":[3330,3356],"content":"To declare a DLL procedure","linkify":"To declare a DLL procedure","nodes":[{"content":"To declare a DLL procedure","pos":[0,26]}]},{"content":"Determine the name of the function you want to call, plus its arguments, argument types, and return value, as well as the name and location of the DLL that contains it.","pos":[3366,3534]},{"pos":[3546,3813],"content":"[!NOTE]\nFor complete information about the Windows APIs, see the Win32 SDK documentation in the Platform SDK Windows API. For more information about the constants that Windows APIs use, examine the header files such as Windows.h included with the Platform SDK.","leadings":["","    >  "],"nodes":[{"content":"For complete information about the Windows APIs, see the Win32 SDK documentation in the Platform SDK Windows API. For more information about the constants that Windows APIs use, examine the header files such as Windows.h included with the Platform SDK.","pos":[8,260],"nodes":[{"content":"For complete information about the Windows APIs, see the Win32 SDK documentation in the Platform SDK Windows API.","pos":[0,113]},{"content":"For more information about the constants that Windows APIs use, examine the header files such as Windows.h included with the Platform SDK.","pos":[114,252]}]}]},{"content":"Open a new Windows Application project by clicking <bpt id=\"p1\">**</bpt>New<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>File<ept id=\"p2\">**</ept> menu, and then clicking <bpt id=\"p3\">**</bpt>Project<ept id=\"p3\">**</ept>.","pos":[3823,3934],"source":"Open a new Windows Application project by clicking **New** on the **File** menu, and then clicking **Project**."},{"content":"The <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept> dialog box appears.","pos":[3935,3974],"source":" The **New Project** dialog box appears."},{"content":"Select <bpt id=\"p1\">**</bpt>Windows Application<ept id=\"p1\">**</ept> from the list of <ph id=\"ph1\">[!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]</ph> project templates.","pos":[3984,4140],"source":"Select **Windows Application** from the list of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] project templates."},{"content":"The new project is displayed.","pos":[4141,4170]},{"pos":[4180,4280],"content":"Add the following <ph id=\"ph1\">`Declare`</ph> function either to the class or module in which you want to use the DLL:","source":"Add the following `Declare` function either to the class or module in which you want to use the DLL:"},{"pos":[4444,4474],"content":"Parts of the Declare Statement","linkify":"Parts of the Declare Statement","nodes":[{"content":"Parts of the Declare Statement","pos":[0,30]}]},{"pos":[4478,4534],"content":"The <ph id=\"ph1\">`Declare`</ph> statement includes the following elements.","source":"The `Declare` statement includes the following elements."},{"pos":[4545,4558],"content":"Auto modifier","linkify":"Auto modifier","nodes":[{"content":"Auto modifier","pos":[0,13]}]},{"pos":[4562,4723],"content":"The <ph id=\"ph1\">`Auto`</ph> modifier instructs the runtime to convert the string based on the method name according to common language runtime rules (or alias name if specified).","source":"The `Auto` modifier instructs the runtime to convert the string based on the method name according to common language runtime rules (or alias name if specified)."},{"pos":[4734,4756],"content":"Lib and Alias keywords","linkify":"Lib and Alias keywords","nodes":[{"content":"Lib and Alias keywords","pos":[0,22]}]},{"content":"The name following the <ph id=\"ph1\">`Function`</ph> keyword is the name your program uses to access the imported function.","pos":[4760,4864],"source":"The name following the `Function` keyword is the name your program uses to access the imported function."},{"content":"It can be the same as the real name of the function you are calling, or you can use any valid procedure name and then employ the <ph id=\"ph1\">`Alias`</ph> keyword to specify the real name of the function you are calling.","pos":[4865,5067],"source":" It can be the same as the real name of the function you are calling, or you can use any valid procedure name and then employ the `Alias` keyword to specify the real name of the function you are calling."},{"content":"Specify the <ph id=\"ph1\">`Lib`</ph> keyword, followed by the name and location of the DLL that contains the function you are calling.","pos":[5074,5189],"source":"Specify the `Lib` keyword, followed by the name and location of the DLL that contains the function you are calling."},{"content":"You do not need to specify the path for files located in the Windows system directories.","pos":[5190,5278]},{"content":"Use the <ph id=\"ph1\">`Alias`</ph> keyword if the name of the function you are calling is not a valid <ph id=\"ph2\">[!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]</ph> procedure name, or conflicts with the name of other items in your application.","pos":[5285,5536],"source":"Use the `Alias` keyword if the name of the function you are calling is not a valid [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] procedure name, or conflicts with the name of other items in your application."},{"content":"<ph id=\"ph1\">`Alias`</ph> indicates the true name of the function being called.","pos":[5537,5598],"source":"`Alias` indicates the true name of the function being called."},{"pos":[5609,5644],"content":"Argument and Data Type Declarations","linkify":"Argument and Data Type Declarations","nodes":[{"content":"Argument and Data Type Declarations","pos":[0,35]}]},{"content":"Declare the arguments and their data types.","pos":[5648,5691]},{"content":"This part can be challenging because the data types that Windows uses do not correspond to Visual Studio data types.","pos":[5692,5808]},{"content":"<ph id=\"ph1\">[!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]</ph> does a lot of the work for you by converting arguments to compatible data types, a process called <bpt id=\"p1\">*</bpt>marshaling<ept id=\"p1\">*</ept>.","pos":[5809,6010],"source":"[!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] does a lot of the work for you by converting arguments to compatible data types, a process called *marshaling*."},{"content":"You can explicitly control how arguments are marshaled by using the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute&gt;</ph> attribute defined in the <ph id=\"ph2\">&lt;xref:System.Runtime.InteropServices&gt;</ph> namespace.","pos":[6011,6209],"source":" You can explicitly control how arguments are marshaled by using the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute defined in the <xref:System.Runtime.InteropServices> namespace."},{"pos":[6217,6595],"content":"[!NOTE]\n Previous versions of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] allowed you to declare parameters `As Any`, meaning that data of any data type could be used. [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] requires that you use a specific data type for all `Declare` statements.","leadings":["","> "],"nodes":[{"content":"Previous versions of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] allowed you to declare parameters `As Any`, meaning that data of any data type could be used. [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] requires that you use a specific data type for all `Declare` statements.","pos":[9,376],"nodes":[{"content":"Previous versions of <ph id=\"ph1\">[!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]</ph> allowed you to declare parameters <ph id=\"ph2\">`As Any`</ph>, meaning that data of any data type could be used.","pos":[0,204],"source":"Previous versions of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] allowed you to declare parameters `As Any`, meaning that data of any data type could be used."},{"content":"<ph id=\"ph1\">[!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]</ph> requires that you use a specific data type for all <ph id=\"ph2\">`Declare`</ph> statements.","pos":[205,367],"source":"[!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] requires that you use a specific data type for all `Declare` statements."}]}]},{"pos":[6606,6627],"content":"Windows API Constants","linkify":"Windows API Constants","nodes":[{"content":"Windows API Constants","pos":[0,21]}]},{"content":"Some arguments are combinations of constants.","pos":[6631,6676]},{"content":"For example, the <ph id=\"ph1\">`MessageBox`</ph> API shown in this walkthrough accepts an integer argument called <ph id=\"ph2\">`Typ`</ph> that controls how the message box is displayed.","pos":[6677,6825],"source":" For example, the `MessageBox` API shown in this walkthrough accepts an integer argument called `Typ` that controls how the message box is displayed."},{"content":"You can determine the numeric value of these constants by examining the <ph id=\"ph1\">`#define`</ph> statements in the file WinUser.h.","pos":[6826,6941],"source":" You can determine the numeric value of these constants by examining the `#define` statements in the file WinUser.h."},{"content":"The numeric values are generally shown in hexadecimal, so you may want to use a calculator to add them and convert to decimal.","pos":[6942,7068]},{"content":"For example, if you want to combine the constants for the exclamation style <ph id=\"ph1\">`MB_ICONEXCLAMATION`</ph> 0x00000030 and the Yes/No style <ph id=\"ph2\">`MB_YESNO`</ph> 0x00000004, you can add the numbers and get a result of 0x00000034, or 52 decimal.","pos":[7069,7291],"source":" For example, if you want to combine the constants for the exclamation style `MB_ICONEXCLAMATION` 0x00000030 and the Yes/No style `MB_YESNO` 0x00000004, you can add the numbers and get a result of 0x00000034, or 52 decimal."},{"content":"Although you can use the decimal result directly, it is better to declare these values as constants in your application and combine them using the <ph id=\"ph1\">`Or`</ph> operator.","pos":[7292,7453],"source":" Although you can use the decimal result directly, it is better to declare these values as constants in your application and combine them using the `Or` operator."},{"pos":[7466,7508],"content":"To declare constants for Windows API calls","linkify":"To declare constants for Windows API calls","nodes":[{"content":"To declare constants for Windows API calls","pos":[0,42]}]},{"content":"Consult the documentation for the Windows function you are calling.","pos":[7518,7585]},{"content":"Determine the name of the constants it uses and the name of the .h file that contains the numeric values for these constants.","pos":[7586,7711]},{"content":"Use a text editor, such as Notepad, to view the contents of the header (.h) file, and find the values associated with the constants you are using.","pos":[7721,7867]},{"content":"For example, the <ph id=\"ph1\">`MessageBox`</ph> API uses the constant <ph id=\"ph2\">`MB_ICONQUESTION`</ph> to show a question mark in the message box.","pos":[7868,7981],"source":" For example, the `MessageBox` API uses the constant `MB_ICONQUESTION` to show a question mark in the message box."},{"content":"The definition for <ph id=\"ph1\">`MB_ICONQUESTION`</ph> is in WinUser.h and appears as follows:","pos":[7982,8058],"source":" The definition for `MB_ICONQUESTION` is in WinUser.h and appears as follows:"},{"content":"Add equivalent <ph id=\"ph1\">`Const`</ph> statements to your class or module to make these constants available to your application.","pos":[8128,8240],"source":"Add equivalent `Const` statements to your class or module to make these constants available to your application."},{"content":"For example:","pos":[8241,8253]},{"pos":[8421,8446],"content":"To call the DLL procedure","linkify":"To call the DLL procedure","nodes":[{"content":"To call the DLL procedure","pos":[0,25]}]},{"content":"Add a button named <ph id=\"ph1\">`Button1`</ph> to the startup form for your project, and then double-click it to view its code.","pos":[8456,8565],"source":"Add a button named `Button1` to the startup form for your project, and then double-click it to view its code."},{"content":"The event handler for the button is displayed.","pos":[8566,8612]},{"pos":[8622,8746],"content":"Add code to the <ph id=\"ph1\">`Click`</ph> event handler for the button you added, to call the procedure and provide the appropriate arguments:","source":"Add code to the `Click` event handler for the button you added, to call the procedure and provide the appropriate arguments:"},{"content":"Run the project by pressing F5.","pos":[8911,8942]},{"content":"The message box is displayed with both <bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>No<ept id=\"p2\">**</ept> response buttons.","pos":[8943,9018],"source":" The message box is displayed with both **Yes** and **No** response buttons."},{"content":"Click either one.","pos":[9019,9036]},{"pos":[9047,9062],"content":"Data Marshaling","linkify":"Data Marshaling","nodes":[{"content":"Data Marshaling","pos":[0,15]}]},{"content":"automatically converts the data types of parameters and return values for Windows API calls, but you can use the <ph id=\"ph1\">`MarshalAs`</ph> attribute to explicitly specify unmanaged data types that an API expects.","pos":[9156,9354],"source":" automatically converts the data types of parameters and return values for Windows API calls, but you can use the `MarshalAs` attribute to explicitly specify unmanaged data types that an API expects."},{"content":"For more information about interop marshaling, see <bpt id=\"p1\">[</bpt>Interop Marshaling<ept id=\"p1\">](../../../framework/interop/interop-marshaling.md)</ept>.","pos":[9355,9477],"source":" For more information about interop marshaling, see [Interop Marshaling](../../../framework/interop/interop-marshaling.md)."},{"pos":[9490,9533],"content":"To use Declare and MarshalAs in an API call","linkify":"To use Declare and MarshalAs in an API call","nodes":[{"content":"To use Declare and MarshalAs in an API call","pos":[0,43]}]},{"content":"Determine the name of the function you want to call, plus its arguments, data types, and return value.","pos":[9543,9645]},{"pos":[9655,9807],"content":"To simplify access to the <ph id=\"ph1\">`MarshalAs`</ph> attribute, add an <ph id=\"ph2\">`Imports`</ph> statement to the top of the code for the class or module, as in the following example:","source":"To simplify access to the `MarshalAs` attribute, add an `Imports` statement to the top of the code for the class or module, as in the following example:"},{"content":"Add a function prototype for the imported function to the class or module you are using, and apply the <ph id=\"ph1\">`MarshalAs`</ph> attribute to the parameters or return value.","pos":[9972,10131],"source":"Add a function prototype for the imported function to the class or module you are using, and apply the `MarshalAs` attribute to the parameters or return value."},{"content":"In the following example, an API call that expects the type <ph id=\"ph1\">`void*`</ph> is marshaled as <ph id=\"ph2\">`AsAny`</ph>:","pos":[10132,10224],"source":" In the following example, an API call that expects the type `void*` is marshaled as `AsAny`:"},{"pos":[10388,10413],"content":"API Calls Using DllImport","linkify":"API Calls Using DllImport","nodes":[{"content":"API Calls Using DllImport","pos":[0,25]}]},{"content":"The <ph id=\"ph1\">`DllImport`</ph> attribute provides a second way to call functions in DLLs without type libraries.","pos":[10417,10514],"source":"The `DllImport` attribute provides a second way to call functions in DLLs without type libraries."},{"content":"<ph id=\"ph1\">`DllImport`</ph> is roughly equivalent to using a <ph id=\"ph2\">`Declare`</ph> statement but provides more control over how functions are called.","pos":[10515,10636],"source":"`DllImport` is roughly equivalent to using a `Declare` statement but provides more control over how functions are called."},{"content":"You can use <ph id=\"ph1\">`DllImport`</ph> with most Windows API calls as long as the call refers to a shared (sometimes called <bpt id=\"p1\">*</bpt>static<ept id=\"p1\">*</ept>) method.","pos":[10643,10769],"source":"You can use `DllImport` with most Windows API calls as long as the call refers to a shared (sometimes called *static*) method."},{"content":"You cannot use methods that require an instance of a class.","pos":[10770,10829]},{"content":"Unlike <ph id=\"ph1\">`Declare`</ph> statements, <ph id=\"ph2\">`DllImport`</ph> calls cannot use the <ph id=\"ph3\">`MarshalAs`</ph> attribute.","pos":[10830,10914],"source":" Unlike `Declare` statements, `DllImport` calls cannot use the `MarshalAs` attribute."},{"pos":[10925,10976],"content":"To call a Windows API using the DllImport attribute","linkify":"To call a Windows API using the DllImport attribute","nodes":[{"content":"To call a Windows API using the DllImport attribute","pos":[0,51]}]},{"content":"Open a new Windows Application project by clicking <bpt id=\"p1\">**</bpt>New<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>File<ept id=\"p2\">**</ept> menu, and then clicking <bpt id=\"p3\">**</bpt>Project<ept id=\"p3\">**</ept>.","pos":[10986,11097],"source":"Open a new Windows Application project by clicking **New** on the **File** menu, and then clicking **Project**."},{"content":"The <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept> dialog box appears.","pos":[11098,11137],"source":" The **New Project** dialog box appears."},{"content":"Select <bpt id=\"p1\">**</bpt>Windows Application<ept id=\"p1\">**</ept> from the list of <ph id=\"ph1\">[!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]</ph> project templates.","pos":[11147,11303],"source":"Select **Windows Application** from the list of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] project templates."},{"content":"The new project is displayed.","pos":[11304,11333]},{"pos":[11343,11392],"content":"Add a button named <ph id=\"ph1\">`Button2`</ph> to the startup form.","source":"Add a button named `Button2` to the startup form."},{"pos":[11402,11460],"content":"Double-click <ph id=\"ph1\">`Button2`</ph> to open the code view for the form.","source":"Double-click `Button2` to open the code view for the form."},{"pos":[11470,11582],"content":"To simplify access to <ph id=\"ph1\">`DllImport`</ph>, add an <ph id=\"ph2\">`Imports`</ph> statement to the top of the code for the startup form class:","source":"To simplify access to `DllImport`, add an `Imports` statement to the top of the code for the startup form class:"},{"pos":[11747,11856],"content":"Declare an empty function preceding the <ph id=\"ph1\">`End Class`</ph> statement for the form, and name the function <ph id=\"ph2\">`MoveFile`</ph>.","source":"Declare an empty function preceding the `End Class` statement for the form, and name the function `MoveFile`."},{"pos":[11866,12023],"content":"Apply the <ph id=\"ph1\">`Public`</ph> and <ph id=\"ph2\">`Shared`</ph> modifiers to the function declaration and set parameters for <ph id=\"ph3\">`MoveFile`</ph> based on the arguments the Windows API function uses:","source":"Apply the `Public` and `Shared` modifiers to the function declaration and set parameters for `MoveFile` based on the arguments the Windows API function uses:"},{"content":"Your function can have any valid procedure name; the <ph id=\"ph1\">`DllImport`</ph> attribute specifies the name in the DLL.","pos":[12189,12294],"source":"Your function can have any valid procedure name; the `DllImport` attribute specifies the name in the DLL."},{"content":"It also handles interoperability marshaling for the parameters and return values, so you can choose Visual Studio data types that are similar to the data types the API uses.","pos":[12295,12468]},{"content":"Apply the <ph id=\"ph1\">`DllImport`</ph> attribute to the empty function.","pos":[12478,12532],"source":"Apply the `DllImport` attribute to the empty function."},{"content":"The first parameter is the name and location of the DLL containing the function you are calling.","pos":[12533,12629]},{"content":"You do not need to specify the path for files located in the Windows system directories.","pos":[12630,12718]},{"content":"The second parameter is a named argument that specifies the name of the function in the Windows API.","pos":[12719,12819]},{"content":"In this example, the <ph id=\"ph1\">`DllImport`</ph> attribute forces calls to <ph id=\"ph2\">`MoveFile`</ph> to be forwarded to <ph id=\"ph3\">`MoveFileW`</ph> in KERNEL32.DLL.","pos":[12820,12937],"source":" In this example, the `DllImport` attribute forces calls to `MoveFile` to be forwarded to `MoveFileW` in KERNEL32.DLL."},{"content":"The <ph id=\"ph1\">`MoveFileW`</ph> method copies a file from the path <ph id=\"ph2\">`src`</ph> to the path <ph id=\"ph3\">`dst`</ph>.","pos":[12938,13013],"source":" The `MoveFileW` method copies a file from the path `src` to the path `dst`."},{"pos":[13177,13244],"content":"Add code to the <ph id=\"ph1\">`Button2_Click`</ph> event handler to call the function:","source":"Add code to the `Button2_Click` event handler to call the function:"},{"content":"Create a file named Test.txt and place it in the C:\\Tmp directory on your hard drive.","pos":[13409,13494]},{"content":"Create the Tmp directory if necessary.","pos":[13495,13533]},{"content":"Press F5 to start the application.","pos":[13543,13577]},{"content":"The main form appears.","pos":[13578,13600]},{"content":"Click <bpt id=\"p1\">**</bpt>Button2<ept id=\"p1\">**</ept>.","pos":[13610,13628],"source":"Click **Button2**."},{"content":"The message \"The file was moved successfully\" is displayed if the file can be moved.","pos":[13629,13713]},{"pos":[13722,13730],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.DllImportAttribute&gt;</ph>","pos":[13734,13790],"source":"<xref:System.Runtime.InteropServices.DllImportAttribute> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute&gt;</ph>","pos":[13795,13851],"source":"<xref:System.Runtime.InteropServices.MarshalAsAttribute> "},{"content":"<bpt id=\"p1\">[</bpt>Declare Statement<ept id=\"p1\">](../../../visual-basic/language-reference/statements/declare-statement.md)</ept><ph id=\"ph1\"> </ph>","pos":[13856,13950],"source":"[Declare Statement](../../../visual-basic/language-reference/statements/declare-statement.md) "},{"content":"<bpt id=\"p1\">[</bpt>Auto<ept id=\"p1\">](../../../visual-basic/language-reference/modifiers/auto.md)</ept><ph id=\"ph1\"> </ph>","pos":[13954,14021],"source":"[Auto](../../../visual-basic/language-reference/modifiers/auto.md) "},{"content":"<bpt id=\"p1\">[</bpt>Alias<ept id=\"p1\">](../../../visual-basic/language-reference/statements/alias-clause.md)</ept><ph id=\"ph1\"> </ph>","pos":[14025,14102],"source":"[Alias](../../../visual-basic/language-reference/statements/alias-clause.md) "},{"content":"<bpt id=\"p1\">[</bpt>COM Interop<ept id=\"p1\">](../../../visual-basic/programming-guide/com-interop/index.md)</ept><ph id=\"ph1\"> </ph>","pos":[14106,14182],"source":"[COM Interop](../../../visual-basic/programming-guide/com-interop/index.md) "},{"content":"<bpt id=\"p1\">[</bpt>Creating Prototypes in Managed Code<ept id=\"p1\">](../../../framework/interop/creating-prototypes-in-managed-code.md)</ept><ph id=\"ph1\"> </ph>","pos":[14186,14291],"source":"[Creating Prototypes in Managed Code](../../../framework/interop/creating-prototypes-in-managed-code.md) "},{"content":"<bpt id=\"p1\">[</bpt>Marshaling a Delegate as a Callback Method<ept id=\"p1\">](../../../framework/interop/marshaling-a-delegate-as-a-callback-method.md)</ept>","pos":[14295,14413],"source":"[Marshaling a Delegate as a Callback Method](../../../framework/interop/marshaling-a-delegate-as-a-callback-method.md)"}]}