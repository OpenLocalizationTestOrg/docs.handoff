{"content":"---\ntitle: \"SqlDependency in an ASP.NET Application | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-ado\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: ff226ce3-f6b5-47a1-8d22-dc78b67e07f5\ncaps.latest.revision: 3\nauthor: \"JennieHubbard\"\nms.author: \"jhubbard\"\nmanager: \"jhubbard\"\n---\n# SqlDependency in an ASP.NET Application\nThe example in this section shows how to use <xref:System.Data.SqlClient.SqlDependency> indirectly by leveraging the ASP.NET <xref:System.Web.Caching.SqlCacheDependency> object. The <xref:System.Web.Caching.SqlCacheDependency> object uses a <xref:System.Data.SqlClient.SqlDependency> to listen for notifications and correctly update the cache.  \n  \n> [!NOTE]\n>  The sample code assumes that you have enabled query notifications by executing the scripts in [Enabling Query Notifications](../../../../../docs/framework/data/adonet/sql/enabling-query-notifications.md).  \n  \n## About the Sample Application  \n The sample application uses a single ASP.NET Web page to display product information from the **AdventureWorks** SQL Server database in a <xref:System.Web.UI.WebControls.GridView> control. When the page loads, the code writes the current time to a <xref:System.Web.UI.WebControls.Label> control. It then defines a <xref:System.Web.Caching.SqlCacheDependency> object and sets properties on the <xref:System.Web.Caching.Cache> object to store the cache data for up to three minutes. The code then connects to the database and retrieves the data. When the page is loaded and the application is running ASP.NET will retrieve data from the cache, which you can verify by noting that the time on the page does not change. If the data being monitored changes, ASP.NET invalidates the cache and repopulate the `GridView` control with fresh data, updating the time displayed in the `Label` control.  \n  \n## Creating the Sample Application  \n Follow these steps to create and run the sample application:  \n  \n1.  Create a new ASP.NET Web site.  \n  \n2.  Add a <xref:System.Web.UI.WebControls.Label> and a <xref:System.Web.UI.WebControls.GridView> control to the Default.aspx page.  \n  \n3.  Open the page's class module and add the following directives:  \n  \n    ```vb  \n  \n    Option Strict On  \n    Option Explicit On  \n  \n    Imports System.Data.SqlClient  \n    ```  \n  \n    ```csharp  \n    using System.Data.SqlClient;  \n    using System.Web.Caching;  \n    ```  \n  \n4.  Add the following code in the page's `Page_Load` event:  \n  \n     [!code-csharp[DataWorks SqlDependency.AspNet#1](../../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlDependency.AspNet/CS/Default.aspx.cs#1)]\n     [!code-vb[DataWorks SqlDependency.AspNet#1](../../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlDependency.AspNet/VB/Default.aspx.vb#1)]  \n  \n5.  Add two helper methods, `GetConnectionString` and `GetSQL`. The connection string defined uses integrated security. You will need to verify that the account you are using has the necessary database permissions and that the sample database, **AdventureWorks**, has notifications enabled. For more information, see [Special Considerations When Using Query Notifications](http://msdn.microsoft.com/en-us/a83c8dc8-4fb9-4ffd-a2a5-c07cf4a203c7).  \n  \n     [!code-csharp[DataWorks SqlDependency.AspNet#2](../../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlDependency.AspNet/CS/Default.aspx.cs#2)]\n     [!code-vb[DataWorks SqlDependency.AspNet#2](../../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlDependency.AspNet/VB/Default.aspx.vb#2)]  \n  \n### Testing the Application  \n The application caches the data displayed on the Web form and refreshes it every three minutes if there is no activity. If a change occurs to the database, the cache is refreshed immediately. Run the application from Visual Studio, which loads the page into the browser. The cache refresh time displayed indicates when the cache was last refreshed. Wait three minutes, and then refresh the page, causing a postback event to occur. Note that the time displayed on the page has changed. If you refresh the page in less than three minutes, the time displayed on the page will remain the same.  \n  \n Now update the data in the database, using a Transact-SQL UPDATE command and refresh the page. The time displayed now indicates that the cache was refreshed with the new data from the database. Note that although the cache is updated, the time displayed on the page does not change until a postback event occurs.  \n  \n## See Also  \n [Query Notifications in SQL Server](../../../../../docs/framework/data/adonet/sql/query-notifications-in-sql-server.md)   \n [ADO.NET Managed Providers and DataSet Developer Center](http://go.microsoft.com/fwlink/?LinkId=217917)","nodes":[{"pos":[12,68],"content":"SqlDependency in an ASP.NET Application | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"SqlDependency in an ASP.NET Application | Microsoft Docs","pos":[0,56]}]},{"pos":[377,416],"content":"SqlDependency in an ASP.NET Application","linkify":"SqlDependency in an ASP.NET Application","nodes":[{"content":"SqlDependency in an ASP.NET Application","pos":[0,39]}]},{"content":"The example in this section shows how to use <ph id=\"ph1\">&lt;xref:System.Data.SqlClient.SqlDependency&gt;</ph> indirectly by leveraging the ASP.NET <ph id=\"ph2\">&lt;xref:System.Web.Caching.SqlCacheDependency&gt;</ph> object.","pos":[417,594],"source":"The example in this section shows how to use <xref:System.Data.SqlClient.SqlDependency> indirectly by leveraging the ASP.NET <xref:System.Web.Caching.SqlCacheDependency> object."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Web.Caching.SqlCacheDependency&gt;</ph> object uses a <ph id=\"ph2\">&lt;xref:System.Data.SqlClient.SqlDependency&gt;</ph> to listen for notifications and correctly update the cache.","pos":[595,760],"source":" The <xref:System.Web.Caching.SqlCacheDependency> object uses a <xref:System.Data.SqlClient.SqlDependency> to listen for notifications and correctly update the cache."},{"pos":[768,983],"content":"[!NOTE]\n The sample code assumes that you have enabled query notifications by executing the scripts in [Enabling Query Notifications](../../../../../docs/framework/data/adonet/sql/enabling-query-notifications.md).","leadings":["","> "],"nodes":[{"content":"The sample code assumes that you have enabled query notifications by executing the scripts in <bpt id=\"p1\">[</bpt>Enabling Query Notifications<ept id=\"p1\">](../../../../../docs/framework/data/adonet/sql/enabling-query-notifications.md)</ept>.","pos":[9,213],"source":" The sample code assumes that you have enabled query notifications by executing the scripts in [Enabling Query Notifications](../../../../../docs/framework/data/adonet/sql/enabling-query-notifications.md)."}]},{"pos":[992,1020],"content":"About the Sample Application","linkify":"About the Sample Application","nodes":[{"content":"About the Sample Application","pos":[0,28]}]},{"content":"The sample application uses a single ASP.NET Web page to display product information from the <bpt id=\"p1\">**</bpt>AdventureWorks<ept id=\"p1\">**</ept> SQL Server database in a <ph id=\"ph1\">&lt;xref:System.Web.UI.WebControls.GridView&gt;</ph> control.","pos":[1024,1212],"source":"The sample application uses a single ASP.NET Web page to display product information from the **AdventureWorks** SQL Server database in a <xref:System.Web.UI.WebControls.GridView> control."},{"content":"When the page loads, the code writes the current time to a <ph id=\"ph1\">&lt;xref:System.Web.UI.WebControls.Label&gt;</ph> control.","pos":[1213,1319],"source":" When the page loads, the code writes the current time to a <xref:System.Web.UI.WebControls.Label> control."},{"content":"It then defines a <ph id=\"ph1\">&lt;xref:System.Web.Caching.SqlCacheDependency&gt;</ph> object and sets properties on the <ph id=\"ph2\">&lt;xref:System.Web.Caching.Cache&gt;</ph> object to store the cache data for up to three minutes.","pos":[1320,1504],"source":" It then defines a <xref:System.Web.Caching.SqlCacheDependency> object and sets properties on the <xref:System.Web.Caching.Cache> object to store the cache data for up to three minutes."},{"content":"The code then connects to the database and retrieves the data.","pos":[1505,1567]},{"content":"When the page is loaded and the application is running ASP.NET will retrieve data from the cache, which you can verify by noting that the time on the page does not change.","pos":[1568,1739]},{"content":"If the data being monitored changes, ASP.NET invalidates the cache and repopulate the <ph id=\"ph1\">`GridView`</ph> control with fresh data, updating the time displayed in the <ph id=\"ph2\">`Label`</ph> control.","pos":[1740,1913],"source":" If the data being monitored changes, ASP.NET invalidates the cache and repopulate the `GridView` control with fresh data, updating the time displayed in the `Label` control."},{"pos":[1922,1953],"content":"Creating the Sample Application","linkify":"Creating the Sample Application","nodes":[{"content":"Creating the Sample Application","pos":[0,31]}]},{"content":"Follow these steps to create and run the sample application:","pos":[1957,2017]},{"content":"Create a new ASP.NET Web site.","pos":[2027,2057]},{"content":"Add a <ph id=\"ph1\">&lt;xref:System.Web.UI.WebControls.Label&gt;</ph> and a <ph id=\"ph2\">&lt;xref:System.Web.UI.WebControls.GridView&gt;</ph> control to the Default.aspx page.","pos":[2067,2193],"source":"Add a <xref:System.Web.UI.WebControls.Label> and a <xref:System.Web.UI.WebControls.GridView> control to the Default.aspx page."},{"content":"Open the page's class module and add the following directives:","pos":[2203,2265]},{"pos":[2486,2541],"content":"Add the following code in the page's <ph id=\"ph1\">`Page_Load`</ph> event:","source":"Add the following code in the page's `Page_Load` event:"},{"pos":[2552,2879],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>DataWorks SqlDependency.AspNet#1<ept id=\"p2\">](../../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlDependency.AspNet/CS/Default.aspx.cs#1)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>DataWorks SqlDependency.AspNet#1<ept id=\"p4\">](../../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlDependency.AspNet/VB/Default.aspx.vb#1)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[DataWorks SqlDependency.AspNet#1](../../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlDependency.AspNet/CS/Default.aspx.cs#1)]\n [!code-vb[DataWorks SqlDependency.AspNet#1](../../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlDependency.AspNet/VB/Default.aspx.vb#1)]"},{"content":"Add two helper methods, <ph id=\"ph1\">`GetConnectionString`</ph> and <ph id=\"ph2\">`GetSQL`</ph>.","pos":[2889,2948],"source":"Add two helper methods, `GetConnectionString` and `GetSQL`."},{"content":"The connection string defined uses integrated security.","pos":[2949,3004]},{"content":"You will need to verify that the account you are using has the necessary database permissions and that the sample database, <bpt id=\"p1\">**</bpt>AdventureWorks<ept id=\"p1\">**</ept>, has notifications enabled.","pos":[3005,3175],"source":" You will need to verify that the account you are using has the necessary database permissions and that the sample database, **AdventureWorks**, has notifications enabled."},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Special Considerations When Using Query Notifications<ept id=\"p1\">](http://msdn.microsoft.com/en-us/a83c8dc8-4fb9-4ffd-a2a5-c07cf4a203c7)</ept>.","pos":[3176,3328],"source":" For more information, see [Special Considerations When Using Query Notifications](http://msdn.microsoft.com/en-us/a83c8dc8-4fb9-4ffd-a2a5-c07cf4a203c7)."},{"pos":[3339,3666],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>DataWorks SqlDependency.AspNet#2<ept id=\"p2\">](../../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlDependency.AspNet/CS/Default.aspx.cs#2)</ept><ept id=\"p1\">]</ept>  <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>DataWorks SqlDependency.AspNet#2<ept id=\"p4\">](../../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlDependency.AspNet/VB/Default.aspx.vb#2)</ept><ept id=\"p3\">]</ept>","leadings":["","    "],"source":"[!code-csharp[DataWorks SqlDependency.AspNet#2](../../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlDependency.AspNet/CS/Default.aspx.cs#2)]\n [!code-vb[DataWorks SqlDependency.AspNet#2](../../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlDependency.AspNet/VB/Default.aspx.vb#2)]"},{"pos":[3676,3699],"content":"Testing the Application","linkify":"Testing the Application","nodes":[{"content":"Testing the Application","pos":[0,23]}]},{"content":"The application caches the data displayed on the Web form and refreshes it every three minutes if there is no activity.","pos":[3703,3822]},{"content":"If a change occurs to the database, the cache is refreshed immediately.","pos":[3823,3894]},{"content":"Run the application from Visual Studio, which loads the page into the browser.","pos":[3895,3973]},{"content":"The cache refresh time displayed indicates when the cache was last refreshed.","pos":[3974,4051]},{"content":"Wait three minutes, and then refresh the page, causing a postback event to occur.","pos":[4052,4133]},{"content":"Note that the time displayed on the page has changed.","pos":[4134,4187]},{"content":"If you refresh the page in less than three minutes, the time displayed on the page will remain the same.","pos":[4188,4292]},{"content":"Now update the data in the database, using a Transact-SQL UPDATE command and refresh the page.","pos":[4299,4393]},{"content":"The time displayed now indicates that the cache was refreshed with the new data from the database.","pos":[4394,4492]},{"content":"Note that although the cache is updated, the time displayed on the page does not change until a postback event occurs.","pos":[4493,4611]},{"pos":[4620,4628],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>Query Notifications in SQL Server<ept id=\"p1\">](../../../../../docs/framework/data/adonet/sql/query-notifications-in-sql-server.md)</ept><ph id=\"ph1\"> </ph>","pos":[4632,4752],"source":"[Query Notifications in SQL Server](../../../../../docs/framework/data/adonet/sql/query-notifications-in-sql-server.md) "},{"content":"<bpt id=\"p1\"> [</bpt>ADO.NET Managed Providers and DataSet Developer Center<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=217917)</ept>","pos":[4755,4859],"source":" [ADO.NET Managed Providers and DataSet Developer Center](http://go.microsoft.com/fwlink/?LinkId=217917)"}]}