{"content":"---\ntitle: \"Federation Sample\"\nms.date: \"03/30/2017\"\nms.assetid: 7e9da0ca-e925-4644-aa96-8bfaf649d4bb\n---\n# Federation Sample\nThis sample demonstrates federated security.  \n  \n## Sample Details  \n Windows Communication Foundation (WCF) provides support for deploying federated security architectures through the `wsFederationHttpBinding`. The `wsFederationHttpBinding` provides a secure, reliable, and interoperable binding that involves the use of HTTP as the underlying transport mechanism for request/reply communication, and Text/XML as the wire format for encoding. For more information about Federation in WCF, see [Federation](../../../../docs/framework/wcf/feature-details/federation.md).  \n  \n The scenario is made up of 4 pieces:  \n  \n-   BookStore service  \n  \n-   BookStore STS  \n  \n-   HomeRealm STS  \n  \n-   BookStore Client  \n  \n The BookStore service supports two operations, `BrowseBooks` and `BuyBook`. It allows anonymous access to the `BrowseBooks` operation, but requires authenticated access to access the `BuyBooks` operation. The authentication takes the form of a token issued by the BookStore STS. The configuration file for the BookStore Service points clients to the BookStore STS using the `wsFederationHttpBinding`.  \n  \n```xml  \n<wsFederationHttpBinding>  \n<!-- This is the Service binding for the BuyBooks endpoint. It redirects clients to the BookStore STS -->  \n    <binding name='BuyBookBinding'>  \n        <security mode=\"Message\">  \n            <message>  \n                <issuerMetadata  \n  address='http://localhost/FederationSample/BookStoreSTS/STS.svc/mex' >  \n                    <identity>  \n                        <dns value ='BookStoreSTS.com'/>  \n                    </identity>  \n                </issuerMetadata>  \n            </message>  \n        </security>  \n    </binding>  \n</wsFederationHttpBinding>  \n```  \n  \n The BookStore STS then requires that clients authenticate using a token issued by the HomeRealm STS. Again, the configuration file for the BookStore STS points clients to the HomeRealm STS using the `wsFederationHttpBinding`.  \n  \n```xml  \n<wsFederationHttpBinding>  \n <!-- This is the binding for the clients requesting tokens from this STS. It redirects clients to the HomeRealm STS -->  \n    <binding name='BookStoreSTSBinding'>  \n        <security mode='Message'>  \n            <message>  \n                <issuerMetadata  \n address='http://localhost/FederationSample/HomeRealmSTS/STS.svc/mex' >  \n                    <identity>  \n                        <dns value ='HomeRealmSTS.com' />  \n                    </identity>  \n                </issuerMetadata>  \n            </message>  \n        </security>  \n    </binding>  \n</wsFederationHttpBinding>  \n```  \n  \n The sequence of events when accessing the `BuyBook` operation is as follows:  \n  \n1.  The client authenticates to the HomeRealm STS using Windows credentials.  \n  \n2.  The HomeRealm STS issues a token that can be used to authenticate to the BookStore STS.  \n  \n3.  The client authenticates to the BookStore STS using the token issued by the HomeRealm STS.  \n  \n4.  The BookStore STS issues a token that can be used to authenticate to the BookStore Service.  \n  \n5.  The client authenticates to the BookStore service using the token issued by the BookStore STS.  \n  \n6.  The client accesses the `BuyBook` operation.  \n  \n See the following instructions about how to set up and run this sample.  \n  \n> [!NOTE]\n>  You must have Write permissions to the **wwwroot** directory to run this sample.  \n  \n#### To set up, build, and run the sample  \n  \n1.  Open the SDK command window. In the sample path, run Setup.bat. This creates the virtual directories required for the sample and installs the required certificates with appropriate permissions.  \n  \n    > [!NOTE]\n    >  The Setup.bat batch file is designed to be run from a Windows SDK Command Prompt. It requires that the MSSDK environment variable point to the directory where the SDK is installed. This environment variable is automatically set within a Windows SDK Command Prompt. On [!INCLUDE[wv](../../../../includes/wv-md.md)], you must ensure that IIS 6.0 Management Compatibility is installed because the set up uses IIS administrator scripts. Running the set-up script on [!INCLUDE[wv](../../../../includes/wv-md.md)] requires administrator privileges.  \n  \n2.  Open FederationSample.sln in Visual Studio and select **Build Solution** from the **Build** menu. This builds the common project files, Bookstore service, Bookstore STS, HomeRealm STS, and deploys them in IIS. This also builds the Bookstore client application and places the executable BookStoreClient.exe in the FederationSample\\BookStoreClient\\bin\\Debug folder.  \n  \n3.  Double-click BookStoreClient.exe. The BookStoreClient window is displayed.  \n  \n4.  You can browse the books available in the bookstore by clicking **Browse Books**.  \n  \n5.  To purchase a particular book, select the book in the list and click **Buy Book**. The application starts up and authenticates using Windows authentication with the HomeRealm Security Token Service.  \n  \n     The sample is configured to allow users to purchase books that cost $15 or less. Attempting to buy books that cost more than $15 results in the client getting an Access Denied message from the Book Store Service.  \n  \n    > [!NOTE]\n    >  The sample does not update the user’s credit limit after a purchase. You can repeatedly purchase books within the user’s (fixed) credit limit.  \n  \n#### To clean up  \n  \n1.  Run Cleanup.bat. This deletes the virtual directories that were created during set up and also removes the certificates installed during setup.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Scenario\\Federation`  \n","nodes":[{"pos":[4,101],"embed":true,"restype":"x-metadata","content":"title: \"Federation Sample\"\nms.date: \"03/30/2017\"\nms.assetid: 7e9da0ca-e925-4644-aa96-8bfaf649d4bb","nodes":[{"content":"Federation Sample","nodes":[{"pos":[0,17],"content":"Federation Sample","nodes":[{"content":"Federation Sample","pos":[0,17]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[108,125],"content":"Federation Sample","linkify":"Federation Sample","nodes":[{"content":"Federation Sample","pos":[0,17]}]},{"content":"This sample demonstrates federated security.","pos":[126,170]},{"pos":[179,193],"content":"Sample Details","linkify":"Sample Details","nodes":[{"content":"Sample Details","pos":[0,14]}]},{"content":"Windows Communication Foundation (WCF) provides support for deploying federated security architectures through the <ph id=\"ph1\">`wsFederationHttpBinding`</ph>.","pos":[197,338],"source":"Windows Communication Foundation (WCF) provides support for deploying federated security architectures through the `wsFederationHttpBinding`."},{"content":"The <ph id=\"ph1\">`wsFederationHttpBinding`</ph> provides a secure, reliable, and interoperable binding that involves the use of HTTP as the underlying transport mechanism for request/reply communication, and Text/XML as the wire format for encoding.","pos":[339,570],"source":" The `wsFederationHttpBinding` provides a secure, reliable, and interoperable binding that involves the use of HTTP as the underlying transport mechanism for request/reply communication, and Text/XML as the wire format for encoding."},{"content":"For more information about Federation in WCF, see <bpt id=\"p1\">[</bpt>Federation<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/federation.md)</ept>.","pos":[571,696],"source":" For more information about Federation in WCF, see [Federation](../../../../docs/framework/wcf/feature-details/federation.md)."},{"content":"The scenario is made up of 4 pieces:","pos":[703,739]},{"content":"BookStore service","pos":[749,766]},{"content":"BookStore STS","pos":[776,789]},{"content":"HomeRealm STS","pos":[799,812]},{"content":"BookStore Client","pos":[822,838]},{"content":"The BookStore service supports two operations, <ph id=\"ph1\">`BrowseBooks`</ph> and <ph id=\"ph2\">`BuyBook`</ph>.","pos":[845,920],"source":"The BookStore service supports two operations, `BrowseBooks` and `BuyBook`."},{"content":"It allows anonymous access to the <ph id=\"ph1\">`BrowseBooks`</ph> operation, but requires authenticated access to access the <ph id=\"ph2\">`BuyBooks`</ph> operation.","pos":[921,1049],"source":" It allows anonymous access to the `BrowseBooks` operation, but requires authenticated access to access the `BuyBooks` operation."},{"content":"The authentication takes the form of a token issued by the BookStore STS.","pos":[1050,1123]},{"content":"The configuration file for the BookStore Service points clients to the BookStore STS using the <ph id=\"ph1\">`wsFederationHttpBinding`</ph>.","pos":[1124,1245],"source":" The configuration file for the BookStore Service points clients to the BookStore STS using the `wsFederationHttpBinding`."},{"content":"The BookStore STS then requires that clients authenticate using a token issued by the HomeRealm STS.","pos":[1868,1968]},{"content":"Again, the configuration file for the BookStore STS points clients to the HomeRealm STS using the <ph id=\"ph1\">`wsFederationHttpBinding`</ph>.","pos":[1969,2093],"source":" Again, the configuration file for the BookStore STS points clients to the HomeRealm STS using the `wsFederationHttpBinding`."},{"pos":[2736,2812],"content":"The sequence of events when accessing the <ph id=\"ph1\">`BuyBook`</ph> operation is as follows:","source":"The sequence of events when accessing the `BuyBook` operation is as follows:"},{"content":"The client authenticates to the HomeRealm STS using Windows credentials.","pos":[2822,2894]},{"content":"The HomeRealm STS issues a token that can be used to authenticate to the BookStore STS.","pos":[2904,2991]},{"content":"The client authenticates to the BookStore STS using the token issued by the HomeRealm STS.","pos":[3001,3091]},{"content":"The BookStore STS issues a token that can be used to authenticate to the BookStore Service.","pos":[3101,3192]},{"content":"The client authenticates to the BookStore service using the token issued by the BookStore STS.","pos":[3202,3296]},{"pos":[3306,3350],"content":"The client accesses the <ph id=\"ph1\">`BuyBook`</ph> operation.","source":"The client accesses the `BuyBook` operation."},{"content":"See the following instructions about how to set up and run this sample.","pos":[3357,3428]},{"pos":[3436,3527],"content":"[!NOTE]\n You must have Write permissions to the **wwwroot** directory to run this sample.","leadings":["","> "],"nodes":[{"content":"You must have Write permissions to the <bpt id=\"p1\">**</bpt>wwwroot<ept id=\"p1\">**</ept> directory to run this sample.","pos":[9,89],"source":"You must have Write permissions to the **wwwroot** directory to run this sample."}]},{"pos":[3538,3574],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"content":"Open the SDK command window.","pos":[3584,3612]},{"content":"In the sample path, run Setup.bat.","pos":[3613,3647]},{"content":"This creates the virtual directories required for the sample and installs the required certificates with appropriate permissions.","pos":[3648,3777]},{"pos":[3789,4346],"content":"[!NOTE]\nThe Setup.bat batch file is designed to be run from a Windows SDK Command Prompt. It requires that the MSSDK environment variable point to the directory where the SDK is installed. This environment variable is automatically set within a Windows SDK Command Prompt. On [!INCLUDE[wv](../../../../includes/wv-md.md)], you must ensure that IIS 6.0 Management Compatibility is installed because the set up uses IIS administrator scripts. Running the set-up script on [!INCLUDE[wv](../../../../includes/wv-md.md)] requires administrator privileges.","leadings":["","    >  "],"nodes":[{"content":"The Setup.bat batch file is designed to be run from a Windows SDK Command Prompt. It requires that the MSSDK environment variable point to the directory where the SDK is installed. This environment variable is automatically set within a Windows SDK Command Prompt. On [!INCLUDE[wv](../../../../includes/wv-md.md)], you must ensure that IIS 6.0 Management Compatibility is installed because the set up uses IIS administrator scripts. Running the set-up script on [!INCLUDE[wv](../../../../includes/wv-md.md)] requires administrator privileges.","pos":[8,550],"nodes":[{"content":"The Setup.bat batch file is designed to be run from a Windows SDK Command Prompt.","pos":[0,81]},{"content":"It requires that the MSSDK environment variable point to the directory where the SDK is installed.","pos":[82,180]},{"content":"This environment variable is automatically set within a Windows SDK Command Prompt.","pos":[181,264]},{"content":"On <ph id=\"ph1\">[!INCLUDE[wv](../../../../includes/wv-md.md)]</ph>, you must ensure that IIS 6.0 Management Compatibility is installed because the set up uses IIS administrator scripts.","pos":[265,432],"source":" On [!INCLUDE[wv](../../../../includes/wv-md.md)], you must ensure that IIS 6.0 Management Compatibility is installed because the set up uses IIS administrator scripts."},{"content":"Running the set-up script on <ph id=\"ph1\">[!INCLUDE[wv](../../../../includes/wv-md.md)]</ph> requires administrator privileges.","pos":[433,542],"source":" Running the set-up script on [!INCLUDE[wv](../../../../includes/wv-md.md)] requires administrator privileges."}]}]},{"content":"Open FederationSample.sln in Visual Studio and select <bpt id=\"p1\">**</bpt>Build Solution<ept id=\"p1\">**</ept> from the <bpt id=\"p2\">**</bpt>Build<ept id=\"p2\">**</ept> menu.","pos":[4356,4453],"source":"Open FederationSample.sln in Visual Studio and select **Build Solution** from the **Build** menu."},{"content":"This builds the common project files, Bookstore service, Bookstore STS, HomeRealm STS, and deploys them in IIS.","pos":[4454,4565]},{"content":"This also builds the Bookstore client application and places the executable BookStoreClient.exe in the FederationSample\\BookStoreClient\\bin\\Debug folder.","pos":[4566,4719]},{"content":"Double-click BookStoreClient.exe.","pos":[4729,4762]},{"content":"The BookStoreClient window is displayed.","pos":[4763,4803]},{"pos":[4813,4894],"content":"You can browse the books available in the bookstore by clicking <bpt id=\"p1\">**</bpt>Browse Books<ept id=\"p1\">**</ept>.","source":"You can browse the books available in the bookstore by clicking **Browse Books**."},{"content":"To purchase a particular book, select the book in the list and click <bpt id=\"p1\">**</bpt>Buy Book<ept id=\"p1\">**</ept>.","pos":[4904,4986],"source":"To purchase a particular book, select the book in the list and click **Buy Book**."},{"content":"The application starts up and authenticates using Windows authentication with the HomeRealm Security Token Service.","pos":[4987,5102]},{"content":"The sample is configured to allow users to purchase books that cost $15 or less.","pos":[5113,5193]},{"content":"Attempting to buy books that cost more than $15 results in the client getting an Access Denied message from the Book Store Service.","pos":[5194,5325]},{"pos":[5337,5494],"content":"[!NOTE]\nThe sample does not update the user’s credit limit after a purchase. You can repeatedly purchase books within the user’s (fixed) credit limit.","leadings":["","    >  "],"nodes":[{"content":"The sample does not update the user’s credit limit after a purchase. You can repeatedly purchase books within the user’s (fixed) credit limit.","pos":[8,150],"nodes":[{"content":"The sample does not update the user’s credit limit after a purchase.","pos":[0,68]},{"content":"You can repeatedly purchase books within the user’s (fixed) credit limit.","pos":[69,142]}]}]},{"pos":[5505,5516],"content":"To clean up","linkify":"To clean up","nodes":[{"content":"To clean up","pos":[0,11]}]},{"content":"Run Cleanup.bat.","pos":[5526,5542]},{"content":"This deletes the virtual directories that were created during set up and also removes the certificates installed during setup.","pos":[5543,5669]},{"pos":[5677,5809],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[14,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[0,53]},{"content":"Check for the following (default) directory before continuing.","pos":[54,116]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[5863,6173],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[6174,6224]}]}