{"content":"---\ntitle: \"Transacted Queues | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: b1b011dd-5e0b-482c-9bb0-9d8727038f14\ncaps.latest.revision: 9\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Transacted Queues\nThis sample shows how to integrate queues and transactions in [!INCLUDE[wf](../../../../includes/wf-md.md)] to create reliable and scalable services. A <!--zz <xref:System.Activities.TransactionScope>--> `System.Activities.TransactionScope` is used in the client workflow to send message to a queue under a transaction using the <xref:System.ServiceModel.NetMsmqBinding>. A <xref:System.ServiceModel.Activities.TransactedReceiveScope> is used on the server to receive messages from the queue and update the state of the workflow under the same transaction.  \n  \n## Demonstrates  \n <xref:System.Activities.Statements.TransactionScope>, <xref:System.ServiceModel.Activities.TransactedReceiveScope>, <xref:System.ServiceModel.NetMsmqBinding>, <xref:System.ServiceModel.Activities.Receive>, and content-based correlation.  \n  \n## Discussion  \n To demonstrate the features covered in this sample, a `RewardsPoints` workflow service is created, which keeps track of the points earned and used for a given account. The client uses <xref:System.Activities.WorkflowInvoker> to simulate posting various requests to the queue. To post a message to the queue under a transaction, the <xref:System.ServiceModel.Activities.Send> activity can be placed inside the <xref:System.Activities.Statements.TransactionScope.Body%2A> of a <xref:System.Activities.Statements.TransactionScope>. In this sample, the client runs first, followed by the server, to demonstrate how queued messages can decouple the client and server applications.  \n  \n Once the client completes, the service is configured and hosted. As soon as it opens, it starts processing the messages that have already been placed in the queue. Each message is received and processed under the same server transaction. In this sample, the first message received is a `CreateAccount` request that creates the instance and initializes the content correlation based on the account name passed as part of the request message. To model the kind of service you might expect in the real world, the following two <xref:System.ServiceModel.Activities.TransactedReceiveScope> activities that process the `AddPoints` and `UsePoints` messages are placed in parallel branches within a `while` loop so that they can process these messages repeatedly in any order.  \n  \n <xref:System.Activities.Statements.TransactionScope> and <xref:System.ServiceModel.Activities.TransactedReceiveScope> each have an implicit persistence point at the end of their scopes, so using these activities in [!INCLUDE[wf1](../../../../includes/wf1-md.md)] combined with queues is a reliable way to move your workflow from one consistent state to the next, while ensuring that messages are never lost.  \n  \n#### To set up, build, and run the sample  \n  \n1.  Install and configure MSMQ. See [Installing Message Queuing](http://go.microsoft.com/fwlink/?LinkId=178526) for details.  \n  \n2.  Ensure that MSDTC is running by executing the following command on a command line. `net start msdtc`  \n  \n3.  Compile the project and open the executable, or open the project in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] and select a start option from the debug menu. First, the queue is created, then the client runs and posts messages to the queue, and finally the service starts and the messages are processed. To exit the program, press ENTER.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Scenario\\Transactions\\TransactedQueues`","nodes":[{"pos":[12,46],"content":"Transacted Queues | Microsoft Docs","needQuote":false,"needEscape":true,"nodes":[{"content":"Transacted Queues | Microsoft Docs","pos":[0,34]}]},{"pos":[311,328],"content":"Transacted Queues","linkify":"Transacted Queues","nodes":[{"content":"Transacted Queues","pos":[0,17]}]},{"content":"This sample shows how to integrate queues and transactions in <ph id=\"ph1\">[!INCLUDE[wf](../../../../includes/wf-md.md)]</ph> to create reliable and scalable services.","pos":[329,478],"source":"This sample shows how to integrate queues and transactions in [!INCLUDE[wf](../../../../includes/wf-md.md)] to create reliable and scalable services."},{"content":"A <ph id=\"ph1\">&lt;!--zz &lt;xref:System.Activities.TransactionScope&gt;--&gt;</ph> <ph id=\"ph2\">`System.Activities.TransactionScope`</ph> is used in the client workflow to send message to a queue under a transaction using the <ph id=\"ph3\">&lt;xref:System.ServiceModel.NetMsmqBinding&gt;</ph>.","pos":[479,700],"source":" A <!--zz <xref:System.Activities.TransactionScope>--> `System.Activities.TransactionScope` is used in the client workflow to send message to a queue under a transaction using the <xref:System.ServiceModel.NetMsmqBinding>."},{"content":"A <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.TransactedReceiveScope&gt;</ph> is used on the server to receive messages from the queue and update the state of the workflow under the same transaction.","pos":[701,885],"source":" A <xref:System.ServiceModel.Activities.TransactedReceiveScope> is used on the server to receive messages from the queue and update the state of the workflow under the same transaction."},{"pos":[894,906],"content":"Demonstrates","linkify":"Demonstrates","nodes":[{"content":"Demonstrates","pos":[0,12]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Statements.TransactionScope&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.TransactedReceiveScope&gt;</ph>, <ph id=\"ph3\">&lt;xref:System.ServiceModel.NetMsmqBinding&gt;</ph>, <ph id=\"ph4\">&lt;xref:System.ServiceModel.Activities.Receive&gt;</ph>, and content-based correlation.","pos":[910,1146],"source":"<xref:System.Activities.Statements.TransactionScope>, <xref:System.ServiceModel.Activities.TransactedReceiveScope>, <xref:System.ServiceModel.NetMsmqBinding>, <xref:System.ServiceModel.Activities.Receive>, and content-based correlation."},{"pos":[1155,1165],"content":"Discussion","linkify":"Discussion","nodes":[{"content":"Discussion","pos":[0,10]}]},{"content":"To demonstrate the features covered in this sample, a <ph id=\"ph1\">`RewardsPoints`</ph> workflow service is created, which keeps track of the points earned and used for a given account.","pos":[1169,1336],"source":"To demonstrate the features covered in this sample, a `RewardsPoints` workflow service is created, which keeps track of the points earned and used for a given account."},{"content":"The client uses <ph id=\"ph1\">&lt;xref:System.Activities.WorkflowInvoker&gt;</ph> to simulate posting various requests to the queue.","pos":[1337,1444],"source":" The client uses <xref:System.Activities.WorkflowInvoker> to simulate posting various requests to the queue."},{"content":"To post a message to the queue under a transaction, the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.Send&gt;</ph> activity can be placed inside the <ph id=\"ph2\">&lt;xref:System.Activities.Statements.TransactionScope.Body%2A&gt;</ph> of a <ph id=\"ph3\">&lt;xref:System.Activities.Statements.TransactionScope&gt;</ph>.","pos":[1445,1697],"source":" To post a message to the queue under a transaction, the <xref:System.ServiceModel.Activities.Send> activity can be placed inside the <xref:System.Activities.Statements.TransactionScope.Body%2A> of a <xref:System.Activities.Statements.TransactionScope>."},{"content":"In this sample, the client runs first, followed by the server, to demonstrate how queued messages can decouple the client and server applications.","pos":[1698,1844]},{"content":"Once the client completes, the service is configured and hosted.","pos":[1851,1915]},{"content":"As soon as it opens, it starts processing the messages that have already been placed in the queue.","pos":[1916,2014]},{"content":"Each message is received and processed under the same server transaction.","pos":[2015,2088]},{"content":"In this sample, the first message received is a <ph id=\"ph1\">`CreateAccount`</ph> request that creates the instance and initializes the content correlation based on the account name passed as part of the request message.","pos":[2089,2291],"source":" In this sample, the first message received is a `CreateAccount` request that creates the instance and initializes the content correlation based on the account name passed as part of the request message."},{"content":"To model the kind of service you might expect in the real world, the following two <ph id=\"ph1\">&lt;xref:System.ServiceModel.Activities.TransactedReceiveScope&gt;</ph> activities that process the <ph id=\"ph2\">`AddPoints`</ph> and <ph id=\"ph3\">`UsePoints`</ph> messages are placed in parallel branches within a <ph id=\"ph4\">`while`</ph> loop so that they can process these messages repeatedly in any order.","pos":[2292,2619],"source":" To model the kind of service you might expect in the real world, the following two <xref:System.ServiceModel.Activities.TransactedReceiveScope> activities that process the `AddPoints` and `UsePoints` messages are placed in parallel branches within a `while` loop so that they can process these messages repeatedly in any order."},{"pos":[2626,3033],"content":"<ph id=\"ph1\">&lt;xref:System.Activities.Statements.TransactionScope&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Activities.TransactedReceiveScope&gt;</ph> each have an implicit persistence point at the end of their scopes, so using these activities in <ph id=\"ph3\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> combined with queues is a reliable way to move your workflow from one consistent state to the next, while ensuring that messages are never lost.","source":"<xref:System.Activities.Statements.TransactionScope> and <xref:System.ServiceModel.Activities.TransactedReceiveScope> each have an implicit persistence point at the end of their scopes, so using these activities in [!INCLUDE[wf1](../../../../includes/wf1-md.md)] combined with queues is a reliable way to move your workflow from one consistent state to the next, while ensuring that messages are never lost."},{"pos":[3044,3080],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"content":"Install and configure MSMQ.","pos":[3090,3117]},{"content":"See <bpt id=\"p1\">[</bpt>Installing Message Queuing<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=178526)</ept> for details.","pos":[3118,3210],"source":" See [Installing Message Queuing](http://go.microsoft.com/fwlink/?LinkId=178526) for details."},{"content":"Ensure that MSDTC is running by executing the following command on a command line.","pos":[3220,3302]},{"content":"Compile the project and open the executable, or open the project in <ph id=\"ph1\">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)]</ph> and select a start option from the debug menu.","pos":[3330,3498],"source":"Compile the project and open the executable, or open the project in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] and select a start option from the debug menu."},{"content":"First, the queue is created, then the client runs and posts messages to the queue, and finally the service starts and the messages are processed.","pos":[3499,3644]},{"content":"To exit the program, press ENTER.","pos":[3645,3678]},{"pos":[3686,3818],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":" The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[13,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[1,54]},{"content":"Check for the following (default) directory before continuing.","pos":[55,117]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[3872,4198],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[4199,4249]}]}