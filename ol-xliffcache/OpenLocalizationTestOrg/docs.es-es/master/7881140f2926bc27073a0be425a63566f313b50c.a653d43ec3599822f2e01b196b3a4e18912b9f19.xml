{"content":"---\ntitle: \"LINQ Message Query Correlation\"\nms.date: \"03/30/2017\"\nms.assetid: b746872e-57b1-4514-b337-53398a0e0deb\n---\n# LINQ Message Query Correlation\nThis sample demonstrates how to do content-based correlation using a custom <xref:System.ServiceModel.Dispatcher.MessageQuery> implementation as opposed to the system-provided <xref:System.ServiceModel.XPathMessageQuery>.  \n  \n## Demonstrates  \n Custom <xref:System.ServiceModel.Dispatcher.MessageQuery>, Content-Based Correlation.  \n  \n## Discussion  \n This sample shows how to extend from the <xref:System.ServiceModel.Dispatcher.MessageQuery> base class for the purposes of correlation. The custom implementation, `LinqMessageQuery`, allows users to provide an XName to find within the message using XLinq. The data retrieved by the query is used to form the correlation key to dispatch messages to the appropriate workflow instance.  \n  \n#### To set up, build, and run the sample  \n  \n1.  This sample exposes a workflow service using HTTP endpoints. To run this sample, proper URL ACLs must be added (see [Configuring HTTP and HTTPS](https://go.microsoft.com/fwlink/?LinkId=70353) for details), either by running Visual Studio as Administrator or by executing the following command at an elevated prompt to add the appropriate ACLs. Ensure that your Domain and Username are substituted.  \n  \n    ```  \n    netsh http add urlacl url=http://+:8000/ user=%DOMAIN%\\%UserName%  \n    ```  \n  \n2.  Once the URL ACLs are added, use the following steps.  \n  \n    1.  Build the solution.  \n  \n    2.  Set multiple start-up projects by right-clicking the solution and selecting **Set Startup Projects**. Add **Service** and **Client** (in that order) as multiple start-up projects.  \n  \n    3.  Run the application. The client console shows a workflow  sending an order and receiving the purchase order id and then subsequently confirming the order. The Service window will show the requests being processed.  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WF\\Scenario\\Services\\LinqMessageQueryCorrelation`\n","nodes":[{"pos":[4,114],"embed":true,"restype":"x-metadata","content":"title: \"LINQ Message Query Correlation\"\nms.date: \"03/30/2017\"\nms.assetid: b746872e-57b1-4514-b337-53398a0e0deb","nodes":[{"content":"LINQ Message Query Correlation","nodes":[{"pos":[0,30],"content":"LINQ Message Query Correlation","nodes":[{"content":"LINQ Message Query Correlation","pos":[0,30]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[121,151],"content":"LINQ Message Query Correlation","linkify":"LINQ Message Query Correlation","nodes":[{"content":"LINQ Message Query Correlation","pos":[0,30]}]},{"pos":[152,373],"content":"This sample demonstrates how to do content-based correlation using a custom <ph id=\"ph1\">&lt;xref:System.ServiceModel.Dispatcher.MessageQuery&gt;</ph> implementation as opposed to the system-provided <ph id=\"ph2\">&lt;xref:System.ServiceModel.XPathMessageQuery&gt;</ph>.","source":"This sample demonstrates how to do content-based correlation using a custom <xref:System.ServiceModel.Dispatcher.MessageQuery> implementation as opposed to the system-provided <xref:System.ServiceModel.XPathMessageQuery>."},{"pos":[382,394],"content":"Demonstrates","linkify":"Demonstrates","nodes":[{"content":"Demonstrates","pos":[0,12]}]},{"pos":[398,483],"content":"Custom <ph id=\"ph1\">&lt;xref:System.ServiceModel.Dispatcher.MessageQuery&gt;</ph>, Content-Based Correlation.","source":"Custom <xref:System.ServiceModel.Dispatcher.MessageQuery>, Content-Based Correlation."},{"pos":[492,502],"content":"Discussion","linkify":"Discussion","nodes":[{"content":"Discussion","pos":[0,10]}]},{"content":"This sample shows how to extend from the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Dispatcher.MessageQuery&gt;</ph> base class for the purposes of correlation.","pos":[506,641],"source":"This sample shows how to extend from the <xref:System.ServiceModel.Dispatcher.MessageQuery> base class for the purposes of correlation."},{"content":"The custom implementation, <ph id=\"ph1\">`LinqMessageQuery`</ph>, allows users to provide an XName to find within the message using XLinq.","pos":[642,761],"source":" The custom implementation, `LinqMessageQuery`, allows users to provide an XName to find within the message using XLinq."},{"content":"The data retrieved by the query is used to form the correlation key to dispatch messages to the appropriate workflow instance.","pos":[762,888]},{"pos":[899,935],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"content":"This sample exposes a workflow service using HTTP endpoints.","pos":[945,1005]},{"content":"To run this sample, proper URL ACLs must be added (see <bpt id=\"p1\">[</bpt>Configuring HTTP and HTTPS<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=70353)</ept> for details), either by running Visual Studio as Administrator or by executing the following command at an elevated prompt to add the appropriate ACLs.","pos":[1006,1288],"source":" To run this sample, proper URL ACLs must be added (see [Configuring HTTP and HTTPS](https://go.microsoft.com/fwlink/?LinkId=70353) for details), either by running Visual Studio as Administrator or by executing the following command at an elevated prompt to add the appropriate ACLs."},{"content":"Ensure that your Domain and Username are substituted.","pos":[1289,1342]},{"content":"Once the URL ACLs are added, use the following steps.","pos":[1447,1500]},{"content":"Build the solution.","pos":[1514,1533]},{"content":"Set multiple start-up projects by right-clicking the solution and selecting <bpt id=\"p1\">**</bpt>Set Startup Projects<ept id=\"p1\">**</ept>.","pos":[1547,1648],"source":"Set multiple start-up projects by right-clicking the solution and selecting **Set Startup Projects**."},{"content":"Add <bpt id=\"p1\">**</bpt>Service<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Client<ept id=\"p2\">**</ept> (in that order) as multiple start-up projects.","pos":[1649,1726],"source":" Add **Service** and **Client** (in that order) as multiple start-up projects."},{"content":"Run the application.","pos":[1740,1760]},{"content":"The client console shows a workflow  sending an order and receiving the purchase order id and then subsequently confirming the order.","pos":[1761,1894]},{"content":"The Service window will show the requests being processed.","pos":[1895,1953]},{"pos":[1961,2093],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[14,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[0,53]},{"content":"Check for the following (default) directory before continuing.","pos":[54,116]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[2147,2457],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[2458,2508]}]}