{"content":"---\ntitle: \"How to: Audit Windows Communication Foundation Security Events\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"security [WCF], auditing events\"\nms.assetid: e71e9587-3336-46a2-9a9e-d72a1743ecec\n---\n# How to: Audit Windows Communication Foundation Security Events\nWindows Communication Foundation (WCF) allows you to log security events to the Windows event log, which can be viewed using the Windows Event Viewer. This topic explains how to set up an application so that it logs security events. For more information about WCF auditing, see [Auditing](../../../../docs/framework/wcf/feature-details/auditing-security-events.md).  \n  \n### To audit security events in code  \n  \n1.  Specify the audit log location. To do this, set the <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.AuditLogLocation%2A> property of the <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior> class to one of the <xref:System.ServiceModel.AuditLogLocation> enumeration values, as shown in the following code.  \n  \n     [!code-csharp[AuditingSecurityEvents#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/auditingsecurityevents/cs/auditingsecurityevents.cs#2)]\n     [!code-vb[AuditingSecurityEvents#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/auditingsecurityevents/vb/auditingsecurityevents.vb#2)]  \n  \n     The <xref:System.ServiceModel.AuditLogLocation> enumeration has three values: `Application`, `Security`, or `Default`. The value specifies one of the logs visible in the Event Viewer, either the Security log or the Application log. If you use the `Default` value, the actual log will depend on the operating system the application is running on. If auditing is enabled and the log location is not specified, the default is the `Security` log for platforms that support writing to the Security log; otherwise, it will write to the `Application` log. Only [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)] and [!INCLUDE[wv](../../../../includes/wv-md.md)] support writing to the Security log by default.  \n  \n2.  Set up the types of events to audit. You can simultaneously audit service-level events or message-level authorization events. To do this, set the <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.ServiceAuthorizationAuditLevel%2A> property or the <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.MessageAuthenticationAuditLevel%2A> property to one of the <xref:System.ServiceModel.AuditLevel> enumeration values, as shown in the following code.  \n  \n     [!code-csharp[AuditingSecurityEvents#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/auditingsecurityevents/cs/auditingsecurityevents.cs#3)]\n     [!code-vb[AuditingSecurityEvents#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/auditingsecurityevents/vb/auditingsecurityevents.vb#3)]  \n  \n3.  Specify whether to suppress or expose failures to the application regarding log audit events. Set the <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.SuppressAuditFailure%2A> property to either `true` or `false`, as shown in the following code.  \n  \n     [!code-csharp[AuditingSecurityEvents#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/auditingsecurityevents/cs/auditingsecurityevents.cs#4)]\n     [!code-vb[AuditingSecurityEvents#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/auditingsecurityevents/vb/auditingsecurityevents.vb#4)]  \n  \n     The default `SuppressAuditFailure` property is `true`, so that the failure to audit does not affect the application. Otherwise, an exception is thrown. For any successful audit, a verbose trace is written. For any failure to audit, the trace is written at the Error level.  \n  \n4.  Delete the existing <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior> from the collection of behaviors found in the description of a <xref:System.ServiceModel.ServiceHost>. The behavior collection is accessed by the <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A> property, which in turn is accessed from the <xref:System.ServiceModel.ServiceHostBase.Description%2A> property. Then add the new <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior> to the same collection, as shown in the following code.  \n  \n     [!code-csharp[AuditingSecurityEvents#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/auditingsecurityevents/cs/auditingsecurityevents.cs#5)]\n     [!code-vb[AuditingSecurityEvents#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/auditingsecurityevents/vb/auditingsecurityevents.vb#5)]  \n  \n### To set up auditing in configuration  \n  \n1.  To set up auditing in configuration, add a [\\<behavior>](../../../../docs/framework/configure-apps/file-schema/wcf/behavior-of-endpointbehaviors.md) element to the [\\<behaviors>](../../../../docs/framework/configure-apps/file-schema/wcf/behaviors.md) section of the web.config file. Then add a [\\<serviceSecurityAudit>](../../../../docs/framework/configure-apps/file-schema/wcf/servicesecurityaudit.md) element and set the various attributes, as shown in the following example.  \n  \n    ```xml  \n    <behaviors>  \n       <behavior name=\"myAuditBehavior\">  \n          <serviceSecurityAudit auditLogLocation=\"Application\"  \n                suppressAuditFailure=\"false\"   \n                serviceAuthorizationAuditLevel=\"None\"   \n                messageAuthenticationAuditLevel=\"SuccessOrFailure\" />  \n          </behavior>  \n    </behaviors>  \n    ```  \n  \n2.  You must specify the behavior for the service, as shown in the following example.  \n  \n    ```xml  \n    <services>  \n        <service type=\"WCS.Samples.Service.Echo\"   \n        behaviorConfiguration=\" myAuditBehavior\">  \n           <endpoint address=\"\"  \n                    binding=\"wsHttpBinding\"  \n                    bindingConfiguration=\"CertificateDefault\"   \n                    contract=\"WCS.Samples.Service.IEcho\" />  \n        </service>  \n    </services>  \n    ```  \n  \n## Example  \n The following code creates an instance of the <xref:System.ServiceModel.ServiceHost> class and adds a new <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior> to its collection of behaviors.  \n  \n [!code-csharp[AuditingSecurityEvents#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/auditingsecurityevents/cs/auditingsecurityevents.cs#1)]\n [!code-vb[AuditingSecurityEvents#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/auditingsecurityevents/vb/auditingsecurityevents.vb#1)]  \n  \n## .NET Framework Security  \n Setting the <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.SuppressAuditFailure%2A> property to `true`, suppresses any failure to generate security audits (if set to `false`, an exception is thrown). However, if you enable the following Windows **Local Security Setting** property, a failure to generate audit events will cause Windows to shut down immediately:  \n  \n **Audit: Shut down system immediately if unable to log security audits**  \n  \n To set the property, open the **Local Security Settings** dialog box. Under **Security Settings**, click **Local Policies**. Then click **Security Options**.  \n  \n If the <xref:System.ServiceModel.AuditLogLocation> property is set to <xref:System.ServiceModel.AuditLogLocation.Security> and **Audit Object Access** is not set in the **Local Security Policy**, audit events will not be written to the Security log. Note that no failure is returned, but audit entries are not written to the Security log.  \n  \n## See also\n\n- <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.AuditLogLocation%2A>\n- <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior>\n- <xref:System.ServiceModel.AuditLogLocation>\n- [Auditing](../../../../docs/framework/wcf/feature-details/auditing-security-events.md)\n","nodes":[{"pos":[4,240],"embed":true,"restype":"x-metadata","content":"title: \"How to: Audit Windows Communication Foundation Security Events\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"security [WCF], auditing events\"\nms.assetid: e71e9587-3336-46a2-9a9e-d72a1743ecec","nodes":[{"content":"How to: Audit Windows Communication Foundation Security Events","nodes":[{"pos":[0,62],"content":"How to: Audit Windows Communication Foundation Security Events","nodes":[{"content":"How to: Audit Windows Communication Foundation Security Events","pos":[0,62]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[247,309],"content":"How to: Audit Windows Communication Foundation Security Events","linkify":"How to: Audit Windows Communication Foundation Security Events","nodes":[{"content":"How to: Audit Windows Communication Foundation Security Events","pos":[0,62]}]},{"content":"Windows Communication Foundation (WCF) allows you to log security events to the Windows event log, which can be viewed using the Windows Event Viewer.","pos":[310,460]},{"content":"This topic explains how to set up an application so that it logs security events.","pos":[461,542]},{"content":"For more information about WCF auditing, see <bpt id=\"p1\">[</bpt>Auditing<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/auditing-security-events.md)</ept>.","pos":[543,675],"source":" For more information about WCF auditing, see [Auditing](../../../../docs/framework/wcf/feature-details/auditing-security-events.md)."},{"pos":[685,717],"content":"To audit security events in code","linkify":"To audit security events in code","nodes":[{"content":"To audit security events in code","pos":[0,32]}]},{"content":"Specify the audit log location.","pos":[727,758]},{"content":"To do this, set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.AuditLogLocation%2A&gt;</ph> property of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior&gt;</ph> class to one of the <ph id=\"ph3\">&lt;xref:System.ServiceModel.AuditLogLocation&gt;</ph> enumeration values, as shown in the following code.","pos":[759,1066],"source":" To do this, set the <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.AuditLogLocation%2A> property of the <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior> class to one of the <xref:System.ServiceModel.AuditLogLocation> enumeration values, as shown in the following code."},{"pos":[1077,1378],"content":"[!code-csharp[AuditingSecurityEvents#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/auditingsecurityevents/cs/auditingsecurityevents.cs#2)]\n [!code-vb[AuditingSecurityEvents#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/auditingsecurityevents/vb/auditingsecurityevents.vb#2)]","leadings":["","    "],"nodes":[]},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.AuditLogLocation&gt;</ph> enumeration has three values: <ph id=\"ph2\">`Application`</ph>, <ph id=\"ph3\">`Security`</ph>, or <ph id=\"ph4\">`Default`</ph>.","pos":[1389,1507],"source":"The <xref:System.ServiceModel.AuditLogLocation> enumeration has three values: `Application`, `Security`, or `Default`."},{"content":"The value specifies one of the logs visible in the Event Viewer, either the Security log or the Application log.","pos":[1508,1620]},{"content":"If you use the <ph id=\"ph1\">`Default`</ph> value, the actual log will depend on the operating system the application is running on.","pos":[1621,1734],"source":" If you use the `Default` value, the actual log will depend on the operating system the application is running on."},{"content":"If auditing is enabled and the log location is not specified, the default is the <ph id=\"ph1\">`Security`</ph> log for platforms that support writing to the Security log; otherwise, it will write to the <ph id=\"ph2\">`Application`</ph> log.","pos":[1735,1937],"source":" If auditing is enabled and the log location is not specified, the default is the `Security` log for platforms that support writing to the Security log; otherwise, it will write to the `Application` log."},{"content":"Only <ph id=\"ph1\">[!INCLUDE[ws2003](../../../../includes/ws2003-md.md)]</ph> and <ph id=\"ph2\">[!INCLUDE[wv](../../../../includes/wv-md.md)]</ph> support writing to the Security log by default.","pos":[1938,2094],"source":" Only [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)] and [!INCLUDE[wv](../../../../includes/wv-md.md)] support writing to the Security log by default."},{"content":"Set up the types of events to audit.","pos":[2104,2140]},{"content":"You can simultaneously audit service-level events or message-level authorization events.","pos":[2141,2229]},{"content":"To do this, set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.ServiceAuthorizationAuditLevel%2A&gt;</ph> property or the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.MessageAuthenticationAuditLevel%2A&gt;</ph> property to one of the <ph id=\"ph3\">&lt;xref:System.ServiceModel.AuditLevel&gt;</ph> enumeration values, as shown in the following code.","pos":[2230,2583],"source":" To do this, set the <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.ServiceAuthorizationAuditLevel%2A> property or the <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.MessageAuthenticationAuditLevel%2A> property to one of the <xref:System.ServiceModel.AuditLevel> enumeration values, as shown in the following code."},{"pos":[2594,2895],"content":"[!code-csharp[AuditingSecurityEvents#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/auditingsecurityevents/cs/auditingsecurityevents.cs#3)]\n [!code-vb[AuditingSecurityEvents#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/auditingsecurityevents/vb/auditingsecurityevents.vb#3)]","leadings":["","    "],"nodes":[]},{"content":"Specify whether to suppress or expose failures to the application regarding log audit events.","pos":[2905,2998]},{"content":"Set the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.SuppressAuditFailure%2A&gt;</ph> property to either <ph id=\"ph2\">`true`</ph> or <ph id=\"ph3\">`false`</ph>, as shown in the following code.","pos":[2999,3168],"source":" Set the <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.SuppressAuditFailure%2A> property to either `true` or `false`, as shown in the following code."},{"pos":[3179,3480],"content":"[!code-csharp[AuditingSecurityEvents#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/auditingsecurityevents/cs/auditingsecurityevents.cs#4)]\n [!code-vb[AuditingSecurityEvents#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/auditingsecurityevents/vb/auditingsecurityevents.vb#4)]","leadings":["","    "],"nodes":[]},{"content":"The default <ph id=\"ph1\">`SuppressAuditFailure`</ph> property is <ph id=\"ph2\">`true`</ph>, so that the failure to audit does not affect the application.","pos":[3491,3607],"source":"The default `SuppressAuditFailure` property is `true`, so that the failure to audit does not affect the application."},{"content":"Otherwise, an exception is thrown.","pos":[3608,3642]},{"content":"For any successful audit, a verbose trace is written.","pos":[3643,3696]},{"content":"For any failure to audit, the trace is written at the Error level.","pos":[3697,3763]},{"content":"Delete the existing <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior&gt;</ph> from the collection of behaviors found in the description of a <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph>.","pos":[3773,3963],"source":"Delete the existing <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior> from the collection of behaviors found in the description of a <xref:System.ServiceModel.ServiceHost>."},{"content":"The behavior collection is accessed by the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A&gt;</ph> property, which in turn is accessed from the <ph id=\"ph2\">&lt;xref:System.ServiceModel.ServiceHostBase.Description%2A&gt;</ph> property.","pos":[3964,4190],"source":" The behavior collection is accessed by the <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A> property, which in turn is accessed from the <xref:System.ServiceModel.ServiceHostBase.Description%2A> property."},{"content":"Then add the new <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior&gt;</ph> to the same collection, as shown in the following code.","pos":[4191,4331],"source":" Then add the new <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior> to the same collection, as shown in the following code."},{"pos":[4342,4643],"content":"[!code-csharp[AuditingSecurityEvents#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/auditingsecurityevents/cs/auditingsecurityevents.cs#5)]\n [!code-vb[AuditingSecurityEvents#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/auditingsecurityevents/vb/auditingsecurityevents.vb#5)]","leadings":["","    "],"nodes":[]},{"pos":[4653,4688],"content":"To set up auditing in configuration","linkify":"To set up auditing in configuration","nodes":[{"content":"To set up auditing in configuration","pos":[0,35]}]},{"content":"To set up auditing in configuration, add a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>behavior&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/behavior-of-endpointbehaviors.md)</ept> element to the <bpt id=\"p2\">[</bpt><ph id=\"ph2\">\\&lt;</ph>behaviors&gt;<ept id=\"p2\">](../../../../docs/framework/configure-apps/file-schema/wcf/behaviors.md)</ept> section of the web.config file.","pos":[4698,4980],"source":"To set up auditing in configuration, add a [\\<behavior>](../../../../docs/framework/configure-apps/file-schema/wcf/behavior-of-endpointbehaviors.md) element to the [\\<behaviors>](../../../../docs/framework/configure-apps/file-schema/wcf/behaviors.md) section of the web.config file."},{"content":"Then add a <bpt id=\"p1\">[</bpt><ph id=\"ph1\">\\&lt;</ph>serviceSecurityAudit&gt;<ept id=\"p1\">](../../../../docs/framework/configure-apps/file-schema/wcf/servicesecurityaudit.md)</ept> element and set the various attributes, as shown in the following example.","pos":[4981,5175],"source":" Then add a [\\<serviceSecurityAudit>](../../../../docs/framework/configure-apps/file-schema/wcf/servicesecurityaudit.md) element and set the various attributes, as shown in the following example."},{"content":"You must specify the behavior for the service, as shown in the following example.","pos":[5557,5638]},{"pos":[6040,6047],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"pos":[6051,6256],"content":"The following code creates an instance of the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ServiceHost&gt;</ph> class and adds a new <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior&gt;</ph> to its collection of behaviors.","source":"The following code creates an instance of the <xref:System.ServiceModel.ServiceHost> class and adds a new <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior> to its collection of behaviors."},{"pos":[6569,6592],"content":".NET Framework Security","linkify":".NET Framework Security","nodes":[{"content":".NET Framework Security","pos":[0,23]}]},{"content":"Setting the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.SuppressAuditFailure%2A&gt;</ph> property to <ph id=\"ph2\">`true`</ph>, suppresses any failure to generate security audits (if set to <ph id=\"ph3\">`false`</ph>, an exception is thrown).","pos":[6596,6815],"source":"Setting the <xref:System.ServiceModel.Description.ServiceSecurityAuditBehavior.SuppressAuditFailure%2A> property to `true`, suppresses any failure to generate security audits (if set to `false`, an exception is thrown)."},{"content":"However, if you enable the following Windows <bpt id=\"p1\">**</bpt>Local Security Setting<ept id=\"p1\">**</ept> property, a failure to generate audit events will cause Windows to shut down immediately:","pos":[6816,6977],"source":" However, if you enable the following Windows **Local Security Setting** property, a failure to generate audit events will cause Windows to shut down immediately:"},{"pos":[6984,7056],"content":"<bpt id=\"p1\">**</bpt>Audit: Shut down system immediately if unable to log security audits<ept id=\"p1\">**</ept>","source":"**Audit: Shut down system immediately if unable to log security audits**"},{"content":"To set the property, open the <bpt id=\"p1\">**</bpt>Local Security Settings<ept id=\"p1\">**</ept> dialog box.","pos":[7063,7132],"source":"To set the property, open the **Local Security Settings** dialog box."},{"content":"Under <bpt id=\"p1\">**</bpt>Security Settings<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Local Policies<ept id=\"p2\">**</ept>.","pos":[7133,7187],"source":" Under **Security Settings**, click **Local Policies**."},{"content":"Then click <bpt id=\"p1\">**</bpt>Security Options<ept id=\"p1\">**</ept>.","pos":[7188,7220],"source":" Then click **Security Options**."},{"content":"If the <ph id=\"ph1\">&lt;xref:System.ServiceModel.AuditLogLocation&gt;</ph> property is set to <ph id=\"ph2\">&lt;xref:System.ServiceModel.AuditLogLocation.Security&gt;</ph> and <bpt id=\"p1\">**</bpt>Audit Object Access<ept id=\"p1\">**</ept> is not set in the <bpt id=\"p2\">**</bpt>Local Security Policy<ept id=\"p2\">**</ept>, audit events will not be written to the Security log.","pos":[7227,7476],"source":"If the <xref:System.ServiceModel.AuditLogLocation> property is set to <xref:System.ServiceModel.AuditLogLocation.Security> and **Audit Object Access** is not set in the **Local Security Policy**, audit events will not be written to the Security log."},{"content":"Note that no failure is returned, but audit entries are not written to the Security log.","pos":[7477,7565]},{"pos":[7574,7582],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[7792,7878],"content":"<bpt id=\"p1\">[</bpt>Auditing<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/auditing-security-events.md)</ept>","source":"[Auditing](../../../../docs/framework/wcf/feature-details/auditing-security-events.md)"}]}