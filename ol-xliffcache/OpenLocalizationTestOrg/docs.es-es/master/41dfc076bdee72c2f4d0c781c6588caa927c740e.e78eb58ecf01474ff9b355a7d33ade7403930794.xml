{"content":"---\ntitle: \"Instance Activation\"\nms.date: \"03/30/2017\"\nms.assetid: 134c3f70-5d4e-46d0-9d49-469a6643edd8\n---\n# Instance Activation\nThe SQL Workflow Instance Store runs an internal task that periodically wakes up and detects runnable or activatable workflow instances in the persistence database. If it finds a runnable workflow instance, it notifies the workflow host that is capable of activating the instance. If the instance store finds an activatable workflow instance, it notifies a generic host that activates a workflow host, which in turn runs the workflow instance. The following sections in this topic explain the instance activation process in detail.  \n  \n## <a name=\"RunnableSection\"></a> Detecting and Activating Runnable Workflow Instances  \n The SQL Workflow Instance Store considers a workflow instance *runnable* if the instance is not in the suspended state or the completed state and satisfies the following conditions:  \n  \n-   The instance is unlocked and has a pending timer that has expired.  \n  \n-   The instance has an expired lock on it.  \n  \n-   The instance is unlocked and its status is **Executing**.  \n  \n The SQL Workflow Instance Store raises the <xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent> when it finds a runnable instance. After this, the SqlWorkflowInstanceStore stops monitoring until the <xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand> is called once on the store.  \n  \n A workflow host that has subscribed for the <xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent> and capable of loading the instance executes the <xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand> against the instance store to load the instance into memory. A workflow host is considered capable of loading a workflow instance if the host and the instance have metadata property **WorkflowServiceType** set to the same value.  \n  \n## Detecting and Activating Activatable Workflow Instances  \n A workflow instance is considered *activatable* if the instance is runnable and there is no workflow host that is capable of loading the instance is running on the computer. See Detecting and Activating Runnable Workflow Instances above for the definition of a runnable workflow instance.  \n  \n The SQL Workflow Instance Store raises the <xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent> when it finds an activatable workflow instance in the database. After this, the SqlWorkflowInstanceStore stops monitoring until the <xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand> is called once on the store.  \n  \n When a generic host that has subscribed for the <xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent> receives the event, it executes the <xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand> against the instance store to obtain activation parameters required to create a workflow host. The generic host uses these activation parameters to create a workflow host, which in turn loads and runs the runnable service instance.  \n  \n## Generic Hosts  \n A generic host is a host with the value of the metadata property **WorkflowServiceType** for generic hosts is set to **WorkflowServiceType.Any** to indicate that it can handle any workflow type. A generic host has an XName parameter named **ActivationType**.  \n  \n Currently, the SQL Workflow Instance Store supports generic hosts with value of the ActivationType parameter set to **WAS**. If the ActivationType is not set to WAS, the SQL Workflow Instance Store throws an <xref:System.Runtime.DurableInstancing.InstancePersistenceException>. The Workflow Management Service that ships with the [!INCLUDE[dublin](../../../includes/dublin-md.md)] is a generic host that has the activation type set to **WAS**.  \n  \n For WAS activation, a generic host requires a set of activation parameters to derive the endpoint address at which new hosts can be activated. The activation parameters for WAS activation are name of the site, path to the application relative to the site, and path to the service relative to the application. The SQL Workflow Instance Store stores these activation parameters during the execution of the <xref:System.Activities.DurableInstancing.SaveWorkflowCommand>.  \n  \n## Runnable Instances Detection Period  \n The **Runnable Instances Detection Period** property of the SQL Workflow Instance Store specifies the time period after which the SQL Workflow Instance Store runs a detection task to detect any runnable or activatable workflow instances in the persistence database after the previous detection cycle. See [Runnable Instances Detection Period](runnable-instances-detection-period.md) for more details on this property.\n","nodes":[{"pos":[4,103],"embed":true,"restype":"x-metadata","content":"title: \"Instance Activation\"\nms.date: \"03/30/2017\"\nms.assetid: 134c3f70-5d4e-46d0-9d49-469a6643edd8","nodes":[{"content":"Instance Activation","nodes":[{"pos":[0,19],"content":"Instance Activation","nodes":[{"content":"Instance Activation","pos":[0,19]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[110,129],"content":"Instance Activation","linkify":"Instance Activation","nodes":[{"content":"Instance Activation","pos":[0,19]}]},{"content":"The SQL Workflow Instance Store runs an internal task that periodically wakes up and detects runnable or activatable workflow instances in the persistence database.","pos":[130,294]},{"content":"If it finds a runnable workflow instance, it notifies the workflow host that is capable of activating the instance.","pos":[295,410]},{"content":"If the instance store finds an activatable workflow instance, it notifies a generic host that activates a workflow host, which in turn runs the workflow instance.","pos":[411,573]},{"content":"The following sections in this topic explain the instance activation process in detail.","pos":[574,661]},{"pos":[670,753],"content":"<bpt id=\"p1\">&lt;a name=\"RunnableSection\"&gt;</bpt><ept id=\"p1\">&lt;/a&gt;</ept> Detecting and Activating Runnable Workflow Instances","linkify":"<a name=\"RunnableSection\"></a> Detecting and Activating Runnable Workflow Instances","source":"<a name=\"RunnableSection\"></a> Detecting and Activating Runnable Workflow Instances"},{"pos":[757,938],"content":"The SQL Workflow Instance Store considers a workflow instance <bpt id=\"p1\">*</bpt>runnable<ept id=\"p1\">*</ept> if the instance is not in the suspended state or the completed state and satisfies the following conditions:","source":"The SQL Workflow Instance Store considers a workflow instance *runnable* if the instance is not in the suspended state or the completed state and satisfies the following conditions:"},{"content":"The instance is unlocked and has a pending timer that has expired.","pos":[948,1014]},{"content":"The instance has an expired lock on it.","pos":[1024,1063]},{"pos":[1073,1130],"content":"The instance is unlocked and its status is <bpt id=\"p1\">**</bpt>Executing<ept id=\"p1\">**</ept>.","source":"The instance is unlocked and its status is **Executing**."},{"content":"The SQL Workflow Instance Store raises the <ph id=\"ph1\">&lt;xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent&gt;</ph> when it finds a runnable instance.","pos":[1137,1282],"source":"The SQL Workflow Instance Store raises the <xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent> when it finds a runnable instance."},{"content":"After this, the SqlWorkflowInstanceStore stops monitoring until the <ph id=\"ph1\">&lt;xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand&gt;</ph> is called once on the store.","pos":[1283,1453],"source":" After this, the SqlWorkflowInstanceStore stops monitoring until the <xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand> is called once on the store."},{"content":"A workflow host that has subscribed for the <ph id=\"ph1\">&lt;xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent&gt;</ph> and capable of loading the instance executes the <ph id=\"ph2\">&lt;xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand&gt;</ph> against the instance store to load the instance into memory.","pos":[1460,1755],"source":"A workflow host that has subscribed for the <xref:System.Activities.DurableInstancing.HasRunnableWorkflowEvent> and capable of loading the instance executes the <xref:System.Activities.DurableInstancing.TryLoadRunnableWorkflowCommand> against the instance store to load the instance into memory."},{"content":"A workflow host is considered capable of loading a workflow instance if the host and the instance have metadata property <bpt id=\"p1\">**</bpt>WorkflowServiceType<ept id=\"p1\">**</ept> set to the same value.","pos":[1756,1923],"source":" A workflow host is considered capable of loading a workflow instance if the host and the instance have metadata property **WorkflowServiceType** set to the same value."},{"pos":[1932,1987],"content":"Detecting and Activating Activatable Workflow Instances","linkify":"Detecting and Activating Activatable Workflow Instances","nodes":[{"content":"Detecting and Activating Activatable Workflow Instances","pos":[0,55]}]},{"content":"A workflow instance is considered <bpt id=\"p1\">*</bpt>activatable<ept id=\"p1\">*</ept> if the instance is runnable and there is no workflow host that is capable of loading the instance is running on the computer.","pos":[1991,2164],"source":"A workflow instance is considered *activatable* if the instance is runnable and there is no workflow host that is capable of loading the instance is running on the computer."},{"content":"See Detecting and Activating Runnable Workflow Instances above for the definition of a runnable workflow instance.","pos":[2165,2279]},{"content":"The SQL Workflow Instance Store raises the <ph id=\"ph1\">&lt;xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent&gt;</ph> when it finds an activatable workflow instance in the database.","pos":[2286,2463],"source":"The SQL Workflow Instance Store raises the <xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent> when it finds an activatable workflow instance in the database."},{"content":"After this, the SqlWorkflowInstanceStore stops monitoring until the <ph id=\"ph1\">&lt;xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand&gt;</ph> is called once on the store.","pos":[2464,2636],"source":" After this, the SqlWorkflowInstanceStore stops monitoring until the <xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand> is called once on the store."},{"content":"When a generic host that has subscribed for the <ph id=\"ph1\">&lt;xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent&gt;</ph> receives the event, it executes the <ph id=\"ph2\">&lt;xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand&gt;</ph> against the instance store to obtain activation parameters required to create a workflow host.","pos":[2643,2968],"source":"When a generic host that has subscribed for the <xref:System.Activities.DurableInstancing.HasActivatableWorkflowEvent> receives the event, it executes the <xref:System.Activities.DurableInstancing.QueryActivatableWorkflowsCommand> against the instance store to obtain activation parameters required to create a workflow host."},{"content":"The generic host uses these activation parameters to create a workflow host, which in turn loads and runs the runnable service instance.","pos":[2969,3105]},{"pos":[3114,3127],"content":"Generic Hosts","linkify":"Generic Hosts","nodes":[{"content":"Generic Hosts","pos":[0,13]}]},{"content":"A generic host is a host with the value of the metadata property <bpt id=\"p1\">**</bpt>WorkflowServiceType<ept id=\"p1\">**</ept> for generic hosts is set to <bpt id=\"p2\">**</bpt>WorkflowServiceType.Any<ept id=\"p2\">**</ept> to indicate that it can handle any workflow type.","pos":[3131,3325],"source":"A generic host is a host with the value of the metadata property **WorkflowServiceType** for generic hosts is set to **WorkflowServiceType.Any** to indicate that it can handle any workflow type."},{"content":"A generic host has an XName parameter named <bpt id=\"p1\">**</bpt>ActivationType<ept id=\"p1\">**</ept>.","pos":[3326,3389],"source":" A generic host has an XName parameter named **ActivationType**."},{"content":"Currently, the SQL Workflow Instance Store supports generic hosts with value of the ActivationType parameter set to <bpt id=\"p1\">**</bpt>WAS<ept id=\"p1\">**</ept>.","pos":[3396,3520],"source":"Currently, the SQL Workflow Instance Store supports generic hosts with value of the ActivationType parameter set to **WAS**."},{"content":"If the ActivationType is not set to WAS, the SQL Workflow Instance Store throws an <ph id=\"ph1\">&lt;xref:System.Runtime.DurableInstancing.InstancePersistenceException&gt;</ph>.","pos":[3521,3673],"source":" If the ActivationType is not set to WAS, the SQL Workflow Instance Store throws an <xref:System.Runtime.DurableInstancing.InstancePersistenceException>."},{"content":"The Workflow Management Service that ships with the <ph id=\"ph1\">[!INCLUDE[dublin](../../../includes/dublin-md.md)]</ph> is a generic host that has the activation type set to <bpt id=\"p1\">**</bpt>WAS<ept id=\"p1\">**</ept>.","pos":[3674,3839],"source":" The Workflow Management Service that ships with the [!INCLUDE[dublin](../../../includes/dublin-md.md)] is a generic host that has the activation type set to **WAS**."},{"content":"For WAS activation, a generic host requires a set of activation parameters to derive the endpoint address at which new hosts can be activated.","pos":[3846,3988]},{"content":"The activation parameters for WAS activation are name of the site, path to the application relative to the site, and path to the service relative to the application.","pos":[3989,4154]},{"content":"The SQL Workflow Instance Store stores these activation parameters during the execution of the <ph id=\"ph1\">&lt;xref:System.Activities.DurableInstancing.SaveWorkflowCommand&gt;</ph>.","pos":[4155,4313],"source":" The SQL Workflow Instance Store stores these activation parameters during the execution of the <xref:System.Activities.DurableInstancing.SaveWorkflowCommand>."},{"pos":[4322,4357],"content":"Runnable Instances Detection Period","linkify":"Runnable Instances Detection Period","nodes":[{"content":"Runnable Instances Detection Period","pos":[0,35]}]},{"content":"The <bpt id=\"p1\">**</bpt>Runnable Instances Detection Period<ept id=\"p1\">**</ept> property of the SQL Workflow Instance Store specifies the time period after which the SQL Workflow Instance Store runs a detection task to detect any runnable or activatable workflow instances in the persistence database after the previous detection cycle.","pos":[4361,4661],"source":"The **Runnable Instances Detection Period** property of the SQL Workflow Instance Store specifies the time period after which the SQL Workflow Instance Store runs a detection task to detect any runnable or activatable workflow instances in the persistence database after the previous detection cycle."},{"content":"See <bpt id=\"p1\">[</bpt>Runnable Instances Detection Period<ept id=\"p1\">](runnable-instances-detection-period.md)</ept> for more details on this property.","pos":[4662,4778],"source":" See [Runnable Instances Detection Period](runnable-instances-detection-period.md) for more details on this property."}]}