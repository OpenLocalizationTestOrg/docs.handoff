{"content":"---\ntitle: \"How to: Render on a Per Frame Interval Using CompositionTarget\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"CompositionTarget objects [WPF], rendering per frame\"\n  - \"rendering per frame using CompositionTarget objects [WPF]\"\nms.assetid: 701246cd-66b7-4d69-ada9-17b3b433d95d\n---\n# How to: Render on a Per Frame Interval Using CompositionTarget\nThe [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] animation engine provides many features for creating frame-based animation. However, there are application scenarios in which you need finer-grained control over rendering on a per frame basis. The <xref:System.Windows.Media.CompositionTarget> object provides the ability to create custom animations based on a per-frame callback.  \n  \n <xref:System.Windows.Media.CompositionTarget> is a static class which represents the display surface on which your application is being drawn. The <xref:System.Windows.Media.CompositionTarget.Rendering> event is raised each time the application's scene is drawn. The rendering frame rate is the number of times the scene is drawn per second.  \n  \n> [!NOTE]\n>  For a complete code sample using <xref:System.Windows.Media.CompositionTarget>, see [Using the CompositionTarget Sample](https://go.microsoft.com/fwlink/?LinkID=160045).  \n  \n## Example  \n The <xref:System.Windows.Media.CompositionTarget.Rendering> event fires during the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] rendering process. The following example shows how you register an <xref:System.EventHandler> delegate to the static <xref:System.Windows.Media.CompositionTarget.Rendering> method on <xref:System.Windows.Media.CompositionTarget>.  \n  \n [!code-csharp[CompositionTargetSample#CompositionTarget1](~/samples/snippets/csharp/VS_Snippets_Wpf/CompositionTargetSample/CSharp/Window1.xaml.cs#compositiontarget1)]\n [!code-vb[CompositionTargetSample#CompositionTarget1](~/samples/snippets/visualbasic/VS_Snippets_Wpf/CompositionTargetSample/visualbasic/window1.xaml.vb#compositiontarget1)]  \n  \n You can use your rendering event handler method to create custom drawing content. This event handler method gets called once per frame. Each time that [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] marshals the persisted rendering data in the visual tree across to the composition scene graph, your event handler method is called. In addition, if changes to the visual tree force updates to the composition scene graph, your event handler method is also called. Note that your event handler method is called after layout has been computed. However, you can modify layout in your event handler method, which means that layout will be computed once more before rendering.  \n  \n The following example shows how you can provide custom drawing in a <xref:System.Windows.Media.CompositionTarget> event handler method. In this case, the background color of the <xref:System.Windows.Controls.Canvas> is drawn with a color value based on the coordinate position of the mouse. If you move the mouse inside the <xref:System.Windows.Controls.Canvas>, its background color changes. In addition, the average frame rate is calculated, based on the current elapsed time and the total number of rendered frames.  \n  \n [!code-csharp[CompositionTargetSample#CompositionTarget2](~/samples/snippets/csharp/VS_Snippets_Wpf/CompositionTargetSample/CSharp/Window1.xaml.cs#compositiontarget2)]\n [!code-vb[CompositionTargetSample#CompositionTarget2](~/samples/snippets/visualbasic/VS_Snippets_Wpf/CompositionTargetSample/visualbasic/window1.xaml.vb#compositiontarget2)]  \n  \n You may discover that your custom drawing runs at different speeds on different computers. This is because your custom drawing is not frame-rate independent. Depending on the system you are running and the workload of that system, the <xref:System.Windows.Media.CompositionTarget.Rendering> event may be called a different number of times per second. For information on determining the graphics hardware capability and performance for a device that runs a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application, see [Graphics Rendering Tiers](../advanced/graphics-rendering-tiers.md).  \n  \n Adding or removing a rendering <xref:System.EventHandler> delegate while the event is firing will be delayed until after the event is finished firing. This is consistent with how <xref:System.MulticastDelegate>-based events are handled in the Common Language Runtime (CLR). Also note that rendering events are not guaranteed to be called in any particular order. If you have multiple <xref:System.EventHandler> delegates that rely on a particular order, you should register a single <xref:System.Windows.Media.CompositionTarget.Rendering> event and multiplex the delegates in the correct order yourself.  \n  \n## See also\n\n- <xref:System.Windows.Media.CompositionTarget>\n- [WPF Graphics Rendering Overview](wpf-graphics-rendering-overview.md)\n","nodes":[{"pos":[4,325],"embed":true,"restype":"x-metadata","content":"title: \"How to: Render on a Per Frame Interval Using CompositionTarget\"\nms.date: \"03/30/2017\"\ndev_langs: \n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords: \n  - \"CompositionTarget objects [WPF], rendering per frame\"\n  - \"rendering per frame using CompositionTarget objects [WPF]\"\nms.assetid: 701246cd-66b7-4d69-ada9-17b3b433d95d","nodes":[{"content":"How to: Render on a Per Frame Interval Using CompositionTarget","nodes":[{"pos":[0,62],"content":"How to: Render on a Per Frame Interval Using CompositionTarget","nodes":[{"content":"How to: Render on a Per Frame Interval Using CompositionTarget","pos":[0,62]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[332,394],"content":"How to: Render on a Per Frame Interval Using CompositionTarget","linkify":"How to: Render on a Per Frame Interval Using CompositionTarget","nodes":[{"content":"How to: Render on a Per Frame Interval Using CompositionTarget","pos":[0,62]}]},{"content":"The <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> animation engine provides many features for creating frame-based animation.","pos":[395,556],"source":"The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] animation engine provides many features for creating frame-based animation."},{"content":"However, there are application scenarios in which you need finer-grained control over rendering on a per frame basis.","pos":[557,674]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Windows.Media.CompositionTarget&gt;</ph> object provides the ability to create custom animations based on a per-frame callback.","pos":[675,811],"source":" The <xref:System.Windows.Media.CompositionTarget> object provides the ability to create custom animations based on a per-frame callback."},{"content":"<ph id=\"ph1\">&lt;xref:System.Windows.Media.CompositionTarget&gt;</ph> is a static class which represents the display surface on which your application is being drawn.","pos":[818,960],"source":"<xref:System.Windows.Media.CompositionTarget> is a static class which represents the display surface on which your application is being drawn."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Windows.Media.CompositionTarget.Rendering&gt;</ph> event is raised each time the application's scene is drawn.","pos":[961,1080],"source":" The <xref:System.Windows.Media.CompositionTarget.Rendering> event is raised each time the application's scene is drawn."},{"content":"The rendering frame rate is the number of times the scene is drawn per second.","pos":[1081,1159]},{"pos":[1167,1347],"content":"[!NOTE]\n For a complete code sample using <xref:System.Windows.Media.CompositionTarget>, see [Using the CompositionTarget Sample](https://go.microsoft.com/fwlink/?LinkID=160045).","leadings":["","> "],"nodes":[{"content":"For a complete code sample using <ph id=\"ph1\">&lt;xref:System.Windows.Media.CompositionTarget&gt;</ph>, see <bpt id=\"p1\">[</bpt>Using the CompositionTarget Sample<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkID=160045)</ept>.","pos":[9,178],"source":"For a complete code sample using <xref:System.Windows.Media.CompositionTarget>, see [Using the CompositionTarget Sample](https://go.microsoft.com/fwlink/?LinkID=160045)."}]},{"pos":[1356,1363],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The <ph id=\"ph1\">&lt;xref:System.Windows.Media.CompositionTarget.Rendering&gt;</ph> event fires during the <ph id=\"ph2\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> rendering process.","pos":[1367,1550],"source":"The <xref:System.Windows.Media.CompositionTarget.Rendering> event fires during the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] rendering process."},{"content":"The following example shows how you register an <ph id=\"ph1\">&lt;xref:System.EventHandler&gt;</ph> delegate to the static <ph id=\"ph2\">&lt;xref:System.Windows.Media.CompositionTarget.Rendering&gt;</ph> method on <ph id=\"ph3\">&lt;xref:System.Windows.Media.CompositionTarget&gt;</ph>.","pos":[1551,1761],"source":" The following example shows how you register an <xref:System.EventHandler> delegate to the static <xref:System.Windows.Media.CompositionTarget.Rendering> method on <xref:System.Windows.Media.CompositionTarget>."},{"content":"You can use your rendering event handler method to create custom drawing content.","pos":[2117,2198]},{"content":"This event handler method gets called once per frame.","pos":[2199,2252]},{"content":"Each time that <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> marshals the persisted rendering data in the visual tree across to the composition scene graph, your event handler method is called.","pos":[2253,2482],"source":" Each time that [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] marshals the persisted rendering data in the visual tree across to the composition scene graph, your event handler method is called."},{"content":"In addition, if changes to the visual tree force updates to the composition scene graph, your event handler method is also called.","pos":[2483,2613]},{"content":"Note that your event handler method is called after layout has been computed.","pos":[2614,2691]},{"content":"However, you can modify layout in your event handler method, which means that layout will be computed once more before rendering.","pos":[2692,2821]},{"content":"The following example shows how you can provide custom drawing in a <ph id=\"ph1\">&lt;xref:System.Windows.Media.CompositionTarget&gt;</ph> event handler method.","pos":[2828,2963],"source":"The following example shows how you can provide custom drawing in a <xref:System.Windows.Media.CompositionTarget> event handler method."},{"content":"In this case, the background color of the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.Canvas&gt;</ph> is drawn with a color value based on the coordinate position of the mouse.","pos":[2964,3118],"source":" In this case, the background color of the <xref:System.Windows.Controls.Canvas> is drawn with a color value based on the coordinate position of the mouse."},{"content":"If you move the mouse inside the <ph id=\"ph1\">&lt;xref:System.Windows.Controls.Canvas&gt;</ph>, its background color changes.","pos":[3119,3220],"source":" If you move the mouse inside the <xref:System.Windows.Controls.Canvas>, its background color changes."},{"content":"In addition, the average frame rate is calculated, based on the current elapsed time and the total number of rendered frames.","pos":[3221,3346]},{"content":"You may discover that your custom drawing runs at different speeds on different computers.","pos":[3702,3792]},{"content":"This is because your custom drawing is not frame-rate independent.","pos":[3793,3859]},{"content":"Depending on the system you are running and the workload of that system, the <ph id=\"ph1\">&lt;xref:System.Windows.Media.CompositionTarget.Rendering&gt;</ph> event may be called a different number of times per second.","pos":[3860,4052],"source":" Depending on the system you are running and the workload of that system, the <xref:System.Windows.Media.CompositionTarget.Rendering> event may be called a different number of times per second."},{"content":"For information on determining the graphics hardware capability and performance for a device that runs a <ph id=\"ph1\">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]</ph> application, see <bpt id=\"p1\">[</bpt>Graphics Rendering Tiers<ept id=\"p1\">](../advanced/graphics-rendering-tiers.md)</ept>.","pos":[4053,4325],"source":" For information on determining the graphics hardware capability and performance for a device that runs a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application, see [Graphics Rendering Tiers](../advanced/graphics-rendering-tiers.md)."},{"content":"Adding or removing a rendering <ph id=\"ph1\">&lt;xref:System.EventHandler&gt;</ph> delegate while the event is firing will be delayed until after the event is finished firing.","pos":[4332,4482],"source":"Adding or removing a rendering <xref:System.EventHandler> delegate while the event is firing will be delayed until after the event is finished firing."},{"content":"This is consistent with how <ph id=\"ph1\">&lt;xref:System.MulticastDelegate&gt;</ph>-based events are handled in the Common Language Runtime (CLR).","pos":[4483,4605],"source":" This is consistent with how <xref:System.MulticastDelegate>-based events are handled in the Common Language Runtime (CLR)."},{"content":"Also note that rendering events are not guaranteed to be called in any particular order.","pos":[4606,4694]},{"content":"If you have multiple <ph id=\"ph1\">&lt;xref:System.EventHandler&gt;</ph> delegates that rely on a particular order, you should register a single <ph id=\"ph2\">&lt;xref:System.Windows.Media.CompositionTarget.Rendering&gt;</ph> event and multiplex the delegates in the correct order yourself.","pos":[4695,4935],"source":" If you have multiple <xref:System.EventHandler> delegates that rely on a particular order, you should register a single <xref:System.Windows.Media.CompositionTarget.Rendering> event and multiplex the delegates in the correct order yourself."},{"pos":[4944,4952],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[5004,5073],"content":"<bpt id=\"p1\">[</bpt>WPF Graphics Rendering Overview<ept id=\"p1\">](wpf-graphics-rendering-overview.md)</ept>","source":"[WPF Graphics Rendering Overview](wpf-graphics-rendering-overview.md)"}]}