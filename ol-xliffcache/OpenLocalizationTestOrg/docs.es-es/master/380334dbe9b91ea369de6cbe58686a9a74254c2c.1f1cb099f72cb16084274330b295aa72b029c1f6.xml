{"content":"---\ntitle: \"dateTimeInvalidLocalFormat MDA\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"dates [.NET Framework], formatting\"\n  - \"invalid date time local format\"\n  - \"invalid local formats\"\n  - \"MDAs (managed debugging assistants), invalid local formats\"\n  - \"managed debugging assistants (MDAs), invalid local formats\"\n  - \"dateTimeInvalidLocalFormat MDA\"\n  - \"date formatting\"\n  - \"time formatting\"\n  - \"UTC formatting\"\nms.assetid: c4a942bb-2651-4b65-8718-809f892a0659\nauthor: \"mairaw\"\nms.author: \"mairaw\"\n---\n# dateTimeInvalidLocalFormat MDA\nThe `dateTimeInvalidLocalFormat` MDA is activated when a <xref:System.DateTime> instance that is stored as a Universal Coordinated Time (UTC) is formatted using a format that is intended to be used only for local <xref:System.DateTime> instances. This MDA is not activated for unspecified or default <xref:System.DateTime> instances.  \n  \n## Symptom  \n An application is manually serializing a UTC <xref:System.DateTime> instance using a local format:  \n  \n```csharp\nDateTime myDateTime = DateTime.UtcNow;  \nSerialize(myDateTime.ToString(\"yyyy-MM-dd'T'HH:mm:ss.fffffffzzz\"));  \n```  \n  \n### Cause  \n The 'z' format for the <xref:System.DateTime.ToString%2A?displayProperty=nameWithType> method includes the local time zone offset, for example, \"+10:00\" for Sydney time. As such, it will only produce a meaningful result if the value of the <xref:System.DateTime> is local. If the value is UTC time, <xref:System.DateTime.ToString%2A?displayProperty=nameWithType> includes the local time zone offset, but it does not display or adjust the time zone specifier.  \n  \n### Resolution  \n UTC <xref:System.DateTime> instances should be formatted in a way that indicates that they are UTC. The recommended format for UTC times to use a 'Z' to denote UTC time:  \n  \n```csharp\nDateTime myDateTime = DateTime.UtcNow;  \nSerialize(myDateTime.ToString(\"yyyy-MM-dd'T'HH:mm:ss.fffffffZ\"));  \n```  \n  \n There is also an \"o\" format that serializes a <xref:System.DateTime> making use of the <xref:System.DateTime.Kind%2A> property that serializes correctly regardless of whether the instance is local, UTC, or unspecified:  \n  \n```csharp\nDateTime myDateTime = DateTime.UtcNow;  \nSerialize(myDateTime.ToString(\"o\"));  \n```  \n  \n## Effect on the Runtime  \n This MDA does not affect the runtime.  \n  \n## Output  \n There is no special output as a result of this MDA activating., However, the call stack can be used to determine the location of the <xref:System.DateTime.ToString%2A> call that activated the MDA.  \n  \n## Configuration  \n  \n```xml  \n<mdaConfig>  \n  <assistants>  \n    <dateTimeInvalidLocalFormat />  \n  </assistants>  \n</mdaConfig>  \n```  \n  \n## Example  \n Consider an application that is indirectly serializing a UTC <xref:System.DateTime> value by using the <xref:System.Xml.XmlConvert> or <xref:System.Data.DataSet> class, in the following manner.  \n  \n```csharp\nDateTime myDateTime = DateTime.UtcNow;  \nString serialized = XMLConvert.ToString(myDateTime);  \n```  \n  \n The <xref:System.Xml.XmlConvert> and <xref:System.Data.DataSet> serializations use local formats for serialization by default. Additional options are required to serialize other kinds of <xref:System.DateTime> values, such as UTC.  \n  \n For this specific example, pass in `XmlDateTimeSerializationMode.RoundtripKind` to the `ToString` call on `XmlConvert`. This serializes the data as a UTC time.  \n  \n If using a <xref:System.Data.DataSet>, set the <xref:System.Data.DataColumn.DateTimeMode%2A> property on the <xref:System.Data.DataColumn> object to <xref:System.Data.DataSetDateTime.Utc>.  \n  \n```csharp\nDateTime myDateTime = DateTime.UtcNow;  \nString serialized = XmlConvert.ToString(myDateTime,   \n    XmlDateTimeSerializationMode.RoundtripKind);  \n```  \n  \n## See also\n\n- <xref:System.Globalization.DateTimeFormatInfo>\n- [Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)\n","nodes":[{"pos":[4,511],"embed":true,"restype":"x-metadata","content":"title: \"dateTimeInvalidLocalFormat MDA\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"dates [.NET Framework], formatting\"\n  - \"invalid date time local format\"\n  - \"invalid local formats\"\n  - \"MDAs (managed debugging assistants), invalid local formats\"\n  - \"managed debugging assistants (MDAs), invalid local formats\"\n  - \"dateTimeInvalidLocalFormat MDA\"\n  - \"date formatting\"\n  - \"time formatting\"\n  - \"UTC formatting\"\nms.assetid: c4a942bb-2651-4b65-8718-809f892a0659\nauthor: \"mairaw\"\nms.author: \"mairaw\"","nodes":[{"content":"dateTimeInvalidLocalFormat MDA","nodes":[{"pos":[0,30],"content":"dateTimeInvalidLocalFormat MDA","nodes":[{"content":"dateTimeInvalidLocalFormat MDA","pos":[0,30]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[518,548],"content":"dateTimeInvalidLocalFormat MDA","linkify":"dateTimeInvalidLocalFormat MDA","nodes":[{"content":"dateTimeInvalidLocalFormat MDA","pos":[0,30]}]},{"content":"The <ph id=\"ph1\">`dateTimeInvalidLocalFormat`</ph> MDA is activated when a <ph id=\"ph2\">&lt;xref:System.DateTime&gt;</ph> instance that is stored as a Universal Coordinated Time (UTC) is formatted using a format that is intended to be used only for local <ph id=\"ph3\">&lt;xref:System.DateTime&gt;</ph> instances.","pos":[549,795],"source":"The `dateTimeInvalidLocalFormat` MDA is activated when a <xref:System.DateTime> instance that is stored as a Universal Coordinated Time (UTC) is formatted using a format that is intended to be used only for local <xref:System.DateTime> instances."},{"content":"This MDA is not activated for unspecified or default <ph id=\"ph1\">&lt;xref:System.DateTime&gt;</ph> instances.","pos":[796,882],"source":" This MDA is not activated for unspecified or default <xref:System.DateTime> instances."},{"pos":[891,898],"content":"Symptom","linkify":"Symptom","nodes":[{"content":"Symptom","pos":[0,7]}]},{"pos":[902,1000],"content":"An application is manually serializing a UTC <ph id=\"ph1\">&lt;xref:System.DateTime&gt;</ph> instance using a local format:","source":"An application is manually serializing a UTC <xref:System.DateTime> instance using a local format:"},{"pos":[1140,1145],"content":"Cause","linkify":"Cause","nodes":[{"content":"Cause","pos":[0,5]}]},{"content":"The 'z' format for the <ph id=\"ph1\">&lt;xref:System.DateTime.ToString%2A?displayProperty=nameWithType&gt;</ph> method includes the local time zone offset, for example, \"+10:00\" for Sydney time.","pos":[1149,1318],"source":"The 'z' format for the <xref:System.DateTime.ToString%2A?displayProperty=nameWithType> method includes the local time zone offset, for example, \"+10:00\" for Sydney time."},{"content":"As such, it will only produce a meaningful result if the value of the <ph id=\"ph1\">&lt;xref:System.DateTime&gt;</ph> is local.","pos":[1319,1421],"source":" As such, it will only produce a meaningful result if the value of the <xref:System.DateTime> is local."},{"content":"If the value is UTC time, <ph id=\"ph1\">&lt;xref:System.DateTime.ToString%2A?displayProperty=nameWithType&gt;</ph> includes the local time zone offset, but it does not display or adjust the time zone specifier.","pos":[1422,1607],"source":" If the value is UTC time, <xref:System.DateTime.ToString%2A?displayProperty=nameWithType> includes the local time zone offset, but it does not display or adjust the time zone specifier."},{"pos":[1617,1627],"content":"Resolution","linkify":"Resolution","nodes":[{"content":"Resolution","pos":[0,10]}]},{"content":"UTC <ph id=\"ph1\">&lt;xref:System.DateTime&gt;</ph> instances should be formatted in a way that indicates that they are UTC.","pos":[1631,1730],"source":"UTC <xref:System.DateTime> instances should be formatted in a way that indicates that they are UTC."},{"content":"The recommended format for UTC times to use a 'Z' to denote UTC time:","pos":[1731,1800]},{"pos":[1935,2153],"content":"There is also an \"o\" format that serializes a <ph id=\"ph1\">&lt;xref:System.DateTime&gt;</ph> making use of the <ph id=\"ph2\">&lt;xref:System.DateTime.Kind%2A&gt;</ph> property that serializes correctly regardless of whether the instance is local, UTC, or unspecified:","source":"There is also an \"o\" format that serializes a <xref:System.DateTime> making use of the <xref:System.DateTime.Kind%2A> property that serializes correctly regardless of whether the instance is local, UTC, or unspecified:"},{"pos":[2261,2282],"content":"Effect on the Runtime","linkify":"Effect on the Runtime","nodes":[{"content":"Effect on the Runtime","pos":[0,21]}]},{"content":"This MDA does not affect the runtime.","pos":[2286,2323]},{"pos":[2332,2338],"content":"Output","linkify":"Output","nodes":[{"content":"Output","pos":[0,6]}]},{"pos":[2342,2538],"content":"There is no special output as a result of this MDA activating., However, the call stack can be used to determine the location of the <ph id=\"ph1\">&lt;xref:System.DateTime.ToString%2A&gt;</ph> call that activated the MDA.","source":"There is no special output as a result of this MDA activating., However, the call stack can be used to determine the location of the <xref:System.DateTime.ToString%2A> call that activated the MDA."},{"pos":[2547,2560],"content":"Configuration","linkify":"Configuration","nodes":[{"content":"Configuration","pos":[0,13]}]},{"pos":[2688,2695],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"pos":[2699,2892],"content":"Consider an application that is indirectly serializing a UTC <ph id=\"ph1\">&lt;xref:System.DateTime&gt;</ph> value by using the <ph id=\"ph2\">&lt;xref:System.Xml.XmlConvert&gt;</ph> or <ph id=\"ph3\">&lt;xref:System.Data.DataSet&gt;</ph> class, in the following manner.","source":"Consider an application that is indirectly serializing a UTC <xref:System.DateTime> value by using the <xref:System.Xml.XmlConvert> or <xref:System.Data.DataSet> class, in the following manner."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Xml.XmlConvert&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Data.DataSet&gt;</ph> serializations use local formats for serialization by default.","pos":[3014,3140],"source":"The <xref:System.Xml.XmlConvert> and <xref:System.Data.DataSet> serializations use local formats for serialization by default."},{"content":"Additional options are required to serialize other kinds of <ph id=\"ph1\">&lt;xref:System.DateTime&gt;</ph> values, such as UTC.","pos":[3141,3244],"source":" Additional options are required to serialize other kinds of <xref:System.DateTime> values, such as UTC."},{"content":"For this specific example, pass in <ph id=\"ph1\">`XmlDateTimeSerializationMode.RoundtripKind`</ph> to the <ph id=\"ph2\">`ToString`</ph> call on <ph id=\"ph3\">`XmlConvert`</ph>.","pos":[3251,3370],"source":"For this specific example, pass in `XmlDateTimeSerializationMode.RoundtripKind` to the `ToString` call on `XmlConvert`."},{"content":"This serializes the data as a UTC time.","pos":[3371,3410]},{"pos":[3417,3605],"content":"If using a <ph id=\"ph1\">&lt;xref:System.Data.DataSet&gt;</ph>, set the <ph id=\"ph2\">&lt;xref:System.Data.DataColumn.DateTimeMode%2A&gt;</ph> property on the <ph id=\"ph3\">&lt;xref:System.Data.DataColumn&gt;</ph> object to <ph id=\"ph4\">&lt;xref:System.Data.DataSetDateTime.Utc&gt;</ph>.","source":"If using a <xref:System.Data.DataSet>, set the <xref:System.Data.DataColumn.DateTimeMode%2A> property on the <xref:System.Data.DataColumn> object to <xref:System.Data.DataSetDateTime.Utc>."},{"pos":[3780,3788],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[3841,3994],"content":"<bpt id=\"p1\">[</bpt>Diagnosing Errors with Managed Debugging Assistants<ept id=\"p1\">](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)</ept>","source":"[Diagnosing Errors with Managed Debugging Assistants](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)"}]}