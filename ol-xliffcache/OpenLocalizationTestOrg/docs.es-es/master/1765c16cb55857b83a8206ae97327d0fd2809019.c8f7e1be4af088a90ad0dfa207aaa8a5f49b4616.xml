{"content":"---\ntitle: Unit testing F# in .NET Core with dotnet test and MSTest\ndescription: Learn unit test concepts for F# in .NET Core through an interactive experience building a sample solution step-by-step using dotnet test and MSTest.\nauthor: billwagner\nms.author: wiwagn\nms.date: 08/30/2017\ndev_langs: \n  - \"fsharp\"\nms.custom: \"seodec18\"\n---\n# Unit testing F# libraries in .NET Core using dotnet test and MSTest\n\nThis tutorial takes you through an interactive experience building a sample solution step-by-step to learn unit testing concepts. If you prefer to follow the tutorial using a pre-built solution, [view or download the sample code](https://github.com/dotnet/samples/tree/master/core/getting-started/unit-testing-with-fsharp-mstest/) before you begin. For download instructions, see [Samples and Tutorials](../../samples-and-tutorials/index.md#viewing-and-downloading-samples).\n\n## Creating the source project\n\nOpen a shell window. Create a directory called *unit-testing-with-fsharp* to hold the solution.\nInside this new directory, run [`dotnet new sln`](../tools/dotnet-new.md) to create a new solution. This\nmakes it easier to manage both the class library and the unit test project.\nInside the solution directory, create a *MathService* directory. The directory and file structure thus far is shown below:\n\n```\n/unit-testing-with-fsharp\n    unit-testing-with-fsharp.sln\n    /MathService\n```\n\nMake *MathService* the current directory and run [`dotnet new classlib -lang F#`](../tools/dotnet-new.md) to create the source project.  You'll create a failing implementation of the math service:\n\n```fsharp\nmodule MyMath =\n    let squaresOfOdds xs = raise (System.NotImplementedException(\"You haven't written a test yet!\"))\n```\n\nChange the directory back to the *unit-testing-with-fsharp* directory. Run [`dotnet sln add .\\MathService\\MathService.fsproj`](../tools/dotnet-sln.md)\nto add the class library project to the solution.\n\n## Creating the test project\n\nNext, create the *MathService.Tests* directory. The following outline shows the directory structure:\n\n```\n/unit-testing-with-fsharp\n    unit-testing-with-fsharp.sln\n    /MathService\n        Source Files\n        MathService.fsproj\n    /MathService.Tests\n```\n\nMake the *MathService.Tests* directory the current directory and create a new project using [`dotnet new mstest -lang F#`](../tools/dotnet-new.md). This creates a test project that uses MSTest as the test framework. The generated template configures the test runner in the *MathServiceTests.fsproj*:\n\n```xml\n<ItemGroup>\n  <PackageReference Include=\"Microsoft.NET.Test.Sdk\" Version=\"15.3.0-preview-20170628-02\" />\n  <PackageReference Include=\"MSTest.TestAdapter\" Version=\"1.1.18\" />\n  <PackageReference Include=\"MSTest.TestFramework\" Version=\"1.1.18\" />\n</ItemGroup>\n```\n\nThe test project requires other packages to create and run unit tests. `dotnet new` in the previous step added MSTest and the MSTest runner. Now, add the `MathService` class library as another dependency to the project. Use the [`dotnet add reference`](../tools/dotnet-add-reference.md) command:\n\n```\ndotnet add reference ../MathService/MathService.fsproj\n```\n\nYou can see the entire file in the [samples repository](https://github.com/dotnet/samples/blob/master/core/getting-started/unit-testing-with-fsharp/MathService.Tests/MathService.Tests.fsproj) on GitHub.\n\nYou have the following final solution layout:\n\n```\n/unit-testing-with-fsharp\n    unit-testing-with-fsharp.sln\n    /MathService\n        Source Files\n        MathService.fsproj\n    /MathService.Tests\n        Test Source Files\n        MathServiceTests.fsproj\n```\n\nExecute [`dotnet sln add .\\MathService.Tests\\MathService.Tests.fsproj`](../tools/dotnet-sln.md) in the *unit-testing-with-fsharp* directory.\n\n## Creating the first test\n\nYou write one failing test, make it pass, then repeat the process. Open *Tests.fs* and add the following code:\n\n```fsharp\nnamespace MathService.Tests\n\nopen System\nopen Microsoft.VisualStudio.TestTools.UnitTesting\nopen MathService\n\n[<TestClass>]\ntype TestClass () =\n\n    [<TestMethod>]\n    member this.TestMethodPassing() =\n        Assert.IsTrue(true)\n\n    [<TestMethod>]\n     member this.FailEveryTime() = Assert.IsTrue(false)\n```\n\nThe `[<TestClass>]` attribute denotes a class that contains tests. The `[<TestMethod>]` attribute denotes a test method that is run by the test runner. From the *unit-testing-with-fsharp* directory, execute [`dotnet test`](../tools/dotnet-test.md) to build the tests and the class library and then run the tests. The MSTest test runner contains the program entry point to run your tests. `dotnet test` starts the test runner using the unit test project you've created.\n\nThese two tests show the most basic passing and failing tests. `My test` passes, and `Fail every time` fails. Now, create a test for the `squaresOfOdds` method. The `squaresOfOdds` method returns a list of the squares of all odd integer values that are part of the input sequence. Rather than trying to write all of those functions at once, you can iteratively create tests that validate the functionality. Making each test pass means creating the necessary functionality for the method.\n\nThe simplest test we can write is to call `squaresOfOdds` with all even numbers, where the result should be an empty sequence of integers.  Here's that test:\n\n```fsharp\n[<TestMethod>]\nmember this.TestEvenSequence() =\n    let expected = Seq.empty<int> |> Seq.toList\n    let actual = MyMath.squaresOfOdds [2; 4; 6; 8; 10]\n    Assert.AreEqual(expected, actual)\n```\n\nNotice that the `expected` sequence has been converted to a list. The MSTest library relies on many standard .NET types. That dependency means that your public interface and expected results support <xref:System.Collections.ICollection> rather than <xref:System.Collections.IEnumerable>.\n\nWhen you run the test, you see that your test fails. You haven't created the implementation yet. Make this test by writing the simplest code in the `Mathservice` class that works:\n\n```csharp\nlet squaresOfOdds xs =\n    Seq.empty<int> |> Seq.toList\n```\n\nIn the *unit-testing-with-fsharp* directory, run `dotnet test` again. The `dotnet test` command runs a build for the `MathService` project and then for the `MathService.Tests` project. After building both projects, it runs this single test. It passes.\n\n## Completing the requirements\n\nNow that you've made one test pass, it's time to write more. The next simple case works with a sequence whose only odd number is `1`. The number 1 is easier because the square of 1 is 1. Here's that next test:\n\n```fsharp\n[<TestMethod>]\nmember public this.TestOnesAndEvens() =\n    let expected = [1; 1; 1; 1]\n    let actual = MyMath.squaresOfOdds [2; 1; 4; 1; 6; 1; 8; 1; 10]\n    Assert.AreEqual(expected, actual)\n```\n\nExecuting `dotnet test` fails the new test. You must update the `squaresOfOdds` method to handle this new test. You must filter all the even numbers out of the sequence to make this test pass. You can do that by writing a small filter function and using `Seq.filter`:\n\n```fsharp\nlet private isOdd x = x % 2 <> 0\n\nlet squaresOfOdds xs =\n    xs\n    |> Seq.filter isOdd |> Seq.toList\n```\n\nNotice the call to `Seq.toList`. That creates a list, which implements the <xref:System.Collections.ICollection> interface.\n\nThere's one more step to go: square each of the odd numbers. Start by writing a new test:\n\n```fsharp\n[<TestMethod>]\nmember public this.TestSquaresOfOdds() =\n    let expected = [1; 9; 25; 49; 81]\n    let actual = MyMath.squaresOfOdds [1; 2; 3; 4; 5; 6; 7; 8; 9; 10]\n    Assert.AreEqual(expected, actual)\n```\n\nYou can fix the test by piping the filtered sequence through a map operation to compute the square of each odd number:\n\n```fsharp\nlet private square x = x * x\nlet private isOdd x = x % 2 <> 0\n\nlet squaresOfOdds xs =\n    xs\n    |> Seq.filter isOdd\n    |> Seq.map square\n    |> Seq.toList\n```\n\nYou've built a small library and a set of unit tests for that library. You've structured the solution so that adding new packages and tests is part of the normal workflow. You've concentrated most of your time and effort on solving the goals of the application.\n","nodes":[{"pos":[4,333],"embed":true,"restype":"x-metadata","content":"title: Unit testing F# in .NET Core with dotnet test and MSTest\ndescription: Learn unit test concepts for F# in .NET Core through an interactive experience building a sample solution step-by-step using dotnet test and MSTest.\nauthor: billwagner\nms.author: wiwagn\nms.date: 08/30/2017\ndev_langs: \n  - \"fsharp\"\nms.custom: \"seodec18\"","nodes":[{"content":"Unit testing F# in .NET Core with dotnet test and MSTest","nodes":[{"pos":[0,56],"content":"Unit testing F# in .NET Core with dotnet test and MSTest","nodes":[{"content":"Unit testing F# in .NET Core with dotnet test and MSTest","pos":[0,56]}]}],"path":["title"],"nosxs":false},{"content":"Learn unit test concepts for F# in .NET Core through an interactive experience building a sample solution step-by-step using dotnet test and MSTest.","nodes":[{"pos":[0,148],"content":"Learn unit test concepts for F# in .NET Core through an interactive experience building a sample solution step-by-step using dotnet test and MSTest.","nodes":[{"content":"Learn unit test concepts for F# in .NET Core through an interactive experience building a sample solution step-by-step using dotnet test and MSTest.","pos":[0,148]}]}],"path":["description"],"nosxs":false}],"yml":true},{"pos":[340,407],"content":"Unit testing F# libraries in .NET Core using dotnet test and MSTest","linkify":"Unit testing F# libraries in .NET Core using dotnet test and MSTest","nodes":[{"content":"Unit testing F# libraries in .NET Core using dotnet test and MSTest","pos":[0,67]}]},{"content":"This tutorial takes you through an interactive experience building a sample solution step-by-step to learn unit testing concepts.","pos":[409,538]},{"content":"If you prefer to follow the tutorial using a pre-built solution, <bpt id=\"p1\">[</bpt>view or download the sample code<ept id=\"p1\">](https://github.com/dotnet/samples/tree/master/core/getting-started/unit-testing-with-fsharp-mstest/)</ept> before you begin.","pos":[539,757],"source":" If you prefer to follow the tutorial using a pre-built solution, [view or download the sample code](https://github.com/dotnet/samples/tree/master/core/getting-started/unit-testing-with-fsharp-mstest/) before you begin."},{"content":"For download instructions, see <bpt id=\"p1\">[</bpt>Samples and Tutorials<ept id=\"p1\">](../../samples-and-tutorials/index.md#viewing-and-downloading-samples)</ept>.","pos":[758,883],"source":" For download instructions, see [Samples and Tutorials](../../samples-and-tutorials/index.md#viewing-and-downloading-samples)."},{"pos":[888,915],"content":"Creating the source project","linkify":"Creating the source project","nodes":[{"content":"Creating the source project","pos":[0,27]}]},{"content":"Open a shell window.","pos":[917,937]},{"content":"Create a directory called <bpt id=\"p1\">*</bpt>unit-testing-with-fsharp<ept id=\"p1\">*</ept> to hold the solution.","pos":[938,1012],"source":" Create a directory called *unit-testing-with-fsharp* to hold the solution."},{"content":"Inside this new directory, run <bpt id=\"p1\">[</bpt><ph id=\"ph1\">`dotnet new sln`</ph><ept id=\"p1\">](../tools/dotnet-new.md)</ept> to create a new solution.","pos":[1013,1112],"source":"\nInside this new directory, run [`dotnet new sln`](../tools/dotnet-new.md) to create a new solution."},{"content":"This makes it easier to manage both the class library and the unit test project.","pos":[1113,1193],"source":" This\nmakes it easier to manage both the class library and the unit test project."},{"content":"Inside the solution directory, create a <bpt id=\"p1\">*</bpt>MathService<ept id=\"p1\">*</ept> directory.","pos":[1194,1258],"source":"\nInside the solution directory, create a *MathService* directory."},{"content":"The directory and file structure thus far is shown below:","pos":[1259,1316]},{"content":"Make <bpt id=\"p1\">*</bpt>MathService<ept id=\"p1\">*</ept> the current directory and run <bpt id=\"p2\">[</bpt><ph id=\"ph1\">`dotnet new classlib -lang F#`</ph><ept id=\"p2\">](../tools/dotnet-new.md)</ept> to create the source project.","pos":[1403,1538],"source":"Make *MathService* the current directory and run [`dotnet new classlib -lang F#`](../tools/dotnet-new.md) to create the source project."},{"content":"You'll create a failing implementation of the math service:","pos":[1540,1599]},{"content":"Change the directory back to the <bpt id=\"p1\">*</bpt>unit-testing-with-fsharp<ept id=\"p1\">*</ept> directory.","pos":[1733,1803],"source":"Change the directory back to the *unit-testing-with-fsharp* directory."},{"content":"Run <bpt id=\"p1\">[</bpt><ph id=\"ph1\">`dotnet sln add .\\MathService\\MathService.fsproj`</ph><ept id=\"p1\">](../tools/dotnet-sln.md)</ept> to add the class library project to the solution.","pos":[1804,1933],"source":" Run [`dotnet sln add .\\MathService\\MathService.fsproj`](../tools/dotnet-sln.md)\nto add the class library project to the solution."},{"pos":[1938,1963],"content":"Creating the test project","linkify":"Creating the test project","nodes":[{"content":"Creating the test project","pos":[0,25]}]},{"content":"Next, create the <bpt id=\"p1\">*</bpt>MathService.Tests<ept id=\"p1\">*</ept> directory.","pos":[1965,2012],"source":"Next, create the *MathService.Tests* directory."},{"content":"The following outline shows the directory structure:","pos":[2013,2065]},{"content":"Make the <bpt id=\"p1\">*</bpt>MathService.Tests<ept id=\"p1\">*</ept> directory the current directory and create a new project using <bpt id=\"p2\">[</bpt><ph id=\"ph1\">`dotnet new mstest -lang F#`</ph><ept id=\"p2\">](../tools/dotnet-new.md)</ept>.","pos":[2223,2370],"source":"Make the *MathService.Tests* directory the current directory and create a new project using [`dotnet new mstest -lang F#`](../tools/dotnet-new.md)."},{"content":"This creates a test project that uses MSTest as the test framework.","pos":[2371,2438]},{"content":"The generated template configures the test runner in the <bpt id=\"p1\">*</bpt>MathServiceTests.fsproj<ept id=\"p1\">*</ept>:","pos":[2439,2522],"source":" The generated template configures the test runner in the *MathServiceTests.fsproj*:"},{"content":"The test project requires other packages to create and run unit tests.","pos":[2794,2864]},{"content":"<ph id=\"ph1\">`dotnet new`</ph> in the previous step added MSTest and the MSTest runner.","pos":[2865,2934],"source":"`dotnet new` in the previous step added MSTest and the MSTest runner."},{"content":"Now, add the <ph id=\"ph1\">`MathService`</ph> class library as another dependency to the project.","pos":[2935,3013],"source":" Now, add the `MathService` class library as another dependency to the project."},{"content":"Use the <bpt id=\"p1\">[</bpt><ph id=\"ph1\">`dotnet add reference`</ph><ept id=\"p1\">](../tools/dotnet-add-reference.md)</ept> command:","pos":[3014,3089],"source":" Use the [`dotnet add reference`](../tools/dotnet-add-reference.md) command:"},{"pos":[3155,3357],"content":"You can see the entire file in the <bpt id=\"p1\">[</bpt>samples repository<ept id=\"p1\">](https://github.com/dotnet/samples/blob/master/core/getting-started/unit-testing-with-fsharp/MathService.Tests/MathService.Tests.fsproj)</ept> on GitHub.","source":"You can see the entire file in the [samples repository](https://github.com/dotnet/samples/blob/master/core/getting-started/unit-testing-with-fsharp/MathService.Tests/MathService.Tests.fsproj) on GitHub."},{"content":"You have the following final solution layout:","pos":[3359,3404]},{"pos":[3620,3760],"content":"Execute <bpt id=\"p1\">[</bpt><ph id=\"ph1\">`dotnet sln add .\\MathService.Tests\\MathService.Tests.fsproj`</ph><ept id=\"p1\">](../tools/dotnet-sln.md)</ept> in the <bpt id=\"p2\">*</bpt>unit-testing-with-fsharp<ept id=\"p2\">*</ept> directory.","source":"Execute [`dotnet sln add .\\MathService.Tests\\MathService.Tests.fsproj`](../tools/dotnet-sln.md) in the *unit-testing-with-fsharp* directory."},{"pos":[3765,3788],"content":"Creating the first test","linkify":"Creating the first test","nodes":[{"content":"Creating the first test","pos":[0,23]}]},{"content":"You write one failing test, make it pass, then repeat the process.","pos":[3790,3856]},{"content":"Open <bpt id=\"p1\">*</bpt>Tests.fs<ept id=\"p1\">*</ept> and add the following code:","pos":[3857,3900],"source":" Open *Tests.fs* and add the following code:"},{"content":"The <ph id=\"ph1\">`[&lt;TestClass&gt;]`</ph> attribute denotes a class that contains tests.","pos":[4222,4288],"source":"The `[<TestClass>]` attribute denotes a class that contains tests."},{"content":"The <ph id=\"ph1\">`[&lt;TestMethod&gt;]`</ph> attribute denotes a test method that is run by the test runner.","pos":[4289,4373],"source":" The `[<TestMethod>]` attribute denotes a test method that is run by the test runner."},{"content":"From the <bpt id=\"p1\">*</bpt>unit-testing-with-fsharp<ept id=\"p1\">*</ept> directory, execute <bpt id=\"p2\">[</bpt><ph id=\"ph1\">`dotnet test`</ph><ept id=\"p2\">](../tools/dotnet-test.md)</ept> to build the tests and the class library and then run the tests.","pos":[4374,4534],"source":" From the *unit-testing-with-fsharp* directory, execute [`dotnet test`](../tools/dotnet-test.md) to build the tests and the class library and then run the tests."},{"content":"The MSTest test runner contains the program entry point to run your tests.","pos":[4535,4609]},{"content":"<ph id=\"ph1\">`dotnet test`</ph> starts the test runner using the unit test project you've created.","pos":[4610,4690],"source":"`dotnet test` starts the test runner using the unit test project you've created."},{"content":"These two tests show the most basic passing and failing tests.","pos":[4692,4754]},{"content":"<ph id=\"ph1\">`My test`</ph> passes, and <ph id=\"ph2\">`Fail every time`</ph> fails.","pos":[4755,4801],"source":"`My test` passes, and `Fail every time` fails."},{"content":"Now, create a test for the <ph id=\"ph1\">`squaresOfOdds`</ph> method.","pos":[4802,4852],"source":" Now, create a test for the `squaresOfOdds` method."},{"content":"The <ph id=\"ph1\">`squaresOfOdds`</ph> method returns a list of the squares of all odd integer values that are part of the input sequence.","pos":[4853,4972],"source":" The `squaresOfOdds` method returns a list of the squares of all odd integer values that are part of the input sequence."},{"content":"Rather than trying to write all of those functions at once, you can iteratively create tests that validate the functionality.","pos":[4973,5098]},{"content":"Making each test pass means creating the necessary functionality for the method.","pos":[5099,5179]},{"content":"The simplest test we can write is to call <ph id=\"ph1\">`squaresOfOdds`</ph> with all even numbers, where the result should be an empty sequence of integers.","pos":[5181,5319],"source":"The simplest test we can write is to call `squaresOfOdds` with all even numbers, where the result should be an empty sequence of integers."},{"content":"Here's that test:","pos":[5321,5338]},{"content":"Notice that the <ph id=\"ph1\">`expected`</ph> sequence has been converted to a list.","pos":[5544,5609],"source":"Notice that the `expected` sequence has been converted to a list."},{"content":"The MSTest library relies on many standard .NET types.","pos":[5610,5664]},{"content":"That dependency means that your public interface and expected results support <ph id=\"ph1\">&lt;xref:System.Collections.ICollection&gt;</ph> rather than <ph id=\"ph2\">&lt;xref:System.Collections.IEnumerable&gt;</ph>.","pos":[5665,5831],"source":" That dependency means that your public interface and expected results support <xref:System.Collections.ICollection> rather than <xref:System.Collections.IEnumerable>."},{"content":"When you run the test, you see that your test fails.","pos":[5833,5885]},{"content":"You haven't created the implementation yet.","pos":[5886,5929]},{"content":"Make this test by writing the simplest code in the <ph id=\"ph1\">`Mathservice`</ph> class that works:","pos":[5930,6012],"source":" Make this test by writing the simplest code in the `Mathservice` class that works:"},{"content":"In the <bpt id=\"p1\">*</bpt>unit-testing-with-fsharp<ept id=\"p1\">*</ept> directory, run <ph id=\"ph1\">`dotnet test`</ph> again.","pos":[6085,6154],"source":"In the *unit-testing-with-fsharp* directory, run `dotnet test` again."},{"content":"The <ph id=\"ph1\">`dotnet test`</ph> command runs a build for the <ph id=\"ph2\">`MathService`</ph> project and then for the <ph id=\"ph3\">`MathService.Tests`</ph> project.","pos":[6155,6269],"source":" The `dotnet test` command runs a build for the `MathService` project and then for the `MathService.Tests` project."},{"content":"After building both projects, it runs this single test.","pos":[6270,6325]},{"content":"It passes.","pos":[6326,6336]},{"pos":[6341,6368],"content":"Completing the requirements","linkify":"Completing the requirements","nodes":[{"content":"Completing the requirements","pos":[0,27]}]},{"content":"Now that you've made one test pass, it's time to write more.","pos":[6370,6430]},{"content":"The next simple case works with a sequence whose only odd number is <ph id=\"ph1\">`1`</ph>.","pos":[6431,6503],"source":" The next simple case works with a sequence whose only odd number is `1`."},{"content":"The number 1 is easier because the square of 1 is 1.","pos":[6504,6556]},{"content":"Here's that next test:","pos":[6557,6579]},{"content":"Executing <ph id=\"ph1\">`dotnet test`</ph> fails the new test.","pos":[6788,6831],"source":"Executing `dotnet test` fails the new test."},{"content":"You must update the <ph id=\"ph1\">`squaresOfOdds`</ph> method to handle this new test.","pos":[6832,6899],"source":" You must update the `squaresOfOdds` method to handle this new test."},{"content":"You must filter all the even numbers out of the sequence to make this test pass.","pos":[6900,6980]},{"content":"You can do that by writing a small filter function and using <ph id=\"ph1\">`Seq.filter`</ph>:","pos":[6981,7055],"source":" You can do that by writing a small filter function and using `Seq.filter`:"},{"content":"Notice the call to <ph id=\"ph1\">`Seq.toList`</ph>.","pos":[7174,7206],"source":"Notice the call to `Seq.toList`."},{"content":"That creates a list, which implements the <ph id=\"ph1\">&lt;xref:System.Collections.ICollection&gt;</ph> interface.","pos":[7207,7297],"source":" That creates a list, which implements the <xref:System.Collections.ICollection> interface."},{"content":"There's one more step to go: square each of the odd numbers.","pos":[7299,7359]},{"content":"Start by writing a new test:","pos":[7360,7388]},{"content":"You can fix the test by piping the filtered sequence through a map operation to compute the square of each odd number:","pos":[7607,7725]},{"content":"You've built a small library and a set of unit tests for that library.","pos":[7899,7969]},{"content":"You've structured the solution so that adding new packages and tests is part of the normal workflow.","pos":[7970,8070]},{"content":"You've concentrated most of your time and effort on solving the goals of the application.","pos":[8071,8160]}]}