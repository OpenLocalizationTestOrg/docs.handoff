{"content":"---\ntitle: \"SRMP\"\nms.date: \"03/30/2017\"\nms.assetid: cf37078c-dcb4-45e0-acaf-2f196521b226\n---\n# SRMP\nThis sample demonstrates how to perform transacted queued communication by using Message Queuing (MSMQ) over HTTP.  \n  \n In queued communication, the client communicates to the service using a queue. More precisely, the client sends messages to a queue. The service receives messages from the queue. The service and client therefore, do not have to be running at the same time to communicate using a queue.  \n  \n MSMQ enables the use of HTTP (including the use of HTTPS) to send messages to a queue. In this example, we demonstrate using Windows Communication Foundation (WCF) queued communication and how to send messages over HTTP. MSMQ uses a protocol called SRMP, which is a SOAP-based protocol for communication over HTTP.  \n  \n### To set up, build, and run the sample  \n  \n1.  Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md).  \n  \n2.  To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md).  \n  \n3.  To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md).  \n  \n4.  Before running the sample in **Add/Remove Windows Components**, ensure that MSMQ is installed with HTTP support. Installing HTTP support automatically installs Internet Information Services (IIS) and adds the protocol support in IIS for MSMQ.  \n  \n5.  If you want to be certain that HTTP is used for communication, you can enable MSMQ to run in hardened mode. This ensures that no messages to any queue hosted on the machine can arrive using any non-HTTP transport.  \n  \n6.  After you have selected MSMQ to run in hardened mode, the machine requires a re-boot on [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)].  \n  \n7.  Run the service.  \n  \n8.  Run the client. Ensure that you change the endpoint address to point to the machine name or IP address instead of localhost. The client sends a message and exits.  \n  \n## Requirements  \n To run this sample, IIS must be installed on both the service and the client machines in addition to MSMQ.  \n  \n## Demonstrates  \n The sample demonstrates sending WCF queued messages using MSMQ over HTTP. This is also called SRMP messaging. When a queued message is sent, MSMQ on the sending machine transfers the messages to the receiving queue manager over TCP or HTTP transport. By choosing SRMP, the user indicates the choice of HTTP as a transport for queue transfer. SRMP Secure enables the use of HTTPS.  \n  \n## Example  \n The sample code is based on the transacted sample. How you send a message to the queue and receive a message from the queue using SRMP is the same as sending and receiving messages using a Native protocol.  \n  \n The configuration for the client is changed to indicate the choice of the queue transfer protocol. The queue transfer protocol can be one of Native, SRMP or SrmpSecure. By default, the transfer protocol is Native. The client and service specify in the configuration to use SRMP in this example.  \n  \n There are limitations to SRMP in relation to transport security. The default MSMQ transport security requires Active Directory that requires that the sending queue manager and the receiving queue manager reside in the same Windows domain. This is not possible when sending messages over HTTP boundary. As such, the default transport security does not work. The transport security must be set to Certificate if transport security is desired. Message security can also be used to secure the message. In this sample, both transport and message security is turned off to illustrate SRMP messaging.  \n  \n```xml  \n<?xml version=\"1.0\" encoding=\"utf-8\" ?>  \n<configuration>  \n  \n  <system.serviceModel>  \n  \n    <client>  \n      <!-- Define NetMsmqEndpoint -->  \n      <endpoint name=\"OrderProcessorEndpoint\"  \n           address=  \n          \"net.msmq://localhost/private/ServiceModelSamplesSrmp\"   \n           bindingConfiguration=\"srmpBinding\"   \n           binding=\"netMsmqBinding\"   \n           contract=\"IOrderProcessor\" />  \n    </client>  \n    <bindings>  \n      <netMsmqBinding>  \n        <binding name=\"srmpBinding\"  \n                 queueTransferProtocol=\"Srmp\">  \n          <security mode=\"None\" />  \n        </binding>  \n      </netMsmqBinding>  \n    </bindings>  \n  </system.serviceModel>  \n  \n</configuration>  \n```  \n  \n Running the sample yields the following output.  \n  \n```  \nProcessing Purchase Order: 556b70be-31ee-4a3b-8df4-ed5e538015a4   \nCustomer: somecustomer.com   \nOrderDetails   \n    Order LineItem: 54 of Blue Widget @unit price: $29.99   \n    Order LineItem: 890 of Red Widget @unit price: $45.89   \n    Total cost of this order: $42461.56   \n    Order status: Pending  \n```  \n  \n> [!IMPORTANT]\n>  The samples may already be installed on your machine. Check for the following (default) directory before continuing.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples`  \n>   \n>  If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples. This sample is located in the following directory.  \n>   \n>  `<InstallDrive>:\\WF_WCF_Samples\\WCF\\Basic\\Binding\\Net\\MSMQ\\SRMP`  \n","nodes":[{"pos":[4,88],"embed":true,"restype":"x-metadata","content":"title: \"SRMP\"\nms.date: \"03/30/2017\"\nms.assetid: cf37078c-dcb4-45e0-acaf-2f196521b226","nodes":[{"content":"SRMP","nodes":[{"pos":[0,4],"content":"SRMP","nodes":[{"content":"SRMP","pos":[0,4]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[95,99],"content":"SRMP","linkify":"SRMP","nodes":[{"content":"SRMP","pos":[0,4]}]},{"content":"This sample demonstrates how to perform transacted queued communication by using Message Queuing (MSMQ) over HTTP.","pos":[100,214]},{"content":"In queued communication, the client communicates to the service using a queue.","pos":[221,299]},{"content":"More precisely, the client sends messages to a queue.","pos":[300,353]},{"content":"The service receives messages from the queue.","pos":[354,399]},{"content":"The service and client therefore, do not have to be running at the same time to communicate using a queue.","pos":[400,506]},{"content":"MSMQ enables the use of HTTP (including the use of HTTPS) to send messages to a queue.","pos":[513,599]},{"content":"In this example, we demonstrate using Windows Communication Foundation (WCF) queued communication and how to send messages over HTTP.","pos":[600,733]},{"content":"MSMQ uses a protocol called SRMP, which is a SOAP-based protocol for communication over HTTP.","pos":[734,827]},{"pos":[837,873],"content":"To set up, build, and run the sample","linkify":"To set up, build, and run the sample","nodes":[{"content":"To set up, build, and run the sample","pos":[0,36]}]},{"pos":[883,1082],"content":"Ensure that you have performed the <bpt id=\"p1\">[</bpt>One-Time Setup Procedure for the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)</ept>.","source":"Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/one-time-setup-procedure-for-the-wcf-samples.md)."},{"pos":[1092,1301],"content":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in <bpt id=\"p1\">[</bpt>Building the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/building-the-samples.md)</ept>.","source":"To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/building-the-samples.md)."},{"pos":[1311,1519],"content":"To run the sample in a single- or cross-machine configuration, follow the instructions in <bpt id=\"p1\">[</bpt>Running the Windows Communication Foundation Samples<ept id=\"p1\">](../../../../docs/framework/wcf/samples/running-the-samples.md)</ept>.","source":"To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](../../../../docs/framework/wcf/samples/running-the-samples.md)."},{"content":"Before running the sample in <bpt id=\"p1\">**</bpt>Add/Remove Windows Components<ept id=\"p1\">**</ept>, ensure that MSMQ is installed with HTTP support.","pos":[1529,1641],"source":"Before running the sample in **Add/Remove Windows Components**, ensure that MSMQ is installed with HTTP support."},{"content":"Installing HTTP support automatically installs Internet Information Services (IIS) and adds the protocol support in IIS for MSMQ.","pos":[1642,1771]},{"content":"If you want to be certain that HTTP is used for communication, you can enable MSMQ to run in hardened mode.","pos":[1781,1888]},{"content":"This ensures that no messages to any queue hosted on the machine can arrive using any non-HTTP transport.","pos":[1889,1994]},{"pos":[2004,2146],"content":"After you have selected MSMQ to run in hardened mode, the machine requires a re-boot on <ph id=\"ph1\">[!INCLUDE[ws2003](../../../../includes/ws2003-md.md)]</ph>.","source":"After you have selected MSMQ to run in hardened mode, the machine requires a re-boot on [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)]."},{"content":"Run the service.","pos":[2156,2172]},{"content":"Run the client.","pos":[2182,2197]},{"content":"Ensure that you change the endpoint address to point to the machine name or IP address instead of localhost.","pos":[2198,2306]},{"content":"The client sends a message and exits.","pos":[2307,2344]},{"pos":[2353,2365],"content":"Requirements","linkify":"Requirements","nodes":[{"content":"Requirements","pos":[0,12]}]},{"content":"To run this sample, IIS must be installed on both the service and the client machines in addition to MSMQ.","pos":[2369,2475]},{"pos":[2484,2496],"content":"Demonstrates","linkify":"Demonstrates","nodes":[{"content":"Demonstrates","pos":[0,12]}]},{"content":"The sample demonstrates sending WCF queued messages using MSMQ over HTTP.","pos":[2500,2573]},{"content":"This is also called SRMP messaging.","pos":[2574,2609]},{"content":"When a queued message is sent, MSMQ on the sending machine transfers the messages to the receiving queue manager over TCP or HTTP transport.","pos":[2610,2750]},{"content":"By choosing SRMP, the user indicates the choice of HTTP as a transport for queue transfer.","pos":[2751,2841]},{"content":"SRMP Secure enables the use of HTTPS.","pos":[2842,2879]},{"pos":[2888,2895],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The sample code is based on the transacted sample.","pos":[2899,2949]},{"content":"How you send a message to the queue and receive a message from the queue using SRMP is the same as sending and receiving messages using a Native protocol.","pos":[2950,3104]},{"content":"The configuration for the client is changed to indicate the choice of the queue transfer protocol.","pos":[3111,3209]},{"content":"The queue transfer protocol can be one of Native, SRMP or SrmpSecure.","pos":[3210,3279]},{"content":"By default, the transfer protocol is Native.","pos":[3280,3324]},{"content":"The client and service specify in the configuration to use SRMP in this example.","pos":[3325,3405]},{"content":"There are limitations to SRMP in relation to transport security.","pos":[3412,3476]},{"content":"The default MSMQ transport security requires Active Directory that requires that the sending queue manager and the receiving queue manager reside in the same Windows domain.","pos":[3477,3650]},{"content":"This is not possible when sending messages over HTTP boundary.","pos":[3651,3713]},{"content":"As such, the default transport security does not work.","pos":[3714,3768]},{"content":"The transport security must be set to Certificate if transport security is desired.","pos":[3769,3852]},{"content":"Message security can also be used to secure the message.","pos":[3853,3909]},{"content":"In this sample, both transport and message security is turned off to illustrate SRMP messaging.","pos":[3910,4005]},{"content":"Running the sample yields the following output.","pos":[4742,4789]},{"pos":[5118,5250],"content":"[!IMPORTANT]\n The samples may already be installed on your machine. Check for the following (default) directory before continuing.","leadings":["","> "],"nodes":[{"content":"The samples may already be installed on your machine. Check for the following (default) directory before continuing.","pos":[14,130],"nodes":[{"content":"The samples may already be installed on your machine.","pos":[0,53]},{"content":"Check for the following (default) directory before continuing.","pos":[54,116]}]}]},{"content":"If this directory does not exist, go to <bpt id=\"p1\">[</bpt>Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4<ept id=\"p1\">](https://go.microsoft.com/fwlink/?LinkId=150780)</ept> to download all Windows Communication Foundation (WCF) and <ph id=\"ph1\">[!INCLUDE[wf1](../../../../includes/wf1-md.md)]</ph> samples.","pos":[5304,5614],"source":"If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples."},{"content":"This sample is located in the following directory.","pos":[5615,5665]}]}