{"content":"---\ntitle: \"How to debug CLR activation issues\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"CLR activation, debugging issues\"\nms.assetid: 4fe17546-d56e-4344-a930-6d8e4a545914\nauthor: \"mairaw\"\nms.author: \"mairaw\"\n---\n# How to debug CLR activation issues\n\nIf you encounter problems in getting your application to run with the correct version of the common language runtime (CLR), you can view and debug CLR activation logs. These logs can be very useful in determining the root cause of an activation issue, when your application either loads a different CLR version than expected or doesn't load the CLR at all. The [.NET Framework Initialization Errors: Managing the User Experience](../../../docs/framework/deployment/initialization-errors-managing-the-user-experience.md) discusses the experience when no CLR is found for an application.\n\nCLR activation logging can be enabled system-wide by using an HKEY_LOCAL_MACHINE registry key or a system environment variable. The log will be generated until the registry entry or the environment variable is removed. Alternatively, you can use a user or process-local environment variable to enable logging with a different scope and duration.\n\nCLR activation logs shouldn't be confused with [assembly binding logs](../../../docs/framework/tools/fuslogvw-exe-assembly-binding-log-viewer.md), which are entirely different.\n\n## To enable CLR activation logging\n\n### Using the registry\n\n1. In the Registry Editor, navigate to HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\\\.NETFramework (on a 32-bit computer) or HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\\\.NETFramework folder (on a 64-bit computer).\n\n2. Add a string value named `CLRLoadLogDir`, and set it to the full path of an existing directory where you'd like to store CLR activation logs.\n\nActivation logging remains enabled until you remove the string value.\n\n### Using an environment variable\n\n- Set the `COMPLUS_CLRLoadLogDir` environment variable to a string that represents the full path of an existing directory where you'd like to store CLR activation logs.\n\n     How you set the environment variable determines its scope:\n\n    - If you set it at the system level, activation logging is enabled for all .NET Framework applications on that computer until the environment variable is removed.\n\n    - If you set it at the user level, activation logging is enabled only for the current user account. Logging continues until the environment variable is removed.\n\n    - If you set it from within the process before loading the CLR, activation logging is enabled until the process terminates.\n\n    - If you set it at a command prompt before you run an application, activation logging is enabled for any application that is run from that command prompt.\n\n     For example, to store activation logs in the c:\\clrloadlogs directory with process-level scope, open a Command Prompt window and type the following before you run the application:\n\n    ```\n    set COMPLUS_CLRLoadLogDir=c:\\clrloadlogs\n    ```\n\n## Example\n\nCLR activation logs provide a large amount of data about CLR activation and the use of the CLR hosting APIs. Most of this data is used internally by Microsoft, but some of the data can also be useful to developers, as described in this article.\n\nThe log reflects the order in which the CLR hosting APIs were called. It also includes useful data about the set of installed runtimes detected on the computer. The CLR activation log format is not itself documented, but can be used to aid developers who need to resolve CLR activation issues.\n\n> [!NOTE]\n> You cannot open an activation log until the process that uses the CLR has terminated.\n\n> [!NOTE]\n> CLR activation logs are not localized; they are always generated in the English language.\n\nIn the following example of an activation log, the most useful information is highlighted and described after the log.\n\n```\n532,205950.367,CLR Loading log for C:\\Tests\\myapp.exe \n532,205950.367,Log started at 4:26:12 PM on 10/6/2011 \n532,205950.367,----------------------------------- \n532,205950.382,FunctionCall: _CorExeMain \n532,205950.382,FunctionCall: ClrCreateInstance, Clsid: {2EBCD49A-1B47-4A61-B13A-4A03701E594B}, Iid: {E2190695-77B2-492E-8E14-C4B3A7FDD593} \n532,205950.382,MethodCall: ICLRMetaHostPolicy::GetRequestedRuntime. Version: (null), Metahost Policy Flags: 0x168, Binary: (null), Iid: {BD39D1D2-BA2F-486A-89B0-B4B0CB466891} \n532,205950.382,Installed Runtime: v4.0.30319. VERSION_ARCHITECTURE: 0 \n532,205950.382,Input values for ComputeVersionString follow this line \n532,205950.382,----------------------------------- \n532,205950.382,Default Application Name: C:\\Tests\\myapp.exe \n532,205950.382,IsLegacyBind is: 0 \n532,205950.382,IsCapped is 0 \n532,205950.382,SkuCheckFlags are 0 \n532,205950.382,ShouldEmulateExeLaunch is 0 \n532,205950.382,LegacyBindRequired is 0 \n532,205950.382,----------------------------------- \n532,205950.382,Parsing config file: C:\\Tests\\myapp.exe \n532,205950.382,UseLegacyV2RuntimeActivationPolicy is set to 0 \n532,205950.382,LegacyFunctionCall: GetFileVersion. Filename: C:\\Tests\\myapp.exe \n532,205950.382,LegacyFunctionCall: GetFileVersion. Filename: C:\\Tests\\myapp.exe \n532,205950.382,C:\\Tests\\myapp.exe was built with version: v2.0.50727 \n532,205950.382,ERROR: Version v2.0.50727 is not present on the machine. \n532,205950.398,SEM_FAILCRITICALERRORS is set to 0 \n532,205950.398,Launching feature-on-demand installation. CmdLine: C:\\Windows\\system32\\fondue.exe /enable-feature:NetFx3 \n532,205950.398,FunctionCall: RealDllMain. Reason: 0 \n532,205950.398,FunctionCall: OnShimDllMainCalled. Reason: 0\n```\n\n- **CLR Loading log** provides the path to the executable that started the process that loaded managed code. Note that this could be a native host.\n\n    ```\n    532,205950.367,CLR Loading log for C:\\Tests\\myapp.exe\n    ```\n\n- **Installed Runtime** is the set of CLR versions installed on the computer that are candidates for the activation request.\n\n    ```\n    532,205950.382,Installed Runtime: v4.0.30319. VERSION_ARCHITECTURE: 0\n    ```\n\n- **built with version** is the version of the CLR that was used to build the binary that was provided to a method such as [ICLRMetaHostPolicy::GetRequestedRuntime](../../../docs/framework/unmanaged-api/hosting/iclrmetahostpolicy-getrequestedruntime-method.md).\n\n    ```\n    532,205950.382,C:\\Tests\\myapp.exe was built with version: v2.0.50727\n    ```\n\n- **feature-on-demand installation** refers to enabling the .NET Framework 3.5 on Windows 8. See [.NET Framework Initialization Errors: Managing the User Experience](../../../docs/framework/deployment/initialization-errors-managing-the-user-experience.md) for more information about this scenario.\n\n    ```\n    532,205950.398,Launching feature-on-demand installation. CmdLine: C:\\Windows\\system32\\fondue.exe /enable-feature:NetFx3\n    ```\n\n## See also\n\n- [Deployment](../../../docs/framework/deployment/index.md)\n- [How to: Configure an app to support .NET Framework 4 or later versions](../../../docs/framework/migration-guide/how-to-configure-an-app-to-support-net-framework-4-or-4-5.md)","nodes":[{"pos":[4,216],"embed":true,"restype":"x-metadata","content":"title: \"How to debug CLR activation issues\"\nms.date: \"03/30/2017\"\nhelpviewer_keywords: \n  - \"CLR activation, debugging issues\"\nms.assetid: 4fe17546-d56e-4344-a930-6d8e4a545914\nauthor: \"mairaw\"\nms.author: \"mairaw\"","nodes":[{"content":"How to debug CLR activation issues","nodes":[{"pos":[0,34],"content":"How to debug CLR activation issues","nodes":[{"content":"How to debug CLR activation issues","pos":[0,34]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[223,257],"content":"How to debug CLR activation issues","linkify":"How to debug CLR activation issues","nodes":[{"content":"How to debug CLR activation issues","pos":[0,34]}]},{"content":"If you encounter problems in getting your application to run with the correct version of the common language runtime (CLR), you can view and debug CLR activation logs.","pos":[259,426]},{"content":"These logs can be very useful in determining the root cause of an activation issue, when your application either loads a different CLR version than expected or doesn't load the CLR at all.","pos":[427,615]},{"content":"The <bpt id=\"p1\">[</bpt>.NET Framework Initialization Errors: Managing the User Experience<ept id=\"p1\">](../../../docs/framework/deployment/initialization-errors-managing-the-user-experience.md)</ept> discusses the experience when no CLR is found for an application.","pos":[616,844],"source":" The [.NET Framework Initialization Errors: Managing the User Experience](../../../docs/framework/deployment/initialization-errors-managing-the-user-experience.md) discusses the experience when no CLR is found for an application."},{"content":"CLR activation logging can be enabled system-wide by using an HKEY_LOCAL_MACHINE registry key or a system environment variable.","pos":[846,973]},{"content":"The log will be generated until the registry entry or the environment variable is removed.","pos":[974,1064]},{"content":"Alternatively, you can use a user or process-local environment variable to enable logging with a different scope and duration.","pos":[1065,1191]},{"pos":[1193,1369],"content":"CLR activation logs shouldn't be confused with <bpt id=\"p1\">[</bpt>assembly binding logs<ept id=\"p1\">](../../../docs/framework/tools/fuslogvw-exe-assembly-binding-log-viewer.md)</ept>, which are entirely different.","source":"CLR activation logs shouldn't be confused with [assembly binding logs](../../../docs/framework/tools/fuslogvw-exe-assembly-binding-log-viewer.md), which are entirely different."},{"pos":[1374,1406],"content":"To enable CLR activation logging","linkify":"To enable CLR activation logging","nodes":[{"content":"To enable CLR activation logging","pos":[0,32]}]},{"pos":[1412,1430],"content":"Using the registry","linkify":"Using the registry","nodes":[{"content":"Using the registry","pos":[0,18]}]},{"content":"In the Registry Editor, navigate to HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft<ph id=\"ph1\">\\\\</ph>.NETFramework (on a 32-bit computer) or HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft<ph id=\"ph2\">\\\\</ph>.NETFramework folder (on a 64-bit computer).","pos":[1435,1645],"source":"In the Registry Editor, navigate to HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\\\.NETFramework (on a 32-bit computer) or HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\\\.NETFramework folder (on a 64-bit computer)."},{"pos":[1650,1791],"content":"Add a string value named <ph id=\"ph1\">`CLRLoadLogDir`</ph>, and set it to the full path of an existing directory where you'd like to store CLR activation logs.","source":"Add a string value named `CLRLoadLogDir`, and set it to the full path of an existing directory where you'd like to store CLR activation logs."},{"content":"Activation logging remains enabled until you remove the string value.","pos":[1793,1862]},{"pos":[1868,1897],"content":"Using an environment variable","linkify":"Using an environment variable","nodes":[{"content":"Using an environment variable","pos":[0,29]}]},{"pos":[1901,2067],"content":"Set the <ph id=\"ph1\">`COMPLUS_CLRLoadLogDir`</ph> environment variable to a string that represents the full path of an existing directory where you'd like to store CLR activation logs.","source":"Set the `COMPLUS_CLRLoadLogDir` environment variable to a string that represents the full path of an existing directory where you'd like to store CLR activation logs."},{"content":"How you set the environment variable determines its scope:","pos":[2074,2132]},{"content":"If you set it at the system level, activation logging is enabled for all .NET Framework applications on that computer until the environment variable is removed.","pos":[2140,2300]},{"content":"If you set it at the user level, activation logging is enabled only for the current user account.","pos":[2308,2405]},{"content":"Logging continues until the environment variable is removed.","pos":[2406,2466]},{"content":"If you set it from within the process before loading the CLR, activation logging is enabled until the process terminates.","pos":[2474,2595]},{"content":"If you set it at a command prompt before you run an application, activation logging is enabled for any application that is run from that command prompt.","pos":[2603,2755]},{"content":"For example, to store activation logs in the c:\\clrloadlogs directory with process-level scope, open a Command Prompt window and type the following before you run the application:","pos":[2762,2941]},{"pos":[3008,3015],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"CLR activation logs provide a large amount of data about CLR activation and the use of the CLR hosting APIs.","pos":[3017,3125]},{"content":"Most of this data is used internally by Microsoft, but some of the data can also be useful to developers, as described in this article.","pos":[3126,3261]},{"content":"The log reflects the order in which the CLR hosting APIs were called.","pos":[3263,3332]},{"content":"It also includes useful data about the set of installed runtimes detected on the computer.","pos":[3333,3423]},{"content":"The CLR activation log format is not itself documented, but can be used to aid developers who need to resolve CLR activation issues.","pos":[3424,3556]},{"pos":[3560,3655],"content":"[!NOTE]\nYou cannot open an activation log until the process that uses the CLR has terminated.","leadings":["","> "],"nodes":[{"content":"You cannot open an activation log until the process that uses the CLR has terminated.","pos":[8,93]}]},{"pos":[3659,3758],"content":"[!NOTE]\nCLR activation logs are not localized; they are always generated in the English language.","leadings":["","> "],"nodes":[{"content":"CLR activation logs are not localized; they are always generated in the English language.","pos":[8,97]}]},{"content":"In the following example of an activation log, the most useful information is highlighted and described after the log.","pos":[3760,3878]},{"content":"<bpt id=\"p1\">**</bpt>CLR Loading log<ept id=\"p1\">**</ept> provides the path to the executable that started the process that loaded managed code.","pos":[5612,5718],"source":"**CLR Loading log** provides the path to the executable that started the process that loaded managed code."},{"content":"Note that this could be a native host.","pos":[5719,5757]},{"pos":[5836,5958],"content":"<bpt id=\"p1\">**</bpt>Installed Runtime<ept id=\"p1\">**</ept> is the set of CLR versions installed on the computer that are candidates for the activation request.","source":"**Installed Runtime** is the set of CLR versions installed on the computer that are candidates for the activation request."},{"pos":[6053,6312],"content":"<bpt id=\"p1\">**</bpt>built with version<ept id=\"p1\">**</ept> is the version of the CLR that was used to build the binary that was provided to a method such as <bpt id=\"p2\">[</bpt>ICLRMetaHostPolicy::GetRequestedRuntime<ept id=\"p2\">](../../../docs/framework/unmanaged-api/hosting/iclrmetahostpolicy-getrequestedruntime-method.md)</ept>.","source":"**built with version** is the version of the CLR that was used to build the binary that was provided to a method such as [ICLRMetaHostPolicy::GetRequestedRuntime](../../../docs/framework/unmanaged-api/hosting/iclrmetahostpolicy-getrequestedruntime-method.md)."},{"content":"<bpt id=\"p1\">**</bpt>feature-on-demand installation<ept id=\"p1\">**</ept> refers to enabling the .NET Framework 3.5 on Windows 8.","pos":[6406,6496],"source":"**feature-on-demand installation** refers to enabling the .NET Framework 3.5 on Windows 8."},{"content":"See <bpt id=\"p1\">[</bpt>.NET Framework Initialization Errors: Managing the User Experience<ept id=\"p1\">](../../../docs/framework/deployment/initialization-errors-managing-the-user-experience.md)</ept> for more information about this scenario.","pos":[6497,6701],"source":" See [.NET Framework Initialization Errors: Managing the User Experience](../../../docs/framework/deployment/initialization-errors-managing-the-user-experience.md) for more information about this scenario."},{"pos":[6847,6855],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[6859,6916],"content":"<bpt id=\"p1\">[</bpt>Deployment<ept id=\"p1\">](../../../docs/framework/deployment/index.md)</ept>","source":"[Deployment](../../../docs/framework/deployment/index.md)"},{"pos":[6919,7093],"content":"<bpt id=\"p1\">[</bpt>How to: Configure an app to support .NET Framework 4 or later versions<ept id=\"p1\">](../../../docs/framework/migration-guide/how-to-configure-an-app-to-support-net-framework-4-or-4-5.md)</ept>","source":"[How to: Configure an app to support .NET Framework 4 or later versions](../../../docs/framework/migration-guide/how-to-configure-an-app-to-support-net-framework-4-or-4-5.md)"}]}