{"content":"---\ntitle: \"Serialization and Deserialization | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 3d71814c-bda7-424b-85b7-15084ff9377a\ncaps.latest.revision: 13\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Serialization and Deserialization\n[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] includes a new serialization engine, the <xref:System.Runtime.Serialization.DataContractSerializer>. The <xref:System.Runtime.Serialization.DataContractSerializer> translates between [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] objects and XML, in both directions. This topic explains how the serializer works.  \n  \n When serializing [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] objects, the serializer understands a variety of serialization programming models, including the new *data contract* model. For a full list of supported types, see [Types Supported by the Data Contract Serializer](../../../../docs/framework/wcf/feature-details/types-supported-by-the-data-contract-serializer.md). For an introduction to data contracts, see [Using Data Contracts](../../../../docs/framework/wcf/feature-details/using-data-contracts.md).  \n  \n When deserializing XML, the serializer uses the <xref:System.Xml.XmlReader> and <xref:System.Xml.XmlWriter> classes. It also supports the <xref:System.Xml.XmlDictionaryReader> and <xref:System.Xml.XmlDictionaryWriter> classes to enable it to produce optimized XML in some cases, such as when using the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] binary XML format.  \n  \n [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] also includes a companion serializer, the <xref:System.Runtime.Serialization.NetDataContractSerializer>. The <xref:System.Runtime.Serialization.NetDataContractSerializer> is similar to the <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> and <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter> serializers because it also emits [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] type names as part of the serialized data. It is used when the same types are shared on the serializing and the deserializing ends. Both the <xref:System.Runtime.Serialization.DataContractSerializer> and the <xref:System.Runtime.Serialization.NetDataContractSerializer> derive from a common base class, the <xref:System.Runtime.Serialization.XmlObjectSerializer>.  \n  \n> [!WARNING]\n>  The <xref:System.Runtime.Serialization.DataContractSerializer> serializes strings containing control characters with a hexadecimal value below 20 as XML entities. This may cause a problem with a non-WCF client went sending such data to a WCF service.  \n  \n## Creating a DataContractSerializer Instance  \n Constructing an instance of the <xref:System.Runtime.Serialization.DataContractSerializer> is an important step. After construction, you cannot change any of the settings.  \n  \n### Specifying the Root Type  \n The *root type* is the type of which instances are serialized or deserialized. The <xref:System.Runtime.Serialization.DataContractSerializer> has many constructor overloads, but, at a minimum, a root type must be supplied using the `type` parameter.  \n  \n A serializer created for a certain root type cannot be used to serialize (or deserialize) another type, unless the type is derived from the root type. The following example shows two classes.  \n  \n [!code-csharp[c_StandaloneDataContractSerializer#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#1)]\n [!code-vb[c_StandaloneDataContractSerializer#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#1)]  \n  \n This code constructs an instance of the `DataContractSerializer` that can be used only to serialize or deserialize instances of the `Person` class.  \n  \n [!code-csharp[c_StandaloneDataContractSerializer#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#2)]\n [!code-vb[c_StandaloneDataContractSerializer#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#2)]  \n  \n### Specifying Known Types  \n If polymorphism is involved in the types being serialized that is not already handled using the <xref:System.Runtime.Serialization.KnownTypeAttribute> attribute or some other mechanism, a list of possible known types must be passed to the serializer’s constructor using the `knownTypes` parameter. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] known types, see [Data Contract Known Types](../../../../docs/framework/wcf/feature-details/data-contract-known-types.md).  \n  \n The following example shows a class, `LibraryPatron`, that includes a collection of a specific type, the `LibraryItem`. The second class defines the `LibraryItem` type. The third and four classes (`Book` and `Newspaper`) inherit from the `LibraryItem` class.  \n  \n [!code-csharp[c_StandaloneDataContractSerializer#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#3)]   \n [!code-vb[c_StandaloneDataContractSerializer#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#3)]  \n  \n The following code constructs an instance of the serializer using the `knownTypes` parameter.  \n  \n [!code-csharp[c_StandaloneDataContractSerializer#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#4)]\n [!code-vb[c_StandaloneDataContractSerializer#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#4)]  \n  \n### Specifying the Default Root Name and Namespace  \n Normally, when an object is serialized, the default name and namespace of the outermost XML element are determined according to the data contract name and namespace. The names of all inner elements are determined from data member names, and their namespace is the data contract’s namespace. The following example sets `Name` and `Namespace` values in the constructors of the <xref:System.Runtime.Serialization.DataContractAttribute> and <xref:System.Runtime.Serialization.DataMemberAttribute> classes.  \n  \n [!code-csharp[c_StandaloneDataContractSerializer#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#5)]\n [!code-vb[c_StandaloneDataContractSerializer#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#5)]  \n  \n Serializing an instance of the `Person` class produces XML similar to the following.  \n  \n```  \n<PersonContract xmlns=\"http://schemas.contoso.com\">  \n  <AddressMember>  \n    <StreetMember>123 Main Street</StreetMember>  \n   </AddressMember>  \n</PersonContract>  \n```  \n  \n However, you can customize the default name and namespace of the root element by passing the values of the `rootName` and `rootNamespace` parameters to the <xref:System.Runtime.Serialization.DataContractSerializer> constructor. Note that the `rootNamespace` does not affect the namespace of the contained elements that correspond to data members. It affects only the namespace of the outermost element.  \n  \n These values can be passed as strings or instances of the <xref:System.Xml.XmlDictionaryString> class to allow for their optimization using the binary XML format.  \n  \n### Setting the Maximum Objects Quota  \n Some `DataContractSerializer` constructor overloads have a `maxItemsInObjectGraph` parameter. This parameter determines the maximum number of objects the serializer serializes or deserializes in a single <xref:System.Runtime.Serialization.XmlObjectSerializer.ReadObject%2A> method call. (The method always reads one root object, but this object may have other objects in its data members. Those objects may have other objects, and so on.) The default is 65536. Note that when serializing or deserializing arrays, every array entry counts as a separate object. Also, note that some objects may have a large memory representation, and so this quota alone may not be sufficient to prevent a denial of service attack. [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][Security Considerations for Data](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md). If you need to increase this quota beyond the default value, it is important to do so both on the sending (serializing) and receiving (deserializing) sides because it applies to both when reading and writing data.  \n  \n### Round Trips  \n A *round trip* occurs when an object is deserialized and re-serialized in one operation. Thus, it goes from XML to an object instance, and back again into an XML stream.  \n  \n Some `DataContractSerializer` constructor overloads have an `ignoreExtensionDataObject` parameter, which is set to `false` by default. In this default mode, data can be sent on a round trip from a newer version of a data contract through an older version and back to the newer version without loss, as long as the data contract implements the <xref:System.Runtime.Serialization.IExtensibleDataObject> interface. For example, suppose version 1 of the `Person` data contract contains the `Name` and `PhoneNumber` data members, and version 2 adds a `Nickname` member. If `IExtensibleDataObject` is implemented, when sending information from version 2 to version 1, the `Nickname` data is stored, and then re-emitted when the data is serialized again; therefore, no data is lost in the round trip. [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][Forward-Compatible Data Contracts](../../../../docs/framework/wcf/feature-details/forward-compatible-data-contracts.md) and [Data Contract Versioning](../../../../docs/framework/wcf/feature-details/data-contract-versioning.md).  \n  \n#### Security and Schema Validity Concerns with Round Trips  \n Round trips may have security implications. For example, deserializing and storing large amounts of extraneous data may be a security risk. There may be security concerns about re-emitting this data that there is no way to verify, especially if digital signatures are involved. For example, in the previous scenario, the version 1 endpoint could be signing a `Nickname` value that contains malicious data. Finally, there may be schema validity concerns: an endpoint may want to always emit data that strictly adheres to its stated contract and not any extra values. In the previous example, the version 1 endpoint’s contract says that it emits only `Name` and `PhoneNumber`, and if schema validation is being used, emitting the extra `Nickname` value causes validation to fail.  \n  \n#### Enabling and Disabling Round Trips  \n To turn off round trips, do not implement the <xref:System.Runtime.Serialization.IExtensibleDataObject> interface. If you have no control over the types, set the `ignoreExtensionDataObject` parameter to `true` to achieve the same effect.  \n  \n### Object Graph Preservation  \n Normally, the serializer does not care about object identity, as in the following code.  \n  \n [!code-csharp[c_StandaloneDataContractSerializer#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#6)]\n [!code-vb[c_StandaloneDataContractSerializer#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#6)]  \n  \n The following code creates a purchase order.  \n  \n [!code-csharp[c_StandaloneDataContractSerializer#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#7)]\n [!code-vb[c_StandaloneDataContractSerializer#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#7)]  \n  \n Notice that `billTo` and `shipTo` fields are set to the same object instance. However, the generated XML duplicates the information duplicated, and looks similar to the following XML.  \n  \n```  \n<PurchaseOrder>  \n  <billTo><street>123 Main St.</street></billTo>  \n  <shipTo><street>123 Main St.</street></shipTo>  \n</PurchaseOrder>  \n```  \n  \n However, this approach has the following characteristics, which may be undesirable:  \n  \n-   Performance. Replicating data is inefficient.  \n  \n-   Circular references. If objects refer to themselves, even through other objects, serializing by replication results in an infinite loop. (The serializer throws a <xref:System.Runtime.Serialization.SerializationException> if this happens.)  \n  \n-   Semantics. Sometimes it is important to preserve the fact that two references are to the same object, and not to two identical objects.  \n  \n For these reasons, some `DataContractSerializer` constructor overloads have a `preserveObjectReferences` parameter (the default is `false`). When this parameter is set to `true`, a special method of encoding object references, which only [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] understands, is used. When set to `true`, the XML code example now resembles the following.  \n  \n```  \n<PurchaseOrder ser:id=\"1\">  \n  <billTo ser:id=\"2\"><street ser:id=\"3\">123 Main St.</street></billTo>  \n  <shipTo ser:ref=\"2\"/>  \n</PurchaseOrder>  \n```  \n  \n The \"ser\" namespace refers to the standard serialization namespace, http://schemas.microsoft.com/2003/10/Serialization/. Each piece of data is serialized only once and given an ID number, and subsequent uses result in a reference to the already serialized data.  \n  \n> [!IMPORTANT]\n>  If both \"id\" and \"ref\" attributes are present in the data contract `XMLElement`, then the \"ref\" attribute is honored and the \"id\" attribute is ignored.  \n  \n It is important to understand the limitations of this mode:  \n  \n-   The XML the `DataContractSerializer` produces with `preserveObjectReferences` set to `true` is not interoperable with any other technologies, and can be accessed only by another `DataContractSerializer` instance, also with `preserveObjectReferences` set to `true`.  \n  \n-   There is no metadata (schema) support for this feature. The schema that is produced is valid only for the case when `preserveObjectReferences` is set to `false`.  \n  \n-   This feature may cause the serialization and deserialization process to run slower. Although data does not have to be replicated, extra object comparisons must be performed in this mode.  \n  \n> [!CAUTION]\n>  When the `preserveObjectReferences` mode is enabled, it is especially important to set the `maxItemsInObjectGraph` value to the correct quota. Due to the way arrays are handled in this mode, it is easy for an attacker to construct a small malicious message that results in large memory consumption limited only by the `maxItemsInObjectGraph` quota.  \n  \n### Specifying a Data Contract Surrogate  \n Some `DataContractSerializer` constructor overloads have a `dataContractSurrogate` parameter, which may be set to `null`. Otherwise, you can use it to specify a *data contract surrogate*, which is a type that implements the <xref:System.Runtime.Serialization.IDataContractSurrogate> interface. You can then use the interface to customize the serialization and deserialization process. [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][Data Contract Surrogates](../../../../docs/framework/wcf/extending/data-contract-surrogates.md).  \n  \n## Serialization  \n The following information applies to any class that inherits from the <xref:System.Runtime.Serialization.XmlObjectSerializer>, including the <xref:System.Runtime.Serialization.DataContractSerializer> and <xref:System.Runtime.Serialization.NetDataContractSerializer> classes.  \n  \n### Simple Serialization  \n The most basic way to serialize an object is to pass it to the <xref:System.Runtime.Serialization.XmlObjectSerializer.WriteObject%2A> method. There are three overloads, one each for writing to a <xref:System.IO.Stream>, an <xref:System.Xml.XmlWriter>, or an <xref:System.Xml.XmlDictionaryWriter>. With the <xref:System.IO.Stream> overload, the output is XML in the UTF-8 encoding. With the <xref:System.Xml.XmlDictionaryWriter> overload, the serializer optimizes its output for binary XML.  \n  \n When using the <xref:System.Runtime.Serialization.XmlObjectSerializer.WriteObject%2A> method, the serializer uses the default name and namespace for the wrapper element and writes it out along with the contents (see the previous \"Specifying the Default Root Name and Namespace\" section).  \n  \n The following example demonstrates writing with an <xref:System.Xml.XmlDictionaryWriter>.  \n  \n [!code-csharp[c_StandaloneDataContractSerializer#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#8)]\n [!code-vb[c_StandaloneDataContractSerializer#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#8)]  \n  \n This produces XML similar to the following.  \n  \n```  \n<Person>  \n  <Name>Jay Hamlin</Name>  \n  <Address>123 Main St.</Address>  \n</Person>  \n```  \n  \n### Step-By-Step Serialization  \n Use the <xref:System.Runtime.Serialization.XmlObjectSerializer.WriteStartObject%2A>, <xref:System.Runtime.Serialization.XmlObjectSerializer.WriteObjectContent%2A>, and <xref:System.Runtime.Serialization.XmlObjectSerializer.WriteEndObject%2A> methods to write the end element, write the object contents, and close the wrapper element, respectively.  \n  \n> [!NOTE]\n>  There are no <xref:System.IO.Stream> overloads of these methods.  \n  \n This step-by-step serialization has two common uses. One is to insert contents such as attributes or comments between `WriteStartObject` and `WriteObjectContent`,  as shown in the following example.  \n  \n [!code-csharp[c_StandaloneDataContractSerializer#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#9)]\n [!code-vb[c_StandaloneDataContractSerializer#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#9)]  \n  \n This produces XML similar to the following.  \n  \n```  \n<Person serializedBy=\"myCode\">  \n  <Name>Jay Hamlin</Name>  \n  <Address>123 Main St.</Address>  \n</Person>  \n```  \n  \n Another common use is to avoid using <xref:System.Runtime.Serialization.XmlObjectSerializer.WriteStartObject%2A> and <xref:System.Runtime.Serialization.XmlObjectSerializer.WriteEndObject%2A> entirely, and to write your own custom wrapper element (or even skip writing a wrapper altogether), as shown in the following code.  \n  \n [!code-csharp[c_StandaloneDataContractSerializer#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#10)]\n [!code-vb[c_StandaloneDataContractSerializer#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#10)]  \n  \n This produces XML similar to the following.  \n  \n```  \n<MyCustomWrapper>  \n  <Name>Jay Hamlin</Name>  \n  <Address>123 Main St.</Address>  \n</MyCustomWrapper>  \n```  \n  \n> [!NOTE]\n>  Using step-by-step serialization may result in schema-invalid XML.  \n  \n## Deserialization  \n The following information applies to any class that inherits from the <xref:System.Runtime.Serialization.XmlObjectSerializer>, including the <xref:System.Runtime.Serialization.DataContractSerializer> and <xref:System.Runtime.Serialization.NetDataContractSerializer> classes.  \n  \n The most basic way to deserialize an object is to call one of the <xref:System.Runtime.Serialization.XmlObjectSerializer.ReadObject%2A> method overloads. There are three overloads, one each for reading with a <xref:System.Xml.XmlDictionaryReader>, an `XmlReader`, or a `Stream`. Note that the `Stream` overload creates a textual <xref:System.Xml.XmlDictionaryReader> that is not protected by any quotas, and should be used only to read trusted data.  \n  \n Also note that the object the `ReadObject` method returns must be cast to the appropriate type.  \n  \n The following code constructs an instance of the <xref:System.Runtime.Serialization.DataContractSerializer> and an <xref:System.Xml.XmlDictionaryReader>, then deserializes a `Person` instance.  \n  \n [!code-csharp[c_StandaloneDataContractSerializer#11](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#11)]\n [!code-vb[c_StandaloneDataContractSerializer#11](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#11)]  \n  \n Before calling the <xref:System.Runtime.Serialization.XmlObjectSerializer.ReadObject%2A> method, position the XML reader on the wrapper element or on a non-content node that precedes the wrapper element. You can do this by calling the <xref:System.Xml.XmlReader.Read%2A> method of the <xref:System.Xml.XmlReader> or its derivation, and testing the <xref:System.Xml.XmlReader.NodeType%2A>, as shown in the following code.  \n  \n [!code-csharp[c_StandaloneDataContractSerializer#12](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#12)]\n [!code-vb[c_StandaloneDataContractSerializer#12](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#12)]  \n  \n Note that you can read attributes on this wrapper element before handing the reader to `ReadObject`.  \n  \n When using one of the simple `ReadObject` overloads, the deserializer looks for the default name and namespace on the wrapper element (see the preceding section, \"Specifying the Default Root Name and Namespace\") and throws an exception if it finds an unknown element. In the preceding example, the `<Person>` wrapper element is expected. The <xref:System.Runtime.Serialization.XmlObjectSerializer.IsStartObject%2A> method is called to verify that the reader is positioned on an element that is named as expected.  \n  \n There is a way to disable this wrapper element name check; some overloads of the `ReadObject` method take the Boolean parameter `verifyObjectName`, which is set to `true` by default. When set to `false`, the name and namespace of the wrapper element is ignored. This is useful for reading XML that was written using the step-by-step serialization mechanism described previously.  \n  \n## Using the NetDataContractSerializer  \n The primary difference between the `DataContractSerializer` and the <xref:System.Runtime.Serialization.NetDataContractSerializer> is that the `DataContractSerializer` uses data contract names, whereas the `NetDataContractSerializer` outputs full [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] assembly and type names in the serialized XML. This means that the exact same types must be shared between the serialization and deserialization endpoints. This means that the known types mechanism is not required with the `NetDataContractSerializer` because the exact types to be deserialized are always known.  \n  \n However, several problems can occur:  \n  \n-   Security. Any type found in the XML being deserialized is loaded. This can be exploited to force the loading of malicious types. Using the `NetDataContractSerializer` with untrusted data should be done only if a *Serialization Binder* is used (using the <xref:System.Runtime.Serialization.NetDataContractSerializer.Binder%2A> property or constructor parameter). The binder permits only safe types to be loaded. The Binder mechanism is identical to the one that types in the <xref:System.Runtime.Serialization> namespace use.  \n  \n-   Versioning. Using full type and assembly names in the XML severely restricts how types can be versioned. The following cannot be changed: type names, namespaces, assembly names, and assembly versions. Setting the <xref:System.Runtime.Serialization.NetDataContractSerializer.AssemblyFormat%2A> property or constructor parameter to <xref:System.Runtime.Serialization.Formatters.FormatterAssemblyStyle> instead of the default value of <xref:System.Runtime.Serialization.Formatters.FormatterAssemblyStyle> allows for assembly version changes, but not for generic parameter types.  \n  \n-   Interoperability. Because [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] type and assembly names are included in the XML, platforms other than the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] cannot access the resulting data.  \n  \n-   Performance. Writing out the type and assembly names significantly increases the size of the resulting XML.  \n  \n This mechanism is similar to binary or SOAP serialization used by [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] remoting (specifically, the <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> and the <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter>).  \n  \n Using the `NetDataContractSerializer` is similar to using the `DataContractSerializer`, with the following differences:  \n  \n-   The constructors do not require you to specify a root type. You can serialize any type with the same instance of the `NetDataContractSerializer`.  \n  \n-   The constructors do not accept a list of known types. The known types mechanism is unnecessary if type names are serialized into the XML.  \n  \n-   The constructors do not accept a data contract surrogate. Instead, they accept an <xref:System.Runtime.Serialization.ISurrogateSelector> parameter called `surrogateSelector` (which maps to the <xref:System.Runtime.Serialization.NetDataContractSerializer.SurrogateSelector%2A> property). This is a legacy surrogate mechanism.  \n  \n-   The constructors accept a parameter called `assemblyFormat` of the <xref:System.Runtime.Serialization.Formatters.FormatterAssemblyStyle> that maps to the <xref:System.Runtime.Serialization.NetDataContractSerializer.AssemblyFormat%2A> property. As discussed previously, this can be used to enhance the versioning capabilities of the serializer. This is identical to the <xref:System.Runtime.Serialization.Formatters.FormatterAssemblyStyle> mechanism in binary or SOAP serialization.  \n  \n-   The constructors accept a <xref:System.Runtime.Serialization.StreamingContext> parameter called `context` that maps to the <xref:System.Runtime.Serialization.NetDataContractSerializer.Context%2A> property. You can use this to pass information into types being serialized. This usage is identical to that of the <xref:System.Runtime.Serialization.StreamingContext> mechanism used in other <xref:System.Runtime.Serialization> classes.  \n  \n-   The <xref:System.Runtime.Serialization.NetDataContractSerializer.Serialize%2A> and <xref:System.Runtime.Serialization.NetDataContractSerializer.Deserialize%2A> methods are aliases for the <xref:System.Runtime.Serialization.XmlObjectSerializer.WriteObject%2A> and <xref:System.Runtime.Serialization.XmlObjectSerializer.ReadObject%2A> methods. These exist to provide a more consistent programming model with binary or SOAP serialization.  \n  \n [!INCLUDE[crabout](../../../../includes/crabout-md.md)] these features, see [Binary Serialization](../../../../docs/framework/serialization/binary-serialization.md).  \n  \n The XML formats that the `NetDataContractSerializer` and the `DataContractSerializer` use are normally not compatible. That is, attempting to serialize with one of these serializers and deserialize with the other is not a supported scenario.  \n  \n Also, note that the `NetDataContractSerializer` does not output the full [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] type and assembly name for each node in the object graph. It outputs that information only where it is ambiguous. That is, it outputs at the root object level and for any polymorphic cases.  \n  \n## See Also  \n <xref:System.Runtime.Serialization.DataContractSerializer>   \n <xref:System.Runtime.Serialization.NetDataContractSerializer>   \n <xref:System.Runtime.Serialization.XmlObjectSerializer>   \n [Binary Serialization](../../../../docs/framework/serialization/binary-serialization.md)   \n [Types Supported by the Data Contract Serializer](../../../../docs/framework/wcf/feature-details/types-supported-by-the-data-contract-serializer.md)","nodes":[{"pos":[4,354],"nodes":[{"content":"Serialization and Deserialization | Microsoft Docs","nodes":[{"pos":[0,50],"content":"Serialization and Deserialization | Microsoft Docs","nodes":[{"content":"Serialization and Deserialization | Microsoft Docs","pos":[0,50]}]}],"pos":[6,59],"yaml":true}],"content":"title: \"Serialization and Deserialization | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nms.assetid: 3d71814c-bda7-424b-85b7-15084ff9377a\ncaps.latest.revision: 13\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"","yamlblock":true},{"pos":[361,394],"content":"Serialization and Deserialization","linkify":"Serialization and Deserialization","nodes":[{"content":"Serialization and Deserialization","pos":[0,33]}]},{"content":"<ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> includes a new serialization engine, the <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.DataContractSerializer&gt;</ph>.","pos":[395,551],"source":"[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] includes a new serialization engine, the <xref:System.Runtime.Serialization.DataContractSerializer>."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.DataContractSerializer&gt;</ph> translates between <ph id=\"ph2\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> objects and XML, in both directions.","pos":[552,734],"source":" The <xref:System.Runtime.Serialization.DataContractSerializer> translates between [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] objects and XML, in both directions."},{"content":"This topic explains how the serializer works.","pos":[735,780]},{"content":"When serializing <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> objects, the serializer understands a variety of serialization programming models, including the new <bpt id=\"p1\">*</bpt>data contract<ept id=\"p1\">*</ept> model.","pos":[787,991],"source":"When serializing [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] objects, the serializer understands a variety of serialization programming models, including the new *data contract* model."},{"content":"For a full list of supported types, see <bpt id=\"p1\">[</bpt>Types Supported by the Data Contract Serializer<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/types-supported-by-the-data-contract-serializer.md)</ept>.","pos":[992,1181],"source":" For a full list of supported types, see [Types Supported by the Data Contract Serializer](../../../../docs/framework/wcf/feature-details/types-supported-by-the-data-contract-serializer.md)."},{"content":"For an introduction to data contracts, see <bpt id=\"p1\">[</bpt>Using Data Contracts<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/using-data-contracts.md)</ept>.","pos":[1182,1320],"source":" For an introduction to data contracts, see [Using Data Contracts](../../../../docs/framework/wcf/feature-details/using-data-contracts.md)."},{"content":"When deserializing XML, the serializer uses the <ph id=\"ph1\">&lt;xref:System.Xml.XmlReader&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Xml.XmlWriter&gt;</ph> classes.","pos":[1327,1443],"source":"When deserializing XML, the serializer uses the <xref:System.Xml.XmlReader> and <xref:System.Xml.XmlWriter> classes."},{"content":"It also supports the <ph id=\"ph1\">&lt;xref:System.Xml.XmlDictionaryReader&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Xml.XmlDictionaryWriter&gt;</ph> classes to enable it to produce optimized XML in some cases, such as when using the <ph id=\"ph3\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> binary XML format.","pos":[1444,1703],"source":" It also supports the <xref:System.Xml.XmlDictionaryReader> and <xref:System.Xml.XmlDictionaryWriter> classes to enable it to produce optimized XML in some cases, such as when using the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] binary XML format."},{"content":"<ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> also includes a companion serializer, the <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.NetDataContractSerializer&gt;</ph>.","pos":[1710,1870],"source":"[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] also includes a companion serializer, the <xref:System.Runtime.Serialization.NetDataContractSerializer>."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.NetDataContractSerializer&gt;</ph> is similar to the <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter&gt;</ph> serializers because it also emits <ph id=\"ph4\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> type names as part of the serialized data.","pos":[1871,2235],"source":" The <xref:System.Runtime.Serialization.NetDataContractSerializer> is similar to the <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> and <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter> serializers because it also emits [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] type names as part of the serialized data."},{"content":"It is used when the same types are shared on the serializing and the deserializing ends.","pos":[2236,2324]},{"content":"Both the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.DataContractSerializer&gt;</ph> and the <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.NetDataContractSerializer&gt;</ph> derive from a common base class, the <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer&gt;</ph>.","pos":[2325,2556],"source":" Both the <xref:System.Runtime.Serialization.DataContractSerializer> and the <xref:System.Runtime.Serialization.NetDataContractSerializer> derive from a common base class, the <xref:System.Runtime.Serialization.XmlObjectSerializer>."},{"pos":[2564,2828],"content":"[!WARNING]\n The <xref:System.Runtime.Serialization.DataContractSerializer> serializes strings containing control characters with a hexadecimal value below 20 as XML entities. This may cause a problem with a non-WCF client went sending such data to a WCF service.","leadings":["","> "],"nodes":[{"content":"The <xref:System.Runtime.Serialization.DataContractSerializer> serializes strings containing control characters with a hexadecimal value below 20 as XML entities. This may cause a problem with a non-WCF client went sending such data to a WCF service.","pos":[12,262],"nodes":[{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.DataContractSerializer&gt;</ph> serializes strings containing control characters with a hexadecimal value below 20 as XML entities.","pos":[0,162],"source":"The <xref:System.Runtime.Serialization.DataContractSerializer> serializes strings containing control characters with a hexadecimal value below 20 as XML entities."},{"content":"This may cause a problem with a non-WCF client went sending such data to a WCF service.","pos":[163,250]}]}]},{"pos":[2837,2879],"content":"Creating a DataContractSerializer Instance","linkify":"Creating a DataContractSerializer Instance","nodes":[{"content":"Creating a DataContractSerializer Instance","pos":[0,42]}]},{"content":"Constructing an instance of the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.DataContractSerializer&gt;</ph> is an important step.","pos":[2883,2995],"source":"Constructing an instance of the <xref:System.Runtime.Serialization.DataContractSerializer> is an important step."},{"content":"After construction, you cannot change any of the settings.","pos":[2996,3054]},{"pos":[3064,3088],"content":"Specifying the Root Type","linkify":"Specifying the Root Type","nodes":[{"content":"Specifying the Root Type","pos":[0,24]}]},{"content":"The <bpt id=\"p1\">*</bpt>root type<ept id=\"p1\">*</ept> is the type of which instances are serialized or deserialized.","pos":[3092,3170],"source":"The *root type* is the type of which instances are serialized or deserialized."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.DataContractSerializer&gt;</ph> has many constructor overloads, but, at a minimum, a root type must be supplied using the <ph id=\"ph2\">`type`</ph> parameter.","pos":[3171,3341],"source":" The <xref:System.Runtime.Serialization.DataContractSerializer> has many constructor overloads, but, at a minimum, a root type must be supplied using the `type` parameter."},{"content":"A serializer created for a certain root type cannot be used to serialize (or deserialize) another type, unless the type is derived from the root type.","pos":[3348,3498]},{"content":"The following example shows two classes.","pos":[3499,3539]},{"pos":[3546,3859],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_StandaloneDataContractSerializer#1<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#1)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_StandaloneDataContractSerializer#1<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#1)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[c_StandaloneDataContractSerializer#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#1)]\n [!code-vb[c_StandaloneDataContractSerializer#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#1)]"},{"pos":[3866,4013],"content":"This code constructs an instance of the <ph id=\"ph1\">`DataContractSerializer`</ph> that can be used only to serialize or deserialize instances of the <ph id=\"ph2\">`Person`</ph> class.","source":"This code constructs an instance of the `DataContractSerializer` that can be used only to serialize or deserialize instances of the `Person` class."},{"pos":[4020,4333],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_StandaloneDataContractSerializer#2<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#2)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_StandaloneDataContractSerializer#2<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#2)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[c_StandaloneDataContractSerializer#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#2)]\n [!code-vb[c_StandaloneDataContractSerializer#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#2)]"},{"pos":[4343,4365],"content":"Specifying Known Types","linkify":"Specifying Known Types","nodes":[{"content":"Specifying Known Types","pos":[0,22]}]},{"content":"If polymorphism is involved in the types being serialized that is not already handled using the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.KnownTypeAttribute&gt;</ph> attribute or some other mechanism, a list of possible known types must be passed to the serializer’s constructor using the <ph id=\"ph2\">`knownTypes`</ph> parameter.","pos":[4369,4666],"source":"If polymorphism is involved in the types being serialized that is not already handled using the <xref:System.Runtime.Serialization.KnownTypeAttribute> attribute or some other mechanism, a list of possible known types must be passed to the serializer’s constructor using the `knownTypes` parameter."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> known types, see <bpt id=\"p1\">[</bpt>Data Contract Known Types<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/data-contract-known-types.md)</ept>.","pos":[4667,4845],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] known types, see [Data Contract Known Types](../../../../docs/framework/wcf/feature-details/data-contract-known-types.md)."},{"content":"The following example shows a class, <ph id=\"ph1\">`LibraryPatron`</ph>, that includes a collection of a specific type, the <ph id=\"ph2\">`LibraryItem`</ph>.","pos":[4852,4971],"source":"The following example shows a class, `LibraryPatron`, that includes a collection of a specific type, the `LibraryItem`."},{"content":"The second class defines the <ph id=\"ph1\">`LibraryItem`</ph> type.","pos":[4972,5020],"source":" The second class defines the `LibraryItem` type."},{"content":"The third and four classes (<ph id=\"ph1\">`Book`</ph> and <ph id=\"ph2\">`Newspaper`</ph>) inherit from the <ph id=\"ph3\">`LibraryItem`</ph> class.","pos":[5021,5110],"source":" The third and four classes (`Book` and `Newspaper`) inherit from the `LibraryItem` class."},{"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_StandaloneDataContractSerializer#3<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#3)</ept><ept id=\"p1\">]</ept>","pos":[5117,5272],"source":"[!code-csharp[c_StandaloneDataContractSerializer#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#3)]"},{"content":"<bpt id=\"p1\">[!code-vb</bpt><bpt id=\"p2\">[</bpt>c_StandaloneDataContractSerializer#3<ept id=\"p2\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#3)</ept><ept id=\"p1\">]</ept>","pos":[5277,5433],"source":"[!code-vb[c_StandaloneDataContractSerializer#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#3)]"},{"pos":[5440,5533],"content":"The following code constructs an instance of the serializer using the <ph id=\"ph1\">`knownTypes`</ph> parameter.","source":"The following code constructs an instance of the serializer using the `knownTypes` parameter."},{"pos":[5540,5853],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_StandaloneDataContractSerializer#4<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#4)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_StandaloneDataContractSerializer#4<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#4)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[c_StandaloneDataContractSerializer#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#4)]\n [!code-vb[c_StandaloneDataContractSerializer#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#4)]"},{"pos":[5863,5909],"content":"Specifying the Default Root Name and Namespace","linkify":"Specifying the Default Root Name and Namespace","nodes":[{"content":"Specifying the Default Root Name and Namespace","pos":[0,46]}]},{"content":"Normally, when an object is serialized, the default name and namespace of the outermost XML element are determined according to the data contract name and namespace.","pos":[5913,6078]},{"content":"The names of all inner elements are determined from data member names, and their namespace is the data contract’s namespace.","pos":[6079,6203]},{"content":"The following example sets <ph id=\"ph1\">`Name`</ph> and <ph id=\"ph2\">`Namespace`</ph> values in the constructors of the <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.DataContractAttribute&gt;</ph> and <ph id=\"ph4\">&lt;xref:System.Runtime.Serialization.DataMemberAttribute&gt;</ph> classes.","pos":[6204,6414],"source":" The following example sets `Name` and `Namespace` values in the constructors of the <xref:System.Runtime.Serialization.DataContractAttribute> and <xref:System.Runtime.Serialization.DataMemberAttribute> classes."},{"pos":[6421,6734],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_StandaloneDataContractSerializer#5<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#5)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_StandaloneDataContractSerializer#5<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#5)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[c_StandaloneDataContractSerializer#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#5)]\n [!code-vb[c_StandaloneDataContractSerializer#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#5)]"},{"pos":[6741,6825],"content":"Serializing an instance of the <ph id=\"ph1\">`Person`</ph> class produces XML similar to the following.","source":"Serializing an instance of the `Person` class produces XML similar to the following."},{"content":"However, you can customize the default name and namespace of the root element by passing the values of the <ph id=\"ph1\">`rootName`</ph> and <ph id=\"ph2\">`rootNamespace`</ph> parameters to the <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.DataContractSerializer&gt;</ph> constructor.","pos":[7014,7241],"source":"However, you can customize the default name and namespace of the root element by passing the values of the `rootName` and `rootNamespace` parameters to the <xref:System.Runtime.Serialization.DataContractSerializer> constructor."},{"content":"Note that the <ph id=\"ph1\">`rootNamespace`</ph> does not affect the namespace of the contained elements that correspond to data members.","pos":[7242,7360],"source":" Note that the `rootNamespace` does not affect the namespace of the contained elements that correspond to data members."},{"content":"It affects only the namespace of the outermost element.","pos":[7361,7416]},{"content":"These values can be passed as strings or instances of the <ph id=\"ph1\">&lt;xref:System.Xml.XmlDictionaryString&gt;</ph> class to allow for their optimization using the binary XML format.","pos":[7423,7585],"source":"These values can be passed as strings or instances of the <xref:System.Xml.XmlDictionaryString> class to allow for their optimization using the binary XML format."},{"pos":[7595,7628],"content":"Setting the Maximum Objects Quota","linkify":"Setting the Maximum Objects Quota","nodes":[{"content":"Setting the Maximum Objects Quota","pos":[0,33]}]},{"content":"Some <ph id=\"ph1\">`DataContractSerializer`</ph> constructor overloads have a <ph id=\"ph2\">`maxItemsInObjectGraph`</ph> parameter.","pos":[7632,7725],"source":"Some `DataContractSerializer` constructor overloads have a `maxItemsInObjectGraph` parameter."},{"content":"This parameter determines the maximum number of objects the serializer serializes or deserializes in a single <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer.ReadObject%2A&gt;</ph> method call.","pos":[7726,7918],"source":" This parameter determines the maximum number of objects the serializer serializes or deserializes in a single <xref:System.Runtime.Serialization.XmlObjectSerializer.ReadObject%2A> method call."},{"content":"(The method always reads one root object, but this object may have other objects in its data members.","pos":[7919,8020]},{"content":"Those objects may have other objects, and so on.) The default is 65536.","pos":[8021,8092]},{"content":"Note that when serializing or deserializing arrays, every array entry counts as a separate object.","pos":[8093,8191]},{"content":"Also, note that some objects may have a large memory representation, and so this quota alone may not be sufficient to prevent a denial of service attack.","pos":[8192,8345]},{"content":"<ph id=\"ph1\">[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]</ph><bpt id=\"p1\">[</bpt>Security Considerations for Data<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md)</ept>.","pos":[8346,8524],"source":"[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][Security Considerations for Data](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md)."},{"content":"If you need to increase this quota beyond the default value, it is important to do so both on the sending (serializing) and receiving (deserializing) sides because it applies to both when reading and writing data.","pos":[8525,8738]},{"pos":[8748,8759],"content":"Round Trips","linkify":"Round Trips","nodes":[{"content":"Round Trips","pos":[0,11]}]},{"content":"A <bpt id=\"p1\">*</bpt>round trip<ept id=\"p1\">*</ept> occurs when an object is deserialized and re-serialized in one operation.","pos":[8763,8851],"source":"A *round trip* occurs when an object is deserialized and re-serialized in one operation."},{"content":"Thus, it goes from XML to an object instance, and back again into an XML stream.","pos":[8852,8932]},{"content":"Some <ph id=\"ph1\">`DataContractSerializer`</ph> constructor overloads have an <ph id=\"ph2\">`ignoreExtensionDataObject`</ph> parameter, which is set to <ph id=\"ph3\">`false`</ph> by default.","pos":[8939,9073],"source":"Some `DataContractSerializer` constructor overloads have an `ignoreExtensionDataObject` parameter, which is set to `false` by default."},{"content":"In this default mode, data can be sent on a round trip from a newer version of a data contract through an older version and back to the newer version without loss, as long as the data contract implements the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IExtensibleDataObject&gt;</ph> interface.","pos":[9074,9350],"source":" In this default mode, data can be sent on a round trip from a newer version of a data contract through an older version and back to the newer version without loss, as long as the data contract implements the <xref:System.Runtime.Serialization.IExtensibleDataObject> interface."},{"content":"For example, suppose version 1 of the <ph id=\"ph1\">`Person`</ph> data contract contains the <ph id=\"ph2\">`Name`</ph> and <ph id=\"ph3\">`PhoneNumber`</ph> data members, and version 2 adds a <ph id=\"ph4\">`Nickname`</ph> member.","pos":[9351,9503],"source":" For example, suppose version 1 of the `Person` data contract contains the `Name` and `PhoneNumber` data members, and version 2 adds a `Nickname` member."},{"content":"If <ph id=\"ph1\">`IExtensibleDataObject`</ph> is implemented, when sending information from version 2 to version 1, the <ph id=\"ph2\">`Nickname`</ph> data is stored, and then re-emitted when the data is serialized again; therefore, no data is lost in the round trip.","pos":[9504,9732],"source":" If `IExtensibleDataObject` is implemented, when sending information from version 2 to version 1, the `Nickname` data is stored, and then re-emitted when the data is serialized again; therefore, no data is lost in the round trip."},{"content":"<ph id=\"ph1\">[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]</ph><bpt id=\"p1\">[</bpt>Forward-Compatible Data Contracts<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/forward-compatible-data-contracts.md)</ept> and <bpt id=\"p2\">[</bpt>Data Contract Versioning<ept id=\"p2\">](../../../../docs/framework/wcf/feature-details/data-contract-versioning.md)</ept>.","pos":[9733,10020],"source":"[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][Forward-Compatible Data Contracts](../../../../docs/framework/wcf/feature-details/forward-compatible-data-contracts.md) and [Data Contract Versioning](../../../../docs/framework/wcf/feature-details/data-contract-versioning.md)."},{"pos":[10031,10085],"content":"Security and Schema Validity Concerns with Round Trips","linkify":"Security and Schema Validity Concerns with Round Trips","nodes":[{"content":"Security and Schema Validity Concerns with Round Trips","pos":[0,54]}]},{"content":"Round trips may have security implications.","pos":[10089,10132]},{"content":"For example, deserializing and storing large amounts of extraneous data may be a security risk.","pos":[10133,10228]},{"content":"There may be security concerns about re-emitting this data that there is no way to verify, especially if digital signatures are involved.","pos":[10229,10366]},{"content":"For example, in the previous scenario, the version 1 endpoint could be signing a <ph id=\"ph1\">`Nickname`</ph> value that contains malicious data.","pos":[10367,10494],"source":" For example, in the previous scenario, the version 1 endpoint could be signing a `Nickname` value that contains malicious data."},{"content":"Finally, there may be schema validity concerns: an endpoint may want to always emit data that strictly adheres to its stated contract and not any extra values.","pos":[10495,10654]},{"content":"In the previous example, the version 1 endpoint’s contract says that it emits only <ph id=\"ph1\">`Name`</ph> and <ph id=\"ph2\">`PhoneNumber`</ph>, and if schema validation is being used, emitting the extra <ph id=\"ph3\">`Nickname`</ph> value causes validation to fail.","pos":[10655,10866],"source":" In the previous example, the version 1 endpoint’s contract says that it emits only `Name` and `PhoneNumber`, and if schema validation is being used, emitting the extra `Nickname` value causes validation to fail."},{"pos":[10877,10911],"content":"Enabling and Disabling Round Trips","linkify":"Enabling and Disabling Round Trips","nodes":[{"content":"Enabling and Disabling Round Trips","pos":[0,34]}]},{"content":"To turn off round trips, do not implement the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IExtensibleDataObject&gt;</ph> interface.","pos":[10915,11029],"source":"To turn off round trips, do not implement the <xref:System.Runtime.Serialization.IExtensibleDataObject> interface."},{"content":"If you have no control over the types, set the <ph id=\"ph1\">`ignoreExtensionDataObject`</ph> parameter to <ph id=\"ph2\">`true`</ph> to achieve the same effect.","pos":[11030,11152],"source":" If you have no control over the types, set the `ignoreExtensionDataObject` parameter to `true` to achieve the same effect."},{"pos":[11162,11187],"content":"Object Graph Preservation","linkify":"Object Graph Preservation","nodes":[{"content":"Object Graph Preservation","pos":[0,25]}]},{"content":"Normally, the serializer does not care about object identity, as in the following code.","pos":[11191,11278]},{"pos":[11285,11598],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_StandaloneDataContractSerializer#6<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#6)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_StandaloneDataContractSerializer#6<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#6)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[c_StandaloneDataContractSerializer#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#6)]\n [!code-vb[c_StandaloneDataContractSerializer#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#6)]"},{"content":"The following code creates a purchase order.","pos":[11605,11649]},{"pos":[11656,11969],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_StandaloneDataContractSerializer#7<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#7)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_StandaloneDataContractSerializer#7<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#7)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[c_StandaloneDataContractSerializer#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#7)]\n [!code-vb[c_StandaloneDataContractSerializer#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#7)]"},{"content":"Notice that <ph id=\"ph1\">`billTo`</ph> and <ph id=\"ph2\">`shipTo`</ph> fields are set to the same object instance.","pos":[11976,12053],"source":"Notice that `billTo` and `shipTo` fields are set to the same object instance."},{"content":"However, the generated XML duplicates the information duplicated, and looks similar to the following XML.","pos":[12054,12159]},{"content":"However, this approach has the following characteristics, which may be undesirable:","pos":[12320,12403]},{"content":"Performance.","pos":[12413,12425]},{"content":"Replicating data is inefficient.","pos":[12426,12458]},{"content":"Circular references.","pos":[12468,12488]},{"content":"If objects refer to themselves, even through other objects, serializing by replication results in an infinite loop.","pos":[12489,12604]},{"content":"(The serializer throws a <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.SerializationException&gt;</ph> if this happens.)","pos":[12605,12706],"source":" (The serializer throws a <xref:System.Runtime.Serialization.SerializationException> if this happens.)"},{"content":"Semantics.","pos":[12716,12726]},{"content":"Sometimes it is important to preserve the fact that two references are to the same object, and not to two identical objects.","pos":[12727,12851]},{"content":"For these reasons, some <ph id=\"ph1\">`DataContractSerializer`</ph> constructor overloads have a <ph id=\"ph2\">`preserveObjectReferences`</ph> parameter (the default is <ph id=\"ph3\">`false`</ph>).","pos":[12858,12998],"source":"For these reasons, some `DataContractSerializer` constructor overloads have a `preserveObjectReferences` parameter (the default is `false`)."},{"content":"When this parameter is set to <ph id=\"ph1\">`true`</ph>, a special method of encoding object references, which only <ph id=\"ph2\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> understands, is used.","pos":[12999,13173],"source":" When this parameter is set to `true`, a special method of encoding object references, which only [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] understands, is used."},{"content":"When set to <ph id=\"ph1\">`true`</ph>, the XML code example now resembles the following.","pos":[13174,13243],"source":" When set to `true`, the XML code example now resembles the following."},{"content":"The \"ser\" namespace refers to the standard serialization namespace, http://schemas.microsoft.com/2003/10/Serialization/.","pos":[13412,13532]},{"content":"Each piece of data is serialized only once and given an ID number, and subsequent uses result in a reference to the already serialized data.","pos":[13533,13673]},{"pos":[13681,13848],"content":"[!IMPORTANT]\n If both \"id\" and \"ref\" attributes are present in the data contract `XMLElement`, then the \"ref\" attribute is honored and the \"id\" attribute is ignored.","leadings":["","> "],"nodes":[{"content":"If both \"id\" and \"ref\" attributes are present in the data contract <ph id=\"ph1\">`XMLElement`</ph>, then the \"ref\" attribute is honored and the \"id\" attribute is ignored.","pos":[14,165],"source":"If both \"id\" and \"ref\" attributes are present in the data contract `XMLElement`, then the \"ref\" attribute is honored and the \"id\" attribute is ignored."}]},{"content":"It is important to understand the limitations of this mode:","pos":[13855,13914]},{"pos":[13924,14188],"content":"The XML the <ph id=\"ph1\">`DataContractSerializer`</ph> produces with <ph id=\"ph2\">`preserveObjectReferences`</ph> set to <ph id=\"ph3\">`true`</ph> is not interoperable with any other technologies, and can be accessed only by another <ph id=\"ph4\">`DataContractSerializer`</ph> instance, also with <ph id=\"ph5\">`preserveObjectReferences`</ph> set to <ph id=\"ph6\">`true`</ph>.","source":"The XML the `DataContractSerializer` produces with `preserveObjectReferences` set to `true` is not interoperable with any other technologies, and can be accessed only by another `DataContractSerializer` instance, also with `preserveObjectReferences` set to `true`."},{"content":"There is no metadata (schema) support for this feature.","pos":[14198,14253]},{"content":"The schema that is produced is valid only for the case when <ph id=\"ph1\">`preserveObjectReferences`</ph> is set to <ph id=\"ph2\">`false`</ph>.","pos":[14254,14359],"source":" The schema that is produced is valid only for the case when `preserveObjectReferences` is set to `false`."},{"content":"This feature may cause the serialization and deserialization process to run slower.","pos":[14369,14452]},{"content":"Although data does not have to be replicated, extra object comparisons must be performed in this mode.","pos":[14453,14555]},{"pos":[14563,14925],"content":"[!CAUTION]\n When the `preserveObjectReferences` mode is enabled, it is especially important to set the `maxItemsInObjectGraph` value to the correct quota. Due to the way arrays are handled in this mode, it is easy for an attacker to construct a small malicious message that results in large memory consumption limited only by the `maxItemsInObjectGraph` quota.","leadings":["","> "],"nodes":[{"content":"When the `preserveObjectReferences` mode is enabled, it is especially important to set the `maxItemsInObjectGraph` value to the correct quota. Due to the way arrays are handled in this mode, it is easy for an attacker to construct a small malicious message that results in large memory consumption limited only by the `maxItemsInObjectGraph` quota.","pos":[12,360],"nodes":[{"content":"When the <ph id=\"ph1\">`preserveObjectReferences`</ph> mode is enabled, it is especially important to set the <ph id=\"ph2\">`maxItemsInObjectGraph`</ph> value to the correct quota.","pos":[0,142],"source":"When the `preserveObjectReferences` mode is enabled, it is especially important to set the `maxItemsInObjectGraph` value to the correct quota."},{"content":"Due to the way arrays are handled in this mode, it is easy for an attacker to construct a small malicious message that results in large memory consumption limited only by the <ph id=\"ph1\">`maxItemsInObjectGraph`</ph> quota.","pos":[143,348],"source":" Due to the way arrays are handled in this mode, it is easy for an attacker to construct a small malicious message that results in large memory consumption limited only by the `maxItemsInObjectGraph` quota."}]}]},{"pos":[14935,14971],"content":"Specifying a Data Contract Surrogate","linkify":"Specifying a Data Contract Surrogate","nodes":[{"content":"Specifying a Data Contract Surrogate","pos":[0,36]}]},{"content":"Some <ph id=\"ph1\">`DataContractSerializer`</ph> constructor overloads have a <ph id=\"ph2\">`dataContractSurrogate`</ph> parameter, which may be set to <ph id=\"ph3\">`null`</ph>.","pos":[14975,15096],"source":"Some `DataContractSerializer` constructor overloads have a `dataContractSurrogate` parameter, which may be set to `null`."},{"content":"Otherwise, you can use it to specify a <bpt id=\"p1\">*</bpt>data contract surrogate<ept id=\"p1\">*</ept>, which is a type that implements the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.IDataContractSurrogate&gt;</ph> interface.","pos":[15097,15268],"source":" Otherwise, you can use it to specify a *data contract surrogate*, which is a type that implements the <xref:System.Runtime.Serialization.IDataContractSurrogate> interface."},{"content":"You can then use the interface to customize the serialization and deserialization process.","pos":[15269,15359]},{"content":"<ph id=\"ph1\">[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]</ph><bpt id=\"p1\">[</bpt>Data Contract Surrogates<ept id=\"p1\">](../../../../docs/framework/wcf/extending/data-contract-surrogates.md)</ept>.","pos":[15360,15516],"source":"[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][Data Contract Surrogates](../../../../docs/framework/wcf/extending/data-contract-surrogates.md)."},{"pos":[15525,15538],"content":"Serialization","linkify":"Serialization","nodes":[{"content":"Serialization","pos":[0,13]}]},{"content":"The following information applies to any class that inherits from the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer&gt;</ph>, including the <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.DataContractSerializer&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.NetDataContractSerializer&gt;</ph> classes.","pos":[15542,15816],"source":"The following information applies to any class that inherits from the <xref:System.Runtime.Serialization.XmlObjectSerializer>, including the <xref:System.Runtime.Serialization.DataContractSerializer> and <xref:System.Runtime.Serialization.NetDataContractSerializer> classes."},{"pos":[15826,15846],"content":"Simple Serialization","linkify":"Simple Serialization","nodes":[{"content":"Simple Serialization","pos":[0,20]}]},{"content":"The most basic way to serialize an object is to pass it to the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer.WriteObject%2A&gt;</ph> method.","pos":[15850,15991],"source":"The most basic way to serialize an object is to pass it to the <xref:System.Runtime.Serialization.XmlObjectSerializer.WriteObject%2A> method."},{"content":"There are three overloads, one each for writing to a <ph id=\"ph1\">&lt;xref:System.IO.Stream&gt;</ph>, an <ph id=\"ph2\">&lt;xref:System.Xml.XmlWriter&gt;</ph>, or an <ph id=\"ph3\">&lt;xref:System.Xml.XmlDictionaryWriter&gt;</ph>.","pos":[15992,16146],"source":" There are three overloads, one each for writing to a <xref:System.IO.Stream>, an <xref:System.Xml.XmlWriter>, or an <xref:System.Xml.XmlDictionaryWriter>."},{"content":"With the <ph id=\"ph1\">&lt;xref:System.IO.Stream&gt;</ph> overload, the output is XML in the UTF-8 encoding.","pos":[16147,16230],"source":" With the <xref:System.IO.Stream> overload, the output is XML in the UTF-8 encoding."},{"content":"With the <ph id=\"ph1\">&lt;xref:System.Xml.XmlDictionaryWriter&gt;</ph> overload, the serializer optimizes its output for binary XML.","pos":[16231,16339],"source":" With the <xref:System.Xml.XmlDictionaryWriter> overload, the serializer optimizes its output for binary XML."},{"content":"When using the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer.WriteObject%2A&gt;</ph> method, the serializer uses the default name and namespace for the wrapper element and writes it out along with the contents (see the previous \"Specifying the Default Root Name and Namespace\" section).","pos":[16346,16633],"source":"When using the <xref:System.Runtime.Serialization.XmlObjectSerializer.WriteObject%2A> method, the serializer uses the default name and namespace for the wrapper element and writes it out along with the contents (see the previous \"Specifying the Default Root Name and Namespace\" section)."},{"content":"The following example demonstrates writing with an <ph id=\"ph1\">&lt;xref:System.Xml.XmlDictionaryWriter&gt;</ph>.","pos":[16640,16729],"source":"The following example demonstrates writing with an <xref:System.Xml.XmlDictionaryWriter>."},{"pos":[16736,17049],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_StandaloneDataContractSerializer#8<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#8)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_StandaloneDataContractSerializer#8<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#8)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[c_StandaloneDataContractSerializer#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#8)]\n [!code-vb[c_StandaloneDataContractSerializer#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#8)]"},{"content":"This produces XML similar to the following.","pos":[17056,17099]},{"pos":[17211,17237],"content":"Step-By-Step Serialization","linkify":"Step-By-Step Serialization","nodes":[{"content":"Step-By-Step Serialization","pos":[0,26]}]},{"content":"Use the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer.WriteStartObject%2A&gt;</ph>, <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer.WriteObjectContent%2A&gt;</ph>, and <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer.WriteEndObject%2A&gt;</ph> methods to write the end element, write the object contents, and close the wrapper element, respectively.","pos":[17241,17588],"source":"Use the <xref:System.Runtime.Serialization.XmlObjectSerializer.WriteStartObject%2A>, <xref:System.Runtime.Serialization.XmlObjectSerializer.WriteObjectContent%2A>, and <xref:System.Runtime.Serialization.XmlObjectSerializer.WriteEndObject%2A> methods to write the end element, write the object contents, and close the wrapper element, respectively."},{"pos":[17596,17671],"content":"[!NOTE]\n There are no <xref:System.IO.Stream> overloads of these methods.","leadings":["","> "],"nodes":[{"content":"There are no <ph id=\"ph1\">&lt;xref:System.IO.Stream&gt;</ph> overloads of these methods.","pos":[9,73],"source":"There are no <xref:System.IO.Stream> overloads of these methods."}]},{"content":"This step-by-step serialization has two common uses.","pos":[17678,17730]},{"content":"One is to insert contents such as attributes or comments between <ph id=\"ph1\">`WriteStartObject`</ph> and <ph id=\"ph2\">`WriteObjectContent`</ph>,  as shown in the following example.","pos":[17731,17876],"source":" One is to insert contents such as attributes or comments between `WriteStartObject` and `WriteObjectContent`,  as shown in the following example."},{"pos":[17883,18196],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_StandaloneDataContractSerializer#9<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#9)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_StandaloneDataContractSerializer#9<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#9)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[c_StandaloneDataContractSerializer#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#9)]\n [!code-vb[c_StandaloneDataContractSerializer#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#9)]"},{"content":"This produces XML similar to the following.","pos":[18203,18246]},{"content":"Another common use is to avoid using <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer.WriteStartObject%2A&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer.WriteEndObject%2A&gt;</ph> entirely, and to write your own custom wrapper element (or even skip writing a wrapper altogether), as shown in the following code.","pos":[18377,18699],"source":"Another common use is to avoid using <xref:System.Runtime.Serialization.XmlObjectSerializer.WriteStartObject%2A> and <xref:System.Runtime.Serialization.XmlObjectSerializer.WriteEndObject%2A> entirely, and to write your own custom wrapper element (or even skip writing a wrapper altogether), as shown in the following code."},{"pos":[18706,19023],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_StandaloneDataContractSerializer#10<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#10)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_StandaloneDataContractSerializer#10<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#10)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[c_StandaloneDataContractSerializer#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#10)]\n [!code-vb[c_StandaloneDataContractSerializer#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#10)]"},{"content":"This produces XML similar to the following.","pos":[19030,19073]},{"pos":[19201,19278],"content":"[!NOTE]\n Using step-by-step serialization may result in schema-invalid XML.","leadings":["","> "],"nodes":[{"content":"Using step-by-step serialization may result in schema-invalid XML.","pos":[9,75]}]},{"pos":[19287,19302],"content":"Deserialization","linkify":"Deserialization","nodes":[{"content":"Deserialization","pos":[0,15]}]},{"content":"The following information applies to any class that inherits from the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer&gt;</ph>, including the <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.DataContractSerializer&gt;</ph> and <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.NetDataContractSerializer&gt;</ph> classes.","pos":[19306,19580],"source":"The following information applies to any class that inherits from the <xref:System.Runtime.Serialization.XmlObjectSerializer>, including the <xref:System.Runtime.Serialization.DataContractSerializer> and <xref:System.Runtime.Serialization.NetDataContractSerializer> classes."},{"content":"The most basic way to deserialize an object is to call one of the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer.ReadObject%2A&gt;</ph> method overloads.","pos":[19587,19740],"source":"The most basic way to deserialize an object is to call one of the <xref:System.Runtime.Serialization.XmlObjectSerializer.ReadObject%2A> method overloads."},{"content":"There are three overloads, one each for reading with a <ph id=\"ph1\">&lt;xref:System.Xml.XmlDictionaryReader&gt;</ph>, an <ph id=\"ph2\">`XmlReader`</ph>, or a <ph id=\"ph3\">`Stream`</ph>.","pos":[19741,19865],"source":" There are three overloads, one each for reading with a <xref:System.Xml.XmlDictionaryReader>, an `XmlReader`, or a `Stream`."},{"content":"Note that the <ph id=\"ph1\">`Stream`</ph> overload creates a textual <ph id=\"ph2\">&lt;xref:System.Xml.XmlDictionaryReader&gt;</ph> that is not protected by any quotas, and should be used only to read trusted data.","pos":[19866,20036],"source":" Note that the `Stream` overload creates a textual <xref:System.Xml.XmlDictionaryReader> that is not protected by any quotas, and should be used only to read trusted data."},{"pos":[20043,20138],"content":"Also note that the object the <ph id=\"ph1\">`ReadObject`</ph> method returns must be cast to the appropriate type.","source":"Also note that the object the `ReadObject` method returns must be cast to the appropriate type."},{"pos":[20145,20337],"content":"The following code constructs an instance of the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.DataContractSerializer&gt;</ph> and an <ph id=\"ph2\">&lt;xref:System.Xml.XmlDictionaryReader&gt;</ph>, then deserializes a <ph id=\"ph3\">`Person`</ph> instance.","source":"The following code constructs an instance of the <xref:System.Runtime.Serialization.DataContractSerializer> and an <xref:System.Xml.XmlDictionaryReader>, then deserializes a `Person` instance."},{"pos":[20344,20661],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_StandaloneDataContractSerializer#11<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#11)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_StandaloneDataContractSerializer#11<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#11)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[c_StandaloneDataContractSerializer#11](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#11)]\n [!code-vb[c_StandaloneDataContractSerializer#11](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#11)]"},{"content":"Before calling the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer.ReadObject%2A&gt;</ph> method, position the XML reader on the wrapper element or on a non-content node that precedes the wrapper element.","pos":[20668,20871],"source":"Before calling the <xref:System.Runtime.Serialization.XmlObjectSerializer.ReadObject%2A> method, position the XML reader on the wrapper element or on a non-content node that precedes the wrapper element."},{"content":"You can do this by calling the <ph id=\"ph1\">&lt;xref:System.Xml.XmlReader.Read%2A&gt;</ph> method of the <ph id=\"ph2\">&lt;xref:System.Xml.XmlReader&gt;</ph> or its derivation, and testing the <ph id=\"ph3\">&lt;xref:System.Xml.XmlReader.NodeType%2A&gt;</ph>, as shown in the following code.","pos":[20872,21088],"source":" You can do this by calling the <xref:System.Xml.XmlReader.Read%2A> method of the <xref:System.Xml.XmlReader> or its derivation, and testing the <xref:System.Xml.XmlReader.NodeType%2A>, as shown in the following code."},{"pos":[21095,21412],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>c_StandaloneDataContractSerializer#12<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#12)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>c_StandaloneDataContractSerializer#12<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#12)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[c_StandaloneDataContractSerializer#12](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_standalonedatacontractserializer/cs/source.cs#12)]\n [!code-vb[c_StandaloneDataContractSerializer#12](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_standalonedatacontractserializer/vb/source.vb#12)]"},{"pos":[21419,21519],"content":"Note that you can read attributes on this wrapper element before handing the reader to <ph id=\"ph1\">`ReadObject`</ph>.","source":"Note that you can read attributes on this wrapper element before handing the reader to `ReadObject`."},{"content":"When using one of the simple <ph id=\"ph1\">`ReadObject`</ph> overloads, the deserializer looks for the default name and namespace on the wrapper element (see the preceding section, \"Specifying the Default Root Name and Namespace\") and throws an exception if it finds an unknown element.","pos":[21526,21793],"source":"When using one of the simple `ReadObject` overloads, the deserializer looks for the default name and namespace on the wrapper element (see the preceding section, \"Specifying the Default Root Name and Namespace\") and throws an exception if it finds an unknown element."},{"content":"In the preceding example, the <ph id=\"ph1\">`&lt;Person&gt;`</ph> wrapper element is expected.","pos":[21794,21863],"source":" In the preceding example, the `<Person>` wrapper element is expected."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer.IsStartObject%2A&gt;</ph> method is called to verify that the reader is positioned on an element that is named as expected.","pos":[21864,22038],"source":" The <xref:System.Runtime.Serialization.XmlObjectSerializer.IsStartObject%2A> method is called to verify that the reader is positioned on an element that is named as expected."},{"content":"There is a way to disable this wrapper element name check; some overloads of the <ph id=\"ph1\">`ReadObject`</ph> method take the Boolean parameter <ph id=\"ph2\">`verifyObjectName`</ph>, which is set to <ph id=\"ph3\">`true`</ph> by default.","pos":[22045,22227],"source":"There is a way to disable this wrapper element name check; some overloads of the `ReadObject` method take the Boolean parameter `verifyObjectName`, which is set to `true` by default."},{"content":"When set to <ph id=\"ph1\">`false`</ph>, the name and namespace of the wrapper element is ignored.","pos":[22228,22306],"source":" When set to `false`, the name and namespace of the wrapper element is ignored."},{"content":"This is useful for reading XML that was written using the step-by-step serialization mechanism described previously.","pos":[22307,22423]},{"pos":[22432,22467],"content":"Using the NetDataContractSerializer","linkify":"Using the NetDataContractSerializer","nodes":[{"content":"Using the NetDataContractSerializer","pos":[0,35]}]},{"content":"The primary difference between the <ph id=\"ph1\">`DataContractSerializer`</ph> and the <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.NetDataContractSerializer&gt;</ph> is that the <ph id=\"ph3\">`DataContractSerializer`</ph> uses data contract names, whereas the <ph id=\"ph4\">`NetDataContractSerializer`</ph> outputs full <ph id=\"ph5\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> assembly and type names in the serialized XML.","pos":[22471,22827],"source":"The primary difference between the `DataContractSerializer` and the <xref:System.Runtime.Serialization.NetDataContractSerializer> is that the `DataContractSerializer` uses data contract names, whereas the `NetDataContractSerializer` outputs full [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] assembly and type names in the serialized XML."},{"content":"This means that the exact same types must be shared between the serialization and deserialization endpoints.","pos":[22828,22936]},{"content":"This means that the known types mechanism is not required with the <ph id=\"ph1\">`NetDataContractSerializer`</ph> because the exact types to be deserialized are always known.","pos":[22937,23092],"source":" This means that the known types mechanism is not required with the `NetDataContractSerializer` because the exact types to be deserialized are always known."},{"content":"However, several problems can occur:","pos":[23099,23135]},{"content":"Security.","pos":[23145,23154]},{"content":"Any type found in the XML being deserialized is loaded.","pos":[23155,23210]},{"content":"This can be exploited to force the loading of malicious types.","pos":[23211,23273]},{"content":"Using the <ph id=\"ph1\">`NetDataContractSerializer`</ph> with untrusted data should be done only if a <bpt id=\"p1\">*</bpt>Serialization Binder<ept id=\"p1\">*</ept> is used (using the <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.NetDataContractSerializer.Binder%2A&gt;</ph> property or constructor parameter).","pos":[23274,23506],"source":" Using the `NetDataContractSerializer` with untrusted data should be done only if a *Serialization Binder* is used (using the <xref:System.Runtime.Serialization.NetDataContractSerializer.Binder%2A> property or constructor parameter)."},{"content":"The binder permits only safe types to be loaded.","pos":[23507,23555]},{"content":"The Binder mechanism is identical to the one that types in the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization&gt;</ph> namespace use.","pos":[23556,23669],"source":" The Binder mechanism is identical to the one that types in the <xref:System.Runtime.Serialization> namespace use."},{"content":"Versioning.","pos":[23679,23690]},{"content":"Using full type and assembly names in the XML severely restricts how types can be versioned.","pos":[23691,23783]},{"content":"The following cannot be changed: type names, namespaces, assembly names, and assembly versions.","pos":[23784,23879]},{"content":"Setting the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.NetDataContractSerializer.AssemblyFormat%2A&gt;</ph> property or constructor parameter to <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.Formatters.FormatterAssemblyStyle&gt;</ph> instead of the default value of <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.Formatters.FormatterAssemblyStyle&gt;</ph> allows for assembly version changes, but not for generic parameter types.","pos":[23880,24254],"source":" Setting the <xref:System.Runtime.Serialization.NetDataContractSerializer.AssemblyFormat%2A> property or constructor parameter to <xref:System.Runtime.Serialization.Formatters.FormatterAssemblyStyle> instead of the default value of <xref:System.Runtime.Serialization.Formatters.FormatterAssemblyStyle> allows for assembly version changes, but not for generic parameter types."},{"content":"Interoperability.","pos":[24264,24281]},{"content":"Because <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> type and assembly names are included in the XML, platforms other than the <ph id=\"ph2\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> cannot access the resulting data.","pos":[24282,24525],"source":" Because [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] type and assembly names are included in the XML, platforms other than the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] cannot access the resulting data."},{"content":"Performance.","pos":[24535,24547]},{"content":"Writing out the type and assembly names significantly increases the size of the resulting XML.","pos":[24548,24642]},{"pos":[24649,24952],"content":"This mechanism is similar to binary or SOAP serialization used by <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> remoting (specifically, the <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter&gt;</ph> and the <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter&gt;</ph>).","source":"This mechanism is similar to binary or SOAP serialization used by [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] remoting (specifically, the <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> and the <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter>)."},{"pos":[24959,25078],"content":"Using the <ph id=\"ph1\">`NetDataContractSerializer`</ph> is similar to using the <ph id=\"ph2\">`DataContractSerializer`</ph>, with the following differences:","source":"Using the `NetDataContractSerializer` is similar to using the `DataContractSerializer`, with the following differences:"},{"content":"The constructors do not require you to specify a root type.","pos":[25088,25147]},{"content":"You can serialize any type with the same instance of the <ph id=\"ph1\">`NetDataContractSerializer`</ph>.","pos":[25148,25233],"source":" You can serialize any type with the same instance of the `NetDataContractSerializer`."},{"content":"The constructors do not accept a list of known types.","pos":[25243,25296]},{"content":"The known types mechanism is unnecessary if type names are serialized into the XML.","pos":[25297,25380]},{"content":"The constructors do not accept a data contract surrogate.","pos":[25390,25447]},{"content":"Instead, they accept an <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.ISurrogateSelector&gt;</ph> parameter called <ph id=\"ph2\">`surrogateSelector`</ph> (which maps to the <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.NetDataContractSerializer.SurrogateSelector%2A&gt;</ph> property).","pos":[25448,25676],"source":" Instead, they accept an <xref:System.Runtime.Serialization.ISurrogateSelector> parameter called `surrogateSelector` (which maps to the <xref:System.Runtime.Serialization.NetDataContractSerializer.SurrogateSelector%2A> property)."},{"content":"This is a legacy surrogate mechanism.","pos":[25677,25714]},{"content":"The constructors accept a parameter called <ph id=\"ph1\">`assemblyFormat`</ph> of the <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.Formatters.FormatterAssemblyStyle&gt;</ph> that maps to the <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.NetDataContractSerializer.AssemblyFormat%2A&gt;</ph> property.","pos":[25724,25967],"source":"The constructors accept a parameter called `assemblyFormat` of the <xref:System.Runtime.Serialization.Formatters.FormatterAssemblyStyle> that maps to the <xref:System.Runtime.Serialization.NetDataContractSerializer.AssemblyFormat%2A> property."},{"content":"As discussed previously, this can be used to enhance the versioning capabilities of the serializer.","pos":[25968,26067]},{"content":"This is identical to the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.Formatters.FormatterAssemblyStyle&gt;</ph> mechanism in binary or SOAP serialization.","pos":[26068,26205],"source":" This is identical to the <xref:System.Runtime.Serialization.Formatters.FormatterAssemblyStyle> mechanism in binary or SOAP serialization."},{"content":"The constructors accept a <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.StreamingContext&gt;</ph> parameter called <ph id=\"ph2\">`context`</ph> that maps to the <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.NetDataContractSerializer.Context%2A&gt;</ph> property.","pos":[26215,26420],"source":"The constructors accept a <xref:System.Runtime.Serialization.StreamingContext> parameter called `context` that maps to the <xref:System.Runtime.Serialization.NetDataContractSerializer.Context%2A> property."},{"content":"You can use this to pass information into types being serialized.","pos":[26421,26486]},{"content":"This usage is identical to that of the <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.StreamingContext&gt;</ph> mechanism used in other <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization&gt;</ph> classes.","pos":[26487,26647],"source":" This usage is identical to that of the <xref:System.Runtime.Serialization.StreamingContext> mechanism used in other <xref:System.Runtime.Serialization> classes."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.NetDataContractSerializer.Serialize%2A&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Runtime.Serialization.NetDataContractSerializer.Deserialize%2A&gt;</ph> methods are aliases for the <ph id=\"ph3\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer.WriteObject%2A&gt;</ph> and <ph id=\"ph4\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer.ReadObject%2A&gt;</ph> methods.","pos":[26657,26998],"source":"The <xref:System.Runtime.Serialization.NetDataContractSerializer.Serialize%2A> and <xref:System.Runtime.Serialization.NetDataContractSerializer.Deserialize%2A> methods are aliases for the <xref:System.Runtime.Serialization.XmlObjectSerializer.WriteObject%2A> and <xref:System.Runtime.Serialization.XmlObjectSerializer.ReadObject%2A> methods."},{"content":"These exist to provide a more consistent programming model with binary or SOAP serialization.","pos":[26999,27092]},{"pos":[27099,27264],"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> these features, see <bpt id=\"p1\">[</bpt>Binary Serialization<ept id=\"p1\">](../../../../docs/framework/serialization/binary-serialization.md)</ept>.","source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] these features, see [Binary Serialization](../../../../docs/framework/serialization/binary-serialization.md)."},{"content":"The XML formats that the <ph id=\"ph1\">`NetDataContractSerializer`</ph> and the <ph id=\"ph2\">`DataContractSerializer`</ph> use are normally not compatible.","pos":[27271,27389],"source":"The XML formats that the `NetDataContractSerializer` and the `DataContractSerializer` use are normally not compatible."},{"content":"That is, attempting to serialize with one of these serializers and deserialize with the other is not a supported scenario.","pos":[27390,27512]},{"content":"Also, note that the <ph id=\"ph1\">`NetDataContractSerializer`</ph> does not output the full <ph id=\"ph2\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> type and assembly name for each node in the object graph.","pos":[27519,27713],"source":"Also, note that the `NetDataContractSerializer` does not output the full [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] type and assembly name for each node in the object graph."},{"content":"It outputs that information only where it is ambiguous.","pos":[27714,27769]},{"content":"That is, it outputs at the root object level and for any polymorphic cases.","pos":[27770,27845]},{"pos":[27854,27862],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.DataContractSerializer&gt;</ph>","pos":[27866,27924],"source":"<xref:System.Runtime.Serialization.DataContractSerializer> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.NetDataContractSerializer&gt;</ph>","pos":[27929,27990],"source":"<xref:System.Runtime.Serialization.NetDataContractSerializer> "},{"content":"<ph id=\"ph1\">&lt;xref:System.Runtime.Serialization.XmlObjectSerializer&gt;</ph>","pos":[27995,28050],"source":"<xref:System.Runtime.Serialization.XmlObjectSerializer> "},{"content":"<bpt id=\"p1\">[</bpt>Binary Serialization<ept id=\"p1\">](../../../../docs/framework/serialization/binary-serialization.md)</ept><ph id=\"ph1\"> </ph>","pos":[28055,28144],"source":"[Binary Serialization](../../../../docs/framework/serialization/binary-serialization.md) "},{"content":"<bpt id=\"p1\">[</bpt>Types Supported by the Data Contract Serializer<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/types-supported-by-the-data-contract-serializer.md)</ept>","pos":[28148,28296],"source":"[Types Supported by the Data Contract Serializer](../../../../docs/framework/wcf/feature-details/types-supported-by-the-data-contract-serializer.md)"}]}