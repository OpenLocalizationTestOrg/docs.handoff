{"content":"---\ntitle: \"How to: Create a Registry Key and Set Its Value in Visual Basic\"\nms.date: 07/20/2015\nf1_keywords: \n  - \"RegistryKey.CreateSubKey\"\n  - \"RegistryKey.SetValue\"\nhelpviewer_keywords: \n  - \"registry keys [Visual Basic], creating\"\n  - \"registry [Visual Basic], adding values\"\n  - \"registry [Visual Basic], adding keys\"\n  - \"registry keys [Visual Basic], setting values\"\n  - \"examples [Visual Basic], registry\"\nms.assetid: d3e40f74-c283-480c-ab18-e5e9052cd814\n---\n# How to: Create a Registry Key and Set Its Value in Visual Basic\nThe `CreateSubKey` method of the `My.Computer.Registry` object can be used to create a registry key.  \n  \n## Procedure  \n  \n#### To create a registry key  \n  \n-   Use the `CreateSubKey` method, specifying which hive to place the key under as well as the name of the key. The parameter `Subkey` is not case-sensitive. This example creates the registry key `MyTestKey` under HKEY_CURRENT_USER.  \n  \n     [!code-vb[VbResourceTasks#17](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbResourceTasks/VB/Class1.vb#17)]  \n  \n#### To create a registry key and set a value in it  \n  \n1.  Use the `CreateSubkey` method, specifying which hive to place the key under as well as the name of the key. This example creates the registry key `MyTestKey` under HKEY_CURRENT_USER.  \n  \n     [!code-vb[VbResourceTasks#17](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbResourceTasks/VB/Class1.vb#17)]  \n  \n2.  Set the value with the `SetValue` method. This example sets the string value. \"MyTestKeyValue\" to \"This is a test value\".  \n  \n     [!code-vb[VbResourceTasks#14](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbResourceTasks/VB/Class1.vb#14)]  \n  \n## Example  \n This example creates the registry key `MyTestKey` under HKEY_CURRENT_USER and then sets the string value `MyTestKeyValue` to `This is a test value`.  \n  \n [!code-vb[VbResourceTasks#15](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbResourceTasks/VB/Class1.vb#15)]  \n  \n## Robust Programming  \n Examine the registry structure to find a suitable location for your key. For example, you may want to open the HKEY_CURRENT_USER\\Software key of the current user, and create a key with your company's name. Then add the registry values to your company's key.  \n  \n When reading the registry from a Web application, the current user depends on the authentication and impersonation implemented in the Web application.  \n  \n It is more secure to write data to the user folder (<xref:Microsoft.Win32.Registry.CurrentUser>) rather than to the local computer (<xref:Microsoft.Win32.Registry.LocalMachine>).  \n  \n When you create a registry value, you need to decide what to do if that value already exists. Another process, perhaps a malicious one, may have already created the value and have access to it. When you put data in the registry value, the data is available to the other process. To prevent this, use the <xref:Microsoft.Win32.RegistryKey.GetValue%2A> method. It returns `Nothing` if the key does not already exist.  \n  \n It is not secure to store secrets, such as passwords, in the registry as plain text, even if the registry key is protected by ACLs (Access Control Lists).  \n  \n The following conditions may cause an exception:  \n  \n-   The name of the key is `Nothing` (<xref:System.ArgumentNullException>).  \n  \n-   The user does not have permissions to create registry keys (<xref:System.Security.SecurityException>).  \n  \n-   The key name exceeds the 255-character limit (<xref:System.ArgumentException>).  \n  \n-   The key is closed (<xref:System.IO.IOException>).  \n  \n-   The registry key is read-only (<xref:System.UnauthorizedAccessException>).  \n  \n## .NET Framework Security  \n To run this process, your assembly requires a privilege level granted by the <xref:System.Security.Permissions.RegistryPermission> class. If you are running in a partial-trust context, the process might throw an exception due to insufficient privileges. Similarly, the user must have the correct ACLs for creating or writing to settings. For example, a local application that has the code access security permission might not have operating system permission. For more information, see [Code Access Security Basics](../../../../framework/misc/code-access-security-basics.md).  \n  \n## See also\n\n- <xref:Microsoft.VisualBasic.MyServices.RegistryProxy>\n- <xref:Microsoft.VisualBasic.MyServices.RegistryProxy.CurrentUser%2A>\n- <xref:Microsoft.Win32.RegistryKey.CreateSubKey%2A>\n- [Reading from and Writing to the Registry](../../../../visual-basic/developing-apps/programming/computer-resources/reading-from-and-writing-to-the-registry.md)\n- [Code Access Security Basics](../../../../framework/misc/code-access-security-basics.md)\n","nodes":[{"pos":[4,463],"embed":true,"restype":"x-metadata","content":"title: \"How to: Create a Registry Key and Set Its Value in Visual Basic\"\nms.date: 07/20/2015\nf1_keywords: \n  - \"RegistryKey.CreateSubKey\"\n  - \"RegistryKey.SetValue\"\nhelpviewer_keywords: \n  - \"registry keys [Visual Basic], creating\"\n  - \"registry [Visual Basic], adding values\"\n  - \"registry [Visual Basic], adding keys\"\n  - \"registry keys [Visual Basic], setting values\"\n  - \"examples [Visual Basic], registry\"\nms.assetid: d3e40f74-c283-480c-ab18-e5e9052cd814","nodes":[{"content":"How to: Create a Registry Key and Set Its Value in Visual Basic","nodes":[{"pos":[0,63],"content":"How to: Create a Registry Key and Set Its Value in Visual Basic","nodes":[{"content":"How to: Create a Registry Key and Set Its Value in Visual Basic","pos":[0,63]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[470,533],"content":"How to: Create a Registry Key and Set Its Value in Visual Basic","linkify":"How to: Create a Registry Key and Set Its Value in Visual Basic","nodes":[{"content":"How to: Create a Registry Key and Set Its Value in Visual Basic","pos":[0,63]}]},{"pos":[534,634],"content":"The <ph id=\"ph1\">`CreateSubKey`</ph> method of the <ph id=\"ph2\">`My.Computer.Registry`</ph> object can be used to create a registry key.","source":"The `CreateSubKey` method of the `My.Computer.Registry` object can be used to create a registry key."},{"pos":[643,652],"content":"Procedure","linkify":"Procedure","nodes":[{"content":"Procedure","pos":[0,9]}]},{"pos":[663,687],"content":"To create a registry key","linkify":"To create a registry key","nodes":[{"content":"To create a registry key","pos":[0,24]}]},{"content":"Use the <ph id=\"ph1\">`CreateSubKey`</ph> method, specifying which hive to place the key under as well as the name of the key.","pos":[697,804],"source":"Use the `CreateSubKey` method, specifying which hive to place the key under as well as the name of the key."},{"content":"The parameter <ph id=\"ph1\">`Subkey`</ph> is not case-sensitive.","pos":[805,850],"source":" The parameter `Subkey` is not case-sensitive."},{"content":"This example creates the registry key <ph id=\"ph1\">`MyTestKey`</ph> under HKEY_CURRENT_USER.","pos":[851,925],"source":" This example creates the registry key `MyTestKey` under HKEY_CURRENT_USER."},{"pos":[1062,1108],"content":"To create a registry key and set a value in it","linkify":"To create a registry key and set a value in it","nodes":[{"content":"To create a registry key and set a value in it","pos":[0,46]}]},{"content":"Use the <ph id=\"ph1\">`CreateSubkey`</ph> method, specifying which hive to place the key under as well as the name of the key.","pos":[1118,1225],"source":"Use the `CreateSubkey` method, specifying which hive to place the key under as well as the name of the key."},{"content":"This example creates the registry key <ph id=\"ph1\">`MyTestKey`</ph> under HKEY_CURRENT_USER.","pos":[1226,1300],"source":" This example creates the registry key `MyTestKey` under HKEY_CURRENT_USER."},{"content":"Set the value with the <ph id=\"ph1\">`SetValue`</ph> method.","pos":[1436,1477],"source":"Set the value with the `SetValue` method."},{"content":"This example sets the string value.","pos":[1478,1513]},{"content":"\"MyTestKeyValue\" to \"This is a test value\".","pos":[1514,1557]},{"pos":[1692,1699],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"pos":[1703,1851],"content":"This example creates the registry key <ph id=\"ph1\">`MyTestKey`</ph> under HKEY_CURRENT_USER and then sets the string value <ph id=\"ph2\">`MyTestKeyValue`</ph> to <ph id=\"ph3\">`This is a test value`</ph>.","source":"This example creates the registry key `MyTestKey` under HKEY_CURRENT_USER and then sets the string value `MyTestKeyValue` to `This is a test value`."},{"pos":[1982,2000],"content":"Robust Programming","linkify":"Robust Programming","nodes":[{"content":"Robust Programming","pos":[0,18]}]},{"content":"Examine the registry structure to find a suitable location for your key.","pos":[2004,2076]},{"content":"For example, you may want to open the HKEY_CURRENT_USER\\Software key of the current user, and create a key with your company's name.","pos":[2077,2209]},{"content":"Then add the registry values to your company's key.","pos":[2210,2261]},{"content":"When reading the registry from a Web application, the current user depends on the authentication and impersonation implemented in the Web application.","pos":[2268,2418]},{"pos":[2425,2603],"content":"It is more secure to write data to the user folder (<ph id=\"ph1\">&lt;xref:Microsoft.Win32.Registry.CurrentUser&gt;</ph>) rather than to the local computer (<ph id=\"ph2\">&lt;xref:Microsoft.Win32.Registry.LocalMachine&gt;</ph>).","source":"It is more secure to write data to the user folder (<xref:Microsoft.Win32.Registry.CurrentUser>) rather than to the local computer (<xref:Microsoft.Win32.Registry.LocalMachine>)."},{"content":"When you create a registry value, you need to decide what to do if that value already exists.","pos":[2610,2703]},{"content":"Another process, perhaps a malicious one, may have already created the value and have access to it.","pos":[2704,2803]},{"content":"When you put data in the registry value, the data is available to the other process.","pos":[2804,2888]},{"content":"To prevent this, use the <ph id=\"ph1\">&lt;xref:Microsoft.Win32.RegistryKey.GetValue%2A&gt;</ph> method.","pos":[2889,2968],"source":" To prevent this, use the <xref:Microsoft.Win32.RegistryKey.GetValue%2A> method."},{"content":"It returns <ph id=\"ph1\">`Nothing`</ph> if the key does not already exist.","pos":[2969,3024],"source":" It returns `Nothing` if the key does not already exist."},{"content":"It is not secure to store secrets, such as passwords, in the registry as plain text, even if the registry key is protected by ACLs (Access Control Lists).","pos":[3031,3185]},{"content":"The following conditions may cause an exception:","pos":[3192,3240]},{"pos":[3250,3321],"content":"The name of the key is <ph id=\"ph1\">`Nothing`</ph> (<ph id=\"ph2\">&lt;xref:System.ArgumentNullException&gt;</ph>).","source":"The name of the key is `Nothing` (<xref:System.ArgumentNullException>)."},{"pos":[3331,3433],"content":"The user does not have permissions to create registry keys (<ph id=\"ph1\">&lt;xref:System.Security.SecurityException&gt;</ph>).","source":"The user does not have permissions to create registry keys (<xref:System.Security.SecurityException>)."},{"pos":[3443,3522],"content":"The key name exceeds the 255-character limit (<ph id=\"ph1\">&lt;xref:System.ArgumentException&gt;</ph>).","source":"The key name exceeds the 255-character limit (<xref:System.ArgumentException>)."},{"pos":[3532,3581],"content":"The key is closed (<ph id=\"ph1\">&lt;xref:System.IO.IOException&gt;</ph>).","source":"The key is closed (<xref:System.IO.IOException>)."},{"pos":[3591,3665],"content":"The registry key is read-only (<ph id=\"ph1\">&lt;xref:System.UnauthorizedAccessException&gt;</ph>).","source":"The registry key is read-only (<xref:System.UnauthorizedAccessException>)."},{"pos":[3674,3697],"content":".NET Framework Security","linkify":".NET Framework Security","nodes":[{"content":".NET Framework Security","pos":[0,23]}]},{"content":"To run this process, your assembly requires a privilege level granted by the <ph id=\"ph1\">&lt;xref:System.Security.Permissions.RegistryPermission&gt;</ph> class.","pos":[3701,3838],"source":"To run this process, your assembly requires a privilege level granted by the <xref:System.Security.Permissions.RegistryPermission> class."},{"content":"If you are running in a partial-trust context, the process might throw an exception due to insufficient privileges.","pos":[3839,3954]},{"content":"Similarly, the user must have the correct ACLs for creating or writing to settings.","pos":[3955,4038]},{"content":"For example, a local application that has the code access security permission might not have operating system permission.","pos":[4039,4160]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Code Access Security Basics<ept id=\"p1\">](../../../../framework/misc/code-access-security-basics.md)</ept>.","pos":[4161,4276],"source":" For more information, see [Code Access Security Basics](../../../../framework/misc/code-access-security-basics.md)."},{"pos":[4285,4293],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[4477,4636],"content":"<bpt id=\"p1\">[</bpt>Reading from and Writing to the Registry<ept id=\"p1\">](../../../../visual-basic/developing-apps/programming/computer-resources/reading-from-and-writing-to-the-registry.md)</ept>","source":"[Reading from and Writing to the Registry](../../../../visual-basic/developing-apps/programming/computer-resources/reading-from-and-writing-to-the-registry.md)"},{"pos":[4639,4727],"content":"<bpt id=\"p1\">[</bpt>Code Access Security Basics<ept id=\"p1\">](../../../../framework/misc/code-access-security-basics.md)</ept>","source":"[Code Access Security Basics](../../../../framework/misc/code-access-security-basics.md)"}]}