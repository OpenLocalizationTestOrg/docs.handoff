{"content":"---\ntitle: \"Exceptions and Performance\"\nms.date: \"10/22/2008\"\nms.technology: dotnet-standard\nhelpviewer_keywords: \n  - \"tester-doer pattern\"\n  - \"TryParse pattern\"\n  - \"exceptions, throwing\"\n  - \"exceptions, performance\"\n  - \"throwing exceptions, performance\"\nms.assetid: 3ad6aad9-08e6-4232-b336-0e301f2493e6\nauthor: \"KrzysztofCwalina\"\n---\n# Exceptions and Performance\nOne common concern related to exceptions is that if exceptions are used for code that routinely fails, the performance of the implementation will be unacceptable. This is a valid concern. When a member throws an exception, its performance can be orders of magnitude slower. However, it is possible to achieve good performance while strictly adhering to the exception guidelines that disallow using error codes. Two patterns described in this section suggest ways to do this.  \n  \n **X DO NOT** use error codes because of concerns that exceptions might affect performance negatively.  \n  \n To improve performance, it is possible to use either the Tester-Doer Pattern or the Try-Parse Pattern, described in the next two sections.  \n  \n## Tester-Doer Pattern  \n Sometimes performance of an exception-throwing member can be improved by breaking the member into two. Let’s look at the <xref:System.Collections.Generic.ICollection%601.Add%2A> method of the <xref:System.Collections.Generic.ICollection%601> interface.  \n  \n```  \nICollection<int> numbers = ...   \nnumbers.Add(1);  \n```  \n  \n The method `Add` throws if the collection is read-only. This can be a performance problem in scenarios where the method call is expected to fail often. One of the ways to mitigate the problem is to test whether the collection is writable before trying to add a value.  \n  \n```  \nICollection<int> numbers = ...   \n...  \nif(!numbers.IsReadOnly){  \n    numbers.Add(1);  \n}  \n```  \n  \n The member used to test a condition, which in our example is the property `IsReadOnly`, is referred to as the tester. The member used to perform a potentially throwing operation, the `Add` method in our example, is referred to as the doer.  \n  \n **✓ CONSIDER** the Tester-Doer Pattern for members that might throw exceptions in common scenarios to avoid performance problems related to exceptions.  \n  \n## Try-Parse Pattern  \n For extremely performance-sensitive APIs, an even faster pattern than the Tester-Doer Pattern described in the previous section should be used. The pattern calls for adjusting the member name to make a well-defined test case a part of the member semantics. For example, <xref:System.DateTime> defines a <xref:System.DateTime.Parse%2A> method that throws an exception if parsing of a string fails. It also defines a corresponding <xref:System.DateTime.TryParse%2A> method that attempts to parse, but returns false if parsing is unsuccessful and returns the result of a successful parsing using an `out` parameter.  \n  \n```  \npublic struct DateTime {  \n    public static DateTime Parse(string dateTime){   \n        ...   \n    }  \n    public static bool TryParse(string dateTime, out DateTime result){  \n        ...  \n    }  \n}  \n```  \n  \n When using this pattern, it is important to define the try functionality in strict terms. If the member fails for any reason other than the well-defined try, the member must still throw a corresponding exception.  \n  \n **✓ CONSIDER** the Try-Parse Pattern for members that might throw exceptions in common scenarios to avoid performance problems related to exceptions.  \n  \n **✓ DO** use the prefix \"Try\" and Boolean return type for methods implementing this pattern.  \n  \n **✓ DO** provide an exception-throwing member for each member using the Try-Parse Pattern.  \n  \n *Portions © 2005, 2009 Microsoft Corporation. All rights reserved.*  \n  \n *Reprinted by permission of Pearson Education, Inc. from [Framework Design Guidelines: Conventions, Idioms, and Patterns for Reusable .NET Libraries, 2nd Edition](https://www.informit.com/store/framework-design-guidelines-conventions-idioms-and-9780321545619) by Krzysztof Cwalina and Brad Abrams, published Oct 22, 2008 by Addison-Wesley Professional as part of the Microsoft Windows Development Series.*  \n  \n## See also\n\n- [Framework Design Guidelines](../../../docs/standard/design-guidelines/index.md)\n- [Design Guidelines for Exceptions](../../../docs/standard/design-guidelines/exceptions.md)\n","nodes":[{"pos":[4,335],"embed":true,"restype":"x-metadata","content":"title: \"Exceptions and Performance\"\nms.date: \"10/22/2008\"\nms.technology: dotnet-standard\nhelpviewer_keywords: \n  - \"tester-doer pattern\"\n  - \"TryParse pattern\"\n  - \"exceptions, throwing\"\n  - \"exceptions, performance\"\n  - \"throwing exceptions, performance\"\nms.assetid: 3ad6aad9-08e6-4232-b336-0e301f2493e6\nauthor: \"KrzysztofCwalina\"","nodes":[{"content":"Exceptions and Performance","nodes":[{"pos":[0,26],"content":"Exceptions and Performance","nodes":[{"content":"Exceptions and Performance","pos":[0,26]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[342,368],"content":"Exceptions and Performance","linkify":"Exceptions and Performance","nodes":[{"content":"Exceptions and Performance","pos":[0,26]}]},{"content":"One common concern related to exceptions is that if exceptions are used for code that routinely fails, the performance of the implementation will be unacceptable.","pos":[369,531]},{"content":"This is a valid concern.","pos":[532,556]},{"content":"When a member throws an exception, its performance can be orders of magnitude slower.","pos":[557,642]},{"content":"However, it is possible to achieve good performance while strictly adhering to the exception guidelines that disallow using error codes.","pos":[643,779]},{"content":"Two patterns described in this section suggest ways to do this.","pos":[780,843]},{"pos":[850,951],"content":"<bpt id=\"p1\">**</bpt>X DO NOT<ept id=\"p1\">**</ept> use error codes because of concerns that exceptions might affect performance negatively.","source":"**X DO NOT** use error codes because of concerns that exceptions might affect performance negatively."},{"content":"To improve performance, it is possible to use either the Tester-Doer Pattern or the Try-Parse Pattern, described in the next two sections.","pos":[958,1096]},{"pos":[1105,1124],"content":"Tester-Doer Pattern","linkify":"Tester-Doer Pattern","nodes":[{"content":"Tester-Doer Pattern","pos":[0,19]}]},{"content":"Sometimes performance of an exception-throwing member can be improved by breaking the member into two.","pos":[1128,1230]},{"content":"Let’s look at the <ph id=\"ph1\">&lt;xref:System.Collections.Generic.ICollection%601.Add%2A&gt;</ph> method of the <ph id=\"ph2\">&lt;xref:System.Collections.Generic.ICollection%601&gt;</ph> interface.","pos":[1231,1380],"source":" Let’s look at the <xref:System.Collections.Generic.ICollection%601.Add%2A> method of the <xref:System.Collections.Generic.ICollection%601> interface."},{"content":"The method <ph id=\"ph1\">`Add`</ph> throws if the collection is read-only.","pos":[1454,1509],"source":"The method `Add` throws if the collection is read-only."},{"content":"This can be a performance problem in scenarios where the method call is expected to fail often.","pos":[1510,1605]},{"content":"One of the ways to mitigate the problem is to test whether the collection is writable before trying to add a value.","pos":[1606,1721]},{"content":"The member used to test a condition, which in our example is the property <ph id=\"ph1\">`IsReadOnly`</ph>, is referred to as the tester.","pos":[1836,1953],"source":"The member used to test a condition, which in our example is the property `IsReadOnly`, is referred to as the tester."},{"content":"The member used to perform a potentially throwing operation, the <ph id=\"ph1\">`Add`</ph> method in our example, is referred to as the doer.","pos":[1954,2075],"source":" The member used to perform a potentially throwing operation, the `Add` method in our example, is referred to as the doer."},{"pos":[2082,2233],"content":"<bpt id=\"p1\">**</bpt>✓ CONSIDER<ept id=\"p1\">**</ept> the Tester-Doer Pattern for members that might throw exceptions in common scenarios to avoid performance problems related to exceptions.","source":"**✓ CONSIDER** the Tester-Doer Pattern for members that might throw exceptions in common scenarios to avoid performance problems related to exceptions."},{"pos":[2242,2259],"content":"Try-Parse Pattern","linkify":"Try-Parse Pattern","nodes":[{"content":"Try-Parse Pattern","pos":[0,17]}]},{"content":"For extremely performance-sensitive APIs, an even faster pattern than the Tester-Doer Pattern described in the previous section should be used.","pos":[2263,2406]},{"content":"The pattern calls for adjusting the member name to make a well-defined test case a part of the member semantics.","pos":[2407,2519]},{"content":"For example, <ph id=\"ph1\">&lt;xref:System.DateTime&gt;</ph> defines a <ph id=\"ph2\">&lt;xref:System.DateTime.Parse%2A&gt;</ph> method that throws an exception if parsing of a string fails.","pos":[2520,2659],"source":" For example, <xref:System.DateTime> defines a <xref:System.DateTime.Parse%2A> method that throws an exception if parsing of a string fails."},{"content":"It also defines a corresponding <ph id=\"ph1\">&lt;xref:System.DateTime.TryParse%2A&gt;</ph> method that attempts to parse, but returns false if parsing is unsuccessful and returns the result of a successful parsing using an <ph id=\"ph2\">`out`</ph> parameter.","pos":[2660,2875],"source":" It also defines a corresponding <xref:System.DateTime.TryParse%2A> method that attempts to parse, but returns false if parsing is unsuccessful and returns the result of a successful parsing using an `out` parameter."},{"content":"When using this pattern, it is important to define the try functionality in strict terms.","pos":[3100,3189]},{"content":"If the member fails for any reason other than the well-defined try, the member must still throw a corresponding exception.","pos":[3190,3312]},{"pos":[3319,3468],"content":"<bpt id=\"p1\">**</bpt>✓ CONSIDER<ept id=\"p1\">**</ept> the Try-Parse Pattern for members that might throw exceptions in common scenarios to avoid performance problems related to exceptions.","source":"**✓ CONSIDER** the Try-Parse Pattern for members that might throw exceptions in common scenarios to avoid performance problems related to exceptions."},{"pos":[3475,3567],"content":"<bpt id=\"p1\">**</bpt>✓ DO<ept id=\"p1\">**</ept> use the prefix \"Try\" and Boolean return type for methods implementing this pattern.","source":"**✓ DO** use the prefix \"Try\" and Boolean return type for methods implementing this pattern."},{"pos":[3574,3664],"content":"<bpt id=\"p1\">**</bpt>✓ DO<ept id=\"p1\">**</ept> provide an exception-throwing member for each member using the Try-Parse Pattern.","source":"**✓ DO** provide an exception-throwing member for each member using the Try-Parse Pattern."},{"pos":[3671,3738],"content":"<bpt id=\"p1\">*</bpt>Portions © 2005, 2009 Microsoft Corporation. All rights reserved.<ept id=\"p1\">*</ept>","source":"*Portions © 2005, 2009 Microsoft Corporation. All rights reserved.*"},{"pos":[3745,4150],"content":"<bpt id=\"p1\">*</bpt>Reprinted by permission of Pearson Education, Inc. from <bpt id=\"p2\">[</bpt>Framework Design Guidelines: Conventions, Idioms, and Patterns for Reusable .NET Libraries, 2nd Edition<ept id=\"p2\">](https://www.informit.com/store/framework-design-guidelines-conventions-idioms-and-9780321545619)</ept> by Krzysztof Cwalina and Brad Abrams, published Oct 22, 2008 by Addison-Wesley Professional as part of the Microsoft Windows Development Series.<ept id=\"p1\">*</ept>","source":"*Reprinted by permission of Pearson Education, Inc. from [Framework Design Guidelines: Conventions, Idioms, and Patterns for Reusable .NET Libraries, 2nd Edition](https://www.informit.com/store/framework-design-guidelines-conventions-idioms-and-9780321545619) by Krzysztof Cwalina and Brad Abrams, published Oct 22, 2008 by Addison-Wesley Professional as part of the Microsoft Windows Development Series.*"},{"pos":[4159,4167],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[4171,4251],"content":"<bpt id=\"p1\">[</bpt>Framework Design Guidelines<ept id=\"p1\">](../../../docs/standard/design-guidelines/index.md)</ept>","source":"[Framework Design Guidelines](../../../docs/standard/design-guidelines/index.md)"},{"pos":[4254,4344],"content":"<bpt id=\"p1\">[</bpt>Design Guidelines for Exceptions<ept id=\"p1\">](../../../docs/standard/design-guidelines/exceptions.md)</ept>","source":"[Design Guidelines for Exceptions](../../../docs/standard/design-guidelines/exceptions.md)"}]}