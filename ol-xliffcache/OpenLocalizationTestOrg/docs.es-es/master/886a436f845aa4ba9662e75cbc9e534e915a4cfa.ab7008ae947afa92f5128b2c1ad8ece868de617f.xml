{"content":"---\ntitle: \"Walkthrough: Caching Application Data in a WPF Application\"\nms.date: \"03/30/2017\"\ndev_langs:\n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords:\n  - \"walkthroughs [WPF], caching\"\n  - \"caching [.NET Framework]\"\n  - \"caching [WPF]\"\nms.assetid: dac2c9ce-042b-4d23-91eb-28f584415cef\n---\n# Walkthrough: Caching Application Data in a WPF Application\nCaching enables you to store data in memory for rapid access. When the data is accessed again, applications can get the data from the cache instead of retrieving it from the original source. This can improve performance and scalability. In addition, caching makes data available when the data source is temporarily unavailable.\n\n The [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] provides classes that enable you to use caching in [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] applications. These classes are located in the <xref:System.Runtime.Caching> namespace.\n\n> [!NOTE]\n>  The <xref:System.Runtime.Caching> namespace is new in the [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)]. This namespace makes caching is available to all [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] applications. In previous versions of the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)], caching was available only in the <xref:System.Web> namespace and therefore required a dependency on ASP.NET classes.\n\n This walkthrough shows you how to use the caching functionality that is available in the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] as part of a [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] application. In the walkthrough, you cache the contents of a text file.\n\n Tasks illustrated in this walkthrough include the following:\n\n-   Creating a WPF application project.\n\n-   Adding a reference to the [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)].\n\n-   Initializing a cache.\n\n-   Adding a cache entry that contains the contents of a text file.\n\n-   Providing an eviction policy for the cache entry.\n\n-   Monitoring the path of the cached file and notifying the cache instance about changes to the monitored item.\n\n## Prerequisites\n In order to complete this walkthrough, you will need:\n\n-   Microsoft Visual Studio 2010.\n\n-   A text file that contains a small amount of text. (You will display the contents of the text file in a message box.) The code illustrated in the walkthrough assumes that you are working with the following file:\n\n     `c:\\cache\\cacheText.txt`\n\n     However, you can use any text file and make small changes to the code in this walkthrough.\n\n## Creating a WPF Application Project\n You will start by creating a WPF application project.\n\n#### To create a WPF application\n\n1.  Start Visual Studio.\n\n2.  In the **File** menu, click **New**, and then click **New Project**.\n\n     The **New Project** dialog box is displayed.\n\n3.  Under **Installed Templates**, select the programming language you want to use (**Visual Basic** or **Visual C#**).\n\n4.  In the **New Project** dialog box, select **WPF Application**.\n\n    > [!NOTE]\n    >  If you do not see the **WPF Application** template, make sure that you are targeting a version of the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] that supports WPF. In the **New Project** dialog box, select [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)] from the list.\n\n5.  In the **Name** text box, enter a name for your project. For example, you can enter **WPFCaching**.\n\n6.  Select the **Create directory for solution** check box.\n\n7.  Click **OK**.\n\n     The WPF Designer opens in **Design** view and displays the MainWindow.xaml file. Visual Studio creates the **My Project** folder, the Application.xaml file, and the MainWindow.xaml file.\n\n## Targeting the .NET Framework and Adding a Reference to the Caching Assemblies\n By default, WPF applications target the [!INCLUDE[net_client_v40_long](../../../../includes/net-client-v40-long-md.md)]. To use the <xref:System.Runtime.Caching> namespace in a WPF application, the application must target the [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)] (not the [!INCLUDE[net_client_v40_long](../../../../includes/net-client-v40-long-md.md)]) and must include a reference to the namespace.\n\n Therefore, the next step is to change the .NET Framework target and add a reference to the <xref:System.Runtime.Caching> namespace.\n\n> [!NOTE]\n>  The procedure for changing the .NET Framework target is different in a Visual Basic project and in a Visual C# project.\n\n#### To change the target .NET Framework in Visual Basic\n\n1.  In **Solutions Explorer**, right-click the project name, and then click **Properties**.\n\n     The properties window for the application is displayed.\n\n2.  Click the **Compile** tab.\n\n3.  At the bottom of the window, click **Advanced Compile Options…**.\n\n     The **Advanced Compiler Settings** dialog box is displayed.\n\n4.  In the **Target framework (all configurations)** list, select [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)]. (Do not select [!INCLUDE[net_client_v40_long](../../../../includes/net-client-v40-long-md.md)].)\n\n5.  Click **OK**.\n\n     The **Target Framework Change** dialog box is displayed.\n\n6.  In the **Target Framework Change** dialog box, click **Yes**.\n\n     The project is closed and is then reopened.\n\n7.  Add a reference to the caching assembly by following these steps:\n\n    1.  In **Solution Explorer**, right-click the name of the project and then click **Add Reference**.\n\n    2.  Select the **.NET** tab, select `System.Runtime.Caching`, and then click **OK**.\n\n#### To change the target .NET Framework in a Visual C# project\n\n1.  In **Solution Explorer**, right-click the project name and then click **Properties**.\n\n     The properties window for the application is displayed.\n\n2.  Click the **Application** tab.\n\n3.  In the **Target framework** list, select [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)]. (Do not select **.NET Framework 4 Client Profile**.)\n\n4.  Add a reference to the caching assembly by following these steps:\n\n    1.  Right-click the **References** folder and then click **Add Reference**.\n\n    2.  Select the **.NET** tab, select `System.Runtime.Caching`, and then click **OK**.\n\n## Adding a Button to the WPF Window\n Next, you will add a button control and create an event handler for the button's `Click` event. Later you will add code to so when you click the button, the contents of the text file are cached and displayed.\n\n#### To add a button control\n\n1.  In **Solution Explorer**, double-click the MainWindow.xaml file to open it.\n\n2.  From the **Toolbox**, under **Common WPF Controls**, drag a `Button` control to the `MainWindow` window.\n\n3.  In the **Properties** window, set the `Content` property of the `Button` control to **Get Cache**.\n\n## Initializing the Cache and Caching an Entry\n Next, you will add the code to perform the following tasks:\n\n-   Create an instance of the cache class—that is, you will instantiate a new <xref:System.Runtime.Caching.MemoryCache> object.\n\n-   Specify that the cache uses a <xref:System.Runtime.Caching.HostFileChangeMonitor> object to monitor changes in the text file.\n\n-   Read the text file and cache its contents as a cache entry.\n\n-   Display the contents of the cached text file.\n\n#### To create the cache object\n\n1.  Double-click the button you just added in order to create an event handler in the MainWindow.xaml.cs or MainWindow.Xaml.vb file.\n\n2.  At the top of the file (before the class declaration), add the following `Imports` (Visual Basic) or `using` (C#) statements:\n\n    ```csharp\n    using System.Runtime.Caching;\n    using System.IO;\n    ```\n\n    ```vb\n    Imports System.Runtime.Caching\n    Imports System.IO\n    ```\n\n3.  In the event handler, add the following code to instantiate the cache object:\n\n    ```csharp\n    ObjectCache cache = MemoryCache.Default;\n    ```\n\n    ```vb\n    Dim cache As ObjectCache = MemoryCache.Default\n    ```\n\n     The <xref:System.Runtime.Caching.ObjectCache> class is a built-in class that provides an in-memory object cache.\n\n4.  Add the following code to read the contents of a cache entry named `filecontents`:\n\n    ```vb\n    Dim fileContents As String = TryCast(cache(\"filecontents\"), String)\n    ```\n\n    ```csharp\n    string fileContents = cache[\"filecontents\"] as string;\n    ```\n\n5.  Add the following code to check whether the cache entry named `filecontents` exists:\n\n    ```vb\n    If fileContents Is Nothing Then\n\n    End If\n    ```\n\n    ```csharp\n    if (fileContents == null)\n    {\n\n    }\n    ```\n\n     If the specified cache entry does not exist, you must read the text file and add it as a cache entry to the cache.\n\n6.  In the `if/then` block, add the following code to create a new <xref:System.Runtime.Caching.CacheItemPolicy> object that specifies that the cache entry expires after 10 seconds.\n\n    ```vb\n    Dim policy As New CacheItemPolicy()\n    policy.AbsoluteExpiration = DateTimeOffset.Now.AddSeconds(10.0)\n    ```\n\n    ```csharp\n    CacheItemPolicy policy = new CacheItemPolicy();\n    policy.AbsoluteExpiration = DateTimeOffset.Now.AddSeconds(10.0);\n    ```\n\n     If no eviction or expiration information is provided, the default is <xref:System.Runtime.Caching.ObjectCache.InfiniteAbsoluteExpiration>, which means the cache entries never expire based only on an absolute time. Instead, cache entries expire only when there is memory pressure. As a best practice, you should always explicitly provide either an absolute or a sliding expiration.\n\n7.  Inside the `if/then` block and following the code you added in the previous step, add the following code to create a collection for the file paths that you want to monitor, and to add the path of the text file to the collection:\n\n    ```vb\n    Dim filePaths As New List(Of String)()\n    filePaths.Add(\"c:\\cache\\cacheText.txt\")\n    ```\n\n    ```csharp\n    List<string> filePaths = new List<string>();\n    filePaths.Add(\"c:\\\\cache\\\\cacheText.txt\");\n    ```\n\n    > [!NOTE]\n    >  If the text file you want to use is not `c:\\cache\\cacheText.txt`, specify the path where the text file is that you want to use.\n\n8.  Following the code that you added in the previous step, add the following code to add a new <xref:System.Runtime.Caching.HostFileChangeMonitor> object to the collection of change monitors for the cache entry:\n\n    ```vb\n    policy.ChangeMonitors.Add(New HostFileChangeMonitor(filePaths))\n    ```\n\n    ```csharp\n    policy.ChangeMonitors.Add(new HostFileChangeMonitor(filePaths));\n    ```\n\n     The <xref:System.Runtime.Caching.HostFileChangeMonitor> object monitors the text file's path and notifies the cache if changes occur. In this example, the cache entry will expire if the content of the file changes.\n\n9. Following the code that you added in the previous step, add the following code to read the contents of the text file:\n\n    ```vb\n    fileContents = File.ReadAllText(\"c:\\cache\\cacheText.txt\") & vbCrLf & DateTime.Now.ToString()\n    ```\n\n    ```csharp\n    fileContents = File.ReadAllText(\"c:\\\\cache\\\\cacheText.txt\") + \"\\n\" + DateTime.Now;\n    ```\n\n     The date and time timestamp is added so that you will be able to see when the cache entry expires.\n\n10. Following the code that you added in the previous step, add the following code to insert the contents of the file into the cache object as a <xref:System.Runtime.Caching.CacheItem> instance:\n\n    ```vb\n    cache.Set(\"filecontents\", fileContents, policy)\n    ```\n\n    ```csharp\n    cache.Set(\"filecontents\", fileContents, policy);\n    ```\n\n     You specify information about how the cache entry should be evicted by passing the <xref:System.Runtime.Caching.CacheItemPolicy> object that you created earlier as a parameter.\n\n11. After the `if/then` block, add the following code to display the cached file content in a message box:\n\n    ```vb\n    MessageBox.Show(fileContents)\n    ```\n\n    ```csharp\n    MessageBox.Show(fileContents);\n    ```\n\n12. In the **Build** menu, click **Build WPFCaching** to build your project.\n\n## Testing Caching in the WPF Application\n You can now test the application.\n\n#### To test caching in the WPF application\n\n1.  Press CTRL+F5 to run the application.\n\n     The `MainWindow` window is displayed.\n\n2.  Click **Get Cache**.\n\n     The cached content from the text file is displayed in a message box. Notice the timestamp on the file.\n\n3.  Close the message box and then click **Get Cache** again.\n\n     The timestamp is unchanged. This indicates the cached content is displayed.\n\n4.  Wait 10 seconds or more and then click **Get Cache** again.\n\n     This time a new timestamp is displayed. This indicates that the policy let the cache entry expire and that new cached content is displayed.\n\n5.  In a text editor, open the text file that you created. Do not make any changes yet.\n\n6.  Close the message box and then click **Get Cache** again.\n\n     Notice the timestamp again.\n\n7.  Make a change to the text file and then save the file.\n\n8.  Close the message box and then click **Get Cache** again.\n\n     This message box contains the updated content from the text file and a new timestamp. This indicates that the host-file change monitor evicted the cache entry immediately when you changed the file, even though the absolute timeout period had not expired.\n\n    > [!NOTE]\n    >  You can increase the eviction time to 20 seconds or more to allow more time for you to make a change in the file.\n\n## Code Example\n After you have completed this walkthrough, the code for the project you created will resemble the following example.\n\n [!code-csharp[CachingWPFApplications#1](~/samples/snippets/csharp/VS_Snippets_Wpf/CachingWPFApplications/CSharp/MainWindow.xaml.cs#1)]\n [!code-vb[CachingWPFApplications#1](~/samples/snippets/visualbasic/VS_Snippets_Wpf/CachingWPFApplications/VisualBasic/MainWindow.xaml.vb#1)]\n\n## See also\n\n- <xref:System.Runtime.Caching.MemoryCache>\n- <xref:System.Runtime.Caching.ObjectCache>\n- <xref:System.Runtime.Caching>\n- [Caching in .NET Framework Applications](../../performance/caching-in-net-framework-applications.md)\n","nodes":[{"pos":[4,281],"embed":true,"restype":"x-metadata","content":"title: \"Walkthrough: Caching Application Data in a WPF Application\"\nms.date: \"03/30/2017\"\ndev_langs:\n  - \"csharp\"\n  - \"vb\"\nhelpviewer_keywords:\n  - \"walkthroughs [WPF], caching\"\n  - \"caching [.NET Framework]\"\n  - \"caching [WPF]\"\nms.assetid: dac2c9ce-042b-4d23-91eb-28f584415cef","nodes":[{"content":"Walkthrough: Caching Application Data in a WPF Application","nodes":[{"pos":[0,58],"content":"Walkthrough: Caching Application Data in a WPF Application","nodes":[{"content":"Walkthrough: Caching Application Data in a WPF Application","pos":[0,58]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[288,346],"content":"Walkthrough: Caching Application Data in a WPF Application","linkify":"Walkthrough: Caching Application Data in a WPF Application","nodes":[{"content":"Walkthrough: Caching Application Data in a WPF Application","pos":[0,58]}]},{"content":"Caching enables you to store data in memory for rapid access.","pos":[347,408]},{"content":"When the data is accessed again, applications can get the data from the cache instead of retrieving it from the original source.","pos":[409,537]},{"content":"This can improve performance and scalability.","pos":[538,583]},{"content":"In addition, caching makes data available when the data source is temporarily unavailable.","pos":[584,674]},{"content":"The <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> provides classes that enable you to use caching in <ph id=\"ph2\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> applications.","pos":[677,873],"source":"The [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] provides classes that enable you to use caching in [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] applications."},{"content":"These classes are located in the <ph id=\"ph1\">&lt;xref:System.Runtime.Caching&gt;</ph> namespace.","pos":[874,947],"source":" These classes are located in the <xref:System.Runtime.Caching> namespace."},{"pos":[951,1426],"content":"[!NOTE]\n The <xref:System.Runtime.Caching> namespace is new in the [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)]. This namespace makes caching is available to all [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] applications. In previous versions of the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)], caching was available only in the <xref:System.Web> namespace and therefore required a dependency on ASP.NET classes.","leadings":["","> "],"nodes":[{"content":"The <xref:System.Runtime.Caching> namespace is new in the [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)]. This namespace makes caching is available to all [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] applications. In previous versions of the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)], caching was available only in the <xref:System.Web> namespace and therefore required a dependency on ASP.NET classes.","pos":[9,473],"nodes":[{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Caching&gt;</ph> namespace is new in the <ph id=\"ph2\">[!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)]</ph>.","pos":[0,126],"source":"The <xref:System.Runtime.Caching> namespace is new in the [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)]."},{"content":"This namespace makes caching is available to all <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> applications.","pos":[127,253],"source":" This namespace makes caching is available to all [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] applications."},{"content":"In previous versions of the <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph>, caching was available only in the <ph id=\"ph2\">&lt;xref:System.Web&gt;</ph> namespace and therefore required a dependency on ASP.NET classes.","pos":[254,464],"source":" In previous versions of the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)], caching was available only in the <xref:System.Web> namespace and therefore required a dependency on ASP.NET classes."}]}]},{"content":"This walkthrough shows you how to use the caching functionality that is available in the <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> as part of a <ph id=\"ph2\">[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]</ph> application.","pos":[1429,1687],"source":"This walkthrough shows you how to use the caching functionality that is available in the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] as part of a [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] application."},{"content":"In the walkthrough, you cache the contents of a text file.","pos":[1688,1746]},{"content":"Tasks illustrated in this walkthrough include the following:","pos":[1749,1809]},{"content":"Creating a WPF application project.","pos":[1815,1850]},{"pos":[1856,1950],"content":"Adding a reference to the <ph id=\"ph1\">[!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)]</ph>.","source":"Adding a reference to the [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)]."},{"content":"Initializing a cache.","pos":[1956,1977]},{"content":"Adding a cache entry that contains the contents of a text file.","pos":[1983,2046]},{"content":"Providing an eviction policy for the cache entry.","pos":[2052,2101]},{"content":"Monitoring the path of the cached file and notifying the cache instance about changes to the monitored item.","pos":[2107,2215]},{"pos":[2220,2233],"content":"Prerequisites","linkify":"Prerequisites","nodes":[{"content":"Prerequisites","pos":[0,13]}]},{"content":"In order to complete this walkthrough, you will need:","pos":[2235,2288]},{"content":"Microsoft Visual Studio 2010.","pos":[2294,2323]},{"content":"A text file that contains a small amount of text.","pos":[2329,2378]},{"content":"(You will display the contents of the text file in a message box.) The code illustrated in the walkthrough assumes that you are working with the following file:","pos":[2379,2539]},{"content":"However, you can use any text file and make small changes to the code in this walkthrough.","pos":[2577,2667]},{"pos":[2672,2706],"content":"Creating a WPF Application Project","linkify":"Creating a WPF Application Project","nodes":[{"content":"Creating a WPF Application Project","pos":[0,34]}]},{"content":"You will start by creating a WPF application project.","pos":[2708,2761]},{"pos":[2768,2795],"content":"To create a WPF application","linkify":"To create a WPF application","nodes":[{"content":"To create a WPF application","pos":[0,27]}]},{"content":"Start Visual Studio.","pos":[2801,2821]},{"pos":[2827,2895],"content":"In the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>New Project<ept id=\"p3\">**</ept>.","source":"In the **File** menu, click **New**, and then click **New Project**."},{"pos":[2902,2946],"content":"The <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept> dialog box is displayed.","source":"The **New Project** dialog box is displayed."},{"pos":[2952,3067],"content":"Under <bpt id=\"p1\">**</bpt>Installed Templates<ept id=\"p1\">**</ept>, select the programming language you want to use (<bpt id=\"p2\">**</bpt>Visual Basic<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>Visual C#<ept id=\"p3\">**</ept>).","source":"Under **Installed Templates**, select the programming language you want to use (**Visual Basic** or **Visual C#**)."},{"pos":[3073,3135],"content":"In the <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept> dialog box, select <bpt id=\"p2\">**</bpt>WPF Application<ept id=\"p2\">**</ept>.","source":"In the **New Project** dialog box, select **WPF Application**."},{"pos":[3143,3467],"content":"[!NOTE]\nIf you do not see the **WPF Application** template, make sure that you are targeting a version of the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] that supports WPF. In the **New Project** dialog box, select [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)] from the list.","leadings":["","    >  "],"nodes":[{"content":"If you do not see the **WPF Application** template, make sure that you are targeting a version of the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] that supports WPF. In the **New Project** dialog box, select [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)] from the list.","pos":[8,317],"nodes":[{"content":"If you do not see the <bpt id=\"p1\">**</bpt>WPF Application<ept id=\"p1\">**</ept> template, make sure that you are targeting a version of the <ph id=\"ph1\">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)]</ph> that supports WPF.","pos":[0,184],"source":"If you do not see the **WPF Application** template, make sure that you are targeting a version of the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] that supports WPF."},{"content":"In the <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept> dialog box, select <ph id=\"ph1\">[!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)]</ph> from the list.","pos":[185,309],"source":" In the **New Project** dialog box, select [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)] from the list."}]}]},{"content":"In the <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept> text box, enter a name for your project.","pos":[3473,3529],"source":"In the **Name** text box, enter a name for your project."},{"content":"For example, you can enter <bpt id=\"p1\">**</bpt>WPFCaching<ept id=\"p1\">**</ept>.","pos":[3530,3572],"source":" For example, you can enter **WPFCaching**."},{"pos":[3578,3633],"content":"Select the <bpt id=\"p1\">**</bpt>Create directory for solution<ept id=\"p1\">**</ept> check box.","source":"Select the **Create directory for solution** check box."},{"pos":[3639,3652],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","source":"Click **OK**."},{"content":"The WPF Designer opens in <bpt id=\"p1\">**</bpt>Design<ept id=\"p1\">**</ept> view and displays the MainWindow.xaml file.","pos":[3659,3739],"source":"The WPF Designer opens in **Design** view and displays the MainWindow.xaml file."},{"content":"Visual Studio creates the <bpt id=\"p1\">**</bpt>My Project<ept id=\"p1\">**</ept> folder, the Application.xaml file, and the MainWindow.xaml file.","pos":[3740,3845],"source":" Visual Studio creates the **My Project** folder, the Application.xaml file, and the MainWindow.xaml file."},{"pos":[3850,3927],"content":"Targeting the .NET Framework and Adding a Reference to the Caching Assemblies","linkify":"Targeting the .NET Framework and Adding a Reference to the Caching Assemblies","nodes":[{"content":"Targeting the .NET Framework and Adding a Reference to the Caching Assemblies","pos":[0,77]}]},{"content":"By default, WPF applications target the <ph id=\"ph1\">[!INCLUDE[net_client_v40_long](../../../../includes/net-client-v40-long-md.md)]</ph>.","pos":[3929,4049],"source":"By default, WPF applications target the [!INCLUDE[net_client_v40_long](../../../../includes/net-client-v40-long-md.md)]."},{"content":"To use the <ph id=\"ph1\">&lt;xref:System.Runtime.Caching&gt;</ph> namespace in a WPF application, the application must target the <ph id=\"ph2\">[!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)]</ph> (not the <ph id=\"ph3\">[!INCLUDE[net_client_v40_long](../../../../includes/net-client-v40-long-md.md)]</ph>) and must include a reference to the namespace.","pos":[4050,4359],"source":" To use the <xref:System.Runtime.Caching> namespace in a WPF application, the application must target the [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)] (not the [!INCLUDE[net_client_v40_long](../../../../includes/net-client-v40-long-md.md)]) and must include a reference to the namespace."},{"pos":[4362,4493],"content":"Therefore, the next step is to change the .NET Framework target and add a reference to the <ph id=\"ph1\">&lt;xref:System.Runtime.Caching&gt;</ph> namespace.","source":"Therefore, the next step is to change the .NET Framework target and add a reference to the <xref:System.Runtime.Caching> namespace."},{"pos":[4497,4627],"content":"[!NOTE]\n The procedure for changing the .NET Framework target is different in a Visual Basic project and in a Visual C# project.","leadings":["","> "],"nodes":[{"content":"The procedure for changing the .NET Framework target is different in a Visual Basic project and in a Visual C# project.","pos":[9,128]}]},{"pos":[4634,4685],"content":"To change the target .NET Framework in Visual Basic","linkify":"To change the target .NET Framework in Visual Basic","nodes":[{"content":"To change the target .NET Framework in Visual Basic","pos":[0,51]}]},{"pos":[4691,4778],"content":"In <bpt id=\"p1\">**</bpt>Solutions Explorer<ept id=\"p1\">**</ept>, right-click the project name, and then click <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>.","source":"In **Solutions Explorer**, right-click the project name, and then click **Properties**."},{"content":"The properties window for the application is displayed.","pos":[4785,4840]},{"pos":[4846,4872],"content":"Click the <bpt id=\"p1\">**</bpt>Compile<ept id=\"p1\">**</ept> tab.","source":"Click the **Compile** tab."},{"pos":[4878,4943],"content":"At the bottom of the window, click <bpt id=\"p1\">**</bpt>Advanced Compile Options…<ept id=\"p1\">**</ept>.","source":"At the bottom of the window, click **Advanced Compile Options…**."},{"pos":[4950,5009],"content":"The <bpt id=\"p1\">**</bpt>Advanced Compiler Settings<ept id=\"p1\">**</ept> dialog box is displayed.","source":"The **Advanced Compiler Settings** dialog box is displayed."},{"content":"In the <bpt id=\"p1\">**</bpt>Target framework (all configurations)<ept id=\"p1\">**</ept> list, select <ph id=\"ph1\">[!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)]</ph>.","pos":[5015,5145],"source":"In the **Target framework (all configurations)** list, select [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)]."},{"content":"(Do not select <ph id=\"ph1\">[!INCLUDE[net_client_v40_long](../../../../includes/net-client-v40-long-md.md)]</ph>.)","pos":[5146,5242],"source":" (Do not select [!INCLUDE[net_client_v40_long](../../../../includes/net-client-v40-long-md.md)].)"},{"pos":[5248,5261],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","source":"Click **OK**."},{"pos":[5268,5324],"content":"The <bpt id=\"p1\">**</bpt>Target Framework Change<ept id=\"p1\">**</ept> dialog box is displayed.","source":"The **Target Framework Change** dialog box is displayed."},{"pos":[5330,5391],"content":"In the <bpt id=\"p1\">**</bpt>Target Framework Change<ept id=\"p1\">**</ept> dialog box, click <bpt id=\"p2\">**</bpt>Yes<ept id=\"p2\">**</ept>.","source":"In the **Target Framework Change** dialog box, click **Yes**."},{"content":"The project is closed and is then reopened.","pos":[5398,5441]},{"content":"Add a reference to the caching assembly by following these steps:","pos":[5447,5512]},{"pos":[5522,5617],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the name of the project and then click <bpt id=\"p2\">**</bpt>Add Reference<ept id=\"p2\">**</ept>.","source":"In **Solution Explorer**, right-click the name of the project and then click **Add Reference**."},{"pos":[5627,5707],"content":"Select the <bpt id=\"p1\">**</bpt>.NET<ept id=\"p1\">**</ept> tab, select <ph id=\"ph1\">`System.Runtime.Caching`</ph>, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>.","source":"Select the **.NET** tab, select `System.Runtime.Caching`, and then click **OK**."},{"pos":[5714,5772],"content":"To change the target .NET Framework in a Visual C# project","linkify":"To change the target .NET Framework in a Visual C# project","nodes":[{"content":"To change the target .NET Framework in a Visual C# project","pos":[0,58]}]},{"pos":[5778,5863],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the project name and then click <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>.","source":"In **Solution Explorer**, right-click the project name and then click **Properties**."},{"content":"The properties window for the application is displayed.","pos":[5870,5925]},{"pos":[5931,5961],"content":"Click the <bpt id=\"p1\">**</bpt>Application<ept id=\"p1\">**</ept> tab.","source":"Click the **Application** tab."},{"content":"In the <bpt id=\"p1\">**</bpt>Target framework<ept id=\"p1\">**</ept> list, select <ph id=\"ph1\">[!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)]</ph>.","pos":[5967,6076],"source":"In the **Target framework** list, select [!INCLUDE[net_v40_short](../../../../includes/net-v40-short-md.md)]."},{"content":"(Do not select <bpt id=\"p1\">**</bpt>.NET Framework 4 Client Profile<ept id=\"p1\">**</ept>.)","pos":[6077,6129],"source":" (Do not select **.NET Framework 4 Client Profile**.)"},{"content":"Add a reference to the caching assembly by following these steps:","pos":[6135,6200]},{"pos":[6210,6281],"content":"Right-click the <bpt id=\"p1\">**</bpt>References<ept id=\"p1\">**</ept> folder and then click <bpt id=\"p2\">**</bpt>Add Reference<ept id=\"p2\">**</ept>.","source":"Right-click the **References** folder and then click **Add Reference**."},{"pos":[6291,6371],"content":"Select the <bpt id=\"p1\">**</bpt>.NET<ept id=\"p1\">**</ept> tab, select <ph id=\"ph1\">`System.Runtime.Caching`</ph>, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>.","source":"Select the **.NET** tab, select `System.Runtime.Caching`, and then click **OK**."},{"pos":[6376,6409],"content":"Adding a Button to the WPF Window","linkify":"Adding a Button to the WPF Window","nodes":[{"content":"Adding a Button to the WPF Window","pos":[0,33]}]},{"content":"Next, you will add a button control and create an event handler for the button's <ph id=\"ph1\">`Click`</ph> event.","pos":[6411,6506],"source":"Next, you will add a button control and create an event handler for the button's `Click` event."},{"content":"Later you will add code to so when you click the button, the contents of the text file are cached and displayed.","pos":[6507,6619]},{"pos":[6626,6649],"content":"To add a button control","linkify":"To add a button control","nodes":[{"content":"To add a button control","pos":[0,23]}]},{"pos":[6655,6730],"content":"In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, double-click the MainWindow.xaml file to open it.","source":"In **Solution Explorer**, double-click the MainWindow.xaml file to open it."},{"pos":[6736,6840],"content":"From the <bpt id=\"p1\">**</bpt>Toolbox<ept id=\"p1\">**</ept>, under <bpt id=\"p2\">**</bpt>Common WPF Controls<ept id=\"p2\">**</ept>, drag a <ph id=\"ph1\">`Button`</ph> control to the <ph id=\"ph2\">`MainWindow`</ph> window.","source":"From the **Toolbox**, under **Common WPF Controls**, drag a `Button` control to the `MainWindow` window."},{"pos":[6846,6944],"content":"In the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> window, set the <ph id=\"ph1\">`Content`</ph> property of the <ph id=\"ph2\">`Button`</ph> control to <bpt id=\"p2\">**</bpt>Get Cache<ept id=\"p2\">**</ept>.","source":"In the **Properties** window, set the `Content` property of the `Button` control to **Get Cache**."},{"pos":[6949,6992],"content":"Initializing the Cache and Caching an Entry","linkify":"Initializing the Cache and Caching an Entry","nodes":[{"content":"Initializing the Cache and Caching an Entry","pos":[0,43]}]},{"content":"Next, you will add the code to perform the following tasks:","pos":[6994,7053]},{"pos":[7059,7182],"content":"Create an instance of the cache class—that is, you will instantiate a new <ph id=\"ph1\">&lt;xref:System.Runtime.Caching.MemoryCache&gt;</ph> object.","source":"Create an instance of the cache class—that is, you will instantiate a new <xref:System.Runtime.Caching.MemoryCache> object."},{"pos":[7188,7313],"content":"Specify that the cache uses a <ph id=\"ph1\">&lt;xref:System.Runtime.Caching.HostFileChangeMonitor&gt;</ph> object to monitor changes in the text file.","source":"Specify that the cache uses a <xref:System.Runtime.Caching.HostFileChangeMonitor> object to monitor changes in the text file."},{"content":"Read the text file and cache its contents as a cache entry.","pos":[7319,7378]},{"content":"Display the contents of the cached text file.","pos":[7384,7429]},{"pos":[7436,7462],"content":"To create the cache object","linkify":"To create the cache object","nodes":[{"content":"To create the cache object","pos":[0,26]}]},{"content":"Double-click the button you just added in order to create an event handler in the MainWindow.xaml.cs or MainWindow.Xaml.vb file.","pos":[7468,7596]},{"pos":[7602,7727],"content":"At the top of the file (before the class declaration), add the following <ph id=\"ph1\">`Imports`</ph> (Visual Basic) or <ph id=\"ph2\">`using`</ph> (C#) statements:","source":"At the top of the file (before the class declaration), add the following `Imports` (Visual Basic) or `using` (C#) statements:"},{"content":"In the event handler, add the following code to instantiate the cache object:","pos":[7887,7964]},{"pos":[8109,8221],"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Caching.ObjectCache&gt;</ph> class is a built-in class that provides an in-memory object cache.","source":"The <xref:System.Runtime.Caching.ObjectCache> class is a built-in class that provides an in-memory object cache."},{"pos":[8227,8309],"content":"Add the following code to read the contents of a cache entry named <ph id=\"ph1\">`filecontents`</ph>:","source":"Add the following code to read the contents of a cache entry named `filecontents`:"},{"pos":[8488,8572],"content":"Add the following code to check whether the cache entry named <ph id=\"ph1\">`filecontents`</ph> exists:","source":"Add the following code to check whether the cache entry named `filecontents` exists:"},{"content":"If the specified cache entry does not exist, you must read the text file and add it as a cache entry to the cache.","pos":[8712,8826]},{"pos":[8832,9009],"content":"In the <ph id=\"ph1\">`if/then`</ph> block, add the following code to create a new <ph id=\"ph2\">&lt;xref:System.Runtime.Caching.CacheItemPolicy&gt;</ph> object that specifies that the cache entry expires after 10 seconds.","source":"In the `if/then` block, add the following code to create a new <xref:System.Runtime.Caching.CacheItemPolicy> object that specifies that the cache entry expires after 10 seconds."},{"content":"If no eviction or expiration information is provided, the default is <ph id=\"ph1\">&lt;xref:System.Runtime.Caching.ObjectCache.InfiniteAbsoluteExpiration&gt;</ph>, which means the cache entries never expire based only on an absolute time.","pos":[9287,9500],"source":"If no eviction or expiration information is provided, the default is <xref:System.Runtime.Caching.ObjectCache.InfiniteAbsoluteExpiration>, which means the cache entries never expire based only on an absolute time."},{"content":"Instead, cache entries expire only when there is memory pressure.","pos":[9501,9566]},{"content":"As a best practice, you should always explicitly provide either an absolute or a sliding expiration.","pos":[9567,9667]},{"pos":[9673,9901],"content":"Inside the <ph id=\"ph1\">`if/then`</ph> block and following the code you added in the previous step, add the following code to create a collection for the file paths that you want to monitor, and to add the path of the text file to the collection:","source":"Inside the `if/then` block and following the code you added in the previous step, add the following code to create a collection for the file paths that you want to monitor, and to add the path of the text file to the collection:"},{"pos":[10134,10276],"content":"[!NOTE]\nIf the text file you want to use is not `c:\\cache\\cacheText.txt`, specify the path where the text file is that you want to use.","leadings":["","    >  "],"nodes":[{"content":"If the text file you want to use is not <ph id=\"ph1\">`c:\\cache\\cacheText.txt`</ph>, specify the path where the text file is that you want to use.","pos":[8,135],"source":"If the text file you want to use is not `c:\\cache\\cacheText.txt`, specify the path where the text file is that you want to use."}]},{"pos":[10282,10490],"content":"Following the code that you added in the previous step, add the following code to add a new <ph id=\"ph1\">&lt;xref:System.Runtime.Caching.HostFileChangeMonitor&gt;</ph> object to the collection of change monitors for the cache entry:","source":"Following the code that you added in the previous step, add the following code to add a new <xref:System.Runtime.Caching.HostFileChangeMonitor> object to the collection of change monitors for the cache entry:"},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.Caching.HostFileChangeMonitor&gt;</ph> object monitors the text file's path and notifies the cache if changes occur.","pos":[10676,10809],"source":"The <xref:System.Runtime.Caching.HostFileChangeMonitor> object monitors the text file's path and notifies the cache if changes occur."},{"content":"In this example, the cache entry will expire if the content of the file changes.","pos":[10810,10890]},{"content":"Following the code that you added in the previous step, add the following code to read the contents of the text file:","pos":[10895,11012]},{"content":"The date and time timestamp is added so that you will be able to see when the cache entry expires.","pos":[11245,11343]},{"pos":[11349,11539],"content":"Following the code that you added in the previous step, add the following code to insert the contents of the file into the cache object as a <ph id=\"ph1\">&lt;xref:System.Runtime.Caching.CacheItem&gt;</ph> instance:","source":"Following the code that you added in the previous step, add the following code to insert the contents of the file into the cache object as a <xref:System.Runtime.Caching.CacheItem> instance:"},{"pos":[11693,11869],"content":"You specify information about how the cache entry should be evicted by passing the <ph id=\"ph1\">&lt;xref:System.Runtime.Caching.CacheItemPolicy&gt;</ph> object that you created earlier as a parameter.","source":"You specify information about how the cache entry should be evicted by passing the <xref:System.Runtime.Caching.CacheItemPolicy> object that you created earlier as a parameter."},{"pos":[11875,11977],"content":"After the <ph id=\"ph1\">`if/then`</ph> block, add the following code to display the cached file content in a message box:","source":"After the `if/then` block, add the following code to display the cached file content in a message box:"},{"pos":[12094,12166],"content":"In the <bpt id=\"p1\">**</bpt>Build<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Build WPFCaching<ept id=\"p2\">**</ept> to build your project.","source":"In the **Build** menu, click **Build WPFCaching** to build your project."},{"pos":[12171,12209],"content":"Testing Caching in the WPF Application","linkify":"Testing Caching in the WPF Application","nodes":[{"content":"Testing Caching in the WPF Application","pos":[0,38]}]},{"content":"You can now test the application.","pos":[12211,12244]},{"pos":[12251,12289],"content":"To test caching in the WPF application","linkify":"To test caching in the WPF application","nodes":[{"content":"To test caching in the WPF application","pos":[0,38]}]},{"content":"Press CTRL+F5 to run the application.","pos":[12295,12332]},{"pos":[12339,12376],"content":"The <ph id=\"ph1\">`MainWindow`</ph> window is displayed.","source":"The `MainWindow` window is displayed."},{"pos":[12382,12402],"content":"Click <bpt id=\"p1\">**</bpt>Get Cache<ept id=\"p1\">**</ept>.","source":"Click **Get Cache**."},{"content":"The cached content from the text file is displayed in a message box.","pos":[12409,12477]},{"content":"Notice the timestamp on the file.","pos":[12478,12511]},{"pos":[12517,12574],"content":"Close the message box and then click <bpt id=\"p1\">**</bpt>Get Cache<ept id=\"p1\">**</ept> again.","source":"Close the message box and then click **Get Cache** again."},{"content":"The timestamp is unchanged.","pos":[12581,12608]},{"content":"This indicates the cached content is displayed.","pos":[12609,12656]},{"pos":[12662,12721],"content":"Wait 10 seconds or more and then click <bpt id=\"p1\">**</bpt>Get Cache<ept id=\"p1\">**</ept> again.","source":"Wait 10 seconds or more and then click **Get Cache** again."},{"content":"This time a new timestamp is displayed.","pos":[12728,12767]},{"content":"This indicates that the policy let the cache entry expire and that new cached content is displayed.","pos":[12768,12867]},{"content":"In a text editor, open the text file that you created.","pos":[12873,12927]},{"content":"Do not make any changes yet.","pos":[12928,12956]},{"pos":[12962,13019],"content":"Close the message box and then click <bpt id=\"p1\">**</bpt>Get Cache<ept id=\"p1\">**</ept> again.","source":"Close the message box and then click **Get Cache** again."},{"content":"Notice the timestamp again.","pos":[13026,13053]},{"content":"Make a change to the text file and then save the file.","pos":[13059,13113]},{"pos":[13119,13176],"content":"Close the message box and then click <bpt id=\"p1\">**</bpt>Get Cache<ept id=\"p1\">**</ept> again.","source":"Close the message box and then click **Get Cache** again."},{"content":"This message box contains the updated content from the text file and a new timestamp.","pos":[13183,13268]},{"content":"This indicates that the host-file change monitor evicted the cache entry immediately when you changed the file, even though the absolute timeout period had not expired.","pos":[13269,13437]},{"pos":[13445,13573],"content":"[!NOTE]\nYou can increase the eviction time to 20 seconds or more to allow more time for you to make a change in the file.","leadings":["","    >  "],"nodes":[{"content":"You can increase the eviction time to 20 seconds or more to allow more time for you to make a change in the file.","pos":[8,121]}]},{"pos":[13578,13590],"content":"Code Example","linkify":"Code Example","nodes":[{"content":"Code Example","pos":[0,12]}]},{"content":"After you have completed this walkthrough, the code for the project you created will resemble the following example.","pos":[13592,13708]},{"pos":[13992,14000],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[14124,14224],"content":"<bpt id=\"p1\">[</bpt>Caching in .NET Framework Applications<ept id=\"p1\">](../../performance/caching-in-net-framework-applications.md)</ept>","source":"[Caching in .NET Framework Applications](../../performance/caching-in-net-framework-applications.md)"}]}