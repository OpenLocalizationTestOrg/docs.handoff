{"content":"---\ntitle: \"How to: Compute Column Values in a CSV Text File (LINQ) (Visual Basic)\"\nms.date: 07/20/2015\nms.assetid: 88b2b9f3-c82e-41f3-b1b4-26ede5973a02\n---\n# How to: Compute Column Values in a CSV Text File (LINQ) (Visual Basic)\nThis example shows how to perform aggregate computations such as Sum, Average, Min, and Max on the columns of a .csv file. The example principles that are shown here can be applied to other types of structured text.  \n  \n### To create the source file  \n  \n1.  Copy the following lines into a file that is named scores.csv and save it in your project folder. Assume that the first column represents a student ID, and subsequent columns represent scores from four exams.  \n  \n    ```  \n    111, 97, 92, 81, 60  \n    112, 75, 84, 91, 39  \n    113, 88, 94, 65, 91  \n    114, 97, 89, 85, 82  \n    115, 35, 72, 91, 70  \n    116, 99, 86, 90, 94  \n    117, 93, 92, 80, 87  \n    118, 92, 90, 83, 78  \n    119, 68, 79, 88, 92  \n    120, 99, 82, 81, 79  \n    121, 96, 85, 91, 60  \n    122, 94, 92, 91, 91  \n    ```  \n  \n## Example  \n  \n```vb  \nClass SumColumns  \n  \n    Public Shared Sub Main()  \n  \n        Dim lines As String() = System.IO.File.ReadAllLines(\"../../../scores.csv\")  \n  \n        ' Specifies the column to compute  \n        ' This value could be passed in at runtime.  \n        Dim exam = 3  \n  \n        ' Spreadsheet format:  \n        ' Student ID    Exam#1  Exam#2  Exam#3  Exam#4  \n        ' 111,          97,     92,     81,     60  \n        ' one is added to skip over the first column  \n        ' which holds the student ID.  \n        SumColumn(lines, exam + 1)  \n        Console.WriteLine()  \n        MultiColumns(lines)  \n  \n        ' Keep the console window open in debug mode.  \n        Console.WriteLine(\"Press any key to exit...\")  \n        Console.ReadKey()  \n  \n    End Sub  \n  \n    Shared Sub SumColumn(ByVal lines As IEnumerable(Of String), ByVal col As Integer)  \n  \n        ' This query performs two steps:  \n        ' split the string into a string array  \n        ' convert the specified element to  \n        ' integer and select it.  \n        Dim columnQuery = From line In lines   \n                           Let x = line.Split(\",\")   \n                           Select Convert.ToInt32(x(col))  \n  \n        ' Execute and cache the results for performance.  \n        ' Only needed with very large files.  \n        Dim results = columnQuery.ToList()  \n  \n        ' Perform aggregate calculations   \n        ' on the column specified by col.  \n        Dim avgScore = Aggregate score In results Into Average(score)  \n        Dim minScore = Aggregate score In results Into Min(score)  \n        Dim maxScore = Aggregate score In results Into Max(score)  \n  \n        Console.WriteLine(\"Single Column Query:\")  \n        Console.WriteLine(\"Exam #{0}: Average:{1:##.##} High Score:{2} Low Score:{3}\",   \n                     col, avgScore, maxScore, minScore)  \n  \n    End Sub  \n  \n    Shared Sub MultiColumns(ByVal lines As IEnumerable(Of String))  \n  \n        Console.WriteLine(\"Multi Column Query:\")  \n  \n        ' Create the query. It will produce nested sequences.   \n        ' multiColQuery performs these steps:  \n        ' 1) convert the string to a string array  \n        ' 2) skip over the \"Student ID\" column and take the rest  \n        ' 3) convert each field to an int and select that   \n        '    entire sequence as one row in the results.  \n        Dim multiColQuery = From line In lines   \n                            Let fields = line.Split(\",\")   \n                            Select From str In fields Skip 1   \n                                        Select Convert.ToInt32(str)  \n  \n        Dim results = multiColQuery.ToList()  \n  \n        ' Find out how many columns we have.  \n        Dim columnCount = results(0).Count()  \n  \n        ' Perform aggregate calculations on each column.              \n        ' One loop for each score column in scores.  \n        ' We can use a for loop because we have already  \n        ' executed the multiColQuery in the call to ToList.  \n  \n        For j As Integer = 0 To columnCount - 1  \n            Dim column = j  \n            Dim res2 = From row In results   \n                       Select row.ElementAt(column)  \n  \n            ' Perform aggregate calculations   \n            ' on the column specified by col.  \n            Dim avgScore = Aggregate score In res2 Into Average(score)  \n            Dim minScore = Aggregate score In res2 Into Min(score)  \n            Dim maxScore = Aggregate score In res2 Into Max(score)  \n  \n            ' Add 1 to column numbers because exams in this course start with #1  \n            Console.WriteLine(\"Exam #{0} Average: {1:##.##} High Score: {2} Low Score: {3}\",   \n                              column + 1, avgScore, maxScore, minScore)  \n  \n        Next  \n    End Sub  \n  \nEnd Class  \n' Output:  \n' Single Column Query:  \n' Exam #4: Average:76.92 High Score:94 Low Score:39  \n  \n' Multi Column Query:  \n' Exam #1 Average: 86.08 High Score: 99 Low Score: 35  \n' Exam #2 Average: 86.42 High Score: 94 Low Score: 72  \n' Exam #3 Average: 84.75 High Score: 91 Low Score: 65  \n' Exam #4 Average: 76.92 High Score: 94 Low Score: 39  \n```  \n  \n The query works by using the <xref:System.String.Split%2A> method to convert each line of text into an array. Each array element represents a column. Finally, the text in each column is converted to its numeric representation. If your file is a tab-separated file, just update the argument in the `Split` method to `\\t`.  \n  \n## Compiling the Code  \n Create a project that targets the .NET Framework version 3.5 or higher with a reference to System.Core.dll and a `Imports` statement for the System.Linq namespace.  \n  \n## See also\n\n- [LINQ and Strings (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/linq-and-strings.md)\n- [LINQ and File Directories (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/linq-and-file-directories.md)\n","nodes":[{"pos":[4,152],"embed":true,"restype":"x-metadata","content":"title: \"How to: Compute Column Values in a CSV Text File (LINQ) (Visual Basic)\"\nms.date: 07/20/2015\nms.assetid: 88b2b9f3-c82e-41f3-b1b4-26ede5973a02","nodes":[{"content":"How to: Compute Column Values in a CSV Text File (LINQ) (Visual Basic)","nodes":[{"pos":[0,70],"content":"How to: Compute Column Values in a CSV Text File (LINQ) (Visual Basic)","nodes":[{"content":"How to: Compute Column Values in a CSV Text File (LINQ) (Visual Basic)","pos":[0,70]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[159,229],"content":"How to: Compute Column Values in a CSV Text File (LINQ) (Visual Basic)","linkify":"How to: Compute Column Values in a CSV Text File (LINQ) (Visual Basic)","nodes":[{"content":"How to: Compute Column Values in a CSV Text File (LINQ) (Visual Basic)","pos":[0,70]}]},{"content":"This example shows how to perform aggregate computations such as Sum, Average, Min, and Max on the columns of a .csv file.","pos":[230,352]},{"content":"The example principles that are shown here can be applied to other types of structured text.","pos":[353,445]},{"pos":[455,480],"content":"To create the source file","linkify":"To create the source file","nodes":[{"content":"To create the source file","pos":[0,25]}]},{"content":"Copy the following lines into a file that is named scores.csv and save it in your project folder.","pos":[490,587]},{"content":"Assume that the first column represents a student ID, and subsequent columns represent scores from four exams.","pos":[588,698]},{"pos":[1042,1049],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"The query works by using the <ph id=\"ph1\">&lt;xref:System.String.Split%2A&gt;</ph> method to convert each line of text into an array.","pos":[5192,5301],"source":"The query works by using the <xref:System.String.Split%2A> method to convert each line of text into an array."},{"content":"Each array element represents a column.","pos":[5302,5341]},{"content":"Finally, the text in each column is converted to its numeric representation.","pos":[5342,5418]},{"content":"If your file is a tab-separated file, just update the argument in the <ph id=\"ph1\">`Split`</ph> method to <ph id=\"ph2\">`\\t`</ph>.","pos":[5419,5512],"source":" If your file is a tab-separated file, just update the argument in the `Split` method to `\\t`."},{"pos":[5521,5539],"content":"Compiling the Code","linkify":"Compiling the Code","nodes":[{"content":"Compiling the Code","pos":[0,18]}]},{"pos":[5543,5706],"content":"Create a project that targets the .NET Framework version 3.5 or higher with a reference to System.Core.dll and a <ph id=\"ph1\">`Imports`</ph> statement for the System.Linq namespace.","source":"Create a project that targets the .NET Framework version 3.5 or higher with a reference to System.Core.dll and a `Imports` statement for the System.Linq namespace."},{"pos":[5715,5723],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[5727,5838],"content":"<bpt id=\"p1\">[</bpt>LINQ and Strings (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/linq/linq-and-strings.md)</ept>","source":"[LINQ and Strings (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/linq-and-strings.md)"},{"pos":[5841,5970],"content":"<bpt id=\"p1\">[</bpt>LINQ and File Directories (Visual Basic)<ept id=\"p1\">](../../../../visual-basic/programming-guide/concepts/linq/linq-and-file-directories.md)</ept>","source":"[LINQ and File Directories (Visual Basic)](../../../../visual-basic/programming-guide/concepts/linq/linq-and-file-directories.md)"}]}