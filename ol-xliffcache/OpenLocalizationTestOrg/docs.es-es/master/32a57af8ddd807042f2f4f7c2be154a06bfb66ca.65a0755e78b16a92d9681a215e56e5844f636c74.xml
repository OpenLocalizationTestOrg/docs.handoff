{"content":"---\ntitle: \"How to: Use Separate X.509 Certificates for Signing and Encryption | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"WCF, extensibility\"\n  - \"ClientCredentials class\"\n  - \"ClientCredentialsSecurityTokenManager class\"\nms.assetid: 0b06ce4e-7835-4d82-8baf-d525c71a0e49\ncaps.latest.revision: 11\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# How to: Use Separate X.509 Certificates for Signing and Encryption\nThis topic shows how to configure [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] to use different certificates for message signing and encryption on both the client and service.  \n  \n To enable separate certificates to be used for signing and encryption, a custom client or service credentials (or both) must be created because [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] does not provide an API to set multiple client or service certificates. Additionally, a security token manager must be provided to leverage the multiple certificates' information and to create an appropriate security token provider for specified key usage and message direction.  \n  \n The following diagram shows the main classes used, the classes they inherit from (shown by an upward-pointing arrow), and the return types of certain methods and properties.  \n  \n-   `MyClientCredentials` is a custom implementation of <xref:System.ServiceModel.Description.ClientCredentials>.  \n  \n    -   Its properties shown in the diagram all return instances of <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>.  \n  \n    -   Its method <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> returns an instance of `MyClientCredentialsSecurityTokenManager`.  \n  \n-   `MyClientCredentialsSecurityTokenManager` is a custom implementation of <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.  \n  \n    -   Its method <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> returns an instance of <xref:System.IdentityModel.Selectors.X509SecurityTokenProvider>.  \n  \n ![Chart showing how client credentials are used](../../../../docs/framework/wcf/extending/media/e4971edd-a59f-4571-b36f-7e6b2f0d610f.gif \"e4971edd-a59f-4571-b36f-7e6b2f0d610f\")  \n  \n [!INCLUDE[crabout](../../../../includes/crabout-md.md)] custom credentials, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).  \n  \n In addition, you must create a custom identity verifier, and link it to a security binding element in a custom binding. You must also use the custom credentials instead of the default credentials.  \n  \n The following diagram shows the classes involved in the custom binding, and how the custom identity verifier is linked. There are several binding elements involved, all of which inherit from <xref:System.ServiceModel.Channels.BindingElement>. The <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> has the <xref:System.ServiceModel.Channels.LocalClientSecuritySettings> property, which returns an instance of <xref:System.ServiceModel.Security.IdentityVerifier>, from which `MyIdentityVerifier` is customized.  \n  \n ![Chart showing a custom binding element](../../../../docs/framework/wcf/extending/media/dddea4a2-0bb4-4921-9bf4-20d4d82c3da5.gif \"dddea4a2-0bb4-4921-9bf4-20d4d82c3da5\")  \n  \n [!INCLUDE[crabout](../../../../includes/crabout-md.md)] creating a custom identity verifier, see How to: [How to: Create a Custom Client Identity Verifier](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md).  \n  \n### To use separate certificates for signing and encryption  \n  \n1.  Define a new client credentials class that inherits from the <xref:System.ServiceModel.Description.ClientCredentials> class. Implement four new properties to allow multiple certificates specification: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, and `ServiceEncryptingCertificate`. Also override the <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> method to return an instance of the customized <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class that is defined in the next step.  \n  \n     [!code-csharp[c_FourCerts#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#1)]\n     [!code-vb[c_FourCerts#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#1)]  \n  \n2.  Define a new client security token manager that inherits from the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class. Override the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> method to create an appropriate security token provider. The `requirement` parameter (a <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>) provides the message direction and key usage.  \n  \n     [!code-csharp[c_FourCerts#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#2)]\n     [!code-vb[c_FourCerts#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#2)]  \n  \n3.  Define a new service credentials class that inherits from the <xref:System.ServiceModel.Description.ServiceCredentials> class. Implement four new properties to allow multiple certificates specification: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, and `ServiceEncryptingCertificate`. Also override the <xref:System.ServiceModel.Description.ServiceCredentials.CreateSecurityTokenManager%2A> method to return an instance of the customized <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class that is defined in the next step.  \n  \n     [!code-csharp[c_FourCerts#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#3)]\n     [!code-vb[c_FourCerts#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#3)]  \n  \n4.  Define a new service security token manager that inherits from the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class. Override the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> method to create an appropriate security token provider given the passed-in message direction and key usage.  \n  \n     [!code-csharp[c_FourCerts#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#4)]\n     [!code-vb[c_FourCerts#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#4)]  \n  \n### To use multiple certificates on the client  \n  \n1.  Create a custom binding. The security binding element must operate in duplex mode to allow different security token providers to be present for requests and responses. One way to do this is to use a duplex-capable transport or to use the <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> as shown in the following code. Link the customized <xref:System.ServiceModel.Security.IdentityVerifier> which is defined in the next step to the security binding element. Replace the default client credentials with the customized client credentials previously created.  \n  \n     [!code-csharp[c_FourCerts#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#5)]\n     [!code-vb[c_FourCerts#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#5)]  \n  \n2.  Define a custom <xref:System.ServiceModel.Security.IdentityVerifier>. The service has multiple identities because different certificates are used to encrypt the request and to sign the response.  \n  \n    > [!NOTE]\n    >  In the following sample, the provided custom identity verifier does not perform any endpoint identity checking for demonstration purposes. This is not recommended practice for production code.  \n  \n     [!code-csharp[c_FourCerts#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#6)]\n     [!code-vb[c_FourCerts#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#6)]  \n  \n### To use multiple certificates on the service  \n  \n1.  Create a custom binding. The security binding element must operate in a duplex mode to allow different security token providers to be present for requests and responses. As with the client, use a duplex-capable transport or use <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> as shown in the following code. Replace the default service credentials with the customized service credentials previously created.  \n  \n     [!code-csharp[c_FourCerts#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#7)]\n     [!code-vb[c_FourCerts#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#7)]  \n  \n## See Also  \n <xref:System.ServiceModel.Description.ClientCredentials>   \n <xref:System.ServiceModel.Description.ServiceCredentials>   \n <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>   \n <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager>   \n <xref:System.ServiceModel.Security.IdentityVerifier>   \n [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)","nodes":[{"pos":[4,514],"embed":true,"restype":"x-metadata","content":"title: \"How to: Use Separate X.509 Certificates for Signing and Encryption | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"WCF, extensibility\"\n  - \"ClientCredentials class\"\n  - \"ClientCredentialsSecurityTokenManager class\"\nms.assetid: 0b06ce4e-7835-4d82-8baf-d525c71a0e49\ncaps.latest.revision: 11\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"","nodes":[{"content":"How to: Use Separate X.509 Certificates for Signing and Encryption | Microsoft Docs","nodes":[{"pos":[0,83],"content":"How to: Use Separate X.509 Certificates for Signing and Encryption | Microsoft Docs","nodes":[{"content":"How to: Use Separate X.509 Certificates for Signing and Encryption | Microsoft Docs","pos":[0,83]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[521,587],"content":"How to: Use Separate X.509 Certificates for Signing and Encryption","linkify":"How to: Use Separate X.509 Certificates for Signing and Encryption","nodes":[{"content":"How to: Use Separate X.509 Certificates for Signing and Encryption","pos":[0,66]}]},{"pos":[588,774],"content":"This topic shows how to configure <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> to use different certificates for message signing and encryption on both the client and service.","source":"This topic shows how to configure [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] to use different certificates for message signing and encryption on both the client and service."},{"content":"To enable separate certificates to be used for signing and encryption, a custom client or service credentials (or both) must be created because <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> does not provide an API to set multiple client or service certificates.","pos":[781,1052],"source":"To enable separate certificates to be used for signing and encryption, a custom client or service credentials (or both) must be created because [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] does not provide an API to set multiple client or service certificates."},{"content":"Additionally, a security token manager must be provided to leverage the multiple certificates' information and to create an appropriate security token provider for specified key usage and message direction.","pos":[1053,1259]},{"content":"The following diagram shows the main classes used, the classes they inherit from (shown by an upward-pointing arrow), and the return types of certain methods and properties.","pos":[1266,1439]},{"pos":[1449,1558],"content":"<ph id=\"ph1\">`MyClientCredentials`</ph> is a custom implementation of <ph id=\"ph2\">&lt;xref:System.ServiceModel.Description.ClientCredentials&gt;</ph>.","source":"`MyClientCredentials` is a custom implementation of <xref:System.ServiceModel.Description.ClientCredentials>."},{"content":"Its properties shown in the diagram all return instances of <ph id=\"ph1\">&lt;xref:System.Security.Cryptography.X509Certificates.X509Certificate2&gt;</ph>.","pos":[1572,1702],"source":"Its properties shown in the diagram all return instances of <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>."},{"pos":[1716,1879],"content":"Its method <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A&gt;</ph> returns an instance of <ph id=\"ph2\">`MyClientCredentialsSecurityTokenManager`</ph>.","source":"Its method <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> returns an instance of `MyClientCredentialsSecurityTokenManager`."},{"pos":[1889,2026],"content":"<ph id=\"ph1\">`MyClientCredentialsSecurityTokenManager`</ph> is a custom implementation of <ph id=\"ph2\">&lt;xref:System.ServiceModel.ClientCredentialsSecurityTokenManager&gt;</ph>.","source":"`MyClientCredentialsSecurityTokenManager` is a custom implementation of <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>."},{"content":"Its method <ph id=\"ph1\">&lt;xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A&gt;</ph> returns an instance of <ph id=\"ph2\">&lt;xref:System.IdentityModel.Selectors.X509SecurityTokenProvider&gt;</ph>.","pos":[2040,2234],"source":"Its method <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> returns an instance of <xref:System.IdentityModel.Selectors.X509SecurityTokenProvider>."},{"pos":[2241,2417],"content":"<bpt id=\"p1\">![</bpt>Chart showing how client credentials are used<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wcf/extending/media/e4971edd-a59f-4571-b36f-7e6b2f0d610f.gif \"</bpt>e4971edd-a59f-4571-b36f-7e6b2f0d610f<ept id=\"p2\">\")</ept>","source":"![Chart showing how client credentials are used](../../../../docs/framework/wcf/extending/media/e4971edd-a59f-4571-b36f-7e6b2f0d610f.gif \"e4971edd-a59f-4571-b36f-7e6b2f0d610f\")"},{"pos":[2424,2670],"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> custom credentials, see <bpt id=\"p1\">[</bpt>Walkthrough: Creating Custom Client and Service Credentials<ept id=\"p1\">](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)</ept>.","source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] custom credentials, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)."},{"content":"In addition, you must create a custom identity verifier, and link it to a security binding element in a custom binding.","pos":[2677,2796]},{"content":"You must also use the custom credentials instead of the default credentials.","pos":[2797,2873]},{"content":"The following diagram shows the classes involved in the custom binding, and how the custom identity verifier is linked.","pos":[2880,2999]},{"content":"There are several binding elements involved, all of which inherit from <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.BindingElement&gt;</ph>.","pos":[3000,3122],"source":" There are several binding elements involved, all of which inherit from <xref:System.ServiceModel.Channels.BindingElement>."},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement&gt;</ph> has the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.LocalClientSecuritySettings&gt;</ph> property, which returns an instance of <ph id=\"ph3\">&lt;xref:System.ServiceModel.Security.IdentityVerifier&gt;</ph>, from which <ph id=\"ph4\">`MyIdentityVerifier`</ph> is customized.","pos":[3123,3407],"source":" The <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> has the <xref:System.ServiceModel.Channels.LocalClientSecuritySettings> property, which returns an instance of <xref:System.ServiceModel.Security.IdentityVerifier>, from which `MyIdentityVerifier` is customized."},{"pos":[3414,3583],"content":"<bpt id=\"p1\">![</bpt>Chart showing a custom binding element<ept id=\"p1\">]</ept><bpt id=\"p2\">(../../../../docs/framework/wcf/extending/media/dddea4a2-0bb4-4921-9bf4-20d4d82c3da5.gif \"</bpt>dddea4a2-0bb4-4921-9bf4-20d4d82c3da5<ept id=\"p2\">\")</ept>","source":"![Chart showing a custom binding element](../../../../docs/framework/wcf/extending/media/dddea4a2-0bb4-4921-9bf4-20d4d82c3da5.gif \"dddea4a2-0bb4-4921-9bf4-20d4d82c3da5\")"},{"pos":[3590,3839],"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> creating a custom identity verifier, see How to: <bpt id=\"p1\">[</bpt>How to: Create a Custom Client Identity Verifier<ept id=\"p1\">](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md)</ept>.","source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] creating a custom identity verifier, see How to: [How to: Create a Custom Client Identity Verifier](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md)."},{"pos":[3849,3904],"content":"To use separate certificates for signing and encryption","linkify":"To use separate certificates for signing and encryption","nodes":[{"content":"To use separate certificates for signing and encryption","pos":[0,55]}]},{"content":"Define a new client credentials class that inherits from the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ClientCredentials&gt;</ph> class.","pos":[3914,4038],"source":"Define a new client credentials class that inherits from the <xref:System.ServiceModel.Description.ClientCredentials> class."},{"content":"Implement four new properties to allow multiple certificates specification: <ph id=\"ph1\">`ClientSigningCertificate`</ph>, <ph id=\"ph2\">`ClientEncryptingCertificate`</ph>, <ph id=\"ph3\">`ServiceSigningCertificate`</ph>, and <ph id=\"ph4\">`ServiceEncryptingCertificate`</ph>.","pos":[4039,4238],"source":" Implement four new properties to allow multiple certificates specification: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, and `ServiceEncryptingCertificate`."},{"content":"Also override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A&gt;</ph> method to return an instance of the customized <ph id=\"ph2\">&lt;xref:System.ServiceModel.ClientCredentialsSecurityTokenManager&gt;</ph> class that is defined in the next step.","pos":[4239,4495],"source":" Also override the <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> method to return an instance of the customized <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class that is defined in the next step."},{"pos":[4506,4731],"content":"[!code-csharp[c_FourCerts#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#1)]\n [!code-vb[c_FourCerts#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#1)]","leadings":["","    "],"nodes":[]},{"content":"Define a new client security token manager that inherits from the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ClientCredentialsSecurityTokenManager&gt;</ph> class.","pos":[4741,4878],"source":"Define a new client security token manager that inherits from the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class."},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A&gt;</ph> method to create an appropriate security token provider.","pos":[4879,5044],"source":" Override the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> method to create an appropriate security token provider."},{"content":"The <ph id=\"ph1\">`requirement`</ph> parameter (a <ph id=\"ph2\">&lt;xref:System.IdentityModel.Selectors.SecurityTokenRequirement&gt;</ph>) provides the message direction and key usage.","pos":[5045,5185],"source":" The `requirement` parameter (a <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>) provides the message direction and key usage."},{"pos":[5196,5421],"content":"[!code-csharp[c_FourCerts#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#2)]\n [!code-vb[c_FourCerts#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#2)]","leadings":["","    "],"nodes":[]},{"content":"Define a new service credentials class that inherits from the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceCredentials&gt;</ph> class.","pos":[5431,5557],"source":"Define a new service credentials class that inherits from the <xref:System.ServiceModel.Description.ServiceCredentials> class."},{"content":"Implement four new properties to allow multiple certificates specification: <ph id=\"ph1\">`ClientSigningCertificate`</ph>, <ph id=\"ph2\">`ClientEncryptingCertificate`</ph>, <ph id=\"ph3\">`ServiceSigningCertificate`</ph>, and <ph id=\"ph4\">`ServiceEncryptingCertificate`</ph>.","pos":[5558,5757],"source":" Implement four new properties to allow multiple certificates specification: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, and `ServiceEncryptingCertificate`."},{"content":"Also override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceCredentials.CreateSecurityTokenManager%2A&gt;</ph> method to return an instance of the customized <ph id=\"ph2\">&lt;xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager&gt;</ph> class that is defined in the next step.","pos":[5758,6025],"source":" Also override the <xref:System.ServiceModel.Description.ServiceCredentials.CreateSecurityTokenManager%2A> method to return an instance of the customized <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class that is defined in the next step."},{"pos":[6036,6261],"content":"[!code-csharp[c_FourCerts#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#3)]\n [!code-vb[c_FourCerts#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#3)]","leadings":["","    "],"nodes":[]},{"content":"Define a new service security token manager that inherits from the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager&gt;</ph> class.","pos":[6271,6419],"source":"Define a new service security token manager that inherits from the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class."},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A&gt;</ph> method to create an appropriate security token provider given the passed-in message direction and key usage.","pos":[6420,6647],"source":" Override the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> method to create an appropriate security token provider given the passed-in message direction and key usage."},{"pos":[6658,6883],"content":"[!code-csharp[c_FourCerts#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#4)]\n [!code-vb[c_FourCerts#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#4)]","leadings":["","    "],"nodes":[]},{"pos":[6893,6935],"content":"To use multiple certificates on the client","linkify":"To use multiple certificates on the client","nodes":[{"content":"To use multiple certificates on the client","pos":[0,42]}]},{"content":"Create a custom binding.","pos":[6945,6969]},{"content":"The security binding element must operate in duplex mode to allow different security token providers to be present for requests and responses.","pos":[6970,7112]},{"content":"One way to do this is to use a duplex-capable transport or to use the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.CompositeDuplexBindingElement&gt;</ph> as shown in the following code.","pos":[7113,7280],"source":" One way to do this is to use a duplex-capable transport or to use the <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> as shown in the following code."},{"content":"Link the customized <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IdentityVerifier&gt;</ph> which is defined in the next step to the security binding element.","pos":[7281,7420],"source":" Link the customized <xref:System.ServiceModel.Security.IdentityVerifier> which is defined in the next step to the security binding element."},{"content":"Replace the default client credentials with the customized client credentials previously created.","pos":[7421,7518]},{"pos":[7529,7754],"content":"[!code-csharp[c_FourCerts#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#5)]\n [!code-vb[c_FourCerts#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#5)]","leadings":["","    "],"nodes":[]},{"content":"Define a custom <ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IdentityVerifier&gt;</ph>.","pos":[7764,7833],"source":"Define a custom <xref:System.ServiceModel.Security.IdentityVerifier>."},{"content":"The service has multiple identities because different certificates are used to encrypt the request and to sign the response.","pos":[7834,7958]},{"pos":[7970,8177],"content":"[!NOTE]\nIn the following sample, the provided custom identity verifier does not perform any endpoint identity checking for demonstration purposes. This is not recommended practice for production code.","leadings":["","    >  "],"nodes":[{"content":"In the following sample, the provided custom identity verifier does not perform any endpoint identity checking for demonstration purposes. This is not recommended practice for production code.","pos":[8,200],"nodes":[{"content":"In the following sample, the provided custom identity verifier does not perform any endpoint identity checking for demonstration purposes.","pos":[0,138]},{"content":"This is not recommended practice for production code.","pos":[139,192]}]}]},{"pos":[8188,8413],"content":"[!code-csharp[c_FourCerts#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#6)]\n [!code-vb[c_FourCerts#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#6)]","leadings":["","    "],"nodes":[]},{"pos":[8423,8466],"content":"To use multiple certificates on the service","linkify":"To use multiple certificates on the service","nodes":[{"content":"To use multiple certificates on the service","pos":[0,43]}]},{"content":"Create a custom binding.","pos":[8476,8500]},{"content":"The security binding element must operate in a duplex mode to allow different security token providers to be present for requests and responses.","pos":[8501,8645]},{"content":"As with the client, use a duplex-capable transport or use <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.CompositeDuplexBindingElement&gt;</ph> as shown in the following code.","pos":[8646,8801],"source":" As with the client, use a duplex-capable transport or use <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> as shown in the following code."},{"content":"Replace the default service credentials with the customized service credentials previously created.","pos":[8802,8901]},{"pos":[8912,9137],"content":"[!code-csharp[c_FourCerts#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#7)]\n [!code-vb[c_FourCerts#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#7)]","leadings":["","    "],"nodes":[]},{"pos":[9146,9154],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ClientCredentials&gt;</ph>","pos":[9158,9214],"source":"<xref:System.ServiceModel.Description.ClientCredentials> "},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Description.ServiceCredentials&gt;</ph>","pos":[9219,9276],"source":"<xref:System.ServiceModel.Description.ServiceCredentials> "},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.ClientCredentialsSecurityTokenManager&gt;</ph>","pos":[9281,9345],"source":"<xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> "},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager&gt;</ph>","pos":[9350,9424],"source":"<xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> "},{"content":"<ph id=\"ph1\">&lt;xref:System.ServiceModel.Security.IdentityVerifier&gt;</ph>","pos":[9429,9481],"source":"<xref:System.ServiceModel.Security.IdentityVerifier> "},{"content":"<bpt id=\"p1\">[</bpt>Walkthrough: Creating Custom Client and Service Credentials<ept id=\"p1\">](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)</ept>","pos":[9486,9651],"source":"[Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)"}]}