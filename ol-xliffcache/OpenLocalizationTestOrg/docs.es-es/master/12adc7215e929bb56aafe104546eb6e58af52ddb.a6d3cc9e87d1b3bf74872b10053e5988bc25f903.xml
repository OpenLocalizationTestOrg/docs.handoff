{"content":"---\ntitle: \"How to: Implement a Discovery Proxy\"\nms.date: \"03/30/2017\"\nms.assetid: 78d70e0a-f6c3-4cfb-a7ca-f66ebddadde0\n---\n# How to: Implement a Discovery Proxy\nThis topic explains how to implement a discovery proxy. For more information about the discovery feature in Windows Communication Foundation (WCF), see [WCF Discovery Overview](../../../../docs/framework/wcf/feature-details/wcf-discovery-overview.md). A discovery proxy can be implemented by creating a class that extends the <xref:System.ServiceModel.Discovery.DiscoveryProxy> abstract class. There are a number of other support classes defined and used in this sample. `OnResolveAsyncResult`, `OnFindAsyncResult`, and `AsyncResult`. These classes implement the <xref:System.IAsyncResult> interface. For more information about <xref:System.IAsyncResult> see [System.IAsyncResult interface](xref:System.IAsyncResult).\n\n Implementing a discovery proxy is broken down into three main parts in this topic:\n\n-   Define a class that contains a data store and extends the abstract <xref:System.ServiceModel.Discovery.DiscoveryProxy> class.\n\n-   Implement the helper `AsyncResult` class.\n\n-   Host the Discovery Proxy.\n\n### To create a new console application project\n\n1.  Start Visual Studio 2012.\n\n2.  Create a new console application project. Name the project `DiscoveryProxy` and the name the solution `DiscoveryProxyExample`.\n\n3.  Add the following references to the project\n\n    1.  System.ServiceModel.dll\n\n    2.  System.Servicemodel.Discovery.dll\n\n    > [!CAUTION]\n    >  Ensure that you reference version 4.0 or greater of these assemblies.\n\n### To implement the ProxyDiscoveryService class\n\n1.  Add a new code file to your project and name it DiscoveryProxy.cs.\n\n2.  Add the following `using` statements to DiscoveryProxy.cs.\n\n    ```\n    using System;\n    using System.Collections.Generic;\n    using System.ServiceModel;\n    using System.ServiceModel.Discovery;\n    using System.Xml;\n    ```\n\n3.  Derive the `DiscoveryProxyService` from <xref:System.ServiceModel.Discovery.DiscoveryProxy>. Apply the `ServiceBehavior` attribute to the class as shown in the following example.\n\n    ```\n    // Implement DiscoveryProxy by extending the DiscoveryProxy class and overriding the abstract methods\n    [ServiceBehavior(InstanceContextMode = InstanceContextMode.Single, ConcurrencyMode = ConcurrencyMode.Multiple)]\n    public class DiscoveryProxyService : DiscoveryProxy\n    {\n    }\n    ```\n\n4.  Inside the `DiscoveryProxy` class define a dictionary to hold the registered services.\n\n    ```\n    // Repository to store EndpointDiscoveryMetadata.\n    Dictionary<EndpointAddress, EndpointDiscoveryMetadata> onlineServices;\n    ```\n\n5.  Define a constructor that initializes the dictionary.\n\n    ```\n    public DiscoveryProxyService()\n            {\n                this.onlineServices = new Dictionary<EndpointAddress, EndpointDiscoveryMetadata>();\n            }\n    ```\n\n### To define the methods used to update the discovery proxy cache\n\n1.  Implement the `AddOnlineservice` method to add services to the cache. This is called every time the proxy receives an announcement message.\n\n    ```\n    void AddOnlineService(EndpointDiscoveryMetadata endpointDiscoveryMetadata)\n            {\n                lock (this.onlineServices)\n                {\n                    this.onlineServices[endpointDiscoveryMetadata.Address] = endpointDiscoveryMetadata;\n                }\n\n                PrintDiscoveryMetadata(endpointDiscoveryMetadata, \"Adding\");\n            }\n    ```\n\n2.  Implement the `RemoveOnlineService` method that is used to remove services from the cache.\n\n    ```\n    void RemoveOnlineService(EndpointDiscoveryMetadata endpointDiscoveryMetadata)\n            {\n                if (endpointDiscoveryMetadata != null)\n                {\n                    lock (this.onlineServices)\n                    {\n                        this.onlineServices.Remove(endpointDiscoveryMetadata.Address);\n                    }\n\n                    PrintDiscoveryMetadata(endpointDiscoveryMetadata, \"Removing\");\n                }\n            }\n    ```\n\n3.  Implement the `MatchFromOnlineService` methods that attempt to match a service with a service in the dictionary.\n\n    ```\n    void MatchFromOnlineService(FindRequestContext findRequestContext)\n            {\n                lock (this.onlineServices)\n                {\n                    foreach (EndpointDiscoveryMetadata endpointDiscoveryMetadata in this.onlineServices.Values)\n                    {\n                        if (findRequestContext.Criteria.IsMatch(endpointDiscoveryMetadata))\n                        {\n                            findRequestContext.AddMatchingEndpoint(endpointDiscoveryMetadata);\n                        }\n                    }\n                }\n            }\n    ```\n\n    ```\n    EndpointDiscoveryMetadata MatchFromOnlineService(ResolveCriteria criteria)\n            {\n                EndpointDiscoveryMetadata matchingEndpoint = null;\n                lock (this.onlineServices)\n                {\n                    foreach (EndpointDiscoveryMetadata endpointDiscoveryMetadata in this.onlineServices.Values)\n                    {\n                        if (criteria.Address == endpointDiscoveryMetadata.Address)\n                        {\n                            matchingEndpoint = endpointDiscoveryMetadata;\n                        }\n                    }\n                }\n                return matchingEndpoint;\n            }\n    ```\n\n4.  Implement the `PrintDiscoveryMetadata` method that provides the user with console text output of what the discovery proxy is doing.\n\n    ```\n    void PrintDiscoveryMetadata(EndpointDiscoveryMetadata endpointDiscoveryMetadata, string verb)\n            {\n                Console.WriteLine(\"\\n**** \" + verb + \" service of the following type from cache. \");\n                foreach (XmlQualifiedName contractName in endpointDiscoveryMetadata.ContractTypeNames)\n                {\n                    Console.WriteLine(\"** \" + contractName.ToString());\n                    break;\n                }\n                Console.WriteLine(\"**** Operation Completed\");\n            }\n    ```\n\n5.  Add the following AsyncResult classes to the DiscoveryProxyService. These classes are used to differentiate between the different asynchronous operation results.\n\n    ```\n    sealed class OnOnlineAnnouncementAsyncResult : AsyncResult\n            {\n                public OnOnlineAnnouncementAsyncResult(AsyncCallback callback, object state)\n                    : base(callback, state)\n                {\n                    this.Complete(true);\n                }\n\n                public static void End(IAsyncResult result)\n                {\n                    AsyncResult.End<OnOnlineAnnouncementAsyncResult>(result);\n                }\n            }\n\n            sealed class OnOfflineAnnouncementAsyncResult : AsyncResult\n            {\n                public OnOfflineAnnouncementAsyncResult(AsyncCallback callback, object state)\n                    : base(callback, state)\n                {\n                    this.Complete(true);\n                }\n\n                public static void End(IAsyncResult result)\n                {\n                    AsyncResult.End<OnOfflineAnnouncementAsyncResult>(result);\n                }\n            }\n\n            sealed class OnFindAsyncResult : AsyncResult\n            {\n                public OnFindAsyncResult(AsyncCallback callback, object state)\n                    : base(callback, state)\n                {\n                    this.Complete(true);\n                }\n\n                public static void End(IAsyncResult result)\n                {\n                    AsyncResult.End<OnFindAsyncResult>(result);\n                }\n            }\n\n            sealed class OnResolveAsyncResult : AsyncResult\n            {\n                EndpointDiscoveryMetadata matchingEndpoint;\n\n                public OnResolveAsyncResult(EndpointDiscoveryMetadata matchingEndpoint, AsyncCallback callback, object state)\n                    : base(callback, state)\n                {\n                    this.matchingEndpoint = matchingEndpoint;\n                    this.Complete(true);\n                }\n\n                public static EndpointDiscoveryMetadata End(IAsyncResult result)\n                {\n                    OnResolveAsyncResult thisPtr = AsyncResult.End<OnResolveAsyncResult>(result);\n                    return thisPtr.matchingEndpoint;\n                }\n            }\n    ```\n\n### To define the methods that implement the discovery proxy functionality\n\n1.  Override the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnBeginOnlineAnnouncement%2A?displayProperty=nameWithType> method. This method is called when the discovery proxy receives an online announcement message.\n\n    ```\n    // OnBeginOnlineAnnouncement method is called when a Hello message is received by the Proxy\n            protected override IAsyncResult OnBeginOnlineAnnouncement(DiscoveryMessageSequence messageSequence, EndpointDiscoveryMetadata endpointDiscoveryMetadata, AsyncCallback callback, object state)\n            {\n                this.AddOnlineService(endpointDiscoveryMetadata);\n                return new OnOnlineAnnouncementAsyncResult(callback, state);\n            }\n    ```\n\n2.  Override the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnEndOnlineAnnouncement%2A?displayProperty=nameWithType> method. This method is called when the discovery proxy finishes processing an announcement message.\n\n    ```\n    protected override void OnEndOnlineAnnouncement(IAsyncResult result)\n            {\n                OnOnlineAnnouncementAsyncResult.End(result);\n            }\n    ```\n\n3.  Override the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnBeginOfflineAnnouncement%2A?displayProperty=nameWithType> method. This method is called with the discovery proxy receives an offline announcement message.\n\n    ```\n    // OnBeginOfflineAnnouncement method is called when a Bye message is received by the Proxy\n            protected override IAsyncResult OnBeginOfflineAnnouncement(DiscoveryMessageSequence messageSequence, EndpointDiscoveryMetadata endpointDiscoveryMetadata, AsyncCallback callback, object state)\n            {\n                this.RemoveOnlineService(endpointDiscoveryMetadata);\n                return new OnOfflineAnnouncementAsyncResult(callback, state);\n            }\n    ```\n\n4.  Override the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnEndOfflineAnnouncement%2A?displayProperty=nameWithType> method. This method is called when the discovery proxy finishes processing an offline announcement message.\n\n    ```\n    protected override void OnEndOfflineAnnouncement(IAsyncResult result)\n            {\n                OnOfflineAnnouncementAsyncResult.End(result);\n            }\n    ```\n\n5.  Override the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnBeginFind%2A?displayProperty=nameWithType> method. This method is called when the discovery proxy receives a find request.\n\n    ```\n    // OnBeginFind method is called when a Probe request message is received by the Proxy\n            protected override IAsyncResult OnBeginFind(FindRequestContext findRequestContext, AsyncCallback callback, object state)\n            {\n                this.MatchFromOnlineService(findRequestContext);\n                return new OnFindAsyncResult(callback, state);\n            }\n    protected override IAsyncResult OnBeginFind(FindRequest findRequest, AsyncCallback callback, object state)\n    {\n        Collection<EndpointDiscoveryMetadata> matchingEndpoints = MatchFromCache(findRequest.Criteria);\n        return new OnFindAsyncResult(\n                    matchingEndpoints,\n                    callback,\n                    state);\n    }\n    ```\n\n6.  Override the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnEndFind%2A?displayProperty=nameWithType> method. This method is called when the discovery proxy finishes processing a find request.\n\n    ```\n    protected override void OnEndFind(IAsyncResult result)\n            {\n                OnFindAsyncResult.End(result);\n            }\n    ```\n\n7.  Override the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnBeginResolve%2A?displayProperty=nameWithType> method. This method is called when the discovery proxy receives a resolve message.\n\n    ```\n    // OnBeginFind method is called when a Resolve request message is received by the Proxy\n            protected override IAsyncResult OnBeginResolve(ResolveCriteria resolveCriteria, AsyncCallback callback, object state)\n            {\n                return new OnResolveAsyncResult(this.MatchFromOnlineService(resolveCriteria), callback, state);\n            }\n    protected override IAsyncResult OnBeginResolve(ResolveRequest resolveRequest, AsyncCallback callback, object state)\n    {\n        return new OnResolveAsyncResult(\n            this.proxy.MatchFromOnlineService(resolveRequest.Criteria),\n            callback,\n            state);\n    }\n    ```\n\n8.  Override the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnEndResolve%2A?displayProperty=nameWithType> method. This method is called when the discovery proxy finishes processing a resolve message.\n\n    ```\n    protected override EndpointDiscoveryMetadata OnEndResolve(IAsyncResult result)\n    {\n        return OnResolveAsyncResult.End(result);\n    }\n    ```\n\n The OnBegin.. / OnEnd.. methods provide the logic for the subsequent discovery operations. For example the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnBeginFind%2A> and <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnEndFind%2A> methods implement the find logic for discovery proxy. When the discovery proxy receives a probe message these methods are executed to send a response back to the client. You may modify the find logic as you wish, for example you can incorporate custom scope matching by algorithms or application specific XML metadata parsing as part of your find operation.\n\n### To implement the AsyncResult class\n\n1.  Define the abstract base class AsyncResult which is used to derive the various async result classes.\n\n2.  Create a new code file called AsyncResult.cs.\n\n3.  Add the following `using` statements to AsyncResult.cs.\n\n    ```\n    using System;\n    using System.Threading;\n    ```\n\n4.  Add the following AsyncResult class.\n\n    ```\n    abstract class AsyncResult : IAsyncResult\n        {\n            AsyncCallback callback;\n            bool completedSynchronously;\n            bool endCalled;\n            Exception exception;\n            bool isCompleted;\n            ManualResetEvent manualResetEvent;\n            object state;\n            object thisLock;\n\n            protected AsyncResult(AsyncCallback callback, object state)\n            {\n                this.callback = callback;\n                this.state = state;\n                this.thisLock = new object();\n            }\n\n            public object AsyncState\n            {\n                get\n                {\n                    return state;\n                }\n            }\n\n            public WaitHandle AsyncWaitHandle\n            {\n                get\n                {\n                    if (manualResetEvent != null)\n                    {\n                        return manualResetEvent;\n                    }\n                    lock (ThisLock)\n                    {\n                        if (manualResetEvent == null)\n                        {\n                            manualResetEvent = new ManualResetEvent(isCompleted);\n                        }\n                    }\n                    return manualResetEvent;\n                }\n            }\n\n            public bool CompletedSynchronously\n            {\n                get\n                {\n                    return completedSynchronously;\n                }\n            }\n\n            public bool IsCompleted\n            {\n                get\n                {\n                    return isCompleted;\n                }\n            }\n\n            object ThisLock\n            {\n                get\n                {\n                    return this.thisLock;\n                }\n            }\n\n            protected static TAsyncResult End<TAsyncResult>(IAsyncResult result)\n                where TAsyncResult : AsyncResult\n            {\n                if (result == null)\n                {\n                    throw new ArgumentNullException(\"result\");\n                }\n\n                TAsyncResult asyncResult = result as TAsyncResult;\n\n                if (asyncResult == null)\n                {\n                    throw new ArgumentException(\"Invalid async result.\", \"result\");\n                }\n\n                if (asyncResult.endCalled)\n                {\n                    throw new InvalidOperationException(\"Async object already ended.\");\n                }\n\n                asyncResult.endCalled = true;\n\n                if (!asyncResult.isCompleted)\n                {\n                    asyncResult.AsyncWaitHandle.WaitOne();\n                }\n\n                if (asyncResult.manualResetEvent != null)\n                {\n                    asyncResult.manualResetEvent.Close();\n                }\n\n                if (asyncResult.exception != null)\n                {\n                    throw asyncResult.exception;\n                }\n\n                return asyncResult;\n            }\n\n            protected void Complete(bool completedSynchronously)\n            {\n                if (isCompleted)\n                {\n                    throw new InvalidOperationException(\"This async result is already completed.\");\n                }\n\n                this.completedSynchronously = completedSynchronously;\n\n                if (completedSynchronously)\n                {\n                    this.isCompleted = true;\n                }\n                else\n                {\n                    lock (ThisLock)\n                    {\n                        this.isCompleted = true;\n                        if (this.manualResetEvent != null)\n                        {\n                            this.manualResetEvent.Set();\n                        }\n                    }\n                }\n\n                if (callback != null)\n                {\n                    callback(this);\n                }\n            }\n\n            protected void Complete(bool completedSynchronously, Exception exception)\n            {\n                this.exception = exception;\n                Complete(completedSynchronously);\n            }\n        }\n    ```\n\n### To host the DiscoveryProxy\n\n1.  Open the Program.cs file in the DiscoveryProxyExample project.\n\n2.  Add the following `using` statements.\n\n    ```\n    using System;\n    using System.ServiceModel;\n    using System.ServiceModel.Discovery;\n    ```\n\n3.  Within the `Main()` method, add the following code. This creates an instance of the `DiscoveryProxy` class.\n\n    ```\n    Uri probeEndpointAddress = new Uri(\"net.tcp://localhost:8001/Probe\");\n                Uri announcementEndpointAddress = new Uri(\"net.tcp://localhost:9021/Announcement\");\n\n                // Host the DiscoveryProxy service\n                ServiceHost proxyServiceHost = new ServiceHost(new DiscoveryProxyService());\n    ```\n\n4.  Next add the following code to add a discovery endpoint and an announcement endpoint.\n\n    ```\n    try\n              {\n                  // Add DiscoveryEndpoint to receive Probe and Resolve messages\n                  DiscoveryEndpoint discoveryEndpoint = new DiscoveryEndpoint(new NetTcpBinding(), new EndpointAddress(probeEndpointAddress));\n                  discoveryEndpoint.IsSystemEndpoint = false;\n\n                  // Add AnnouncementEndpoint to receive Hello and Bye announcement messages\n                  AnnouncementEndpoint announcementEndpoint = new AnnouncementEndpoint(new NetTcpBinding(), new EndpointAddress(announcementEndpointAddress));\n\n                  proxyServiceHost.AddServiceEndpoint(discoveryEndpoint);\n                  proxyServiceHost.AddServiceEndpoint(announcementEndpoint);\n\n                  proxyServiceHost.Open();\n\n                  Console.WriteLine(\"Proxy Service started.\");\n                  Console.WriteLine();\n                  Console.WriteLine(\"Press <ENTER> to terminate the service.\");\n                  Console.WriteLine();\n                  Console.ReadLine();\n\n                  proxyServiceHost.Close();\n              }\n              catch (CommunicationException e)\n              {\n                  Console.WriteLine(e.Message);\n              }\n              catch (TimeoutException e)\n              {\n                  Console.WriteLine(e.Message);\n              }\n\n              if (proxyServiceHost.State != CommunicationState.Closed)\n              {\n                  Console.WriteLine(\"Aborting the service...\");\n                  proxyServiceHost.Abort();\n              }\n    ```\n\n You have completed implementing the discovery proxy. Continue on to [How to: Implement a Discoverable Service that Registers with the Discovery Proxy](../../../../docs/framework/wcf/feature-details/discoverable-service-that-registers-with-the-discovery-proxy.md).\n\n## Example\n This is the full listing of the code used in this topic.\n\n```\n// DiscoveryProxy.cs\n//----------------------------------------------------------------\n// Copyright (c) Microsoft Corporation.  All rights reserved.\n//----------------------------------------------------------------\n\nusing System;\nusing System.Collections.Generic;\nusing System.ServiceModel;\nusing System.ServiceModel.Discovery;\nusing System.Xml;\n\nnamespace Microsoft.Samples.Discovery\n{\n    // Implement DiscoveryProxy by extending the DiscoveryProxy class and overriding the abstract methods\n    [ServiceBehavior(InstanceContextMode = InstanceContextMode.Single, ConcurrencyMode = ConcurrencyMode.Multiple)]\n    public class DiscoveryProxyService : DiscoveryProxy\n    {\n        // Repository to store EndpointDiscoveryMetadata. A database or a flat file could also be used instead.\n        Dictionary<EndpointAddress, EndpointDiscoveryMetadata> onlineServices;\n\n        public DiscoveryProxyService()\n        {\n            this.onlineServices = new Dictionary<EndpointAddress, EndpointDiscoveryMetadata>();\n        }\n\n        // OnBeginOnlineAnnouncement method is called when a Hello message is received by the Proxy\n        protected override IAsyncResult OnBeginOnlineAnnouncement(DiscoveryMessageSequence messageSequence, EndpointDiscoveryMetadata endpointDiscoveryMetadata, AsyncCallback callback, object state)\n        {\n            this.AddOnlineService(endpointDiscoveryMetadata);\n            return new OnOnlineAnnouncementAsyncResult(callback, state);\n        }\n\n        protected override void OnEndOnlineAnnouncement(IAsyncResult result)\n        {\n            OnOnlineAnnouncementAsyncResult.End(result);\n        }\n\n        // OnBeginOfflineAnnouncement method is called when a Bye message is received by the Proxy\n        protected override IAsyncResult OnBeginOfflineAnnouncement(DiscoveryMessageSequence messageSequence, EndpointDiscoveryMetadata endpointDiscoveryMetadata, AsyncCallback callback, object state)\n        {\n            this.RemoveOnlineService(endpointDiscoveryMetadata);\n            return new OnOfflineAnnouncementAsyncResult(callback, state);\n        }\n\n        protected override void OnEndOfflineAnnouncement(IAsyncResult result)\n        {\n            OnOfflineAnnouncementAsyncResult.End(result);\n        }\n\n        // OnBeginFind method is called when a Probe request message is received by the Proxy\n        protected override IAsyncResult OnBeginFind(FindRequestContext findRequestContext, AsyncCallback callback, object state)\n        {\n            this.MatchFromOnlineService(findRequestContext);\n            return new OnFindAsyncResult(callback, state);\n        }\n\n        protected override void OnEndFind(IAsyncResult result)\n        {\n            OnFindAsyncResult.End(result);\n        }\n\n        // OnBeginFind method is called when a Resolve request message is received by the Proxy\n        protected override IAsyncResult OnBeginResolve(ResolveCriteria resolveCriteria, AsyncCallback callback, object state)\n        {\n            return new OnResolveAsyncResult(this.MatchFromOnlineService(resolveCriteria), callback, state);\n        }\n\n        protected override EndpointDiscoveryMetadata OnEndResolve(IAsyncResult result)\n        {\n            return OnResolveAsyncResult.End(result);\n        }\n\n        // The following are helper methods required by the Proxy implementation\n        void AddOnlineService(EndpointDiscoveryMetadata endpointDiscoveryMetadata)\n        {\n            lock (this.onlineServices)\n            {\n                this.onlineServices[endpointDiscoveryMetadata.Address] = endpointDiscoveryMetadata;\n            }\n\n            PrintDiscoveryMetadata(endpointDiscoveryMetadata, \"Adding\");\n        }\n\n        void RemoveOnlineService(EndpointDiscoveryMetadata endpointDiscoveryMetadata)\n        {\n            if (endpointDiscoveryMetadata != null)\n            {\n                lock (this.onlineServices)\n                {\n                    this.onlineServices.Remove(endpointDiscoveryMetadata.Address);\n                }\n\n                PrintDiscoveryMetadata(endpointDiscoveryMetadata, \"Removing\");\n            }\n        }\n\n        void MatchFromOnlineService(FindRequestContext findRequestContext)\n        {\n            lock (this.onlineServices)\n            {\n                foreach (EndpointDiscoveryMetadata endpointDiscoveryMetadata in this.onlineServices.Values)\n                {\n                    if (findRequestContext.Criteria.IsMatch(endpointDiscoveryMetadata))\n                    {\n                        findRequestContext.AddMatchingEndpoint(endpointDiscoveryMetadata);\n                    }\n                }\n            }\n        }\n\n        EndpointDiscoveryMetadata MatchFromOnlineService(ResolveCriteria criteria)\n        {\n            EndpointDiscoveryMetadata matchingEndpoint = null;\n            lock (this.onlineServices)\n            {\n                foreach (EndpointDiscoveryMetadata endpointDiscoveryMetadata in this.onlineServices.Values)\n                {\n                    if (criteria.Address == endpointDiscoveryMetadata.Address)\n                    {\n                        matchingEndpoint = endpointDiscoveryMetadata;\n                    }\n                }\n            }\n            return matchingEndpoint;\n        }\n\n        void PrintDiscoveryMetadata(EndpointDiscoveryMetadata endpointDiscoveryMetadata, string verb)\n        {\n            Console.WriteLine(\"\\n**** \" + verb + \" service of the following type from cache. \");\n            foreach (XmlQualifiedName contractName in endpointDiscoveryMetadata.ContractTypeNames)\n            {\n                Console.WriteLine(\"** \" + contractName.ToString());\n                break;\n            }\n            Console.WriteLine(\"**** Operation Completed\");\n        }\n\n        sealed class OnOnlineAnnouncementAsyncResult : AsyncResult\n        {\n            public OnOnlineAnnouncementAsyncResult(AsyncCallback callback, object state)\n                : base(callback, state)\n            {\n                this.Complete(true);\n            }\n\n            public static void End(IAsyncResult result)\n            {\n                AsyncResult.End<OnOnlineAnnouncementAsyncResult>(result);\n            }\n        }\n\n        sealed class OnOfflineAnnouncementAsyncResult : AsyncResult\n        {\n            public OnOfflineAnnouncementAsyncResult(AsyncCallback callback, object state)\n                : base(callback, state)\n            {\n                this.Complete(true);\n            }\n\n            public static void End(IAsyncResult result)\n            {\n                AsyncResult.End<OnOfflineAnnouncementAsyncResult>(result);\n            }\n        }\n\n        sealed class OnFindAsyncResult : AsyncResult\n        {\n            public OnFindAsyncResult(AsyncCallback callback, object state)\n                : base(callback, state)\n            {\n                this.Complete(true);\n            }\n\n            public static void End(IAsyncResult result)\n            {\n                AsyncResult.End<OnFindAsyncResult>(result);\n            }\n        }\n\n        sealed class OnResolveAsyncResult : AsyncResult\n        {\n            EndpointDiscoveryMetadata matchingEndpoint;\n\n            public OnResolveAsyncResult(EndpointDiscoveryMetadata matchingEndpoint, AsyncCallback callback, object state)\n                : base(callback, state)\n            {\n                this.matchingEndpoint = matchingEndpoint;\n                this.Complete(true);\n            }\n\n            public static EndpointDiscoveryMetadata End(IAsyncResult result)\n            {\n                OnResolveAsyncResult thisPtr = AsyncResult.End<OnResolveAsyncResult>(result);\n                return thisPtr.matchingEndpoint;\n            }\n        }\n    }\n}\n```\n\n```\n// AsyncResult.cs\n//----------------------------------------------------------------\n// Copyright (c) Microsoft Corporation.  All rights reserved.\n//----------------------------------------------------------------\n\nusing System;\nusing System.Threading;\n\nnamespace Microsoft.Samples.Discovery\n{\n    abstract class AsyncResult : IAsyncResult\n    {\n        AsyncCallback callback;\n        bool completedSynchronously;\n        bool endCalled;\n        Exception exception;\n        bool isCompleted;\n        ManualResetEvent manualResetEvent;\n        object state;\n        object thisLock;\n\n        protected AsyncResult(AsyncCallback callback, object state)\n        {\n            this.callback = callback;\n            this.state = state;\n            this.thisLock = new object();\n        }\n\n        public object AsyncState\n        {\n            get\n            {\n                return state;\n            }\n        }\n\n        public WaitHandle AsyncWaitHandle\n        {\n            get\n            {\n                if (manualResetEvent != null)\n                {\n                    return manualResetEvent;\n                }\n                lock (ThisLock)\n                {\n                    if (manualResetEvent == null)\n                    {\n                        manualResetEvent = new ManualResetEvent(isCompleted);\n                    }\n                }\n                return manualResetEvent;\n            }\n        }\n\n        public bool CompletedSynchronously\n        {\n            get\n            {\n                return completedSynchronously;\n            }\n        }\n\n        public bool IsCompleted\n        {\n            get\n            {\n                return isCompleted;\n            }\n        }\n\n        object ThisLock\n        {\n            get\n            {\n                return this.thisLock;\n            }\n        }\n\n        protected static TAsyncResult End<TAsyncResult>(IAsyncResult result)\n            where TAsyncResult : AsyncResult\n        {\n            if (result == null)\n            {\n                throw new ArgumentNullException(\"result\");\n            }\n\n            TAsyncResult asyncResult = result as TAsyncResult;\n\n            if (asyncResult == null)\n            {\n                throw new ArgumentException(\"Invalid async result.\", \"result\");\n            }\n\n            if (asyncResult.endCalled)\n            {\n                throw new InvalidOperationException(\"Async object already ended.\");\n            }\n\n            asyncResult.endCalled = true;\n\n            if (!asyncResult.isCompleted)\n            {\n                asyncResult.AsyncWaitHandle.WaitOne();\n            }\n\n            if (asyncResult.manualResetEvent != null)\n            {\n                asyncResult.manualResetEvent.Close();\n            }\n\n            if (asyncResult.exception != null)\n            {\n                throw asyncResult.exception;\n            }\n\n            return asyncResult;\n        }\n\n        protected void Complete(bool completedSynchronously)\n        {\n            if (isCompleted)\n            {\n                throw new InvalidOperationException(\"This async result is already completed.\");\n            }\n\n            this.completedSynchronously = completedSynchronously;\n\n            if (completedSynchronously)\n            {\n                this.isCompleted = true;\n            }\n            else\n            {\n                lock (ThisLock)\n                {\n                    this.isCompleted = true;\n                    if (this.manualResetEvent != null)\n                    {\n                        this.manualResetEvent.Set();\n                    }\n                }\n            }\n\n            if (callback != null)\n            {\n                callback(this);\n            }\n        }\n\n        protected void Complete(bool completedSynchronously, Exception exception)\n        {\n            this.exception = exception;\n            Complete(completedSynchronously);\n        }\n    }\n}\n```\n\n```\n// program.cs\n//----------------------------------------------------------------\n// Copyright (c) Microsoft Corporation.  All rights reserved.\n//----------------------------------------------------------------\n\nusing System;\nusing System.ServiceModel;\nusing System.ServiceModel.Discovery;\n\nnamespace Microsoft.Samples.Discovery\n{\n    class Program\n    {\n        public static void Main()\n        {\n            Uri probeEndpointAddress = new Uri(\"net.tcp://localhost:8001/Probe\");\n            Uri announcementEndpointAddress = new Uri(\"net.tcp://localhost:9021/Announcement\");\n\n            // Host the DiscoveryProxy service\n            ServiceHost proxyServiceHost = new ServiceHost(new DiscoveryProxyService());\n\n            try\n            {\n                // Add DiscoveryEndpoint to receive Probe and Resolve messages\n                DiscoveryEndpoint discoveryEndpoint = new DiscoveryEndpoint(new NetTcpBinding(), new EndpointAddress(probeEndpointAddress));\n                discoveryEndpoint.IsSystemEndpoint = false;\n\n                // Add AnnouncementEndpoint to receive Hello and Bye announcement messages\n                AnnouncementEndpoint announcementEndpoint = new AnnouncementEndpoint(new NetTcpBinding(), new EndpointAddress(announcementEndpointAddress));\n\n                proxyServiceHost.AddServiceEndpoint(discoveryEndpoint);\n                proxyServiceHost.AddServiceEndpoint(announcementEndpoint);\n\n                proxyServiceHost.Open();\n\n                Console.WriteLine(\"Proxy Service started.\");\n                Console.WriteLine();\n                Console.WriteLine(\"Press <ENTER> to terminate the service.\");\n                Console.WriteLine();\n                Console.ReadLine();\n\n                proxyServiceHost.Close();\n            }\n            catch (CommunicationException e)\n            {\n                Console.WriteLine(e.Message);\n            }\n            catch (TimeoutException e)\n            {\n                Console.WriteLine(e.Message);\n            }\n\n            if (proxyServiceHost.State != CommunicationState.Closed)\n            {\n                Console.WriteLine(\"Aborting the service...\");\n                proxyServiceHost.Abort();\n            }\n        }\n    }\n}\n```\n\n## See also\n\n- [WCF Discovery Overview](../../../../docs/framework/wcf/feature-details/wcf-discovery-overview.md)\n- [How to: Implement a Discoverable Service that Registers with the Discovery Proxy](../../../../docs/framework/wcf/feature-details/discoverable-service-that-registers-with-the-discovery-proxy.md)\n- [How to: Implement a Client Application that Uses the Discovery Proxy to Find a Service](../../../../docs/framework/wcf/feature-details/client-app-discovery-proxy-to-find-a-service.md)\n- [How to: Test the Discovery Proxy](../../../../docs/framework/wcf/feature-details/how-to-test-the-discovery-proxy.md)","nodes":[{"pos":[4,119],"embed":true,"restype":"x-metadata","content":"title: \"How to: Implement a Discovery Proxy\"\nms.date: \"03/30/2017\"\nms.assetid: 78d70e0a-f6c3-4cfb-a7ca-f66ebddadde0","nodes":[{"content":"How to: Implement a Discovery Proxy","nodes":[{"pos":[0,35],"content":"How to: Implement a Discovery Proxy","nodes":[{"content":"How to: Implement a Discovery Proxy","pos":[0,35]}]}],"path":["title"],"nosxs":false}],"yml":true},{"pos":[126,161],"content":"How to: Implement a Discovery Proxy","linkify":"How to: Implement a Discovery Proxy","nodes":[{"content":"How to: Implement a Discovery Proxy","pos":[0,35]}]},{"content":"This topic explains how to implement a discovery proxy.","pos":[162,217]},{"content":"For more information about the discovery feature in Windows Communication Foundation (WCF), see <bpt id=\"p1\">[</bpt>WCF Discovery Overview<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/wcf-discovery-overview.md)</ept>.","pos":[218,413],"source":" For more information about the discovery feature in Windows Communication Foundation (WCF), see [WCF Discovery Overview](../../../../docs/framework/wcf/feature-details/wcf-discovery-overview.md)."},{"content":"A discovery proxy can be implemented by creating a class that extends the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryProxy&gt;</ph> abstract class.","pos":[414,555],"source":" A discovery proxy can be implemented by creating a class that extends the <xref:System.ServiceModel.Discovery.DiscoveryProxy> abstract class."},{"content":"There are a number of other support classes defined and used in this sample.","pos":[556,632]},{"content":"<ph id=\"ph1\">`OnResolveAsyncResult`</ph>, <ph id=\"ph2\">`OnFindAsyncResult`</ph>, and <ph id=\"ph3\">`AsyncResult`</ph>.","pos":[633,696],"source":"`OnResolveAsyncResult`, `OnFindAsyncResult`, and `AsyncResult`."},{"content":"These classes implement the <ph id=\"ph1\">&lt;xref:System.IAsyncResult&gt;</ph> interface.","pos":[697,762],"source":" These classes implement the <xref:System.IAsyncResult> interface."},{"content":"For more information about <ph id=\"ph1\">&lt;xref:System.IAsyncResult&gt;</ph> see <bpt id=\"p1\">[</bpt>System.IAsyncResult interface<ept id=\"p1\">](xref:System.IAsyncResult)</ept>.","pos":[763,879],"source":" For more information about <xref:System.IAsyncResult> see [System.IAsyncResult interface](xref:System.IAsyncResult)."},{"content":"Implementing a discovery proxy is broken down into three main parts in this topic:","pos":[882,964]},{"pos":[970,1095],"content":"Define a class that contains a data store and extends the abstract <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryProxy&gt;</ph> class.","source":"Define a class that contains a data store and extends the abstract <xref:System.ServiceModel.Discovery.DiscoveryProxy> class."},{"pos":[1101,1142],"content":"Implement the helper <ph id=\"ph1\">`AsyncResult`</ph> class.","source":"Implement the helper `AsyncResult` class."},{"content":"Host the Discovery Proxy.","pos":[1148,1173]},{"pos":[1179,1222],"content":"To create a new console application project","linkify":"To create a new console application project","nodes":[{"content":"To create a new console application project","pos":[0,43]}]},{"content":"Start Visual Studio 2012.","pos":[1228,1253]},{"content":"Create a new console application project.","pos":[1259,1300]},{"content":"Name the project <ph id=\"ph1\">`DiscoveryProxy`</ph> and the name the solution <ph id=\"ph2\">`DiscoveryProxyExample`</ph>.","pos":[1301,1385],"source":" Name the project `DiscoveryProxy` and the name the solution `DiscoveryProxyExample`."},{"content":"Add the following references to the project","pos":[1391,1434]},{"content":"System.ServiceModel.dll","pos":[1444,1467]},{"content":"System.Servicemodel.Discovery.dll","pos":[1477,1510]},{"pos":[1518,1605],"content":"[!CAUTION]\nEnsure that you reference version 4.0 or greater of these assemblies.","leadings":["","    >  "],"nodes":[{"content":"Ensure that you reference version 4.0 or greater of these assemblies.","pos":[11,80]}]},{"pos":[1611,1655],"content":"To implement the ProxyDiscoveryService class","linkify":"To implement the ProxyDiscoveryService class","nodes":[{"content":"To implement the ProxyDiscoveryService class","pos":[0,44]}]},{"content":"Add a new code file to your project and name it DiscoveryProxy.cs.","pos":[1661,1727]},{"pos":[1733,1791],"content":"Add the following <ph id=\"ph1\">`using`</ph> statements to DiscoveryProxy.cs.","source":"Add the following `using` statements to DiscoveryProxy.cs."},{"content":"Derive the <ph id=\"ph1\">`DiscoveryProxyService`</ph> from <ph id=\"ph2\">&lt;xref:System.ServiceModel.Discovery.DiscoveryProxy&gt;</ph>.","pos":[1964,2056],"source":"Derive the `DiscoveryProxyService` from <xref:System.ServiceModel.Discovery.DiscoveryProxy>."},{"content":"Apply the <ph id=\"ph1\">`ServiceBehavior`</ph> attribute to the class as shown in the following example.","pos":[2057,2142],"source":" Apply the `ServiceBehavior` attribute to the class as shown in the following example."},{"pos":[2455,2541],"content":"Inside the <ph id=\"ph1\">`DiscoveryProxy`</ph> class define a dictionary to hold the registered services.","source":"Inside the `DiscoveryProxy` class define a dictionary to hold the registered services."},{"content":"Define a constructor that initializes the dictionary.","pos":[2693,2746]},{"pos":[2932,2994],"content":"To define the methods used to update the discovery proxy cache","linkify":"To define the methods used to update the discovery proxy cache","nodes":[{"content":"To define the methods used to update the discovery proxy cache","pos":[0,62]}]},{"content":"Implement the <ph id=\"ph1\">`AddOnlineservice`</ph> method to add services to the cache.","pos":[3000,3069],"source":"Implement the `AddOnlineservice` method to add services to the cache."},{"content":"This is called every time the proxy receives an announcement message.","pos":[3070,3139]},{"pos":[3530,3620],"content":"Implement the <ph id=\"ph1\">`RemoveOnlineService`</ph> method that is used to remove services from the cache.","source":"Implement the `RemoveOnlineService` method that is used to remove services from the cache."},{"pos":[4106,4218],"content":"Implement the <ph id=\"ph1\">`MatchFromOnlineService`</ph> methods that attempt to match a service with a service in the dictionary.","source":"Implement the `MatchFromOnlineService` methods that attempt to match a service with a service in the dictionary."},{"pos":[5490,5621],"content":"Implement the <ph id=\"ph1\">`PrintDiscoveryMetadata`</ph> method that provides the user with console text output of what the discovery proxy is doing.","source":"Implement the `PrintDiscoveryMetadata` method that provides the user with console text output of what the discovery proxy is doing."},{"content":"Add the following AsyncResult classes to the DiscoveryProxyService.","pos":[6172,6239]},{"content":"These classes are used to differentiate between the different asynchronous operation results.","pos":[6240,6333]},{"pos":[8503,8573],"content":"To define the methods that implement the discovery proxy functionality","linkify":"To define the methods that implement the discovery proxy functionality","nodes":[{"content":"To define the methods that implement the discovery proxy functionality","pos":[0,70]}]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryProxy.OnBeginOnlineAnnouncement%2A?displayProperty=nameWithType&gt;</ph> method.","pos":[8579,8709],"source":"Override the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnBeginOnlineAnnouncement%2A?displayProperty=nameWithType> method."},{"content":"This method is called when the discovery proxy receives an online announcement message.","pos":[8710,8797]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryProxy.OnEndOnlineAnnouncement%2A?displayProperty=nameWithType&gt;</ph> method.","pos":[9290,9418],"source":"Override the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnEndOnlineAnnouncement%2A?displayProperty=nameWithType> method."},{"content":"This method is called when the discovery proxy finishes processing an announcement message.","pos":[9419,9510]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryProxy.OnBeginOfflineAnnouncement%2A?displayProperty=nameWithType&gt;</ph> method.","pos":[9695,9826],"source":"Override the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnBeginOfflineAnnouncement%2A?displayProperty=nameWithType> method."},{"content":"This method is called with the discovery proxy receives an offline announcement message.","pos":[9827,9915]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryProxy.OnEndOfflineAnnouncement%2A?displayProperty=nameWithType&gt;</ph> method.","pos":[10412,10541],"source":"Override the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnEndOfflineAnnouncement%2A?displayProperty=nameWithType> method."},{"content":"This method is called when the discovery proxy finishes processing an offline announcement message.","pos":[10542,10641]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryProxy.OnBeginFind%2A?displayProperty=nameWithType&gt;</ph> method.","pos":[10828,10944],"source":"Override the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnBeginFind%2A?displayProperty=nameWithType> method."},{"content":"This method is called when the discovery proxy receives a find request.","pos":[10945,11016]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryProxy.OnEndFind%2A?displayProperty=nameWithType&gt;</ph> method.","pos":[11780,11894],"source":"Override the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnEndFind%2A?displayProperty=nameWithType> method."},{"content":"This method is called when the discovery proxy finishes processing a find request.","pos":[11895,11977]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryProxy.OnBeginResolve%2A?displayProperty=nameWithType&gt;</ph> method.","pos":[12134,12253],"source":"Override the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnBeginResolve%2A?displayProperty=nameWithType> method."},{"content":"This method is called when the discovery proxy receives a resolve message.","pos":[12254,12328]},{"content":"Override the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryProxy.OnEndResolve%2A?displayProperty=nameWithType&gt;</ph> method.","pos":[13000,13117],"source":"Override the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnEndResolve%2A?displayProperty=nameWithType> method."},{"content":"This method is called when the discovery proxy finishes processing a resolve message.","pos":[13118,13203]},{"content":"The OnBegin..","pos":[13367,13380]},{"content":"/ OnEnd..","pos":[13381,13390]},{"content":"methods provide the logic for the subsequent discovery operations.","pos":[13391,13457]},{"content":"For example the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Discovery.DiscoveryProxy.OnBeginFind%2A&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.ServiceModel.Discovery.DiscoveryProxy.OnEndFind%2A&gt;</ph> methods implement the find logic for discovery proxy.","pos":[13458,13663],"source":" For example the <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnBeginFind%2A> and <xref:System.ServiceModel.Discovery.DiscoveryProxy.OnEndFind%2A> methods implement the find logic for discovery proxy."},{"content":"When the discovery proxy receives a probe message these methods are executed to send a response back to the client.","pos":[13664,13779]},{"content":"You may modify the find logic as you wish, for example you can incorporate custom scope matching by algorithms or application specific XML metadata parsing as part of your find operation.","pos":[13780,13967]},{"pos":[13973,14007],"content":"To implement the AsyncResult class","linkify":"To implement the AsyncResult class","nodes":[{"content":"To implement the AsyncResult class","pos":[0,34]}]},{"content":"Define the abstract base class AsyncResult which is used to derive the various async result classes.","pos":[14013,14113]},{"content":"Create a new code file called AsyncResult.cs.","pos":[14119,14164]},{"pos":[14170,14225],"content":"Add the following <ph id=\"ph1\">`using`</ph> statements to AsyncResult.cs.","source":"Add the following `using` statements to AsyncResult.cs."},{"content":"Add the following AsyncResult class.","pos":[14294,14330]},{"pos":[18498,18524],"content":"To host the DiscoveryProxy","linkify":"To host the DiscoveryProxy","nodes":[{"content":"To host the DiscoveryProxy","pos":[0,26]}]},{"content":"Open the Program.cs file in the DiscoveryProxyExample project.","pos":[18530,18592]},{"pos":[18598,18635],"content":"Add the following <ph id=\"ph1\">`using`</ph> statements.","source":"Add the following `using` statements."},{"content":"Within the <ph id=\"ph1\">`Main()`</ph> method, add the following code.","pos":[18748,18799],"source":"Within the `Main()` method, add the following code."},{"content":"This creates an instance of the <ph id=\"ph1\">`DiscoveryProxy`</ph> class.","pos":[18800,18855],"source":" This creates an instance of the `DiscoveryProxy` class."},{"content":"Next add the following code to add a discovery endpoint and an announcement endpoint.","pos":[19197,19282]},{"content":"You have completed implementing the discovery proxy.","pos":[20842,20894]},{"content":"Continue on to <bpt id=\"p1\">[</bpt>How to: Implement a Discoverable Service that Registers with the Discovery Proxy<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/discoverable-service-that-registers-with-the-discovery-proxy.md)</ept>.","pos":[20895,21105],"source":" Continue on to [How to: Implement a Discoverable Service that Registers with the Discovery Proxy](../../../../docs/framework/wcf/feature-details/discoverable-service-that-registers-with-the-discovery-proxy.md)."},{"pos":[21110,21117],"content":"Example","linkify":"Example","nodes":[{"content":"Example","pos":[0,7]}]},{"content":"This is the full listing of the code used in this topic.","pos":[21119,21175]},{"pos":[35068,35076],"content":"See also","linkify":"See also","nodes":[{"content":"See also","pos":[0,8]}]},{"pos":[35080,35178],"content":"<bpt id=\"p1\">[</bpt>WCF Discovery Overview<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/wcf-discovery-overview.md)</ept>","source":"[WCF Discovery Overview](../../../../docs/framework/wcf/feature-details/wcf-discovery-overview.md)"},{"pos":[35181,35375],"content":"<bpt id=\"p1\">[</bpt>How to: Implement a Discoverable Service that Registers with the Discovery Proxy<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/discoverable-service-that-registers-with-the-discovery-proxy.md)</ept>","source":"[How to: Implement a Discoverable Service that Registers with the Discovery Proxy](../../../../docs/framework/wcf/feature-details/discoverable-service-that-registers-with-the-discovery-proxy.md)"},{"pos":[35378,35562],"content":"<bpt id=\"p1\">[</bpt>How to: Implement a Client Application that Uses the Discovery Proxy to Find a Service<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/client-app-discovery-proxy-to-find-a-service.md)</ept>","source":"[How to: Implement a Client Application that Uses the Discovery Proxy to Find a Service](../../../../docs/framework/wcf/feature-details/client-app-discovery-proxy-to-find-a-service.md)"},{"pos":[35565,35682],"content":"<bpt id=\"p1\">[</bpt>How to: Test the Discovery Proxy<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-test-the-discovery-proxy.md)</ept>","source":"[How to: Test the Discovery Proxy](../../../../docs/framework/wcf/feature-details/how-to-test-the-discovery-proxy.md)"}]}