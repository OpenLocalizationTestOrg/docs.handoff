{"content":"---\ntitle: \"Service Identity and Authentication | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"authentication [WCF], specifying the identity of a service\"\nms.assetid: a4c8f52c-5b30-45c4-a545-63244aba82be\ncaps.latest.revision: 32\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"\n---\n# Service Identity and Authentication\nA service's *endpoint identity*is a value generated from the service Web Services Description Language (WSDL). This value, propagated to any client, is used to authenticate the service. After the client initiates a communication to an endpoint and the service authenticates itself to the client, the client compares the endpoint identity value with the actual value the endpoint authentication process returned. If they match, the client is assured it has contacted the expected service endpoint. This functions as a protection against *phishing* by preventing a client from being redirected to an endpoint hosted by a malicious service.  \n  \n For a sample application that demonstrates identity setting, see [Service Identity Sample](../../../../docs/framework/wcf/samples/service-identity-sample.md). [!INCLUDE[crabout](../../../../includes/crabout-md.md)] endpoints and endpoint addresses, see [Addresses](../../../../docs/framework/wcf/feature-details/endpoint-addresses.md).  \n  \n> [!NOTE]\n>  When you use NT LanMan (NTLM) for authentication, the service identity is not checked because, under NTLM, the client is unable to authenticate the server. NTLM is used when computers are part of a Windows workgroup, or when running an older version of Windows that does not support Kerberos authentication.  \n  \n When the client initiates a secure channel to send a message to a service over it, the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] infrastructure authenticates the service, and only sends the message if the service identity matches the identity specified in the endpoint address the client uses.  \n  \n Identity processing consists of the following stages:  \n  \n-   At design time, the client developer determines the service's identity from the endpoint's metadata (exposed through WSDL).  \n  \n-   At runtime, the client application checks the claims of the service's security credentials before sending any messages to the service.  \n  \n Identity processing on the client is analogous to client authentication on the service. A secure service does not execute code until the client's credentials have been authenticated. Likewise, the client does not send messages to the service until the service's credentials have been authenticated based on what is known in advance from the service's metadata.  \n  \n The <xref:System.ServiceModel.EndpointAddress.Identity%2A> property of the <xref:System.ServiceModel.EndpointAddress> class represents the identity of the service called by the client. The service publishes the <xref:System.ServiceModel.EndpointAddress.Identity%2A> in its metadata. When the client developer runs the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) against the service endpoint, the generated configuration contains the value of the service's <xref:System.ServiceModel.EndpointAddress.Identity%2A> property. The [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] infrastructure (if configured with security) verifies that the service possesses the identity specified.  \n  \n> [!IMPORTANT]\n>  The metadata contains the expected identity of the service, so it is recommended that you expose the service metadata through secure means, for example, by creating an HTTPS endpoint for the service. [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][How to: Secure Metadata Endpoints](../../../../docs/framework/wcf/feature-details/how-to-secure-metadata-endpoints.md).  \n  \n## Identity Types  \n A service can provide five types of identities. Each identity type corresponds to an element that can be contained inside the `<identity>` element in configuration. The type used depends on the scenario and the service's security requirements. The following table describes each identity type.  \n  \n|Identity type|Description|Typical scenario|  \n|-------------------|-----------------|----------------------|  \n|Domain Name System (DNS)|Use this element with X.509 certificates or Windows accounts. It compares the DNS name specified in the credential with the value specified in this element.|A DNS check enables you to use certificates with DNS or subject names. If a certificate is reissued with the same DNS or subject name, then the identity check is still valid. When a certificate is reissued, it gets a new RSA key but retains the same DNS or subject name. This means that clients do not have to update their identity information about the service.|  \n|Certificate. The default when `ClientCredentialType` is set to Certificate.|This element specifies a Base64-encoded X.509 certificate value to compare with the client.<br /><br /> Also use this element when using a [!INCLUDE[infocard](../../../../includes/infocard-md.md)] as a credential to authenticate the service.|This element restricts authentication to a single certificate based upon its thumbprint value. This enables stricter authentication because thumbprint values are unique. This comes with one caveat: If the certificate is reissued with the same Subject name, it also has a new Thumbprint. Therefore, clients are not able to validate the service unless the new thumbprint is known. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] finding a certificate's thumbprint, see [How to: Retrieve the Thumbprint of a Certificate](../../../../docs/framework/wcf/feature-details/how-to-retrieve-the-thumbprint-of-a-certificate.md).|  \n|Certificate Reference|Identical to the Certificate option described previously. However, this element enables you to specify a certificate name and store location from which to retrieve the certificate.|Same as the Certificate scenario described previously.<br /><br /> The benefit is that the certificate store location can change.|  \n|RSA|This element specifies an RSA key value to compare with the client. This is similar to the certificate option but rather than using the certificate's thumbprint, the certificate's RSA key is used instead.|An RSA check enables you to specifically restrict authentication to a single certificate based upon its RSA key. This enables stricter authentication of a specific RSA key at the expense of the service, which no longer works with existing clients if the RSA key value changes.|  \n|User principal name (UPN). The default when the `ClientCredentialType` is set to Windows and the service process is not running under one of the system accounts.|This element specifies the UPN that the service is running under. See the Kerberos Protocol and Identity section of [Overriding the Identity of a Service for Authentication](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md).|This ensures that the service is running under a specific Windows user account. The user account can be either the current logged-on user or the service running under a particular user account.<br /><br /> This setting takes advantage of Windows Kerberos security if the service is running under a domain account within an Active Directory environment.|  \n|Service principal name (SPN). The default when the `ClientCredentialType` is set to Windows and the service process is running under one of the system accountsâ€”LocalService, LocalSystem, or NetworkService.|This element specifies the SPN associated with the service's account. See the Kerberos Protocol and Identity section of [Overriding the Identity of a Service for Authentication](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md).|This ensures that the SPN and the specific Windows account associated with the SPN identify the service.<br /><br /> You can use the Setspn.exe tool to associate a machine account for the service's user account.<br /><br /> This setting takes advantage of Windows Kerberos security if the service is running under one of the system accounts or under a domain account that has an associated SPN name with it and the computer is a member of a domain within an Active Directory environment.|  \n  \n## Specifying Identity at the Service  \n Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata. [!INCLUDE[crabout](../../../../includes/crabout-md.md)] how to override or specify service identity, see [Overriding the Identity of a Service for Authentication](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md).  \n  \n## Using the \\<identity> Element in Configuration  \n If you change the client credential type in the binding previously shown to `Certificate,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code. This is the default for all client credential types other than Windows.  \n  \n  \n  \n You can change the value of the default service identity or change the type of the identity by using the `<identity>` element in configuration or by setting the identity in code. The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.  \n  \n  \n  \n## Setting Identity Programmatically  \n Your service does not have to explicitly specify an identity, because [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] automatically determines it. However, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] allows you to specify an identity on an endpoint, if required. The following code adds a new service endpoint with a specific DNS identity.  \n  \n [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]\n [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  \n  \n## Specifying Identity at the Client  \n At design time, a client developer typically uses the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to generate client configuration. The generated configuration file (intended for use by the client) contains the server's identity. For example, the following code is generated from a service that specifies a DNS identity, as shown in the preceding example. Note that the client's endpoint identity value matches that of the service. In this case, when the client receives the Windows (Kerberos) credentials for the service, it expects the value to be `contoso.com`.  \n  \n  \n  \n If, instead of Windows, the service specifies a certificate as the client credential type, then the certificate's DNS property is expected to be the value `contoso.com`. (Or if the DNS property is `null`, the certificate's subject name must be `contoso.com`.)  \n  \n#### Using a Specific Value for Identity  \n The following client configuration file shows how the service's identity is expected to be a specific value. In the following example, the client can communicate with two endpoints. The first is identified with a certificate thumbprint and the second with a certificate RSA key. That is, a certificate that contains only a public key/private key pair, but is not issued by a trusted authority.  \n  \n  \n  \n## Identity Checking at Run Time  \n At design time, a client developer determines the server's identity through its metadata. At runtime, the identity check is performed before calling any endpoints on the service.  \n  \n The identity value is tied to the type of authentication specified by metadata; in other words, the type of credentials used for the service.  \n  \n If the channel is configured to authenticate using message- or transport-level Secure Sockets Layer (SSL) with X.509 certificates for authentication, the following identity values are valid:  \n  \n-   DNS. [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] ensures that the certificate provided during the SSL handshake contains a DNS or `CommonName` (CN) attribute equal to the value specified in the DNS identity on the client. Note that these checks are done in addition to determining the validity of the server certificate. By default, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] validates that the server certificate is issued by a trusted root authority.  \n  \n-   Certificate. During the SSL handshake, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] ensures that the remote endpoint provides the exact certificate value specified in the identity.  \n  \n-   Certificate Reference. Same as Certificate.  \n  \n-   RSA. During the SSL handshake, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] ensures that the remote endpoint provides the exact RSA key specified in the identity.  \n  \n If the service authenticates using message- or transport-level SSL with a Windows credential for authentication, and negotiates the credential, the following identity values are valid:  \n  \n-   DNS. The negotiation passes the service's SPN so that the DNS name can be checked. The SPN is in the form `host/<dns name>`.  \n  \n-   SPN. An explicit service SPN is returned, for example, `host/myservice`.  \n  \n-   UPN. The UPN of the service account. The UPN is in the form `username`@`domain`. For example, when the service is running in a user account, it may be `username@contoso.com`.  \n  \n Specifying the identity programmatically (using the <xref:System.ServiceModel.EndpointAddress.Identity%2A> property) is optional. If no identity is specified, and the client credential type is Windows, the default is SPN with the value set to the hostname part of the service endpoint address prefixed with the \"host/\" literal. If no identity is specified, and the client credential type is a certificate, the default is `Certificate`. This applies to both message- and transport-level security.  \n  \n## Identity and Custom Bindings  \n Because the identity of a service depends on the binding type used, ensure that an appropriate identity is exposed when creating a custom binding. For example, in the following code example, the identity exposed is not compatible with the security type, because the identity for the secure conversation bootstrap binding does not match the identity for the binding on the endpoint. The secure conversation binding sets the DNS identity, while the <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement> sets the UPN or SPN identity.  \n  \n [!code-csharp[C_Identity#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#8)]\n [!code-vb[C_Identity#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#8)]  \n  \n [!INCLUDE[crabout](../../../../includes/crabout-md.md)] how to stack binding elements correctly for a custom binding, see [Creating User-Defined Bindings](../../../../docs/framework/wcf/extending/creating-user-defined-bindings.md). [!INCLUDE[crabout](../../../../includes/crabout-md.md)] creating a custom binding with the <xref:System.ServiceModel.Channels.SecurityBindingElement>, see [How to: Create a SecurityBindingElement for a Specified Authentication Mode](../../../../docs/framework/wcf/feature-details/how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md).  \n  \n## See Also  \n [How to: Create a Custom Binding Using the SecurityBindingElement](../../../../docs/framework/wcf/feature-details/how-to-create-a-custom-binding-using-the-securitybindingelement.md)   \n [How to: Create a SecurityBindingElement for a Specified Authentication Mode](../../../../docs/framework/wcf/feature-details/how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md)   \n [How to: Create a Custom Client Identity Verifier](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md)   \n [Selecting a Credential Type](../../../../docs/framework/wcf/feature-details/selecting-a-credential-type.md)   \n [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)   \n [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)   \n [Creating User-Defined Bindings](../../../../docs/framework/wcf/extending/creating-user-defined-bindings.md)   \n [How to: Retrieve the Thumbprint of a Certificate](../../../../docs/framework/wcf/feature-details/how-to-retrieve-the-thumbprint-of-a-certificate.md)","nodes":[{"pos":[4,443],"nodes":[{"content":"Service Identity and Authentication | Microsoft Docs","nodes":[{"pos":[0,52],"content":"Service Identity and Authentication | Microsoft Docs","nodes":[{"content":"Service Identity and Authentication | Microsoft Docs","pos":[0,52]}]}],"pos":[6,61],"yaml":true}],"content":"title: \"Service Identity and Authentication | Microsoft Docs\"\nms.custom: \"\"\nms.date: \"03/30/2017\"\nms.prod: \".net-framework\"\nms.reviewer: \"\"\nms.suite: \"\"\nms.technology: \n  - \"dotnet-clr\"\nms.tgt_pltfrm: \"\"\nms.topic: \"article\"\nhelpviewer_keywords: \n  - \"authentication [WCF], specifying the identity of a service\"\nms.assetid: a4c8f52c-5b30-45c4-a545-63244aba82be\ncaps.latest.revision: 32\nauthor: \"Erikre\"\nms.author: \"erikre\"\nmanager: \"erikre\"","yamlblock":true},{"pos":[450,485],"content":"Service Identity and Authentication","linkify":"Service Identity and Authentication","nodes":[{"content":"Service Identity and Authentication","pos":[0,35]}]},{"content":"A service's <bpt id=\"p1\">*</bpt>endpoint identity<ept id=\"p1\">*</ept>is a value generated from the service Web Services Description Language (WSDL).","pos":[486,596],"source":"A service's *endpoint identity*is a value generated from the service Web Services Description Language (WSDL)."},{"content":"This value, propagated to any client, is used to authenticate the service.","pos":[597,671]},{"content":"After the client initiates a communication to an endpoint and the service authenticates itself to the client, the client compares the endpoint identity value with the actual value the endpoint authentication process returned.","pos":[672,897]},{"content":"If they match, the client is assured it has contacted the expected service endpoint.","pos":[898,982]},{"content":"This functions as a protection against <bpt id=\"p1\">*</bpt>phishing<ept id=\"p1\">*</ept> by preventing a client from being redirected to an endpoint hosted by a malicious service.","pos":[983,1123],"source":" This functions as a protection against *phishing* by preventing a client from being redirected to an endpoint hosted by a malicious service."},{"content":"For a sample application that demonstrates identity setting, see <bpt id=\"p1\">[</bpt>Service Identity Sample<ept id=\"p1\">](../../../../docs/framework/wcf/samples/service-identity-sample.md)</ept>.","pos":[1130,1288],"source":"For a sample application that demonstrates identity setting, see [Service Identity Sample](../../../../docs/framework/wcf/samples/service-identity-sample.md)."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> endpoints and endpoint addresses, see <bpt id=\"p1\">[</bpt>Addresses<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/endpoint-addresses.md)</ept>.","pos":[1289,1465],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] endpoints and endpoint addresses, see [Addresses](../../../../docs/framework/wcf/feature-details/endpoint-addresses.md)."},{"pos":[1473,1791],"content":"[!NOTE]\n When you use NT LanMan (NTLM) for authentication, the service identity is not checked because, under NTLM, the client is unable to authenticate the server. NTLM is used when computers are part of a Windows workgroup, or when running an older version of Windows that does not support Kerberos authentication.","leadings":["","> "],"nodes":[{"content":"When you use NT LanMan (NTLM) for authentication, the service identity is not checked because, under NTLM, the client is unable to authenticate the server. NTLM is used when computers are part of a Windows workgroup, or when running an older version of Windows that does not support Kerberos authentication.","pos":[9,316],"nodes":[{"content":"When you use NT LanMan (NTLM) for authentication, the service identity is not checked because, under NTLM, the client is unable to authenticate the server.","pos":[0,155]},{"content":"NTLM is used when computers are part of a Windows workgroup, or when running an older version of Windows that does not support Kerberos authentication.","pos":[156,307]}]}]},{"pos":[1798,2105],"content":"When the client initiates a secure channel to send a message to a service over it, the <ph id=\"ph1\">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)]</ph> infrastructure authenticates the service, and only sends the message if the service identity matches the identity specified in the endpoint address the client uses.","source":"When the client initiates a secure channel to send a message to a service over it, the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] infrastructure authenticates the service, and only sends the message if the service identity matches the identity specified in the endpoint address the client uses."},{"content":"Identity processing consists of the following stages:","pos":[2112,2165]},{"content":"At design time, the client developer determines the service's identity from the endpoint's metadata (exposed through WSDL).","pos":[2175,2298]},{"content":"At runtime, the client application checks the claims of the service's security credentials before sending any messages to the service.","pos":[2308,2442]},{"content":"Identity processing on the client is analogous to client authentication on the service.","pos":[2449,2536]},{"content":"A secure service does not execute code until the client's credentials have been authenticated.","pos":[2537,2631]},{"content":"Likewise, the client does not send messages to the service until the service's credentials have been authenticated based on what is known in advance from the service's metadata.","pos":[2632,2809]},{"content":"The <ph id=\"ph1\">&lt;xref:System.ServiceModel.EndpointAddress.Identity%2A&gt;</ph> property of the <ph id=\"ph2\">&lt;xref:System.ServiceModel.EndpointAddress&gt;</ph> class represents the identity of the service called by the client.","pos":[2816,3000],"source":"The <xref:System.ServiceModel.EndpointAddress.Identity%2A> property of the <xref:System.ServiceModel.EndpointAddress> class represents the identity of the service called by the client."},{"content":"The service publishes the <ph id=\"ph1\">&lt;xref:System.ServiceModel.EndpointAddress.Identity%2A&gt;</ph> in its metadata.","pos":[3001,3098],"source":" The service publishes the <xref:System.ServiceModel.EndpointAddress.Identity%2A> in its metadata."},{"content":"When the client developer runs the <bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept> against the service endpoint, the generated configuration contains the value of the service's <ph id=\"ph1\">&lt;xref:System.ServiceModel.EndpointAddress.Identity%2A&gt;</ph> property.","pos":[3099,3425],"source":" When the client developer runs the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) against the service endpoint, the generated configuration contains the value of the service's <xref:System.ServiceModel.EndpointAddress.Identity%2A> property."},{"content":"The <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> infrastructure (if configured with security) verifies that the service possesses the identity specified.","pos":[3426,3590],"source":" The [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] infrastructure (if configured with security) verifies that the service possesses the identity specified."},{"pos":[3598,3993],"content":"[!IMPORTANT]\n The metadata contains the expected identity of the service, so it is recommended that you expose the service metadata through secure means, for example, by creating an HTTPS endpoint for the service. [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][How to: Secure Metadata Endpoints](../../../../docs/framework/wcf/feature-details/how-to-secure-metadata-endpoints.md).","leadings":["","> "],"nodes":[{"content":"The metadata contains the expected identity of the service, so it is recommended that you expose the service metadata through secure means, for example, by creating an HTTPS endpoint for the service. [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][How to: Secure Metadata Endpoints](../../../../docs/framework/wcf/feature-details/how-to-secure-metadata-endpoints.md).","pos":[14,393],"nodes":[{"content":"The metadata contains the expected identity of the service, so it is recommended that you expose the service metadata through secure means, for example, by creating an HTTPS endpoint for the service.","pos":[0,199]},{"content":"<ph id=\"ph1\">[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]</ph><bpt id=\"p1\">[</bpt>How to: Secure Metadata Endpoints<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-secure-metadata-endpoints.md)</ept>.","pos":[200,379],"source":"[!INCLUDE[crdefault](../../../../includes/crdefault-md.md)][How to: Secure Metadata Endpoints](../../../../docs/framework/wcf/feature-details/how-to-secure-metadata-endpoints.md)."}]}]},{"pos":[4002,4016],"content":"Identity Types","linkify":"Identity Types","nodes":[{"content":"Identity Types","pos":[0,14]}]},{"content":"A service can provide five types of identities.","pos":[4020,4067]},{"content":"Each identity type corresponds to an element that can be contained inside the <ph id=\"ph1\">`&lt;identity&gt;`</ph> element in configuration.","pos":[4068,4184],"source":" Each identity type corresponds to an element that can be contained inside the `<identity>` element in configuration."},{"content":"The type used depends on the scenario and the service's security requirements.","pos":[4185,4263]},{"content":"The following table describes each identity type.","pos":[4264,4313]},{"content":"Identity type","pos":[4320,4333]},{"content":"Description","pos":[4334,4345]},{"content":"Typical scenario","pos":[4346,4362]},{"content":"Domain Name System (DNS)","pos":[4432,4456]},{"content":"Use this element with X.509 certificates or Windows accounts.","pos":[4457,4518]},{"content":"It compares the DNS name specified in the credential with the value specified in this element.","pos":[4519,4613]},{"content":"A DNS check enables you to use certificates with DNS or subject names.","pos":[4614,4684]},{"content":"If a certificate is reissued with the same DNS or subject name, then the identity check is still valid.","pos":[4685,4788]},{"content":"When a certificate is reissued, it gets a new RSA key but retains the same DNS or subject name.","pos":[4789,4884]},{"content":"This means that clients do not have to update their identity information about the service.","pos":[4885,4976]},{"content":"Certificate.","pos":[4981,4993]},{"content":"The default when <ph id=\"ph1\">`ClientCredentialType`</ph> is set to Certificate.","pos":[4994,5056],"source":" The default when `ClientCredentialType` is set to Certificate."},{"content":"This element specifies a Base64-encoded X.509 certificate value to compare with the client.","pos":[5057,5148]},{"content":"Also use this element when using a <ph id=\"ph1\">[!INCLUDE[infocard](../../../../includes/infocard-md.md)]</ph> as a credential to authenticate the service.","pos":[5161,5298],"source":"Also use this element when using a [!INCLUDE[infocard](../../../../includes/infocard-md.md)] as a credential to authenticate the service."},{"content":"This element restricts authentication to a single certificate based upon its thumbprint value.","pos":[5299,5393]},{"content":"This enables stricter authentication because thumbprint values are unique.","pos":[5394,5468]},{"content":"This comes with one caveat: If the certificate is reissued with the same Subject name, it also has a new Thumbprint.","pos":[5469,5585]},{"content":"Therefore, clients are not able to validate the service unless the new thumbprint is known.","pos":[5586,5677]},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> finding a certificate's thumbprint, see <bpt id=\"p1\">[</bpt>How to: Retrieve the Thumbprint of a Certificate<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-retrieve-the-thumbprint-of-a-certificate.md)</ept>.","pos":[5678,5924],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] finding a certificate's thumbprint, see [How to: Retrieve the Thumbprint of a Certificate](../../../../docs/framework/wcf/feature-details/how-to-retrieve-the-thumbprint-of-a-certificate.md)."},{"content":"Certificate Reference","pos":[5929,5950]},{"content":"Identical to the Certificate option described previously.","pos":[5951,6008]},{"content":"However, this element enables you to specify a certificate name and store location from which to retrieve the certificate.","pos":[6009,6131]},{"content":"Same as the Certificate scenario described previously.","pos":[6132,6186]},{"content":"The benefit is that the certificate store location can change.","pos":[6199,6261]},{"content":"RSA","pos":[6266,6269]},{"content":"This element specifies an RSA key value to compare with the client.","pos":[6270,6337]},{"content":"This is similar to the certificate option but rather than using the certificate's thumbprint, the certificate's RSA key is used instead.","pos":[6338,6474]},{"content":"An RSA check enables you to specifically restrict authentication to a single certificate based upon its RSA key.","pos":[6475,6587]},{"content":"This enables stricter authentication of a specific RSA key at the expense of the service, which no longer works with existing clients if the RSA key value changes.","pos":[6588,6751]},{"content":"User principal name (UPN).","pos":[6756,6782]},{"content":"The default when the <ph id=\"ph1\">`ClientCredentialType`</ph> is set to Windows and the service process is not running under one of the system accounts.","pos":[6783,6917],"source":" The default when the `ClientCredentialType` is set to Windows and the service process is not running under one of the system accounts."},{"content":"This element specifies the UPN that the service is running under.","pos":[6918,6983]},{"content":"See the Kerberos Protocol and Identity section of <bpt id=\"p1\">[</bpt>Overriding the Identity of a Service for Authentication<ept id=\"p1\">](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md)</ept>.","pos":[6984,7193],"source":" See the Kerberos Protocol and Identity section of [Overriding the Identity of a Service for Authentication](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md)."},{"content":"This ensures that the service is running under a specific Windows user account.","pos":[7194,7273]},{"content":"The user account can be either the current logged-on user or the service running under a particular user account.","pos":[7274,7387]},{"content":"This setting takes advantage of Windows Kerberos security if the service is running under a domain account within an Active Directory environment.","pos":[7400,7546]},{"content":"Service principal name (SPN).","pos":[7551,7580]},{"content":"The default when the <ph id=\"ph1\">`ClientCredentialType`</ph> is set to Windows and the service process is running under one of the system accountsâ€”LocalService, LocalSystem, or NetworkService.","pos":[7581,7756],"source":" The default when the `ClientCredentialType` is set to Windows and the service process is running under one of the system accountsâ€”LocalService, LocalSystem, or NetworkService."},{"content":"This element specifies the SPN associated with the service's account.","pos":[7757,7826]},{"content":"See the Kerberos Protocol and Identity section of <bpt id=\"p1\">[</bpt>Overriding the Identity of a Service for Authentication<ept id=\"p1\">](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md)</ept>.","pos":[7827,8036],"source":" See the Kerberos Protocol and Identity section of [Overriding the Identity of a Service for Authentication](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md)."},{"content":"This ensures that the SPN and the specific Windows account associated with the SPN identify the service.","pos":[8037,8141]},{"content":"You can use the Setspn.exe tool to associate a machine account for the service's user account.","pos":[8154,8248]},{"content":"This setting takes advantage of Windows Kerberos security if the service is running under one of the system accounts or under a domain account that has an associated SPN name with it and the computer is a member of a domain within an Active Directory environment.","pos":[8261,8524]},{"pos":[8534,8568],"content":"Specifying Identity at the Service","linkify":"Specifying Identity at the Service","nodes":[{"content":"Specifying Identity at the Service","pos":[0,34]}]},{"content":"Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.","pos":[8572,8744]},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> how to override or specify service identity, see <bpt id=\"p1\">[</bpt>Overriding the Identity of a Service for Authentication<ept id=\"p1\">](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md)</ept>.","pos":[8745,9009],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] how to override or specify service identity, see [Overriding the Identity of a Service for Authentication](../../../../docs/framework/wcf/extending/overriding-the-identity-of-a-service-for-authentication.md)."},{"pos":[9018,9064],"content":"Using the \\<identity> Element in Configuration","linkify":"Using the \\<identity> Element in Configuration","nodes":[{"content":"Using the <ph id=\"ph1\">\\&lt;</ph>identity&gt; Element in Configuration","pos":[0,46],"source":"Using the \\<identity> Element in Configuration"}]},{"content":"If you change the client credential type in the binding previously shown to <ph id=\"ph1\">`Certificate,`</ph> then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.","pos":[9068,9284],"source":"If you change the client credential type in the binding previously shown to `Certificate,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code."},{"content":"This is the default for all client credential types other than Windows.","pos":[9285,9356]},{"content":"You can change the value of the default service identity or change the type of the identity by using the <ph id=\"ph1\">`&lt;identity&gt;`</ph> element in configuration or by setting the identity in code.","pos":[9369,9547],"source":"You can change the value of the default service identity or change the type of the identity by using the `<identity>` element in configuration or by setting the identity in code."},{"content":"The following configuration code sets a domain name system (DNS) identity with the value <ph id=\"ph1\">`contoso.com`</ph>.","pos":[9548,9651],"source":" The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`."},{"pos":[9666,9699],"content":"Setting Identity Programmatically","linkify":"Setting Identity Programmatically","nodes":[{"content":"Setting Identity Programmatically","pos":[0,33]}]},{"content":"Your service does not have to explicitly specify an identity, because <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> automatically determines it.","pos":[9703,9857],"source":"Your service does not have to explicitly specify an identity, because [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] automatically determines it."},{"content":"However, <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> allows you to specify an identity on an endpoint, if required.","pos":[9858,9985],"source":" However, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] allows you to specify an identity on an endpoint, if required."},{"content":"The following code adds a new service endpoint with a specific DNS identity.","pos":[9986,10062]},{"pos":[10069,10286],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>C_Identity#5<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>C_Identity#5<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]\n [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]"},{"pos":[10295,10328],"content":"Specifying Identity at the Client","linkify":"Specifying Identity at the Client","nodes":[{"content":"Specifying Identity at the Client","pos":[0,33]}]},{"content":"At design time, a client developer typically uses the <bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept> to generate client configuration.","pos":[10332,10552],"source":"At design time, a client developer typically uses the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to generate client configuration."},{"content":"The generated configuration file (intended for use by the client) contains the server's identity.","pos":[10553,10650]},{"content":"For example, the following code is generated from a service that specifies a DNS identity, as shown in the preceding example.","pos":[10651,10776]},{"content":"Note that the client's endpoint identity value matches that of the service.","pos":[10777,10852]},{"content":"In this case, when the client receives the Windows (Kerberos) credentials for the service, it expects the value to be <ph id=\"ph1\">`contoso.com`</ph>.","pos":[10853,10985],"source":" In this case, when the client receives the Windows (Kerberos) credentials for the service, it expects the value to be `contoso.com`."},{"content":"If, instead of Windows, the service specifies a certificate as the client credential type, then the certificate's DNS property is expected to be the value <ph id=\"ph1\">`contoso.com`</ph>.","pos":[10998,11167],"source":"If, instead of Windows, the service specifies a certificate as the client credential type, then the certificate's DNS property is expected to be the value `contoso.com`."},{"content":"(Or if the DNS property is <ph id=\"ph1\">`null`</ph>, the certificate's subject name must be <ph id=\"ph2\">`contoso.com`</ph>.)","pos":[11168,11257],"source":" (Or if the DNS property is `null`, the certificate's subject name must be `contoso.com`.)"},{"pos":[11268,11303],"content":"Using a Specific Value for Identity","linkify":"Using a Specific Value for Identity","nodes":[{"content":"Using a Specific Value for Identity","pos":[0,35]}]},{"content":"The following client configuration file shows how the service's identity is expected to be a specific value.","pos":[11307,11415]},{"content":"In the following example, the client can communicate with two endpoints.","pos":[11416,11488]},{"content":"The first is identified with a certificate thumbprint and the second with a certificate RSA key.","pos":[11489,11585]},{"content":"That is, a certificate that contains only a public key/private key pair, but is not issued by a trusted authority.","pos":[11586,11700]},{"pos":[11715,11744],"content":"Identity Checking at Run Time","linkify":"Identity Checking at Run Time","nodes":[{"content":"Identity Checking at Run Time","pos":[0,29]}]},{"content":"At design time, a client developer determines the server's identity through its metadata.","pos":[11748,11837]},{"content":"At runtime, the identity check is performed before calling any endpoints on the service.","pos":[11838,11926]},{"content":"The identity value is tied to the type of authentication specified by metadata; in other words, the type of credentials used for the service.","pos":[11933,12074]},{"content":"If the channel is configured to authenticate using message- or transport-level Secure Sockets Layer (SSL) with X.509 certificates for authentication, the following identity values are valid:","pos":[12081,12271]},{"content":"DNS.","pos":[12281,12285]},{"content":"<ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> ensures that the certificate provided during the SSL handshake contains a DNS or <ph id=\"ph2\">`CommonName`</ph> (CN) attribute equal to the value specified in the DNS identity on the client.","pos":[12286,12514],"source":"[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] ensures that the certificate provided during the SSL handshake contains a DNS or `CommonName` (CN) attribute equal to the value specified in the DNS identity on the client."},{"content":"Note that these checks are done in addition to determining the validity of the server certificate.","pos":[12515,12613]},{"content":"By default, <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> validates that the server certificate is issued by a trusted root authority.","pos":[12614,12758],"source":" By default, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] validates that the server certificate is issued by a trusted root authority."},{"content":"Certificate.","pos":[12768,12780]},{"content":"During the SSL handshake, <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> ensures that the remote endpoint provides the exact certificate value specified in the identity.","pos":[12781,12959],"source":" During the SSL handshake, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] ensures that the remote endpoint provides the exact certificate value specified in the identity."},{"content":"Certificate Reference.","pos":[12969,12991]},{"content":"Same as Certificate.","pos":[12992,13012]},{"content":"RSA.","pos":[13022,13026]},{"content":"During the SSL handshake, <ph id=\"ph1\">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]</ph> ensures that the remote endpoint provides the exact RSA key specified in the identity.","pos":[13027,13195],"source":" During the SSL handshake, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] ensures that the remote endpoint provides the exact RSA key specified in the identity."},{"content":"If the service authenticates using message- or transport-level SSL with a Windows credential for authentication, and negotiates the credential, the following identity values are valid:","pos":[13202,13386]},{"content":"DNS.","pos":[13396,13400]},{"content":"The negotiation passes the service's SPN so that the DNS name can be checked.","pos":[13401,13478]},{"content":"The SPN is in the form <ph id=\"ph1\">`host/&lt;dns name&gt;`</ph>.","pos":[13479,13520],"source":" The SPN is in the form `host/<dns name>`."},{"content":"SPN.","pos":[13530,13534]},{"content":"An explicit service SPN is returned, for example, <ph id=\"ph1\">`host/myservice`</ph>.","pos":[13535,13602],"source":" An explicit service SPN is returned, for example, `host/myservice`."},{"content":"UPN.","pos":[13612,13616]},{"content":"The UPN of the service account.","pos":[13617,13648]},{"content":"The UPN is in the form <ph id=\"ph1\">`username`</ph><ph id=\"ph2\">@</ph><ph id=\"ph3\">`domain`</ph>.","pos":[13649,13692],"source":" The UPN is in the form `username`@`domain`."},{"content":"For example, when the service is running in a user account, it may be <ph id=\"ph1\">`username@contoso.com`</ph>.","pos":[13693,13786],"source":" For example, when the service is running in a user account, it may be `username@contoso.com`."},{"content":"Specifying the identity programmatically (using the <ph id=\"ph1\">&lt;xref:System.ServiceModel.EndpointAddress.Identity%2A&gt;</ph> property) is optional.","pos":[13793,13922],"source":"Specifying the identity programmatically (using the <xref:System.ServiceModel.EndpointAddress.Identity%2A> property) is optional."},{"content":"If no identity is specified, and the client credential type is Windows, the default is SPN with the value set to the hostname part of the service endpoint address prefixed with the \"host/\" literal.","pos":[13923,14120]},{"content":"If no identity is specified, and the client credential type is a certificate, the default is <ph id=\"ph1\">`Certificate`</ph>.","pos":[14121,14228],"source":" If no identity is specified, and the client credential type is a certificate, the default is `Certificate`."},{"content":"This applies to both message- and transport-level security.","pos":[14229,14288]},{"pos":[14297,14325],"content":"Identity and Custom Bindings","linkify":"Identity and Custom Bindings","nodes":[{"content":"Identity and Custom Bindings","pos":[0,28]}]},{"content":"Because the identity of a service depends on the binding type used, ensure that an appropriate identity is exposed when creating a custom binding.","pos":[14329,14475]},{"content":"For example, in the following code example, the identity exposed is not compatible with the security type, because the identity for the secure conversation bootstrap binding does not match the identity for the binding on the endpoint.","pos":[14476,14710]},{"content":"The secure conversation binding sets the DNS identity, while the <ph id=\"ph1\">&lt;xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement&gt;</ph> sets the UPN or SPN identity.","pos":[14711,14877],"source":" The secure conversation binding sets the DNS identity, while the <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement> sets the UPN or SPN identity."},{"pos":[14884,15101],"content":"<bpt id=\"p1\">[!code-csharp</bpt><bpt id=\"p2\">[</bpt>C_Identity#8<ept id=\"p2\">](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#8)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-vb</bpt><bpt id=\"p4\">[</bpt>C_Identity#8<ept id=\"p4\">](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#8)</ept><ept id=\"p3\">]</ept>","source":"[!code-csharp[C_Identity#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#8)]\n [!code-vb[C_Identity#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#8)]"},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> how to stack binding elements correctly for a custom binding, see <bpt id=\"p1\">[</bpt>Creating User-Defined Bindings<ept id=\"p1\">](../../../../docs/framework/wcf/extending/creating-user-defined-bindings.md)</ept>.","pos":[15108,15339],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] how to stack binding elements correctly for a custom binding, see [Creating User-Defined Bindings](../../../../docs/framework/wcf/extending/creating-user-defined-bindings.md)."},{"content":"<ph id=\"ph1\">[!INCLUDE[crabout](../../../../includes/crabout-md.md)]</ph> creating a custom binding with the <ph id=\"ph2\">&lt;xref:System.ServiceModel.Channels.SecurityBindingElement&gt;</ph>, see <bpt id=\"p1\">[</bpt>How to: Create a SecurityBindingElement for a Specified Authentication Mode<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md)</ept>.","pos":[15340,15699],"source":"[!INCLUDE[crabout](../../../../includes/crabout-md.md)] creating a custom binding with the <xref:System.ServiceModel.Channels.SecurityBindingElement>, see [How to: Create a SecurityBindingElement for a Specified Authentication Mode](../../../../docs/framework/wcf/feature-details/how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md)."},{"pos":[15708,15716],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"<bpt id=\"p1\">[</bpt>How to: Create a Custom Binding Using the SecurityBindingElement<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-custom-binding-using-the-securitybindingelement.md)</ept><ph id=\"ph1\"> </ph>","pos":[15720,15902],"source":"[How to: Create a Custom Binding Using the SecurityBindingElement](../../../../docs/framework/wcf/feature-details/how-to-create-a-custom-binding-using-the-securitybindingelement.md) "},{"content":"<bpt id=\"p1\">[</bpt>How to: Create a SecurityBindingElement for a Specified Authentication Mode<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md)</ept><ph id=\"ph1\"> </ph>","pos":[15906,16110],"source":"[How to: Create a SecurityBindingElement for a Specified Authentication Mode](../../../../docs/framework/wcf/feature-details/how-to-create-a-securitybindingelement-for-a-specified-authentication-mode.md) "},{"content":"<bpt id=\"p1\">[</bpt>How to: Create a Custom Client Identity Verifier<ept id=\"p1\">](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md)</ept><ph id=\"ph1\"> </ph>","pos":[16114,16258],"source":"[How to: Create a Custom Client Identity Verifier](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md) "},{"content":"<bpt id=\"p1\">[</bpt>Selecting a Credential Type<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/selecting-a-credential-type.md)</ept><ph id=\"ph1\"> </ph>","pos":[16262,16371],"source":"[Selecting a Credential Type](../../../../docs/framework/wcf/feature-details/selecting-a-credential-type.md) "},{"content":"<bpt id=\"p1\">[</bpt>Working with Certificates<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/working-with-certificates.md)</ept><ph id=\"ph1\"> </ph>","pos":[16375,16480],"source":"[Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md) "},{"content":"<bpt id=\"p1\">[</bpt>ServiceModel Metadata Utility Tool (Svcutil.exe)<ept id=\"p1\">](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)</ept><ph id=\"ph1\"> </ph>","pos":[16484,16617],"source":"[ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) "},{"content":"<bpt id=\"p1\">[</bpt>Creating User-Defined Bindings<ept id=\"p1\">](../../../../docs/framework/wcf/extending/creating-user-defined-bindings.md)</ept><ph id=\"ph1\"> </ph>","pos":[16621,16730],"source":"[Creating User-Defined Bindings](../../../../docs/framework/wcf/extending/creating-user-defined-bindings.md) "},{"content":"<bpt id=\"p1\">[</bpt>How to: Retrieve the Thumbprint of a Certificate<ept id=\"p1\">](../../../../docs/framework/wcf/feature-details/how-to-retrieve-the-thumbprint-of-a-certificate.md)</ept>","pos":[16734,16883],"source":"[How to: Retrieve the Thumbprint of a Certificate](../../../../docs/framework/wcf/feature-details/how-to-retrieve-the-thumbprint-of-a-certificate.md)"}]}